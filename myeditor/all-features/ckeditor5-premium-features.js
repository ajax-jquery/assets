/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin,Editor,icons as _0x27b58d,Plugin,Command as _0x354f99,PendingActions,Context,ElementApiMixin}from"ckeditor5";import{CKEditorError,Collection,uid,first,FocusTracker,KeystrokeHandler,ObservableMixin,global as _0x56a4f4,isVisible,Rect,diff,priorities,scrollViewportToShowTarget,getEnvKeystrokeText,toUnit,DomEmitterMixin,keyCodes,diffToChanges,scrollAncestorsToShowTarget,logWarning,logError,env,ResizeObserver,version as _0x440a6e,ElementReplacer,insertToPriorityArray}from"ckeditor5";import{View,IconView,ButtonView,DropdownButtonView,FocusCycler,isViewWithFocusCycler,ToolbarView,SpinnerView,AutocompleteView,ListView,ListItemGroupView,ListItemView,ButtonLabelView,createLabeledTextarea,Dialog,createDropdown,addMenuToDropdown,MenuBarMenuView,MenuBarMenuListItemButtonView,DialogViewPosition,MenuBarMenuListView,MenuBarMenuListItemView,addListToDropdown,ViewModel,EditorUIView,InlineEditableUIView,EditorUI,ViewCollection,focusChildOnDropdownOpen,BodyCollection,BalloonPanelView,ContextualBalloon,Notification,SplitButtonView,FileDialogButtonView,MenuBarMenuListItemFileDialogButtonView,addKeyboardHandlingForGrid,CollapsibleView,LabeledFieldView,createLabeledInputNumber,filterGroupAndItemNames,LabelWithHighlightView,ButtonLabelWithHighlightView,SearchTextView,InputNumberView,LabelView,clickOutsideHandler,injectCssTransitionDisabler,submitHandler,createLabeledInputText,ToolbarSeparatorView,normalizeToolbarConfig,BoxedEditorUIView,StickyPanelView,HighlightedTextView,normalizeColorOptions,ListSeparatorView}from"ckeditor5";import{UpcastWriter,Matcher,DataTransfer as DataTransfer$1,DomEventData,disablePlaceholder,enablePlaceholder,MouseObserver,Text,TreeWalker,ClickObserver,Range,isParagraphable,wrapInParagraph,ViewDocument,DomConverter,LiveRange,History,NoOperation,InsertOperation,MarkerOperation,RootAttributeOperation,transformSets,OperationFactory,ViewDocumentFragment,ViewText,ViewElement,Element,Position,DocumentFragment,ViewContainerElement,ViewAttributeElement,ViewEmptyElement,ViewRawElement,ViewUIElement,LivePosition}from"ckeditor5";import{ClipboardMarkersUtils,Clipboard,ClipboardPipeline}from"ckeditor5";import{Enter,ShiftEnter}from"ckeditor5";import{SelectAll}from"ckeditor5";import{Typing,Delete,Input}from"ckeditor5";import{Undo}from"ckeditor5";import{Paragraph}from"ckeditor5";import{toWidget,Widget,findOptimalInsertionRange,viewToModelPositionOutsideModelElement,setHighlightHandling}from"ckeditor5";import{MSWordNormalizer,parseHtml}from"ckeditor5";import{ObservableMixin as _0x411082,priorities as priorities$1,global as _0x448d4e,EmitterMixin,Collection as Collection$1}from"ckeditor5";function HcD(e){function t(e,i){let r=n();return(t=function(e,t){return r[e-=496]})(e,i)}function n(){let e=["startsWith","9796692BfxRtb","141968hEwQUW","235781OGfvuY","parse","620pGuKjb","10279260SkNSIb","524LnqIBi","qdFTY","split","replace","12369qIdXlr","13dTbsJH","150AtfVFq","104269ljRjsR","46632oPbNlT","8QxhARo"];return(n=function(){return e})()}return function(e){let n=t,i=e();for(;;)try{if(576604==-parseInt(n(506))/1*(-parseInt(n(496))/2)+-parseInt(n(505))/3*(-parseInt(n(501))/4)+-parseInt(n(499))/5*(-parseInt(n(509))/6)+parseInt(n(497))/7*(-parseInt(n(510))/8)+-parseInt(n(500))/9+-parseInt(n(507))/10*(-parseInt(n(508))/11)+-parseInt(n(512))/12)break;i.push(i.shift())}catch(e){i.push(i.shift())}}(n),function(e){let n=t,i=e[n(503)](".")[1];try{if(!e[n(511)]("ey"))return null;let t={qdFTY:function(e,t){return e(t)}}[n(502)](atob,i[n(504)](/-/g,"+")[n(504)](/_/g,"/"));return JSON[n(498)](t)}catch(e){return null}}(e)}class Permissions extends ContextPlugin{static get pluginName(){return"Permissions"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}setPermissions(e,t){let n;if(t||(t=this.context.config.get("collaboration.channelId")),this.context.config.get("collaboration.channelId")==t?n=this.context:"editors"in this.context&&this.context.editors&&(n=this.context.editors.find((e=>e.config.get("collaboration.channelId")==t))),!n)throw new CKEditorError("permissions-set-permissions-invalid-channel-id",null);const i=n.plugins,r=i.has("CommentsRepository")?i.get("CommentsRepository"):void 0,s=i.has("CommentsOnly")&&i.get("CommentsOnly"),o=e.includes("document:write"),a=e.includes("comment:modify_all"),c=e.includes("comment:admin"),l=e.includes("comment:write"),d=l||c,u=d||a,h=o||d;if(s&&(s.isEnabled=!o&&u),n instanceof Editor&&(o||u&&r?n.disableReadOnlyMode("no-permissions"):n.enableReadOnlyMode("no-permissions")),r){r.setPermissions({admin:c,modifyAll:a,write:l,resolve:h},t);const e=n instanceof Editor&&n.commands.get("addCommentThread");e&&(d?e.clearForceDisabled("noPermissions"):e.forceDisabled("noPermissions"))}}}function getTranslation$g(e,t){const n=e.t;switch(t){case"Anonymous":return n("Anonymous");case"Yes":return n("Yes");case"No":return n("No");case"Are you sure?":return n("Are you sure?");default:return""}}class Users extends ContextPlugin{static get pluginName(){return"Users"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Permissions]}constructor(e){super(e),this.context.config.define("users.anonymousUserId","anonymous-user"),this.context.config.define("users.colorsCount",8),this.users=new Collection,this._locale=e.locale,this._lastColor=0,this._myId=null,this.decorate("getOperationAuthor")}init(){this._addAnonymousUser()}get me(){return null==this._myId?null:this.getUser(this._myId)}addUser({id:e,name:t,...n}){if(!e||"string"!=typeof e)throw new CKEditorError("users-add-invalid-id");if(this.users.has(e))throw new CKEditorError("users-add-duplicated-id",null,{id:e});const i={...n,id:e,name:normalizeName(this._locale,t),color:this._getNextColor()};i.name=normalizeName(this._locale,i.name);const r=new User$1(i);return this.users.add(r),r}getUser(e){return this.users.get(e)}useAnonymousUser(){const e=this.context.config.get("users.anonymousUserId");this._myId||this.defineMe(e)}defineMe(e){if(this._myId)throw new CKEditorError("users-me-already-defined",null);const t=this.getUser(e);if(!t)throw new CKEditorError("users-me-missing-user",null);this._myId=e,t._isMe=!0}getOperationAuthor(){return this.me}_getNextColor(){const e=this.context.config.get("users.colorsCount");return this._lastColor>=e&&(this._lastColor=0),new Color(this._lastColor++)}_addAnonymousUser(){const e=this.context.config.get("users.anonymousUserId");this.addUser({id:e,name:getTranslation$g(this._locale,"Anonymous")})._isAnonymous=!0}}let User$1=class{constructor(e){this.id=e.id,this.color=e.color,this.name=e.name,this.avatar=e.avatar,this._isAnonymous=!1,this._isMe=!1}get isAnonymous(){return this._isAnonymous}get isMe(){return this._isMe}get initials(){const e=this.name.split(" ");return 1===e.length?this._getInitial(e[0]):this._getInitial(e[0])+this._getInitial(e[e.length-1])}_getInitial(e){return e.charAt(0).toUpperCase()}};function normalizeName(e,t=""){return""==(t=t.trim())?getTranslation$g(e,"Anonymous"):t}class Color{constructor(e){this._id=e}getBackgroundColorClass(){return"ck-user__bg-color--"+this._id}getSelectionClass(){return"ck-user__selection--"+this._id}getMarkerClass(){return"ck-user__marker--"+this._id}}var notificationIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/></svg>\n';class UserView extends View{constructor(e,t,n){super(e),this.name=t.name,this.notificationView=null;const i=["ck","ck-user"],r=["ck","ck-user__img"];if(t.isAnonymous&&r.push("ck-user__anonymous"),!t.isAnonymous&&t.isMe&&i.push("ck-user_me"),t.avatar&&r.push("ck-user__avatar"),n){const e=new IconView;e.extendTemplate({attributes:{class:["ck-user__icon"]}}),e.content=notificationIcon,this.notificationView={tag:"div",attributes:{class:["ck","ck-user__notification"],"data-cke-tooltip-position":"n","data-cke-tooltip-text":n},children:[e]}}const s=[{tag:"div",attributes:{class:r,style:{"background-image":t.avatar?"url('"+t.avatar+"')":""}}},{tag:"div",attributes:{class:t.avatar?"ck ck-user__name ck-user__name--hidden":"ck ck-user__name","aria-label":t.name},children:[{text:t.initials}]}];this.notificationView&&s.push(this.notificationView),this.setTemplate({tag:"div",attributes:{class:i,"data-user-id":t.id},children:s})}}class AriaDescriptionView extends View{constructor(e,t){super(e),this.id="ck-aria-description-"+uid(),this.setTemplate({tag:"span",attributes:{class:["ck","ck-aria-description"],id:this.id},children:[{text:t}]})}}class LateFocusButtonView extends ButtonView{render(){super.render(),delayFocusUntilMouseup(this)}}class LateFocusDropdownButtonView extends DropdownButtonView{render(){super.render(),delayFocusUntilMouseup(this)}}function delayFocusUntilMouseup(e){e.listenTo(e.element,"mousedown",((e,t)=>{t.stopPropagation(),t.preventDefault()})),e.listenTo(e.element,"mouseup",(()=>{e.element.focus()}))}var format={exports:{}},interopRequireDefault={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}(interopRequireDefault);var interopRequireDefaultExports=interopRequireDefault.exports,isValid={exports:{}},isDate$1={exports:{}},_typeof={exports:{}};!function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(_typeof);var _typeofExports=_typeof.exports,requiredArgs={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")},e.exports=t.default}(requiredArgs,requiredArgs.exports);var requiredArgsExports=requiredArgs.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,r.default)(1,arguments),e instanceof Date||"object"===(0,i.default)(e)&&"[object Date]"===Object.prototype.toString.call(e)};var i=n(_typeofExports),r=n(requiredArgsExports);e.exports=t.default}(isDate$1,isDate$1.exports);var isDateExports=isDate$1.exports,toDate$1={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,r.default)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,i.default)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))};var i=n(_typeofExports),r=n(requiredArgsExports);e.exports=t.default}(toDate$1,toDate$1.exports);var toDateExports=toDate$1.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,s.default)(1,arguments),!(0,i.default)(e)&&"number"!=typeof e)return!1;var t=(0,r.default)(e);return!isNaN(Number(t))};var i=n(isDateExports),r=n(toDateExports),s=n(requiredArgsExports);e.exports=t.default}(isValid,isValid.exports);var isValidExports=isValid.exports,subMilliseconds={exports:{}},addMilliseconds={exports:{}},toInteger={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)},e.exports=t.default}(toInteger,toInteger.exports);var toIntegerExports=toInteger.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,s.default)(2,arguments);var n=(0,r.default)(e).getTime(),o=(0,i.default)(t);return new Date(n+o)};var i=n(toIntegerExports),r=n(toDateExports),s=n(requiredArgsExports);e.exports=t.default}(addMilliseconds,addMilliseconds.exports);var addMillisecondsExports=addMilliseconds.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,r.default)(2,arguments);var n=(0,s.default)(t);return(0,i.default)(e,-n)};var i=n(addMillisecondsExports),r=n(requiredArgsExports),s=n(toIntegerExports);e.exports=t.default}(subMilliseconds,subMilliseconds.exports);var subMillisecondsExports=subMilliseconds.exports,formatters={exports:{}},getUTCDayOfYear={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,r.default)(1,arguments);var t=(0,i.default)(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var o=n-t.getTime();return Math.floor(o/s)+1};var i=n(toDateExports),r=n(requiredArgsExports),s=864e5;e.exports=t.default}(getUTCDayOfYear,getUTCDayOfYear.exports);var getUTCDayOfYearExports=getUTCDayOfYear.exports,getUTCISOWeek={exports:{}},startOfUTCISOWeek={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,r.default)(1,arguments);var t=(0,i.default)(e),n=t.getUTCDay(),s=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-s),t.setUTCHours(0,0,0,0),t};var i=n(toDateExports),r=n(requiredArgsExports);e.exports=t.default}(startOfUTCISOWeek,startOfUTCISOWeek.exports);var startOfUTCISOWeekExports=startOfUTCISOWeek.exports,startOfUTCISOWeekYear={exports:{}},getUTCISOWeekYear={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,r.default)(1,arguments);var t=(0,i.default)(e),n=t.getUTCFullYear(),o=new Date(0);o.setUTCFullYear(n+1,0,4),o.setUTCHours(0,0,0,0);var a=(0,s.default)(o),c=new Date(0);c.setUTCFullYear(n,0,4),c.setUTCHours(0,0,0,0);var l=(0,s.default)(c);return t.getTime()>=a.getTime()?n+1:t.getTime()>=l.getTime()?n:n-1};var i=n(toDateExports),r=n(requiredArgsExports),s=n(startOfUTCISOWeekExports);e.exports=t.default}(getUTCISOWeekYear,getUTCISOWeekYear.exports);var getUTCISOWeekYearExports=getUTCISOWeekYear.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,s.default)(1,arguments);var t=(0,i.default)(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),(0,r.default)(n)};var i=n(getUTCISOWeekYearExports),r=n(startOfUTCISOWeekExports),s=n(requiredArgsExports);e.exports=t.default}(startOfUTCISOWeekYear,startOfUTCISOWeekYear.exports);var startOfUTCISOWeekYearExports=startOfUTCISOWeekYear.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,o.default)(1,arguments);var t=(0,i.default)(e),n=(0,r.default)(t).getTime()-(0,s.default)(t).getTime();return Math.round(n/a)+1};var i=n(toDateExports),r=n(startOfUTCISOWeekExports),s=n(startOfUTCISOWeekYearExports),o=n(requiredArgsExports),a=6048e5;e.exports=t.default}(getUTCISOWeek,getUTCISOWeek.exports);var getUTCISOWeekExports=getUTCISOWeek.exports,getUTCWeek={exports:{}},startOfUTCWeek={exports:{}},defaultOptions$1={};Object.defineProperty(defaultOptions$1,"__esModule",{value:!0}),defaultOptions$1.getDefaultOptions=getDefaultOptions,defaultOptions$1.setDefaultOptions=setDefaultOptions;var defaultOptions={};function getDefaultOptions(){return defaultOptions}function setDefaultOptions(e){defaultOptions=e}!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n,a,c,l,d,u,h,m;(0,r.default)(1,arguments);var g=(0,o.getDefaultOptions)(),p=(0,s.default)(null!==(n=null!==(a=null!==(c=null!==(l=null==t?void 0:t.weekStartsOn)&&void 0!==l?l:null==t||null===(d=t.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==c?c:g.weekStartsOn)&&void 0!==a?a:null===(h=g.locale)||void 0===h||null===(m=h.options)||void 0===m?void 0:m.weekStartsOn)&&void 0!==n?n:0);if(!(p>=0&&p<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=(0,i.default)(e),y=f.getUTCDay(),b=(y<p?7:0)+y-p;return f.setUTCDate(f.getUTCDate()-b),f.setUTCHours(0,0,0,0),f};var i=n(toDateExports),r=n(requiredArgsExports),s=n(toIntegerExports),o=defaultOptions$1;e.exports=t.default}(startOfUTCWeek,startOfUTCWeek.exports);var startOfUTCWeekExports=startOfUTCWeek.exports,startOfUTCWeekYear={exports:{}},getUTCWeekYear={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n,c,l,d,u,h,m,g;(0,r.default)(1,arguments);var p=(0,i.default)(e),f=p.getUTCFullYear(),y=(0,a.getDefaultOptions)(),b=(0,o.default)(null!==(n=null!==(c=null!==(l=null!==(d=null==t?void 0:t.firstWeekContainsDate)&&void 0!==d?d:null==t||null===(u=t.locale)||void 0===u||null===(h=u.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==l?l:y.firstWeekContainsDate)&&void 0!==c?c:null===(m=y.locale)||void 0===m||null===(g=m.options)||void 0===g?void 0:g.firstWeekContainsDate)&&void 0!==n?n:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var w=new Date(0);w.setUTCFullYear(f+1,0,b),w.setUTCHours(0,0,0,0);var v=(0,s.default)(w,t),T=new Date(0);T.setUTCFullYear(f,0,b),T.setUTCHours(0,0,0,0);var _=(0,s.default)(T,t);return p.getTime()>=v.getTime()?f+1:p.getTime()>=_.getTime()?f:f-1};var i=n(toDateExports),r=n(requiredArgsExports),s=n(startOfUTCWeekExports),o=n(toIntegerExports),a=defaultOptions$1;e.exports=t.default}(getUTCWeekYear,getUTCWeekYear.exports);var getUTCWeekYearExports=getUTCWeekYear.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n,c,l,d,u,h,m,g;(0,r.default)(1,arguments);var p=(0,a.getDefaultOptions)(),f=(0,o.default)(null!==(n=null!==(c=null!==(l=null!==(d=null==t?void 0:t.firstWeekContainsDate)&&void 0!==d?d:null==t||null===(u=t.locale)||void 0===u||null===(h=u.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==l?l:p.firstWeekContainsDate)&&void 0!==c?c:null===(m=p.locale)||void 0===m||null===(g=m.options)||void 0===g?void 0:g.firstWeekContainsDate)&&void 0!==n?n:1),y=(0,i.default)(e,t),b=new Date(0);return b.setUTCFullYear(y,0,f),b.setUTCHours(0,0,0,0),(0,s.default)(b,t)};var i=n(getUTCWeekYearExports),r=n(requiredArgsExports),s=n(startOfUTCWeekExports),o=n(toIntegerExports),a=defaultOptions$1;e.exports=t.default}(startOfUTCWeekYear,startOfUTCWeekYear.exports);var startOfUTCWeekYearExports=startOfUTCWeekYear.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,o.default)(1,arguments);var n=(0,i.default)(e),c=(0,r.default)(n,t).getTime()-(0,s.default)(n,t).getTime();return Math.round(c/a)+1};var i=n(toDateExports),r=n(startOfUTCWeekExports),s=n(startOfUTCWeekYearExports),o=n(requiredArgsExports),a=6048e5;e.exports=t.default}(getUTCWeek,getUTCWeek.exports);var getUTCWeekExports=getUTCWeek.exports,addLeadingZeros={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=e<0?"-":"",i=Math.abs(e).toString();i.length<t;)i="0"+i;return n+i},e.exports=t.default}(addLeadingZeros,addLeadingZeros.exports);var addLeadingZerosExports=addLeadingZeros.exports,lightFormatters={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(addLeadingZerosExports),r={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return(0,i.default)("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):(0,i.default)(n+1,2)},d:function(e,t){return(0,i.default)(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return(0,i.default)(e.getUTCHours()%12||12,t.length)},H:function(e,t){return(0,i.default)(e.getUTCHours(),t.length)},m:function(e,t){return(0,i.default)(e.getUTCMinutes(),t.length)},s:function(e,t){return(0,i.default)(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds(),s=Math.floor(r*Math.pow(10,n-3));return(0,i.default)(s,t.length)}};t.default=r,e.exports=t.default}(lightFormatters,lightFormatters.exports);var lightFormattersExports=lightFormatters.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(getUTCDayOfYearExports),r=n(getUTCISOWeekExports),s=n(getUTCISOWeekYearExports),o=n(getUTCWeekExports),a=n(getUTCWeekYearExports),c=n(addLeadingZerosExports),l=n(lightFormattersExports);function d(e,t){var n=e>0?"-":"+",i=Math.abs(e),r=Math.floor(i/60),s=i%60;if(0===s)return n+String(r);var o=t;return n+String(r)+o+(0,c.default)(s,2)}function u(e,t){return e%60==0?(e>0?"-":"+")+(0,c.default)(Math.abs(e)/60,2):h(e,t)}function h(e,t){var n=t||"",i=e>0?"-":"+",r=Math.abs(e);return i+(0,c.default)(Math.floor(r/60),2)+n+(0,c.default)(r%60,2)}var m={G:function(e,t,n){var i=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});default:return n.era(i,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var i=e.getUTCFullYear(),r=i>0?i:1-i;return n.ordinalNumber(r,{unit:"year"})}return l.default.y(e,t)},Y:function(e,t,n,i){var r=(0,a.default)(e,i),s=r>0?r:1-r;if("YY"===t){var o=s%100;return(0,c.default)(o,2)}return"Yo"===t?n.ordinalNumber(s,{unit:"year"}):(0,c.default)(s,t.length)},R:function(e,t){var n=(0,s.default)(e);return(0,c.default)(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return(0,c.default)(n,t.length)},Q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(i);case"QQ":return(0,c.default)(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(i);case"qq":return(0,c.default)(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(e,t,n){var i=e.getUTCMonth();switch(t){case"M":case"MM":return l.default.M(e,t);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(e,t,n){var i=e.getUTCMonth();switch(t){case"L":return String(i+1);case"LL":return(0,c.default)(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(e,t,n,i){var r=(0,o.default)(e,i);return"wo"===t?n.ordinalNumber(r,{unit:"week"}):(0,c.default)(r,t.length)},I:function(e,t,n){var i=(0,r.default)(e);return"Io"===t?n.ordinalNumber(i,{unit:"week"}):(0,c.default)(i,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):l.default.d(e,t)},D:function(e,t,n){var r=(0,i.default)(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):(0,c.default)(r,t.length)},E:function(e,t,n){var i=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return(0,c.default)(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return(0,c.default)(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(e,t,n){var i=e.getUTCDay(),r=0===i?7:i;switch(t){case"i":return String(r);case"ii":return(0,c.default)(r,t.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(e,t,n){var i=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var i,r=e.getUTCHours();switch(i=12===r?"noon":0===r?"midnight":r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var i,r=e.getUTCHours();switch(i=r>=17?"evening":r>=12?"afternoon":r>=4?"morning":"night",t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var i=e.getUTCHours()%12;return 0===i&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return l.default.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):l.default.H(e,t)},K:function(e,t,n){var i=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(i,{unit:"hour"}):(0,c.default)(i,t.length)},k:function(e,t,n){var i=e.getUTCHours();return 0===i&&(i=24),"ko"===t?n.ordinalNumber(i,{unit:"hour"}):(0,c.default)(i,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):l.default.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):l.default.s(e,t)},S:function(e,t){return l.default.S(e,t)},X:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return u(r);case"XXXX":case"XX":return h(r);default:return h(r,":")}},x:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"x":return u(r);case"xxxx":case"xx":return h(r);default:return h(r,":")}},O:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+d(r,":");default:return"GMT"+h(r,":")}},z:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+d(r,":");default:return"GMT"+h(r,":")}},t:function(e,t,n,i){var r=i._originalDate||e,s=Math.floor(r.getTime()/1e3);return(0,c.default)(s,t.length)},T:function(e,t,n,i){var r=(i._originalDate||e).getTime();return(0,c.default)(r,t.length)}};t.default=m,e.exports=t.default}(formatters,formatters.exports);var formattersExports=formatters.exports,longFormatters={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},i=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},r={p:i,P:function(e,t){var r,s=e.match(/(P+)(p+)?/)||[],o=s[1],a=s[2];if(!a)return n(e,t);switch(o){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",n(o,t)).replace("{{time}}",i(a,t))}};t.default=r,e.exports=t.default}(longFormatters,longFormatters.exports);var longFormattersExports=longFormatters.exports,getTimezoneOffsetInMilliseconds={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()},e.exports=t.default}(getTimezoneOffsetInMilliseconds,getTimezoneOffsetInMilliseconds.exports);var getTimezoneOffsetInMillisecondsExports=getTimezoneOffsetInMilliseconds.exports,protectedTokens={};Object.defineProperty(protectedTokens,"__esModule",{value:!0}),protectedTokens.isProtectedDayOfYearToken=isProtectedDayOfYearToken,protectedTokens.isProtectedWeekYearToken=isProtectedWeekYearToken,protectedTokens.throwProtectedError=throwProtectedError;var protectedDayOfYearTokens=["D","DD"],protectedWeekYearTokens=["YY","YYYY"];function isProtectedDayOfYearToken(e){return-1!==protectedDayOfYearTokens.indexOf(e)}function isProtectedWeekYearToken(e){return-1!==protectedWeekYearTokens.indexOf(e)}function throwProtectedError(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var defaultLocale$1={exports:{}},enUS={exports:{}},formatDistance={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};t.default=function(e,t,i){var r,s=n[e];return r="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),null!=i&&i.addSuffix?i.comparison&&i.comparison>0?"in "+r:r+" ago":r},e.exports=t.default}(formatDistance,formatDistance.exports);var formatDistanceExports=formatDistance.exports,formatLong={exports:{}},buildFormatLongFn={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}},e.exports=t.default}(buildFormatLongFn,buildFormatLongFn.exports);var buildFormatLongFnExports=buildFormatLongFn.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(buildFormatLongFnExports),r={date:(0,i.default)({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:(0,i.default)({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:(0,i.default)({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};t.default=r,e.exports=t.default}(formatLong,formatLong.exports);var formatLongExports=formatLong.exports,formatRelative={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};t.default=function(e,t,i,r){return n[e]},e.exports=t.default}(formatRelative,formatRelative.exports);var formatRelativeExports=formatRelative.exports,localize={exports:{}},buildLocalizeFn={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t,n){var i;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&e.formattingValues){var r=e.defaultFormattingWidth||e.defaultWidth,s=null!=n&&n.width?String(n.width):r;i=e.formattingValues[s]||e.formattingValues[r]}else{var o=e.defaultWidth,a=null!=n&&n.width?String(n.width):e.defaultWidth;i=e.values[a]||e.values[o]}return i[e.argumentCallback?e.argumentCallback(t):t]}},e.exports=t.default}(buildLocalizeFn,buildLocalizeFn.exports);var buildLocalizeFnExports=buildLocalizeFn.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(buildLocalizeFnExports),r={ordinalNumber:function(e,t){var n=Number(e),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:(0,i.default)({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:(0,i.default)({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:(0,i.default)({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:(0,i.default)({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:(0,i.default)({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};t.default=r,e.exports=t.default}(localize,localize.exports);var localizeExports=localize.exports,match$1={exports:{}},buildMatchFn={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.width,r=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],s=t.match(r);if(!s)return null;var o,a=s[0],c=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?function(e){for(var t=0;t<e.length;t++)if(e[t].test(a))return t}(c):function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].test(a))return t}(c);return o=e.valueCallback?e.valueCallback(l):l,{value:o=n.valueCallback?n.valueCallback(o):o,rest:t.slice(a.length)}}},e.exports=t.default}(buildMatchFn,buildMatchFn.exports);var buildMatchFnExports=buildMatchFn.exports,buildMatchPatternFn={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.match(e.matchPattern);if(!i)return null;var r=i[0],s=t.match(e.parsePattern);if(!s)return null;var o=e.valueCallback?e.valueCallback(s[0]):s[0];return{value:o=n.valueCallback?n.valueCallback(o):o,rest:t.slice(r.length)}}},e.exports=t.default}(buildMatchPatternFn,buildMatchPatternFn.exports);var buildMatchPatternFnExports=buildMatchPatternFn.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(buildMatchFnExports),r={ordinalNumber:(0,n(buildMatchPatternFnExports).default)({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:(0,i.default)({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:(0,i.default)({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:(0,i.default)({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:(0,i.default)({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:(0,i.default)({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};t.default=r,e.exports=t.default}(match$1,match$1.exports);var matchExports=match$1.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(formatDistanceExports),r=n(formatLongExports),s=n(formatRelativeExports),o=n(localizeExports),a=n(matchExports),c={code:"en-US",formatDistance:i.default,formatLong:r.default,formatRelative:s.default,localize:o.default,match:a.default,options:{weekStartsOn:0,firstWeekContainsDate:1}};t.default=c,e.exports=t.default}(enUS,enUS.exports);var enUSExports=enUS.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(enUSExports).default;t.default=i,e.exports=t.default}(defaultLocale$1,defaultLocale$1.exports);var defaultLocaleExports=defaultLocale$1.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var w,v,T,_,C,E,I,S,A,O,k,R,P,M,x,D,N,L;(0,u.default)(2,arguments);var V=String(t),U=(0,h.getDefaultOptions)(),B=null!==(w=null!==(v=null==n?void 0:n.locale)&&void 0!==v?v:U.locale)&&void 0!==w?w:m.default,F=(0,d.default)(null!==(T=null!==(_=null!==(C=null!==(E=null==n?void 0:n.firstWeekContainsDate)&&void 0!==E?E:null==n||null===(I=n.locale)||void 0===I||null===(S=I.options)||void 0===S?void 0:S.firstWeekContainsDate)&&void 0!==C?C:U.firstWeekContainsDate)&&void 0!==_?_:null===(A=U.locale)||void 0===A||null===(O=A.options)||void 0===O?void 0:O.firstWeekContainsDate)&&void 0!==T?T:1);if(!(F>=1&&F<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=(0,d.default)(null!==(k=null!==(R=null!==(P=null!==(M=null==n?void 0:n.weekStartsOn)&&void 0!==M?M:null==n||null===(x=n.locale)||void 0===x||null===(D=x.options)||void 0===D?void 0:D.weekStartsOn)&&void 0!==P?P:U.weekStartsOn)&&void 0!==R?R:null===(N=U.locale)||void 0===N||null===(L=N.options)||void 0===L?void 0:L.weekStartsOn)&&void 0!==k?k:0);if(!(j>=0&&j<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!B.localize)throw new RangeError("locale must contain localize property");if(!B.formatLong)throw new RangeError("locale must contain formatLong property");var H=(0,s.default)(e);if(!(0,i.default)(H))throw new RangeError("Invalid time value");var $=(0,c.default)(H),G=(0,r.default)(H,$),W={firstWeekContainsDate:F,weekStartsOn:j,locale:B,_originalDate:H};return V.match(p).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,a.default[t])(e,B.formatLong):e})).join("").match(g).map((function(i){if("''"===i)return"'";var r,s,a=i[0];if("'"===a)return(s=(r=i).match(f))?s[1].replace(y,"'"):r;var c=o.default[a];if(c)return null!=n&&n.useAdditionalWeekYearTokens||!(0,l.isProtectedWeekYearToken)(i)||(0,l.throwProtectedError)(i,t,String(e)),null!=n&&n.useAdditionalDayOfYearTokens||!(0,l.isProtectedDayOfYearToken)(i)||(0,l.throwProtectedError)(i,t,String(e)),c(G,i,B.localize,W);if(a.match(b))throw new RangeError("Format string contains an unescaped latin alphabet character `"+a+"`");return i})).join("")};var i=n(isValidExports),r=n(subMillisecondsExports),s=n(toDateExports),o=n(formattersExports),a=n(longFormattersExports),c=n(getTimezoneOffsetInMillisecondsExports),l=protectedTokens,d=n(toIntegerExports),u=n(requiredArgsExports),h=defaultOptions$1,m=n(defaultLocaleExports),g=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,p=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,f=/^'([^]*?)'?$/,y=/''/g,b=/[a-zA-Z]/;e.exports=t.default}(format,format.exports);var formatExports=format.exports,parseISO={exports:{}},constants={};Object.defineProperty(constants,"__esModule",{value:!0}),constants.secondsInYear=constants.secondsInWeek=constants.secondsInQuarter=constants.secondsInMonth=constants.secondsInMinute=constants.secondsInHour=constants.secondsInDay=constants.quartersInYear=constants.monthsInYear=constants.monthsInQuarter=constants.minutesInHour=constants.minTime=constants.millisecondsInSecond=constants.millisecondsInMinute=constants.millisecondsInHour=constants.maxTime=constants.daysInYear=constants.daysInWeek=void 0;var daysInWeek=7;constants.daysInWeek=daysInWeek;var daysInYear$1=365.2425;constants.daysInYear=daysInYear$1;var maxTime=24*Math.pow(10,8)*60*60*1e3;constants.maxTime=maxTime;var millisecondsInMinute=6e4;constants.millisecondsInMinute=millisecondsInMinute;var millisecondsInHour=36e5;constants.millisecondsInHour=millisecondsInHour;var millisecondsInSecond=1e3;constants.millisecondsInSecond=millisecondsInSecond;var minTime=-maxTime;constants.minTime=minTime;var minutesInHour=60;constants.minutesInHour=minutesInHour;var monthsInQuarter=3;constants.monthsInQuarter=monthsInQuarter;var monthsInYear=12;constants.monthsInYear=monthsInYear;var quartersInYear=4;constants.quartersInYear=quartersInYear;var secondsInHour=3600;constants.secondsInHour=secondsInHour;var secondsInMinute=60;constants.secondsInMinute=secondsInMinute;var secondsInDay=24*secondsInHour;constants.secondsInDay=secondsInDay;var secondsInWeek=7*secondsInDay;constants.secondsInWeek=secondsInWeek;var secondsInYear=secondsInDay*daysInYear$1;constants.secondsInYear=secondsInYear;var secondsInMonth=secondsInYear/12;constants.secondsInMonth=secondsInMonth;var secondsInQuarter=3*secondsInMonth;constants.secondsInQuarter=secondsInQuarter,function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n;(0,r.default)(1,arguments);var g=(0,s.default)(null!==(n=null==t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==g&&1!==g&&0!==g)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var p,f=function(e){var t,n={},i=e.split(o.dateTimeDelimiter);if(i.length>2)return n;if(/:/.test(i[0])?t=i[0]:(n.date=i[0],t=i[1],o.timeZoneDelimiter.test(n.date)&&(n.date=e.split(o.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length))),t){var r=o.timezone.exec(t);r?(n.time=t.replace(r[1],""),n.timezone=r[1]):n.time=t}return n}(e);if(f.date){var y=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),i=e.match(n);if(!i)return{year:NaN,restDateString:""};var r=i[1]?parseInt(i[1]):null,s=i[2]?parseInt(i[2]):null;return{year:null===s?r:100*s,restDateString:e.slice((i[1]||i[2]).length)}}(f.date,g);p=function(e,t){if(null===t)return new Date(NaN);var n=e.match(a);if(!n)return new Date(NaN);var i,r,s=!!n[4],o=d(n[1]),c=d(n[2])-1,l=d(n[3]),u=d(n[4]),g=d(n[5])-1;if(s)return r=g,(i=u)>=1&&i<=53&&r>=0&&r<=6?function(e,t,n){var i=new Date(0);i.setUTCFullYear(e,0,4);var r=7*(t-1)+n+1-(i.getUTCDay()||7);return i.setUTCDate(i.getUTCDate()+r),i}(t,u,g):new Date(NaN);var p,f,y,b,w,v=new Date(0);return y=t,w=l,(b=c)>=0&&b<=11&&w>=1&&w<=(h[b]||(m(y)?29:28))&&(p=t,(f=o)>=1&&f<=(m(p)?366:365))?(v.setUTCFullYear(t,c,Math.max(o,l)),v):new Date(NaN)}(y.restDateString,y.year)}if(!p||isNaN(p.getTime()))return new Date(NaN);var b,w=p.getTime(),v=0;if(f.time&&(v=function(e){var t=e.match(c);if(!t)return NaN;var n,r,s,o=u(t[1]),a=u(t[2]),l=u(t[3]);return r=a,s=l,(24===(n=o)?0===r&&0===s:s>=0&&s<60&&r>=0&&r<60&&n>=0&&n<25)?o*i.millisecondsInHour+a*i.millisecondsInMinute+1e3*l:NaN}(f.time),isNaN(v)))return new Date(NaN);if(!f.timezone){var T=new Date(w+v),_=new Date(0);return _.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),_.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),_}return b=function(e){if("Z"===e)return 0;var t=e.match(l);if(!t)return 0;var n,r="+"===t[1]?-1:1,s=parseInt(t[2]),o=t[3]&&parseInt(t[3])||0;return(n=o)>=0&&n<=59?r*(s*i.millisecondsInHour+o*i.millisecondsInMinute):NaN}(f.timezone),isNaN(b)?new Date(NaN):new Date(w+v+b)};var i=constants,r=n(requiredArgsExports),s=n(toIntegerExports),o={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},a=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,c=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,l=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d(e){return e?parseInt(e):1}function u(e){return e&&parseFloat(e.replace(",","."))||0}var h=[31,null,31,30,31,30,31,31,30,31,30,31];function m(e){return e%400==0||e%4==0&&e%100!=0}e.exports=t.default}(parseISO,parseISO.exports);var parseISOExports=parseISO.exports,differenceInCalendarDays={exports:{}},startOfDay={exports:{}};!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,r.default)(1,arguments);var t=(0,i.default)(e);return t.setHours(0,0,0,0),t};var i=n(toDateExports),r=n(requiredArgsExports);e.exports=t.default}(startOfDay,startOfDay.exports);var startOfDayExports=startOfDay.exports;!function(e,t){var n=interopRequireDefaultExports.default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,s.default)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t),c=n.getTime()-(0,i.default)(n),l=a.getTime()-(0,i.default)(a);return Math.round((c-l)/o)};var i=n(getTimezoneOffsetInMillisecondsExports),r=n(startOfDayExports),s=n(requiredArgsExports),o=864e5;e.exports=t.default}(differenceInCalendarDays,differenceInCalendarDays.exports);var differenceInCalendarDaysExports=differenceInCalendarDays.exports;function getDateTimeFormatter(e={}){if(void 0!==e.dateTimeFormat&&"function"!=typeof e.dateTimeFormat)throw new CKEditorError("invalid-date-time-format");return t=>{const n="string"==typeof t?parseISOExports(t):t,i=new Date,r=differenceInCalendarDaysExports(i,n);return e.dateTimeFormat?e.dateTimeFormat(n):formatExports(n,0===r?"'Today' hh:mma":1===r?"'Yesterday' hh:mma":r<7?"'Last' EEEE hh:mma":"MM-dd-yyyy hh:mma")}}function getMarkerDomElement(e,t){const n=e.mapper.markerNameToElements(t.name);if(!n)return null;const i=first(n.values());return e.view.domConverter.mapViewToDom(i)||null}function getAllMarkersDomElementsSorted(e,t){if(0===t.length)return null;const n=[],i=e.view.domConverter;for(const r of t){const t=e.mapper.markerNameToElements(r.name);if(!t)continue;const s=Array.from(t).map((e=>i.mapViewToDom(e))).filter((e=>!!e));n.push(...s)}if(0===n.length)return null;const r=[];for(const e of n){const t=e.getClientRects().item(0);t&&r.push({x:t.x,y:t.y,domElement:e})}return 0===r.length?null:(r.sort(((e,t)=>e.y-t.y||e.x-t.x)),r.map((e=>e.domElement)))}function trimHtml(e,{limit:t,suffix:n="..."}){const i=[];let r=0;const s=e.replace(/</g,"\n<").replace(/>/g,">\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n");for(let e=0;e<s.length;e++){let o=s[e];const a=splitCharactersToArray(o);if(o.startsWith("<")){if(r>=t){const t=o.match(/[a-zA-Z]+/);if(!t){s[e]="";continue}const n=t[0];o.startsWith("</")?(i.length&&(o=""),i.pop()):(i.push(n),o="")}}else if(r>=t)o="";else if(r+a.length>=t){let e=t-r;if(" "===a[e-1])e--;else{const t=a.slice(e).indexOf(" ");-1!==t?e+=t:e=o.length}o=a.slice(0,e).join("")+n,r=t}else r+=a.length;s[e]=o}return s.join("\n").replace(/\n/g,"")}function splitCharactersToArray(e){const t=[];for(let n=0;n<e.length;n++){const i=e.substring(n).match(/^&[a-z0-9#]+;/);if(i){const e=i[0];t.push(e),n+=e.length-1}else t.push(e[n])}return t}class ConfirmView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("message",getTranslation$g(e,"Are you sure?")),this.submitView=this._createButtonView(e,getTranslation$g(e,"Yes"),_0x27b58d.check,"submit"),this.cancelView=this._createButtonView(e,getTranslation$g(e,"No"),_0x27b58d.cancel,"cancel"),this.focusables=this.createCollection([this.submitView,this.cancelView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-thread__remove-confirm"],tabindex:-1,role:"alertdialog"},children:[{tag:"div",attributes:{class:"ck-thread__remove-confirm-inner",role:"presentation"},children:[{tag:"p",children:[{text:t.to("message")}]},{tag:"div",attributes:{class:"ck-thread__remove-confirm-actions"},children:[this.submitView,this.cancelView]}]}]})}render(){super.render(),this._setupKeyboardNavigation()}focus(){this.cancelView.element.focus({preventScroll:!0})}_createButtonView(e,t,n,i){const r=new ButtonView(e);return r.label=t,r.icon=n,r.extendTemplate({attributes:{class:"ck-thread__remove-confirm-"+i}}),r.on("execute",(()=>this.fire(i))),r}_setupKeyboardNavigation(){this.focusables.forEach((e=>{this.keystrokes.listenTo(e.element),this.focusTracker.add(e.element)})),this.keystrokes.set("esc",((e,t)=>{this.fire("cancel"),t()}))}}function ConfirmMixin(e){return class extends e{showConfirm(e,t){return this.confirmView=new ConfirmView(this.locale),this.confirmView.render(),this.confirmView.message=e,this.confirmView.once("cancel",(()=>{this._removeConfirm()})),this.confirmView.once("submit",(()=>{this._removeConfirm()})),t.appendChild(this.confirmView.element),this.registerChild(this.confirmView),this.confirmView.focus(),this.set("isConfirm",!0),new Promise((e=>this.confirmView.on("submit",e)))}cancelConfirm(){this.isConfirm&&this.confirmView.fire("cancel")}_removeConfirm(){this.element&&this.confirmView&&this.confirmView.element&&(this.element.focus(),this.confirmView.element.remove(),this.deregisterChild(this.confirmView),this.isConfirm=!1,this.fire("removeConfirm"),this.confirmView.destroy(),this.confirmView=void 0)}}}function hashObject(e){let t=0,n=0;for(const i of objectToNumberGenerator(e))t=(t<<5)-t+i,t|=0,[t,n]=[n,t];return toString$3(t)+toString$3(n)}function*toNumberGenerator(e){null==e||null==e?yield 314159265:0===e||!1===e?yield 0:1===e||1==e?yield 1:Array.isArray(e)?yield*arrayToNumberGenerator(e):"object"==typeof e?yield*objectToNumberGenerator(e):"string"==typeof e?yield*stringToNumberGenerator(e):"number"==typeof e&&(yield e)}function*objectToNumberGenerator(e){if(yield charCode("{"),e){const t=Object.keys(e).sort();for(const n of t){yield*stringToNumberGenerator(n),yield charCode(":");const t=e[n];yield*toNumberGenerator(t)}}yield charCode("}")}function*arrayToNumberGenerator(e){for(const t of e)yield*toNumberGenerator(t)}function*stringToNumberGenerator(e){yield charCode('"');for(const t of e)yield charCode(t);yield charCode('"')}function charCode(e){return e.charCodeAt(0)}function toString$3(e){return(e*=Math.sign(e)).toString(36)}const blackListedConfigOptions=["initialData","context","toolbar","rootsAttributes"],blackListedPlugins$2=["WebSocketGateway","RevisionTracker","Autosave","WordCount","DocumentOutline","WProofreader"];function skipRtcPlugins(e,t,n,i=[]){const r="string"==typeof e?n.get(e).constructor:e.prototype.constructor;if(t.has(r))return t.get(r);t.set(r,!0);const s=[...blackListedPlugins$2,...i].map((e=>{if(n.has(e))return n.get(e).constructor})).filter((e=>e));if(r&&s.includes(r))return t.set(r,!1),!1;if(!r.requires)return t.set(r,!0),!0;const o=r.requires.every((e=>skipRtcPlugins(e,t,n,i)));return t.set(r,o),o}function sanitizeEditorConfig(e,t){const n={};for(const t of e.config.names())blackListedConfigOptions.includes(t)||(n[t]=e.config.get(t));const i=n.plugins||[],r=e.constructor.builtinPlugins||[],s=i.length?i:r,o=n.extraPlugins||[];delete n.extraPlugins;const a=n.removePlugins||[];delete n.removePlugins;const c=e._context.config.get("plugins")||[],l=s.concat(o).concat(c).map((e=>"string"==typeof e?r.find((t=>t.pluginName==e)):e)).filter((e=>!a.includes(e)&&!a.includes(e.pluginName))),d=Array.from(new Set(l)),u=new Map;return n.plugins=d.filter((n=>skipRtcPlugins(n,u,e.plugins,t))),n}function surroundingMarkersDetector(e,t){const n=[];e.document.selection.on("change:range",(()=>{const i=getSurroundingMarkers(e,e.document.selection.focus),r=[],s=[],o=[];for(const e of n)i.includes(e)||r.push(e);for(const e of i)n.includes(e)||s.push(e),o.push(e);(r.length||s.length)&&t({left:r,entered:s}),n.length=0,n.push(...o)}))}function getSurroundingMarkers(e,t){const n=[];for(const i of e.markers){const e=i.getRange();(e.containsPosition(t)||e.start.isEqual(t)||e.end.isEqual(t))&&n.push(i)}return n}const FOCUS_ANNOTATION_KEYSTROKE="Ctrl+Shift+E";function setupThreadKeyboardNavigation(e,t){const n=e.element;e.keystrokes.listenTo(n);for(const n of t)addViewToFocusCyclerNavigation(e,n);t.on("change",((t,n)=>{for(const t of n.removed)removeViewFromFocusCyclerNavigation(e,t);for(const t of Array.from(n.added).reverse())addViewToFocusCyclerNavigation(e,t)})),e.keystrokes.set("enter",((t,i)=>{n===t.target&&(e.focusCycler.focusFirst(),i())}),{filter:e=>e.target===n}),e.keystrokes.set("esc",((t,i)=>{n!==t.target?e.focus():e.fire("escape"),i()})),e.keystrokes.set("arrowdown",((t,i)=>{n===t.target&&(e.fire("arrowdown"),i())})),e.keystrokes.set("arrowup",((t,i)=>{n===t.target&&(e.fire("arrowup"),i())}))}function addViewToFocusCyclerNavigation(e,t){t.isRendered&&(e.focusTracker.add(t.element),e.keystrokes.listenTo(t.element),isViewWithFocusCycler(t)&&areFocusCyclerActionsCompatible(e.focusCycler,t.focusCycler)&&e.focusCycler.chain(t.focusCycler))}function removeViewFromFocusCyclerNavigation(e,t){e.focusTracker.remove(t.element),e.keystrokes.stopListening(t.element),isViewWithFocusCycler(t)&&e.focusCycler.unchain(t.focusCycler)}function areFocusCyclerActionsCompatible(e,t){const n=e.actions,i=t.actions;for(const e of Object.keys(n))if(e in i&&n[e]!==i[e])return!1;return!0}var paintRoller='<svg viewBox="0 0 20 20" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3Z"/><path d="M16 3.25a1.5 1.5 0 0 1 1.5 1.5v1.7a2.25 2.25 0 0 1-1.932 2.226l-4.424.632a.75.75 0 0 0-.644.743V11a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-5a1 1 0 0 1 1-1v-.95a2.25 2.25 0 0 1 1.932-2.226l4.424-.632A.75.75 0 0 0 16 6.449V3.25Z"/></svg>\n',robotPencil='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.61 2.66a1.406 1.406 0 1 0-1.407 0v.891H3.28a2.11 2.11 0 0 0-2.11 2.11v10.312a2.11 2.11 0 0 0 2.11 2.109h5.684l-.054-1.157.18-.25H3.28a.703.703 0 0 1-.703-.702V5.66c0-.389.315-.704.703-.704h11.25c.388 0 .703.315.703.704v2.484l.358-.497a2.492 2.492 0 0 1 1.048-.84V5.66a2.11 2.11 0 0 0-2.11-2.11H9.61v-.89Z"/><path d="M5.625 10.817c.518 0 .937-.63.937-1.407 0-.776-.42-1.406-.937-1.406-.518 0-.938.63-.938 1.406 0 .777.42 1.407.938 1.407Z"/><path d="M13.125 9.41c0 .777-.42 1.407-.938 1.407s-.937-.63-.937-1.407c0-.776.42-1.406.937-1.406.518 0 .938.63.938 1.406Z"/><path d="M.937 8.004A.937.937 0 0 0 0 8.942v1.875c0 .517.42.937.937.937v-3.75Z"/><path d="M6.128 12.51a.782.782 0 0 1 1.085.216c.272.408.907.707 1.693.707s1.421-.3 1.693-.707a.782.782 0 0 1 1.302.868c-.666 1-1.906 1.403-2.995 1.403-1.089 0-2.329-.404-2.995-1.403a.782.782 0 0 1 .217-1.085Z"/><path d="m16.987 8.91-.622.864 2.879 2.074.622-.864a.71.71 0 0 0-.161-.99l-1.728-1.245a.71.71 0 0 0-.99.161Z"/><path d="M11.635 19.951a.355.355 0 0 1-.449-.31l-.214-2.38 4.978-6.911 2.88 2.074-4.978 6.91-2.217.617Z"/></svg>',tableOfContents='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 19a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8.022a6.47 6.47 0 0 0-1.5-.709V2a.5.5 0 0 0-.5-.5H3a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h6.313c.173.534.412 1.037.709 1.5H3Z"/><path d="M9.174 14a6.489 6.489 0 0 0-.155 1H6v-1h3.174Z"/><path d="M10.022 12c-.202.316-.378.65-.524 1H4v-1h6.022Z"/><path d="M12.034 10c-.448.283-.86.62-1.224 1H6v-1h6.034Z"/><path d="M12 4v1H4V4h8Z"/><path d="M14 7V6H6v1h8Z"/><path d="M15 9V8H7v1h8Z"/><path clip-rule="evenodd" d="M20 15.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM15.5 13a.5.5 0 0 0-.5.5V15h-1.5a.5.5 0 0 0 0 1H15v1.5a.5.5 0 0 0 1 0V16h1.5a.5.5 0 0 0 0-1H16v-1.5a.5.5 0 0 0-.5-.5Z"/></svg>\n',template='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8 0H3a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM2.5 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V2Z"/><path clip-rule="evenodd" d="M13 0h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-5Z"/><path clip-rule="evenodd" d="M13 10h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5Z"/></svg>',caseChange='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.789 3 0 17h1.664l1.664-4.027h6.797l.227.548c.046-.172.112-.352.209-.545.217-.436.556-.609.898-.798L7.664 3H5.79Zm.938 1.758 2.777 6.715H3.949l2.778-6.715Z"/><path d="M15.956 7.5c-1.584-.02-3.226.824-3.843 2.882l1.495.106c.904-2.082 4.594-2.13 4.375.534-3.245 1.024-4.838.117-6.082 2.62-.208.418-.17 1.57.54 2.397.71.826 2.014 1.149 3.409.85 1.395-.299 2.24-1.386 2.24-1.386L18.205 17h1.493l-.059-1.72-.056-5.274C19.51 8.612 17.75 7.524 15.956 7.5Zm2.027 4.696s.641 2.453-1.528 3.27c-3.376 1.269-4.188-2.141-1.775-2.638 1.704-.352 1.873-.25 3.303-.632Z"/></svg>';const icons={paintRoller:paintRoller,robotPencil:robotPencil,tableOfContents:tableOfContents,template:template,caseChange:caseChange},UNGROUPED_COMMANDS_GROUP_ID="_ungrouppedCommands";function normalizeCommandsConfig(e,t){const n=(0,t.t)("Other");return e.length?"groupId"in e[0]?e:[{groupId:UNGROUPED_COMMANDS_GROUP_ID,groupLabel:n,order:1/0,commands:e}]:[{groupId:UNGROUPED_COMMANDS_GROUP_ID,groupLabel:n,order:1/0,commands:[]}]}const VISUAL_SELECTION_MARKER_NAME="ai-ui";class AIAssistantEditing extends Plugin{static get pluginName(){return"AIAssistantEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this,t=["ck-fake-ai-selection"];e.config.get("ai.useTheme")&&t.push("ck-ai-assistant-ui_theme"),e.conversion.for("editingDowncast").markerToHighlight({model:VISUAL_SELECTION_MARKER_NAME,view:{classes:t,priority:12}}),e.conversion.for("editingDowncast").markerToElement({model:VISUAL_SELECTION_MARKER_NAME,view:(e,{writer:t})=>{if(!e.markerRange.isCollapsed)return null;const n=t.createUIElement("span");return t.addClass(["ck-fake-ai-selection","ck-fake-ai-selection_collapsed"],n),n}})}afterInit(){checkLicense$d(this)}showFakeVisualSelection(){const e=this.editor.model;e.change((t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(VISUAL_SELECTION_MARKER_NAME))t.updateMarker(VISUAL_SELECTION_MARKER_NAME,{range:n});else if(n.start.isAtEnd){const i=n.start.getLastMatchingPosition((({item:t})=>!e.schema.isContent(t)),{boundaries:n});t.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:t.createRange(i,n.end)})}else t.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:n})}))}hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(VISUAL_SELECTION_MARKER_NAME)&&e.change((e=>{e.removeMarker(VISUAL_SELECTION_MARKER_NAME)}))}insertContent(e,t){const n=t||this.editor.model.markers.get(VISUAL_SELECTION_MARKER_NAME).getRange();if(!this.editor.model.canEditAt(n))return;const i=this.editor.data.processor.toView(e),r=this.editor.data.toModel(i);this.editor.model.change((e=>{this.hideFakeVisualSelection();const t=this.editor.model.insertContent(r,n);t&&e.setSelection(t)}))}insertContentBelow(e){const{model:t}=this.editor,n=Array.from(t.createSelection(this.editor.model.markers.get(VISUAL_SELECTION_MARKER_NAME).getRange()).getSelectedBlocks()),i=n.length?t.createPositionAfter(n.pop()):t.document.selection.getLastPosition();this.insertContent(e,i)}}async function checkLicense$d(e){const t=g([77,89,106,69,78,85,110,49,71,74,122,103,104,109,118,120,99,53,65,70,115,84,66,117,116,81,101,57,72,55,76,82,112,54,73,67,50,119,80,51,97,121,48,107,75,86,98,88,102,90,111,113,79,87,105,68,56,108,100,52,114,83]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTUzODkxOTl9.eyJqdGkiOjIyNDQxMDI2NDgsImFsZyI6IkVTMjU2IiwiaWR4IjoxNzYwMTcwMDAwNDM1LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiJiZTVhMmIxZC1lODg3LTRlZmMtOWJkMC01YzEzNWQzMmFjODUiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1Mzg5MTk5LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTM4OX0.TUkwLo2vkQgTt8h8y-WZgx0QFmxV2rkZnYwWGdTFDRN09zgwUvqdu5OQV5Po6VsiA2crQFe_8vAPMMN1vR7V5Q"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([77]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([97,105,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([65,73])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class AIAdapter extends Plugin{static get pluginName(){return"AIAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){if(!this.textAdapter)throw new CKEditorError("aiadapter-text-adapter-not-set",null)}}class AIRequestError extends Error{constructor(e){super(e),this.name="AIRequestError"}}function getTranslation$f(e,t,n){const i=e.t;switch(t){case"Edit or review":return i("Edit or review");case"Improve writing":return i("Improve writing");case"Make shorter":return i("Make shorter");case"Make longer":return i("Make longer");case"Simplify language":return i("Simplify language");case"Generate from selection":return i("Generate from selection");case"Summarize":return i("Summarize");case"Continue":return i("Continue");case"Change tone":return i("Change tone");case"Professional":return i("Professional");case"Casual":return i("Casual");case"Direct":return i("Direct");case"Confident":return i("Confident");case"Friendly":return i("Friendly");case"Change style":return i("Change style");case"Business":return i("Business");case"Legal":return i("Legal");case"Journalism":return i("Journalism");case"Poetic":return i("Poetic");case"Translate":return i("Translate");case"English":return i("English");case"Spanish":return i("Spanish");case"German":return i("German");case"Portuguese":return i("Portuguese");case"French":return i("French");case"Simplified Chinese":return i("Simplified Chinese");case"Hindi":return i("Hindi");case"Arabic":return i("Arabic");case"Indonesian":return i("Indonesian");case"AI Assistant":return i("AI Assistant");case"AI Commands":return i("AI Commands");case"Ask AI to edit or generate":return i("Ask AI to edit or generate");case"Ask AI to improve generated text":return i("Ask AI to improve generated text");case"Copy":return i("Copy");case"Submit":return i("Submit");case"Insert below":return i("Insert below");case"Try again":return i("Try again");case"Stop":return i("Stop");case"AI is writing...":return i("AI is writing...");case"AI is writing":return i("AI is writing");case"Generated content: %0":return i("Generated content: %0",n);case"Error during AI content generation: %0":return i("Error during AI content generation: %0",n);case"History":return i("History");case"Empty history":return i("Empty history");case"Ask AI and your prompts will be listed here for you to use later.":return i("Ask AI and your prompts will be listed here for you to use later.");case"Prompt history":return i("Prompt history");case"Clear":return i("Clear");case"AI_REPLACE_CONTENT":return i({id:"AI_REPLACE_CONTENT",string:"Replace"});case"AI_INSERT_CONTENT":return i({id:"AI_INSERT_CONTENT",string:"Insert"});case"AI_ERROR_GET_HEADERS":return i({id:"AI_ERROR_GET_HEADERS",string:"Preparing request headers failed"});case"AI_ERROR_GET_PARAMETERS":return i({id:"AI_ERROR_GET_PARAMETERS",string:"Preparing request parameters failed"});case"AI_ERROR_UNSUPPORTED_MODEL":return i({id:"AI_ERROR_UNSUPPORTED_MODEL",string:'The requested AI model ("%0") is not supported'},n);case"AI_ERROR_CONTEXT_LENGTH":return i({id:"AI_ERROR_CONTEXT_LENGTH",string:"Selected content is too long"});case"AI_ERROR_MODERATION":return i({id:"AI_ERROR_MODERATION",string:"Requested query does not pass moderation rules"});case"AI_ERROR_FAILED":return i({id:"AI_ERROR_FAILED",string:"Failed to communicate with the AI service"});default:return t}}class ShowAIAssistantCommand extends _0x354f99{constructor(e,t){super(e),this._commandDefinitions=t,this.set("enabledCommandsIds",[]),this.on("change:_hasContext",((e,t,n)=>{this.isEnabled&&(this.enabledCommandsIds=_getEnabledCommands(this._commandDefinitions,n))})),this.set("_hasContext",!1),this.on("change:isEnabled",((e,t,n)=>{this.enabledCommandsIds=n?_getEnabledCommands(this._commandDefinitions,this._hasContext):[]}))}refresh(){const e=this.editor.model;this._hasContext=_isContextAvailable(e);const t=e.document.selection,n=this.editor.config.get("ai.aiAssistant.disabledElements");for(const e of t.getRanges())for(const t of e.getItems())if(t.is("element")&&n.includes(t.name))return void(this.isEnabled=!1);this.isEnabled=!0}execute(e="",t="",n="custom"){this.editor.plugins.get(AIAssistantUI).showUI(e,t,n)}}function _isContextAvailable(e){const t=e.document.selection;return t.isCollapsed?0!==[...t.getSelectedBlocks()].length&&![...t.getSelectedBlocks()][0].isEmpty:!!e.hasContent(t.getFirstRange())}function _getEnabledCommands(e,t){const n=new Set;for(const i of e.values())(t||!1===i.requiresContent)&&n.add(i.id);return Array.from(n)}const MIN_RESPONSE_LENGTH_TO_FIRST_HTML=100,ALL_UNTIL_FIRST_HTML_REGEX=new RegExp(/^(.*?)<[a-zA-Z][a-zA-Z0-9_\-.]*[ >]/,"is");class AIAssistantController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n){super(),this.editor=e,this.textAdapter=t,this._sanitizationContainer=document.createElement("div"),this._domParser=new DOMParser,this._xmlSerializer=new XMLSerializer,this.view=n,this.set({initialContext:"",currentContext:"",currentResponse:"",previousContext:void 0,previousQuery:void 0,previousLabel:void 0,isProcessing:!1}),this.on("set:currentContext",((e,t,n)=>{this.view.value=this._sanitizeHTML(n)})),this.listenTo(this.view,"submitPrompt",((e,t)=>{const n=this.currentContext||this.initialContext;this._handleQuery(t,n,"custom")})),this.listenTo(this.view,"tryAgainEvent",(()=>{this.view.prompt=this.previousLabel,this._handleQuery(this.previousQuery,this.previousContext,this.previousActionId,this.previousLabel)})),this.listenTo(this.view,"stopProcessing",(()=>{this.stopProcessing()}))}destroy(){this.stopListening()}async updateView({actionId:e,query:t,htmlContent:n,label:i,mainActionLabel:r}){this.view.prompt=i,this.view.mainAction=r,this.initialContext=n,t&&(this.view.isRendered?this._handleQuery(t,n,e,i):this.view.once("render",(()=>{this._handleQuery(t,n,e,i)})))}stopProcessing(){this.isProcessing&&(this.isProcessing=!1,this.view.finishProcessing(),this.textAdapter.abort())}reset(){this.initialContext="",this.currentContext="",this.currentResponse="",this.previousContext="",this.previousQuery="",this.previousLabel="",this.previousActionId=void 0,this.view.reset(),this.stopProcessing()}async _handleQuery(e,t,n,i){return this.isProcessing=!0,this.view.startProcessing(),this.previousContext=t,this.previousQuery=e,this.previousLabel=i||e,this.previousActionId=n,new Promise((i=>{this.textAdapter.makeRequest({query:e,context:t,onData:e=>{this.currentResponse=e,this.currentContext=this._parseAndNormalizeContent(this.currentResponse)},actionId:n}).then((()=>{!this.currentContext&&this.currentResponse&&(this.currentContext=this._parseAndNormalizeContent(this.currentResponse,!0))})).catch((e=>{e instanceof AIRequestError?this.view.handleError(e.message):this.view.handleError(),i()})).finally((()=>{this.stopProcessing(),i()}))}))}_parseAndNormalizeContent(e,t=!1){const n=ALL_UNTIL_FIRST_HTML_REGEX.exec(e);e=n?e.substring(n[1].length):e.length<MIN_RESPONSE_LENGTH_TO_FIRST_HTML&&!t?"":this._stripMarkdownSyntax(e);const i=this._domParser.parseFromString(e,"text/html");if(n){const e=Array.from(i.body.childNodes);e.reverse();for(const t of e){if(t.nodeType==Node.ELEMENT_NODE)break;t.remove()}}const r=this.editor.data.processor.toView(this._xmlSerializer.serializeToString(i.body));return this._isH1TagSupportEnabled()||this._normalizeResponseHeadings(r),this.editor.data.stringify(this.editor.data.toModel(r))}_normalizeResponseHeadings(e){const t=new UpcastWriter(this.editor.editing.view.document),n=new Matcher({name:/^h[1-5]$/}),i=[];let r=!1;for(const t of e)t.is("element")&&n.match(t)&&(i.push(t),"h1"==t.name&&(r=!0));if(r)for(const e of i)t.rename("h"+(parseInt(e.name[1])+1),e)}_isH1TagSupportEnabled(){const{data:e,editing:t}=this.editor,n=e.htmlProcessor.toView("<h1></h1>"),i=e.toView(e.toModel(n));return!!t.view.domConverter.viewToDom(i).querySelector("h1")}_sanitizeHTML(e){return this.editor.editing.view.domConverter.setContentOf(this._sanitizationContainer,e),this._sanitizationContainer.innerHTML}_stripMarkdownSyntax(e){const t=e.trim();return t.startsWith("```html")?t.endsWith("```")?t.substring(7,t.length-3):t.substring(7):e}}const AIFormToolbarViewMainActionLabel={REPLACE:"replace",INSERT:"insert"};class AIFormToolbarView extends ToolbarView{constructor(e){super(e),this.set("isVisible",!1),this.set("mainAction",AIFormToolbarViewMainActionLabel.REPLACE),this.replaceButton=this._createButton("","ck-button-action"),this.replaceButton.bind("label").to(this,"mainAction",(t=>getTranslation$f(e,"AI_"+t.toUpperCase()+"_CONTENT"))),this.insertButton=this._createButton(getTranslation$f(e,"Insert below")),this.tryAgainButton=this._createButton(getTranslation$f(e,"Try again")),this.stopButton=this._createButton(getTranslation$f(e,"Stop"));const t=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-ai-form__toolbar",t.if("isVisible","ck-hidden",(e=>!e))]}}),this.items.addMany([this.replaceButton,this.insertButton,this.tryAgainButton,this.stopButton])}_createButton(e,t){const n=new ButtonView(this.locale);return n.set({label:e,class:t||"",isVisible:!0,withText:!0}),n}}var copyIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 2.801a.7.7 0 0 0-.7.7v11.5a.8.8 0 0 1-1.6 0v-11.5a2.3 2.3 0 0 1 2.3-2.3h6.5a.8.8 0 0 1 0 1.6H5Zm.7 3.7a2.3 2.3 0 0 1 2.3-2.3h7a2.3 2.3 0 0 1 2.3 2.3v10a2.3 2.3 0 0 1-2.3 2.3H8a2.3 2.3 0 0 1-2.3-2.3v-10Zm2.3-.7a.7.7 0 0 0-.7.7v10a.7.7 0 0 0 .7.7h7a.7.7 0 0 0 .7-.7v-10a.7.7 0 0 0-.7-.7H8Z"/></svg>';class AIFormContentArea extends View{constructor(e,t=""){super(e),this.set({value:null,isVisible:!1,isProcessing:!1});const n=this.bindTemplate;this.contentFieldView=new ContentFieldView(e,t),this.copyButtonView=this._createCopyButton(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__content-area-wrapper",n.if("isVisible","ck-hidden",(e=>!e))],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form__content-area",n.if("isProcessing","ck-ai-form__content-area--processing")]},children:[this.contentFieldView,{tag:"div",attributes:{class:["ck","ck-ai-form__copy-button-wrapper"]},children:[this.copyButtonView]}]}]})}render(){super.render(),this.value&&this.contentFieldView.setContent(this.value);let e=!1;this.on("change:value",((t,n,i)=>{const r=!this.contentFieldView.element.querySelector(".ck-ai-form__loader");this.contentFieldView.setContent(i),this.isProcessing&&r&&!e&&this.element.scrollTo({top:this.element.scrollHeight,behavior:"smooth"})})),this.on("change:isProcessing",((t,n,i)=>{e=!1,i?(this.value=null,this.contentFieldView.appendLoader()):this.value||this.contentFieldView.setContent("")})),this.listenTo(this.element,"wheel",(()=>{e=!0})),this.listenTo(this.element,"mousedown",(()=>{e=!0}))}focus(){this.element.focus()}_createCopyButton(){const e=this.locale,t=new ButtonView(this.locale),n="ck-ai-form__copy-button";return t.set({label:getTranslation$f(e,"Copy"),icon:copyIcon,class:n,tooltip:!0}),t.bind("isVisible").to(this,"value",(e=>!!e)),t.bind("isEnabled").to(this,"isProcessing",(e=>!e)),t.on("execute",(()=>{this._copyHTMLToClipboard(this.contentFieldView.element),t.icon=_0x27b58d.check,t.class=n+" ck-ai-form__copy-button--copied",this.focus(),setTimeout((()=>{t.icon=copyIcon,t.class=n}),1e3)})),t}_copyHTMLToClipboard(e){const{window:t,document:n}=_0x56a4f4;if(t.ClipboardItem){const{Blob:n,ClipboardItem:i}=t,r=[new i({"text/html":new n([e.innerHTML],{type:"text/html"}),"text/plain":new n([e.textContent||""],{type:"text/plain"})})];navigator.clipboard.write(r)}else{const i=n.createElement("div");i.style.position="absolute",i.style.left="-9999px",i.innerHTML="<span>[</span>"+e.innerHTML+"<span>]</span>",n.body.appendChild(i);const r=n.createRange();r.setStartAfter(i.firstElementChild),r.setEndBefore(i.lastElementChild);const s=t.getSelection();s.removeAllRanges(),s.addRange(r),n.execCommand("copy"),i.remove()}}}class ContentFieldView extends View{constructor(e,t=""){super(e),this.loaderView=this._createLoader(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-content",t,"ck-reset_all-excluded","ck-ai-form__content-field"]}})}setContent(e){this.element.innerHTML=e}appendLoader(){this.element.appendChild(this.loaderView.element)}_createLoader(){const e=new View,t=this.locale,n=new SpinnerView;return n.isVisible=!0,e.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__loader"]},children:[n,{text:getTranslation$f(t,"AI is writing...")}]}),e.render(),e}}var errorIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9.9 4.385a1.2 1.2 0 0 0-.44.44h.002l-5.284 9.15a1.2 1.2 0 0 0 1.04 1.8h10.564a1.2 1.2 0 0 0 1.04-1.8l-5.282-9.15a1.2 1.2 0 0 0-1.64-.44Zm.05 8.363a.301.301 0 0 1 .115-.023h.9a.301.301 0 0 1 .3.3v.9a.3.3 0 0 1-.3.3h-.9a.3.3 0 0 1-.3-.3v-.9a.3.3 0 0 1 .185-.277Zm-.185-4.723a.3.3 0 0 1 .3-.3h.9a.3.3 0 0 1 .3.3v3.4a.3.3 0 0 1-.3.3h-.9a.301.301 0 0 1-.3-.3v-3.4Z"/></svg>\n';class AIFormErrorView extends View{constructor(e,t=""){super(e);const n=new IconView,i=this.bindTemplate;this.set("text",t),n.content=errorIcon,this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__error"]},children:[n,{text:i.to("text")}]})}}var submitIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.875 4.419a.75.75 0 0 0-1.5 0v7.25H6.818l2.33-1.955a.75.75 0 0 0-.963-1.15l-3.792 3.182a.75.75 0 0 0-.17.945c.046.11.118.208.21.284l3.788 3.18a.75.75 0 1 0 .965-1.149l-2.19-1.837h7.629c.69 0 1.25-.56 1.25-1.25v-7.5Z"/></svg>';class AIFormPromptView extends AutocompleteView{constructor(e,t){super(e,t),this.queryView.fieldView.minRows=1,this.queryView.fieldView.maxRows=3,this.submitButtonView=this._createSubmitButton(),this.showHistoryButtonView=this._createShowHistoryButton(),this.focusableChildren.add(this.showHistoryButtonView,1),this.focusableChildren.add(this.submitButtonView)}render(){super.render(),this.queryView.fieldWrapperChildren.add(this.showHistoryButtonView),this.children.add(this.submitButtonView),this.keystrokes.set("enter",((e,t)=>{e.target==this.queryView.fieldView.element&&(this.submit(),t())}))}_createSubmitButton(){const e=new ButtonView(this.locale),t=this.locale;return e.set({icon:submitIcon,label:getTranslation$f(t,"Submit"),isVisible:!0,tooltip:!0,class:"ck-ai-form__submit"}),e.on("execute",(()=>{this.submit()})),e.bind("isEnabled").to(this.queryView.fieldView,"isEmpty",this,"isEnabled",((e,t)=>!e&&t)),e}_createShowHistoryButton(){const e=new ButtonView(this.locale),t=this.resultsView,n=this.locale;e.set({label:getTranslation$f(n,"History"),withText:!1,icon:_0x27b58d.history,tooltip:!0,tooltipPosition:"sw",class:"ck-ai-form__toggle-history"}),e.bind("isOn").to(t,"isVisible"),e.bind("isEnabled").to(this,"isEnabled"),e.on("execute",(()=>{t.isVisible=!t.isVisible,t.isVisible?this.filteredView.focus():this.focus()}));const i=()=>{_0x56a4f4.window.requestAnimationFrame((()=>{if(isVisible(this.element)){const t=new Rect(this.queryView.fieldView.element),i=t.width,r="rtl"===n.uiLanguageDirection?"left":"right";t.excludeScrollbarsAndBorders(),e.element.style[r]=i-t.width+1+"px"}}))};return this.queryView.fieldView.on("update",i),this.on("render",i),e}submit(){const e=this.queryView.fieldView.element.value;this.fire("submit",e)}focus(e){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}}class AIHistoryListView extends ListView{constructor(e){super(e),this.clearHistoryButton=this._createClearHistoryButton(),this.historyGroupView=new ListItemGroupView,this.historyGroupView.children.add(this.clearHistoryButton,1),this.historyGroupView.label=getTranslation$f(e,"Prompt history"),this.historyGroupView.items.delegate("execute").to(this),this.items.add(this.historyGroupView)}filter(){let e=0;for(const t of this.items)e+=t.items.length;return{resultsCount:e,totalItemsCount:e}}_createClearHistoryButton(){const e=this.locale,t=new ButtonView(this.locale);return t.set({label:"("+getTranslation$f(e,"Clear")+")",withText:!0}),t.on("execute",(()=>this.fire("clearHistory"))),t}}var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$f=Object.prototype,hasOwnProperty$d=objectProto$f.hasOwnProperty,nativeObjectToString$1=objectProto$f.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty$d.call(e,symToStringTag$1),n=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var i=!0}catch(e){}var r=nativeObjectToString$1.call(e);return i&&(t?e[symToStringTag$1]=n:delete e[symToStringTag$1]),r}var objectProto$e=Object.prototype,nativeObjectToString=objectProto$e.toString;function objectToString(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var symbolTag$3="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag$3}function arrayMap(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}var isArray=Array.isArray,INFINITY$1=1/0,symbolProto$2=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}var reWhitespace=/\s/;function trimmedEndIndex(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var reTrimStart=/^\s+/;function baseTrim(e){return e?e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,""):e}function isObject$1(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject$1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=baseTrim(e);var n=reIsBinary.test(e);return n||reIsOctal.test(e)?freeParseInt(e.slice(2),n?2:8):reIsBadHex.test(e)?NAN:+e}function identity(e){return e}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject$1(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root.$,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource(e){if(null!=e){try{return funcToString$2.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$d=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$c=objectProto$d.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$c).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$1(e)||isMasked(e))&&(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var n=getValue(e,t);return baseIsNative(n)?n:void 0}var WeakMap$1=getNative(root,"WeakMap"),objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function apply(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function copyArray(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,n=0;return function(){var i=nativeNow(),r=HOT_SPAN-(i-n);if(n=i,r>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant(e){return function(){return e}}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),baseSetToString=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,setToString=shortOut(baseSetToString);function arrayEach(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var n=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==n||"symbol"!=n&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,n){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$c=Object.prototype,hasOwnProperty$b=objectProto$c.hasOwnProperty;function assignValue(e,t,n){var i=e[t];hasOwnProperty$b.call(e,t)&&eq(i,n)&&(void 0!==n||t in e)||baseAssignValue(e,t,n)}function copyObject(e,t,n,i){var r=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;void 0===c&&(c=e[a]),r?baseAssignValue(n,a,c):assignValue(n,a,c)}return n}var nativeMax$1=Math.max;function overRest(e,t,n){return t=nativeMax$1(void 0===t?e.length-1:t,0),function(){for(var i=arguments,r=-1,s=nativeMax$1(i.length-t,0),o=Array(s);++r<s;)o[r]=i[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=i[r];return a[t]=n(o),apply(e,this,a)}}var MAX_SAFE_INTEGER=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var objectProto$b=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$b)}function baseTimes(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}var argsTag$3="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$3}var objectProto$a=Object.prototype,hasOwnProperty$a=objectProto$a.hasOwnProperty,propertyIsEnumerable$1=objectProto$a.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$a.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")};function stubFalse(){return!1}var freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$2=moduleExports$2?root.Buffer:void 0,nativeIsBuffer=Buffer$2?Buffer$2.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$4]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$3]=typedArrayTags[weakMapTag$2]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{return freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$9=Object.prototype,hasOwnProperty$9=objectProto$9.hasOwnProperty;function arrayLikeKeys(e,t){var n=isArray(e),i=!n&&isArguments(e),r=!n&&!i&&isBuffer(e),s=!n&&!i&&!r&&isTypedArray(e),o=n||i||r||s,a=o?baseTimes(e.length,String):[],c=a.length;for(var l in e)!t&&!hasOwnProperty$9.call(e,l)||o&&("length"==l||r&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||isIndex(l,c))||a.push(l);return a}function overArg(e,t){return function(n){return e(t(n))}}var nativeKeys=overArg(Object.keys,Object),objectProto$8=Object.prototype,hasOwnProperty$8=objectProto$8.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var n in Object(e))hasOwnProperty$8.call(e,n)&&"constructor"!=n&&t.push(n);return t}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function nativeKeysIn(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var objectProto$7=Object.prototype,hasOwnProperty$7=objectProto$7.hasOwnProperty;function baseKeysIn(e){if(!isObject$1(e))return nativeKeysIn(e);var t=isPrototype(e),n=[];for(var i in e)("constructor"!=i||!t&&hasOwnProperty$7.call(e,i))&&n.push(i);return n}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!isSymbol(e))||reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$6=Object.prototype,hasOwnProperty$6=objectProto$6.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var n=t[e];return n===HASH_UNDEFINED$2?void 0:n}return hasOwnProperty$6.call(t,e)?t[e]:void 0}var objectProto$5=Object.prototype,hasOwnProperty$5=objectProto$5.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$5.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0||(n==t.length-1?t.pop():splice.call(t,n,1),--this.size,0))}function listCacheGet(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var n=this.__data__,i=assocIndexOf(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}function ListCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var n=e.__data__;return isKeyable(t)?n["string"==typeof t?"string":"hash"]:n.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var n=getMapData(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}function MapCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize$1(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$2);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=e.apply(this,i);return n.cache=s.set(r,o)||s,o};return n.cache=new(memoize$1.Cache||MapCache),n}memoize$1.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize$1(e,(function(e){return n.size===MAX_MEMOIZE_SIZE&&n.clear(),e})),n=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,n,i,r){t.push(i?r.replace(reEscapeChar,"$1"):n||e)})),t}));function toString$2(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray(e)?e:isKey(e,t)?[e]:stringToPath(toString$2(e))}var INFINITY=1/0;function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function baseGet(e,t){for(var n=0,i=(t=castPath(t,e)).length;null!=e&&n<i;)e=e[toKey(t[n++])];return n&&n==i?e:void 0}function arrayPush(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,n,i,r){var s=-1,o=e.length;for(n||(n=isFlattenable),r||(r=[]);++s<o;){var a=e[s];n(a)?arrayPush(r,a):r[r.length]=a}return r}function flatten(e){return null!=e&&e.length?baseFlatten(e):[]}function flatRest(e){return setToString(overRest(e,void 0,flatten),e+"")}var getPrototype=overArg(Object.getPrototypeOf,Object),objectTag$3="[object Object]",funcProto=Function.prototype,objectProto$4=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$4.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=objectTag$3)return!1;var t=getPrototype(e);if(null===t)return!0;var n=hasOwnProperty$4.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&funcToString.call(n)==objectCtorString}function baseSlice(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(r);++i<r;)s[i]=e[i+t];return s}function basePropertyOf(e){return function(t){return null==e?void 0:e[t]}}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var n=this.__data__;if(n instanceof ListCache){var i=n.__data__;if(!Map$1||i.length<LARGE_ARRAY_SIZE-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new MapCache(i)}return n.set(e,t),this.size=n.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function baseAssign(e,t){return e&&copyObject(t,keys(t),e)}function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer$1=moduleExports?root.Buffer:void 0,allocUnsafe=Buffer$1?Buffer$1.allocUnsafe:void 0;function cloneBuffer(e,t){if(t)return e.slice();var n=e.length,i=allocUnsafe?allocUnsafe(n):new e.constructor(n);return e.copy(i),i}function arrayFilter(e,t){for(var n=-1,i=null==e?0:e.length,r=0,s=[];++n<i;){var o=e[n];t(o,n,e)&&(s[r++]=o)}return s}function stubArray(){return[]}var objectProto$3=Object.prototype,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable.call(e,t)})))}:stubArray;function copySymbols(e,t){return copyObject(e,getSymbols(e),t)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush(t,getSymbols(e)),e=getPrototype(e);return t}:stubArray;function copySymbolsIn(e,t){return copyObject(e,getSymbolsIn(e),t)}function baseGetAllKeys(e,t,n){var i=t(e);return isArray(e)?i:arrayPush(i,n(e))}function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols)}function getAllKeysIn(e){return baseGetAllKeys(e,keysIn,getSymbolsIn)}var DataView$1=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),mapTag$4="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView$1&&getTag(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$3||Map$1&&getTag(new Map$1)!=mapTag$4||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$4||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),n=t==objectTag$2?e.constructor:void 0,i=n?toSource(n):"";if(i)switch(i){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return t});var objectProto$2=Object.prototype,hasOwnProperty$3=objectProto$2.hasOwnProperty;function initCloneArray(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$3.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Uint8Array$1=root.Uint8Array;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}function cloneDataView(e,t){var n=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray(e,t){var n=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,n){var i=e.constructor;switch(t){case arrayBufferTag$2:return cloneArrayBuffer(e);case boolTag$2:case dateTag$2:return new i(+e);case dataViewTag$2:return cloneDataView(e,n);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,n);case mapTag$3:return new i;case numberTag$2:case stringTag$2:return new i(e);case regexpTag$2:return cloneRegExp(e);case setTag$3:return new i;case symbolTag$2:return cloneSymbol(e)}}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}var mapTag$2="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag(e)==mapTag$2}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$2="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag(e)==setTag$2}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet$1=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,CLONE_DEEP_FLAG$2=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$2=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone(e,t,n,i,r,s){var o,a=t&CLONE_DEEP_FLAG$2,c=t&CLONE_FLAT_FLAG$1,l=t&CLONE_SYMBOLS_FLAG$2;if(n&&(o=r?n(e,i,r,s):n(e)),void 0!==o)return o;if(!isObject$1(e))return e;var d=isArray(e);if(d){if(o=initCloneArray(e),!a)return copyArray(e,o)}else{var u=getTag(e),h=u==funcTag||u==genTag;if(isBuffer(e))return cloneBuffer(e,a);if(u==objectTag$1||u==argsTag$1||h&&!r){if(o=c||h?{}:initCloneObject(e),!a)return c?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[u])return r?e:{};o=initCloneByTag(e,u,a)}}s||(s=new Stack);var m=s.get(e);if(m)return m;s.set(e,o),isSet$1(e)?e.forEach((function(i){o.add(baseClone(i,t,n,i,e,s))})):isMap(e)&&e.forEach((function(i,r){o.set(r,baseClone(i,t,n,r,e,s))}));var g=d?void 0:(l?c?getAllKeysIn:getAllKeys:c?keysIn:keys)(e);return arrayEach(g||e,(function(i,r){g&&(i=e[r=i]),assignValue(o,r,baseClone(i,t,n,r,e,s))})),o}cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$1]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$1]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function arraySome(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG$3=1,COMPARE_UNORDERED_FLAG$1=2;function equalArrays(e,t,n,i,r,s){var o=n&COMPARE_PARTIAL_FLAG$3,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),d=s.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,m=n&COMPARE_UNORDERED_FLAG$1?new SetCache:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var g=e[u],p=t[u];if(i)var f=o?i(p,g,u,t,e,s):i(g,p,u,e,t,s);if(void 0!==f){if(f)continue;h=!1;break}if(m){if(!arraySome(t,(function(e,t){if(!cacheHas(m,t)&&(g===e||r(g,e,n,i,s)))return m.push(t)}))){h=!1;break}}else if(g!==p&&!r(g,p,n,i,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function mapToArray(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var COMPARE_PARTIAL_FLAG$2=1,COMPARE_UNORDERED_FLAG=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,n,i,r,s,o){switch(n){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var a=mapToArray;case setTag:var c=i&COMPARE_PARTIAL_FLAG$2;if(a||(a=setToArray),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;i|=COMPARE_UNORDERED_FLAG,o.set(e,t);var d=equalArrays(a(e),a(t),i,r,s,o);return o.delete(e),d;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var COMPARE_PARTIAL_FLAG$1=1,objectProto$1=Object.prototype,hasOwnProperty$2=objectProto$1.hasOwnProperty;function equalObjects(e,t,n,i,r,s){var o=n&COMPARE_PARTIAL_FLAG$1,a=getAllKeys(e),c=a.length;if(c!=getAllKeys(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:hasOwnProperty$2.call(t,d)))return!1}var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=o;++l<c;){var p=e[d=a[l]],f=t[d];if(i)var y=o?i(f,p,d,t,e,s):i(p,f,d,e,t,s);if(!(void 0===y?p===f||r(p,f,n,i,s):y)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var b=e.constructor,w=t.constructor;b==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w||(m=!1)}return s.delete(e),s.delete(t),m}var COMPARE_PARTIAL_FLAG=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty$1=objectProto.hasOwnProperty;function baseIsEqualDeep(e,t,n,i,r,s){var o=isArray(e),a=isArray(t),c=o?arrayTag:getTag(e),l=a?arrayTag:getTag(t),d=(c=c==argsTag?objectTag:c)==objectTag,u=(l=l==argsTag?objectTag:l)==objectTag,h=c==l;if(h&&isBuffer(e)){if(!isBuffer(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new Stack),o||isTypedArray(e)?equalArrays(e,t,n,i,r,s):equalByTag(e,t,c,n,i,r,s);if(!(n&COMPARE_PARTIAL_FLAG)){var m=d&&hasOwnProperty$1.call(e,"__wrapped__"),g=u&&hasOwnProperty$1.call(t,"__wrapped__");if(m||g){var p=m?e.value():e,f=g?t.value():t;return s||(s=new Stack),r(p,f,n,i,s)}}return!!h&&(s||(s=new Stack),equalObjects(e,t,n,i,r,s))}function baseIsEqual(e,t,n,i,r){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,n,i,baseIsEqual,r))}var now$1=function(){return root.Date.now()},FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(e,t,n){var i,r,s,o,a,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);function m(t){var n=i,s=r;return i=r=void 0,l=t,o=e.apply(s,n)}function g(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=s}function p(){var e,n,i=now$1();if(g(i))return f(i);a=setTimeout(p,(n=t-((e=i)-c),u?nativeMin(n,s-(e-l)):n))}function f(e){return a=void 0,h&&i?m(e):(i=r=void 0,o)}function y(){var e,n=now$1(),s=g(n);if(i=arguments,r=this,c=n,s){if(void 0===a)return l=e=c,a=setTimeout(p,t),d?m(e):o;if(u)return clearTimeout(a),a=setTimeout(p,t),m(c)}return void 0===a&&(a=setTimeout(p,t)),o}return t=toNumber(t)||0,isObject$1(n)&&(d=!!n.leading,s=(u="maxWait"in n)?nativeMax(toNumber(n.maxWait)||0,t):s,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,i=c=r=a=void 0},y.flush=function(){return void 0===a?o:f(now$1())},y}function last(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},escapeHtmlChar=basePropertyOf(htmlEscapes),reUnescapedHtml=/[&<>"']/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);function escape(e){return(e=toString$2(e))&&reHasUnescapedHtml.test(e)?e.replace(reUnescapedHtml,escapeHtmlChar):e}function parent(e,t){return t.length<2?e:baseGet(e,baseSlice(t,0,-1))}function isElement$2(e){return isObjectLike(e)&&1===e.nodeType&&!isPlainObject(e)}function isEqual(e,t){return baseIsEqual(e,t)}function baseUnset(e,t){return null==(e=parent(e,t=castPath(t,e)))||delete e[toKey(last(t))]}function customOmitClone(e){return isPlainObject(e)?void 0:e}var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,omit=flatRest((function(e,t){var n={};if(null==e)return n;var i=!1;t=arrayMap(t,(function(t){return t=castPath(t,e),i||(i=t.length>1),t})),copyObject(e,getAllKeysIn(e),n),i&&(n=baseClone(n,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));for(var r=t.length;r--;)baseUnset(n,t[r]);return n}));function baseSet(e,t,n,i){if(!isObject$1(e))return e;for(var r=-1,s=(t=castPath(t,e)).length,o=s-1,a=e;null!=a&&++r<s;){var c=toKey(t[r]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(r!=o){var d=a[c];void 0===(l=void 0)&&(l=isObject$1(d)?d:isIndex(t[r+1])?[]:{})}assignValue(a,c,l),a=a[c]}return e}function set$1(e,t,n){return null==e?e:baseSet(e,t,n)}var FUNC_ERROR_TEXT="Expected a function";function throttle(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject$1(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),debounce(e,t,{leading:i,maxWait:t,trailing:r})}var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},unescapeHtmlChar=basePropertyOf(htmlUnescapes),reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reHasEscapedHtml=RegExp(reEscapedHtml.source);function unescape$1(e){return(e=toString$2(e))&&reHasEscapedHtml.test(e)?e.replace(reEscapedHtml,unescapeHtmlChar):e}function unset(e,t){return null==e||baseUnset(e,t)}class AIHistoryListItemView extends ListItemView{constructor(e){super();const t=new ButtonLabelView,n=new ButtonView(this.locale,t);this.children.add(n),n.set({label:e.prompt,withText:!0}),n.on("execute",(()=>{this.fire("execute",{value:unescape$1(e.prompt)})}))}}const SESSION_STORAGE_KEY="CKEditor/AIFormView/PromptHistory",MAX_HISTORY_LENGTH=20;class PromptHistory extends Collection{constructor(){super(),this._loadFromSessionStorage(),this.on("add",((e,t)=>{const n=normalizePromptText(t.prompt);for(const e of this)if(e!=t&&normalizePromptText(e.prompt)===n){this.remove(e);break}this.length>MAX_HISTORY_LENGTH&&this.remove(this.last),this._saveToSessionStorage()})),this.on("remove",(()=>{this._saveToSessionStorage()}))}_loadFromSessionStorage(){const e=sessionStorage.getItem(SESSION_STORAGE_KEY)||"[]";this.addMany(JSON.parse(e))}_saveToSessionStorage(){sessionStorage.setItem(SESSION_STORAGE_KEY,JSON.stringify(this.map((e=>e))))}}function normalizePromptText(e){return e.toLowerCase().trim()}class AIFormView extends View{constructor(e,t,n=""){super(e),this.set("isEnabled",!0),this.set("isProcessing",!1),this.set("prompt",""),this.set("value",""),this.set("isError",!1),this.set("mainAction",AIFormToolbarViewMainActionLabel.REPLACE),this._promptHistory=new PromptHistory,this.errorView=new AIFormErrorView(e),this.contentArea=new AIFormContentArea(e,n),this.contentArea.bind("isProcessing").to(this),this.contentArea.bind("value").to(this),this.toolbar=this._createToolbar(),this.toolbar.bind("mainAction").to(this),this.promptView=this._createPromptView(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=this.createCollection([this.contentArea,this.contentArea.copyButtonView,this.toolbar,this.promptView]),this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.focusCycler.chain(this.promptView.focusCycler),this.promptView.queryView.fieldView.bind("value").to(this,"prompt");const i=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form",t],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form-content"]},children:[{tag:"div",attributes:{class:[i.if("isError","ck-hidden",(e=>!e))]},children:[this.errorView]},this.contentArea,this.toolbar,this.promptView]}]})}render(){super.render(),this.focusTracker.add(this.contentArea.element),this.focusTracker.add(this.contentArea.copyButtonView.element),this.focusTracker.add(this.toolbar.element),this.focusTracker.add(this.promptView.element),this.keystrokes.listenTo(this.element)}focus(e=1){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}reset(){this.prompt="",this.value="",this.isError=!1,this.promptView.reset(),this.contentArea.isVisible=!1,this.toolbar.isVisible=!1}_createPromptView(){const e=this.locale,t=new AIFormPromptView(e,{queryView:{label:getTranslation$f(e,"Ask AI to edit or generate"),creator:createLabeledTextarea,showIcon:!1,showResetButton:!1},infoView:{text:{noSearchableItems:{primary:getTranslation$f(e,"Empty history"),secondary:getTranslation$f(e,"Ask AI and your prompts will be listed here for you to use later.")}}},filteredView:this._createHistoryView(),queryMinChars:1/0,resetOnBlur:!1});return t.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",((e,t)=>e&&!t)),this.listenTo(t,"submit",((e,t)=>{this.prompt=t;const n=escape(t);this.fire("submitPrompt",n),t.trim()&&this._promptHistory.add({prompt:n},0)}),{priority:"high"}),t}_createHistoryView(){const e=new AIHistoryListView(this.locale);return e.historyGroupView.items.bindTo(this._promptHistory).as(AIHistoryListItemView),e.on("clearHistory",(()=>{this._promptHistory.clear(),this.promptView.search(""),this.promptView.focus()})),e}_createToolbar(){const e=new AIFormToolbarView(this.locale);return e.replaceButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",((e,t,n)=>e&&!t&&!!n)),e.replaceButton.delegate("execute").to(this,"replaceContent"),e.insertButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",((e,t,n)=>e&&!t&&!!n)),e.insertButton.delegate("execute").to(this,"insertContentBelow"),e.tryAgainButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",((e,t)=>e&&!t)),e.tryAgainButton.delegate("execute").to(this,"tryAgainEvent"),e.stopButton.bind("isEnabled").to(this,"isProcessing"),e.stopButton.delegate("execute").to(this,"stopProcessing"),e}startProcessing(){this.value="",this.isError=!1,this.isProcessing=!0,this.contentArea.isVisible=!0,this.toolbar.isVisible=!0,this.contentArea.focus()}finishProcessing(){const e=this.locale;this.isProcessing=!1,this.prompt="",this.promptView.reset(),this.value&&(this.promptView.queryView.label=getTranslation$f(e,"Ask AI to improve generated text"))}handleError(e){const t=this.locale;this.finishProcessing(),this.isError=!0,this.errorView.text=e||getTranslation$f(t,"AI_ERROR_FAILED"),this.value||(this.contentArea.isVisible=!1)}}var magicWandIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.346 9.422a.151.151 0 0 1 .284 0l.548 1.484a.152.152 0 0 0 .09.089l1.483.549a.151.151 0 0 1 0 .284l-1.483.548a.151.151 0 0 0-.09.09l-.548 1.483a.152.152 0 0 1-.142.1.151.151 0 0 1-.142-.1l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.15.15 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .089-.09l.549-1.483Z"/><path d="M16.306 1.742a.151.151 0 0 1 .284 0l.549 1.483a.15.15 0 0 0 .089.09l1.483.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.15.15 0 0 0-.09.09l-.548 1.482a.151.151 0 0 1-.284 0l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .09-.089l.548-1.483Z"/><path d="M7.665 1.742a.151.151 0 0 1 .284 0l.549 1.483a.151.151 0 0 0 .09.09l1.482.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.151.151 0 0 0-.09.09L7.95 6.267a.151.151 0 0 1-.284 0l-.549-1.483a.151.151 0 0 0-.089-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.483-.549a.151.151 0 0 0 .09-.089l.548-1.483-.001.001Z"/><path d="M14.72 7.946a.848.848 0 0 0 .25-.591.824.824 0 0 0-.241-.588l-1.943-1.938a.812.812 0 0 0-.588-.241.838.838 0 0 0-.591.25l-1.545 1.539 3.115 3.115 1.542-1.546h.001Z"/><path clip-rule="evenodd" d="M1.19 15.636a.96.96 0 0 1 .281-.679l7.835-7.834 3.121 3.12-7.834 7.835a.959.959 0 0 1-1.358 0l-1.764-1.764a.96.96 0 0 1-.28-.678Zm9.22-5.391-1.121-1.12-6.479 6.478 1.121 1.121 6.479-6.479Z"/></svg>';const DomDataTransfer=globalThis.DataTransfer;class AIAssistantUI extends Plugin{static get pluginName(){return"AIAssistantUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[ClipboardMarkersUtils,AIAssistantEditing,AIAdapter,Dialog]}constructor(e){super(e),this._uiCssClasses="",e.config.define("ai.aiAssistant.disabledElements",["media","rawHtml","tableOfContents"]),e.config.define("ai.aiAssistant.contentAreaCssClass",""),e.config.define("ai.useTheme",!0),this._uiCssClasses="ck-ai-assistant-ui"+(e.config.get("ai.useTheme")?" ck-ai-assistant-ui_theme":"")}init(){const{editor:e}=this;this._aiAdapter=e.plugins.get(AIAdapter),this._dialog=e.plugins.get(Dialog),this._formView=null,this._commandDefinitions=this._getResolvedCommandsDefinitions();const t=new ShowAIAssistantCommand(e,Array.from(this._commandDefinitions.values()));e.commands.add("showAIAssistant",t),e.ui.componentFactory.add("aiCommands",(n=>{const i=createDropdown(n);return i.set({class:"ck-ai-commands-dropdown "+this._uiCssClasses}),i.buttonView.set({label:getTranslation$f(n,"AI Commands"),icon:magicWandIcon,tooltip:!0}),i.on("execute",(e=>this._onExecute(e.source.id))),addMenuToDropdown(i,e.ui.view.body,getMenuDropdownDefinition(e),{ariaLabel:getTranslation$f(n,"AI Commands")}),i.menuView.menuPanelClass="ck-ai-commands-dropdown "+this._uiCssClasses,t.on("change:enabledCommandsIds",r),i.menuView.once("render",r),i;function r(){i.isEnabled=t.enabledCommandsIds.length>0;for(const e of i.menuView.buttons)e.isEnabled=t.enabledCommandsIds.includes(e.id)}})),e.ui.componentFactory.add("menuBar:aiCommands",(n=>{const i=new MenuBarMenuView(n);i.buttonView.set({label:getTranslation$f(n,"AI Commands"),icon:magicWandIcon}),i.bind("isEnabled").to(t,"enabledCommandsIds",(e=>e.length>0));const r=normalizeCommandsConfig(e.config.get("ai.aiAssistant.commands"),n);return this._populateMenuBarMenu(t,i,r,(e=>this._onExecute(e))),i})),e.ui.componentFactory.add("aiAssistant",(()=>{const e=this._createAIAssistantUIButton(ButtonView);return e.set({tooltip:!0,class:"ck-ai-assistant-button "+this._uiCssClasses}),e})),e.ui.componentFactory.add("menuBar:aiAssistant",(()=>{const e=this._createAIAssistantUIButton(MenuBarMenuListItemButtonView);return e.set({role:"menuitemcheckbox"}),e})),this.licenseKey=this.editor.config.get("licenseKey");const n=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in n){const i=t,r=n[i];if("aiLicenseKeyValid"==r||"aiLicenseKeyInvalid"==r||"aiLicenseKeyExpired"==r||"aiLicenseKeyDomainLimit"==r||"aiLicenseKeyNotAllowed"==r||"aiLicenseKeyEvaluationLimit"==r||"aiLicenseKeyTrialLimit"==r||"aiLicenseKeyDevelopmentLimit"==r||"aiLicenseKeyUsageLimit"==r){delete n[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"aiLicenseKeyInvalid"==e&&n._showLicenseError("invalid"),"aiLicenseKeyExpired"==e&&n._showLicenseError("expired"),"aiLicenseKeyDomainLimit"==e&&n._showLicenseError("domainLimit"),"aiLicenseKeyNotAllowed"==e&&n._showLicenseError("featureNotAllowed","AIAssistant"),"aiLicenseKeyEvaluationLimit"==e&&n._showLicenseError("evaluationLimit"),"aiLicenseKeyTrialLimit"==e&&n._showLicenseError("trialLimit"),"aiLicenseKeyDevelopmentLimit"==e&&n._showLicenseError("developmentLimit"),"aiLicenseKeyUsageLimit"==e&&n._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}showUI(e="",t="",n="custom"){const i=this.editor,r=i.editing.view,s=i.plugins.get(AIAssistantEditing),o=i.plugins.get(ClipboardMarkersUtils);s.showFakeVisualSelection();const a=new DomDataTransfer,c=new ClipboardEvent("copy",{clipboardData:a}),l=new DataTransfer$1(a),d=new DomEventData(r,c,{dataTransfer:l});o._forceMarkersCopy("comment",(()=>{r.document.fire("copy",d)})),this._formView||(this._initView(),this._aiAssistantController=new AIAssistantController(i,this._aiAdapter.textAdapter,this._formView));let u=l.getData("text/html");const h=i.model.document.selection,m=Array.from(h.getRanges());1===m.length&&m[0].isFlat&&!h.getSelectedElement()&&""!==u.replace(/&nbsp;/g,"").trim()&&(u="<p>"+u+"</p>"),this._aiAssistantController.updateView({actionId:n,query:e,htmlContent:u,label:t,mainActionLabel:AIFormToolbarViewMainActionLabel[i.model.document.selection.isCollapsed?"INSERT":"REPLACE"]}),"aiAssistant"!==this._dialog.id?this._dialog.show({id:"aiAssistant",icon:icons.robotPencil,title:getTranslation$f(this.editor.locale,"AI Assistant"),content:this._formView,position:DialogViewPosition.EDITOR_TOP_SIDE,onShow:()=>{this._formView.focus()},onHide:()=>{this._aiAssistantController.reset(),s.hideFakeVisualSelection()}}):this._dialog.view.wasMoved||this._dialog.view.updatePosition()}hideUI(){this._dialog.hide()}_getResolvedCommandsDefinitions(){const e=new Map,t=normalizeCommandsConfig(this.editor.config.get("ai.aiAssistant.commands"),this.editor.locale);for(const n of t)for(const t of n.commands)e.set(t.id,{...t,groupId:n.groupId,groupLabel:n.groupLabel||n.groupId});return e}_createAIAssistantUIButton(e){const t=this.editor,n=t.commands.get("showAIAssistant"),i=new e(t.locale);return i.set({label:getTranslation$f(t.locale,"AI Assistant"),icon:icons.robotPencil,isToggleable:!0}),i.bind("isEnabled").to(n),i.bind("isOn").to(this._dialog,"id",(e=>"aiAssistant"===e)),this.listenTo(i,"execute",(()=>{i.isOn?this.hideUI():n.execute()})),i}_initView(){const e=this.editor.plugins.get(AIAssistantEditing);this._formView=new AIFormView(this.editor.locale,this._uiCssClasses,this.editor.config.get("ai.aiAssistant.contentAreaCssClass")),this._formView.on("change:value",(()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()})),this._formView.promptView.queryView.fieldView.on("update",(()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()})),this.listenTo(this._formView,"replaceContent",(()=>{e.insertContent(this._aiAssistantController.currentContext),this.hideUI()})),this.listenTo(this._formView,"insertContentBelow",(()=>{e.insertContentBelow(this._aiAssistantController.currentContext),this.hideUI()})),this._initAriaAiStatusChangeAnnouncements()}_initAriaAiStatusChangeAnnouncements(){const{locale:e,ui:{ariaLiveAnnouncer:t}}=this.editor;this._formView.contentArea.on("change:isProcessing",((n,i,r)=>{const s=this._aiAssistantController.currentContext;r?t.announce(getTranslation$f(e,"AI is writing")):s&&t.announce(getTranslation$f(e,"Generated content: %0",s),{politeness:"polite",isUnsafeHTML:!0})})),this._formView.on("change:isError",((n,i,r)=>{if(r){const n=this._formView.errorView.text;t.announce(getTranslation$f(e,"Error during AI content generation: %0",n))}}))}_onExecute(e){const t=this._commandDefinitions.get(e),n=this.editor,i=n.model.document.selection,r=n.commands.get("showAIAssistant"),s=n.plugins.get(AIAssistantEditing),o=(t.groupId!==UNGROUPED_COMMANDS_GROUP_ID?t.groupLabel+": ":"")+t.label;if(!1!==t.requiresContent&&i.isCollapsed){const e=first(i.getSelectedBlocks())||n.model.schema.getLimitElement(i);n.model.change((t=>{t.setSelection(e,"in")}))}s.showFakeVisualSelection(),r.execute(t.prompt,o,"command:"+e)}_populateMenuBarMenu(e,t,n,i){const r=this.editor,s=r.locale,o=new MenuBarMenuListView(s),a=sortDefinitionsByOrder(r,n).filter((e=>e.commands.length));1===a.length?this._getMenuBarGroupButtons({command:e,commands:a[0].commands,parentMenuView:t,onExecute:i}).forEach((e=>o.items.add(e))):a.forEach((({groupId:n,groupLabel:r,commands:a})=>{const c=new MenuBarMenuListItemView(s,t),l=new MenuBarMenuView(s),d=new MenuBarMenuListView(s),u=this._getMenuBarGroupButtons({command:e,commands:a,parentMenuView:l,onExecute:i});l.buttonView.set({label:r||n}),l.delegate("execute").to(t),d.items.addMany(u),l.panelView.children.add(d),c.children.add(l),o.items.add(c)})),t.panelView.children.add(o)}_getMenuBarGroupButtons({command:e,commands:t,parentMenuView:n,onExecute:i}){const r=this.editor,s=r.locale;return sortDefinitionsByOrder(r,t).map((t=>{const r=new MenuBarMenuListItemView(s,n),o=new MenuBarMenuListItemButtonView(s);return o.set({label:t.label}),o.delegate("execute").to(n),o.on("execute",(()=>i(t.id))),o.bind("isEnabled").to(e,"enabledCommandsIds",(e=>e.includes(t.id))),r.children.add(o),r}))}}function getMenuDropdownDefinition(e){const t=normalizeCommandsConfig(e.config.get("ai.aiAssistant.commands"),e.locale),n=sortDefinitionsByOrder(e,t).filter((e=>e.commands.length));return 1===n.length?sortDefinitionsByOrder(e,n[0].commands).map((e=>({id:e.id,label:e.label}))):n.map((t=>{const{groupId:n,groupLabel:i,commands:r}=t;return{id:n,menu:i||n,children:sortDefinitionsByOrder(e,r).map((e=>({id:e.id,label:e.label})))}}))}function sortDefinitionsCallback(e,t){return void 0!==e.order&&void 0===t.order?1:void 0===e.order&&void 0!==t.order?-1:void 0!==e.order&&void 0!==t.order?e.order-t.order:0}function sortDefinitionsByOrder(e,t){t.sort(sortDefinitionsCallback);const n={},i=[];for(const r of t)if(void 0!==r.order){if(r.order in n)throw new CKEditorError("ai-commands-config-order-collision",e,{conflictingDefinitions:[r,n[r.order]]});n[r.order]=r,i.splice(r.order,0,r)}else i.push(r);return i}class AIAssistant extends Plugin{static get requires(){return[AIAssistantUI,AIAssistantEditing]}static get pluginName(){return"AIAssistant"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=e.config,n=e.locale;t.define("ai.aiAssistant.commands",getDefaultCommands(n)),t.define("ai.aiAssistant.extraCommandGroups",[]),t.define("ai.aiAssistant.removeCommands",[]);const i=normalizeCommandsConfig(t.get("ai.aiAssistant.commands"),n),r=t.get("ai.aiAssistant.extraCommandGroups"),s=t.get("ai.aiAssistant.removeCommands");r.forEach((e=>{const t=i.find((t=>t.groupId===e.groupId));t?t.commands=t.commands.concat(e.commands):i.push(e)})),i.forEach((e=>{e.commands=e.commands.filter((e=>!s.includes(e.id)))})),t.set("ai.aiAssistant.commands",i)}}function getDefaultCommands(e){return[{groupId:"editOrReview",groupLabel:getTranslation$f(e,"Edit or review"),commands:[{id:"improveWriting",label:getTranslation$f(e,"Improve writing"),prompt:"Fix spelling mistakes, use proper grammar and apply good writing practices. Do not lose the original meaning."},{id:"makeShorter",label:getTranslation$f(e,"Make shorter"),prompt:"Remove any repetitive, redundant, or non-essential writing in this content without changing the meaning or losing any key information."},{id:"makeLonger",label:getTranslation$f(e,"Make longer"),prompt:"Improve this content by using descriptive language and inserting more information and more detailed explanations."},{id:"simplifyLanguage",label:getTranslation$f(e,"Simplify language"),prompt:"Simplify the writing style of this content and reduce the complexity, so that the content is easy to understand."}]},{groupId:"generate",groupLabel:getTranslation$f(e,"Generate from selection"),commands:[{id:"summarize",label:getTranslation$f(e,"Summarize"),prompt:"Summarize this content into one paragraph of text. Include only the key ideas and conclusions. Keep it short. Do not keep original text formatting."},{id:"continue",label:getTranslation$f(e,"Continue"),prompt:"Start with the provided content and write at the end of it continuing this topic. Keep the added part short."}]},{groupId:"changeTone",groupLabel:getTranslation$f(e,"Change tone"),commands:[{id:"professional",label:getTranslation$f(e,"Professional"),prompt:"Improve using polished, formal, and respectful language to convey professional expertise and competence."},{id:"casual",label:getTranslation$f(e,"Casual"),prompt:"Improve using casual, informal language to convey a casual conversation with a real person."},{id:"direct",label:getTranslation$f(e,"Direct"),prompt:"Improve using direct language, using only the essential information."},{id:"confident",label:getTranslation$f(e,"Confident"),prompt:"Improve using compelling, optimistic language to convey confidence in the writing."},{id:"friendly",label:getTranslation$f(e,"Friendly"),prompt:"Improve using friendly, comforting language, to convey understanding and empathy."}]},{groupId:"changeStyle",groupLabel:getTranslation$f(e,"Change style"),commands:[{id:"business",label:getTranslation$f(e,"Business"),prompt:"Rewrite this content as a business professional with formal language."},{id:"legal",label:getTranslation$f(e,"Legal"),prompt:"Rewrite this content as a legal professional using valid legal terminology."},{id:"journalism",label:getTranslation$f(e,"Journalism"),prompt:"Rewrite this content as a journalist using engaging language to convey the importance of the information."},{id:"poetic",label:getTranslation$f(e,"Poetic"),prompt:"Rewrite this content as a poem using poetic techniques without losing the original meaning."}]},{groupId:"translate",groupLabel:getTranslation$f(e,"Translate"),commands:[{id:"translateEnglish",label:getTranslation$f(e,"English"),prompt:"Translate the content to English language."},{id:"translateSpanish",label:getTranslation$f(e,"Spanish"),prompt:"Translate the content to Spanish language."},{id:"translatePortuguese",label:getTranslation$f(e,"Portuguese"),prompt:"Translate the content to Portuguese language."},{id:"translateGerman",label:getTranslation$f(e,"German"),prompt:"Translate the content to German language."},{id:"translateFrench",label:getTranslation$f(e,"French"),prompt:"Translate the content to French language."},{id:"translateChinese",label:getTranslation$f(e,"Simplified Chinese"),prompt:"Translate the content to Simplified Chinese language."},{id:"translateHindi",label:getTranslation$f(e,"Hindi"),prompt:"Translate the content to Hindi language."},{id:"translateArabic",label:getTranslation$f(e,"Arabic"),prompt:"Translate the content to Arabic language."},{id:"translateIndonesian",label:getTranslation$f(e,"Indonesian"),prompt:"Translate the content to Indonesian language."}]}]}class AITextAdapter extends Plugin{static get requires(){return[AIAdapter]}constructor(e){super(e),this.abortController=new AbortController}init(){this.editor.plugins.get(AIAdapter).textAdapter=this}abort(){this.abortController.signal.aborted||(this.abortController.abort(),this.abortController=new AbortController)}async makeRequest(e){return this.sendRequest(e).catch((e=>{if(e instanceof AIRequestError)return Promise.reject(e);if("AbortError"==e.name)return Promise.resolve();throw console.error(e),new CKEditorError("aitextadapter-send-request-failed",null)}))}async _prepareRequestHeaders(e,t){const n=this.editor.locale,i={"Content-Type":"application/json"};if("object"==typeof e)Object.assign(i,e);else if(e)try{const n=await e(t);Object.assign(i,n)}catch(e){return Promise.reject(new AIRequestError(getTranslation$f(n,"AI_ERROR_GET_HEADERS")))}return i}async _prepareRequestParameters(e,t){const n=this.editor.locale;if("object"==typeof e)return e;try{return await e(t)}catch(e){return Promise.reject(new AIRequestError(getTranslation$f(n,"AI_ERROR_GET_PARAMETERS")))}}}class OpenAITextAdapter extends AITextAdapter{static get pluginName(){return"OpenAITextAdapter"}constructor(e){super(e),e.config.define("ai.openAI.apiUrl",window.location.origin+"/api/convert/chat-ai"),e.config.get("ai.openAI.requestParameters")||e.config.define("ai.openAI.requestParameters",{model:"gpt-4o",max_tokens:4e3,stream:!0,temperature:1}),this._apiUrl=e.config.get("ai.openAI.apiUrl"),this._requestHeaders=e.config.get("ai.openAI.requestHeaders")||{},this._requestParameters=e.config.get("ai.openAI.requestParameters")}async sendRequest({query:e,context:t,onData:n,actionId:i}){const r=this.editor.locale,s=await this.prepareMessages(e,t,i),o=await this._prepareRequestHeaders(this._requestHeaders,i),a=await this._prepareRequestParameters(this._requestParameters,i),c={messages:s,...a},l={method:"POST",headers:o,body:JSON.stringify(c),signal:this.abortController.signal},d=await fetch(this._apiUrl,l);if(d.ok)return a.stream?await this._readStreamableResponse(d,n):await this._readStaticResponse(d,n),Promise.resolve();{const e=await d.text();return e.includes("context_length_exceeded")?Promise.reject(new AIRequestError(getTranslation$f(r,"AI_ERROR_CONTEXT_LENGTH"))):e.includes("Moderation")?Promise.reject(new AIRequestError(getTranslation$f(r,"AI_ERROR_MODERATION"))):Promise.reject(new Error(e))}}async prepareMessages(e,t,n){let i,r;return t?(i="Your task is to execute the instruction using the provided HTML content. Follow the instruction closely. Your answer must be a properly formatted HTML code. Do not add any additional remarks or notes. The main language you use in speaking is Indonesian.",r="Instruction:\n"+e+"\nYou must keep the text formatting.\n\nContent:\n"+t):(i="Your task is to generate HTML content accordingly to the given instruction. Your answer must be a well-structured and properly formatted HTML code. Answer only with the generated HTML content. Do not add any additional remarks or notes. The main language you use in speaking is Indonesian.",r=e),[{role:"system",content:i},{role:"user",content:r}]}async _readStreamableResponse(e,t){const n=e.body.getReader(),i=new TextDecoder;let r="",s="",o="",a=!1;for(;!a;){const{done:e,value:c}=await n.read(),l=r+i.decode(c);let d="";a=e;try{d=this._cleanUpData(l),r=""}catch(e){r=l;continue}s+=d,!a&&this._isBufferIncomplete(s)||s&&(o+=s,s="",t(o))}return Promise.resolve()}async _readStaticResponse(e,t){return t((await e.json()).choices[0].message.content),Promise.resolve()}_isBufferIncomplete(e){const t=e.split("<").length!==e.split(">").length,n=e.length<30;return t&&n}_cleanUpData(e){return e.split(/\n(?![^{]*\})/g).map((e=>e.replace("data: ",""))).filter((e=>e&&e.length>0&&"[DONE]"!==e)).map((e=>{const{choices:t}=JSON.parse(e);if(t[0]&&t[0].delta&&t[0].delta.content)return t[0].delta.content})).filter((e=>e)).join("")}}const getHttpHandlerExtensionConfiguration=e=>{let t=e.httpHandler;return{setHttpHandler(e){t=e},httpHandler:()=>t,updateHttpClientConfig(e,n){t.updateHttpClientConfig(e,n)},httpHandlerConfigs:()=>t.httpHandlerConfigs()}},resolveHttpHandlerRuntimeConfig=e=>({httpHandler:e.httpHandler()});var HttpAuthLocation,HttpApiKeyAuthLocation,EndpointURLScheme,AlgorithmId,FieldPosition;!function(e){e.HEADER="header",e.QUERY="query"}(HttpAuthLocation||(HttpAuthLocation={})),function(e){e.HEADER="header",e.QUERY="query"}(HttpApiKeyAuthLocation||(HttpApiKeyAuthLocation={})),function(e){e.HTTP="http",e.HTTPS="https"}(EndpointURLScheme||(EndpointURLScheme={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(AlgorithmId||(AlgorithmId={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(FieldPosition||(FieldPosition={}));const SMITHY_CONTEXT_KEY="__smithy_context";var IniSectionType,RequestHandlerProtocol;!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(IniSectionType||(IniSectionType={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(RequestHandlerProtocol||(RequestHandlerProtocol={}));class HttpRequest{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?e.protocol+":":e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?"/"+e.path:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const t=new HttpRequest({...e,headers:{...e.headers}});return t.query&&(t.query=cloneQuery(t.query)),t}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){return HttpRequest.clone(this)}}function cloneQuery(e){return Object.keys(e).reduce(((t,n)=>{const i=e[n];return{...t,[n]:Array.isArray(i)?[...i]:i}}),{})}class HttpResponse{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}function resolveHostHeaderConfig(e){return e}const hostHeaderMiddleware=e=>t=>async n=>{if(!HttpRequest.isInstance(n.request))return t(n);const{request:i}=n,{handlerProtocol:r=""}=e.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!i.headers[":authority"])delete i.headers.host,i.headers[":authority"]=i.hostname+(i.port?":"+i.port:"");else if(!i.headers.host){let e=i.hostname;null!=i.port&&(e+=":"+i.port),i.headers.host=e}return t(n)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=e=>({applyToStack:t=>{t.add(hostHeaderMiddleware(e),hostHeaderMiddlewareOptions)}}),loggerMiddleware=()=>(e,t)=>async n=>{try{const i=await e(n),{clientName:r,commandName:s,logger:o,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:l}=a,d=c??t.inputFilterSensitiveLog,u=l??t.outputFilterSensitiveLog,{$metadata:h,...m}=i.output;return o?.info?.({clientName:r,commandName:s,input:d(n.input),output:u(m),metadata:h}),i}catch(e){const{clientName:i,commandName:r,logger:s,dynamoDbDocumentClientOptions:o={}}=t,{overrideInputFilterSensitiveLog:a}=o,c=a??t.inputFilterSensitiveLog;throw s?.error?.({clientName:i,commandName:r,input:c(n.input),error:e,metadata:e.$metadata}),e}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=e=>({applyToStack:e=>{e.add(loggerMiddleware(),loggerMiddlewareOptions)}}),TRACE_ID_HEADER_NAME="X-Amzn-Trace-Id",ENV_LAMBDA_FUNCTION_NAME="AWS_LAMBDA_FUNCTION_NAME",ENV_TRACE_ID="_X_AMZN_TRACE_ID",recursionDetectionMiddleware=e=>t=>async n=>{const{request:i}=n;if(!HttpRequest.isInstance(i)||"node"!==e.runtime||i.headers.hasOwnProperty(TRACE_ID_HEADER_NAME))return t(n);const r=process.env[ENV_LAMBDA_FUNCTION_NAME],s=process.env[ENV_TRACE_ID],o=e=>"string"==typeof e&&e.length>0;return o(r)&&o(s)&&(i.headers[TRACE_ID_HEADER_NAME]=s),t({...n,request:i})},addRecursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},getRecursionDetectionPlugin=e=>({applyToStack:t=>{t.add(recursionDetectionMiddleware(e),addRecursionDetectionMiddlewareOptions)}});function resolveUserAgentConfig(e){return{...e,customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent}}const IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=e=>IP_V4_REGEX.test(e)||e.startsWith("[")&&e.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(e,t=!1)=>{if(!t)return VALID_HOST_LABEL_REGEX.test(e);const n=e.split(".");for(const e of n)if(!isValidHostLabel(e))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(e){return"object"!=typeof e||null==e?e:"ref"in e?"$"+toDebugString(e.ref):"fn"in e?e.fn+"("+(e.argv||[]).map(toDebugString).join(", ")+")":JSON.stringify(e,null,2)}class EndpointError extends Error{constructor(e){super(e),this.name="EndpointError"}}const booleanEquals=(e,t)=>e===t,getAttrPathList=e=>{const t=e.split("."),n=[];for(const i of t){const t=i.indexOf("[");if(-1!==t){if(i.indexOf("]")!==i.length-1)throw new EndpointError("Path: '"+e+"' does not end with ']'");const r=i.slice(t+1,-1);if(Number.isNaN(parseInt(r)))throw new EndpointError("Invalid array index: '"+r+"' in path: '"+e+"'");0!==t&&n.push(i.slice(0,t)),n.push(r)}else n.push(i)}return n},getAttr=(e,t)=>getAttrPathList(t).reduce(((n,i)=>{if("object"!=typeof n)throw new EndpointError("Index '"+i+"' in '"+t+"' not found in '"+JSON.stringify(e)+"'");return Array.isArray(n)?n[parseInt(i)]:n[i]}),e),isSet=e=>null!=e,not=e=>!e,DEFAULT_PORTS={[EndpointURLScheme.HTTP]:80,[EndpointURLScheme.HTTPS]:443},parseURL=e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:n,protocol:i="",path:r="",query:s={}}=e,o=new URL(i+"//"+t+(n?":"+n:"")+r);return o.search=Object.entries(s).map((([e,t])=>e+"="+t)).join("&"),o}return new URL(e)}catch(e){return null}})();if(!t)return console.error("Unable to parse "+JSON.stringify(e)+" as a whatwg URL."),null;const n=t.href,{host:i,hostname:r,pathname:s,protocol:o,search:a}=t;if(a)return null;const c=o.slice(0,-1);if(!Object.values(EndpointURLScheme).includes(c))return null;const l=isIpAddress(r);return{scheme:c,authority:i+(n.includes(i+":"+DEFAULT_PORTS[c])||"string"==typeof e&&e.includes(i+":"+DEFAULT_PORTS[c])?":"+DEFAULT_PORTS[c]:""),path:s,normalizedPath:s.endsWith("/")?s:s+"/",isIp:l}},stringEquals=(e,t)=>e===t,substring=(e,t,n,i)=>t>=n||e.length<n?null:i?e.substring(e.length-n,e.length-t):e.substring(t,n),uriEncode=e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())),endpointFunctions={booleanEquals:booleanEquals,getAttr:getAttr,isSet:isSet,isValidHostLabel:isValidHostLabel,not:not,parseURL:parseURL,stringEquals:stringEquals,substring:substring,uriEncode:uriEncode},evaluateTemplate=(e,t)=>{const n=[],i={...t.endpointParams,...t.referenceRecord};let r=0;for(;r<e.length;){const t=e.indexOf("{",r);if(-1===t){n.push(e.slice(r));break}n.push(e.slice(r,t));const s=e.indexOf("}",t);if(-1===s){n.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[s+1]&&(n.push(e.slice(t+1,s)),r=s+2);const o=e.substring(t+1,s);if(o.includes("#")){const[e,t]=o.split("#");n.push(getAttr(i[e],t))}else n.push(i[o]);r=s+1}return n.join("")},getReferenceValue=({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]),evaluateExpression=(e,t,n)=>{if("string"==typeof e)return evaluateTemplate(e,n);if(e.fn)return callFunction(e,n);if(e.ref)return getReferenceValue(e,n);throw new EndpointError("'"+t+"': "+String(e)+" is not a string, function or reference.")},callFunction=({fn:e,argv:t},n)=>{const i=t.map((e=>["boolean","number"].includes(typeof e)?e:evaluateExpression(e,"arg",n))),r=e.split(".");return r[0]in customEndpointFunctions&&null!=r[1]?customEndpointFunctions[r[0]][r[1]](...i):endpointFunctions[e](...i)},evaluateCondition=({assign:e,...t},n)=>{if(e&&e in n.referenceRecord)throw new EndpointError("'"+e+"' is already defined in Reference Record.");const i=callFunction(t,n);return n.logger?.debug?.(debugId+" evaluateCondition: "+toDebugString(t)+" = "+toDebugString(i)),{result:""===i||!!i,...null!=e&&{toAssign:{name:e,value:i}}}},evaluateConditions=(e=[],t)=>{const n={};for(const i of e){const{result:e,toAssign:r}=evaluateCondition(i,{...t,referenceRecord:{...t.referenceRecord,...n}});if(!e)return{result:e};r&&(n[r.name]=r.value,t.logger?.debug?.(debugId+" assign: "+r.name+" := "+toDebugString(r.value)))}return{result:!0,referenceRecord:n}},getEndpointHeaders=(e,t)=>Object.entries(e).reduce(((e,[n,i])=>({...e,[n]:i.map((e=>{const i=evaluateExpression(e,"Header value entry",t);if("string"!=typeof i)throw new EndpointError("Header '"+n+"' value '"+i+"' is not a string");return i}))})),{}),getEndpointProperty=(e,t)=>{if(Array.isArray(e))return e.map((e=>getEndpointProperty(e,t)));switch(typeof e){case"string":return evaluateTemplate(e,t);case"object":if(null===e)throw new EndpointError("Unexpected endpoint property: "+e);return getEndpointProperties(e,t);case"boolean":return e;default:throw new EndpointError("Unexpected endpoint property type: "+typeof e)}},getEndpointProperties=(e,t)=>Object.entries(e).reduce(((e,[n,i])=>({...e,[n]:getEndpointProperty(i,t)})),{}),getEndpointUrl=(e,t)=>{const n=evaluateExpression(e,"Endpoint URL",t);if("string"==typeof n)try{return new URL(n)}catch(e){throw console.error("Failed to construct URL with "+n,e),e}throw new EndpointError("Endpoint URL must be a string, got "+typeof n)},evaluateEndpointRule=(e,t)=>{const{conditions:n,endpoint:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(!r)return;const o={...t,referenceRecord:{...t.referenceRecord,...s}},{url:a,properties:c,headers:l}=i;return t.logger?.debug?.(debugId+" Resolving endpoint from template: "+toDebugString(i)),{...null!=l&&{headers:getEndpointHeaders(l,o)},...null!=c&&{properties:getEndpointProperties(c,o)},url:getEndpointUrl(a,o)}},evaluateErrorRule=(e,t)=>{const{conditions:n,error:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(r)throw new EndpointError(evaluateExpression(i,"Error",{...t,referenceRecord:{...t.referenceRecord,...s}}))},evaluateTreeRule=(e,t)=>{const{conditions:n,rules:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(r)return evaluateRules(i,{...t,referenceRecord:{...t.referenceRecord,...s}})},evaluateRules=(e,t)=>{for(const n of e)if("endpoint"===n.type){const e=evaluateEndpointRule(n,t);if(e)return e}else if("error"===n.type)evaluateErrorRule(n,t);else{if("tree"!==n.type)throw new EndpointError("Unknown endpoint rule: "+n);{const e=evaluateTreeRule(n,t);if(e)return e}}throw new EndpointError("Rules evaluation failed")},resolveEndpoint=(e,t)=>{const{endpointParams:n,logger:i}=t,{parameters:r,rules:s}=e;t.logger?.debug?.(debugId+" Initial EndpointParams: "+toDebugString(n));const o=Object.entries(r).filter((([,e])=>null!=e.default)).map((([e,t])=>[e,t.default]));if(o.length>0)for(const[e,t]of o)n[e]=n[e]??t;const a=Object.entries(r).filter((([,e])=>e.required)).map((([e])=>e));for(const e of a)if(null==n[e])throw new EndpointError("Missing required parameter: '"+e+"'");const c=evaluateRules(s,{endpointParams:n,logger:i,referenceRecord:{}});return t.logger?.debug?.(debugId+" Resolved endpoint: "+toDebugString(c)),c},isVirtualHostableS3Bucket=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!isVirtualHostableS3Bucket(t))return!1;return!0}return!(!isValidHostLabel(e)||e.length<3||e.length>63||e!==e.toLowerCase()||isIpAddress(e))},parseArn=e=>{const t=e.split(":");if(t.length<6)return null;const[n,i,r,s,o,...a]=t;return"arn"!==n||""===i||""===r||""===a[0]?null:{partition:i,service:r,region:s,accountId:o,resourceId:a[0].includes("/")?a[0].split("/"):a}};var partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],version$1="1.1",partitionsInfo={partitions:partitions,version:version$1};let selectedPartitionsInfo=partitionsInfo;const partition=e=>{const{partitions:t}=selectedPartitionsInfo;for(const n of t){const{regions:t,outputs:i}=n;for(const[n,r]of Object.entries(t))if(n===e)return{...i,...r}}for(const n of t){const{regionRegex:t,outputs:i}=n;if(new RegExp(t).test(e))return{...i}}const n=t.find((e=>"aws"===e.id));if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}},awsEndpointFunctions={isVirtualHostableS3Bucket:isVirtualHostableS3Bucket,parseArn:parseArn,partition:partition};customEndpointFunctions.aws=awsEndpointFunctions;const USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,UA_VALUE_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,UA_ESCAPE_CHAR="-",userAgentMiddleware=e=>(t,n)=>async i=>{const{request:r}=i;if(!HttpRequest.isInstance(r))return t(i);const{headers:s}=r,o=n?.userAgent?.map(escapeUserAgent)||[],a=(await e.defaultUserAgentProvider()).map(escapeUserAgent),c=e?.customUserAgent?.map(escapeUserAgent)||[],l=[].concat([...a,...o,...c]).join(SPACE),d=[...a.filter((e=>e.startsWith("aws-sdk-"))),...c].join(SPACE);return"browser"!==e.runtime?(d&&(s[X_AMZ_USER_AGENT]=s[X_AMZ_USER_AGENT]?s[USER_AGENT]+" "+d:d),s[USER_AGENT]=l):s[X_AMZ_USER_AGENT]=l,t({...i,request:r})},escapeUserAgent=e=>{const t=e[0].split(UA_NAME_SEPARATOR).map((e=>e.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR))).join(UA_NAME_SEPARATOR),n=e[1]?.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),i=t.indexOf(UA_NAME_SEPARATOR),r=t.substring(0,i);let s=t.substring(i+1);return"api"===r&&(s=s.toLowerCase()),[r,s,n].filter((e=>e&&e.length>0)).reduce(((e,t,n)=>{switch(n){case 0:return t;case 1:return e+"/"+t;default:return e+"#"+t}}),"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=e=>({applyToStack:t=>{t.add(userAgentMiddleware(e),getUserAgentMiddlewareOptions)}});var SelectorType;!function(e){e.ENV="env",e.CONFIG="shared config entry"}(SelectorType||(SelectorType={}));const DEFAULT_USE_DUALSTACK_ENDPOINT=!1,DEFAULT_USE_FIPS_ENDPOINT=!1,getSmithyContext=e=>e[SMITHY_CONTEXT_KEY]||(e[SMITHY_CONTEXT_KEY]={}),normalizeProvider$1=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},isFipsRegion=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),getRealRegion=e=>isFipsRegion(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,resolveRegionConfig=e=>{const{region:t,useFipsEndpoint:n}=e;if(!t)throw new Error("Region is missing");return{...e,region:async()=>{if("string"==typeof t)return getRealRegion(t);const e=await t();return getRealRegion(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!isFipsRegion(e)||("function"!=typeof n?Promise.resolve(!!n):n())}}};function convertHttpAuthSchemesToMap(e){const t=new Map;for(const n of e)t.set(n.schemeId,n);return t}const httpAuthSchemeMiddleware=(e,t)=>(n,i)=>async r=>{const s=e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,i,r.input)),o=convertHttpAuthSchemesToMap(e.httpAuthSchemes),a=getSmithyContext(i),c=[];for(const n of s){const r=o.get(n.schemeId);if(!r){c.push("HttpAuthScheme `"+n.schemeId+"` was not enabled for this service.");continue}const s=r.identityProvider(await t.identityProviderConfigProvider(e));if(!s){c.push("HttpAuthScheme `"+n.schemeId+"` did not have an IdentityProvider configured.");continue}const{identityProperties:l={},signingProperties:d={}}=n.propertiesExtractor?.(e,i)||{};n.identityProperties=Object.assign(n.identityProperties||{},l),n.signingProperties=Object.assign(n.signingProperties||{},d),a.selectedHttpAuthScheme={httpAuthOption:n,identity:await s(n.identityProperties),signer:r.signer};break}if(!a.selectedHttpAuthScheme)throw new Error(c.join("\n"));return n(r)},httpAuthSchemeEndpointRuleSetMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},getHttpAuthSchemeEndpointRuleSetPlugin=(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n})=>({applyToStack:i=>{i.addRelativeTo(httpAuthSchemeMiddleware(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n}),httpAuthSchemeEndpointRuleSetMiddlewareOptions)}}),deserializerMiddleware=(e,t)=>n=>async i=>{const{response:r}=await n(i);try{return{response:r,output:await t(r,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:r}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";e.message+="\n  "+t,void 0!==e.$responseBodyText&&e.$response&&(e.$response.body=e.$responseBodyText)}throw e}},serializerMiddleware=(e,t)=>(n,i)=>async r=>{const s=i.endpointV2?.url&&e.urlParser?async()=>e.urlParser(i.endpointV2.url):e.endpoint;if(!s)throw new Error("No valid endpoint provider available.");const o=await t(r.input,{...e,endpoint:s});return n({...r,request:o})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSerdePlugin(e,t,n){return{applyToStack:i=>{i.add(deserializerMiddleware(e,n),deserializerMiddlewareOption),i.add(serializerMiddleware(e,t),serializerMiddlewareOption)}}}serializerMiddlewareOption.name;const defaultErrorHandler=e=>e=>{throw e},defaultSuccessHandler=(e,t)=>{},httpSigningMiddleware=e=>(e,t)=>async n=>{if(!HttpRequest.isInstance(n.request))return e(n);const i=getSmithyContext(t).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:r={}},identity:s,signer:o}=i,a=await e({...n,request:await o.sign(n.request,s,r)}).catch((o.errorHandler||defaultErrorHandler)(r));return(o.successHandler||defaultSuccessHandler)(a.response,r),a},httpSigningMiddlewareOptions={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},getHttpSigningPlugin=e=>({applyToStack:e=>{e.addRelativeTo(httpSigningMiddleware(),httpSigningMiddlewareOptions)}}),normalizeProvider=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},alphabetByEncoding={},alphabetByValue=new Array(64);for(let e=0,t="A".charCodeAt(0),n="Z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t);alphabetByEncoding[n]=e,alphabetByValue[e]=n}for(let e=0,t="a".charCodeAt(0),n="z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t),i=e+26;alphabetByEncoding[n]=i,alphabetByValue[i]=n}for(let e=0;e<10;e++){alphabetByEncoding[e.toString(10)]=e+52;const t=e.toString(10),n=e+52;alphabetByEncoding[t]=n,alphabetByValue[n]=t}alphabetByEncoding["+"]=62,alphabetByValue[62]="+",alphabetByEncoding["/"]=63,alphabetByValue[63]="/";const bitsPerLetter=6,bitsPerByte=8,maxLetterValue=63,fromBase64=e=>{let t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;const n=new ArrayBuffer(t),i=new DataView(n);for(let t=0;t<e.length;t+=4){let n=0,r=0;for(let i=t,s=t+3;i<=s;i++)if("="!==e[i]){if(!(e[i]in alphabetByEncoding))throw new TypeError("Invalid character "+e[i]+" in base64 string.");n|=alphabetByEncoding[e[i]]<<(s-i)*bitsPerLetter,r+=bitsPerLetter}else n>>=bitsPerLetter;const s=t/4*3;n>>=r%bitsPerByte;const o=Math.floor(r/bitsPerByte);for(let e=0;e<o;e++){const t=(o-e-1)*bitsPerByte;i.setUint8(s+e,(n&255<<t)>>t)}}return new Uint8Array(n)},fromUtf8$2=e=>(new TextEncoder).encode(e),toUint8Array=e=>"string"==typeof e?fromUtf8$2(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),toUtf8=e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};function toBase64(e){let t;t="string"==typeof e?fromUtf8$2(e):e;const n="object"==typeof t&&"number"==typeof t.length,i="object"==typeof t&&"number"==typeof t.byteOffset&&"number"==typeof t.byteLength;if(!n&&!i)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let r="";for(let e=0;e<t.length;e+=3){let n=0,i=0;for(let r=e,s=Math.min(e+3,t.length);r<s;r++)n|=t[r]<<(s-r-1)*bitsPerByte,i+=bitsPerByte;const s=Math.ceil(i/bitsPerLetter);n<<=s*bitsPerLetter-i;for(let e=1;e<=s;e++){const t=(s-e)*bitsPerLetter;r+=alphabetByValue[(n&maxLetterValue<<t)>>t]}r+="==".slice(0,4-s)}return r}function transformToString(e,t="utf-8"){return"base64"===t?toBase64(e):toUtf8(e)}function transformFromString(e,t){return"base64"===t?Uint8ArrayBlobAdapter.mutate(fromBase64(e)):Uint8ArrayBlobAdapter.mutate(fromUtf8$2(e))}class Uint8ArrayBlobAdapter extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return transformFromString(e,t);throw new Error("Unsupported conversion from "+typeof e+" to Uint8ArrayBlobAdapter.")}static mutate(e){return Object.setPrototypeOf(e,Uint8ArrayBlobAdapter.prototype),e}transformToString(e="utf-8"){return transformToString(this,e)}}const escapeUri=e=>encodeURIComponent(e).replace(/[!'()*]/g,hexEncode),hexEncode=e=>"%"+e.charCodeAt(0).toString(16).toUpperCase();function buildQueryString(e){const t=[];for(let n of Object.keys(e).sort()){const i=e[n];if(n=escapeUri(n),Array.isArray(i))for(let e=0,r=i.length;e<r;e++)t.push(n+"="+escapeUri(i[e]));else{let e=n;(i||"string"==typeof i)&&(e+="="+escapeUri(i)),t.push(e)}}return t.join("&")}const SHORT_TO_HEX={},HEX_TO_SHORT={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t="0"+t),SHORT_TO_HEX[e]=t,HEX_TO_SHORT[t]=e}function fromHex(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const i=e.slice(n,n+2).toLowerCase();if(!(i in HEX_TO_SHORT))throw new Error("Cannot decode unrecognized sequence "+i+" as hexadecimal");t[n/2]=HEX_TO_SHORT[i]}return t}function toHex(e){let t="";for(let n=0;n<e.byteLength;n++)t+=SHORT_TO_HEX[e[n]];return t}const collectBody=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Uint8ArrayBlobAdapter.mutate(e);if(!e)return Uint8ArrayBlobAdapter.mutate(new Uint8Array);const n=t.streamCollector(e);return Uint8ArrayBlobAdapter.mutate(await n)};function extendedEncodeURIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}const resolvedPath=(e,t,n,i,r,s)=>{if(null==t||void 0===t[n])throw new Error("No value provided for input HTTP label: "+n+".");{const t=i();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");e=e.replace(r,s?t.split("/").map((e=>extendedEncodeURIComponent(e))).join("/"):extendedEncodeURIComponent(t))}return e};function requestBuilder(e,t){return new RequestBuilder(e,t)}class RequestBuilder{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:t="https",port:n,path:i}=await this.context.endpoint();this.path=i;for(const e of this.resolvePathStack)e(this.path);return new HttpRequest({protocol:t,hostname:this.hostname||e,port:n,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push((t=>{this.path=""+(t?.endsWith("/")?t.slice(0,-1):t||"")+e})),this}p(e,t,n,i){return this.resolvePathStack.push((r=>{this.path=resolvedPath(r,this.input,e,t,n,i)})),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}function setFeature(e,t,n){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=n}class DefaultIdentityProviderConfig{constructor(e){this.authSchemes=new Map;for(const[t,n]of Object.entries(e))void 0!==n&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}}const createIsIdentityExpiredFunction=e=>t=>doesIdentityRequireRefresh(t)&&t.expiration.getTime()-Date.now()<e,EXPIRATION_MS=3e5,isIdentityExpired=createIsIdentityExpiredFunction(EXPIRATION_MS),doesIdentityRequireRefresh=e=>void 0!==e.expiration,memoizeIdentityProvider=(e,t,n)=>{if(void 0===e)return;const i="function"!=typeof e?async()=>Promise.resolve(e):e;let r,s,o,a=!1;const c=async e=>{s||(s=i(e));try{r=await s,o=!0,a=!1}finally{s=void 0}return r};return void 0===t?async e=>(o&&!e?.forceRefresh||(r=await c(e)),r):async e=>(o&&!e?.forceRefresh||(r=await c(e)),a?r:n(r)?t(r)?(await c(e),r):r:(a=!0,r))},resolveEventStreamSerdeConfig=e=>({...e,eventStreamMarshaller:e.eventStreamSerdeProvider(e)}),CONTENT_LENGTH_HEADER="content-length";function contentLengthMiddleware(e){return t=>async n=>{const i=n.request;if(HttpRequest.isInstance(i)){const{body:t,headers:n}=i;if(t&&-1===Object.keys(n).map((e=>e.toLowerCase())).indexOf(CONTENT_LENGTH_HEADER))try{const n=e(t);i.headers={...i.headers,[CONTENT_LENGTH_HEADER]:String(n)}}catch(e){}}return t({...n,request:i})}}const contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=e=>({applyToStack:t=>{t.add(contentLengthMiddleware(e.bodyLengthChecker),contentLengthMiddlewareOptions)}}),resolveParamsForS3=async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),isArnBucketName(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!isDnsCompatibleBucketName(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=e=>DOMAIN_PATTERN.test(e)&&!IP_ADDRESS_PATTERN.test(e)&&!DOTS_PATTERN.test(e),isArnBucketName=e=>{const[t,n,i,,,r]=e.split(":"),s="arn"===t&&e.split(":").length>=6,o=Boolean(s&&n&&i&&r);if(s&&!o)throw new Error("Invalid ARN: "+e+" was an invalid ARN.");return o},createConfigValueProvider=(e,t,n)=>{const i=async()=>{const i=n[e]??n[t];return"function"==typeof i?i():i};return"credentialScope"===e||"CredentialScope"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.credentialScope??e?.CredentialScope}:"accountId"===e||"AccountId"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.accountId??e?.AccountId}:"endpoint"===e||"endpoint"===t?async()=>{const e=await i();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:n,port:i,path:r}=e;return t+"//"+n+(i?":"+i:"")+r}}return e}:i},getEndpointFromConfig=async e=>{};function parseQueryString(e){const t={};if(e=e.replace(/^\?/,""))for(const n of e.split("&")){let[e,i=null]=n.split("=");e=decodeURIComponent(e),i&&(i=decodeURIComponent(i)),e in t?Array.isArray(t[e])?t[e].push(i):t[e]=[t[e],i]:t[e]=i}return t}const parseUrl=e=>{if("string"==typeof e)return parseUrl(new URL(e));const{hostname:t,pathname:n,port:i,protocol:r,search:s}=e;let o;return s&&(o=parseQueryString(s)),{hostname:t,port:i?parseInt(i):void 0,protocol:r,path:n,query:o}},toEndpointV1=e=>"object"==typeof e?"url"in e?parseUrl(e.url):e:parseUrl(e),getEndpointFromInstructions=async(e,t,n,i)=>{if(!n.endpoint){let e;e=n.serviceConfiguredEndpoint?await n.serviceConfiguredEndpoint():await getEndpointFromConfig(n.serviceId),e&&(n.endpoint=()=>Promise.resolve(toEndpointV1(e)))}const r=await resolveParams(e,t,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(r,i)},resolveParams=async(e,t,n)=>{const i={},r=t?.getEndpointParameterInstructions?.()||{};for(const[t,s]of Object.entries(r))switch(s.type){case"staticContextParams":i[t]=s.value;break;case"contextParams":i[t]=e[s.name];break;case"clientContextParams":case"builtInParams":i[t]=await createConfigValueProvider(s.name,t,n)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return 0===Object.keys(r).length&&Object.assign(i,n),"s3"===String(n.serviceId).toLowerCase()&&await resolveParamsForS3(i),i},endpointMiddleware=({config:e,instructions:t})=>(n,i)=>async r=>{e.endpoint&&setFeature(i,"ENDPOINT_OVERRIDE","N");const s=await getEndpointFromInstructions(r.input,{getEndpointParameterInstructions:()=>t},{...e},i);i.endpointV2=s,i.authSchemes=s.properties?.authSchemes;const o=i.authSchemes?.[0];if(o){i.signing_region=o.signingRegion,i.signing_service=o.signingName;const e=getSmithyContext(i),t=e?.selectedHttpAuthScheme?.httpAuthOption;t&&(t.signingProperties=Object.assign(t.signingProperties||{},{signing_region:o.signingRegion,signingRegion:o.signingRegion,signing_service:o.signingName,signingName:o.signingName,signingRegionSet:o.signingRegionSet},o.properties))}return n({...r})},endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:serializerMiddlewareOption.name},getEndpointPlugin=(e,t)=>({applyToStack:n=>{n.addRelativeTo(endpointMiddleware({config:e,instructions:t}),endpointMiddlewareOptions)}}),resolveEndpointConfig=e=>{const t=e.tls??!0,{endpoint:n}=e,i=null!=n?async()=>toEndpointV1(await normalizeProvider$1(n)()):void 0,r=!!n,s={...e,endpoint:i,tls:t,isCustomEndpoint:r,useDualstackEndpoint:normalizeProvider$1(e.useDualstackEndpoint??!1),useFipsEndpoint:normalizeProvider$1(e.useFipsEndpoint??!1)};let o;return s.serviceConfiguredEndpoint=async()=>(e.serviceId&&!o&&(o=getEndpointFromConfig(e.serviceId)),o),s};var RETRY_MODES;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(RETRY_MODES||(RETRY_MODES={}));const DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=RETRY_MODES.STANDARD,THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],isClockSkewCorrectedError=e=>e.$metadata?.clockSkewCorrected,isThrottlingError=e=>429===e.$metadata?.httpStatusCode||THROTTLING_ERROR_CODES.includes(e.name)||1==e.$retryable?.throttling,isTransientError=(e,t=0)=>isClockSkewCorrectedError(e)||TRANSIENT_ERROR_CODES.includes(e.name)||NODEJS_TIMEOUT_ERROR_CODES.includes(e?.code||"")||TRANSIENT_ERROR_STATUS_CODES.includes(e.$metadata?.httpStatusCode||0)||void 0!==e.cause&&t<=10&&isTransientError(e.cause,t+1),isServerError=e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!isTransientError(e)}return!1};class DefaultRateLimiter{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise((e=>DefaultRateLimiter.setTimeoutFn(e,t)))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),isThrottlingError(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}DefaultRateLimiter.setTimeoutFn=setTimeout;const DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=2e4,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let e=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:t=>Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}},createDefaultRetryToken=({retryDelay:e,retryCount:t,retryCost:n})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,e),getRetryCost:()=>n});class StandardRetryStrategy{constructor(e){this.maxAttempts=e,this.mode=RETRY_MODES.STANDARD,this.capacity=INITIAL_RETRY_TOKENS,this.retryBackoffStrategy=getDefaultRetryBackoffStrategy(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry(e,t){const n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){const n=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===n?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);const i=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),r=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,i):i,s=this.getCapacityCost(n);return this.capacity-=s,createDefaultRetryToken({retryDelay:r,retryCount:e.getRetryCount()+1,retryCost:s})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+(e.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of "+DEFAULT_MAX_ATTEMPTS),DEFAULT_MAX_ATTEMPTS}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class AdaptiveRetryStrategy{constructor(e,t){this.maxAttemptsProvider=e,this.mode=RETRY_MODES.ADAPTIVE;const{rateLimiter:n}=t??{};this.rateLimiter=n??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let getRandomValues$1;const rnds8$1=new Uint8Array(16);function rng$1(){if(!getRandomValues$1&&(getRandomValues$1="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues$1))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues$1(rnds8$1)}const byteToHex$1=[];for(let e=0;e<256;++e)byteToHex$1.push((e+256).toString(16).slice(1));function unsafeStringify$1(e,t=0){return byteToHex$1[e[t+0]]+byteToHex$1[e[t+1]]+byteToHex$1[e[t+2]]+byteToHex$1[e[t+3]]+"-"+byteToHex$1[e[t+4]]+byteToHex$1[e[t+5]]+"-"+byteToHex$1[e[t+6]]+byteToHex$1[e[t+7]]+"-"+byteToHex$1[e[t+8]]+byteToHex$1[e[t+9]]+"-"+byteToHex$1[e[t+10]]+byteToHex$1[e[t+11]]+byteToHex$1[e[t+12]]+byteToHex$1[e[t+13]]+byteToHex$1[e[t+14]]+byteToHex$1[e[t+15]]}const randomUUID$1="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native$1={randomUUID:randomUUID$1};function v4$1(e,t,n){if(native$1.randomUUID&&!t&&!e)return native$1.randomUUID();const i=(e=e||{}).random||(e.rng||rng$1)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,unsafeStringify$1(i)}const asSdkError=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):"string"==typeof e?new Error(e):new Error("AWS SDK error wrapper for "+e),resolveRetryConfig=e=>{const{retryStrategy:t}=e,n=normalizeProvider$1(e.maxAttempts??DEFAULT_MAX_ATTEMPTS);return{...e,maxAttempts:n,retryStrategy:async()=>t||(await normalizeProvider$1(e.retryMode)()===RETRY_MODES.ADAPTIVE?new AdaptiveRetryStrategy(n):new StandardRetryStrategy(n))}},getAllAliases=(e,t)=>{const n=[];if(e&&n.push(e),t)for(const e of t)n.push(e);return n},getMiddlewareNameWithAliases=(e,t)=>(e||"anonymous")+(t&&t.length>0?" (a.k.a. "+t.join(",")+")":""),constructStack=()=>{let e=[],t=[],n=!1;const i=new Set,r=n=>(e.forEach((e=>{n.add(e.middleware,{...e})})),t.forEach((e=>{n.addRelativeTo(e.middleware,{...e})})),n.identifyOnResolve?.(a.identifyOnResolve()),n),s=e=>{const t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))})),t},o=(n=!1)=>{const i=[],r=[],o={};e.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))o[e]=t;i.push(t)})),t.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))o[e]=t;r.push(t)})),r.forEach((e=>{if(e.toMiddleware){const t=o[e.toMiddleware];if(void 0===t){if(n)return;throw new Error(e.toMiddleware+" is not found when adding "+getMiddlewareNameWithAliases(e.name,e.aliases)+" middleware "+e.relation+" "+e.toMiddleware)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));var a;return(a=i,a.sort(((e,t)=>stepWeights[t.step]-stepWeights[e.step]||priorityWeights[t.priority||"normal"]-priorityWeights[e.priority||"normal"]))).map(s).reduce(((e,t)=>(e.push(...t),e)),[])},a={add:(t,n={})=>{const{name:r,override:s,aliases:o}=n,a={step:"initialize",priority:"normal",middleware:t,...n},c=getAllAliases(r,o);if(c.length>0){if(c.some((e=>i.has(e)))){if(!s)throw new Error("Duplicate middleware name '"+getMiddlewareNameWithAliases(r,o)+"'");for(const t of c){const n=e.findIndex((e=>e.name===t||e.aliases?.some((e=>e===t))));if(-1===n)continue;const i=e[n];if(i.step!==a.step||a.priority!==i.priority)throw new Error('"'+getMiddlewareNameWithAliases(i.name,i.aliases)+'" middleware with '+i.priority+" priority in "+i.step+' step cannot be overridden by "'+getMiddlewareNameWithAliases(r,o)+'" middleware with '+a.priority+" priority in "+a.step+" step.");e.splice(n,1)}}for(const e of c)i.add(e)}e.push(a)},addRelativeTo:(e,n)=>{const{name:r,override:s,aliases:o}=n,a={middleware:e,...n},c=getAllAliases(r,o);if(c.length>0){if(c.some((e=>i.has(e)))){if(!s)throw new Error("Duplicate middleware name '"+getMiddlewareNameWithAliases(r,o)+"'");for(const e of c){const n=t.findIndex((t=>t.name===e||t.aliases?.some((t=>t===e))));if(-1===n)continue;const i=t[n];if(i.toMiddleware!==a.toMiddleware||i.relation!==a.relation)throw new Error('"'+getMiddlewareNameWithAliases(i.name,i.aliases)+'" middleware '+i.relation+' "'+i.toMiddleware+'" middleware cannot be overridden by "'+getMiddlewareNameWithAliases(r,o)+'" middleware '+a.relation+' "'+a.toMiddleware+'" middleware.');t.splice(n,1)}}for(const e of c)i.add(e)}t.push(a)},clone:()=>r(constructStack()),use:e=>{e.applyToStack(a)},remove:n=>"string"==typeof n?(n=>{let r=!1;const s=e=>{const t=getAllAliases(e.name,e.aliases);if(t.includes(n)){r=!0;for(const e of t)i.delete(e);return!1}return!0};return e=e.filter(s),t=t.filter(s),r})(n):(n=>{let r=!1;const s=e=>{if(e.middleware===n){r=!0;for(const t of getAllAliases(e.name,e.aliases))i.delete(t);return!1}return!0};return e=e.filter(s),t=t.filter(s),r})(n),removeByTag:n=>{let r=!1;const s=e=>{const{tags:t,name:s,aliases:o}=e;if(t&&t.includes(n)){const e=getAllAliases(s,o);for(const t of e)i.delete(t);return r=!0,!1}return!0};return e=e.filter(s),t=t.filter(s),r},concat:e=>{const t=r(constructStack());return t.use(e),t.identifyOnResolve(n||t.identifyOnResolve()||(e.identifyOnResolve?.()??!1)),t},applyToStack:r,identify:()=>o(!0).map((e=>{const t=e.step??e.relation+" "+e.toMiddleware;return getMiddlewareNameWithAliases(e.name,e.aliases)+" - "+t})),identifyOnResolve:e=>("boolean"==typeof e&&(n=e),n),resolve:(e,t)=>{for(const n of o().map((e=>e.middleware)).reverse())e=n(e,t);return n&&console.log(a.identify()),e}};return a},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};class Client{constructor(e){this.config=e,this.middlewareStack=constructStack()}send(e,t,n){const i="function"!=typeof t?t:void 0,r="function"==typeof t?t:n;let s;if(void 0===i&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);const t=this.handlers;t.has(e.constructor)?s=t.get(e.constructor):(s=e.resolveMiddleware(this.middlewareStack,this.config,i),t.set(e.constructor,s))}else delete this.handlers,s=e.resolveMiddleware(this.middlewareStack,this.config,i);if(!r)return s(e).then((e=>e.output));s(e).then((e=>r(null,e.output)),(e=>r(e))).catch((()=>{}))}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}class Command{constructor(){this.middlewareStack=constructStack()}static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext(e,t,n,{middlewareFn:i,clientName:r,commandName:s,inputFilterSensitiveLog:o,outputFilterSensitiveLog:a,smithyContext:c,additionalContext:l,CommandCtor:d}){for(const r of i.bind(this)(d,e,t,n))this.middlewareStack.use(r);const u=e.concat(this.middlewareStack),{logger:h}=t,m={logger:h,clientName:r,commandName:s,inputFilterSensitiveLog:o,outputFilterSensitiveLog:a,[SMITHY_CONTEXT_KEY]:{commandInstance:this,...c},...l},{requestHandler:g}=t;return u.resolve((e=>g.handle(e.request,n||{})),m)}}class ClassBuilder{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,n={}){return this._smithyContext={service:e,operation:t,...n},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=e=>e,t=e=>e){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){const e=this;let t;return t=class extends Command{static getEndpointParameterInstructions(){return e._ep}constructor(...[t]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=t??{},e._init(this)}resolveMiddleware(n,i,r){return this.resolveMiddlewareWithContext(n,i,r,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const SENSITIVE_STRING="***SensitiveInformation***",expectLong=e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError("Expected integer, got "+typeof e+": "+e)}},expectInt32=e=>expectSizedInt(e,32),expectSizedInt=(e,t)=>{const n=expectLong(e);if(void 0!==n&&castInt(n,t)!==n)throw new TypeError("Expected "+t+"-bit integer, got "+e);return n},castInt=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},expectString=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return logger.warn(stackTraceWarning("Expected string, got "+typeof e+": "+e)),String(e);throw new TypeError("Expected string, got "+typeof e+": "+e)}},stackTraceWarning=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),logger={warn:console.warn};class ServiceException extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,ServiceException.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}}const decorateServiceException=(e,t={})=>{Object.entries(t).filter((([,e])=>void 0!==e)).forEach((([t,n])=>{null!=e[t]&&""!==e[t]||(e[t]=n)}));const n=e.message||e.Message||"UnknownError";return e.message=n,delete e.Message,e},throwDefaultError$1=({output:e,parsedBody:t,exceptionCtor:n,errorCode:i})=>{const r=deserializeMetadata$1(e),s=r.httpStatusCode?r.httpStatusCode+"":void 0,o=new n({name:t?.code||t?.Code||i||s||"UnknownError",$fault:"client",$metadata:r});throw decorateServiceException(o,t)},withBaseException=e=>({output:t,parsedBody:n,errorCode:i})=>{throwDefaultError$1({output:t,parsedBody:n,exceptionCtor:e,errorCode:i})},deserializeMetadata$1=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),loadConfigsForDefaultMode=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},getChecksumConfiguration=e=>{const t=[];for(const n in AlgorithmId){const i=AlgorithmId[n];void 0!==e[i]&&t.push({algorithmId:()=>i,checksumConstructor:()=>e[i]})}return{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},resolveChecksumRuntimeConfig=e=>{const t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t},getRetryConfiguration=e=>{let t=e.retryStrategy;return{setRetryStrategy(e){t=e},retryStrategy:()=>t}},resolveRetryRuntimeConfig=e=>{const t={};return t.retryStrategy=e.retryStrategy(),t},getDefaultExtensionConfiguration=e=>({...getChecksumConfiguration(e),...getRetryConfiguration(e)}),resolveDefaultRuntimeConfig=e=>({...resolveChecksumRuntimeConfig(e),...resolveRetryRuntimeConfig(e)});class NoOpLogger{trace(){}debug(){}info(){}warn(){}error(){}}function map$1(e,t,n){let i,r,s;if(void 0===t&&void 0===n)i={},s=e;else{if(i=e,"function"==typeof t)return r=t,s=n,mapWithFilter(i,r,s);s=t}for(const e of Object.keys(s))Array.isArray(s[e])?applyInstruction(i,null,s,e):i[e]=s[e];return i}const take=(e,t)=>{const n={};for(const i in t)applyInstruction(n,e,t,i);return n},mapWithFilter=(e,t,n)=>map$1(e,Object.entries(n).reduce(((e,[n,i])=>(Array.isArray(i)?e[n]=i:e[n]="function"==typeof i?[t,i()]:[t,i],e)),{})),applyInstruction=(e,t,n,i)=>{if(null!==t){let r=n[i];"function"==typeof r&&(r=[,r]);const[s=nonNullish,o=pass,a=i]=r;return void(("function"==typeof s&&s(t[a])||"function"!=typeof s&&s)&&(e[i]=o(t[a])))}let[r,s]=n[i];if("function"==typeof s){let t;const n=void 0===r&&null!=(t=s()),o="function"==typeof r&&!!r(void 0)||"function"!=typeof r&&!!r;n?e[i]=t:o&&(e[i]=s())}else{const t=void 0===r&&null!=s,n="function"==typeof r&&!!r(s)||"function"!=typeof r&&!!r;(t||n)&&(e[i]=s)}},nonNullish=e=>null!=e,pass=e=>e,isStreamingPayload=e=>e?.body instanceof ReadableStream,retryMiddleware=e=>(t,n)=>async i=>{let r=await e.retryStrategy();const s=await e.maxAttempts();if(!isRetryStrategyV2(r))return r?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(t,i);{let e=await r.acquireInitialRetryToken(n.partition_id),o=new Error,a=0,c=0;const{request:l}=i,d=HttpRequest.isInstance(l);for(d&&(l.headers[INVOCATION_ID_HEADER]=v4$1());;)try{d&&(l.headers[REQUEST_HEADER]="attempt="+(a+1)+"; max="+s);const{response:n,output:o}=await t(i);return r.recordSuccess(e),o.$metadata.attempts=a+1,o.$metadata.totalRetryDelay=c,{response:n,output:o}}catch(t){const i=getRetryErrorInfo(t);if(o=asSdkError(t),d&&isStreamingPayload(l))throw(n.logger instanceof NoOpLogger?console:n.logger)?.warn("An error was encountered in a non-retryable streaming request."),o;try{e=await r.refreshRetryTokenForRetry(e,i)}catch(e){throw o.$metadata||(o.$metadata={}),o.$metadata.attempts=a+1,o.$metadata.totalRetryDelay=c,o}a=e.getRetryCount();const s=e.getRetryDelay();c+=s,await new Promise((e=>setTimeout(e,s)))}}},isRetryStrategyV2=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,getRetryErrorInfo=e=>{const t={error:e,errorType:getRetryErrorType(e)},n=getRetryAfterHint(e.$response);return n&&(t.retryAfterHint=n),t},getRetryErrorType=e=>isThrottlingError(e)?"THROTTLING":isTransientError(e)?"TRANSIENT":isServerError(e)?"SERVER_ERROR":"CLIENT_ERROR",retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=e=>({applyToStack:t=>{t.add(retryMiddleware(e),retryMiddlewareOptions)}}),getRetryAfterHint=e=>{if(!HttpResponse.isInstance(e))return;const t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(!t)return;const n=e.headers[t],i=Number(n);return Number.isNaN(i)?new Date(n):new Date(1e3*i)},getDateHeader=e=>HttpResponse.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,getSkewCorrectedDate=e=>new Date(Date.now()+e),isClockSkewed=(e,t)=>Math.abs(getSkewCorrectedDate(t).getTime()-e)>=3e5,getUpdatedSystemClockOffset=(e,t)=>{const n=Date.parse(e);return isClockSkewed(n,t)?n-Date.now():t},throwSigningPropertyError=(e,t)=>{if(!t)throw new Error("Property `"+e+"` is not resolved for AWS SDK SigV4Auth");return t},validateSigningProperties=async e=>{const t=throwSigningPropertyError("context",e.context),n=throwSigningPropertyError("config",e.config),i=t.endpointV2?.properties?.authSchemes?.[0],r=throwSigningPropertyError("signer",n.signer),s=await r(i),o=e?.signingRegion,a=e?.signingName;return{config:n,signer:s,signingRegion:o,signingName:a}};class AwsSdkSigV4Signer{async sign(e,t,n){if(!HttpRequest.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:i,signer:r,signingRegion:s,signingName:o}=await validateSigningProperties(n);return await r.sign(e,{signingDate:getSkewCorrectedDate(i.systemClockOffset),signingRegion:s,signingService:o})}errorHandler(e){return t=>{const n=t.ServerTime??getDateHeader(t.$response);if(n){const i=throwSigningPropertyError("config",e.config),r=i.systemClockOffset;i.systemClockOffset=getUpdatedSystemClockOffset(n,i.systemClockOffset),i.systemClockOffset!==r&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const n=getDateHeader(e);if(n){const e=throwSigningPropertyError("config",t.config);e.systemClockOffset=getUpdatedSystemClockOffset(n,e.systemClockOffset)}}}const ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=604800,signingKeyCache={},cacheQueue=[],createScope=(e,t,n)=>e+"/"+t+"/"+n+"/"+KEY_TYPE_IDENTIFIER,getSigningKey=async(e,t,n,i,r)=>{const s=n+":"+i+":"+r+":"+toHex(await hmac(e,t.secretAccessKey,t.accessKeyId))+":"+t.sessionToken;if(s in signingKeyCache)return signingKeyCache[s];for(cacheQueue.push(s);cacheQueue.length>MAX_CACHE_SIZE;)delete signingKeyCache[cacheQueue.shift()];let o="AWS4"+t.secretAccessKey;for(const t of[n,i,r,KEY_TYPE_IDENTIFIER])o=await hmac(e,o,t);return signingKeyCache[s]=o},hmac=(e,t,n)=>{const i=new e(t);return i.update(toUint8Array(n)),i.digest()},getCanonicalHeaders=({headers:e},t,n)=>{const i={};for(const r of Object.keys(e).sort()){if(null==e[r])continue;const s=r.toLowerCase();(s in ALWAYS_UNSIGNABLE_HEADERS||t?.has(s)||PROXY_HEADER_PATTERN.test(s)||SEC_HEADER_PATTERN.test(s))&&(!n||n&&!n.has(s))||(i[s]=e[r].trim().replace(/\s+/g," "))}return i},getCanonicalQuery=({query:e={}})=>{const t=[],n={};for(const i of Object.keys(e)){if(i.toLowerCase()===SIGNATURE_HEADER)continue;const r=escapeUri(i);t.push(r);const s=e[i];"string"==typeof s?n[r]=r+"="+escapeUri(s):Array.isArray(s)&&(n[r]=s.slice(0).reduce(((e,t)=>e.concat([r+"="+escapeUri(t)])),[]).sort().join("&"))}return t.sort().map((e=>n[e])).filter((e=>e)).join("&")},isArrayBuffer=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),getPayloadHash=async({headers:e,body:t},n)=>{for(const t of Object.keys(e))if(t.toLowerCase()===SHA256_HEADER)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||isArrayBuffer(t)){const e=new n;return e.update(toUint8Array(t)),toHex(await e.digest())}return UNSIGNED_PAYLOAD};class HeaderFormatter{format(e){const t=[];for(const n of Object.keys(e)){const i=fromUtf8$2(n);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let i=0;for(const e of t)n.set(e,i),i+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(e.value.bytes,1),i;case"binary":const r=new DataView(new ArrayBuffer(3+e.value.byteLength));r.setUint8(0,6),r.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(r.buffer);return s.set(e.value,3),s;case"string":const o=fromUtf8$2(e.value),a=new DataView(new ArrayBuffer(3+o.byteLength));a.setUint8(0,7),a.setUint16(1,o.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(o,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(Int64$1.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!UUID_PATTERN$1.test(e.value))throw new Error("Invalid UUID received: "+e.value);const d=new Uint8Array(17);return d[0]=9,d.set(fromHex(e.value.replace(/\-/g,"")),1),d}}}var HEADER_VALUE_TYPE$1;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(HEADER_VALUE_TYPE$1||(HEADER_VALUE_TYPE$1={}));const UUID_PATTERN$1=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let Int64$1=class e{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>0x8000000000000000||t<-0x8000000000000000)throw new Error(t+" is too large (or, if negative, too small) to represent as an Int64");const n=new Uint8Array(8);for(let e=7,i=Math.abs(Math.round(t));e>-1&&i>0;e--,i/=256)n[e]=i;return t<0&&negate$1(n),new e(n)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&negate$1(e),parseInt(toHex(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function negate$1(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}const hasHeader=(e,t)=>{e=e.toLowerCase();for(const n of Object.keys(t))if(e===n.toLowerCase())return!0;return!1},moveHeadersToQuery=(e,t={})=>{const{headers:n,query:i={}}=HttpRequest.clone(e);for(const e of Object.keys(n)){const r=e.toLowerCase();("x-amz-"===r.slice(0,6)&&!t.unhoistableHeaders?.has(r)||t.hoistableHeaders?.has(r))&&(i[e]=n[e],delete n[e])}return{...e,headers:n,query:i}},prepareRequest=e=>{e=HttpRequest.clone(e);for(const t of Object.keys(e.headers))GENERATED_HEADERS.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},iso8601=e=>toDate(e).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class SignatureV4{constructor({applyChecksum:e,credentials:t,region:n,service:i,sha256:r,uriEscapePath:s=!0}){this.headerFormatter=new HeaderFormatter,this.service=i,this.sha256=r,this.uriEscapePath=s,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=normalizeProvider$1(n),this.credentialProvider=normalizeProvider$1(t)}async presign(e,t={}){const{signingDate:n=new Date,expiresIn:i=3600,unsignableHeaders:r,unhoistableHeaders:s,signableHeaders:o,hoistableHeaders:a,signingRegion:c,signingService:l}=t,d=await this.credentialProvider();this.validateResolvedCredentials(d);const u=c??await this.regionProvider(),{longDate:h,shortDate:m}=formatDate(n);if(i>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const g=createScope(m,u,l??this.service),p=moveHeadersToQuery(prepareRequest(e),{unhoistableHeaders:s,hoistableHeaders:a});d.sessionToken&&(p.query[TOKEN_QUERY_PARAM]=d.sessionToken),p.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,p.query[CREDENTIAL_QUERY_PARAM]=d.accessKeyId+"/"+g,p.query[AMZ_DATE_QUERY_PARAM]=h,p.query[EXPIRES_QUERY_PARAM]=i.toString(10);const f=getCanonicalHeaders(p,r,o);return p.query[SIGNED_HEADERS_QUERY_PARAM]=getCanonicalHeaderList(f),p.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(h,g,this.getSigningKey(d,u,m,l),this.createCanonicalRequest(p,f,await getPayloadHash(e,this.sha256))),p}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:n=new Date,priorSignature:i,signingRegion:r,signingService:s}){const o=r??await this.regionProvider(),{shortDate:a,longDate:c}=formatDate(n),l=createScope(a,o,s??this.service),d=await getPayloadHash({headers:{},body:t},this.sha256),u=new this.sha256;u.update(e);const h=toHex(await u.digest()),m=[EVENT_ALGORITHM_IDENTIFIER,c,l,i,h,d].join("\n");return this.signString(m,{signingDate:n,signingRegion:o,signingService:s})}async signMessage(e,{signingDate:t=new Date,signingRegion:n,signingService:i}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:n,signingService:i,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}async signString(e,{signingDate:t=new Date,signingRegion:n,signingService:i}={}){const r=await this.credentialProvider();this.validateResolvedCredentials(r);const s=n??await this.regionProvider(),{shortDate:o}=formatDate(t),a=new this.sha256(await this.getSigningKey(r,s,o,i));return a.update(toUint8Array(e)),toHex(await a.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:n,unsignableHeaders:i,signingRegion:r,signingService:s}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const a=r??await this.regionProvider(),c=prepareRequest(e),{longDate:l,shortDate:d}=formatDate(t),u=createScope(d,a,s??this.service);c.headers[AMZ_DATE_HEADER]=l,o.sessionToken&&(c.headers[TOKEN_HEADER]=o.sessionToken);const h=await getPayloadHash(c,this.sha256);!hasHeader(SHA256_HEADER,c.headers)&&this.applyChecksum&&(c.headers[SHA256_HEADER]=h);const m=getCanonicalHeaders(c,i,n),g=await this.getSignature(l,u,this.getSigningKey(o,a,d,s),this.createCanonicalRequest(c,m,h));return c.headers[AUTH_HEADER]=ALGORITHM_IDENTIFIER+" Credential="+o.accessKeyId+"/"+u+", SignedHeaders="+getCanonicalHeaderList(m)+", Signature="+g,c}createCanonicalRequest(e,t,n){const i=Object.keys(t).sort();return e.method+"\n"+this.getCanonicalPath(e)+"\n"+getCanonicalQuery(e)+"\n"+i.map((e=>e+":"+t[e])).join("\n")+"\n\n"+i.join(";")+"\n"+n}async createStringToSign(e,t,n){const i=new this.sha256;i.update(toUint8Array(n));const r=await i.digest();return ALGORITHM_IDENTIFIER+"\n"+e+"\n"+t+"\n"+toHex(r)}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const n of e.split("/"))0!==n?.length&&"."!==n&&(".."===n?t.pop():t.push(n));const n=(e?.startsWith("/")?"/":"")+t.join("/")+(t.length>0&&e?.endsWith("/")?"/":"");return escapeUri(n).replace(/%2F/g,"/")}return e}async getSignature(e,t,n,i){const r=await this.createStringToSign(e,t,i),s=new this.sha256(await n);return s.update(toUint8Array(r)),toHex(await s.digest())}getSigningKey(e,t,n,i){return getSigningKey(this.sha256,e,n,t,i||this.service)}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}const formatDate=e=>{const t=iso8601(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.slice(0,8)}},getCanonicalHeaderList=e=>Object.keys(e).sort().join(";"),resolveAwsSdkSigV4Config=e=>{let t;e.credentials&&(t=memoizeIdentityProvider(e.credentials,isIdentityExpired,doesIdentityRequireRefresh)),t||(t=e.credentialDefaultProvider?normalizeProvider(e.credentialDefaultProvider(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("`credentials` is missing")});const{signingEscapePath:n=!0,systemClockOffset:i=e.systemClockOffset||0,sha256:r}=e;let s;return s=e.signer?normalizeProvider(e.signer):e.regionInfoProvider?()=>normalizeProvider(e.region)().then((async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t])).then((([i,s])=>{const{signingRegion:o,signingService:a}=i;e.signingRegion=e.signingRegion||o||s,e.signingName=e.signingName||a||e.serviceId;const c={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:n};return new(e.signerConstructor||SignatureV4)(c)})):async i=>{const s=(i=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await normalizeProvider(e.region)(),properties:{}},i)).signingRegion,o=i.signingName;e.signingRegion=e.signingRegion||s,e.signingName=e.signingName||o||e.serviceId;const a={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:n};return new(e.signerConstructor||SignatureV4)(a)},{...e,systemClockOffset:i,signingEscapePath:n,credentials:t,signer:s}},collectBodyString=(e,t)=>collectBody(e,t).then((e=>t.utf8Encoder(e))),parseJsonBody=(e,t)=>collectBodyString(e,t).then((e=>{if(e.length)try{return JSON.parse(e)}catch(t){throw"SyntaxError"===t?.name&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}return{}})),parseJsonErrorBody=async(e,t)=>{const n=await parseJsonBody(e,t);return n.message=n.message??n.Message,n},loadRestJsonErrorCode=(e,t)=>{const n=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},i=(r=e.headers,Object.keys(r).find((e=>e.toLowerCase()==="x-amzn-errortype".toLowerCase())));var r;return void 0!==i?n(e.headers[i]):void 0!==t.code?n(t.code):void 0!==t.__type?n(t.__type):void 0},defaultBedrockRuntimeHttpAuthSchemeParametersProvider=async(e,t,n)=>({operation:getSmithyContext(t).operation,region:await normalizeProvider$1(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function createAwsAuthSigv4HttpAuthOption(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}const defaultBedrockRuntimeHttpAuthSchemeProvider=e=>{const t=[];return e.operation,t.push(createAwsAuthSigv4HttpAuthOption(e)),t},resolveHttpAuthSchemeConfig=e=>({...resolveAwsSdkSigV4Config(e)}),resolveClientEndpointParameters=e=>({...e,useDualstackEndpoint:e.useDualstackEndpoint??!1,useFipsEndpoint:e.useFipsEndpoint??!1,defaultSigningName:"bedrock"}),commonParams={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var name="@aws-sdk/client-bedrock-runtime",description="AWS SDK for JavaScript Bedrock Runtime Client for Node.js, Browser and React Native",version="3.621.0",scripts={build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-bedrock-runtime","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo bedrock-runtime"},main="./dist-cjs/index.js",types="./dist-types/index.d.ts",module$1="./dist-es/index.js",sideEffects=!1,dependencies={"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/client-sso-oidc":"3.621.0","@aws-sdk/client-sts":"3.621.0","@aws-sdk/core":"3.621.0","@aws-sdk/credential-provider-node":"3.621.0","@aws-sdk/middleware-host-header":"3.620.0","@aws-sdk/middleware-logger":"3.609.0","@aws-sdk/middleware-recursion-detection":"3.620.0","@aws-sdk/middleware-user-agent":"3.620.0","@aws-sdk/region-config-resolver":"3.614.0","@aws-sdk/types":"3.609.0","@aws-sdk/util-endpoints":"3.614.0","@aws-sdk/util-user-agent-browser":"3.609.0","@aws-sdk/util-user-agent-node":"3.614.0","@smithy/config-resolver":"^3.0.5","@smithy/core":"^2.3.1","@smithy/eventstream-serde-browser":"^3.0.5","@smithy/eventstream-serde-config-resolver":"^3.0.3","@smithy/eventstream-serde-node":"^3.0.4","@smithy/fetch-http-handler":"^3.2.4","@smithy/hash-node":"^3.0.3","@smithy/invalid-dependency":"^3.0.3","@smithy/middleware-content-length":"^3.0.5","@smithy/middleware-endpoint":"^3.1.0","@smithy/middleware-retry":"^3.0.13","@smithy/middleware-serde":"^3.0.3","@smithy/middleware-stack":"^3.0.3","@smithy/node-config-provider":"^3.1.4","@smithy/node-http-handler":"^3.1.4","@smithy/protocol-http":"^4.1.0","@smithy/smithy-client":"^3.1.11","@smithy/types":"^3.3.0","@smithy/url-parser":"^3.0.3","@smithy/util-base64":"^3.0.0","@smithy/util-body-length-browser":"^3.0.0","@smithy/util-body-length-node":"^3.0.0","@smithy/util-defaults-mode-browser":"^3.0.13","@smithy/util-defaults-mode-node":"^3.0.13","@smithy/util-endpoints":"^2.0.5","@smithy/util-middleware":"^3.0.3","@smithy/util-retry":"^3.0.3","@smithy/util-stream":"^3.1.3","@smithy/util-utf8":"^3.0.0",tslib:"^2.6.2"},devDependencies={"@tsconfig/node16":"16.1.3","@types/node":"^16.18.96",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~4.9.5"},engines={node:">=16.0.0"},typesVersions={"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files=["dist-*/**"],author={name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license="Apache-2.0",browser={"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},homepage="https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-bedrock-runtime",repository={type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-bedrock-runtime"},packageInfo={name:name,description:description,version:version,scripts:scripts,main:main,types:types,module:module$1,sideEffects:sideEffects,dependencies:dependencies,devDependencies:devDependencies,engines:engines,typesVersions:typesVersions,files:files,author:author,license:license,browser:browser,"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:homepage,repository:repository};const fromUtf8$1=e=>(new TextEncoder).encode(e);var fromUtf8="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:fromUtf8$1;function convertToBuffer(e){return e instanceof Uint8Array?e:"string"==typeof e?fromUtf8(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function isEmptyData(e){return"string"==typeof e?0===e.length:0===e.byteLength}function uint32ArrayFrom(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)}var SHA_256_HASH={name:"SHA-256"},SHA_256_HMAC_ALGO={name:"HMAC",hash:SHA_256_HASH},EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const fallbackWindow={};function locateWindow(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:fallbackWindow}var Sha256$2=function(){function e(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return e.prototype.update=function(e){if(!isEmptyData(e)){var t=convertToBuffer(e),n=new Uint8Array(this.toHash.byteLength+t.byteLength);n.set(this.toHash,0),n.set(t,this.toHash.byteLength),this.toHash=n}},e.prototype.digest=function(){var e=this;return this.key?this.key.then((function(t){return locateWindow().crypto.subtle.sign(SHA_256_HMAC_ALGO,t,e.toHash).then((function(e){return new Uint8Array(e)}))})):isEmptyData(this.toHash)?Promise.resolve(EMPTY_DATA_SHA_256):Promise.resolve().then((function(){return locateWindow().crypto.subtle.digest(SHA_256_HASH,e.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},e.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&void 0!==this.secret&&(this.key=new Promise((function(t,n){locateWindow().crypto.subtle.importKey("raw",convertToBuffer(e.secret),SHA_256_HMAC_ALGO,!1,["sign"]).then(t,n)})),this.key.catch((function(){})))},e}();function __awaiter(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function __generator(e,t){var n,i,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var BLOCK_SIZE=64,DIGEST_LENGTH=32,KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],MAX_HASHABLE_LENGTH=Math.pow(2,53)-1,RawSha256=function(){function e(){this.state=Int32Array.from(INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%BLOCK_SIZE>=BLOCK_SIZE-8){for(var i=this.bufferLength;i<BLOCK_SIZE;i++)t.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(i=this.bufferLength;i<BLOCK_SIZE-8;i++)t.setUint8(i,0);t.setUint32(BLOCK_SIZE-8,Math.floor(e/4294967296),!0),t.setUint32(BLOCK_SIZE-4,e),this.hashBuffer(),this.finished=!0}var r=new Uint8Array(DIGEST_LENGTH);for(i=0;i<8;i++)r[4*i]=this.state[i]>>>24&255,r[4*i+1]=this.state[i]>>>16&255,r[4*i+2]=this.state[i]>>>8&255,r[4*i+3]=this.state[i]>>>0&255;return r},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],d=0;d<BLOCK_SIZE;d++){if(d<16)this.temp[d]=(255&e[4*d])<<24|(255&e[4*d+1])<<16|(255&e[4*d+2])<<8|255&e[4*d+3];else{var u=this.temp[d-2],h=(u>>>17|u<<15)^(u>>>19|u<<13)^u>>>10,m=((u=this.temp[d-15])>>>7|u<<25)^(u>>>18|u<<14)^u>>>3;this.temp[d]=(h+this.temp[d-7]|0)+(m+this.temp[d-16]|0)}var g=(((o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7))+(o&a^~o&c)|0)+(l+(KEY[d]+this.temp[d]|0)|0)|0,p=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&i^n&r^i&r)|0;l=c,c=a,a=o,o=s+g|0,s=r,r=i,i=n,n=g+p|0}t[0]+=n,t[1]+=i,t[2]+=r,t[3]+=s,t[4]+=o,t[5]+=a,t[6]+=c,t[7]+=l},e}(),Sha256$1=function(){function e(e){this.secret=e,this.hash=new RawSha256,this.reset()}return e.prototype.update=function(e){if(!isEmptyData(e)&&!this.error)try{this.hash.update(convertToBuffer(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new RawSha256,this.secret){this.outer=new RawSha256;var e=bufferFromSecret(this.secret),t=new Uint8Array(BLOCK_SIZE);t.set(e);for(var n=0;n<BLOCK_SIZE;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();function bufferFromSecret(e){var t=convertToBuffer(e);if(t.byteLength>BLOCK_SIZE){var n=new RawSha256;n.update(t),t=n.digest()}var i=new Uint8Array(BLOCK_SIZE);return i.set(t),i}var subtleCryptoMethods=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function supportsWebCrypto(e){return!(!supportsSecureRandom(e)||"object"!=typeof e.crypto.subtle)&&supportsSubtleCrypto(e.crypto.subtle)}function supportsSecureRandom(e){return"object"==typeof e&&"object"==typeof e.crypto&&"function"==typeof e.crypto.getRandomValues}function supportsSubtleCrypto(e){return e&&subtleCryptoMethods.every((function(t){return"function"==typeof e[t]}))}var Sha256=function(){function e(e){supportsWebCrypto(locateWindow())?this.hash=new Sha256$2(e):this.hash=new Sha256$1(e)}return e.prototype.update=function(e,t){this.hash.update(convertToBuffer(e))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},es5={exports:{}};es5.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){t.__esModule=!0,t.default=void 0;var i=n(18),r=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,i){void 0===i&&(i=!1);var r=e.getVersionPrecision(t),s=e.getVersionPrecision(n),o=Math.max(r,s),a=0,c=e.map([t,n],(function(t){var n=o-e.getVersionPrecision(t),i=t+new Array(n+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(a=o-Math.min(r,s)),o-=1;o>=a;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===a)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)i.push(t(e[n]));return i},e.find=function(e,t){var n,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,i=e.length;n<i;n+=1){var r=e[n];if(t(r,n))return r}},e.assign=function(e){for(var t,n,i=e,r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,n=s.length;t<n;t+=1)a();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=r,e.exports=t.default},18:function(e,t,n){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(91))&&i.__esModule?i:{default:i},s=n(18);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){}var t,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new r.default(e,t)},e.parse=function(e){return new r.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),n&&o(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,n){t.__esModule=!0,t.default=void 0;var i=c(n(92)),r=c(n(93)),s=c(n(94)),o=c(n(95)),a=c(n(17));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(r.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},i=0,r={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(r[t]=o,s+=1):"object"==typeof o&&(n[t]=o,i+=1)})),i>0){var o=Object.keys(n),c=a.default.find(o,(function(e){return t.isOS(e)}));if(c){var l=this.satisfies(n[c]);if(void 0!==l)return l}var d=a.default.find(o,(function(e){return t.isPlatform(e)}));if(d){var u=this.satisfies(n[d]);if(void 0!==u)return u}}if(s>0){var h=Object.keys(r),m=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==m)return this.compareVersion(r[m])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),r=a.default.getBrowserTypeByAlias(i);return t&&r&&(i=r.toLowerCase()),i===n},t.compareVersion=function(e){var t=[0],n=e,i=!1,r=this.getBrowserVersion();if("string"==typeof r)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(i=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(i=!0,n=e.substr(1)),t.indexOf(a.default.compareVersions(r,n,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=l,e.exports=t.default},92:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=r.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=r.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=r.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=r.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=r.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=r.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=r.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=r.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=r.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=r.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=r.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=r.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:r.default.getFirstMatch(t,e),version:r.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=r.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=r.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},n=r.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=r.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return n&&(i.versionName=n),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=r.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=r.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:s.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||r.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=r.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=r.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=r.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=r.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},n=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},n=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},n=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},n=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=o,e.exports=t.default}});var es5Exports=es5.exports;const defaultUserAgent=({serviceId:e,clientVersion:t})=>async()=>{const n="undefined"!=typeof window&&window?.navigator?.userAgent?es5Exports.parse(window.navigator.userAgent):void 0,i=[["aws-sdk-js",t],["ua","2.0"],["os/"+(n?.os?.name||"other"),n?.os?.version],["lang/js"],["md/browser",(n?.browser?.name??"unknown")+"_"+(n?.browser?.version??"unknown")]];return e&&i.push(["api/"+e,t]),i};var Crc32=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,n;try{for(var i=__values(e),r=i.next();!r.done;r=i.next()){var s=r.value;this.checksum=this.checksum>>>8^lookupTable[255&(this.checksum^s)]}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}(),a_lookUpTable=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],lookupTable=uint32ArrayFrom(a_lookUpTable),HEADER_VALUE_TYPE;class Int64{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(e+" is too large (or, if negative, too small) to represent as an Int64");const t=new Uint8Array(8);for(let n=7,i=Math.abs(Math.round(e));n>-1&&i>0;n--,i/=256)t[n]=i;return e<0&&negate(t),new Int64(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&negate(e),parseInt(toHex(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function negate(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class HeaderMarshaller{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const n of Object.keys(e)){const i=this.fromUtf8(n);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let i=0;for(const e of t)n.set(e,i),i+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(e.value.bytes,1),i;case"binary":const r=new DataView(new ArrayBuffer(3+e.value.byteLength));r.setUint8(0,6),r.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(r.buffer);return s.set(e.value,3),s;case"string":const o=this.fromUtf8(e.value),a=new DataView(new ArrayBuffer(3+o.byteLength));a.setUint8(0,7),a.setUint16(1,o.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(o,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(Int64.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!UUID_PATTERN.test(e.value))throw new Error("Invalid UUID received: "+e.value);const d=new Uint8Array(17);return d[0]=9,d.set(fromHex(e.value.replace(/\-/g,"")),1),d}}parse(e){const t={};let n=0;for(;n<e.byteLength;){const i=e.getUint8(n++),r=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,i));switch(n+=i,e.getUint8(n++)){case 0:t[r]={type:BOOLEAN_TAG,value:!0};break;case 1:t[r]={type:BOOLEAN_TAG,value:!1};break;case 2:t[r]={type:BYTE_TAG,value:e.getInt8(n++)};break;case 3:t[r]={type:SHORT_TAG,value:e.getInt16(n,!1)},n+=2;break;case 4:t[r]={type:INT_TAG,value:e.getInt32(n,!1)},n+=4;break;case 5:t[r]={type:LONG_TAG,value:new Int64(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:const i=e.getUint16(n,!1);n+=2,t[r]={type:BINARY_TAG,value:new Uint8Array(e.buffer,e.byteOffset+n,i)},n+=i;break;case 7:const s=e.getUint16(n,!1);n+=2,t[r]={type:STRING_TAG,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s))},n+=s;break;case 8:t[r]={type:TIMESTAMP_TAG,value:new Date(new Int64(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const o=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[r]={type:UUID_TAG,value:toHex(o.subarray(0,4))+"-"+toHex(o.subarray(4,6))+"-"+toHex(o.subarray(6,8))+"-"+toHex(o.subarray(8,10))+"-"+toHex(o.subarray(10))};break;default:throw new Error("Unrecognized header type tag")}}return t}}!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));const BOOLEAN_TAG="boolean",BYTE_TAG="byte",SHORT_TAG="short",INT_TAG="integer",LONG_TAG="long",BINARY_TAG="binary",STRING_TAG="string",TIMESTAMP_TAG="timestamp",UUID_TAG="uuid",UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,PRELUDE_MEMBER_LENGTH=4,PRELUDE_LENGTH=2*PRELUDE_MEMBER_LENGTH,CHECKSUM_LENGTH=4,MINIMUM_MESSAGE_LENGTH=PRELUDE_LENGTH+2*CHECKSUM_LENGTH;function splitMessage({byteLength:e,byteOffset:t,buffer:n}){if(e<MINIMUM_MESSAGE_LENGTH)throw new Error("Provided message too short to accommodate event stream message overhead");const i=new DataView(n,t,e),r=i.getUint32(0,!1);if(e!==r)throw new Error("Reported message length does not match received message length");const s=i.getUint32(PRELUDE_MEMBER_LENGTH,!1),o=i.getUint32(PRELUDE_LENGTH,!1),a=i.getUint32(e-CHECKSUM_LENGTH,!1),c=(new Crc32).update(new Uint8Array(n,t,PRELUDE_LENGTH));if(o!==c.digest())throw new Error("The prelude checksum specified in the message ("+o+") does not match the calculated CRC32 checksum ("+c.digest()+")");if(c.update(new Uint8Array(n,t+PRELUDE_LENGTH,e-(PRELUDE_LENGTH+CHECKSUM_LENGTH))),a!==c.digest())throw new Error("The message checksum ("+c.digest()+") did not match the expected value of "+a);return{headers:new DataView(n,t+PRELUDE_LENGTH+CHECKSUM_LENGTH,s),body:new Uint8Array(n,t+PRELUDE_LENGTH+CHECKSUM_LENGTH+s,r-s-(PRELUDE_LENGTH+CHECKSUM_LENGTH+CHECKSUM_LENGTH))}}class EventStreamCodec{constructor(e,t){this.headerMarshaller=new HeaderMarshaller(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage:()=>e,isEndOfStream:()=>t}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const t=this.isEndOfStream;return{getMessages:()=>e,isEndOfStream:()=>t}}encode({headers:e,body:t}){const n=this.headerMarshaller.format(e),i=n.byteLength+t.byteLength+16,r=new Uint8Array(i),s=new DataView(r.buffer,r.byteOffset,r.byteLength),o=new Crc32;return s.setUint32(0,i,!1),s.setUint32(4,n.byteLength,!1),s.setUint32(8,o.update(r.subarray(0,8)).digest(),!1),r.set(n,12),r.set(t,n.byteLength+12),s.setUint32(i-4,o.update(r.subarray(8,i-4)).digest(),!1),r}decode(e){const{headers:t,body:n}=splitMessage(e);return{headers:this.headerMarshaller.parse(t),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}}class MessageDecoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.decoder.decode(e);yield t}}}class MessageEncoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=this.options.encoder.encode(e);yield t}this.options.includeEndFrame&&(yield new Uint8Array(0))}}class SmithyMessageDecoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=await this.options.deserializer(e);void 0!==t&&(yield t)}}}class SmithyMessageEncoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.serializer(e);yield t}}}function getChunkedStream(e){let t=0,n=0,i=null,r=null;const s=e=>{if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);t=e,n=4,i=new Uint8Array(e),new DataView(i.buffer).setUint32(0,e,!1)};return{[Symbol.asyncIterator]:async function*(){const o=e[Symbol.asyncIterator]();for(;;){const{value:e,done:a}=await o.next();if(a){if(!t)return;if(t!==n)throw new Error("Truncated event message received.");return void(yield i)}const c=e.length;let l=0;for(;l<c;){if(!i){const t=c-l;r||(r=new Uint8Array(4));const i=Math.min(4-n,t);if(r.set(e.slice(l,l+i),n),n+=i,l+=i,n<4)break;s(new DataView(r.buffer).getUint32(0,!1)),r=null}const o=Math.min(t-n,c-l);i.set(e.slice(l,l+o),n),n+=o,l+=o,t&&t===n&&(yield i,i=null,t=0,n=0)}}}}}function getMessageUnmarshaller(e,t){return async function(n){const{value:i}=n.headers[":message-type"];if("error"===i){const e=new Error(n.headers[":error-message"].value||"UnknownError");throw e.name=n.headers[":error-code"].value,e}if("exception"===i){const i=n.headers[":exception-type"].value,r={[i]:n},s=await e(r);if(s.$unknown){const e=new Error(t(n.body));throw e.name=i,e}throw s[i]}if("event"===i){const t={[n.headers[":event-type"].value]:n},i=await e(t);if(i.$unknown)return;return i}throw Error("Unrecognizable event type: "+n.headers[":event-type"].value)}}let EventStreamMarshaller$1=class{constructor({utf8Encoder:e,utf8Decoder:t}){this.eventStreamCodec=new EventStreamCodec(e,t),this.utfEncoder=e}deserialize(e,t){const n=getChunkedStream(e);return new SmithyMessageDecoderStream({messageStream:new MessageDecoderStream({inputStream:n,decoder:this.eventStreamCodec}),deserializer:getMessageUnmarshaller(t,this.utfEncoder)})}serialize(e,t){return new MessageEncoderStream({messageStream:new SmithyMessageEncoderStream({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const readableStreamtoIterable=e=>({[Symbol.asyncIterator]:async function*(){const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)return;yield n}}finally{t.releaseLock()}}}),iterableToReadableStream=e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const{done:n,value:i}=await t.next();if(n)return e.close();e.enqueue(i)}})};class EventStreamMarshaller{constructor({utf8Encoder:e,utf8Decoder:t}){this.universalMarshaller=new EventStreamMarshaller$1({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){const n=isReadableStream(e)?readableStreamtoIterable(e):e;return this.universalMarshaller.deserialize(n,t)}serialize(e,t){const n=this.universalMarshaller.serialize(e,t);return"function"==typeof ReadableStream?iterableToReadableStream(n):n}}const isReadableStream=e=>"function"==typeof ReadableStream&&e instanceof ReadableStream,eventStreamSerdeProvider=e=>new EventStreamMarshaller(e);function requestTimeout(e=0){return new Promise(((t,n)=>{e&&setTimeout((()=>{const t=new Error("Request did not complete within "+e+" ms");t.name="TimeoutError",n(t)}),e)}))}const keepAliveSupport={supported:void 0};class FetchHttpHandler{static create(e){return"function"==typeof e?.handle?e:new FetchHttpHandler(e)}constructor(e){"function"==typeof e?this.configProvider=e().then((e=>e||{})):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),void 0===keepAliveSupport.supported&&(keepAliveSupport.supported=Boolean("undefined"!=typeof Request&&"keepalive"in new Request("https://[::1]")))}destroy(){}async handle(e,{abortSignal:t}={}){this.config||(this.config=await this.configProvider);const n=this.config.requestTimeout,i=!0===this.config.keepAlive,r=this.config.credentials;if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",Promise.reject(e)}let s=e.path;const o=buildQueryString(e.query||{});o&&(s+="?"+o),e.fragment&&(s+="#"+e.fragment);let a="";(null!=e.username||null!=e.password)&&(a=(e.username??"")+":"+(e.password??"")+"@");const{port:c,method:l}=e,d=e.protocol+"//"+a+e.hostname+(c?":"+c:"")+s,u="GET"===l||"HEAD"===l?void 0:e.body,h={body:u,headers:new Headers(e.headers),method:l,credentials:r};this.config?.cache&&(h.cache=this.config.cache),u&&(h.duplex="half"),"undefined"!=typeof AbortController&&(h.signal=t),keepAliveSupport.supported&&(h.keepalive=i),"function"==typeof this.config.requestInit&&Object.assign(h,this.config.requestInit(e));let m=()=>{};const g=new Request(d,h),p=[fetch(g).then((e=>{const t=e.headers,n={};for(const e of t.entries())n[e[0]]=e[1];return null!=e.body?{response:new HttpResponse({headers:n,reason:e.statusText,statusCode:e.status,body:e.body})}:e.blob().then((t=>({response:new HttpResponse({headers:n,reason:e.statusText,statusCode:e.status,body:t})})))})),requestTimeout(n)];return t&&p.push(new Promise(((e,n)=>{const i=()=>{const e=new Error("Request aborted");e.name="AbortError",n(e)};if("function"==typeof t.addEventListener){const e=t;e.addEventListener("abort",i,{once:!0}),m=()=>e.removeEventListener("abort",i)}else t.onabort=i}))),Promise.race(p).finally(m)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then((n=>(n[e]=t,n)))}httpHandlerConfigs(){return this.config??{}}}const streamCollector=e=>"function"==typeof Blob&&e instanceof Blob?collectBlob(e):collectStream(e);async function collectBlob(e){const t=await readToBase64(e),n=fromBase64(t);return new Uint8Array(n)}async function collectStream(e){const t=[],n=e.getReader();let i=!1,r=0;for(;!i;){const{done:e,value:s}=await n.read();s&&(t.push(s),r+=s.length),i=e}const s=new Uint8Array(r);let o=0;for(const e of t)s.set(e,o),o+=e.length;return s}function readToBase64(e){return new Promise(((t,n)=>{const i=new FileReader;i.onloadend=()=>{if(2!==i.readyState)return n(new Error("Reader aborted too early"));const e=i.result??"",r=e.indexOf(","),s=r>-1?r+1:e.length;t(e.substring(s))},i.onabort=()=>n(new Error("Read aborted")),i.onerror=()=>n(i.error),i.readAsDataURL(e)}))}const invalidProvider=e=>()=>Promise.reject(e),TEXT_ENCODER$1="function"==typeof TextEncoder?new TextEncoder:null,calculateBodyLength=e=>{if("string"==typeof e){if(TEXT_ENCODER$1)return TEXT_ENCODER$1.encode(e).byteLength;let t=e.length;for(let n=t-1;n>=0;n--){const i=e.charCodeAt(n);i>127&&i<=2047?t++:i>2047&&i<=65535&&(t+=2),i>=56320&&i<=57343&&n--}return t}if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;throw new Error("Body Length computation failed for "+e)},s$1="required",t="fn",u="argv",v="ref",a=!0,b="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h={[s$1]:!1,type:"String"},i$1={[s$1]:!0,default:!1,type:"Boolean"},j={[v]:"Endpoint"},k={[t]:c,[u]:[{[v]:"UseFIPS"},!0]},l$1={[t]:c,[u]:[{[v]:"UseDualStack"},!0]},m={},n$1={[t]:"getAttr",[u]:[{[v]:g},"supportsFIPS"]},o={[t]:c,[u]:[!0,{[t]:"getAttr",[u]:[{[v]:g},"supportsDualStack"]}]},p=[k],q=[l$1],r=[{[v]:"Region"}],_data={version:"1.0",parameters:{Region:h,UseDualStack:i$1,UseFIPS:i$1,Endpoint:h},rules:[{conditions:[{[t]:b,[u]:[j]}],rules:[{conditions:p,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{rules:[{conditions:q,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:j,properties:m,headers:m},type:e}],type:f}],type:f},{rules:[{conditions:[{[t]:b,[u]:r}],rules:[{conditions:[{[t]:"aws.partition",[u]:r,assign:g}],rules:[{conditions:[k,l$1],rules:[{conditions:[{[t]:c,[u]:[a,n$1]},o],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:p,rules:[{conditions:[{[t]:c,[u]:[n$1,a]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:q,rules:[{conditions:[o],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}],type:f}]},ruleSet=_data,defaultEndpointResolver=(e,t={})=>resolveEndpoint(ruleSet,{endpointParams:e,logger:t.logger});customEndpointFunctions.aws=awsEndpointFunctions;const getRuntimeConfig$1=e=>({apiVersion:"2023-09-30",base64Decoder:e?.base64Decoder??fromBase64,base64Encoder:e?.base64Encoder??toBase64,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??defaultEndpointResolver,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??defaultBedrockRuntimeHttpAuthSchemeProvider,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new AwsSdkSigV4Signer}],logger:e?.logger??new NoOpLogger,serviceId:e?.serviceId??"Bedrock Runtime",urlParser:e?.urlParser??parseUrl,utf8Decoder:e?.utf8Decoder??fromUtf8$2,utf8Encoder:e?.utf8Encoder??toUtf8}),memoize=(e,t,n)=>{let i,r,s,o=!1;return async t=>(s&&!t?.forceRefresh||(i=await(async()=>{r||(r=e());try{i=await r,s=!0,o=!1}finally{r=void 0}return i})()),i)},DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],resolveDefaultsModeConfig=({defaultsMode:e}={})=>memoize((async()=>{const t="function"==typeof e?await e():e;switch(t?.toLowerCase()){case"auto":return Promise.resolve(isMobileBrowser()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error('Invalid parameter for "defaultsMode", expect '+DEFAULTS_MODE_OPTIONS.join(", ")+", got "+t)}})),isMobileBrowser=()=>{const e="undefined"!=typeof window&&window?.navigator?.userAgent?es5Exports.parse(window.navigator.userAgent):void 0,t=e?.platform?.type;return"tablet"===t||"mobile"===t},getRuntimeConfig=e=>{const t=resolveDefaultsModeConfig(e),n=()=>t().then(loadConfigsForDefaultMode),i=getRuntimeConfig$1(e);return{...i,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??calculateBodyLength,credentialDefaultProvider:e?.credentialDefaultProvider??(e=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:e?.defaultUserAgentProvider??defaultUserAgent({serviceId:i.serviceId,clientVersion:packageInfo.version}),eventStreamSerdeProvider:e?.eventStreamSerdeProvider??eventStreamSerdeProvider,maxAttempts:e?.maxAttempts??DEFAULT_MAX_ATTEMPTS,region:e?.region??invalidProvider("Region is missing"),requestHandler:FetchHttpHandler.create(e?.requestHandler??n),retryMode:e?.retryMode??(async()=>(await n()).retryMode||DEFAULT_RETRY_MODE),sha256:e?.sha256??Sha256,streamCollector:e?.streamCollector??streamCollector,useDualstackEndpoint:e?.useDualstackEndpoint??(()=>Promise.resolve(DEFAULT_USE_DUALSTACK_ENDPOINT)),useFipsEndpoint:e?.useFipsEndpoint??(()=>Promise.resolve(DEFAULT_USE_FIPS_ENDPOINT))}},getAwsRegionExtensionConfiguration=e=>{let t=async()=>{if(void 0===e.region)throw new Error("Region is missing from runtimeConfig");const t=e.region;return"string"==typeof t?t:t()};return{setRegion(e){t=e},region:()=>t}},resolveAwsRegionExtensionConfiguration=e=>({region:e.region()}),getHttpAuthExtensionConfiguration=e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,i=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex((t=>t.schemeId===e.schemeId));-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){i=e},credentials:()=>i}},resolveHttpAuthRuntimeConfig=e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials()}),asPartial=e=>e,resolveRuntimeExtensions=(e,t)=>{const n={...asPartial(getAwsRegionExtensionConfiguration(e)),...asPartial(getDefaultExtensionConfiguration(e)),...asPartial(getHttpHandlerExtensionConfiguration(e)),...asPartial(getHttpAuthExtensionConfiguration(e))};return t.forEach((e=>e.configure(n))),{...e,...resolveAwsRegionExtensionConfiguration(n),...resolveDefaultRuntimeConfig(n),...resolveHttpHandlerRuntimeConfig(n),...resolveHttpAuthRuntimeConfig(n)}};class BedrockRuntimeClient extends Client{constructor(...[e]){const t=getRuntimeConfig(e||{}),n=resolveClientEndpointParameters(t),i=resolveRegionConfig(n),r=resolveUserAgentConfig(resolveHostHeaderConfig(resolveEndpointConfig(i))),s=resolveRetryConfig(r),o=resolveEventStreamSerdeConfig(s),a=resolveHttpAuthSchemeConfig(o),c=resolveRuntimeExtensions(a,e?.extensions||[]);super(c),this.config=c,this.middlewareStack.use(getHostHeaderPlugin(this.config)),this.middlewareStack.use(getLoggerPlugin(this.config)),this.middlewareStack.use(getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(getUserAgentPlugin(this.config)),this.middlewareStack.use(getRetryPlugin(this.config)),this.middlewareStack.use(getContentLengthPlugin(this.config)),this.middlewareStack.use(getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:this.getDefaultHttpAuthSchemeParametersProvider(),identityProviderConfigProvider:this.getIdentityProviderConfigProvider()})),this.middlewareStack.use(getHttpSigningPlugin(this.config))}destroy(){super.destroy()}getDefaultHttpAuthSchemeParametersProvider(){return defaultBedrockRuntimeHttpAuthSchemeParametersProvider}getIdentityProviderConfigProvider(){return async e=>new DefaultIdentityProviderConfig({"aws.auth#sigv4":e.credentials})}}class BedrockRuntimeServiceException extends ServiceException{constructor(e){super(e),Object.setPrototypeOf(this,BedrockRuntimeServiceException.prototype)}}class AccessDeniedException extends BedrockRuntimeServiceException{constructor(e){super({name:"AccessDeniedException",$fault:"client",...e}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,AccessDeniedException.prototype)}}var GuardrailContentBlock,DocumentSource,GuardrailConverseContentBlock,ImageSource,ToolResultContentBlock,ContentBlock,SystemContentBlock,ToolChoice,ToolInputSchema,Tool,ConverseOutput,ContentBlockDelta,ContentBlockStart,ConverseStreamOutput,ResponseStream;(GuardrailContentBlock||(GuardrailContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):t._(e.$unknown[0],e.$unknown[1]);class InternalServerException extends BedrockRuntimeServiceException{constructor(e){super({name:"InternalServerException",$fault:"server",...e}),this.name="InternalServerException",this.$fault="server",Object.setPrototypeOf(this,InternalServerException.prototype)}}class ResourceNotFoundException extends BedrockRuntimeServiceException{constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,ResourceNotFoundException.prototype)}}class ServiceQuotaExceededException extends BedrockRuntimeServiceException{constructor(e){super({name:"ServiceQuotaExceededException",$fault:"client",...e}),this.name="ServiceQuotaExceededException",this.$fault="client",Object.setPrototypeOf(this,ServiceQuotaExceededException.prototype)}}class ThrottlingException extends BedrockRuntimeServiceException{constructor(e){super({name:"ThrottlingException",$fault:"client",...e}),this.name="ThrottlingException",this.$fault="client",Object.setPrototypeOf(this,ThrottlingException.prototype)}}class ValidationException extends BedrockRuntimeServiceException{constructor(e){super({name:"ValidationException",$fault:"client",...e}),this.name="ValidationException",this.$fault="client",Object.setPrototypeOf(this,ValidationException.prototype)}}(DocumentSource||(DocumentSource={})).visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1]),(GuardrailConverseContentBlock||(GuardrailConverseContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):t._(e.$unknown[0],e.$unknown[1]),(ImageSource||(ImageSource={})).visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1]),(ToolResultContentBlock||(ToolResultContentBlock={})).visit=(e,t)=>void 0!==e.json?t.json(e.json):void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):t._(e.$unknown[0],e.$unknown[1]),(ContentBlock||(ContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):void 0!==e.toolUse?t.toolUse(e.toolUse):void 0!==e.toolResult?t.toolResult(e.toolResult):void 0!==e.guardContent?t.guardContent(e.guardContent):t._(e.$unknown[0],e.$unknown[1]),(SystemContentBlock||(SystemContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.guardContent?t.guardContent(e.guardContent):t._(e.$unknown[0],e.$unknown[1]),(ToolChoice||(ToolChoice={})).visit=(e,t)=>void 0!==e.auto?t.auto(e.auto):void 0!==e.any?t.any(e.any):void 0!==e.tool?t.tool(e.tool):t._(e.$unknown[0],e.$unknown[1]),(ToolInputSchema||(ToolInputSchema={})).visit=(e,t)=>void 0!==e.json?t.json(e.json):t._(e.$unknown[0],e.$unknown[1]),(Tool||(Tool={})).visit=(e,t)=>void 0!==e.toolSpec?t.toolSpec(e.toolSpec):t._(e.$unknown[0],e.$unknown[1]),(ConverseOutput||(ConverseOutput={})).visit=(e,t)=>void 0!==e.message?t.message(e.message):t._(e.$unknown[0],e.$unknown[1]);class ModelErrorException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelErrorException",$fault:"client",...e}),this.name="ModelErrorException",this.$fault="client",Object.setPrototypeOf(this,ModelErrorException.prototype),this.originalStatusCode=e.originalStatusCode,this.resourceName=e.resourceName}}class ModelNotReadyException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelNotReadyException",$fault:"client",...e}),this.name="ModelNotReadyException",this.$fault="client",Object.setPrototypeOf(this,ModelNotReadyException.prototype)}}class ModelTimeoutException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelTimeoutException",$fault:"client",...e}),this.name="ModelTimeoutException",this.$fault="client",Object.setPrototypeOf(this,ModelTimeoutException.prototype)}}class ServiceUnavailableException extends BedrockRuntimeServiceException{constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),this.name="ServiceUnavailableException",this.$fault="server",Object.setPrototypeOf(this,ServiceUnavailableException.prototype)}}(ContentBlockDelta||(ContentBlockDelta={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.toolUse?t.toolUse(e.toolUse):t._(e.$unknown[0],e.$unknown[1]),(ContentBlockStart||(ContentBlockStart={})).visit=(e,t)=>void 0!==e.toolUse?t.toolUse(e.toolUse):t._(e.$unknown[0],e.$unknown[1]);class ModelStreamErrorException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelStreamErrorException",$fault:"client",...e}),this.name="ModelStreamErrorException",this.$fault="client",Object.setPrototypeOf(this,ModelStreamErrorException.prototype),this.originalStatusCode=e.originalStatusCode,this.originalMessage=e.originalMessage}}(ConverseStreamOutput||(ConverseStreamOutput={})).visit=(e,t)=>void 0!==e.messageStart?t.messageStart(e.messageStart):void 0!==e.contentBlockStart?t.contentBlockStart(e.contentBlockStart):void 0!==e.contentBlockDelta?t.contentBlockDelta(e.contentBlockDelta):void 0!==e.contentBlockStop?t.contentBlockStop(e.contentBlockStop):void 0!==e.messageStop?t.messageStop(e.messageStop):void 0!==e.metadata?t.metadata(e.metadata):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1]),(ResponseStream||(ResponseStream={})).visit=(e,t)=>void 0!==e.chunk?t.chunk(e.chunk):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.modelTimeoutException?t.modelTimeoutException(e.modelTimeoutException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1]);const InvokeModelRequestFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelResponseFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelWithResponseStreamRequestFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelWithResponseStreamResponseFilterSensitiveLog=e=>({...e,...e.body&&{body:"STREAMING_CONTENT"}}),se_InvokeModelCommand=async(e,t)=>{const n=requestBuilder(e,t),i=map$1({},isSerializableHeaderValue,{[_ct]:e[_cT]||"application/octet-stream",[_a]:e[_a],[_xabt]:e[_t],[_xabg]:e[_gI],[_xabg_]:e[_gV]});let r;return n.bp("/model/{modelId}/invoke"),n.p("modelId",(()=>e.modelId),"{modelId}",!1),void 0!==e.body&&(r=e.body),n.m("POST").h(i).b(r),n.build()},se_InvokeModelWithResponseStreamCommand=async(e,t)=>{const n=requestBuilder(e,t),i=map$1({},isSerializableHeaderValue,{[_ct]:e[_cT]||"application/octet-stream",[_xaba]:e[_a],[_xabt]:e[_t],[_xabg]:e[_gI],[_xabg_]:e[_gV]});let r;return n.bp("/model/{modelId}/invoke-with-response-stream"),n.p("modelId",(()=>e.modelId),"{modelId}",!1),void 0!==e.body&&(r=e.body),n.m("POST").h(i).b(r),n.build()},de_InvokeModelCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_CommandError(e,t);const n=map$1({$metadata:deserializeMetadata(e),[_cT]:[,e.headers[_ct]]}),i=await collectBody(e.body,t);return n.body=i,n},de_InvokeModelWithResponseStreamCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_CommandError(e,t);const n=map$1({$metadata:deserializeMetadata(e),[_cT]:[,e.headers[_xabct]]}),i=e.body;return n.body=de_ResponseStream(i,t),n},de_CommandError=async(e,t)=>{const n={...e,body:await parseJsonErrorBody(e.body,t)},i=loadRestJsonErrorCode(e,n.body);switch(i){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await de_AccessDeniedExceptionRes(n);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await de_InternalServerExceptionRes(n);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await de_ResourceNotFoundExceptionRes(n);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await de_ServiceQuotaExceededExceptionRes(n);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await de_ThrottlingExceptionRes(n);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await de_ValidationExceptionRes(n);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await de_ModelErrorExceptionRes(n);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await de_ModelNotReadyExceptionRes(n);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await de_ModelTimeoutExceptionRes(n);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(n);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await de_ModelStreamErrorExceptionRes(n);default:const t=n.body;return throwDefaultError({output:e,parsedBody:t,errorCode:i})}},throwDefaultError=withBaseException(BedrockRuntimeServiceException),de_AccessDeniedExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new AccessDeniedException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_InternalServerExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new InternalServerException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelErrorExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString,originalStatusCode:expectInt32,resourceName:expectString});Object.assign(n,r);const s=new ModelErrorException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelNotReadyExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ModelNotReadyException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelStreamErrorExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString,originalMessage:expectString,originalStatusCode:expectInt32});Object.assign(n,r);const s=new ModelStreamErrorException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelTimeoutExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ModelTimeoutException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ResourceNotFoundExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ResourceNotFoundException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ServiceQuotaExceededExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ServiceQuotaExceededException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ServiceUnavailableExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ServiceUnavailableException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ThrottlingExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ThrottlingException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ValidationExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ValidationException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ResponseStream=(e,t)=>t.eventStreamMarshaller.deserialize(e,(async n=>null!=n.chunk?{chunk:await de_PayloadPart_event(n.chunk,t)}:null!=n.internalServerException?{internalServerException:await de_InternalServerException_event(n.internalServerException,t)}:null!=n.modelStreamErrorException?{modelStreamErrorException:await de_ModelStreamErrorException_event(n.modelStreamErrorException,t)}:null!=n.validationException?{validationException:await de_ValidationException_event(n.validationException,t)}:null!=n.throttlingException?{throttlingException:await de_ThrottlingException_event(n.throttlingException,t)}:null!=n.modelTimeoutException?{modelTimeoutException:await de_ModelTimeoutException_event(n.modelTimeoutException,t)}:null!=n.serviceUnavailableException?{serviceUnavailableException:await de_ServiceUnavailableException_event(n.serviceUnavailableException,t)}:{$unknown:e})),de_InternalServerException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_InternalServerExceptionRes(n)},de_ModelStreamErrorException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ModelStreamErrorExceptionRes(n)},de_ModelTimeoutException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ModelTimeoutExceptionRes(n)},de_PayloadPart_event=async(e,t)=>{const n={},i=await parseJsonBody(e.body,t);return Object.assign(n,de_PayloadPart(i,t)),n},de_ServiceUnavailableException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ServiceUnavailableExceptionRes(n)},de_ThrottlingException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ThrottlingExceptionRes(n)},de_ValidationException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ValidationExceptionRes(n)},de_PayloadPart=(e,t)=>take(e,{bytes:t.base64Decoder}),deserializeMetadata=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),isSerializableHeaderValue=e=>!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size),_a="accept",_cT="contentType",_ct="content-type",_gI="guardrailIdentifier",_gV="guardrailVersion",_t="trace",_xaba="x-amzn-bedrock-accept",_xabct="x-amzn-bedrock-content-type",_xabg="x-amzn-bedrock-guardrailidentifier",_xabg_="x-amzn-bedrock-guardrailversion",_xabt="x-amzn-bedrock-trace";class InvokeModelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,n,i){return[getSerdePlugin(n,this.serialize,this.deserialize),getEndpointPlugin(n,e.getEndpointParameterInstructions())]})).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(InvokeModelRequestFilterSensitiveLog,InvokeModelResponseFilterSensitiveLog).ser(se_InvokeModelCommand).de(de_InvokeModelCommand).build()){}class InvokeModelWithResponseStreamCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,n,i){return[getSerdePlugin(n,this.serialize,this.deserialize),getEndpointPlugin(n,e.getEndpointParameterInstructions())]})).s("AmazonBedrockFrontendService","InvokeModelWithResponseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","InvokeModelWithResponseStreamCommand").f(InvokeModelWithResponseStreamRequestFilterSensitiveLog,InvokeModelWithResponseStreamResponseFilterSensitiveLog).ser(se_InvokeModelWithResponseStreamCommand).de(de_InvokeModelWithResponseStreamCommand).build()){}class AWSTextAdapter extends AITextAdapter{static get pluginName(){return"AWSTextAdapter"}constructor(e){super(e),e.config.get("ai.aws.requestParameters")||e.config.define("ai.aws.requestParameters",{model:"anthropic.claude-v2",max_tokens_to_sample:2e3,temperature:1,top_p:1,top_k:250,anthropic_version:"bedrock-2023-05-31",stream:!0}),this._apiUrl=e.config.get("ai.aws.apiUrl"),this._bedrockClientConfig=e.config.get("ai.aws.bedrockClientConfig"),this._requestHeaders=e.config.get("ai.aws.requestHeaders"),this._requestParameters=e.config.get("ai.aws.requestParameters")}async sendRequest({query:e,context:t,onData:n,actionId:i}){const{model:r,stream:s,...o}=await this._prepareRequestParameters(this._requestParameters,i),a={prompt:await this.preparePrompt(e,t,r,i),...o};this._apiUrl?await this._processProxyRequest(a,r,s,n,i):await this._processAWSRequest(a,r,s,n)}async preparePrompt(e,t,n,i){let r,s;return t?(r="Your task is to execute the instruction using the provided HTML content. Follow the instruction closely. Your answer must be a properly formatted HTML code. Do not add any additional remarks or notes. The main language you use in speaking is Indonesian.",s="Instruction:\n"+e+"\nYou must keep the text formatting.\n\nContent:\n"+t):(r="Your task is to generate HTML content accordingly to the given instruction. Your answer must be a well-structured and properly formatted HTML code. Answer only with the generated HTML content. Do not add any additional remarks or notes. The main language you use in speaking is Indonesian.",s=e),"meta.llama"==this.getModelFamily(n)?"<<SYS>>\n"+r+"\n<</SYS>>\n[INST]\n"+s+"\n[/INST]":"Human:\n"+r+"\n"+s+"\n\nAssistant:"}getModelFamily(e){if(/^anthropic\.claude/.test(e))return"anthropic.claude";if(/^ai21\.j2/.test(e))return"ai21.j2";if(/^cohere\.command/.test(e))return"cohere.command";if(/^meta\.llama/.test(e))return"meta.llama";throw new AIRequestError(getTranslation$f(this.editor.locale,"AI_ERROR_UNSUPPORTED_MODEL",e))}async _processProxyRequest(e,t,n,i,r){const s={method:"POST",headers:await this._prepareRequestHeaders(this._requestHeaders,r),body:JSON.stringify({...e,model:t,stream:n}),signal:this.abortController.signal},o=await fetch(this._apiUrl,s);n?await this._readStreamableResponse(o,t,i):await this._readStaticResponse(o,t,i)}async _processAWSRequest(e,t,n,i){const r=new BedrockRuntimeClient(this._bedrockClientConfig),s={body:JSON.stringify(e),contentType:"application/json",accept:"application/json",modelId:t};let o;if(n){const e=new InvokeModelWithResponseStreamCommand(s);o=await r.send(e,{abortSignal:this.abortController.signal}),await this._readAsyncIterableResponse(o,t,i)}else{const e=new InvokeModelCommand(s);o=await r.send(e,{abortSignal:this.abortController.signal}),await this._readStaticResponse(o,t,i)}}async _readAsyncIterableResponse(e,t,n){const i=e.body,r=new TextDecoder("utf-8");let s="";for await(const e of i)if(e.chunk){const i=r.decode(e.chunk.bytes),o=JSON.parse(i);s+=this._getGeneratedText(o,t),n(s)}return Promise.resolve()}async _readStreamableResponse(e,t,n){const i=e.body,r=new TextDecoder("utf-8"),s=i.getReader();let o="",a="",c=!1;for(;!c;){const{done:e,value:i}=await s.read();if(c=e,c)break;const l=(o+r.decode(i)).split("\n").map((e=>{try{return o="",JSON.parse(e)}catch(t){return o=e,null}})).filter((e=>null!==e));l.length&&(a+=l.map((e=>this._getGeneratedText(e,t))).join(""),n(a))}return Promise.resolve()}async _readStaticResponse(e,t,n){let i;return i=e instanceof Response?await e.json():JSON.parse(Buffer.from(e.body).toString("utf8")),n(this._getGeneratedText(i,t)),Promise.resolve()}_getGeneratedText(e,t){switch(this.getModelFamily(t)){case"anthropic.claude":return e.completion;case"ai21.j2":return e.completions[0].data.text;case"cohere.command":return e.generations[0].text;case"meta.llama":return e.generation}}}class CaseChangeCommand extends _0x354f99{constructor(e,t){super(e),this._transformCallback=t}execute(){const e=this.editor.model,t=Array.from(this._getAffectedRanges()),n=Array.from(e.document.selection.getRanges());e.change((e=>{for(const n of t)this._modifyContent(n,e);e.setSelection(n)}))}refresh(){for(const e of this._getAffectedRanges())for(const t of e)if(t.item.is("$textProxy"))return void(this.isEnabled=!0);this.isEnabled=!1}_getAffectedRanges(){const e=this.editor.model,t=e.document.selection;if(t.isCollapsed){const n=this._findAncestorTextBlock(t.getFirstPosition().parent);return n?[e.createRangeIn(n)]:[]}return t.getRanges()}_modifyContent(e,t){for(const n of this._getElementsAllowingText(e)){const i=this._getElementTextContent(n),r=this._transformCallback(i);for(const i of this._getTextNodesRangeLimited(n,e))this._replaceTextNodeData(i,r,t)}}_findAncestorTextBlock(e){const t=this.editor.model.schema;if(e.is("element")&&t.checkChild(e,"$text"))return e;const n=e.parent;return!n||t.isLimit(e)?null:this._findAncestorTextBlock(n)}*_getElementsAllowingText(e){const t=new Set;for(const{item:n}of e.getWalker()){const e=this._findAncestorTextBlock(n);e&&!t.has(e)&&(t.add(e),yield e)}}_getElementTextContent(e){return Array.from(e.getChildren()).reduce(((e,t)=>e+(t.is("$text")?t.data:" ")),"")}*_getTextNodesRangeLimited(e,t){const n=t.getIntersection(this.editor.model.createRangeIn(e));if(n)for(const t of n.getItems())t.is("$textProxy")&&t.parent==e&&(yield t)}_replaceTextNodeData(e,t,n){const i=t.substring(e.startOffset,e.endOffset);if(i===e.data)return;const r=e.getAttributes();this.editor.model.insertContent(n.createText(i,r),n.createSelection(n.createRangeOn(e)))}}function getTranslation$e(e,t,...n){const i=e.t;switch(t){case"Case change":return i("Case change");case"UPPERCASE":return i("UPPERCASE");case"lowercase":return i("lowercase");case"Title Case":return i("Title Case");case"Change text case":return i("Change text case");case"Changed case to %0":return i("Changed case to %0",...n);default:return t}}class CaseChangeEditing extends Plugin{constructor(){super(...arguments),this._currentCommandIndex=0}static get pluginName(){return"CaseChangeEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.locale.contentLanguage,n=normalizeExcludeWordCallback(e.config.get("caseChange.titleCase.excludeWords")),i={changeCaseUpper:new CaseChangeCommand(e,(e=>e.toLocaleUpperCase(t))),changeCaseLower:new CaseChangeCommand(e,(e=>e.toLocaleLowerCase(t))),changeCaseTitle:new CaseChangeCommand(e,(e=>capitalizeText(e,n,t)))};for(const[t,n]of Object.entries(i))e.commands.add(t,n),n.on("execute",(()=>{this._announceCaseChangeOperation(t)}));this.listenTo(e.editing.view.document,"selectionChange",(()=>{this._currentCommandIndex=0})),e.keystrokes.set("shift+f3",((t,n)=>{const i=_getOptions(this.editor.locale),r=i[this._currentCommandIndex%i.length].commandName;e.execute(r),this._currentCommandIndex++,n()}))}afterInit(){checkLicense$c(this)}_announceCaseChangeOperation(e){const{ui:t,locale:n}=this.editor,i=_getOptions(n).find((t=>t.commandName===e)).label.toLowerCase();t.ariaLiveAnnouncer.announce(getTranslation$e(n,"Changed case to %0",i))}}function _getOptions(e){return[{label:getTranslation$e(e,"UPPERCASE"),commandName:"changeCaseUpper"},{label:getTranslation$e(e,"lowercase"),commandName:"changeCaseLower"},{label:getTranslation$e(e,"Title Case"),commandName:"changeCaseTitle"}]}function capitalizeText(e,t,n){return replaceWords(e,((i,r,s)=>{const o=i.toLocaleLowerCase(n);return t(o,{charOffset:r,wordIndex:s,blockText:e})?o:o.replace(/(?:^|[^\p{L}\d'])\p{L}/gu,(e=>e.toLocaleUpperCase(n)))}))}function replaceWords(e,t){let n="",i=0,r=0;for(const s of e.matchAll(/ +/g)){const o=s.index,a=e.substring(i,o);a.length&&(n+=t(a,i,r++)),n+=s[0],i=o+s[0].length}const s=e.substring(i);return s.length&&(n+=t(s,i,r)),n}function normalizeExcludeWordCallback(e=[]){return"function"==typeof e?e:(t,{wordIndex:n})=>n>0&&e.includes(t)}async function checkLicense$c(e){const t=g([113,89,74,75,68,122,106,114,52,119,117,65,49,98,104,81,66,78,51,85,116,102,103,55,77,120,109,50,86,53,67,70,57,56,118,88,105,82,80,97,115,54,83,73,72,100,84,112,101,99,87,76,79,121,90,71,69,108,107,48,111,110]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU0MjA4Nzl9.eyJqdGkiOjgwMjc1NTIyODAsImFsZyI6IkVTMjU2IiwiaWR4IjozOTA5NTg4NDY1Nzk1LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiI4YTZjNmI0Ni05NjJhLTRkZTQtODcwNy1hNTAwN2RkNWM5MGIiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NDIwODc5LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTQyMH0.gddWsWnI4Md_JC89vjhJOuUFRWj2x7p-MGxxZtstkOB4Fu8HvL2h3RSEssZTgVi4A-QPTNnzdw_hOtAXiUg-IA"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([113]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([67,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class CaseChangeUI extends Plugin{static get pluginName(){return"CaseChangeUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;this._registerComponents(),e.accessibility.addKeystrokeInfos({keystrokes:[{label:getTranslation$e(e.locale,"Change text case"),keystroke:"Shift+f3",mayRequireFn:!0}]}),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("caseChangeLicenseKeyValid"==r||"caseChangeLicenseKeyInvalid"==r||"caseChangeLicenseKeyExpired"==r||"caseChangeLicenseKeyDomainLimit"==r||"caseChangeLicenseKeyNotAllowed"==r||"caseChangeLicenseKeyEvaluationLimit"==r||"caseChangeLicenseKeyTrialLimit"==r||"caseChangeLicenseKeyDevelopmentLimit"==r||"caseChangeLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"caseChangeLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"caseChangeLicenseKeyExpired"==e&&t._showLicenseError("expired"),"caseChangeLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"caseChangeLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","CaseChange"),"caseChangeLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"caseChangeLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"caseChangeLicenseKeyDevelopmentLimit"==e&&t._showLicenseError("developmentLimit"),"caseChangeLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_registerComponents(){const e=this.editor,{itemDefinitions:t,commands:n}=this._getListItemDefinitionsAndCommands();e.ui.componentFactory.add("caseChange",(()=>this._createDropdownView(t,n))),e.ui.componentFactory.add("menuBar:caseChange",(()=>this._createMenuBarMenuView(t,n)))}_createMenuBarMenuView(e,t){const n=this.editor,i=n.locale,r=new MenuBarMenuView(i),s=new MenuBarMenuListView(i);s.set({ariaLabel:getTranslation$e(i,"Case change"),role:"menu"}),this._setButtonProperties(r.buttonView),r.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e))));for(const t of e){const e=new MenuBarMenuListItemView(i,r),o=new MenuBarMenuListItemButtonView(i);o.delegate("execute").to(r),o.bind(...Object.keys(t.model)).to(t.model),o.on("execute",(()=>{n.execute(t.model.commandName),n.editing.view.focus()})),e.children.add(o),s.items.add(e)}return r.panelView.children.add(s),r}_createDropdownView(e,t){const n=this.editor,i=createDropdown(n.locale);return this._setButtonProperties(i.buttonView),i.buttonView.set({tooltip:!0}),i.extendTemplate({attributes:{class:["ck-case-change-dropdown"]}}),addListToDropdown(i,e,{ariaLabel:getTranslation$e(n.locale,"Case change"),role:"menu"}),i.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e)))),this.listenTo(i,"execute",(e=>{n.execute(e.source.commandName),n.editing.view.focus()})),i}_setButtonProperties(e){const t=this.editor;e.set({label:getTranslation$e(t.locale,"Case change"),icon:icons.caseChange,keystroke:"Shift+F3"})}_getListItemDefinitionsAndCommands(){const e=new Collection,t=[];for(const n of _getOptions(this.editor.locale)){const i=this.editor.commands.get(n.commandName),r=new ViewModel({commandName:n.commandName,label:n.label,role:"menuitemradio",withText:!0});r.bind("isEnabled").to(i,"isEnabled"),e.add({type:"button",model:r}),t.push(i)}return{itemDefinitions:e,commands:t}}}class CaseChange extends Plugin{static get requires(){return[CaseChangeEditing,CaseChangeUI]}static get pluginName(){return"CaseChange"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CommentThreadController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super(),this.model=e,this.model._isAttached=!0,this.view=t,this.listenTo(t,"submitCommentThread",(()=>this.submit())),this.listenTo(t,"removeCommentThread",(()=>this.remove())),this.listenTo(t,"resolveCommentThread",(()=>this.resolve())),this.listenTo(t,"reopenCommentThread",(()=>this.reopen())),this.listenTo(t,"addComment",((e,t)=>this.addComment(t))),this.listenTo(t,"updateComment",((e,t,n)=>this.updateComment(t,n))),this.listenTo(t,"removeComment",((e,t)=>this.removeComment(t)))}submit(){this.model.submit()}remove(){this.model.remove()}resolve(){this.model.isResolved||this.model.resolve()}reopen(){this.model.isResolved&&this.model.reopen()}addComment(e){this.model.addComment({content:e,authorId:this.view._localUser.id})}updateComment(e,t){this.model.getComment(e).update({content:t})}removeComment(e){this.model.getComment(e).remove()}destroy(){this.stopListening(),this.model._isAttached=!1}}function getTranslation$d(e,t,n){const i=e.t;switch(t){case"PENDING_ACTION_COMMENT_THREAD":return i({string:"Unsaved change in comment thread.",id:"PENDING_ACTION_COMMENT_THREAD"});case"Comment":return i("Comment");case"Reply...":return i("Reply...");case"Reply to reopen discussion...":return i("Reply to reopen discussion...");case"Write a comment...":return i("Write a comment...");case"Comment was made on an element":return i("Comment was made on an element");case"Comment editor":return i("Comment editor");case"Delete comment thread?":return i("Delete comment thread?");case"Delete comment?":return i("Delete comment?");case"Marked as resolved":return i("Marked as resolved");case"Show more items":return i("Show more items");case"Cancel":return i("Cancel");case"Edit":return i("Edit");case"Resolve":return i("Resolve");case"Reopen":return i("Reopen");case"Remove":return i("Remove");case"Reply":return i("Reply");case"Save":return i("Save");case"Annotations sidebar":return i("Annotations sidebar");case"Annotations list":return i("Annotations list");case"Thread comments":return i("Thread comments");case"THREAD_CONTEXT_LABEL":return i({string:"Thread context: %0",id:"THREAD_CONTEXT_LABEL"},n);case"COMMENT_THREAD_LABEL":return i({string:"Comment thread by %1. %1 reply.",plural:"Comment thread by %1. %0 replies.",id:"COMMENT_THREAD_LABEL"},n);case"COMMENT_THREAD_DESCRIPTION":return i({string:"Press Enter for more options. Press Escape to exit.",id:"COMMENT_THREAD_DESCRIPTION"});case"COMMENT_ARIA_LABEL":return i({string:"Comment by %0. Created on %1. %2. %3",id:"COMMENT_ARIA_LABEL"},n);case"LEAVE_COMMENT_ANNOUNCEMENT":return i({string:"Leaving a content with comments.",id:"LEAVE_COMMENT_ANNOUNCEMENT"});case"ENTER_COMMENT_ANNOUNCEMENT":return i({string:"Entering a content with comments. Press %0 to go to the discussion.",id:"ENTER_COMMENT_ANNOUNCEMENT"},n);case"NUMBER_OF_COMMENTS":return i({string:"%0 Comment",plural:"%0 Comments",id:"NUMBER_OF_COMMENTS"},n);case"TOO_LONG_COMMENT_ALERT":return i({string:"Comment content is too long. Your comment has %0 characters but the limit is %1 characters.",id:"TOO_LONG_COMMENT_ALERT"},n);case"EXTERNAL_COMMENT":return i({string:"This comment comes from an external source.",id:"EXTERNAL_COMMENT"});case"EXTERNAL_IMPORT_WORD_COMMENT":return i({string:"This comment comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_COMMENT"});case"EXTERNAL_AVATAR":return i({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},n);case"EXTERNAL_IMPORT_WORD_AVATAR":return i({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},n);case"COMMENTS_ARCHIVE":return i({string:"Comments archive",id:"COMMENTS_ARCHIVE"});case"EMPTY_COMMENTS_ARCHIVE":return i({string:"There are no archived comment threads.",id:"EMPTY_COMMENTS_ARCHIVE"});case"COMMENTS_ARCHIVE_LIST_LABEL":return i({string:"List of comments",id:"COMMENTS_ARCHIVE_LIST_LABEL"});case"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP":return i({string:"Keystrokes for interacting with annotation threads (e.g. comments, track changes suggestions)",id:"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP"});case"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO":return i({string:"Move focus to the thread when the selection is anchored in its marker",id:"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO"});case"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT":return i({string:"Exit the annotation and move focus back to the edited content",id:"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT"});case"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER":return i({string:"Browse the focused annotation thread or thread comment",id:"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER"});case"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS":return i({string:"Move across internals of the annotation thread",id:"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS"});case"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT":return i({string:"Submit the reply while writing a comment",id:"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT"});case"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS":return i({string:"Move to the previous or next thread in the annotations sidebar or comments archive",id:"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS"});default:return""}}class CommentEditorUIView extends EditorUIView{constructor(e,t){super(e);const n=uid();this.main=this.createCollection(),this.editable=new InlineEditableUIView(e,t,void 0,{label:()=>getTranslation$d(e,"Comment editor")}),this.setTemplate({tag:"div",attributes:{class:["ck-reset","ck-editor","ck-rounded-corners","ck-comment__input"],dir:e.uiLanguageDirection,lang:e.uiLanguage,"aria-labelledby":"cke-editor__aria-label_"+n},children:[{tag:"div",attributes:{class:"ck-editor__main",role:"presentation"},children:this.main}]})}render(){super.render(),this.main.add(this.editable)}focus(){this.editable.element.focus()}}class CommentEditorUI extends EditorUI{constructor(e){super(e),this.view=new CommentEditorUIView(e.locale,e.editing.view)}get element(){return this.view.element}init(){const e=this.editor.editing.view,t=this.view.editable,n=e.document.getRoot();t.name=n.rootName,this.view.render();const i=t.element;this.setEditableElement(t.name,i),this.view.editable.bind("isFocused").to(this.focusTracker),e.attachDomRoot(i),this.fire("ready")}destroy(){super.destroy(),this.view.destroy()}}const defaultPlugins=[Clipboard,Enter,ShiftEnter,SelectAll,Typing,Undo,Paragraph];class CommentEditor extends(/*   -- @preserve */
ObservableMixin(Editor)){constructor(e={}){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}(e=Object.assign({},e)).plugins||(e.plugins=CommentEditor.defaultPlugins),super(e),this.ui=new CommentEditorUI(this),this.set("placeholder",""),this.model.document.on("change",(()=>this._updatePlaceholder()),{priority:"low"}),this.on("change:placeholder",(()=>this._updatePlaceholder())),this.model.document.createRoot(),this[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),this[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}create(){const e=this.config.get("initialData")||"";return this.initPlugins().then((()=>this.ui.init())).then((()=>this.data.init(e))).then((()=>this.fire("ready")))}destroy(){return super.destroy().then((()=>this.ui.destroy()))}focus(){this.model.change((e=>{const t=this.model.document.getRoot(),n=t&&t.getChild(t.childCount-1);e.setSelection(n,"end"),this.editing.view.focus()}))}_updatePlaceholder(){const e=this.editing.view,t=e.document.getRoot(),n=t.getChild(0);t.childCount>1||!n||"p"!=n.name?this.placeholderElement&&this.placeholderElement.placeholder&&(disablePlaceholder(e,this.placeholderElement),this.placeholderElement=void 0):(this.placeholder&&(n.placeholder=this.placeholder),enablePlaceholder({view:e,element:n,keepOnFocus:!0}),this.placeholderElement=n)}}CommentEditor.defaultPlugins=defaultPlugins;class CommentInputView extends View{constructor(e,t={}){super(e),this.editor=null,this._editorConfig=t,this.set("value",t.initialData||""),this.set("disabledSubmit",!1),this.set("showButtons",!0),this.set("placeholder",getTranslation$d(e,"Reply...")),this.set("submitLabel",getTranslation$d(e,"Reply")),this.submitButtonView=this._createSubmitButton(),this.cancelButtonView=this._createCancelButton(),this.focusables=this.createCollection([this.submitButtonView,this.cancelButtonView]),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-wrapper"]},children:[{tag:"div",attributes:{class:["ck-comment__input-actions",this.bindTemplate.if("showButtons","ck-comment__input-actions--active")]},children:[this.submitButtonView,this.cancelButtonView]}]}),this.keystrokes.set("Esc",((e,t)=>{this.cancelButtonView.fire("execute"),t()})),this.keystrokes.set("Ctrl+Enter",((e,t)=>{this.submitButtonView.isEnabled&&(this.submitButtonView.fire("execute"),t())})),this.on("submit",((t,n)=>{n.length>65e3?(alert(getTranslation$d(e,"TOO_LONG_COMMENT_ALERT",[n.length,65e3])),t.stop()):this.editor.setData("")}),{priority:"high"})}render(){super.render(),this._setupKeyboardNavigation()}createEditor(){return this.editor||(this.editor=new CommentEditor(this._editorConfig),this._editorCreationPromise=this.editor.create().then((()=>{if(this._isDestroyed)return;const e=this.editor;this.element.insertBefore(e.ui.element,this.element.firstChild),e.model.document.on("change",(()=>this.value=e.getData())),e.bind("placeholder").to(this),this.focusables.add(e.ui.view,0),this.fire("editorReady",this.editor)}))),this._editorCreationPromise}focus(e){-1===e?(this.focusCycler.focusFirst(),this.focusCycler.focusLast()):this.focusCycler.focusFirst()}async destroy(){this._isDestroyed||(this._isDestroyed=!0,this.editor&&(await this._editorCreationPromise,await this.editor.destroy(),this.fire("editorDestroyed",this.editor)),await super.destroy())}_createSubmitButton(){const{locale:e}=this,t=new ButtonView(e);return t.extendTemplate({attributes:{class:["ck-comment__input-actions--submit"]}}),t.withText=!0,t.bind("label").to(this,"submitLabel"),t.on("execute",(()=>{this.fire("submit",this.value)})),t.bind("isEnabled").to(this,"value",this,"disabledSubmit",((e,t)=>!t&&!!e.trim())),t}_createCancelButton(){const{locale:e}=this,t=new ButtonView(e);return t.extendTemplate({attributes:{class:["ck-comment__input-actions--cancel"]}}),t.label=getTranslation$d(e,"Cancel"),t.withText=!0,t.on("execute",(()=>{this.editor.setData(""),this.fire("cancel")})),t}_setupKeyboardNavigation(){this.keystrokes.listenTo(this.element),this.focusables.forEach((e=>{this.focusTracker.add(e.element)})),this.focusables.on("change",((e,t)=>{for(const e of Array.from(t.added).reverse())this.focusTracker.add(e.element)}))}}class CommentThreadInputView extends View{constructor(e,t,n){super(e),this.commentInputView=new CommentInputView(e,n),this.focusCycler=this.commentInputView.focusCycler,this.commentInputView.bind("showButtons").to(this.commentInputView.focusTracker,"isFocused",this.commentInputView,"value",((e,t)=>e||!!t)),this.set("showInput",!1),this.on("change:showInput",(()=>{this.showInput&&!this.commentInputView.editor&&this.commentInputView.createEditor()})),this.commentInputView.delegate("editorReady").to(this),this.commentInputView.delegate("editorDestroyed").to(this),this.userView=new UserView(e,t),this.userView.extendTemplate({attributes:{class:"ck-thread__user","aria-hidden":!0}}),this.commentInputView.extendTemplate({attributes:{class:"ck-thread__input"}}),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-container",this.bindTemplate.if("showInput","ck-comment__input-container--active")]},children:[this.userView,this.commentInputView]})}render(){super.render(),this._focusOnNonInteractiveMouseDown()}destroy(){return this.commentInputView.destroy().then((()=>super.destroy()))}focus(e){this.commentInputView.focus(e)}_focusOnNonInteractiveMouseDown(){this.listenTo(this.element,"mousedown",((e,t)=>{const{submitButtonView:n,cancelButtonView:i,editor:r}=this.commentInputView;[n.element,i.element,r?r.editing.view.getDomRoot():null].filter((e=>e)).some((e=>e.contains(t.target)))||(this.focus(),t.preventDefault())}))}}class CollapsedCommentsView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("count",void 0),this.setTemplate({tag:"li",attributes:{class:"ck-thread__comment-count"},children:[{text:t.to("count",(t=>getTranslation$d(e,"NUMBER_OF_COMMENTS",t)))}]})}}class CommentsListView extends View{constructor(e,t,n){super(e);const i=this.bindTemplate;this.set("hasDirtyComment",!1),this.set("length",t.comments.length),this.set("isActive",!1),this._model=t,this._config=n,this.commentViews=this.createCollection(),this.visibleViews=this.createCollection(),this.resolvedCommentView=null,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.commentViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>this.commentViews.map((e=>e.element)).includes(e.target)},actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this._collapsedCommentsView=new CollapsedCommentsView(e),this._collapsedCommentsView.bind("count").to(this,"length",(e=>e-this._config.maxCommentsWhenCollapsed));for(const e of t.comments)this._handleNewCommentModel(e);this._handleInfoComment(),this.listenTo(t.comments,"add",((e,t)=>{const n=this._calculatePosition(t);this.length++,this._handleNewCommentModel(t,n),this.refreshVisibleViews()})),this.listenTo(t.comments,"remove",((e,t)=>{this.length--,this._handleRemoveCommentModel(t),this.refreshVisibleViews()})),this.listenTo(t,"commentUpdated",(()=>this.refreshVisibleViews())),this.listenTo(t,"change:isResolved",(()=>this._handleInfoComment())),this.on("change:isActive",(()=>this.refreshVisibleViews())),this.on("change:hasDirtyComment",(()=>this.refreshVisibleViews())),this.setTemplate({tag:"ul",attributes:{class:["ck-thread__comments",i.if("length","ck-hidden",(e=>!e))],"aria-label":getTranslation$d(e,"Thread comments")},children:this.visibleViews})}get _shouldCollapse(){return this._model.weight>this._config.maxThreadTotalWeight&&!this.isActive&&!this.hasDirtyComment}render(){super.render(),this.refreshVisibleViews(),this._setupKeyboardNavigation()}focus(e){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){this._collapsedCommentsView.destroy();for(const e of this.commentViews)e.destroy();super.destroy()}refreshVisibleViews(){this._shouldCollapse?this._rearrangeCollapse():this._rearrangeExpand()}_handleNewCommentModel(e,t){const n=new this._config.CommentView(this.locale,e,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig});n.viewUid=e.id,n.delegate("removeComment").to(this),n.delegate("updateComment").to(this),n.delegate("resolveCommentThread").to(this),n.delegate("editorReady").to(this),n.delegate("editorDestroyed").to(this),this.listenTo(n,"change:isEditMode",(()=>this._updateHasDirtyComment())),this.commentViews.add(n,t)}_calculatePosition(e){const t=this._model._findOptimalIndex(e);return this.resolvedCommentView?this.resolvedCommentView.authoredAt>e.authoredAt?t-1:t:t-1}_handleInfoComment(){if(this._model.resolvedBy&&this._model.resolvedAt){const e={id:"resolved",author:this._model.resolvedBy,authoredAt:this._model.resolvedAt,content:getTranslation$d(this.locale,"Marked as resolved"),attributes:{}};this.resolvedCommentView=new this._config.CommentView(this.locale,e,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig,isSystemComment:!0}),this.commentViews.add(this.resolvedCommentView,this._model._findOptimalIndex(e))}else this.resolvedCommentView&&(this.commentViews.remove(this.resolvedCommentView),this.resolvedCommentView.destroy(),this.resolvedCommentView=null);this.refreshVisibleViews()}_handleRemoveCommentModel(e){const t=this.commentViews.remove(e.id);this.stopListening(t),t.isEditMode&&this._updateHasDirtyComment(),t.destroy()}_updateHasDirtyComment(){this.hasDirtyComment=Array.from(this.commentViews).some((e=>e.isEditMode))}_rearrangeCollapse(){const e=cloneCollection(this.commentViews),t=this._collapsedCommentsView.count;for(let n=1;n<=t;n++)e.remove(1);for(const t of e)t.collapse();t>0&&e.add(this._collapsedCommentsView,1),applyDiffToCollection(diff(Array.from(this.visibleViews),Array.from(e)),this.visibleViews,e)}_rearrangeExpand(){applyDiffToCollection(diff(Array.from(this.visibleViews),Array.from(this.commentViews)),this.visibleViews,this.commentViews);for(const e of this.visibleViews)e.expand()}_setupKeyboardNavigation(){this.commentViews.forEach((e=>{this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)})),this.commentViews.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.keystrokes.stopListening(e.element);for(const e of Array.from(t.added).reverse())this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)}))}}function cloneCollection(e){const t=new Collection;for(const n of e)t.add(n);return t}function applyDiffToCollection(e,t,n){let i=0;for(const r of e)switch(r){case"insert":t.add(n.get(i),i),i++;break;case"delete":t.remove(i);break;case"equal":i++}}var undoIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>';class CommentThreadHeaderContextView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("contextValue",""),this.setTemplate({tag:"span",attributes:{class:["ck","ck-context__value"],"aria-label":t.to("contextValue",(t=>getTranslation$d(e,"THREAD_CONTEXT_LABEL",t))),tabindex:-1},children:[{text:t.to("contextValue")}]})}focus(){this.element.focus()}}const MAX_CONTENT_LENGTH=150;class CommentThreadHeaderView extends View{constructor(e,t){super(e);const n=this.bindTemplate;this._model=t,this.reopenButtonView=this._createReopenButton(),this.contextView=this._createContextView(),this.focusables=this.createCollection([this.contextView,this.reopenButtonView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.bind("hasContext").to(this._model,"context",(e=>!!e)),this.bind("contextValue").to(this._model,"context",(e=>e&&e.value?this._trimContextValue(e.value):getTranslation$d(this.locale,"Comment was made on an element"))),this.setTemplate({tag:"div",attributes:{class:["ck-thread__header"]},children:[{tag:"div",attributes:{class:["ck-context-wrapper"]},children:[{tag:"div",attributes:{class:["ck-context",n.if("hasContext","ck-context--quotes")]},children:[this.contextView]}]},{tag:"div",attributes:{class:["ck-annotation__actions"]},children:[this.reopenButtonView]}]})}render(){super.render(),this._attachContextActions(),this._setupKeyboardNavigation()}focus(){this.focusCycler.focusFirst()}_createReopenButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$d(this.locale,"Reopen"),e.tooltip=getTranslation$d(this.locale,"Reopen"),e.icon=undoIcon,e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",((e,t)=>e&&t)),e.on("execute",(()=>{this.fire("reopenCommentThread",this._model.id)})),e}_trimContextValue(e){const t=MAX_CONTENT_LENGTH-3;if(e.length<MAX_CONTENT_LENGTH)return e;const n=e.lastIndexOf(" ",t);return e.substring(0,n>-1?n:t)+"..."}_attachContextActions(){const e=this.element.querySelector(".ck-context"),t=e.querySelector(".ck-context__value");this.listenTo(e,"mouseenter",(()=>{t.offsetWidth<t.scrollWidth&&e.classList.add("overlay")})),this.listenTo(e,"mouseleave",(()=>{e.classList.remove("overlay")}))}_setupKeyboardNavigation(){this.keystrokes.listenTo(this.element);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)}_createContextView(){const e=new CommentThreadHeaderContextView(this.locale);return e.bind("contextValue").to(this),e}}class BaseCommentThreadView extends View{constructor(e,t,n,i){super(e),this.set("isActive",!1),this.set("isDirty",!1),this._model=t,this._localUser=n,this._config=i,this.commentThreadHeaderView=new CommentThreadHeaderView(e,t),this.commentThreadHeaderView.delegate("reopenCommentThread").to(this),this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation$d(e,"COMMENT_THREAD_DESCRIPTION")),this.listenTo(this,"reopenCommentThread",(()=>{this.focus()})),this.commentsListView=new CommentsListView(e,t,Object.assign({CommentView:this._config.CommentView},i)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.delegate("resolveCommentThread").to(this),this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this),this.commentsListView.bind("isActive").to(this),this.listenTo(this,"resolveCommentThread",(()=>{this.focus()})),this.set("length",this.commentsListView.length),this.bind("length").to(this.commentsListView,"length"),this.commentThreadInputView=this._createCommentThreadInputView(),this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this),this.on("removeComment",(()=>this.focus())),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",((e,t)=>e||!!t)),this.bind("isUnlinked").to(t,"unlinkedAt",(e=>!!e)),this.bind("ariaLabel").to(this,"length",(e=>{const t=this._model.comments.first?this._model.comments.first.author.name:this._localUser.name;return getTranslation$d(this.locale,"COMMENT_THREAD_LABEL",[e,t])})),this.focusables=this.createCollection([this.commentsListView,this.commentThreadInputView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}})}focus(){this.element.focus()}render(){super.render(),setupThreadKeyboardNavigation(this,this.focusables)}async destroy(){this.isDirty=!1,this.commentsListView.destroy(),await this.commentThreadInputView.destroy(),super.destroy()}_createCommentThreadInputView(){const e=new CommentThreadInputView(this.locale,this._localUser,this._config.editorConfig),t=e.commentInputView;return e.bind("showInput").to(this,"isActive",this._model,"isReadOnly",this._model,"canComment",this._model,"archivedAt",t,"value",((e,t,n,i,r)=>!!r||!!i&&n&&!t||e&&n&&!t)),t.bind("placeholder").to(this,"length",this._model,"isResolvable",this._model,"isResolved",((e,t,n)=>{let i;return i=n&&t?"Reply to reopen discussion...":e?"Reply...":"Write a comment...",getTranslation$d(this.locale,i)})),t.bind("submitLabel").to(this,"length",(e=>getTranslation$d(this.locale,e?"Reply":"Comment"))),t.on("submit",((e,t)=>{this.fire("addComment",t),this._model.isResolved&&this._model.isResolvable&&this.fire("reopenCommentThread",this._model.id),this._model.isSubmitted||this.fire("submitCommentThread")})),t.on("cancel",(()=>{this.focus()})),t.bind("disabledSubmit").to(this._model,"isReadOnly"),t.on("cancel",(e=>{0==this.length&&(this.fire("removeCommentThread"),e.stop())})),this.on("change:isActive",((e,n,i)=>{i||this.length||t.value||this.fire("removeCommentThread")})),e}}class CommentThreadView extends(/*   -- @preserve */
ConfirmMixin(BaseCommentThreadView)){constructor(e,t,n,i){super(e,t,n,i),this.commentThreadChildren=this.createCollection([this.commentsListView,this.commentThreadInputView,this.ariaDescriptionView]),this.set("actionIndicator",null),this.containerElement=null,this._boundFirstCommentView=null,this.locale=e,this.resolveButton=this._createResolveButton(),this.setTemplate(this.getTemplate()),this.on("change:isActive",((e,t,n)=>{n||this._cancelAllConfirms()})),this.listenTo(this._model,"change:isReadOnly",((e,t,n)=>{n&&this._cancelAllConfirms()})),this.length>0&&this._bindFirstCommentView(),this.listenTo(this.commentsListView.commentViews,"add",(()=>{this._bindFirstCommentView()}))}getTemplate(){const e=this.bindTemplate;return{tag:"div",attributes:{class:["ck","ck-thread","ck-reset_all-excluded","ck-rounded-corners",e.if("isActive","ck-thread--active"),e.if("isUnlinked","ck-thread--unlinked"),e.if("isConfirm","ck-thread--remove-confirmation"),e.to("actionIndicator",(e=>e?"ck-thread--"+e:""))],"data-thread-id":this._model.id,tabindex:0,role:"listitem","aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id},children:[{tag:"div",attributes:{class:"ck-thread__container"},children:this.commentThreadChildren}]}}render(){super.render(),this.containerElement=this.element.querySelector(".ck-thread__container"),this._model.on("change:archivedAt",(()=>{this._updateArchivedThreadHeader()})),this._updateArchivedThreadHeader()}_cancelAllConfirms(){this.cancelConfirm();for(const e of this.commentsListView.commentViews)e.cancelConfirm()}_bindFirstCommentView(){const{locale:e}=this,t=this.commentsListView.commentViews.get(0);t===this._boundFirstCommentView||t.isSystemComment||(this._boundFirstCommentView=t,this.unbind("actionIndicator"),this.bind("actionIndicator").to(t,"actionIndicator",(e=>"remove"===e?"remove":null)),t.placeholder=getTranslation$d(e,"Write a comment..."),t.removeButton.on("execute",(t=>{t.stop(),this.showConfirm(getTranslation$d(e,"Delete comment thread?"),this.containerElement).then((()=>{this.fire("removeCommentThread")}))}),{priority:"high"}),this.on("removeConfirm",(()=>{t.focus()})),t.actionBar.add(this.resolveButton,0),t.focusables.add(this.resolveButton,0))}_createResolveButton(){const e=new LateFocusButtonView(this.locale);return e.label=getTranslation$d(this.locale,"Resolve"),e.tooltip=getTranslation$d(this.locale,"Resolve"),e.icon=_0x27b58d.check,e.extendTemplate({attributes:{class:"ck-comment--resolve"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",((e,t)=>e&&!t)),e.on("execute",(()=>{this.fire("resolveCommentThread",this._model.id)})),e}_updateArchivedThreadHeader(){this._model.archivedAt?this.commentThreadChildren.has(this.commentThreadHeaderView)||(this.commentThreadChildren.add(this.commentThreadHeaderView,0),this.focusables.add(this.commentThreadHeaderView,0)):this.commentThreadChildren.has(this.commentThreadHeaderView)&&(this.commentThreadChildren.remove(this.commentThreadHeaderView),this.focusables.remove(this.commentThreadHeaderView))}}class CommentContentView extends View{constructor(e){super(e),this.set("content",""),this.setTemplate({tag:"div",attributes:{class:["ck-content","ck-comment__content","ck-annotation__content"]}})}render(){super.render(),this.on("change:content",((e,t,n)=>{this.element.innerHTML=n})),this.element.innerHTML=this.content}}class BaseCommentView extends View{constructor(e,t,n){super(e),this._model=t,this._config=n,this.isSystemComment=!!this._config.isSystemComment,this.set("isEditMode",!1),this.set("isCollapsed",!0),this.bind("ariaLabel").to(t,"content",t,"authoredAt",((i,r)=>getTranslation$d(e,"COMMENT_ARIA_LABEL",[t.author.name,n.formatDateTime(r),(new DOMParser).parseFromString(i,"text/html").body.textContent,t.isExternal?this.getExternalCommentNote():""]))),this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation$d(e,"COMMENT_THREAD_DESCRIPTION")),this.visibleView=this.createCollection(),this.visibleView.add(this._createCommentContentView()),this.focusables=new ViewCollection,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}})}expand(){this.isCollapsed=!1}collapse(){this.isEditMode||(this.isCollapsed=!0)}focus(){this.element.focus()}render(){super.render(),this._setupKeyboardNavigation()}async destroy(){await this.visibleView.get(0).destroy(),super.destroy()}switchToEditMode(){this.isEditMode||(this.isEditMode=!0,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentInputView()))}switchToDisplayMode(){this.isEditMode&&(this.isEditMode=!1,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentContentView()))}getExternalCommentNote(){return"importWord"===this._model.attributes["@external"].source?getTranslation$d(this.locale,"EXTERNAL_IMPORT_WORD_COMMENT"):getTranslation$d(this.locale,"EXTERNAL_COMMENT")}getUserViewNotificationText(){return this._model.isExternal?"importWord"===this._model.attributes["@external"].source?getTranslation$d(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):getTranslation$d(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}_createCommentContentView(){const e=new CommentContentView(this.locale);return e.bind("content").to(this._model,"content",this,"isCollapsed",((e,t)=>t?trimHtml(e,{limit:this._config.maxCommentCharsWhenCollapsed}):e)),e}_createCommentInputView(){this._config.editorConfig||(this._config.editorConfig={}),this._config.editorConfig.initialData=this._model.content;const e=new CommentInputView(this.locale,this._config.editorConfig);return e.value=this._model.content,e.bind("disabledSubmit").to(this._model,"isReadOnly"),e.submitLabel=getTranslation$d(this.locale,"Save"),e.on("submit",((e,t)=>{this.fire("updateComment",this._model.id,t),this.switchToDisplayMode(),this.focus()})),e.on("cancel",(()=>{this.switchToDisplayMode(),this.focus()})),e.once("editorReady",(()=>{e.focus()})),e.createEditor(),e.delegate("editorReady").to(this),e.delegate("editorDestroyed").to(this),e}_setupKeyboardNavigation(){const e=this.element;this.keystrokes.listenTo(e);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element);this.focusables.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.keystrokes.stopListening(e.element);for(const e of t.added)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)})),this.keystrokes.set("enter",((t,n)=>{e===t.target&&(this.focusCycler.focusFirst(),n())})),this.keystrokes.set("esc",((t,n)=>{e!==t.target&&(this.focus(),n())}))}}var removeIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.2 7h9.2c.6 0 1 .4 1 1v9.9c0 .5-.4 1-1 1H5.2a1 1 0 0 1-1-1V8c0-.6.4-1 1-1zm1 1.5c-.3 0-.5.2-.5.5v8c0 .3.2.5.5.5h.5c.2 0 .5-.2.5-.5V9c0-.3-.3-.5-.5-.5h-.5zm3.2 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.4zm3.5 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.5zm-1.4-7.1H8.3L6.5 3.6H3.8c-.5 0-.7.3-.7.8s.2.7.7.7h12c.6 0 .9-.2.9-.7 0-.5-.3-.8-1-.8h-2.4l-1.8-2.2z"/></svg>\n';class CommentView extends(/*   -- @preserve */
ConfirmMixin(BaseCommentView)){constructor(e,t,n){super(e,t,n),this.set("actionIndicator",null),this.set("placeholder",getTranslation$d(e,"Reply...")),this.bind("authoredAt").to(t),this.bind("resolvedAt").to(t),this.actionBar=this.createCollection(),this.isSystemComment||(this.editButton=this._createEditButton(),this.removeButton=this._createRemoveButton(),this.items=this.createCollection(),this.items.addMany([this.editButton,this.removeButton]),this.dropdown=this._createDropdown(),this.actionBar.add(this.dropdown),this.focusables.add(this.dropdown)),this.userView=new UserView(e,t.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-comment__user","ck-annotation__user"],"aria-hidden":!0}}),this.listenTo(t,"change:isRemovable",(()=>this.cancelConfirm())),this.setTemplate(this.getTemplate())}getTemplate(){const e=this.bindTemplate,t=[{tag:"div",attributes:{class:["ck-comment__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-comment__info-name","ck-annotation__info-name"]}},{tag:"time",attributes:{datetime:e.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:e.to("authoredAt",(e=>this._config.formatDateTime(e)))}]}]},{tag:"div",attributes:{class:["ck-comment__actions","ck-annotation__actions",e.if("isEditMode","ck-comment__actions--hidden"),e.if("isEditMode","ck-annotation__actions--hidden")]},children:this.actionBar},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]},children:this.visibleView},this.ariaDescriptionView];return this._model.isExternal&&t.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalCommentNote()}]}),{tag:"li",attributes:{class:["ck-comment__wrapper",e.if("isConfirm","ck-comment--remove-confirmation")],tabindex:-1,"aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id,role:"listitem"},children:[{tag:"div",attributes:{class:["ck-comment","ck-annotation",e.if("isEditMode","ck-comment--edit"),e.if("isSystemComment","ck-comment--info"),e.to("actionIndicator",(e=>e?"ck-comment--"+e:""))],"data-author-id":this._model.author.id,"data-comment-id":this._model.id,role:"group"},children:[this.userView,{tag:"div",attributes:{class:["ck-comment__main","ck-annotation__main"]},children:t}]}]}}_createEditButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$d(this.locale,"Edit"),e.icon=_0x27b58d.pencil,e.withText=!0,e.extendTemplate({attributes:{class:"ck-comment--edit"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isEditable"),e.on("execute",(()=>this.switchToEditMode())),e}_createRemoveButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$d(this.locale,"Remove"),e.icon=removeIcon,e.withText=!0,e.extendTemplate({attributes:{class:"ck-comment--remove"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isRemovable"),e.on("execute",(()=>{this.showConfirm(getTranslation$d(this.locale,"Delete comment?"),this.element).then((()=>{this.fire("removeComment",this._model.id)}))})),e}_createDropdown(){const e=createDropdown(this.locale,LateFocusDropdownButtonView),t=e.panelView.children,n=new ListView(this.locale),i=e.bindTemplate;focusChildOnDropdownOpen(e,(()=>this.items.find((e=>e.isVisible)))),e.extendTemplate({attributes:{class:[i.if("isVisible","ck-hidden",(e=>!e))]}});const r=(t,i=-1)=>{const r=new ListItemView(this.locale);r.children.add(t);const s=i>-1?i:n.items.length;n.items.add(r,s);const o=Array.from(this.items);e.unbind("isEnabled","isVisible"),e.bind("isEnabled").toMany(o,"isEnabled",((...e)=>e.some((e=>e)))),e.bind("isVisible").toMany(o,"isVisible",((...e)=>e.some((e=>e))))};e.panelPosition="sw",e.buttonView.set({label:getTranslation$d(this.locale,"Show more items"),icon:_0x27b58d.threeVerticalDots});for(const e of this.items)r(e);return t.add(n),e.listenTo(this.items,"add",((e,t,n)=>{r(t,n)})),e.listenTo(this.items,"remove",((e,t,i)=>{n.items.remove(i)})),e}_attachActions(e,t){const n=e&&e.element;n&&(this.listenTo(n,"mouseenter",(()=>this.actionIndicator=t)),this.listenTo(n,"focus",(()=>this.actionIndicator=t)),this.listenTo(n,"mouseleave",(()=>this.actionIndicator=null)),this.listenTo(n,"blur",(()=>this.actionIndicator=null)))}_createCommentInputView(){const e=super._createCommentInputView();return e.bind("placeholder").to(this),e}render(){super.render(),this._attachActions(this.editButton,"edit"),this._attachActions(this.removeButton,"remove")}}function createMutationObserver(e){const t=throttle(e,30),n=new MutationObserver((e=>{for(const n of e)("attributes"==n.type&&"class"==n.attributeName||"childList"==n.type||"characterData"==n.type)&&t()}));return{attach(e){n.observe(e,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},detach(){n.disconnect(),t.cancel()}}}class AnnotationView extends View{constructor(e,t){super(e),this.id=uid(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.keystrokes.set("Esc",((e,t)=>this.fire("Esc",t))),this.set("targetRect",{top:0,right:0,bottom:0,left:0}),this.set("height",0),this.set("isActive",!1),this.set("isDirty",!1),this.set("length",0),this.set("type",""),this._mutationObserver=createMutationObserver((()=>this._updateHeight())),this.content=this.createCollection(),this.content.delegate("arrowup","arrowdown").to(this),this.content.add(t),this.mainView=t;const n=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-annotation-wrapper","ck-rounded-corners",n.if("isActive","ck-annotation-wrapper--active")],role:"presentation"},children:this.content})}render(){super.render(),this.focusTracker.add(this.element),this.keystrokes.listenTo(this.element),this._mutationObserver.attach(this.element)}destroy(){this.content.clear(),this.keystrokes.destroy(),this.focusTracker.destroy(),this._mutationObserver.detach(),super.destroy()}focus(){this.content.first&&this.content.first.focus()}_updateHeight(){const e=this.element.clientHeight;e&&(this.height=e)}}class Annotation extends(/*   -- @preserve */
ObservableMixin()){constructor({view:e,target:t,type:n,isVisible:i=!0}){super(),this.view=e,this.view.element||this.view.render(),this._type=n,this._target=t,Annotation._assertCorrectTarget(this._getNormalizedTarget()),this.focusableElements=new Collection([this.view.element],{idProperty:"_id"}),this.focusableElements.on("add",((e,t)=>{this.view.focusTracker.add(t)})),this.focusableElements.on("remove",((e,t)=>{this.view.focusTracker.remove(t)})),this.set("isVisible",i)}get type(){return"function"==typeof this._type?this._type():this._type}get innerView(){return this.view.mainView}get target(){const e=this._getNormalizedTarget();return Annotation._assertCorrectTarget(e),e}get targetRect(){const e=this.target;if(null===e)return null;if(e instanceof Rect)return e;const t=e.filter((e=>isDomElementVisible(e)));return 0===t.length?null:new Rect(t[0].getClientRects().item(0))}get isActive(){return this.view.isActive}set isActive(e){this.view.isActive=e,this.view.mainView.isActive=e}updateTargetRect(){this.view.targetRect=this.targetRect}destroy(){this.focusableElements.stopListening(),this.focusableElements.clear(),this.stopListening()}refreshVisibility(){this.isVisible=!!this.targetRect}static _assertCorrectTarget(e){if(!(null===e||e instanceof Rect||Array.isArray(e)&&e.every((e=>isElement$1(e)))))throw new CKEditorError("annotation-invalid-target",null,{target:e})}_getNormalizedTarget(){const e="function"==typeof this._target?this._target():this._target;return isElement$1(e)?[e]:e}}function isElement$1(e){return null!==e&&"object"==typeof e&&"nodeType"in e&&1===e.nodeType}function isDomElementVisible(e){return!!e.offsetParent||!!e.getClientRects().item(0)}class AnnotationCollection extends Collection{constructor(e=[]){super(),this._innerViewToAnnotation=new Map,this._viewToAnnotation=new Map,this._focusTracker=new FocusTracker,this._focusTracker.on("change:isFocused",((e,t,n)=>{n||this.fire("blur")}));for(const t of e)this.add(t)}get isFocused(){return this._focusTracker.isFocused}add(e){if(this.has(e))throw new CKEditorError("annotationcollection-duplicated-item",null);this._innerViewToAnnotation.set(e.innerView,e),this._viewToAnnotation.set(e.view,e);for(const t of e.focusableElements)this._focusTracker.add(t);this.listenTo(e.focusableElements,"add",((e,t)=>{this._focusTracker.add(t)})),this.listenTo(e.focusableElements,"remove",((e,t)=>{this._focusTracker.remove(t)})),this.listenTo(e.view.focusTracker,"change:isFocused",((t,n,i)=>{i&&this.fire("focus",e)})),e.updateTargetRect();const t=this._getOrderInContent(e.view.targetRect);return super.add(e,t)}remove(e){if(!this.has(e))throw new CKEditorError("annotationcollection-not-existing-item",null);this.stopListening(e.view.focusTracker),this.stopListening(e.focusableElements);for(const t of e.focusableElements)this._focusTracker.remove(t);return this._viewToAnnotation.delete(e.view),this._innerViewToAnnotation.delete(e.innerView),super.remove(e)}getByInnerView(e){return this._innerViewToAnnotation.get(e)}getByView(e){return this._viewToAnnotation.get(e)}destroy(){super.clear(),this.stopListening(),this._innerViewToAnnotation.clear(),this._viewToAnnotation.clear(),this._focusTracker.destroy()}refreshPositioning(){for(const e of this)e.updateTargetRect();this._sort()}_sort(){const e=Array.from(this).sort(((e,t)=>elementOffsetComparator(e.view.targetRect,t.view.targetRect)));for(let t=e.length-1;t>0;t--){const n=e[t];t!==this.getIndex(n)&&(this.remove(n),this.add(n))}}_getOrderInContent(e){let t=0;if(!e)return this.length;for(const n of this){const i=n.view.targetRect;if(i){if(elementOffsetComparator(e,i)<0)return t;t++}}return t}}function bindAnnotationCollections({source:e,target:t,filter:n}){for(const i of e)n(i)&&t.add(i);t.listenTo(e,"add",((e,i)=>{n(i)&&t.add(i)})),t.listenTo(e,"remove",((e,n)=>{t.has(n)&&t.remove(n)}))}function elementOffsetComparator(e,t){if(null===e&&null===t)return 0;if(null===e)return-1;if(null===t)return 1;const n=e.top-t.top;return 0==n?e.left-t.left:n}class Annotations extends ContextPlugin{static get pluginName(){return"Annotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){if(super(e),this.collection=new AnnotationCollection,this._visibleAnnotations=new AnnotationCollection,this.set("activeAnnotations",new Set),this._bindAnnotationsToVisibleAnnotations(),e instanceof Editor){const t=e.locale;e.accessibility.addKeystrokeInfoGroup({id:"annotations",label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP"),keystrokes:[{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO"),keystroke:"Ctrl+Shift+E"},{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT"),keystroke:"Esc"},{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER"),keystroke:"Enter"},{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS"),keystroke:[["Tab"],["Shift+Tab"]]},{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT"),keystroke:["Ctrl+Enter"]},{label:getTranslation$d(t,"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS"),keystroke:[["Arrowup"],["Arrowdown"]]}]})}this._setupEnterAnnotationKeystroke(),this._setupEscapeAnnotationHandling()}add(e){this.collection.add(e)}remove(e){this.collection.remove(e),e.destroy()}refreshVisibility(){for(const e of this.collection)e.refreshVisibility()}refreshPositioning(){this._visibleAnnotations.refreshPositioning()}getByInnerView(e){return this.collection.getByInnerView(e)}deactivateAll(){this.fire("_deactivateAllAnnotations")}destroy(){for(const e of this.collection)e.destroy();this._visibleAnnotations.destroy(),this.collection.destroy(),super.destroy()}activate(e){this.fire("_activateAnnotation",e)}createAnnotation(e){return new Annotation(e)}createAnnotationView(e,t){return new AnnotationView(e,t)}_addActiveAnnotation(e){const t=new Set(this.activeAnnotations);t.add(e),this.activeAnnotations=t}_removeActiveAnnotation(e){const t=new Set(this.activeAnnotations);t.delete(e),this.activeAnnotations=t}_bindAnnotationsToVisibleAnnotations(){const e=this.collection,t=this._visibleAnnotations;function n(e){const n=e.source;n.isVisible&&!t.has(n)?t.add(n):!n.isVisible&&t.has(n)&&t.remove(n),n.view.focusTracker.remove(n.view.element),n.view.focusTracker.add(n.view.element)}this.listenTo(e,"add",((e,i)=>{i.isVisible&&t.add(i),this.listenTo(i,"change:isVisible",n)})),this.listenTo(e,"remove",((e,i)=>{t.has(i)&&t.remove(i),this.stopListening(i,"change:isVisible",n)}))}_setupEnterAnnotationKeystroke(){const e=e=>{e.on("ready",(()=>{e.keystrokes.set(FOCUS_ANNOTATION_KEYSTROKE,((e,t)=>{const n=first(this.activeAnnotations.values());n&&(n.view.focus(),t())}))}))};this.context instanceof Editor?e(this.context):this.context.editors&&this.context.editors.on("add",((t,n)=>{e(n)}))}_setupEscapeAnnotationHandling(){const e=e=>{const t=e.source,n=[];let i;if(Array.isArray(t.target)){i=t.target[0],this.context instanceof Editor?n.push(this.context):this.context.editors&&n.push(...this.context.editors);for(const e of n)for(const t of e.editing.view.domRoots.values())if(t.contains(i))return void e.editing.view.focus();i.focus()}};this.listenTo(this.collection,"add",((t,n)=>{this.listenTo(n,"escape",e,{priority:"low"})})),this.listenTo(this.collection,"remove",((t,n)=>{this.stopListening(n,"escape",e)}))}}const noChannel=Symbol("noChannel"),defaultPermissions={admin:!0,modifyAll:!1,write:!0,resolve:!0};class CommentsRepository extends ContextPlugin{static get requires(){return[Annotations,PendingActions,Users]}static get pluginName(){return"CommentsRepository"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._threads=new Map,this._threadToController=new Map,this._viewToController=new Map,this.set("_readOnlyChannels",new Set),this.set("_permissions",new Map);const t=this.context.config;t.define("comments.maxCommentsWhenCollapsed",2),t.define("comments.maxThreadTotalWeight",500),t.define("comments.maxCommentCharsWhenCollapsed",140),t.define("comments.CommentThreadView",CommentThreadView),t.define("comments.CommentView",CommentView),t.get("comments.editorConfig")||console.warn("Missing comments editor configuration (`comments.editorConfig`). Default configuration will be used instead.")}init(){const e=this.context.plugins.get(Annotations);this.set("activeCommentThread",null),this.on("addCommentThread",((e,t)=>this._addCommentThread(t))),this.on("submitCommentThread",((e,t)=>this._submitCommentThread(t))),this.on("resolveCommentThread",((e,t)=>this._resolveCommentThread(t))),this.on("resolveCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("reopenCommentThread",((e,t)=>this._reopenCommentThread(t))),this.on("reopenCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("removeCommentThread",((e,t)=>this._removeCommentThread(t))),this.on("updateCommentThread",((e,t)=>this._updateCommentThread(t))),this.on("updateCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("addComment",((e,t)=>this._addComment(t))),this.on("updateComment",((e,t)=>this._updateComment(t))),this.on("removeComment",((e,t)=>this._removeComment(t))),this.on("addComment",((e,{threadId:t,isFromAdapter:n})=>{if(n)return;const i=this.getCommentThread(t),r=i&&this._threadToController.get(i);r&&r.view.commentsListView.focus(-1)}),{priority:"lowest"}),this.listenTo(e,"change:activeAnnotations",((e,t,n)=>{const i=Array.from(n).map((e=>this._viewToController.get(e.innerView))).filter(Boolean)[0];this.activeCommentThread=i?i.model:null}))}set adapter(e){if(this._adapter)throw new CKEditorError("commentsrepository-adapter-already-set");this._adapter=e}get adapter(){return this._adapter}addCommentThread({channelId:e=noChannel,threadId:t=uid(),comments:n=[],unlinkedAt:i=null,resolvedAt:r=null,resolvedBy:s=null,target:o=null,context:a=null,attributes:c={},isResolvable:l=!0,isSubmitted:d=!1,isFromAdapter:u=!1}={}){return this.fire(toEventName("addCommentThread",e),{channelId:e,threadId:t,comments:n,unlinkedAt:i,resolvedAt:r,resolvedBy:s,target:o,context:a,attributes:c,isFromAdapter:u,isResolvable:l,isSubmitted:d}),this.getCommentThread(t)}openNewCommentThread({channelId:e=noChannel,threadId:t=uid(),target:n,context:i=null,isResolvable:r=!0}){if(this._readOnlyChannels.has(e)||this._readOnlyChannels.has(void 0))return null;if(!n)throw new CKEditorError("commentsrepository-missing-target");const s=this.addCommentThread({channelId:e,threadId:t,target:n,context:i,isResolvable:r});if(!s)return null;const o=this._threadToController.get(s),a=o.view.commentThreadInputView.commentInputView,c=this.context.plugins.get(Annotations),l=c.getByInnerView(o.view);return c.activate(l),a.once("editorReady",(()=>a.focus())),s}hasCommentThread(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.has(e)}updateCommentThread({channelId:e=noChannel,threadId:t,context:n,unlinkedAt:i,attributes:r,isFromAdapter:s=!1}){return this.fire(toEventName("updateCommentThread",e),{channelId:e,threadId:t,context:n,unlinkedAt:i,attributes:r,isFromAdapter:s}),this.getCommentThread(t)}getCommentThread(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.get(e)}fetchCommentThread({channelId:e,threadId:t}={}){const n=this.getCommentThread(t);if(n)return Promise.resolve(n);if(!this.adapter)return Promise.resolve(void 0);if("function"!=typeof this.adapter.getCommentThread)throw new CKEditorError("commentsrepository-missing-thread-and-adapter-method",this.context);return this.adapter.getCommentThread({channelId:e,threadId:t}).then((n=>this.hasCommentThread(t)?this.getCommentThread(t):n?this.addCommentThread(Object.assign({isFromAdapter:!0,channelId:e},n)):void 0)).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-fetch-comment-thread",this.context)}))}getCommentThreads({channelId:e,skipNotAttached:t=!1,skipEmpty:n=!1,toJSON:i=!1}={}){const r=[];for(const i of this._threads.values())e&&i.channelId!==e||t&&!i.isAttached||n&&0===i.length||r.push(i);return i?r.map((e=>e.toJSON())):r}setActiveCommentThread(e){const t=this.context.plugins.get(Annotations);if(!e)return void(this.activeCommentThread&&t.deactivateAll());const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-active-missing-comment-thread",null,{threadId:e});if(!this._threadToController.has(n))throw new CKEditorError("commentsrepository-active-not-attached",null,{threadId:e});const i=t.getByInnerView(this._threadToController.get(n).view);t.activate(i)}switchReadOnly(e,t){e?this._readOnlyChannels.add(t):this._readOnlyChannels.delete(t),this.fire("change:_readOnlyChannels","_readOnlyChannels",this._readOnlyChannels,this._readOnlyChannels)}isReadOnly(e){return this._readOnlyChannels.has(e)||this._readOnlyChannels.has(void 0)}createCommentThreadController(e,t){return new CommentThreadController(e,t)}setPermissions(e,t=noChannel){this._permissions.set(t,e),this.fire("change:_permissions","_permissions",this._permissions,this._permissions)}getPermissions(e=noChannel){return this._permissions.has(e)?this._permissions.get(e):defaultPermissions}_addCommentThread({channelId:e,threadId:t,comments:n,unlinkedAt:i,resolvedAt:r,resolvedBy:s,target:o,context:a,attributes:c,isFromAdapter:l,isResolvable:d,isSubmitted:u}){if("string"!=typeof t)throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:t});if(this.hasCommentThread(t))throw new CKEditorError("commentsrepository-duplicated-comment-thread-id",null,{threadId:t});const h=new CommentThread(this,{channelId:e,id:t,context:a,attributes:c,unlinkedAt:i,resolvedAt:r,resolvedBy:s?this.context.plugins.get(Users).getUser(s):null,isResolvable:d,isSubmitted:u||l});this._threads.set(t,h);for(const e of n)h._add(this._createNewComment({threadId:t,...e}));return o&&h.attachTo(o),l||!h.length?Promise.resolve():this._submitCommentThread({channelId:e,threadId:t})}_submitCommentThread({channelId:e,threadId:t}){if(!this.hasCommentThread(t))throw new CKEditorError("commentsrepository-missing-comment-thread",this);const n=this.getCommentThread(t);if(n._isSubmitted=!0,!this.adapter||"function"!=typeof this.adapter.addCommentThread)return Promise.resolve();const{id:i,comments:r,resolvedAt:s,resolvedBy:o,context:a,attributes:c}=n,l=this.context.plugins.get("PendingActions"),d=l.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.addCommentThread({channelId:e,threadId:i,comments:r.map((e=>e.toJSON())),resolvedAt:s,resolvedBy:o?o.id:o,context:a,attributes:c}).then((({comments:n})=>{l.remove(d);for(const i of n)this._updateComment({channelId:e,threadId:t,commentId:i.commentId,createdAt:i.createdAt,isFromAdapter:!0})})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-add-comment-thread-internal-error",this)}))}_attachCommentThread({threadId:e,target:t}){const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-attach-missing-comment-thread",this);const i=this.context.plugins.get("PendingActions"),r=this.context.plugins.get(Annotations),s=this._createCommentThreadView(n),o=new CommentThreadController(n,s);let a=null;s.on("change:isDirty",((e,t,n)=>{n?a=i.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD")):a&&(i.remove(a),a=null)})),this._threadToController.set(n,o),this._viewToController.set(s,o);const c=new AnnotationView(this.context.locale,s);c.bind("length").to(s),c.bind("isDirty").to(s,"isDirty",s,"length",((e,t)=>e||!t)),c.bind("isActive").to(s),c.type="comment";const l=new Annotation({view:c,target:t,type:"comment",isVisible:!n.isResolved});return s.on("escape",(()=>{l.fire("escape")})),this._bindAnnotationToEditors(s,l),r.add(l),l}_bindAnnotationToEditors(e,t){this.listenTo(e,"editorReady",((e,n)=>{const i=n.ui.view.body.bodyCollectionContainer;t.focusableElements.add(i),this.context instanceof Editor&&this.context.ui.focusTracker.add(i)}),{priority:"highest"}),this.listenTo(e,"editorDestroyed",((e,n)=>{const i=n.ui.view.body.bodyCollectionContainer;t.focusableElements.has(i)&&t.focusableElements.remove(i),this.context instanceof Editor&&this.context.ui.focusTracker.remove(i)}))}_unbindEditors(e){this.stopListening(e,"editorReady"),this.stopListening(e,"editorDestroyed")}_createCommentThreadView(e){const t=this.context.plugins.get(Users),{config:n,locale:i}=this.context,r=getDateTimeFormatter(n.get("locale"));return new(0,n.get("comments").CommentThreadView)(i,e,t.me,{editorConfig:{...n.get("comments.editorConfig"),licenseKey:this.context.config.get("licenseKey")},copyMarkers:n.get("comments.copyMarkers"),maxCommentsWhenCollapsed:n.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:n.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:n.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:r,CommentView:n.get("comments").CommentView})}_resolveCommentThread({threadId:e,channelId:t,resolvedAt:n,resolvedBy:i,isFromAdapter:r}){if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const s=this.getCommentThread(e);if(s.isResolved)throw new CKEditorError("commentsrepository-resolved-comment-thread",null,{threadId:e});const o=this.context.plugins.get(Users);if(s.resolvedBy=o.getUser(i),s.resolvedAt=n,r||!this.adapter||"function"!=typeof this.adapter.resolveCommentThread)return Promise.resolve();const a=this.context.plugins.get("PendingActions"),c=a.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.resolveCommentThread({channelId:t,threadId:e}).then((({resolvedAt:e,resolvedBy:t})=>{a.remove(c),s.resolvedBy.id!==t&&(s.resolvedBy=o.getUser(t)),s.resolvedAt=e})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-resolve-comment-thread-internal-error",this)}))}_reopenCommentThread({threadId:e,channelId:t,isFromAdapter:n}){if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const i=this.getCommentThread(e);if(!i.isResolved)throw new CKEditorError("commentsrepository-reopen-comment-thread",null,{threadId:e});if(i.resolvedBy=null,i.resolvedAt=null,n||!this.adapter||"function"!=typeof this.adapter.reopenCommentThread)return Promise.resolve();const r=this.context.plugins.get("PendingActions"),s=r.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.reopenCommentThread({channelId:t,threadId:e}).then((()=>r.remove(s))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-reopen-comment-thread-internal-error",this)}))}_removeCommentThread({threadId:e,isFromAdapter:t}){const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-remove-missing-comment-thread",this);if(this._detachCommentThread(e),this._threads.delete(e),!n.isSubmitted||t||!this.adapter||"function"!=typeof this.adapter.removeCommentThread)return Promise.resolve();const i=this.context.plugins.get("PendingActions"),{channelId:r}=n,s=i.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeCommentThread({channelId:r,threadId:e}).then((()=>i.remove(s))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-remove-comment-thread-internal-error",this)}))}_updateCommentThread({threadId:e,unlinkedAt:t,context:n,attributes:i,isFromAdapter:r}){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:e});if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const s=this.getCommentThread(e);let o=!1;if(void 0!==n&&s.context!==n&&(s.context=n,o=!0),void 0!==t&&s.unlinkedAt!==t&&(s.unlinkedAt=t,o=!0),i&&!isEqual(i,s.attributes)&&(s.attributes=i,o=!0),!o)return Promise.resolve();if(!s.isSubmitted||r||!this.adapter||"function"!=typeof this.adapter.updateCommentThread)return Promise.resolve();const a=this.context.plugins.get("PendingActions"),{channelId:c}=s,l=a.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateCommentThread({channelId:c,threadId:e,context:n,unlinkedAt:t,attributes:i}).then((()=>a.remove(l))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-update-comment-thread-internal-error",this)}))}_detachCommentThread(e){const t=this.context.plugins.get(Annotations),n=this.getCommentThread(e);if(n._isAttached=!1,this._threadToController.has(n)){const e=this._threadToController.get(n),i=e.view,r=t.getByInnerView(i);this._threadToController.delete(n),this._viewToController.delete(i),r&&t.remove(r),e.destroy(),i.destroy().then((()=>{this._unbindEditors(i)}))}}_updateActiveAnnotation({threadId:e,resolvedAt:t}){const n=!!t,i=this.context.plugins.get(Annotations),r=this.getCommentThread(e);if(this._threadToController.has(r)){const e=this._threadToController.get(r).view,t=i.getByInnerView(e);t&&(n&&i._removeActiveAnnotation(t),t.refreshVisibility())}}_getExternalAuthor(e){const t=this.context.plugins.get(Users),n=hashObject("external:"+e);return t.getUser(n)||t.addUser({id:n,name:e})}_createNewComment({threadId:e,commentId:t=uid(),content:n,authorId:i,createdAt:r,attributes:s}){if("string"!=typeof t)throw new CKEditorError("commentsrepository-invalid-commentid");if("string"!=typeof i)throw new CKEditorError("commentsrepository-invalid-comment-authorid");if("string"!=typeof n||!n.trim())throw new CKEditorError("commentsrepository-invalid-comment-content");const o=this.context.plugins.get(Users).getUser(i);if(!o)throw new CKEditorError("commentsrepository-add-comment-user-not-exists",null,{authorId:i});let a=null,c=r;return s&&s["@external"]&&(a=this._getExternalAuthor(s["@external"].authorName),c=new Date(s["@external"].createdAt)),new Comment(this,{threadId:e,id:t,author:a||o,creator:o,content:n,createdAt:r,authoredAt:c,attributes:s})}_addComment(e){let{threadId:t,content:n,attributes:i,isFromAdapter:r}=e;const s=this.getCommentThread(e.threadId);if(!s)throw new CKEditorError("commentsrepository-add-comment-to-missing-comment-thread",this);const o=this._createNewComment(e),{id:a}=o;if(s._add(o),r||!this.adapter||"function"!=typeof this.adapter.addComment||!s.isSubmitted)return Promise.resolve();const c=this.context.plugins.get("PendingActions"),{channelId:l}=s,d=c.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return i||(i={}),this.adapter.addComment({channelId:l,threadId:t,commentId:a,content:n,attributes:i}).then((e=>{c.remove(d),e&&this._updateComment({channelId:l,threadId:t,commentId:a,createdAt:e.createdAt,isFromAdapter:!0})})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-add-comment-internal-error",this)}))}_updateComment({threadId:e,commentId:t,content:n,createdAt:i,attributes:r,isFromAdapter:s}){if(void 0!==n&&("string"!=typeof n||!n.trim().length))throw new CKEditorError("commentsrepository-update-comment-invalid-content");const o=this.getCommentThread(e),a=o.getComment(t);if(!a)throw new CKEditorError("commentsrepository-update-missing-comment",this);let c=!1;if(n&&n!==a.content&&(a.isEditable||s)&&(a.content=n,c=!0),i&&i!==a.createdAt&&(a.createdAt=i,a.attributes&&a.attributes["@external"]||(a.authoredAt=i),c=!0),r&&!isEqual(r,a.attributes)&&(a.attributes=r,c=!0),!c)return Promise.resolve();if(o.fire("commentUpdated"),s||!this.adapter||"function"!=typeof this.adapter.updateComment)return Promise.resolve();const l=this.context.plugins.get("PendingActions"),{channelId:d}=this.getCommentThread(a.threadId),u=l.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateComment({channelId:d,threadId:e,commentId:t,content:n,attributes:r}).then((()=>l.remove(u))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-update-comment-internal-error",this)}))}_removeComment({threadId:e,commentId:t,isFromAdapter:n}){const i=this.getCommentThread(e),r=i.getComment(t);if(!r)throw new CKEditorError("commentsrepository-remove-missing-comment",this);if(i._remove(r),n||!this.adapter||"function"!=typeof this.adapter.removeComment)return Promise.resolve();const s=this.context.plugins.get("PendingActions"),{channelId:o}=i,a=s.add(getTranslation$d(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeComment({channelId:o,threadId:e,commentId:t}).then((()=>s.remove(a))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-remove-comment-internal-error",this)}))}}class CommentThread extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super();const n=t.isResolvable;this.channelId=t.channelId,this.id=t.id,this.comments=new Collection,this._repository=e,this._isAttached=!1,this._isSubmitted=t.isSubmitted,this.set("_hasTargetInContent",!0),this.bind("isReadOnly").to(e,"_permissions",e,"_readOnlyChannels",(()=>e.isReadOnly(this.channelId))),this.bind("isRemovable").to(e,"_permissions",(()=>e.getPermissions(this.channelId).admin)),this.bind("canComment").to(e,"_permissions",(()=>{const t=e.getPermissions(this.channelId);return t.write||t.admin})),this.bind("isResolvable").to(e,"_permissions",(()=>n&&e.getPermissions(this.channelId).resolve)),this.set("context",t.context),this.bind("archivedAt").to(this,"resolvedAt",this,"unlinkedAt",((e,t)=>e?t?e<t?e:t:e:t)),this.set("unlinkedAt",t.unlinkedAt||null),this.set("resolvedAt",t.resolvedAt||null),this.set("resolvedBy",t.resolvedBy||null),this.bind("isResolved").to(this,"resolvedAt",(e=>!!e)),this.set("attributes",t.attributes||{})}get weight(){return Array.from(this.comments).reduce(((e,t)=>e+t.weight),0)}get length(){return this.comments.length}get isAttached(){return this._isAttached}get isSubmitted(){return this._isSubmitted}submit(){const{channelId:e,id:t}=this;this._repository.fire(toEventName("submitCommentThread",e),{channelId:e,threadId:t})}setUnlinkedAt(e){this._update({unlinkedAt:e})}resolve({resolvedAt:e=new Date,resolvedBy:t=null,isFromAdapter:n=!1}={}){const i=this._repository.context.plugins.get(Users).me,{channelId:r,id:s}=this;this._repository.fire(toEventName("resolveCommentThread",r),{channelId:r,threadId:s,resolvedAt:e,resolvedBy:t||i.id,isFromAdapter:n})}reopen({isFromAdapter:e=!1}={}){const{channelId:t,id:n}=this;this._repository.fire(toEventName("reopenCommentThread",t),{channelId:t,threadId:n,isFromAdapter:e})}setContext(e){this.context||this._update({context:e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this._update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this._update({attributes:t})}remove({isFromAdapter:e=!1}={}){const{channelId:t,id:n}=this;this._repository.fire(toEventName("removeCommentThread",t),{channelId:t,threadId:n,isFromAdapter:e})}attachTo(e){return this._repository._attachCommentThread({threadId:this.id,target:e})}addComment(e){const{channelId:t,id:n}=this;this._repository.fire(toEventName("addComment",t,n),Object.assign({channelId:t,threadId:n},e))}getComment(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-get-comment-invalid-id",null,{commentId:e});return this.comments.get(e)}toJSON(){return{threadId:this.id,context:this.context,unlinkedAt:this.unlinkedAt,resolvedAt:this.resolvedAt,resolvedBy:this.resolvedBy?this.resolvedBy.id:null,archivedAt:this.archivedAt,comments:this.comments.map((e=>e.toJSON())),attributes:this.attributes}}_add(e){return this.listenTo(e,"change:authoredAt",(()=>{const t=this._findOptimalIndex(e),n=this.comments;t-1!=n.getIndex(e)&&t+1!=n.getIndex(e)&&(this._remove(e),this._add(e))})),this.comments.add(e,this._findOptimalIndex(e))}_update(e){const{channelId:t,id:n}=this;this._repository.fire(toEventName("updateCommentThread",t),{...e,channelId:t,threadId:n})}_remove(e){return this.stopListening(e),e.destroy(),this.comments.remove(e)}_findOptimalIndex(e){const t=this.comments.find((t=>new Date(t.authoredAt).getTime()>new Date(e.authoredAt).getTime()));return t?this.comments.getIndex(t):this.length}}const MIN_WEIGHT=200;function getContentLength(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent.length}class Comment extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super();const n=e.context.plugins.get(Users).me,i=e.getCommentThread(t.threadId),r=0===i.comments.length,s=n===t.author;this.id=t.id,this.threadId=t.threadId,this.author=t.author,this.creator=t.creator,this.isExternal=Boolean(t.attributes&&t.attributes["@external"]),this.set("content",t.content),this.createdAt=t.createdAt||new Date,this.set("authoredAt",t.authoredAt||new Date),this.bind("resolvedAt").to(i,"resolvedAt"),this.set("attributes",t.attributes||{}),this.bind("isEditable").to(e,"_permissions",(()=>{const t=e.getPermissions(i.channelId).write,n=e.getPermissions(i.channelId).modifyAll;return s&&t||!s&&n})),this.bind("isRemovable").to(i,"isRemovable",e,"_permissions",(t=>{const n=e.getPermissions(i.channelId).write,o=e.getPermissions(i.channelId).modifyAll;return s&&n||t&&r||!s&&o&&!r})),this.bind("isReadOnly").to(i,"isReadOnly"),this._repository=e}get weight(){return Math.max(getContentLength(this.content),MIN_WEIGHT)}update(e){const{threadId:t,id:n}=this;if(!this._repository.hasCommentThread(t))throw new CKEditorError("commentsrepository-update-comment-missing-comment-thread",this);const{channelId:i}=this._repository.getCommentThread(t);this._repository.fire(toEventName("updateComment",i,t),{channelId:i,threadId:t,commentId:n,...e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this.update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this.update({attributes:t})}remove(e={}){if(!e.isFromAdapter&&!this.isRemovable)return;const{threadId:t,id:n}=this;if(!this._repository.hasCommentThread(t))throw new CKEditorError("commentsrepository-remove-comment-missing-comment-thread",this);const{channelId:i}=this._repository.getCommentThread(t);this._repository.fire(toEventName("removeComment",i,t),{channelId:i,threadId:t,commentId:n,...e})}toJSON(){return{commentId:this.id,content:this.content,createdAt:this.createdAt,authorId:this.creator.id,attributes:this.attributes}}destroy(){this.stopListening()}}function toEventName(e,...t){for(const n of t)void 0!==n&&(e+=":"+String(n));return e}class AddCommentThreadCommand extends _0x354f99{refresh(){const e=this.editor.model.document.selection;for(const t of e.getRanges())if(this._hasContent(t))return void(this.isEnabled=!0);this.isEnabled=!1}execute({threadId:e=uid()}={}){const t=this.editor.model,n=[];for(const e of t.document.selection.getRanges())this._hasContent(e)&&n.push(this._trimToContent(e));t.change((t=>{for(const i of n){const n=uid().substr(1,5),r="comment:"+e+":"+n;t.addMarker(r,{range:i,usingOperation:!1,affectsData:!1})}}))}_hasContent(e){for(const t of e.getItems())if(this._itemIsContent(t))return!0;return!1}_itemIsContent(e){return e.is("$textProxy")||this.editor.model.schema.isObject(e)&&!e.is("element","tableCell")}_trimToContent(e){const t=e=>!this._itemIsContent(e.item),n=e.start.getLastMatchingPosition(t),i=e.end.getLastMatchingPosition(t,{direction:"backward"});return this.editor.model.createRange(n,i)}}class EditorAnnotations extends Plugin{static get requires(){return[Annotations]}static get pluginName(){return"EditorAnnotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._dataCollectors=new Set,this._editorAnnotations=new Set}init(){const e=this.editor,t=e.model.document.selection,n=debounce((()=>this.refreshSelectedViews()),10);t.on("change:range",((e,t)=>{t.directChange&&(n.cancel(),this.refreshSelectedViews())})),this.listenTo(e.editing.view.document,"change:isFocused",((e,t,i)=>{i&&n()})),this.listenTo(e.ui.focusTracker,"change:isFocused",((t,n,i)=>{i||e.isReadOnly||this.fire("blur",{isAnnotationTracked:e=>this._editorAnnotationsData.has(e.innerView)})})),this.listenTo(this.editor.ui,"update",(()=>this.fire("uiUpdate")))}registerAnnotation(e){if(this._editorAnnotations.has(e.view))return;this._editorAnnotations.add(e.view),this.editor.ui.focusTracker.add(e.view.element);const t=this.editor.plugins.get(Annotations);this.listenTo(t.collection,"remove",((e,t)=>{this.editor.ui.focusTracker.remove(t.view.element),this._editorAnnotations.delete(t.view)}))}hasDomSelection(){return this.editor.editing.view.hasDomSelection}addSourceCollector(e){if("function"!=typeof e)throw new CKEditorError("editorannotations-invalid-source-callback");this._dataCollectors.add(e)}refreshSelectedViews(){this.fire("refresh")}getOrderedSelectedAnnotations({activeAnnotation:e,annotations:t}){const n=[],i=this.editor.model.document.selection,r=Array.from(i.getRanges());for(const[e,i]of this._editorAnnotationsData){const r=s(i),o=t.getByInnerView(e);r&&o&&n.push({annotation:o,range:r})}function s(e){for(const t of e)for(const e of r)if(t.containsRange(e,!i.isCollapsed))return t;return null}return n.sort(((t,n)=>{const i=t.range,r=n.range;if(!i.isEqual(r)){if(i.containsRange(r,!0))return 1;if(r.containsRange(i,!0))return-1}return t.annotation==e?-1:n.annotation==e?1:0})).map((e=>e.annotation))}get _editorAnnotationsData(){const e=new Map;for(const t of Array.from(this._dataCollectors))for(const[n,i]of t())e.set(n,i);return e}}class CommentsRestrictedEditingMode extends Plugin{afterInit(){const e=this.editor;e.plugins.has("RestrictedEditingModeEditing")&&e.plugins.get("RestrictedEditingModeEditing").enableCommand("addCommentThread")}}class CommentsImportWord extends Plugin{constructor(e){super(e),this.editor.config.define("importWord.formatting.comments","basic")}afterInit(){const e=this.editor,t=e.commands.get("importWord"),n=e.plugins.get(Users);t&&(t.on("execute",((e,[,t])=>{t.collaboration_features={comments:!0,user_id:n.me.id}}),{priority:priorities.high+10}),this.listenTo(t,"dataInsert",this._handleImportedData))}_handleImportedData(e,t){const{comment_threads:n}=t;n&&n.forEach((({thread_id:e,comments:t,is_resolved:n})=>{const i=new Date,r=t.map((({author:e,content:t,created_at:n})=>({content:t,authorId:this.editor.plugins.get(Users).me.id,createdAt:i,attributes:{"@external":{authorName:e,createdAt:n?new Date(n):new Date,source:"importWord"}}}))),s=this.editor.config.get("collaboration.channelId");this.editor.plugins.get(CommentsRepository).addCommentThread({channelId:s,threadId:e,comments:r,resolvedAt:n?i:null})}))}}class CommentsClipboard extends Plugin{constructor(e){super(e),this.editor.config.define("comments.copyMarkers","default")}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline]}afterInit(){const e=this.editor.plugins.get("ClipboardPipeline");this._registerMarkerInClipboardPipeline(),this.listenTo(e,"contentInsertion",((e,t)=>this._removeMarkersWithoutThreads(t.content.markers)),{priority:"highest"})}_removeMarkersWithoutThreads(e){if(!this.editor.plugins.has("CommentsRepository"))return e;const t=this.editor.plugins.get("CommentsRepository");for(const n of e.keys()){const[i,r]=n.split(":");"comment"!=i||t.hasCommentThread(r)||e.delete(n)}return e}_registerMarkerInClipboardPipeline(){const e=this.editor.plugins.get("ClipboardMarkersUtils"),t=this._mapCommentsCopyConfigToRegisterConfiguration(this.editor.config.get("comments.copyMarkers"));t&&e._registerMarkerToCopy("comment",t)}_mapCommentsCopyConfigToRegisterConfiguration(e){switch(e){case"always":return{allowedActions:"all",copyPartiallySelected:!1,duplicateOnPaste:!0};case"default":return{allowedActions:["cut","dragstart"],copyPartiallySelected:!1,duplicateOnPaste:!1};default:return null}}}class ShowCommentHighlights extends Plugin{init(){this.overrideMarkerConverters(),this.overrideHorizontalRuleConverter(),this.overrideImageInlineConverter(),this.overrideMediaEmbedConverter()}overrideMarkerConverters(){this.editor.conversion.for("dataDowncast").markerToHighlight({model:"comment",view:(e,t)=>{if(!t.options.showCommentHighlights)return null;if(t.options.ignoreResolvedComments){const{id:n}=splitMarkerName(e.markerName),i=this.editor.plugins.get(CommentsRepository).getCommentThread(n);if(i&&i.isResolved&&e.item)return t.consumable.consume(e.item,"addMarker:"+e.markerName),t.consumable.consume(e.item,"removeMarker:"+e.markerName),null}return{classes:["ck-comment-marker"]}}}),this.editor.conversion.for("dataDowncast").add((e=>{e.on("addMarker:comment",((e,t,n)=>{if(!n.options.showCommentHighlights)return;const i=t.item;if(!i)return;const r=n.mapper.toViewElement(i);this.editor.model.schema.isObject(i)&&r&&!r.getCustomProperty("widget")&&r.is("containerElement")&&toWidget(r,n.writer)}),{priority:"high"})}))}overrideHorizontalRuleConverter(){this.editor.conversion.for("dataDowncast").elementToStructure({model:"horizontalLine",view:(e,{writer:t,options:n})=>{if(!n.showCommentHighlights)return null;const i=t.createContainerElement("div"),r=t.createEmptyElement("hr");return t.addClass("ck-horizontal-line",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}overrideImageInlineConverter(){this.editor.conversion.for("dataDowncast").elementToStructure({model:"imageInline",view:(e,{writer:t,options:n})=>{if(!n.showCommentHighlights)return null;const i=t.createContainerElement("span"),r=t.createEmptyElement("img");return t.addClass("image-inline",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}overrideMediaEmbedConverter(){this.editor.conversion.for("dataDowncast").elementToElement({model:"media",view:(e,{writer:t,options:n})=>{if(n.showCommentHighlights)return t.createEmptyElement("div")},converterPriority:"high"}),this.editor.data.downcastDispatcher.on("attribute:url:media",((e,t,n)=>{n.options.showCommentHighlights&&e.stop()}),{priority:"high"})}}const MAX_CONTEXT_LENGTH=150;class CommentsEditing extends Plugin{static get requires(){return[CommentsRepository,EditorAnnotations,Users,CommentsRestrictedEditingMode,CommentsImportWord,CommentsClipboard,ShowCommentHighlights]}static get pluginName(){return"CommentsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("isThreadsLoadingPaused",!0),e.data.once("ready",(()=>this.isThreadsLoadingPaused=!1)),this.set("activeMarker",null),this.on("change:activeMarker",((t,n,i,r)=>{const s=e.plugins.get(CommentsRepository),o=i?splitMarkerName(i).id:null;if(e.model.change((()=>{if(o){const t=this.getAllMarkersForId(o);for(const n of t)e.editing.reconvertMarker(n)}if(r){const{id:t}=splitMarkerName(r),n=s.getCommentThread(t);if(n&&!n.isAttached)return;const i=this.getAllMarkersForId(t);for(const t of i)e.editing.reconvertMarker(t)}})),o){const e=s.getCommentThread(o);e&&e.isResolved&&this.scrollToThreadMarker(o)}})),this._initAriaMarkerChangeAnnouncements()}init(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=e.config.get("collaboration.channelId");e.commands.add("addCommentThread",new AddCommentThreadCommand(e)),this.listenTo(e,"change:isReadOnly",((n,i,r)=>{t.switchReadOnly(r,e.config.get("collaboration.channelId"))})),this.listenTo(t,createChannelEvent("addCommentThread",n),((e,{threadId:t})=>{const n=this.editor.plugins.get(CommentsRepository).getCommentThread(t);n&&n.unlinkedAt&&this._attachArchivedThread(t)})),this.listenTo(t,createChannelEvent("removeCommentThread",n),((t,{threadId:n})=>{e.model.enqueueChange({isUndoable:!1},(e=>{const t=this.getAllMarkersForId(n);for(const n of t)e.removeMarker(n)}))})),this.listenTo(t,createChannelEvent("resolveCommentThread",n),((e,{threadId:t})=>{this._reconvertMarkers(t),this.editor.editing.view.hasDomSelection&&(this.editor.plugins.get(CommentsRepository).getCommentThread(t).unlinkedAt||this.editor.editing.view.focus())}),{priority:"low"}),this.listenTo(t,createChannelEvent("reopenCommentThread",n),((e,{threadId:t})=>{this._reconvertMarkers(t)}),{priority:"low"}),this.listenTo(t,createChannelEvent("addComment",n),((n,{threadId:i,isFromAdapter:r})=>{const s=this.getAllMarkersForId(i);!r&&0!=s.length&&t.hasCommentThread(i)&&1===t.getCommentThread(i).length&&e.model.enqueueChange({isUndoable:!1},(e=>{for(const t of s)e.updateMarker(t,{usingOperation:!0,affectsData:!0})}))}),{priority:"low"}),this._initializeMarkerConverters(),this._handleMarkerAddAndRemove()}afterInit(){checkLicense$b(this)}destroy(){const e=this.editor.plugins.get(CommentsRepository),t=this.editor.config.get("collaboration.channelId");for(const n of e.getCommentThreads({channelId:t}))e._detachCommentThread(n.id),e._threads.delete(n.id);super.destroy()}hasMarkerForId(e){return this.getAllMarkersForId(e).length>0}getAllMarkersForId(e){const t=[];for(const n of this.editor.model.markers)n.name.startsWith("comment:"+e)&&t.push(n);return t}scrollToThreadMarker(e){const t=this._getTargetForId(e);t&&setTimeout((()=>{this.activeMarker&&splitMarkerName(this.activeMarker).id===e&&scrollViewportToShowTarget({target:t[0],viewportOffset:100,alignToTop:!0})}),50)}_reconvertMarkers(e){this.editor.model.change((()=>{for(const t of this.getAllMarkersForId(e))this.editor.editing.reconvertMarker(t)}))}_attachArchivedThread(e){const t=this.editor.plugins.get(CommentsRepository),n=this.editor.plugins.get(EditorAnnotations),i=t.getCommentThread(e);if(!i.isAttached){const e=i.attachTo((()=>this._getTargetForId(i.id)));n.registerAnnotation(e),i._hasTargetInContent=!1}}_initializeMarkerConverters(){const e=this.editor,t=e.plugins.get(Users);e.conversion.for("editingDowncast").markerToHighlight({model:"comment",view:(n,i)=>{const{id:r}=splitMarkerName(n.markerName),s=e.plugins.get(CommentsRepository).getCommentThread(r),o=this.activeMarker&&splitMarkerName(this.activeMarker).id===r;let a;if(s&&s.isResolved&&!o&&n.item)return i.consumable.consume(n.item,"addMarker:"+n.markerName),i.consumable.consume(n.item,"removeMarker:"+n.markerName),null;const c=["ck-comment-marker"];return o&&c.push("ck-comment-marker--active"),a=s&&s.length?s.comments.first.author.id:t.me.id,{classes:c,attributes:{"data-comment":r,"data-author-id":a}}}}),e.conversion.for("dataDowncast").markerToData({model:"comment",view:(t,{options:n})=>{if(n.showCommentHighlights)return null;const i=e.plugins.get(CommentsRepository),r=e.model.markers.get(t),{id:s,part:o}=splitMarkerName(t);if(r&&!r.affectsData)return null;if(n.ignoreResolvedComments){const e=i.getCommentThread(s);if(e&&e.isResolved)return null}return{group:"comment",name:o?s+":"+o:s}}}),e.conversion.for("upcast").elementToElement({view:{name:"comment",attributes:{id:/^\w/}},model:(e,{writer:t})=>t.createElement("$marker",{"data-name":"comment:"+e.getAttribute("id")})}),e.conversion.for("upcast").dataToMarker({view:"comment"})}_handleMarkerAddAndRemove(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=new Set,i=new Set;e.model.document.registerPostFixer((t=>{let r=!1;for(const{name:s,data:o}of e.model.document.differ.getChangedMarkers()){const{group:a,id:c}=splitMarkerName(s);let l=o.newRange;if("comment"!==a||!l)continue;const d="$graveyard"===l.root.rootName;d||(l=fixMarkerRange(l,e.model),!l||l.isCollapsed||!o.newRange||l.isEqual(o.newRange))?e.model.hasContent(l)&&!d?this.isThreadsLoadingPaused?n.add(s):this._handleThreadMarker(s,c):(i.add(s),n.delete(s),t.removeMarker(s),r=!0):(t.updateMarker(s,{range:l}),r=!0)}return r})),this.on("change:isThreadsLoadingPaused",((t,i,r)=>{if(!r&&n.size)for(const t of n){const{id:i}=splitMarkerName(t);n.delete(t),e.model.markers.get(t)&&this._handleThreadMarker(t,i)}})),this.listenTo(e.model.document,"change",(()=>{for(const{name:r,data:{newRange:s}}of e.model.document.differ.getChangedMarkers()){const{group:o,id:a}=splitMarkerName(r);if("comment"!==o)continue;const c=t.getCommentThread(a),l=this.hasMarkerForId(a);c&&(!c._hasTargetInContent&&s&&e.editing.view.once("render",(()=>{const n=e.plugins.get(Annotations),i=t._threadToController.get(c).view;n.getByInnerView(i).refreshVisibility()}),{priority:"low"}),c._hasTargetInContent=l||!!s),s||(i.add(r),n.delete(r))}for(const e of i){const{id:i}=splitMarkerName(e),r=t.getCommentThread(i);if(n.delete(e),!r)continue;const s=this.hasMarkerForId(i);s||r.isSubmitted?s||r.unlinkedAt||r.setUnlinkedAt(new Date):r.remove()}i.clear()}))}_getTargetForId(e){const t=this.editor,n=this.getAllMarkersForId(e);return getAllMarkersDomElementsSorted(t.editing,n)}_getTextContext(e){const t=this.getAllMarkersForId(e);let n="",i=!1;for(const e of t){const t=e.getRange();for(const e of Array.from(t.getItems()))e.is("$textProxy")?(n&&i&&(n+=" ",i=!1),n+=e.data):i=!0;i=!0}return n.substring(0,MAX_CONTEXT_LENGTH)}_attachMarkerToThread(e,t){const n=this.editor,i=n.plugins.get(CommentsRepository);let r=i.getCommentThread(t);const s=n.config.get("collaboration.channelId"),o=n.plugins.get(EditorAnnotations);return r&&(r.unlinkedAt&&r.setUnlinkedAt(null),r.isAttached)||(this.getAllMarkersForId(t)[0].managedUsingOperations?i.fetchCommentThread({channelId:s,threadId:t}).then((e=>{if("destroyed"!==n.state)if(r=e,r&&!r.isAttached){const e=r.attachTo((()=>this._getTargetForId(t)));o.registerAnnotation(e),r.isResolved&&this._reconvertMarkers(t)}else if(!r){const e=this.getAllMarkersForId(t);n.model.change((t=>{for(const n of e)t.removeMarker(n)}))}})):n.editing.view.once("render",(()=>{if(i.getCommentThread(t))return;const e=n.plugins.get(Annotations);r=i.openNewCommentThread({channelId:s,threadId:t,target:()=>this._getTargetForId(t),context:{type:"text",value:this._getTextContext(t)}});const a=i._threadToController.get(r).view,c=e.getByInnerView(a);c&&o.registerAnnotation(c)}),{priority:"low"})),r}_handleThreadMarker(e,t){const n=this._attachMarkerToThread(e,t);n&&!n.context&&n.setContext({type:"text",value:this._getTextContext(t)})}_initAriaMarkerChangeAnnouncements(){const e=this.editor;surroundingMarkersDetector(e.model,(({left:t,entered:n})=>{for(const n of t)if(isCommentMarker(n)){e.ui.ariaLiveAnnouncer.announce(getTranslation$d(e.locale,"LEAVE_COMMENT_ANNOUNCEMENT"));break}for(const t of n)if(isCommentMarker(t)){e.ui.ariaLiveAnnouncer.announce(getTranslation$d(e.locale,"ENTER_COMMENT_ANNOUNCEMENT",getEnvKeystrokeText(FOCUS_ANNOTATION_KEYSTROKE)));break}}))}}function createChannelEvent(e,t){return t?e+":"+t:e}function splitMarkerName(e){const t=e.split(":");return{group:t[0],id:t[1],part:t[2]}}function fixMarkerRange(e,t){const n=t.schema,i=t.createRange(e.start);for(const r of e.getWalker()){const{type:e,item:s,nextPosition:o}=r;if("text"===e||n.isObject(s)){const e=t.createPositionBefore(s);i.isCollapsed&&(i.start=e),i.end=o}}return i}function isCommentMarker(e){return"comment"===splitMarkerName(e.name).group}async function checkLicense$b(e){const t=p([49,66,106,81,117,71,52,98,118,51,99,104,65,83,55,112,108,76,79,75,68,82,86,109,80,115,69,114,122,113,90,89,67,88,105,101,48,70,87,84,97,53,85,102,72,111,78,119,100,107,54,120,74,77,110,116,73,103,57,56,50,121]),n=window[p([68,97,116,101])][p([110,111,119])](),i=e[p([101,100,105,116,111,114])],r=new(window[p([80,114,111,109,105,115,101])])((e=>{i[p([111,110,99,101])](p([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU0NTYxNjR9.eyJqdGkiOjc1ODA4MTY4OTQsImFsZyI6IkVTMjU2IiwiaWR4IjozMDg5NDE4NjIzNzQ1LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiJlZDhhNDIyYi1hZDc0LTQ3MTMtYmNlYy0xYTBiMjI0NWY4YjgiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NDU2MTY0LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTQ1Nn0.pM7-T8bzbvvuYHShvQrhjmyVfs6QRX8vrCkM-qcJ-QDBIYGWLbct7qeE3BiNI6t1ehxOse4lfpEhU-MSRG9Kjg"),o=i[p([99,111,110,102,105,103])][p([103,101,116])](p([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[p([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[p([116,104,101,110])]((()=>new(window[p([80,114,111,109,105,115,101])])((e=>{let t=0;i[p([109,111,100,101,108])][p([111,110])](p([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][p([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[p([111,102,102])]())}))}))))];return window[p([80,114,111,109,105,115,101])][p([114,97,99,101])](t)[p([116,104,101,110])]((()=>e))}function c(e){return e[p([115,116,97,114,116,115,87,105,116,104])](p([101,121]))?JSON[p([112,97,114,115,101])](l(e)):null}function l(e){return window[p([97,116,111,98])](e[p([114,101,112,108,97,99,101])](/-/g,p([43]))[p([114,101,112,108,97,99,101])](/_/g,p([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[p([108,101,110,103,116,104])];n++){const i=e[p([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[p([105,115,65,114,114,97,121])](t)?t[p([102,111,114,69,97,99,104])](e):t&&typeof t==p([111,98,106,101,99,116])?Object[p([101,110,116,114,105,101,115])](t)[p([115,111,114,116])]()[p([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[p([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[p([116,111,83,116,114,105,110,103])](16)[p([112,97,100,83,116,97,114,116])](8,p([48]))}function h(e){return e[p([115,112,108,105,116])]("")[p([114,101,118,101,114,115,101])]()[p([106,111,105,110])]("")}function m(e){return i[p([112,108,117,103,105,110,115])][p([104,97,115])](e)}function g(){}function p(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[p([83,116,114,105,110,103])](window[p([112,101,114,102,111,114,109,97,110,99,101])][p([110,111,119])]())[p([114,101,112,108,97,99,101])](p([46]),"");let n=p([66]);for(let i=0;i<e[p([108,101,110,103,116,104])];i+=2){let r=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[p([108,101,110,103,116,104])]&&(r-=t[p([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=p([99,111,109,109,101,110,116,115,76,105,99,101,110,115,101,75,101,121])+e,e!=p([86,97,108,105,100])&&async function(){await r,i[p([109,111,100,101,108])][p([99,104,97,110,103,101])]=g,i[p([109,111,100,101,108])][p([101,110,113,117,101,117,101,67,104,97,110,103,101])]=g,i[p([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](p([109,111,100,101,108]))}()}(await async function(){let e,t=null,g=null;try{if(o==p([71,80,76]))return p([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[p([115,112,108,105,116])](p([46]));if(3!=e[p([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[p([106,116,105])],n=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](e[p([108,101,110,103,116,104])]-8),16),i={...t,[p([106,116,105])]:e[p([115,117,98,115,116,114,105,110,103])](0,e[p([108,101,110,103,116,104])]-8)};return delete i[p([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return p([73,110,118,97,108,105,100]);e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(f=e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[p([106,116,105])],g=new(window[p([80,114,111,109,105,115,101])])((e=>{if(i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==p([97,117,116,111]))return e(p([86,97,108,105,100]));i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=p([97,117,116,111]),i[p([100,101,99,111,114,97,116,101])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[p([80,114,111,109,105,115,101])])(((e,t)=>{i[p([116,104,101,110])](e,t),window[p([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[p([116,104,101,110])]((e=>e&&e[p([115,116,97,116,117,115])]==p([111,107])?u(d(s+y))!=e[p([118,101,114,105,102,105,99,97,116,105,111,110])]?p([85,115,97,103,101,76,105,109,105,116]):p([86,97,108,105,100]):p([85,115,97,103,101,76,105,109,105,116])))[p([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=p([108,108,99,116,45])+u(d(f)),t=window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([103,101,116,73,116,101,109])](e);return t?window[p([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),p([86,97,108,105,100])):p(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[p([116,104,101,110])](e)[p([99,97,116,99,104])]((()=>{e(p([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=p([108,108,99,116,45])+u(d(f)),t=h(u(window[p([77,97,116,104])][p([99,101,105,108])](n/r)));window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([115,101,116,73,116,101,109])](e,t)}}i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=f)return e(p([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[p([114,101,113,117,101,115,116,73,100])]:s}}),{[p([112,114,105,111,114,105,116,121])]:p([104,105,103,104])}),i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[p([114,101,116,117,114,110])])&&(typeof n===p([111,98,106,101,99,116])||typeof n===p([102,117,110,99,116,105,111,110]))&&typeof n[p([116,104,101,110])]===p([102,117,110,99,116,105,111,110])&&typeof n[p([99,97,116,99,104])]===p([102,117,110,99,116,105,111,110])&&(t=!0,o(e[p([114,101,116,117,114,110])]))}),{[p([112,114,105,111,114,105,116,121])]:p([108,111,119])}),r[p([116,104,101,110])]((()=>{t||e(p([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[p([115,112,108,105,116])](p([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[p([97,108,103])]==p([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[p([85,105,110,116,56,65,114,114,97,121])][p([102,114,111,109])](l(i),(e=>e[p([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[p([84,101,120,116,69,110,99,111,100,101,114])]))[p([101,110,99,111,100,101])](t+p([46])+n),a=window[p([99,114,121,112,116,111])][p([115,117,98,116,108,101])];if(!a)return;const c=await a[p([105,109,112,111,114,116,75,101,121])](p([106,119,107]),s,{[p([110,97,109,101])]:p([69,67,68,83,65]),[p([110,97,109,101,100,67,117,114,118,101])]:p([80,45,50,53,54])},!1,[p([118,101,114,105,102,121])]);await a[p([118,101,114,105,102,121])]({[p([110,97,109,101])]:p([69,67,68,83,65]),[p([104,97,115,104])]:{[p([110,97,109,101])]:p([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[p([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[p([105,110,99,108,117,100,101,115])](p([42])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([67,77,84])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([82,67,77,84]))){if(m(p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&(n=p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]),i[p([112,108,117,103,105,110,115])][p([103,101,116])](n))[p([115,116,97,116,101])]==p([99,111,110,110,101,99,116,101,100]))return!0;if(m(p([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||m(p([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}var n;return!1}()?function(){const t=[p([101,118,97,108,117,97,116,105,111,110]),p([116,114,105,97,108])][p([105,110,99,108,117,100,101,115])](e[p([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[p([101,120,112])]<t}()?p([69,120,112,105,114,101,100]):function(){const t=e[p([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[p([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[p([108,111,99,97,116,105,111,110])].href);if(t[p([105,110,99,108,117,100,101,115])](n))return!0;const i=n[p([115,112,108,105,116])](p([46]));return t[p([102,105,108,116,101,114])]((e=>e[p([105,110,99,108,117,100,101,115])](p([42]))))[p([109,97,112])]((e=>e[p([115,112,108,105,116])](p([46]))))[p([115,111,109,101])]((e=>i[p([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===p([42])))))}()?(e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([101,118,97,108,117,97,116,105,111,110])&&(t=a(p([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([116,114,105,97,108])&&(t=a(p([84,114,105,97,108,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(p([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&g?new(window[p([80,114,111,109,105,115,101])])(((e,n)=>{t[p([116,104,101,110])](e,n),g[p([116,104,101,110])]((t=>{t!=p([86,97,108,105,100])&&e(t)}),n)})):t||g||p([86,97,108,105,100]))):p([68,111,109,97,105,110,76,105,109,105,116]):p([78,111,116,65,108,108,111,119,101,100]):p([73,110,118,97,108,105,100])}catch(e){return p([73,110,118,97,108,105,100])}var f,y}())}var commentIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5h12A3.5 3.5 0 0 1 19.5 5v8l-.005.192a3.5 3.5 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.371-.193-.38-.212a13.452 13.452 0 0 1-3.271-2.63l-.062-.07H4A3.5 3.5 0 0 1 .5 13V5A3.5 3.5 0 0 1 4 1.5ZM4 3a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6.924a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L14.962 15H16a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4Z"/><path d="M9.75 5a.75.75 0 0 0-.75.75v2.5H6.5a.75.75 0 0 0 0 1.5H9v2.5a.75.75 0 0 0 1.5 0v-2.5H13a.75.75 0 0 0 0-1.5h-2.5v-2.5A.75.75 0 0 0 9.75 5Z"/></svg>\n';class CommentsUI extends Plugin{static get pluginName(){return"CommentsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsRepository,CommentsEditing,EditorAnnotations,Annotations]}get CommentsListView(){return CommentsListView}get CommentThreadInputView(){return CommentThreadInputView}init(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=e.plugins.get(CommentsEditing),i=e.plugins.get(Annotations),r=e.plugins.get(EditorAnnotations);e.ui.componentFactory.add("comment",(()=>{const e=this._createUIButton(ButtonView);return e.tooltip=!0,e})),e.ui.componentFactory.add("menuBar:comment",(()=>this._createUIButton(MenuBarMenuListItemButtonView))),r.addSourceCollector((()=>{const e=[];for(const[i,r]of t._threadToController){const t=n.getAllMarkersForId(i.id),s=t.map((e=>e.getRange()));t.length>0&&e.push([r.view,s])}return e})),this.listenTo(i,"change:activeAnnotations",((e,i,r)=>{const s=Array.from(r).map((e=>e.innerView)).find((e=>t._viewToController.has(e)));if(!s)return void(n.activeMarker=null);const o=t._viewToController.get(s).model.id,a="comment:"+o;o&&n.hasMarkerForId(o)?n.activeMarker=a:n.activeMarker&&(n.activeMarker=null)})),this.listenTo(t,"removeCommentThread",((t,{threadId:i,isFromAdapter:r})=>{!r&&e.ui.focusTracker.isFocused&&n.hasMarkerForId(i)&&e.editing.view.focus()}),{priority:"highest"}),this.listenTo(t,"addComment",((i,{threadId:r,isFromAdapter:s})=>{!s&&n.hasMarkerForId(r)&&t.hasCommentThread(r)&&1===t.getCommentThread(r).length&&(e.editing.view.focus(),i.stop())}),{priority:"low"}),this.licenseKey=this.editor.config.get("licenseKey");const s=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in s){const n=t,i=s[n];if("commentsLicenseKeyValid"==i||"commentsLicenseKeyInvalid"==i||"commentsLicenseKeyExpired"==i||"commentsLicenseKeyDomainLimit"==i||"commentsLicenseKeyNotAllowed"==i||"commentsLicenseKeyEvaluationLimit"==i||"commentsLicenseKeyTrialLimit"==i||"commentsLicenseKeyDevelopmentLimit"==i||"commentsLicenseKeyUsageLimit"==i){delete s[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"commentsLicenseKeyInvalid"==e&&s._showLicenseError("invalid"),"commentsLicenseKeyExpired"==e&&s._showLicenseError("expired"),"commentsLicenseKeyDomainLimit"==e&&s._showLicenseError("domainLimit"),"commentsLicenseKeyNotAllowed"==e&&s._showLicenseError("featureNotAllowed","Comments"),"commentsLicenseKeyEvaluationLimit"==e&&s._showLicenseError("evaluationLimit"),"commentsLicenseKeyTrialLimit"==e&&s._showLicenseError("trialLimit"),"commentsLicenseKeyDevelopmentLimit"==e&&s._showLicenseError("developmentLimit"),"commentsLicenseKeyUsageLimit"==e&&s._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_createUIButton(e){const t=this.editor,n=new e(t.locale),i=t.commands.get("addCommentThread");return n.set({label:getTranslation$d(t.locale,"Comment"),icon:commentIcon}),n.bind("isEnabled").to(i),this.listenTo(n,"execute",(()=>i.execute())),n}}class CommentsOnly extends Plugin{static get pluginName(){return"CommentsOnly"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsEditing]}constructor(e){super(e),this.set("isEnabled",!1),this.on("change:isEnabled",((e,t,n)=>{n?this._enableCommentsOnlyMode():this._disableCommentsOnlyMode()}))}afterInit(){!this.isEnabled&&this.editor.config.get("commentsOnly")&&(this.isEnabled=!0)}_enableCommentsOnlyMode(){for(const[e,t]of this.editor.commands)t.affectsData&&"addCommentThread"!==e&&t.forceDisabled("commentsOnlyMode");this.editor.plugins.has("DragDrop")&&this.editor.plugins.get("DragDrop").forceDisabled("commentsOnlyMode");const e=this.editor.editing.view.document;this.listenTo(e,"cut",(e=>e.stop()),{priority:"highest"}),this.listenTo(e,"clipboardInput",(e=>e.stop()),{priority:"highest"}),this.listenTo(e,"delete",(e=>e.stop()),{priority:"highest"})}_disableCommentsOnlyMode(){for(const[e,t]of this.editor.commands)t.affectsData&&"addCommentThread"!==e&&t.clearForceDisabled("commentsOnlyMode");this.stopListening(this.editor.editing.view.document)}}class AnnotationsUIs extends ContextPlugin{static get requires(){return[Annotations]}static get pluginName(){return"AnnotationsUIs"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.activeUIs=new Set,this._uis=new Map,this._uisData=new Map}init(){const e=this.context.plugins.get(Annotations);this.listenTo(e,"_activateAnnotation",((e,t)=>{for(const e of this.activeUIs){const n=this._uis.get(e);(0,this._uisData.get(e).filter)(t)&&n.setActiveAnnotation(t)}})),this.listenTo(e,"_deactivateAllAnnotations",(()=>{for(const e of this.activeUIs)this._uis.get(e).setActiveAnnotation(null)})),this.listenTo(e._visibleAnnotations,"add",((e,t)=>{this._assertAnnotationDoesNotBelongToMultipleUIs(t)}))}hasActive(){return this.activeUIs.size>0}isActive(e){return this.activeUIs.has(e)}activate(e,t=()=>!0){const n=this.context.plugins.get(Annotations);if(!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});this.isActive(e)&&this.deactivate(e),this.activeUIs.add(e);const i=new AnnotationCollection;bindAnnotationCollections({source:n._visibleAnnotations,target:i,filter:t}),this._uisData.set(e,{collection:i,filter:t});const r=this._uis.get(e);r.attach(i),this.listenTo(r,"change:activeAnnotation",((e,t,i,r)=>{r&&n._removeActiveAnnotation(r),i&&n._addActiveAnnotation(i)}))}deactivate(e){if(this.activeUIs.delete(e),!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});const t=this._uis.get(e);t.detach(),this.stopListening(t),this._uisData.get(e).collection.destroy(),this._uisData.delete(e)}switchTo(e){if(!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});const t=this.context.plugins.get(Annotations),n=Array.from(t.activeAnnotations)[0]||null;this.deactivateAll(),this.activate(e);const i=this._uis.get(e);i.setActiveAnnotation(n),i._setSelectedAnnotations&&n&&i._setSelectedAnnotations([n])}deactivateAll(){for(const e of this.activeUIs)this.deactivate(e)}register(e,t){if(this._uis.has(e))throw new CKEditorError("annotationsuis-register-already-registered");if("function"!=typeof t.attach||"function"!=typeof t.detach||"function"!=typeof t.setActiveAnnotation)throw new CKEditorError("annotationsuis-register-invalid-interface",null);this._uis.set(e,t)}refilterAnnotations(){const e=this.context.plugins.get(Annotations).collection,t=new Map,n=Array.from(this.activeUIs);for(const e of this.activeUIs){const n=this._uisData.get(e).collection;for(const i of n)t.set(i,e)}for(const i of e){const e=t.get(i);this._assertAnnotationDoesNotBelongToMultipleUIs(i);const r=n.find((e=>this._uisData.get(e).filter(i)));e!==r&&(e&&this._uisData.get(e).collection.remove(i),r&&this._uisData.get(r).collection.add(i))}}destroy(){this.deactivateAll(),super.destroy()}_assertAnnotationDoesNotBelongToMultipleUIs(e){const t=[];for(const n of this.activeUIs)(0,this._uisData.get(n).filter)(e)&&t.push(n);if(t.length>1)throw new CKEditorError("annotationsuis-annotation-mismatch",null,{matchedUIs:t,annotationType:e.type})}}const toPx$2=toUnit("px");class SidebarView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("minHeight",0),this.set("class",""),this.list=this.createCollection(),this.focusables=this.createCollection(),this.list.delegate("arrowup","arrowdown").to(this),this.focusTracker=new FocusTracker,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-sidebar","ck-reset",t.to("class")],style:{minHeight:t.to("minHeight",(e=>"number"==typeof e?toPx$2(e+10):null))},dir:e.uiLanguageDirection,role:"application","aria-label":getTranslation$d(e,"Annotations sidebar"),tabindex:0},children:[{tag:"div",attributes:{role:"list","aria-label":getTranslation$d(e,"Annotations list")},children:this.list}]})}render(){super.render(),this._setupKeyboardNavigation()}focus(){this.focusCycler.focusFirst()}_setupKeyboardNavigation(){this.list.delegate("change:top").to(this),this.on("change:top",(e=>{this._updateItemPositionInFocusables(e.source)})),this.list.forEach((e=>{this.focusTracker.add(e.element),this._updateItemPositionInFocusables(e)})),this.list.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.focusables.remove(e);for(const e of t.added)this.focusTracker.add(e.element),this._updateItemPositionInFocusables(e)})),this.on("arrowup",(()=>{this.focusCycler.focusPrevious()})),this.on("arrowdown",(()=>{this.focusCycler.focusNext()})),this.listenTo(this.element,"focus",(()=>{this.focus()}))}_updateItemPositionInFocusables(e){const t=this.focusables.getIndex(e);let n,i;for(const t of this.focusables)if(e.top<t.top){n=t;break}if(i=n?this.focusables.getIndex(n):this.focusables.length,-1!==t){if(t===i-1)return;this.focusables.remove(e),i=n?this.focusables.getIndex(n):this.focusables.length}this.focusables.add(e,i)}}const toPx$1=toUnit("px");class SidebarItemView extends View{constructor(e){super(e),this.set("top",0),this.set("height",0),this.bind("bottom").to(this,"top",this,"height",((e,t)=>e+t)),this.set("isAnimationDisabled",!1),this._mutationObserver=createMutationObserver((()=>this.updateHeight())),this._targetTop=null,this.content=this.createCollection(),this.content.delegate("arrowup","arrowdown").to(this);const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck-sidebar-item",t.to("isAnimationDisabled",(e=>e?"ck-sidebar-item--no-animation":""))],style:{top:t.to("top",(e=>toPx$1(e)))},role:"presentation"},children:this.content})}render(){super.render(),this._mutationObserver.attach(this.element)}focus(){this.content.first&&this.content.first.focus()}updateHeight(){const e=this.element.clientHeight;e&&(this.height=e)}destroy(){this.content.clear(),this._mutationObserver.detach(),super.destroy()}}class Sidebar extends ContextPlugin{static get pluginName(){return"Sidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("_lastItem",void 0),this.view=this._createSidebarView(),this.set("container",null),this._spaceBetweenItems=25,this._sidebarItemViewToAnnotation=new Map,this._annotationToSidebarItemView=new Map,this.context.config.define("sidebar.preventScrollOutOfView",!1),this._annotations=null,this._activeAnnotation=null,this._recalculateBuffer=[]}init(){const e=this.context.config.get("sidebar.container");e&&this.setContainer(e)}setContainer(e){if(!isElement(e))throw new CKEditorError("sidebar-setcontainer-invalid-element");this.container=e}_attachToContainer({viewClass:e="",spaceBetweenItems:t=25}={}){if(!isElement(this.container))throw new CKEditorError("sidebar-attachtocontainer-missing-container",this);this.container.appendChild(this.view.element),this.view.class=e,this._spaceBetweenItems=t}rearrange({removedAnnotation:e,previousAnnotation:t,nextAnnotation:n}){const i=this.getSidebarItemView(e);this.view.list.remove(i),this._destroySidebarItemView(e),t&&this._alignToTargetRect(this.getSidebarItemView(t)),n&&this._alignToTargetRect(this.getSidebarItemView(n)),this._updateLastItem()}refresh({blurredAnnotation:e,activatedAnnotation:t,disableAnimationOnActivatedAnnotation:n}){if(this._activeAnnotation=t,e){e.isActive=!1;const t=this.getSidebarItemView(e);t&&n&&(t.isAnimationDisabled=!1)}if(t){const e=this.getSidebarItemView(t);e&&(t.isActive=!0,n&&(e.isAnimationDisabled=!0,e.top+=1),this._alignToTargetRect(e))}}_detachFromContainer(e){if(this.view.element.remove(),e)for(const t of e)this._destroySidebarItemView(t);this.view.list.clear(),this.view.class="",this._lastItem=null}addAnnotation(e,t){t||(t=e.view);const n=new SidebarItemView(this.context.locale);this._sidebarItemViewToAnnotation.set(n,e),this._annotationToSidebarItemView.set(e,n),n.content.add(t),this.listenTo(e.view,"change:targetRect",((t,i,r)=>{const s=this._getTargetTop(e,r);n._targetTop!=s&&(n._targetTop=s,this._setItemTop(n,s))})),this.listenTo(n,"change:top",(()=>{this._recalculate(n,"top")})),this.listenTo(n,"change:bottom",(()=>{this._recalculate(n,"bottom")})),this._alignToTargetRect(n);const i=this._getItemBefore(n);return i&&this._alignAfterItem(i,n)||this._alignToTargetRect(n),this._updateLastItem(),this.view.list.add(n),n}_alignForTopChange(e){if(!e.content.length)return;const t=this._getItemBefore(e);if(!t)return;const n=this._sidebarItemViewToAnnotation.get(t),i=this._activeAnnotation;i&&i===n?this._alignAfterItem(t,e):this._alignBeforeItem(e,t)}_alignForBottomChange(e){if(!e.content.length)return;const t=this._getItemAfter(e);if(!t)return;const n=this._sidebarItemViewToAnnotation.get(t),i=this.context.config.get("sidebar.preventScrollOutOfView"),r=this._activeAnnotation;r&&r===n&&i?(this._alignBeforeItem(t,e),this._alignAfterItem(e,t)):r&&r===n?this._alignBeforeItem(t,e):this._alignAfterItem(e,t)}_recalculate(e,t){0===this._recalculateBuffer.length&&setTimeout((()=>{for(const{sidebarItemView:e,changedProp:t}of this._recalculateBuffer)"top"===t?this._alignForTopChange(e):this._alignForBottomChange(e);this._recalculateBuffer=[]}),10),this._recalculateBuffer.push({sidebarItemView:e,changedProp:t})}getSidebarItemView(e){return this._annotationToSidebarItemView.get(e)}destroy(){this.stopListening(),this.view.destroy()}_destroySidebarItemView(e){const t=this.getSidebarItemView(e);this.stopListening(t),this.stopListening(e.view),t.destroy(),this._annotationToSidebarItemView.delete(e),this._sidebarItemViewToAnnotation.delete(t)}_createSidebarView(){const e=new SidebarView(this.context.locale);return e.render(),this.on("change:_lastItem",((t,n,i,r)=>{r&&e.unbind("minHeight"),i?e.bind("minHeight").to(i,"bottom"):e.minHeight=null})),e}_updateLastItem(){var e;this._lastItem=(null===(e=this._annotations)||void 0===e?void 0:e.last)?this.getSidebarItemView(this._annotations.last):null}_getItemBefore(e){var t;const n=this._sidebarItemViewToAnnotation.get(e),i=n&&(null===(t=this._annotations)||void 0===t?void 0:t.get(this._annotations.getIndex(n)-1));return i&&this.getSidebarItemView(i)||null}_getItemAfter(e){var t;const n=this._sidebarItemViewToAnnotation.get(e),i=n&&(null===(t=this._annotations)||void 0===t?void 0:t.get(this._annotations.getIndex(n)+1));return i&&this.getSidebarItemView(i)||null}_alignBeforeItem(e,t){e.updateHeight();const n=getOverlap(t.bottom+this._spaceBetweenItems,e.top);return!!n&&(this._setItemTop(t,t.top-n),!0)}_alignAfterItem(e,t){e.updateHeight();const n=getOverlap(e.bottom+this._spaceBetweenItems,t.top);return!!n&&(this._setItemTop(t,t.top+n,!1),!0)}_alignToTargetRect(e){const t=this._sidebarItemViewToAnnotation.get(e);if(!t||!t.target||!t.targetRect)return;const n=this._getTargetTop(t,t.targetRect);this._setItemTop(e,n)}_getTargetTop(e,t){if(null===t)return 0;if(e.target instanceof Rect)return t.top;{const e=new Rect(this.view.element).top;return t.top-e}}_setItemTop(e,t,n=this.context.config.get("sidebar.preventScrollOutOfView")){n&&(t=Math.max(t,this._getMaxAvailableTop(e))),e.top=t}_getMaxAvailableTop(e){let t=this._getItemBefore(e),n=0;for(;t;)t.updateHeight(),n+=this._spaceBetweenItems+t.height,t=this._getItemBefore(t);return n}}function getOverlap(e,t){return Math.max(e-t,0)}function isElement(e){return null!==e&&"object"==typeof e&&1===e.nodeType}class WideSidebar extends ContextPlugin{static get requires(){return[Sidebar,AnnotationsUIs]}static get pluginName(){return"WideSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce((()=>{this.annotations.refreshPositioning()}),250,{leading:!1})}init(){const e=this.context.plugins.get(AnnotationsUIs),t=this.context.plugins.get(Sidebar);e.register("wideSidebar",this),t.container&&e.switchTo("wideSidebar")}setActiveAnnotation(e){if(e===this.activeAnnotation)return;const t=this.context.plugins.get(Sidebar);t._activeAnnotation=e;const n=this.activeAnnotation;t.refresh({blurredAnnotation:n,activatedAnnotation:e}),this.activeAnnotation=e}attach(e){this.annotations=e;const t=this.context.plugins.get(Sidebar);if(t._annotations=e,this.isAttached)throw new CKEditorError("widesidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(t,"set:container",(()=>{this.detach(),this.listenTo(t,"change:container",(t=>{t.off(),this.attach(e)}))})),t._attachToContainer({viewClass:"ck-sidebar--wide"});const n=e=>{e.updateTargetRect(),t.addAnnotation(e)};for(const t of e)n(t);this.listenTo(e,"add",((e,t)=>{n(t)})),this.listenTo(e,"remove",((n,i,r)=>{t.rearrange({removedAnnotation:i,previousAnnotation:e.get(r-1),nextAnnotation:e.get(r+1)}),i===this.activeAnnotation&&this.setActiveAnnotation(null)}),{priority:"high"}),this.listenTo(e,"focus",((e,t)=>{this.setActiveAnnotation(t)})),this.listenTo(e,"blur",(()=>{this.setActiveAnnotation(null)}));const i=this.context instanceof Context?this.context.editors:new Collection([this.context]);for(const e of i)this._integrateWithEditorAnnotations(e);this.listenTo(i,"add",((e,t)=>{this.listenTo(t,"ready",(()=>{this._integrateWithEditorAnnotations(t)}))})),this.listenTo(i,"remove",((e,t)=>{t.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(t.plugins.get("EditorAnnotations"))})),window.addEventListener("resize",this._refreshPositioningDebounced),this.annotations.refreshPositioning()}detach(){if(!this.isAttached)throw new CKEditorError("widesidebar-detach-not-attached",this);this.setActiveAnnotation(null);const e=this.context.plugins.get(Sidebar);e._detachFromContainer(this.annotations),this.stopListening(e),this.stopListening(this.annotations),this.context instanceof Context&&this.stopListening(this.context.editors);for(const e of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(e);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this.activeAnnotation=null,this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_integrateWithEditorAnnotations(e){if(!e.plugins.has("EditorAnnotations"))return;const t=e.plugins.get("EditorAnnotations"),n=()=>{const e=t.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this.setActiveAnnotation(e[0]||null)};this.listenTo(t,"refresh",n),this.listenTo(t,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&this.setActiveAnnotation(null)})),this.listenTo(t,"uiUpdate",(()=>{this._refreshPositioningDebounced()})),this.listenTo(this.annotations,"blur",(e=>{t.hasDomSelection()&&(n(),e.stop())}),{priority:"high"}),this._editorAnnotations.add(t)}_destroyEditorAnnotationsIntegration(e){this.stopListening(e),this._editorAnnotations.remove(e)}}class AnnotationCounterButtonView extends ButtonView{constructor(e){super(e);const t=this.bindTemplate;this.set("isDirty",!1),this.set("number",0),this.bind("_badge").to(this,"isDirty",this,"number",((e,t)=>e?"...":t.toString())),this.set("annotationType",""),this.icon=commentIcon,this.extendTemplate({attributes:{class:["ck-annotation-counter"]}}),this.counterView=new View,this.counterView.setTemplate({tag:"span",attributes:{class:["ck-annotation-counter__badge",t.to("annotationType",(e=>"ck-annotation-counter__badge--"+e)),t.if("isDirty","ck-annotation-counter__badge--edit-mode")]},children:[{text:t.to("_badge")}]}),this.children.add(this.counterView)}}class NarrowSidebar extends ContextPlugin{static get requires(){return[Sidebar,AnnotationsUIs]}static get pluginName(){return"NarrowSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.isAttached=!1,this._manuallyClosedAnnotationViews=new Set,this._domEmitter=Object.create(DomEmitterMixin),this._annotationToNarrowView=new Map,this.set("activeAnnotation",null),this.annotations=null,this._selectedAnnotations=[],this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce((()=>{this._refreshPositioning()}),250,{leading:!1})}init(){this.context.plugins.get(AnnotationsUIs).register("narrowSidebar",this),this.bodyCollection=new BodyCollection(this.context.locale),this.balloonPanelView=new BalloonPanelView(this.context.locale),this.bodyCollection.attachToDom(),this.bodyCollection.add(this.balloonPanelView)}attach(e){this.annotations=e;const t=this.context.plugins.get(Sidebar),n=this.balloonPanelView;if(t._annotations=e,this.isAttached)throw new CKEditorError("narrowsidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(t,"set:container",(()=>{this.detach(),this.listenTo(t,"change:container",(t=>{t.off(),this.attach(e)}))})),t._attachToContainer({viewClass:"ck-sidebar--narrow",spaceBetweenItems:5});const i=e=>{const i=new AnnotationCounterButtonView(this.context.locale);t.addAnnotation(e,i),this._annotationToNarrowView.set(e,i),i.bind("isDirty","annotationType","number").to(e.view,"isDirty","type","length"),i.on("execute",(()=>{this._manuallyClosedAnnotationViews.clear(),n.content.first!==e.view?(this._showBalloon(e),e.view.element.focus(),this.setActiveAnnotation(e)):this.setActiveAnnotation(null)}))};for(const t of e)i(t);this.listenTo(e,"add",((e,t)=>{i(t)})),this.listenTo(e,"remove",((n,i,r)=>{this._annotationToNarrowView.get(i).destroy(),this._annotationToNarrowView.delete(i),t.rearrange({removedAnnotation:i,previousAnnotation:e.get(r-1),nextAnnotation:e.get(r+1)}),i===this.activeAnnotation&&this.setActiveAnnotation(null)}),{priority:"low"}),this.listenTo(e,"focus",((e,t)=>{this.setActiveAnnotation(t)})),this.listenTo(e,"blur",(()=>{this.setActiveAnnotation(null)})),this._domEmitter.listenTo(document,"keydown",((e,t)=>{t.keyCode===keyCodes.esc&&n.isVisible&&(this._manuallyClosedAnnotationViews.add(n.content.first),this._hideBalloon(),t.stopPropagation(),t.preventDefault())})),this._domEmitter.listenTo(document,"mousedown",((e,i)=>{const r=i.target;n.isVisible&&n.element.contains(r)||t.view.element.contains(r)||e.preventClosingBalloon||this.activeAnnotation&&this.activeAnnotation.focusableElements.find((e=>e.contains(r)))||(this._manuallyClosedAnnotationViews.clear(),this._hideBalloon(),this.setActiveAnnotation(null))}));const r=this.context instanceof Context?this.context.editors:new Collection([this.context]);for(const e of r)this._integrateWithEditorAnnotations(e);this.listenTo(r,"add",((e,t)=>{this.listenTo(t,"ready",(()=>{this._integrateWithEditorAnnotations(t)}))})),this.listenTo(r,"remove",((e,t)=>{t.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(t.plugins.get("EditorAnnotations"))})),window.addEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioning()}setActiveAnnotation(e){if(e===this.activeAnnotation)return;const t=this.context.plugins.get(Sidebar);t.refresh({blurredAnnotation:this.activeAnnotation,activatedAnnotation:e,disableAnimationOnActivatedAnnotation:!0}),e&&t.getSidebarItemView(e)?this._showBalloon(e):this._hideBalloon(),this.activeAnnotation=e}detach(){if(!this.isAttached)throw new CKEditorError("narrowsidebar-detach-not-attached",this);this.setActiveAnnotation(null);const e=this.context.plugins.get(Sidebar);this._hideBalloon(),Array.from(this._annotationToNarrowView.values(),(e=>e.destroy())),this._annotationToNarrowView.clear(),e._detachFromContainer(this.annotations),this.stopListening(),this._domEmitter.stopListening(),this.context instanceof Context&&this.stopListening(this.context.editors);for(const e of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(e);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this._selectedAnnotations=[],this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach(),this.bodyCollection.detachFromDom()}_integrateWithEditorAnnotations(e){if(!e.plugins.has("EditorAnnotations"))return;const t=e.plugins.get("EditorAnnotations"),n=this.context.plugins.get(Sidebar),i=this.annotations,r=this.balloonPanelView,s=()=>{const e=t.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this._setSelectedAnnotations(e),this.setActiveAnnotation(e[0]||null)};this.listenTo(t,"refresh",s),this.listenTo(t,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))})),this.listenTo(t,"uiUpdate",(()=>{this._refreshPositioningDebounced()})),this.listenTo(i,"blur",(e=>{t.hasDomSelection()&&e.stop()}),{priority:"high"}),this.listenTo(this._domEmitter,"mousedown",((e,i)=>{const o=i.target;r.isVisible&&r.element.contains(o)||n.view.element.contains(o)||this.activeAnnotation&&t.hasDomSelection()&&(s(),e.preventClosingBalloon=!0)}),{priority:"high"}),this._editorAnnotations.add(t)}_destroyEditorAnnotationsIntegration(e){e&&(this.stopListening(e),this._editorAnnotations.remove(e))}_setSelectedAnnotations(e){for(const t of this._selectedAnnotations)e.includes(t)||this._manuallyClosedAnnotationViews.delete(t.view);this._selectedAnnotations=e}_refreshPositioning(){const e=this.balloonPanelView;this.annotations.refreshPositioning(),e.isVisible&&this._updateBalloonPosition()}_showBalloon(e){if(this._manuallyClosedAnnotationViews.has(e.view))return;const t=this.balloonPanelView.content.first;t!==e.view?(t&&this._detachListeners(t),this._attachListeners(e.view),this.balloonPanelView.content.clear(),this.balloonPanelView.content.add(e.view),this._updateBalloonPosition()):this._updateBalloonPosition()}_updateBalloonPosition(){const e=this.balloonPanelView.content.first,t=e&&this.annotations.getByView(e);if(!t||!this._annotationToNarrowView.has(t))return;const n=this._annotationToNarrowView.get(t).element,i=getBalloonPositions();this.balloonPanelView.pin({target:n,positions:i})}_hideBalloon(){const e=this.balloonPanelView,t=e.content.first;t&&(this._detachListeners(t),e.unpin(),e.content.clear())}_attachListeners(e){this.listenTo(e,"change:height",(()=>this._updateBalloonPosition())),this.listenTo(e,"Esc",((t,n)=>{this._manuallyClosedAnnotationViews.add(e),this._hideBalloon(),n()}))}_detachListeners(e){this.stopListening(e)}}function getBalloonPositions(){const e=BalloonPanelView.defaultPositions;return[e.southArrowNorthEast,e.northArrowSouthEast,e.southArrowNorth,e.northArrowSouth,e.southArrowNorthWest,e.northArrowSouthWest]}class InlineAnnotations extends Plugin{static get requires(){return[EditorAnnotations,ContextualBalloon,AnnotationsUIs]}static get pluginName(){return"InlineAnnotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),e.editing.view.addObserver(MouseObserver),this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._manuallyClosed=new Set,this._balloon=e.plugins.get(ContextualBalloon),this._addedAnnotations=new Set,this._selectedAnnotations=[],this._forceRefresh=!1}init(){const e=this.editor.plugins.get(AnnotationsUIs);e.context===this.editor&&(e.register("inline",this),this.editor.keystrokes.set("Esc",((e,t)=>{const n=this._balloon;if(this.isAttached&&n.visibleView){const e=this.annotations.getByView(n.visibleView);e&&this._closeAnnotation(e),t()}})))}afterInit(){const e=this.editor.plugins.get(AnnotationsUIs);e.context===this.editor&&(e.hasActive()||e.switchTo("inline"))}setActiveAnnotation(e){e!==this.activeAnnotation&&(this.activeAnnotation&&(this.activeAnnotation.isActive=!1),e&&this.editor.ui.focusTracker.isFocused&&(this.annotations.has(e)&&this._addAnnotationToBalloon(e,!0),e.isActive=!0),e||this._setSelectedAnnotations([]),this.activeAnnotation=e)}attach(e){this.annotations=e;const t=this.editor.plugins.get(AnnotationsUIs),n=this._balloon;if(this.isAttached)throw new CKEditorError("inlineannotations-attach-already-attached",this);if(t.context!==this.editor)throw new CKEditorError("inlineannotations-not-allowed-with-context",this);const i=this.editor.plugins.get(EditorAnnotations);this.listenTo(i,"refresh",(()=>{const e=i.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});!this._forceRefresh&&arraysEqual(e,this._selectedAnnotations)||(this._forceRefresh=!1,this._setSelectedAnnotations(e),this.setActiveAnnotation(e[0]||null))})),this.listenTo(i,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))})),this.listenTo(this.editor.ui.focusTracker,"change:isFocused",((e,t,n)=>{n||this.setActiveAnnotation(null)})),this.listenTo(e,"remove",((e,t)=>{this._removeAnnotationFromBalloon(t),t===this.activeAnnotation&&this.setActiveAnnotation(null)})),this.listenTo(n,"change:visibleView",((t,i,r,s)=>{s&&this.stopListening(s);const o=e.getByView(r);r&&o&&(this.listenTo(r,"change:height",(()=>{n.updatePosition()})),this.listenTo(r,"Esc",(()=>{this._closeAnnotation(o),this.editor.editing.view.focus()})),this.activeAnnotation!==o&&this.setActiveAnnotation(o))})),this.listenTo(this.editor.ui,"update",(()=>{n.visibleView&&e.getByView(n.visibleView)&&n.updatePosition()})),this.listenTo(this.editor.editing.view.document,"mousedown",(()=>{this._forceRefresh=!0,this._manuallyClosed.clear()})),this.editor.editing.view.document.selection.editableElement&&this.editor.editing.view.focus(),this.isAttached=!0}detach(){if(!this.isAttached)throw new CKEditorError("inlineannotations-detach-not-attached",this);this.setActiveAnnotation(null);for(const e of this._addedAnnotations)this._removeAnnotationFromBalloon(e);this.stopListening(),this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_setSelectedAnnotations(e){for(const t of this._selectedAnnotations)e.includes(t)||this._manuallyClosed.delete(t);for(const t of this.annotations)e.includes(t)||this._removeAnnotationFromBalloon(t);if(this.editor.ui.focusTracker.isFocused)for(const t of e)this._addAnnotationToBalloon(t);this._selectedAnnotations=e}_addAnnotationToBalloon(e,t=!1){this._manuallyClosed.has(e)||(this._addedAnnotations.has(e)||this._balloon.hasView(e.view)||(this._addedAnnotations.add(e),this._balloon.add({stackId:e.view.id,view:e.view,position:{target:()=>this._getBalloonTargetForAnnotation(e)}})),t&&this._balloon.showStack(e.view.id))}_getBalloonTargetForAnnotation(e){const t=e.target,n=this.editor.editing.view,i=n.document.selection.getFirstRange(),r=n.domConverter.viewRangeToDom(i);if(r.collapse(!0),t){if(t instanceof Rect)return t;let e=[];for(const n of t)e.push(...cloneRects(n.getClientRects()));e=joinClientRects(e);const n=r.getBoundingClientRect();return e.find((e=>e.top<=n.top&&e.bottom>=n.bottom&&e.left<=n.left&&e.right>=n.right))||e[0]}return e.targetRect||r}_removeAnnotationFromBalloon(e){this._addedAnnotations.has(e)&&this._balloon.hasView(e.view)&&(this._addedAnnotations.delete(e),this._balloon.remove(e.view))}_closeAnnotation(e){this._manuallyClosed.add(e),this._removeAnnotationFromBalloon(e)}}function arraysEqual(e,t){return e.length===t.length&&e.every((e=>t.includes(e)))}function cloneRects(e){return Array.from(e).map(DOMRect.fromRect)}function joinClientRects(e){const t=[];let n=e[0];for(let i=1;i<e.length;i++)canJoinRects(n,e[i])?n.width+=e[i].width:(t.push(n),n=e[i]);return t.push(n),t}function canJoinRects(e,t){return e.top===t.top&&e.bottom===t.bottom&&e.right===t.left}var commentsArchiveIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M14 3.5A3.5 3.5 0 0 1 17.5 7v6l-.005.192a3.501 3.501 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.37-.193-.38-.212a13.452 13.452 0 0 1-3.272-2.63l-.062-.07-4.729-.046a3.5 3.5 0 0 1-3.5-3.5v-6a3.5 3.5 0 0 1 3.5-3.5L14 3.5ZM3.5 4.954a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2L8.924 15a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L12.962 15H14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2L3.5 4.954Z"/><path d="M16.5.5h-10a3.5 3.5 0 0 0-3.162 2h1.84A2 2 0 0 1 6.5 2h10a2 2 0 0 1 2 2v8.873a3.502 3.502 0 0 0 1.495-2.681L20 10V4A3.5 3.5 0 0 0 16.5.5Z"/><path clip-rule="evenodd" d="M12.013 7.453a.75.75 0 0 1 .034 1.06l-3.75 4a.75.75 0 0 1-1.045.048l-2.25-2a.75.75 0 0 1 .996-1.122l1.704 1.515 3.25-3.467a.75.75 0 0 1 1.061-.034Z"/></svg>\n';class CommentsArchiveView extends View{constructor(e,t){super(e),this.set("isEmpty",!t.length),this.focusTracker=new FocusTracker,this._annotationViews=t,this._annotationViews.delegate("arrowup","arrowdown").to(this),this.on("arrowup",(()=>{this.focusCycler.focusPrevious()})),this.on("arrowdown",(()=>{this.focusCycler.focusNext()})),this.focusCycler=new FocusCycler({focusables:t,focusTracker:this.focusTracker}),this.listenTo(t,"add",(()=>{this.isEmpty=!1})),this.listenTo(t,"remove",((e,n)=>{n.isActive&&this.focus(),t.length||(this.isEmpty=!0)}));const n=this.bindTemplate;this.setTemplate({tag:"div",attributes:{dir:"auto",class:["ck","ck-comments-archive"],tabindex:-1,role:"list","aria-label":getTranslation$d(e,"COMMENTS_ARCHIVE_LIST_LABEL")},children:[{tag:"div",attributes:{class:["ck-comments-archive__content"],role:"presentation"},children:[{tag:"div",attributes:{role:"presentation"},children:t},{tag:"p",attributes:{class:["ck-comments-archive__info",n.if("isEmpty","ck-hidden",(e=>!e))]},children:[{text:getTranslation$d(e,"EMPTY_COMMENTS_ARCHIVE")}]}]}]})}render(){super.render(),this._setupKeyboardNavigation()}destroy(){super.destroy(),this.focusTracker.destroy()}focus(){this.focusCycler.first?this.focusCycler.focusFirst():this.element.focus()}_setupKeyboardNavigation(){for(const e of this._annotationViews)this.focusTracker.add(e.element);this._annotationViews.on("change",((e,{added:t,removed:n})=>{for(const e of t)this.focusTracker.add(e.element);for(const e of n)this.focusTracker.remove(e.element)}))}}class CommentsArchive extends ContextPlugin{static get pluginName(){return"CommentsArchive"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsRepository,Annotations]}constructor(e){super(e),this.archivedThreads=new Collection}init(){const e=this.context,t=e.plugins.get(CommentsRepository),n=e.plugins.get(Annotations);this.listenTo(t,"addCommentThread",((e,{threadId:n})=>{const i=t.getCommentThread(n);i.archivedAt&&this.archivedThreads.add(i,this._calculatePosition(i.archivedAt)),this.listenTo(i,"change:archivedAt",((e,t,n)=>{n?this.archivedThreads.has(i)||this.archivedThreads.add(i,this._calculatePosition(i.archivedAt)):this.archivedThreads.has(i)&&this.archivedThreads.remove(i)}))})),this.listenTo(t,"removeCommentThread",((e,{threadId:n})=>{const i=t.getCommentThread(n);this.stopListening(i),this.archivedThreads.has(i)&&this.archivedThreads.remove(i)}),{priority:"highest"}),this.listenTo(n.collection,"focus",((e,t)=>{t.isVisible||(t.isActive=!0,n.activate(t))}))}_calculatePosition(e){const t=[...this.archivedThreads].findIndex((t=>t.archivedAt<e));return t>-1?t:this.archivedThreads.length}}class CommentsArchiveUI extends Plugin{static get pluginName(){return"CommentsArchiveUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsArchive,Dialog]}constructor(e){super(e),this._hideDialogOnAnnotationEscape=e=>{const t=e.source;if(!this.annotationViews.has(t.view))return;const n=this.editor.plugins.get("Dialog");n.isOpen&&"commentsArchive"===n.id&&(n.hide(),e.stop())},this.annotationViews=new ViewCollection,this._pendingThreads=[]}init(){const e=this.editor,t=this._hideDialogOnAnnotationEscape.bind(this);e.ui.componentFactory.add("commentsArchive",(()=>this._createCommentsArchiveButton(ButtonView,!0))),e.ui.componentFactory.add("menuBar:commentsArchive",(()=>{const e=this._createCommentsArchiveButton(MenuBarMenuListItemButtonView);return e.set({role:"menuitemcheckbox"}),e}));const n=e.plugins.get(CommentsArchive),i=e.plugins.get("Annotations"),r=e.plugins.get("CommentsRepository");this.listenTo(n.archivedThreads,"add",((t,n)=>{const s=e.config.get("collaboration.channelId");if(!s||n.channelId===s){const e=r._threadToController.get(n);if(!e)return void this._pendingThreads.push(n);const t=this._calculatePosition(n.archivedAt),s=i.getByInnerView(e.view);s.isVisible&&i._visibleAnnotations.remove(s),this.annotationViews.add(s.view,t)}})),this.listenTo(i.collection,"add",((e,t)=>{const n=this._pendingThreads.find((e=>{const n=r._threadToController.get(e);return n&&t.innerView===n.view}));if(n){const e=this._calculatePosition(n.archivedAt);this.annotationViews.add(t.view,e),this._pendingThreads.splice(this._pendingThreads.indexOf(n),1)}})),this.listenTo(n.archivedThreads,"remove",((t,n)=>{const s=e.config.get("collaboration.channelId");if(!s||n.channelId===s){const e=r._threadToController.get(n),t=i.getByInnerView(e.view);this.annotationViews.remove(t.view),this.stopListening(t.focusableElements)}})),this.listenTo(i.collection,"add",((e,n)=>{this.listenTo(n,"escape",t)})),this.listenTo(i.collection,"remove",((e,n)=>{this.stopListening(n,"escape",t)}))}_calculatePosition(e){const t=this.editor.config.get("collaboration.channelId"),n=[...this.editor.plugins.get(CommentsArchive).archivedThreads].filter((e=>e.channelId===t)).findIndex((t=>t.archivedAt<e));return n<0||n>this.annotationViews.length?this.annotationViews.length:n-1}_toggleDialog(){const e=this.editor,t=e.plugins.get("Dialog");this.commentsArchiveView||(this.commentsArchiveView=new CommentsArchiveView(e.locale,this.annotationViews)),"commentsArchive"===t.id?t.hide():t.show({id:"commentsArchive",title:getTranslation$d(e.locale,"COMMENTS_ARCHIVE"),icon:commentsArchiveIcon,hasCloseButton:!0,content:this.commentsArchiveView,position:DialogViewPosition.EDITOR_TOP_SIDE})}_createCommentsArchiveButton(e,t=!1){const n=this.editor.locale,i=this.editor.plugins.get("Dialog"),r=new e(n);return r.bind("isEnabled").to(this,"isEnabled"),r.bind("isOn").to(i,"id",(e=>"commentsArchive"===e)),r.set({label:getTranslation$d(n,"COMMENTS_ARCHIVE"),icon:commentsArchiveIcon,isToggleable:!0}),t&&(r.tooltip=!0),this.listenTo(r,"execute",(()=>this._toggleDialog())),r}}class Comments extends Plugin{static get requires(){return[CommentsRepository,CommentsEditing,CommentsUI,CommentsArchive,CommentsArchiveUI,CommentsOnly,WideSidebar,NarrowSidebar,InlineAnnotations]}static get pluginName(){return"Comments"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}function getElementText(e){let t="";for(const n of e.getChildren())n instanceof Text&&(t+=n.data);return t}function getDefaultFeatureHeadingNames(e){const t=e.config.get("heading.options");return t?t.reduce(((e,t)=>("paragraph"!==t.model&&e.push(t.model),e)),[]):e.plugins.has("GeneralHtmlSupport")?["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"]:[]}class DocumentOutlineUtils extends Plugin{constructor(){super(...arguments),this._headingNames=[]}static get pluginName(){return"DocumentOutlineUtils"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;this._headingNames=this._getHeadingNames();let t=[];e.model.document.on("change",debounce((()=>{const e=t;t=this._getOutlineDefinitions();const n=diff(e,t,((e,t)=>e.level===t.level&&e.text===t.text&&e.modelElement===t.modelElement)),i=diffToChanges(n,t),r=this._getActiveHeading(),s=t.findIndex((e=>e.modelElement===r));i.length&&this.fire("change",{outlineDefinitions:t,activeItemIndex:s,outlineChanges:i}),this.fire("activeItemIndex",{index:s})}),250,{leading:!0,trailing:!0}))}afterInit(){this._headingNames.length||this._deriveHeadingElementsFromConversion()}_getOutlineDefinitions(){const e=this.editor,t=[],n=this._headingNames;for(const t of e.model.document.getRootNames())i(e.model.document.getRoot(t));function i(e){for(const r of e.getChildren())r.is("element")&&(n.includes(r.name)&&t.push({level:n.indexOf(r.name)+1,text:getElementText(r),modelElement:r}),i(r))}return t}_getActiveHeading(){const e=this.editor.model.document.selection.getFirstPosition(),t=new TreeWalker({direction:"backward",startPosition:e});for(const e of t)if(e.item.is("element")&&this._headingNames.includes(e.item.name))return e.item}_getHeadingNames(){return this.editor.config.get("documentOutline.headings")||getDefaultFeatureHeadingNames(this.editor)}_deriveHeadingElementsFromConversion(){const e=this.editor,t=["h1","h2","h3","h4","h5","h6"],n=[];for(const i of t){const t=e.editing.view.domConverter.domToView(document.createElement(i)),r=e.data.toModel(t).getChild(0);(null==r?void 0:r.is("element"))&&n.push(r.name)}this._headingNames=n}}function getTranslation$c(e,t){const n=e.t;switch(t){case"Empty heading":return n("Empty heading");case"Editor headings will appear here as you type.":return n("Editor headings will appear here as you type.");case"No headings were found in the document.":return n("No headings were found in the document.");case"Table of contents":return n("Table of contents");default:return t}}class DocumentOutlineItemView extends View{constructor(e,t=!1){super(e);const n=this.bindTemplate,i=t?"["+getTranslation$c(e,"Empty heading")+"]":"";this.set("text",""),this.set("level",1),this.set("isActive",!1),this.bind("isEmpty").to(this,"text",(e=>!e)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline__item",n.to("level",(e=>"ck-document-outline__item_level-"+e)),n.if("isActive","ck-document-outline__item_active"),n.if("isEmpty","ck-document-outline__item_empty")],title:n.to("text")},children:[{text:n.to("text",(e=>e||i))}],on:{click:n.to("click")}})}}class DocumentOutlineView extends View{constructor(e,t=!1,n){super(e),this.showEmptyHeadingText=t,this.set("activeItemIndex",-1),this._documentOutlineContainer=n,this.items=this.createCollection(),this.items.delegate("click").to(this),this.on("click",this._handleItemClick.bind(this)),this.on("change:activeItemIndex",((e,t,n,i)=>{this._setActiveItem(i,n)})),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline"],dir:e.contentLanguageDirection,"data-document-outline-empty-placeholder":getTranslation$c(e,"Editor headings will appear here as you type."),tabindex:-1},children:this.items})}sync(e){e.forEach((e=>{"insert"==e.type?this._insertItem(e.index,...e.values):"delete"==e.type&&this._deleteItem(e.index,e.howMany)}))}_setActiveItem(e,t){if(-1!==e){const t=this.items.get(e);t&&(t.isActive=!1)}-1!==t&&(this.items.get(t).isActive=!0,this._scrollToItem(t))}_insertItem(e,...t){const n=t.map(((t,n)=>{const i=new DocumentOutlineItemView(this.locale,this.showEmptyHeadingText);return i.text=t.text,i.level=t.level,e+n===this.activeItemIndex&&(i.isActive=!0),i}));this.items.addMany(n,e)}_deleteItem(e,t){do{this.items.remove(e)}while(--t)}_handleItemClick(e){const t=this.items.getIndex(e.source);this.fire("itemSelected",t)}_scrollToItem(e){scrollAncestorsToShowTarget(this.items.get(e).element,20,this._documentOutlineContainer)}destroy(){super.destroy(),this.element.remove()}}class DocumentOutlineUI extends Plugin{static get pluginName(){return"DocumentOutlineUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.view=new DocumentOutlineView(e.locale,this.editor.config.get("documentOutline.showEmptyHeadings"),this.editor.config.get("documentOutline.container")),this._currentOutlineDefinitions=[],this._updateActiveDefinitionFromViewportThrottled=throttle(this._updateActiveDefinitionOnViewportChange.bind(this),100)}init(){const e=this.editor,t=e.plugins.get("DocumentOutlineUtils");let n=!1;if(this.view.render(),this.editor.ui.focusTracker.add(this.view.element),!e.config.get("documentOutline.container"))throw new CKEditorError("document-outline-container-not-provided",{editor:e});e.config.get("documentOutline.container").appendChild(this.view.element),t.on("change",this._handleOutlineChange.bind(this)),t.on("activeItemIndex",((e,{index:t})=>this._setActiveViewItem(t))),this.view.on("itemSelected",((e,t)=>{n=!0,this._handleItemSelected(t)})),this.view.listenTo(_0x56a4f4.document,"scroll",(()=>{n?n=!1:this._updateActiveDefinitionFromViewportThrottled()}),{useCapture:!0}),this.view.listenTo(_0x56a4f4.window,"resize",this._updateActiveDefinitionFromViewportThrottled,{useCapture:!0})}afterInit(){checkLicense$a(this)}destroy(){super.destroy(),this.view.destroy(),this._updateActiveDefinitionFromViewportThrottled.cancel()}_handleOutlineChange(e,{outlineDefinitions:t,outlineChanges:n}){this._currentOutlineDefinitions=t,this.view.sync(n)}_setActiveViewItem(e){this._currentOutlineDefinitions.length&&this._currentOutlineDefinitions[e]&&(this.view.activeItemIndex=e)}_handleItemSelected(e){const t=this._currentOutlineDefinitions[e].modelElement;this.editor.model.change((e=>{e.setSelection(t,0)})),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0}),this.editor.editing.view.focus(),this._setActiveViewItem(e)}_updateActiveDefinitionOnViewportChange(){const e=this.editor;let t;for(const n of e.model.document.getRootNames()){const i=e.editing.view.getDomRoot(n),r=i&&new Rect(i).getVisible();if(r){const e=new Rect(_0x56a4f4.window).getIntersection(r);e&&(t=e.top+.25*e.height)}}if(void 0===t)return;const n=binaryActiveDefinitionSearch(e.editing,this._currentOutlineDefinitions,t);n?this._setActiveViewItem(this._currentOutlineDefinitions.indexOf(n)):this._setActiveViewItem(-1)}}function binaryActiveDefinitionSearch(e,t,n,i=0,r=t.length-1){const s=Math.floor(i+(r-i)/2);if(r>=i){const o=t[s],a=e.mapper.toViewElement(o.modelElement);if(!a)return null;const c=e.view.domConverter.mapViewToDom(a);return new Rect(c).bottom>n?binaryActiveDefinitionSearch(e,t,n,i,s-1):binaryActiveDefinitionSearch(e,t,n,s+1,r)}return s<0?null:t[s]}async function checkLicense$a(e){const t=g([50,48,122,72,68,86,77,53,102,89,121,67,113,75,69,101,90,52,88,105,55,104,100,82,79,85,83,108,84,120,115,87,54,66,114,118,56,107,70,109,81,111,73,97,76,110,103,65,74,78,49,71,99,80,98,119,112,106,117,116,51,57]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU0ODg1MTZ9.eyJqdGkiOjkyODkzNDM5NTYsImFsZyI6IkVTMjU2IiwiaWR4IjozMTkyNDY2NTY0MjIyLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiJjNDEyYjk4MS00YzEzLTQyMWQtYTI3ZC1mOTcwNDA4ZDYyYTIiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NDg4NTE2LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTQ4OH0._u1Gc0FmepwJ-v-Tlaarn3NIlmpYVuuoywLHqNkw9hib80aM-KWjzraQZ74jf1uK-HeaLhQrs7yZq-a8meFJ0Q"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([122]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([68,79]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class DocumentOutline extends Plugin{static get requires(){return[DocumentOutlineUtils,DocumentOutlineUI]}static get pluginName(){return"DocumentOutline"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("documentOutlineLicenseKeyValid"==r||"documentOutlineLicenseKeyInvalid"==r||"documentOutlineLicenseKeyExpired"==r||"documentOutlineLicenseKeyDomainLimit"==r||"documentOutlineLicenseKeyNotAllowed"==r||"documentOutlineLicenseKeyEvaluationLimit"==r||"documentOutlineLicenseKeyTrialLimit"==r||"documentOutlineLicenseKeyDevelopmentLimit"==r||"documentOutlineLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"documentOutlineLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"documentOutlineLicenseKeyExpired"==t&&e._showLicenseError("expired"),"documentOutlineLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"documentOutlineLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","DocumentOutline"),"documentOutlineLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"documentOutlineLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"documentOutlineLicenseKeyDevelopmentLimit"==t&&e._showLicenseError("developmentLimit"),"documentOutlineLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TableOfContentsCommand extends _0x354f99{execute(){this.editor.model.change((e=>{this.editor.model.insertObject(e.createElement("tableOfContents"))}))}refresh(){const e=this.editor.model,t=e.document.selection.getFirstPosition();this.isEnabled=null!==(t&&e.schema.findAllowedParent(t,"tableOfContents"))}}class HeadingId extends Plugin{static get pluginName(){return"HeadingId"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){const e=this.editor;e.config.get("headingId.modelAttributeName")||(getDefaultHeadingMapNames(this.editor.config.get("heading.options")).forEach(((t,n)=>{this._customUpcastHeadingsConversion(n),this._customDataDowncastHeadingsConversion(t),e.model.schema.isRegistered(t)&&e.model.schema.extend(t,{allowAttributes:"headingId"})})),this._registerHeadingIdAttributePostfixer())}_customUpcastHeadingsConversion(e){this.editor.conversion.for("upcast").add((t=>t.on("element:"+e,((e,t,n)=>{const{consumable:i,writer:r}=n,s=t.viewItem.getAttribute("id"),o=t.modelRange.getContainedElement();if(o)return s&&s.length||o.hasAttribute("headingId")?void(i.consume(t.viewItem,{attributes:["id"]})&&r.setAttribute("headingId",s,o)):(i.consume(t.viewItem,{attributes:["id"]}),void r.setAttribute("headingId",uid(),o))}),{priority:priorities.get("low")+.5})))}_customDataDowncastHeadingsConversion(e){this.editor.conversion.for("downcast").add((t=>t.on("attribute:headingId:"+e,((e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const i=t.item.getAttribute("headingId"),r=n.mapper.toViewElement(t.item);n.writer.setAttribute("id",i,r)}))))}_registerHeadingIdAttributePostfixer(){const e=this.editor,t=new Set,n=new Set;function i(e,t){const i=uid();return n.add(i),e.setAttribute("headingId",i,t),i}e.model.document.registerPostFixer((r=>{const s=e.model.document.differ.getChanges();let o=!1;for(const e of s)if("insert"==e.type&&e.name)if(isHeading(e.name)){const s=e.attributes.get("headingId");"string"==typeof s?t.has(s)?(i(r,e.position.nodeAfter),o=!0):n.add(s):(i(r,e.position.nodeAfter),o=!0)}else"string"==typeof e.attributes.get("headingId")&&(a=r,c=e.position.nodeAfter,a.removeAttribute("headingId",c),o=!0);else if("remove"==e.type){const n=e.attributes.get("headingId");"string"==typeof n&&t.delete(n)}var a,c;return o})),e.model.document.on("change",(()=>{n.forEach((e=>t.add(e))),n.clear()}))}}function isHeading(e){return!!e.match(/heading\d/)}function getDefaultHeadingMapNames(e){const t=new Map;return e?(e.forEach((e=>{"paragraph"!==e.model&&t.set(e.view,e.model)})),t.get("h1")||t.set("h1","heading1"),t):t}class TableOfContentsEditing extends Plugin{static get pluginName(){return"TableOfContentsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Widget,DocumentOutlineUtils,HeadingId]}constructor(e){super(e),this._currentOutlineDefinitions=[],this._tableOfContentsElements=new Set,this._headingIdModelAttributeName="headingId"}init(){const e=this.editor,t=e.editing.view.document;e.config.get("headingId.modelAttributeName")&&(this._headingIdModelAttributeName=e.config.get("headingId.modelAttributeName")),this.listenTo(t,"click",((e,t)=>{if(!t.target)return;const n=t.target.getCustomProperty("tableOfContentsHeadingIndex");Number.isInteger(n)&&(t.domEvent.preventDefault(),e.stop(),this._handleScrollToHeading(n))}),{priority:"high",context:"$capture"}),this._defineSchema(),this._defineConverters(),e.commands.add("insertTableOfContents",new TableOfContentsCommand(e)),e.plugins.get("DocumentOutlineUtils").on("change",((e,t)=>{this._currentOutlineDefinitions=t.outlineDefinitions,this._updateTableOfContentsElements()})),this.listenTo(e.model.document,"change",(()=>{this._trackNewToCElements()}))}afterInit(){checkLicense$9(this)}_updateTableOfContentsElements(){this._tableOfContentsElements.forEach((e=>{"$graveyard"!==e.rootName&&this.editor.editing.reconvertItem(e)}))}_trackNewToCElements(){for(const e of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if("insert"!==e.type||"tableOfContents"!==e.name)return;this._tableOfContentsElements.add(e.position.nodeAfter)}}_defineSchema(){this.editor.model.schema.register("tableOfContents",{inheritAllFrom:"$blockObject"})}_defineConverters(){const e=this.editor.conversion;e.for("upcast").elementToElement({model:"tableOfContents",view:{name:"div",classes:"table-of-contents"}}),e.for("dataDowncast").elementToStructure({model:"tableOfContents",view:(e,{writer:t})=>this._createTableOfContents(t,!0)}),e.for("editingDowncast").elementToStructure({model:"tableOfContents",view:(e,{writer:t})=>{this._tableOfContentsElements.add(e);const n=this._createTableOfContents(t);return toWidget(n,t,{label:getTranslation$c(this.editor.locale,"Table of contents")})}}),this.editor.data.registerRawContentMatcher({name:"div",classes:"table-of-contents"}),this.editor.editing.mapper.on("viewToModelPosition",this._redirectMapper(),{priority:"high"})}_createTableOfContents(e,t=!1){const{locale:n}=this.editor,i=e.createContainerElement("div",{class:"table-of-contents"+(0===this._currentOutlineDefinitions.length?" table-of-contents_empty":""),...!t&&{"data-table-of-contents-label":getTranslation$c(n,"Table of contents")}});0===this._currentOutlineDefinitions.length&&!1===t&&e.insert(e.createPositionAt(i,"end"),e.createContainerElement("p",{class:"table-of-contents__placeholder"},[e.createText(getTranslation$c(n,"No headings were found in the document."))]));const r=t?"":"["+getTranslation$c(n,"Empty heading")+"]";let s=i;return this._currentOutlineDefinitions.forEach(((n,i,o)=>{const a=this.editor.model.hasContent(n.modelElement,{ignoreWhitespaces:!0}),c=a?n.text:r,l=n.modelElement.getAttribute(this._headingIdModelAttributeName),d=e.createContainerElement("a",{href:"#"+l,...!t&&{tabindex:"-1"}},[e.createText(c)]),u=this.editor.config.get("documentOutline.showEmptyHeadings");e.setCustomProperty("tableOfContentsHeadingIndex",i,d);const h=e.createContainerElement("li",null,[a||!t&&u?d:e.createText("")]),m=i?o[i-1].level:0,g=Math.abs(n.level-m);if(n.level>m){const t=wrapInList(h,g,e);e.insert(e.createPositionAt(s,"end"),t)}else{const t=getOuterListByLevelDifference(s,g);e.insert(e.createPositionAt(t,"end"),h)}s=h})),i}_handleScrollToHeading(e){const t=this._currentOutlineDefinitions[e].modelElement;this.editor.model.change((e=>{e.setSelection(t,0)})),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0})}_redirectMapper(){return(e,t)=>{const n=t.mapper,i=n.findMappedViewAncestor(t.viewPosition),r=n.toModelElement(i);r.is("element","tableOfContents")&&(t.modelPosition=this.editor.model.createPositionAt(r,0),e.stop())}}}function wrapInList(e,t,n){return 1===t?n.createContainerElement("ol",null,[e]):n.createContainerElement("ol",null,[n.createContainerElement("li",null,[wrapInList(e,t-1,n)])])}function getOuterListByLevelDifference(e,t){return e.getAncestors({includeSelf:!0,parentFirst:!0}).filter((e=>e.is("element","ol")))[t]}async function checkLicense$9(e){const t=g([106,49,68,81,67,53,56,54,122,103,48,57,113,50,112,52,74,119,108,117,100,121,69,90,102,80,120,85,82,87,97,66,65,116,55,71,73,77,86,83,72,51,99,107,118,88,105,101,75,114,84,115,70,89,104,78,109,110,111,76,98,79]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU1MDk3Mzh9.eyJqdGkiOjcwODI0NzM1NDcsImFsZyI6IkVTMjU2IiwiaWR4IjoyODA1NDU5MjM0NDg1LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiIyOWFhOTU0MC0wZjU0LTQyODUtODJiNC1kYjI5Yzg5OTFhMjAiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NTA5NzM4LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTUwOX0.F6Qf_c0Lo4xEc-7GCg1P_lwhtCayiZ_2lTf_msTB79rY70-aK35MEBC1_XTpO2jmqnIVmA81nxtvkyq8F0E8OQ"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([106]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([84,79,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class TableOfContentsUI extends Plugin{static get pluginName(){return"TableOfContentsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("tableOfContents",(()=>{const e=this._createButton(ButtonView);return e.tooltip=!0,e})),e.ui.componentFactory.add("menuBar:tableOfContents",(()=>this._createButton(MenuBarMenuListItemButtonView))),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("tableOfContentsLicenseKeyValid"==r||"tableOfContentsLicenseKeyInvalid"==r||"tableOfContentsLicenseKeyExpired"==r||"tableOfContentsLicenseKeyDomainLimit"==r||"tableOfContentsLicenseKeyNotAllowed"==r||"tableOfContentsLicenseKeyEvaluationLimit"==r||"tableOfContentsLicenseKeyTrialLimit"==r||"tableOfContentsLicenseKeyDevelopmentLimit"==r||"tableOfContentsLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"tableOfContentsLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"tableOfContentsLicenseKeyExpired"==e&&t._showLicenseError("expired"),"tableOfContentsLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"tableOfContentsLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","TableOfContents"),"tableOfContentsLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"tableOfContentsLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"tableOfContentsLicenseKeyDevelopmentLimit"==e&&t._showLicenseError("developmentLimit"),"tableOfContentsLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}_createButton(e){const t=this.editor,n=t.locale,i=t.commands.get("insertTableOfContents"),r=new e(n);return r.set({label:getTranslation$c(n,"Table of contents"),icon:icons.tableOfContents}),r.bind("isEnabled").to(i,"isEnabled"),this.listenTo(r,"execute",(()=>{t.execute("insertTableOfContents"),t.editing.view.focus()})),r}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TableOfContents extends Plugin{static get requires(){return[TableOfContentsEditing,TableOfContentsUI]}static get pluginName(){return"TableOfContents"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}function getStyles$1(e){if(!e)return new Promise((e=>e("")));const t=[];for(const n of e)"EDITOR_STYLES"!==n?t.push(window.fetch(n).then((e=>e.text()))):t.push(getEditorStyles$1());return Promise.all(t).then((e=>e.join(" ").trim()))}function getEditorStyles$1(){const e=[],t=[];for(const n of Array.from(document.styleSheets))if(n.ownerNode.hasAttribute("data-cke"))for(const i of Array.from(n.cssRules))-1!==i.cssText.indexOf(".ck-content")?e.push(i.cssText):-1!==i.cssText.indexOf(":root")&&t.push(i.cssText);return e.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config  style-loader should use data-cke=true attribute for the editor stylesheet."),[...t,...e].join(" ").trim()}function getTranslation$b(e,t){const n=e.t;switch(t){case"Export to PDF":return n("Export to PDF");case"An error occurred while generating the PDF.":return n("An error occurred while generating the PDF.");case"PDF export started":return n("PDF export started");case"PDF export failed":return n("PDF export failed");case"PDF export successful":return n("PDF export successful");case"Exporting PDF document":return n("Exporting PDF document");default:return t}}const PRODUCTION_URL$1=window.location.origin+"/api/convert/pdf";class ExportPdfCommand extends _0x354f99{constructor(e){super(e),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(e={}){const t=this.editor,n=e.converterUrl||PRODUCTION_URL$1,i=e.dataCallback||(e=>e.data.get()),r=t.plugins.get("ExportPdf"),s=e.token||r._token;return this.isBusy=!0,this.refresh(),getStyles$1(e.stylesheets||["EDITOR_STYLES"]).then((async r=>{if(t.ui.ariaLiveAnnouncer.announce(getTranslation$b(t.locale,"PDF export started")),t.plugins.has("MergeFields")){e.converterOptions||(e.converterOptions={});const n=t.plugins.get("MergeFieldsEditing"),i=n.previewMode,{prefix:r,suffix:s}=t.config.get("mergeFields"),o={prefix:r,suffix:s,data:{}};if("$labels"===i)for(const e of n.getMergeFieldsIds())o.data[e]=r+n.getLabel(e)+s;else{const e="$defaultValues"===i?n.getDefaultValues():n.getDataSetValues(i,!0);for(const t of Object.entries(e)){const[e,i]=t;o.data[e]=null!==i?i:n.getLabel(e)}}e.converterOptions.merge_fields=o}const o={html:'<html>\n\t\t\t\t\t\t<head>\n\t\t\t\t\t\t\t<title>CKEditor 5 PDF document</title>\n\t\t\t\t\t\t\t<meta charset="utf-8">\n\t\t\t\t\t\t</head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">\n\t\t\t\t\t\t\t\t'+await i(t)+"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>",css:r,options:e.converterOptions},a={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf",...s?{Authorization:s.value}:null,"x-cs-app-id":e.appID||"cke5"},body:JSON.stringify(o)};return window.fetch(n,a).then((e=>{if(200!==e.status)throw e;return e.blob()})).then((n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$b(t.locale,"PDF export successful"));const i="function"==typeof e.fileName?e.fileName():e.fileName;this._downloadFile(n,i||"document.pdf")}))})).catch((e=>{const n=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(getTranslation$b(t.locale,"PDF export failed"),{politeness:"assertive"}),n.showWarning(getTranslation$b(t.locale,"An error occurred while generating the PDF.")),e})).finally((()=>{this.isBusy=!1,this.refresh()}))}_downloadFile(e,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.click(),n.remove()}}var exportPdfIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v6.5h1.5v-5h8v5h5V11H19V4.5ZM14 2l3.3 3H14V2Z"/><path d="m12.452 18.5 1.25 1.5H3v-3h1.5v1.5h7.952Z"/><path d="M19.826 16.843a.75.75 0 1 0-1.152-.96L17.5 17.29V13H16v4.29l-1.174-1.408a.75.75 0 1 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="M1.63 14.24V12.3h.88c.66 0 1.14-.15 1.46-.45.32-.3.48-.71.48-1.24 0-.52-.15-.91-.44-1.2C3.7 9.15 3.28 9 2.69 9H0v5.24h1.63Zm.4-3h-.4v-1.17h.46c.3 0 .5.05.62.17.1.11.16.25.16.42 0 .16-.06.3-.19.41-.13.11-.34.16-.66.16l.01.01Zm5.7 3c.28 0 .6-.05.96-.14.26-.07.5-.21.73-.42.22-.2.4-.47.53-.77.12-.31.19-.75.19-1.3 0-.37-.04-.7-.13-1.02a2.3 2.3 0 0 0-.42-.84c-.19-.24-.43-.43-.72-.56C8.57 9.06 8.2 9 7.72 9h-2.4v5.24H7.73Zm-.4-1.19h-.4v-2.86h.4c.43 0 .73.1.91.3.18.2.27.59.27 1.14 0 .42-.04.73-.12.91a.76.76 0 0 1-.34.4c-.14.07-.38.11-.72.11Zm5.3 1.2V12.1h2.02v-1.06h-2.03v-.91H15V9h-4v5.24h1.62l.01.01Z"/></svg>\n';class ExportPdfUI extends Plugin{static get pluginName(){return"ExportPdfUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("exportPdf",(()=>{const t=this._createButton(ButtonView),n=e.commands.get("exportPdf");return t.set({tooltip:!0}),t.bind("isOn").to(n,"isBusy"),t})),e.ui.componentFactory.add("menuBar:exportPdf",(()=>this._createButton(MenuBarMenuListItemButtonView)))}_createButton(e){const t=this.editor,n=t.config.get("exportPdf")||{},i=t.commands.get("exportPdf"),r=new e(t.locale),s=new SpinnerView;return r.children.add(s),s.bind("isVisible").to(i,"isBusy"),r.iconView.bind("isVisible").to(i,"isBusy",(e=>!e)),r.set({icon:exportPdfIcon}),r.bind("isEnabled").to(i,"isEnabled"),r.bind("label").to(i,"isBusy",(e=>getTranslation$b(t.locale,e?"Exporting PDF document":"Export to PDF"))),this.listenTo(r,"execute",(()=>{t.execute("exportPdf",n),t.editing.view.focus()})),r}}class ExportPdf extends Plugin{static get pluginName(){return"ExportPdf"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["CloudServices",Notification,ExportPdfUI]}init(){const e=this.editor,t=e.config.get("exportPdf")||{};e.commands.add("exportPdf",new ExportPdfCommand(e));const n=e.plugins.get("CloudServices");!1===t.tokenUrl?this._token=null:t.tokenUrl?n.registerTokenUrl(t.tokenUrl).then((e=>{this._token=e})):this._token=n.token}}function getStyles(e){if(!e)return new Promise((e=>e("")));const t=[];for(const n of e)"EDITOR_STYLES"!==n?t.push(window.fetch(n).then((e=>e.text()))):t.push(getEditorStyles());return Promise.all(t).then((e=>e.join(" ").trim()))}function getEditorStyles(){const e=[],t=[];for(const n of Array.from(document.styleSheets))if(n.ownerNode.hasAttribute("data-cke"))for(const i of Array.from(n.cssRules))-1!==i.cssText.indexOf(".ck-content")?e.push(i.cssText):-1!==i.cssText.indexOf(":root")&&t.push(i.cssText);return e.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config  style-loader should use data-cke=true attribute for the editor stylesheet."),[...t,...e].join(" ").trim()}function getConverterOptions(e,t={}){const n=e.plugins.has("Users"),i=e.plugins.has("CommentsRepository"),r=e.plugins.has("TrackChanges"),s=t;if(n&&i){const t=getComments(e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));Object.keys(t).length&&(s.comments=t)}if(n&&r){const t=e.plugins.get("TrackChanges"),n=e.plugins.get("Users"),i=getSuggestions(t.getSuggestions({toJSON:!0}),n.users);Object.keys(i).length&&(s.suggestions=i)}return(s.suggestions||s.comments)&&(s.timezone=(new Intl.DateTimeFormat).resolvedOptions().timeZone),s}function getComments(e){const t={};if(!e.length)return t;for(const n of e)n.comments.map((e=>{void 0===t[n.id]&&(t[n.id]=[]),t[n.id].push({author:e.author.name,content:e.content,created:e.createdAt,is_resolved:n.isResolved})}));return t}function getSuggestions(e,t){const n={};if(!e.length||!t.length)return n;for(const{id:i,createdAt:r,authorId:s,attributes:o}of e){const e=o&&o["@external"],a=e?e.authorName:t.get(s).name;n[i]={author:a,created:r}}return n}function getConverterOptionsV2(e,t={}){const n=e.plugins.has("Users"),i=e.plugins.has("CommentsRepository"),r=e.plugins.has("TrackChanges"),s=e.plugins.has("MergeFields"),o=e.locale.contentLanguage,a=t,c={};if(a.document=a.document||{},a.document.language=a.document.language||o,n&&i){const t=getCommentsV2(e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));t.length&&(c.comment_threads=t)}if(n&&r){const t=e.plugins.get("TrackChanges"),n=e.plugins.get("Users"),i=getSuggestionsV2(t.getSuggestions({toJSON:!0}),n.users);i.length&&(c.suggestions=i)}if(s){const t=e.plugins.get("MergeFieldsEditing"),n=t.previewMode,{prefix:i,suffix:r}=e.config.get("mergeFields");if(a.merge_fields={prefix:i,suffix:r},"$labels"!==n){a.merge_fields.data={};const e="$defaultValues"===n?t.getDefaultValues():t.getDataSetValues(n,!0);for(const n of Object.entries(e)){const[e,i]=n;a.merge_fields.data[e]=null!==i?i:t.getLabel(e)}}}return(c.comment_threads||c.suggestions)&&(a.timezone=(new Intl.DateTimeFormat).resolvedOptions().timeZone,a.collaboration_features=c),a}function getCommentsV2(e){const t=[];if(!e.length)return t;for(const n of e){const e=n.comments.map((e=>({author:e.author.name,content:e.content,created_at:e.createdAt})));t.push({thread_id:n.id,is_resolved:n.isResolved,comments:e})}return t}function getSuggestionsV2(e,t){return e.length&&t.length?e.map((({id:e,createdAt:n,authorId:i,attributes:r})=>{const s=r&&r["@external"];return{id:e,author:s?s.authorName:t.get(i).name,created_at:n}})):[]}function getTranslation$a(e,t){const n=e.t;switch(t){case"Export to Word":return n("Export to Word");case"An error occurred while generating the Word file.":return n("An error occurred while generating the Word file.");case"Word document export started":return n("Word document export started");case"Word document export failed":return n("Word document export failed");case"Word document export successful":return n("Word document export successful");case"Exporting Word document":return n("Exporting Word document");default:return t}}const PRODUCTION_URL="https://docx-converter.cke-cs.com/v1/convert",PRODUCTION_URL_V2=window.location.origin+"/api/convert/docx",firstVersionApiKeys=["orientation","margin_top","margin_right","margin_bottom","margin_left","format","header","footer","comments","suggestions"];class ExportWordCommand extends _0x354f99{constructor(e){super(e),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(e={}){const t=this.editor,n=e.version||2,i=1===n,r=e.converterUrl||(i?PRODUCTION_URL:PRODUCTION_URL_V2),s=e.converterOptions||{},o=t.plugins.get("ExportWord"),a=e.token||o._token,c=!0===s.auto_pagination,l=e.dataCallback||(e=>e.data.get({pagination:c}));return 2===n&&isV1ApiUsed(s)&&logWarning("export-word-v1-api-is-deprecated"),this.isBusy=!0,this.refresh(),getStyles(e.stylesheets||["EDITOR_STYLES"]).then((async n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$a(t.locale,"Word document export started"));const o=await l(t),c={html:'<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">'+o+"</div>",css:n,[i?"options":"config"]:{...s,...i?getConverterOptions(t,s):getConverterOptionsV2(t,s)}},d={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/docx",...a?{Authorization:a.value}:null},body:JSON.stringify(c)};return window.fetch(r,d).then((e=>{if(200!==e.status)throw e;return e.blob()})).then((n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$a(t.locale,"Word document export successful"));const i="function"==typeof e.fileName?e.fileName():e.fileName;this._downloadFile(n,i||"document.docx")}))})).catch((e=>{const n=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(getTranslation$a(t.locale,"Word document export failed"),{politeness:"assertive"}),n.showWarning(getTranslation$a(t.locale,"An error occurred while generating the Word file.")),e})).finally((()=>{this.isBusy=!1,this.refresh()}))}_downloadFile(e,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.click(),n.remove()}}function isV1ApiUsed(e){for(const t of firstVersionApiKeys)if(void 0!==e[t])return!0;return!1}var exportWordIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.826 16.843a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="m14 0 5 4.5v9.741a2.737 2.737 0 0 0-1.5-.617V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M3 17.5h6.746c.1.22.23.429.391.623l.731.877H3v-1.5Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.6.6 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001Z"/></svg>\n';class ExportWordUI extends Plugin{static get pluginName(){return"ExportWordUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("exportWord",(()=>{const t=e.commands.get("exportWord"),n=this._createButton(ButtonView);return n.set({tooltip:!0}),n.bind("isOn").to(t,"isBusy"),n})),e.ui.componentFactory.add("menuBar:exportWord",(()=>this._createButton(MenuBarMenuListItemButtonView)))}_createButton(e){const t=this.editor,n=t.config.get("exportWord")||{},i=t.commands.get("exportWord"),r=new e(t.locale),s=new SpinnerView;return r.children.add(s),s.bind("isVisible").to(i,"isBusy"),r.iconView.bind("isVisible").to(i,"isBusy",(e=>!e)),r.set({icon:exportWordIcon}),r.bind("isEnabled").to(i,"isEnabled"),r.bind("label").to(i,"isBusy",(e=>getTranslation$a(t.locale,e?"Exporting Word document":"Export to Word"))),this.listenTo(r,"execute",(()=>{t.execute("exportWord",n),t.editing.view.focus()})),r}}class ExportWord extends Plugin{static get pluginName(){return"ExportWord"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["CloudServices",Notification,ExportWordUI]}init(){const e=this.editor,t=e.config.get("exportWord")||{};e.commands.add("exportWord",new ExportWordCommand(e));const n=e.plugins.get("CloudServices");!1===t.tokenUrl?this._token=null:t.tokenUrl?n.registerTokenUrl(t.tokenUrl).then((e=>{this._token=e})):this._token=n.token}}const COPY_FORMAT_COMMAND_NAME="copyFormat",PASTE_FORMAT_COMMAND_NAME="pasteFormat",CURSOR_ACTIVE_CSS_CLASS="ck-format-painter-active";class CopyFormatCommand extends _0x354f99{constructor(e){super(e),this.value=void 0,this.on("change:isEnabled",((e,t,n)=>{n||this.reset()})),this.on("change:value",(()=>e.commands.get(PASTE_FORMAT_COMMAND_NAME).refresh()))}execute(){this.value=this._getFormattingAttributes()}reset(){this.value=void 0}_getFormattingAttributes(){const e=this.editor.model,t=e.document.selection;return Object.fromEntries(Array.from(t.getAttributes()).filter((([t])=>e.schema.getAttributeProperties(t).isFormatting)))}}class PasteFormatCommand extends _0x354f99{constructor(e){super(e),this._removeFormatCommand=new RemoveFormatCommandAlias(e)}execute(e={}){const t=this.editor.model,n=t.document.selection,i=Array.from(n.getRanges()),r=n.isCollapsed?[this._createRangeOnEntireWord(t,n)]:i;t.change((n=>{n.setSelection(r),this._removeFormatCommand.execute();for(const i in e)for(const s of t.schema.getValidRanges(r,i))n.setAttribute(i,e[i],s);n.setSelection(i)}))}_createRangeOnEntireWord(e,t){const n=e.createSelection(t);e.modifySelection(n,{unit:"word",direction:"backward"});const i=n.getFirstPosition();e.modifySelection(n,{unit:"word",direction:"forward"});const r=n.getLastPosition();return e.createRange(i,r)}}class RemoveFormatCommandAlias extends _0x354f99{execute(){const e=this.editor.model,t=e.schema;e.change((n=>{for(const i of this._getFormattingItems(e.document.selection,t))if(i.is("selection"))for(const e of this._getFormattingAttributes(i,t))n.removeSelectionAttribute(e);else{const e=n.createRangeOn(i);for(const r of this._getFormattingAttributes(i,t))n.removeAttribute(r,e)}}))}*_getFormattingItems(e,t){const n=e=>!!first(this._getFormattingAttributes(e,t));for(const i of e.getRanges())for(const e of i.getItems())!t.isBlock(e)&&n(e)&&(yield e);for(const t of e.getSelectedBlocks())n(t)&&(yield t);n(e)&&(yield e)}*_getFormattingAttributes(e,t){for(const[n]of e.getAttributes()){const e=t.getAttributeProperties(n);e&&e.isFormatting&&(yield n)}}}class FormatPainterEditing extends Plugin{static get pluginName(){return"FormatPainterEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.commands.add(COPY_FORMAT_COMMAND_NAME,new CopyFormatCommand(e)),e.commands.add(PASTE_FORMAT_COMMAND_NAME,new PasteFormatCommand(e)),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("formatPainterLicenseKeyValid"==r||"formatPainterLicenseKeyInvalid"==r||"formatPainterLicenseKeyExpired"==r||"formatPainterLicenseKeyDomainLimit"==r||"formatPainterLicenseKeyNotAllowed"==r||"formatPainterLicenseKeyEvaluationLimit"==r||"formatPainterLicenseKeyTrialLimit"==r||"formatPainterLicenseKeyDevelopmentLimit"==r||"formatPainterLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"formatPainterLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"formatPainterLicenseKeyExpired"==e&&t._showLicenseError("expired"),"formatPainterLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"formatPainterLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","FormatPainter"),"formatPainterLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"formatPainterLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"formatPainterLicenseKeyDevelopmentLimit"==e&&t._showLicenseError("developmentLimit"),"formatPainterLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function getTranslation$9(e,t){const n=e.t;switch(t){case"Paint formatting":return n("Paint formatting");case"Copy text formatting":return n("Copy text formatting");case"Paste text formatting":return n("Paste text formatting");case"Continuous painting":return n("Continuous painting");case"Keeps the painter on after setting the formatting.":return n("Keeps the painter on after setting the formatting.");case"Formatting copied.":return n("Formatting copied.");case"Pasted formatting.":return n("Pasted formatting.");default:return t}}class FormatPainterUI extends(/*   -- @preserve */
DomEmitterMixin(Plugin)){static get pluginName(){return"FormatPainterUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.editing.view.addObserver(ClickObserver),e.accessibility.addKeystrokeInfos({keystrokes:[{label:getTranslation$9(e.locale,"Copy text formatting"),keystroke:"Ctrl+Alt+C"},{label:getTranslation$9(e.locale,"Paste text formatting"),keystroke:"Ctrl+Alt+V"}]}),e.ui.componentFactory.add("formatPainter",(t=>{const n=createDropdown(t,SplitButtonView),i=e.commands.get(COPY_FORMAT_COMMAND_NAME);n.buttonView.set({label:getTranslation$9(e.locale,"Paint formatting"),icon:icons.paintRoller,keystroke:"Ctrl+Alt+C",tooltip:!0}),n.class="ck-format-painter-dropdown",i&&(n.bind("isEnabled").to(i,"isEnabled"),this.listenTo(i,"change:isEnabled",((e,t,n)=>{n||this._finishPainting()})),n.buttonView.bind("isOn").to(i,"value",(e=>!!e)),this.listenTo(e,"destroy",(()=>this._toggleSpecialCursor(!1))),this.listenTo(i,"change:value",((e,t,n)=>{this._toggleSpecialCursor(!!n)})));const r=new ViewModel({withText:!0,label:getTranslation$9(e.locale,"Continuous painting"),tooltip:getTranslation$9(e.locale,"Keeps the painter on after setting the formatting."),isOn:!1,role:"menuitemcheckbox"});addListToDropdown(n,new Collection([{type:"switchbutton",model:r}]),{role:"menu"});const s=()=>{this._copyFormatting(),this.listenTo(_0x56a4f4.window.document,"mouseup",(()=>{this._pasteFormatting(),r.isOn||this._finishPainting()}))};return this.listenTo(n,"execute",(()=>{r.isOn=!r.isOn})),this.listenTo(n.buttonView,"execute",(()=>{e.editing.view.focus(),n.buttonView.isOn?this._finishPainting():s()})),e.keystrokes.set("Ctrl+Alt+C",((e,t)=>{s(),r.isOn=!0,t()}),{priority:"high"}),e.keystrokes.set("Ctrl+Alt+V",((e,t)=>{n.buttonView.isOn&&(this._pasteFormatting(),r.isOn||this._finishPainting(),t())}),{priority:"high"}),e.keystrokes.set("Esc",((e,t)=>{n.buttonView.isOn&&(r.isOn=!1,this._finishPainting(),t())})),n}))}afterInit(){checkLicense$8(this)}_toggleSpecialCursor(e){this.editor.editing.view.change((t=>{for(const n of this.editor.editing.view.document.roots)e?t.addClass(CURSOR_ACTIVE_CSS_CLASS,n):t.removeClass(CURSOR_ACTIVE_CSS_CLASS,n)}))}_copyFormatting(){const{editor:e}=this;e.execute(COPY_FORMAT_COMMAND_NAME),e.ui.ariaLiveAnnouncer.announce(getTranslation$9(e.locale,"Formatting copied."))}_pasteFormatting(){const{editor:e}=this,t=e.commands.get(COPY_FORMAT_COMMAND_NAME).value;e.execute(PASTE_FORMAT_COMMAND_NAME,t),e.ui.ariaLiveAnnouncer.announce(getTranslation$9(e.locale,"Pasted formatting."))}_finishPainting(){this.editor.commands.get(COPY_FORMAT_COMMAND_NAME).reset(),this.stopListening(_0x56a4f4.window.document,"mouseup")}}async function checkLicense$8(e){const t=g([108,65,66,79,117,48,85,111,101,86,105,55,57,112,75,104,98,72,69,50,89,90,81,110,56,83,87,84,71,121,120,106,77,107,73,68,102,80,82,99,52,70,115,88,74,51,114,103,97,113,53,116,109,54,76,122,118,100,78,49,67,119]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU1NDg2MzV9.eyJqdGkiOjQzNzI1Mzg0NzIsImFsZyI6IkVTMjU2IiwiaWR4IjoxMTE4NDczMDE0NTg3OTIsIngiOiIxMkM5YnhObV9TcDhTaDlVTFRKMWxrYW9CUEd1YVhsbjM2UW9iUkVZZ05rIiwiY3J2IjoiUC0yNTYiLCJrdHkiOiJFQyIsImp0dSI6Ijk3NGM0ZTUxLTYwZjUtNDQ0Ni04OTliLTc5MmViY2ZiMzJhYSIsInVzZSI6InNpZyIsImRhdGUiOjE3MzkzNTU1NDg2MzUsInkiOiJ0QW4zbTZWVkMyNkNCbEN0TXJmVG1xcmgtOUVMb2RjSTBhY3cxMjZVWEtjIiwiaWF0IjoxNzM5MzU1NTQ4fQ.eGpY8QetCM0e19b1EF4YpXNIrNAxsxjdJm0Grwu37R1TcuuPCfMRdeZIKDC9cfKUA7ftHQZPmG9qmmn02k9_9w"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([108]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([70,80]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class FormatPainter extends Plugin{static get requires(){return[FormatPainterEditing,FormatPainterUI]}static get pluginName(){return"FormatPainter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}var importWordIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14 0 5 4.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M10.74 18a2.76 2.76 0 0 1-.469-.5H3V19h9.25v-.374A2.737 2.737 0 0 1 10.74 18Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.602.602 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001ZM11.674 15.407a.75.75 0 1 0 1.152.96L14 14.96V20h1.5v-5.04l1.174 1.408a.75.75 0 1 0 1.152-.96l-2.346-2.816a.95.95 0 0 0-1.46 0l-2.346 2.815Z"/></svg>\n';function getTranslation$8(e,t){const n=e.t;switch(t){case"Import from Word":return n("Import from Word");case"An error occurred while importing the Word file.":return n("An error occurred while importing the Word file.");case"Importing Word document":return n("Importing Word document");default:return t}}class ImportWordUI extends Plugin{static get pluginName(){return"ImportWordUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("importWord",(()=>{const t=this._createButton(FileDialogButtonView),n=e.commands.get("importWord");return t.bind("isOn").to(n,"isBusy"),t.tooltip=!0,t})),e.ui.componentFactory.add("menuBar:importWord",(()=>this._createButton(MenuBarMenuListItemFileDialogButtonView)))}_createButton(e){const t=this.editor,n=t.commands.get("importWord"),i=new e(t.locale),r=new SpinnerView;return i.set({acceptedType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template"}),i.set({icon:importWordIcon}),i.bind("isEnabled").to(n),i.bind("label").to(n,"isBusy",(e=>getTranslation$8(t.locale,e?"Importing Word document":"Import from Word"))),r.bind("isVisible").to(n,"isBusy"),i.iconView.bind("isVisible").to(n,"isBusy",(e=>!e)),i.children.add(r),i.on("done",((e,n)=>{t.execute("importWord",n[0],{}),t.editing.view.focus()})),i}}class ImportWordCommand extends _0x354f99{constructor(e){super(e),this.set("isBusy",!1),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.on("dataInsert",((t,n)=>{const i=new DataTransfer;i.setData("text/html",n.html);const r=this._importMarker.getRange();this.editor.model.enqueueChange(this._undoStepBatch,(t=>{this._importMarker.stopListening(),t.setSelection(r),e.editing.view.document.fire("clipboardInput",{dataTransfer:i})}))}),{priority:"low"})}refresh(){this.isEnabled=this._checkEnabled()}execute(e,t={}){if(this.isBusy)return Promise.resolve();const n=this.editor.config.get("importWord");if(this.editor.plugins.has("MergeFields")){const{prefix:e,suffix:n}=this.editor.config.get("mergeFields");t.merge_fields={prefix:e,suffix:n}}const i={url:n.converterUrl,file:e,serviceConfig:{...t,formatting:n.formatting,timezone:(new Intl.DateTimeFormat).resolvedOptions().timeZone}};return this._prepareForImport(),this._sendImportRequest(i).then(this._handleImportResponse.bind(this)).catch(this._handleImportFailure.bind(this)).finally(this._cleanUpAfterImport.bind(this))}_checkEnabled(){if(this.isBusy)return!1;const e=this.editor.model,t=e.schema,n=e.document.selection,i=first(n.getSelectedBlocks());return!!i&&t.checkChild(i.parent,"paragraph")}_prepareForImport(){const e=this.editor,t=e.model,n=t.document.selection;this._abortController=new AbortController,this._undoStepBatch=e.model.createBatch({isUndoable:!0}),t.enqueueChange(this._undoStepBatch,(e=>{n.isCollapsed||t.deleteContent(n,{leaveUnmerged:!0});const i=n.getFirstPosition(),r=first(n.getSelectedBlocks());let s;s=r.is("element","paragraph")&&r.isEmpty?i:i.isAtStart?t.createPositionBefore(r):i.isAtEnd?t.createPositionAfter(r):e.split(i).position,this._importMarker=e.addMarker("importWord:"+uid(),{usingOperation:!1,affectsData:!1,range:new Range(s)}),this._importMarker.on("change:range",(()=>{"$graveyard"===this._importMarker.getRange().root.rootName&&this._abortController.abort()}))})),this.isBusy=!0,this.refresh()}_cleanUpAfterImport(){const e=this.editor.model;e.markers.has(this._importMarker)&&e.enqueueChange(this._undoStepBatch,(e=>{e.removeMarker(this._importMarker)})),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.isBusy=!1,this.refresh()}_sendImportRequest({url:e,file:t,serviceConfig:n}){const i=this.editor.plugins.get("ImportWordEditing").getToken(),r=new FormData;r.set("config",JSON.stringify(n)),r.set("file",t);const s={method:"POST",headers:{},body:r,signal:this._abortController.signal};return i&&(s.headers.Authorization=i.value),fetch(e,s)}_handleImportResponse(e){return e.ok?e.json().then((e=>{this.editor.model.markers.has(this._importMarker)&&"$graveyard"!==this._importMarker.getRange().root.rootName&&this.fire("dataInsert",e)})):Promise.reject()}_handleImportFailure(){if(this._abortController.signal.aborted)return void logWarning("import-word-plugin-import-cancelled");const e=this.editor,t=getTranslation$8(e.locale,"An error occurred while importing the Word file.");e.plugins.get("Notification").showWarning(t),logError("import-word-plugin-conversion-failed")}}class ImportWordEditing extends Plugin{static get pluginName(){return"ImportWordEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Notification,ClipboardPipeline,"CloudServices"]}constructor(e){super(e),this._token=null}async init(){const e=this.editor;e.config.define("importWord",{converterUrl:"https://docx-converter.cke-cs.com/v2/convert/docx-html",tokenUrl:(e.config.get("cloudServices")||{}).tokenUrl,formatting:{resets:"none",defaults:"none",styles:"inline"}}),e.commands.add("importWord",new ImportWordCommand(e));const{tokenUrl:t}=e.config.get("importWord");if(t){const{tokenUrl:n}=e.config.get("cloudServices")||{};this._token=t===n?e.plugins.get("CloudServices").token:await e.plugins.get("CloudServices").registerTokenUrl(t)}}getToken(){return this._token}}class ImportWord extends Plugin{static get pluginName(){return"ImportWord"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[ImportWordEditing,ImportWordUI]}}class MultiLevelListCommand extends _0x354f99{constructor(e,t,n){super(e),this.defaultListMarkerStyle=t,this._listDefinitions=n,this._listUtils=this.editor.plugins.get("ListUtils")}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=e.listMarkerStyle||this.defaultListMarkerStyle;t.change((()=>{const e=this._getListTypeFromListMarkerStyle(n);if(!e)return;const t=e+"List";this.editor.execute(t,{additionalAttributes:{listMarkerStyle:n}})}))}_getValue(){const e=first(this.editor.model.document.selection.getSelectedBlocks());return this._listUtils.isListItemBlock(e)?e.getAttribute("listMarkerStyle"):null}_checkEnabled(){const e=this.editor,t=e.commands.get("customNumberedList"),n=e.commands.get("customBulletedList");return t.isEnabled||n.isEnabled}_getListTypeFromListMarkerStyle(e){const t=this._listDefinitions.find((t=>t.listMarkerStyle==e));return t?t.listType:null}}class MultiLevelListEditing extends Plugin{static get pluginName(){return"MultiLevelListEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["ListEditing"]}constructor(e){super(e);const t=this.editor.config.get("listMultiLevel.listDefinitions")||[];this._listDefinitions=[{listType:"customNumbered",listMarkerStyle:"legal",className:"legal-list",listMarkers:[{marker:e=>e+"."}]},...t]}init(){const e=this.editor,t=e.model,n=e.editing.view,i=e.plugins.get("ListEditing");e.commands.add("multiLevelList",new MultiLevelListCommand(e,"legal",this._listDefinitions)),t.schema.extend("$listItem",{allowAttributes:["listMarkerStyle","listMarker"]}),t.schema.addAttributeCheck(((e,t)=>{const n=e.last;if("listMarker"==t||"listMarkerStyle"==t)return!(!n.getAttribute("listItemId")||!this._listDefinitions.find((e=>e.listType==n.getAttribute("listType"))))&&void 0}));for(const n of this._listDefinitions)e.conversion.for("upcast").add((e=>{e.on("element:"+("customNumbered"==n.listType?"ol":"ul"),multiLevelListUpcastConverter(n,t.schema),{priority:"low"})})),i.registerDowncastStrategy({scope:"list",attributeName:"listMarkerStyle",setAttributeOnDowncast(e,t,i){t==n.listMarkerStyle?(e.addClass(["multi-level-list",n.className],i),e.setStyle("list-style-type","none",i)):(e.removeClass(["multi-level-list",n.className],i),e.removeStyle("list-style-type",i))}}),i.registerDowncastStrategy({scope:"itemMarker",attributeName:"listMarker",createElement:(e,t,{dataPipeline:i})=>t.hasAttribute("listMarker")?t.getAttribute("listType")!=n.listType||t.getAttribute("listMarkerStyle")!=n.listMarkerStyle?null:e.createUIElement("span",{class:"multi-level-list__marker",...!i&&{contenteditable:"false"}},(function(e){const n=this.toDomElement(e);return n.appendChild(e.createTextNode(t.getAttribute("listMarker")+" ")),n})):null,canInjectMarkerIntoElement:e=>t.schema.checkChild(e,"$text")&&t.schema.checkChild(e,"$inlineObject")&&!t.schema.isLimit(e)&&e.getAttribute("listType")==n.listType&&e.getAttribute("listMarkerStyle")==n.listMarkerStyle});e.conversion.for("upcast").add((e=>{e.on("element:span",multiLevelListMarkerUpcastConverter(n))})),i.on("postFixer",((e,{listNodes:t,writer:n})=>{const i=[];for(const{node:r,previousNodeInList:s}of t){const t=r.getAttribute("listType"),o=r.getAttribute("listMarkerStyle")||("customNumbered"==t?"legal":void 0),a=this._listDefinitions.find((e=>e.listType==t&&e.listMarkerStyle==o));if("customNumbered"!=t&&"customBulleted"!=t&&(r.hasAttribute("listMarker")&&(n.removeAttribute("listMarker",r),e.return=!0),r.hasAttribute("listMarkerStyle")&&(n.removeAttribute("listMarkerStyle",r),e.return=!0)),!a){"customBulleted"!=t||o||(n.setAttribute("listType","bulleted",r),e.return=!0);continue}r.hasAttribute("listMarkerStyle")||(n.setAttribute("listMarkerStyle",o,r),e.return=!0);const c=r.getAttribute("listIndent");if(s&&s.getAttribute("listItemId")==r.getAttribute("listItemId"))continue;i.length=c+1,s||i[c]?s&&s.getAttribute("listType")!=a.listType?i[c]=1:i[c]++:i[c]=r.getAttribute("listStart")||1;const l=generateMarker(c,a,i);r.getAttribute("listMarker")!=l&&(n.setAttribute("listMarker",l,r),e.return=!0)}}));const r=e.editing.view.document;this.listenTo(r,"clipboardOutput",((e,t)=>{const n=new Matcher({name:"span",classes:"multi-level-list__marker"}),i=new Matcher({name:"ol",classes:"multi-level-list",styles:{"list-style-type":"none"}}),r=new UpcastWriter(t.content.document),s=[];for(const e of r.createRangeIn(t.content).getItems())e.is("element")&&n.match(e)&&s.push(e),e.is("element")&&i.match(e)&&r.removeStyle("list-style-type",e);for(const e of s)r.remove(e)}))}afterInit(){checkLicense$7(this)}}function generateMarker(e,t,n){let i=t.listMarkers[e%t.listMarkers.length];if(void 0===i.showMarkerPath||i.showMarkerPath)return n.slice(0,e+1).map(((e,n)=>(i=t.listMarkers[n%t.listMarkers.length],getMarkerString(i.marker,e)))).join("");{const e=n[n.length-1];return getMarkerString(i.marker,e)}}function getMarkerString(e,t){return"function"==typeof e?e(t):e}function multiLevelListUpcastConverter(e,t){return(n,i,r)=>{const s=i.viewItem;if(i.modelRange||Object.assign(i,r.convertChildren(i.viewItem,i.modelCursor)),!r.consumable.test(s,{classes:e.className}))return;const o=Array.from(i.modelRange.getItems({shallow:!0})).filter((e=>t.checkAttribute(e,"listItemId")));if(!o.length)return;r.consumable.consume(s,{classes:e.className}),r.consumable.consume(s,{classes:"multi-level-list"}),r.consumable.consume(s,{styles:"list-style-type"});const a=o[0].getAttribute("listIndent");for(const t of o)t.getAttribute("listIndent")==a&&(r.writer.setAttribute("listType",e.listType,t),r.writer.setAttribute("listMarkerStyle",e.listMarkerStyle,t))}}function multiLevelListMarkerUpcastConverter(e){return(t,n,{writer:i,consumable:r})=>{const s=n.modelCursor,o=s.parent,a=n.viewItem;if(r.consume(a,{name:!0,classes:"multi-level-list__marker"})&&s.isAtStart&&o.hasAttribute("listType")&&a.childCount>0){const t=e.createRangeIn(a);let n="";for(const e of t.getItems())e.is("$textProxy")&&(n+=e.data.trim(),r.consume(e.textNode));i.setAttribute("listMarker",n.trim(),o)}}}async function checkLicense$7(e){const t=g([88,51,76,116,89,104,114,72,55,103,113,53,86,49,54,109,75,112,97,68,106,122,108,87,98,115,77,57,84,79,66,85,80,117,120,78,101,107,90,50,83,105,102,73,110,99,119,70,65,71,121,81,111,69,74,100,118,48,56,82,52,67]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU1NzYwODB9.eyJqdGkiOjk1MTEzNDI4ODEsImFsZyI6IkVTMjU2IiwiaWR4IjozMjYwMzA3Nzc3MDg0LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiI2YzU3ZGQyNC0wOTMyLTQ4ZDAtYjYwMS0xOWQ2N2MxNjc5MjAiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NTc2MDgwLCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTU3Nn0.GxDQrQtEBdVqPg4LYx3Ou3OjrbtSzGbbhmM87UjkFguduGyFDG3n379BHSGSoJH5wEddPqBUGdF-nGmnrbIKwQ"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([88]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([77,76,76])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}function getTranslation$7(e,t){const n=e.t,i=e.t;switch(t){case"Start at":return n("Start at");case"Start index must be greater than 0.":return n("Start index must be greater than 0.");case"Invalid start index value.":return n("Invalid start index value.");case"List properties":return n("List properties");case"Multi-level List":return i("Multi-level List");case"Multi-level list styles toolbar":return i("Multi-level list styles toolbar");default:return t}}class MultiLevelListView extends View{constructor(e,{enabledProperties:t,styleButtonViews:n,styleGridAriaLabel:i}){super(e),this.stylesView=null,this.additionalPropertiesCollapsibleView=null,this.startIndexFieldView=null,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusables=new ViewCollection;const r=["ck","ck-multi-level-list-properties"];this.children=this.createCollection(),this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),t.styles?(this.stylesView=this._createStylesView(n,i),this.children.add(this.stylesView)):r.push("ck-multi-level-list-properties_without-styles"),t.startIndex&&(this._addListPropertyViews(t),r.push("ck-multi-level-list-properties_with-multi-level-properties")),this.setTemplate({tag:"div",attributes:{class:r},children:this.children})}render(){if(super.render(),this.stylesView){this.focusables.add(this.stylesView),this.focusTracker.add(this.stylesView.element),this.startIndexFieldView&&(this.focusables.add(this.children.last.buttonView),this.focusTracker.add(this.children.last.buttonView.element));for(const e of this.stylesView.children)this.stylesView.focusTracker.add(e.element);addKeyboardHandlingForGrid({keystrokeHandler:this.stylesView.keystrokes,focusTracker:this.stylesView.focusTracker,gridItems:this.stylesView.children,numberOfColumns:()=>_0x56a4f4.window.getComputedStyle(this.stylesView.element).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}if(this.startIndexFieldView){this.focusables.add(this.startIndexFieldView),this.focusTracker.add(this.startIndexFieldView.element);const e=e=>e.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}this.keystrokes.listenTo(this.element)}focus(){this.focusCycler.focusFirst()}focusLast(){this.focusCycler.focusLast()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createStylesView(e,t){const n=new View(this.locale);return n.children=n.createCollection(),n.children.addMany(e),n.setTemplate({tag:"div",attributes:{"aria-label":t,class:["ck","ck-multi-level-list-styles"]},children:n.children}),n.children.delegate("execute").to(this),n.focus=function(){this.children.first.focus()},n.focusTracker=new FocusTracker,n.keystrokes=new KeystrokeHandler,n.render(),n.keystrokes.listenTo(n.element),n}_addListPropertyViews(e){const t=[];e.startIndex&&(this.startIndexFieldView=this._createStartIndexField(),t.push(this.startIndexFieldView)),e.styles?(this.additionalPropertiesCollapsibleView=new CollapsibleView(this.locale,t),this.additionalPropertiesCollapsibleView.set({label:getTranslation$7(this.locale,"List properties"),isCollapsed:!0}),this.additionalPropertiesCollapsibleView.buttonView.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e)))),this.additionalPropertiesCollapsibleView.buttonView.on("change:isEnabled",((e,t,n)=>{n||(this.additionalPropertiesCollapsibleView.isCollapsed=!0)})),this.children.add(this.additionalPropertiesCollapsibleView)):this.children.addMany(t)}_createStartIndexField(){const e=new LabeledFieldView(this.locale,createLabeledInputNumber);return e.set({label:getTranslation$7(this.locale,"Start at"),class:"ck-multi-level-list-properties__start-index"}),e.fieldView.set({min:0,step:1,value:1,inputMode:"numeric"}),e.fieldView.on("input",(()=>{const t=e.fieldView.element,n=t.valueAsNumber;Number.isNaN(n)?e.errorText=getTranslation$7(this.locale,"Invalid start index value."):t.checkValidity()?this.fire("listStart",{startIndex:n}):e.errorText=getTranslation$7(this.locale,"Start index must be greater than 0.")})),e}}var multiLevelListIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7.85 6.5a.75.75 0 0 1 0-1.5h9.5a.75.75 0 1 1 0 1.5h-9.5Z"/><path d="M3 8V2.7H.5v1h1V8H3Z"/><path d="M13.42 14.185a.75.75 0 0 0 .53 1.28h3.4a.75.75 0 1 0 0-1.5h-3.4a.75.75 0 0 0-.53.22Z"/><path d="M5.636 8.035V6.8H4.4v1.235h1.236Z"/><path d="M9 17.865v-5.3H6.5v1h1v4.3H9Z"/><path d="M11.636 17.9v-1.235H10.4V17.9h1.236Z"/><path d="M3.2 17.865v-5.3H.7v1h1v4.3h1.5Z"/><path d="M5.836 17.9v-1.235H4.6V17.9h1.236Z"/></svg>';class MultiLevelListUI extends Plugin{static get pluginName(){return"MultiLevelListUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("multiLevelList",getViewCreator({editor:e,parentCommandName:"multiLevelList",buttonLabel:getTranslation$7(e.locale,"Multi-level List"),buttonIcon:multiLevelListIcon,styleGridAriaLabel:getTranslation$7(e.locale,"Multi-level list styles toolbar"),styleDefinitions:[]})),e.ui.componentFactory.add("menuBar:multiLevelList",(()=>{const t=e.commands.get("multiLevelList"),n=new MenuBarMenuListItemButtonView(e.locale);return n.set({label:getTranslation$7(e.locale,"Multi-level List"),icon:multiLevelListIcon}),n.bind("isEnabled").to(t),n.bind("isOn").to(t,"value",(e=>!!e)),n.on("execute",(()=>{e.execute("multiLevelList"),e.editing.view.focus()})),n})),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("multiLevelListLicenseKeyValid"==r||"multiLevelListLicenseKeyInvalid"==r||"multiLevelListLicenseKeyExpired"==r||"multiLevelListLicenseKeyDomainLimit"==r||"multiLevelListLicenseKeyNotAllowed"==r||"multiLevelListLicenseKeyEvaluationLimit"==r||"multiLevelListLicenseKeyTrialLimit"==r||"multiLevelListLicenseKeyDevelopmentLimit"==r||"multiLevelListLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"multiLevelListLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"multiLevelListLicenseKeyExpired"==e&&t._showLicenseError("expired"),"multiLevelListLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"multiLevelListLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","MultiLevelList"),"multiLevelListLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"multiLevelListLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"multiLevelListLicenseKeyDevelopmentLimit"==e&&t._showLicenseError("developmentLimit"),"multiLevelListLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function getViewCreator({editor:e,parentCommandName:t,buttonLabel:n,buttonIcon:i,styleGridAriaLabel:r,styleDefinitions:s}){const o=e.commands.get(t),a=e.config.get("list.properties")||{},c=e.plugins.has("ListProperties"),l=a.startIndex;return c&&l?a=>{const c=createDropdown(a,SplitButtonView),l=c.buttonView;return c.bind("isEnabled").to(o),c.class="ck-list-styles-dropdown",l.on("execute",(()=>{e.execute(t),e.editing.view.focus()})),l.set({label:n,icon:i,tooltip:!0,isToggleable:!0}),l.bind("isOn").to(o,"value",(e=>!!e)),c.once("change:isOpen",(()=>{const n=createListPropertiesView({editor:e,dropdownView:c,parentCommandName:t,styleGridAriaLabel:r,styleDefinitions:s});c.panelView.children.add(n)})),c.on("execute",(()=>{e.editing.view.focus()})),c}:r=>{const s=new ButtonView(r);return s.set({label:n,icon:i,tooltip:!0,isToggleable:!0}),s.bind("isOn").to(o,"value",(e=>!!e)),s.on("execute",(()=>{e.execute(t),e.editing.view.focus()})),s}}function createListPropertiesView({editor:e,dropdownView:t,styleDefinitions:n,styleGridAriaLabel:i}){const r=e.locale,s=e.config.get("list.properties");s.reversed=!1,n.length||(s.styles=!1);const o=new MultiLevelListView(r,{styleGridAriaLabel:i,enabledProperties:s,styleButtonViews:null});if(s.startIndex){const t=e.commands.get("listStart");o.startIndexFieldView.bind("isEnabled").to(t),o.startIndexFieldView.fieldView.bind("value").to(t),o.on("listStart",((t,n)=>e.execute("listStart",n)))}return o.delegate("execute").to(t),o}class MultiLevelList extends Plugin{static get pluginName(){return"MultiLevelList"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[MultiLevelListEditing,MultiLevelListUI]}}class InsertMergeFieldCommand extends _0x354f99{refresh(){const e=this.editor.model,t=e.schema.checkChild(e.document.selection.focus,"mergeField");this.isEnabled=t}execute(e){if(!e||"string"!=typeof e)return;const t=this.editor.model;t.change((n=>{t.deleteContent(t.document.selection);const i=n.createElement("mergeField",{id:e});for(const[e,r]of t.document.selection.getAttributes())t.schema.checkAttribute(i,e)&&n.setAttribute(e,r,i);t.insertContent(i,t.document.selection,0,{setSelection:"after"})}))}}class InsertMergeFieldBlockCommand extends _0x354f99{refresh(){const e=this.editor.model,t=e.document.selection;this.isEnabled=isAllowedInParent(t,e)}execute(e,t){if(!e||"string"!=typeof e)return;const n=this.editor.model;n.change((i=>{const r=i.createElement("mergeFieldBlock",{id:e});n.insertObject(r,n.document.selection,null,{setSelection:"on",findOptimalPosition:!1===t?void 0:"auto"})}))}}function isAllowedInParent(e,t){let n=findOptimalInsertionRange(e,t).start.parent;return n.isEmpty&&!t.schema.isLimit(n)&&(n=n.parent),t.schema.checkChild(n,"mergeFieldBlock")}class PreviewMergeFieldsCommand extends _0x354f99{constructor(e){super(e);const t=this.editor.plugins.get("MergeFieldsEditing");this.bind("value").to(t,"previewMode"),this.affectsData=!1}refresh(){this.isEnabled=!0}execute(e){this.editor.plugins.get("MergeFieldsEditing").previewMode=e}}var warningIcon='<svg width="12" height="12" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12 6C12 9.31371 9.31371 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C9.31371 0 12 2.68629 12 6ZM5.27988 2.40003H6.71988V6.72003H5.27988V2.40003ZM6.72009 8.16003H5.28009V9.60003H6.72009V8.16003Z" fill="#DB3700"/>\n</svg>\n';const DEFAULT_MERGE_FIELD_BLOCK_HEIGHT=120;class MergeFieldsEditing extends Plugin{static get pluginName(){return"MergeFieldsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.flattenedMergeFieldDefinitions=[],e.config.define("mergeFields.previewModes",["$labels","$defaultValues","$dataSets"]),e.config.define("mergeFields.dataSets",[]),e.config.define("mergeFields.definitions",[]),e.config.define("mergeFields.prefix","{{"),e.config.define("mergeFields.suffix","}}"),e.config.define("mergeFields.previewHtmlValues",!1),e.config.define("mergeFields.sanitizeHtml",(e=>(logWarning("merge-fields-provide-sanitize-function"),{html:e,hasChanged:!1}))),this._mergeFieldPrefix=e.config.get("mergeFields.prefix"),this._mergeFieldSuffix=e.config.get("mergeFields.suffix"),this._shouldPreviewHtmlValues=e.config.get("mergeFields.previewHtmlValues"),this.flattenedMergeFieldDefinitions=this._getFlattenedMergeFieldDefinitions(),this._validateConfig();const t="\\"+this._mergeFieldPrefix.split("").join("\\"),n="\\"+this._mergeFieldSuffix.split("").join("\\");this._mergeFieldRegExp=new RegExp("("+t+"[^"+(t+n)+" ]+"+n+")","g"),this.availablePreviewModes=this._getAvailablePreviewModes();const i=e.config.get("mergeFields.initialPreviewMode")||this.availablePreviewModes[0];this._validatePreviewMode(i),this.set("previewMode",i),this._mergeFieldElements=new Set}init(){const e=this.editor;e.commands.add("insertMergeField",new InsertMergeFieldCommand(e)),e.commands.add("insertMergeFieldBlock",new InsertMergeFieldBlockCommand(e)),e.commands.add("previewMergeFields",new PreviewMergeFieldsCommand(e)),this._defineSchema(),this._defineConverters(),this.on("change:previewMode",((e,t,n)=>{this._validatePreviewMode(n),this._refreshMergeFields()})),this.listenTo(e.model.document,"change:data",(()=>{this._trackAddedMergeFields()})),e.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(e.model,(e=>e.hasClass("ck-merge-field")))),e.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(e.model,(e=>e.hasClass("ck-merge-field-block")))),this._registerConversionPostFixer(),e.editing.view.domConverter.registerInlineObjectMatcher({name:"span",classes:["ck-merge-field"]})}afterInit(){checkLicense$6(this)}getDefaultValues(){const e={},t=this.getMergeFieldsIds();for(const n of t)e[n]=this.getMergeFieldDefaultValue(n);return e}getDataSetValues(e,t=!1){const n={},i=this.getMergeFieldsIds();for(const r of i){let i=this.getMergeFieldValue(r,e);null===i&&t&&(i=this.getMergeFieldDefaultValue(r)),n[r]=i}return n}getLabel(e){const t=this.getDefinition(e);return t&&t.label?t.label:e}getMergeFieldDefaultValue(e){const t=this.getDefinition(e);if(!t||void 0===t.defaultValue)return null;const n="function"==typeof t.defaultValue?t.defaultValue(this.editor):t.defaultValue;return String(n)}getMergeFieldValue(e,t){const n=this.editor.config.get("mergeFields.dataSets").find((e=>e.id===t));if(!n)throw new CKEditorError("merge-fields-data-set-not-found",null);const i=n.values[e];if(void 0===i)return null;const r="function"==typeof i?i(this.editor):i;return String(r)}getMergeFieldType(e){const t=this.getDefinition(e);return t&&t.type?t.type:"text"}getDocumentMergeFieldsIds(){const e=new Set;for(const t of this._mergeFieldElements)"$graveyard"!==t.root.rootName&&e.add(t.getAttribute("id"));return Array.from(e)}getMergeFieldsIds(){const e=this.flattenedMergeFieldDefinitions.map((e=>e.id)),t=this.getDocumentMergeFieldsIds();return Array.from(new Set([...e,...t]))}getDefinition(e){return this.flattenedMergeFieldDefinitions.find((t=>t.id===e))||null}_getFlattenedMergeFieldDefinitions(){const e=new Set,t=this.editor;return t.config.get("mergeFields.definitions").reduce(((n,i)=>{if("groupId"in i){if(e.has(i.groupId))throw new CKEditorError("merge-fields-duplicate-group-id",t,{duplicateId:i.groupId});e.add(i.groupId)}return"groupId"in i?function(e,t){for(const n of t.definitions)e=e.concat(n);return e}.bind(t)(n,i):n.concat(i)}),new Array)}_validateConfig(){const e=/^['"`!#%:;=@{}~$()*+/?[\\\]^|]+$/;if(!e.test(this._mergeFieldPrefix)||!e.test(this._mergeFieldSuffix))throw new CKEditorError("merge-fields-invalid-prefix-or-suffix",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix});if(this._mergeFieldPrefix.length>8||this._mergeFieldSuffix.length>8)throw new CKEditorError("merge-fields-prefix-or-suffix-too-long",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix,limit:8});const t=/^[a-zA-Z0-9_.-]+$/,n=new Set;if(this.flattenedMergeFieldDefinitions.map((e=>{if(!t.test(e.id))throw new CKEditorError("merge-fields-invalid-id",this,{incorrectId:e.id});if(n.has(e.id))throw new CKEditorError("merge-fields-duplicate-merge-field-id",this,{duplicateId:e.id});n.add(e.id)})),this._mergeFieldPrefix===this._mergeFieldSuffix)throw new CKEditorError("merge-fields-prefix-and-suffix-must-differ",this);const i=this.editor.config.get("mergeFields.previewModes"),r=["$labels","$defaultValues","$dataSets"];if(!i.length||!i.every((e=>r.includes(e))))throw new CKEditorError("merge-fields-invalid-preview-modes-configuration",this,{invalidConfig:i});const s=new Set,o=this.editor.config.get("mergeFields.dataSets");for(const e of o){if(s.has(e.id))throw new CKEditorError("merge-fields-duplicate-data-set-id",this,{duplicateId:e.id});s.add(e.id)}}_getAvailablePreviewModes(){const e=this.editor.config.get("mergeFields.previewModes"),t=[];if(e.includes("$labels")&&t.push("$labels"),e.includes("$defaultValues")&&t.push("$defaultValues"),e.includes("$dataSets")){const e=this.editor.config.get("mergeFields.dataSets");t.push(...e.map((e=>e.id)))}return t}_defineSchema(){const e=this.editor.model.schema;e.register("mergeField",{inheritAllFrom:"$inlineObject",allowAttributes:["id"],allowWhere:"$text"}),e.register("mergeFieldBlock",{inheritAllFrom:"$blockObject",allowAttributes:["id"]})}_defineConverters(){const e=this.editor.conversion;e.for("upcast").add((e=>{e.on("text",((e,t,n)=>{const{consumable:i,writer:r,schema:s}=n,{viewItem:o}=t;if(!i.test(o))return;const a=o.data.split(this._mergeFieldRegExp).filter((e=>e));if(1===a.length&&!a[0].match(this._mergeFieldRegExp))return;let c=!0;for(const e of a){if(!e.match(this._mergeFieldRegExp)){c=!1;break}const t=e.slice(this._mergeFieldPrefix.length,e.length-this._mergeFieldSuffix.length);if("text"===this.getMergeFieldType(t)){c=!1;break}}if(c){i.consume(o);for(const e of a){const n=e.slice(this._mergeFieldPrefix.length,e.length-this._mergeFieldSuffix.length),i=t.modelCursor,s=r.createElement("mergeFieldBlock",{id:n});r.insert(s,i),t.modelCursor=i.getShiftedBy(1),t.modelRange=r.createRange(t.modelRange?t.modelRange.start:i,t.modelCursor)}}else{if(!s.checkChild(t.modelCursor,"$text")){if(!isParagraphable(t.modelCursor,"$text",s))return;t.modelCursor=wrapInParagraph(t.modelCursor,r)}i.consume(o);for(const e of a){const n=t.modelCursor;let i;if(e.match(this._mergeFieldRegExp)){const t=e.slice(this._mergeFieldPrefix.length,e.length-this._mergeFieldSuffix.length);i=r.createElement("mergeField",{id:t})}else i=r.createText(e);r.insert(i,n),t.modelCursor=n.getShiftedBy(i.offsetSize),t.modelRange=r.createRange(t.modelRange?t.modelRange.start:n,t.modelCursor)}}}))})),e.for("editingDowncast").elementToElement({model:"mergeField",view:(e,{writer:t})=>this._createMergeFieldWidget(e,t,"text")}),e.for("dataDowncast").elementToElement({model:"mergeField",view:(e,{writer:t,options:n})=>this._createTextualMergeField(e,t,n.mergeFieldsData)}),e.for("editingDowncast").elementToElement({model:"mergeFieldBlock",view:(e,{writer:t})=>this._createMergeFieldWidget(e,t,"block")}),e.for("dataDowncast").elementToElement({model:"mergeFieldBlock",view:(e,{writer:t,options:n})=>this._createTextualMergeField(e,t,n.mergeFieldsData)})}_createMergeFieldWidget(e,t,n){const{label:i,classes:r,status:s,height:o}=this._prepareViewElementData(e),a=this._mergeFieldPrefix,c=this._mergeFieldSuffix,l=this.editor.config.get("mergeFields.sanitizeHtml"),d="text"===n?"span":"div";let u;if("$labels"===this.previewMode)u=t.createContainerElement(d,{class:r},[t.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=a,t})),t.createContainerElement("span",{class:"ck-merge-field__content"},t.createText(String(i))),t.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=c,t}))]);else if(s){const e=this._shouldPreviewHtmlValues?t.createRawElement("span",{},(function(e,t){t.setContentOf(e,l(i).html)})):t.createText(i);if(u=t.createContainerElement(d,{class:r},[e]),"text"===n||["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(s)){const e=t.createUIElement("span",{class:"ck-merge-field__icon"},(function(e){const t=this.toDomElement(e),n=new IconView;return n.set({content:warningIcon}),n.render(),t.appendChild(n.element),t}));t.insert(t.createPositionAt(u,"end"),e)}t.setCustomProperty("mergeFieldStatus",s,u)}else{const e=this._shouldPreviewHtmlValues?t.createRawElement(d,{},(function(e,t){t.setContentOf(e,l(i).html)})):t.createText(i);u=t.createContainerElement(d,{class:r},e)}if("block"===n){const n=t.createContainerElement("div",{class:"ck-merge-field-block"},[u]);if(("$labels"===this.previewMode||s&&["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(s))&&t.setAttribute("style","height: "+o+"px",n),u.hasClass("ck-merge-field_with-value"))t.addClass("ck-merge-field-block_with-value",n);else if(u.hasClass("ck-merge-field_with-warning")){for(const e of u.getClassNames())if("ck-merge-field"!==e){const i=e.replace("ck-merge-field","ck-merge-field-block");t.addClass(i,n)}t.setAttribute("data-merge-field-block-label",this.getLabel(e.getAttribute("id")),n),t.setCustomProperty("mergeFieldStatus",s,n)}return t.setCustomProperty("mergeFieldBlock",!0,n),toWidget(n,t,{hasSelectionHandle:!0})}return t.setCustomProperty("mergeField",!0,u),toWidget(u,t)}_prepareViewElementData(e){const t=this.getDefinition(e.getAttribute("id"));if(!t)return"$labels"===this.previewMode?{label:e.getAttribute("id"),classes:"ck-merge-field"}:{label:e.getAttribute("id"),classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-definition",status:"WARNING_MISSING_DATA"};const n=this.getLabel(t.id),i=this.getMergeFieldType(t.id),r=this.getMergeFieldDefaultValue(e.getAttribute("id")),s="text"!==i?t.height||DEFAULT_MERGE_FIELD_BLOCK_HEIGHT:void 0;if("$labels"===this.previewMode)return{label:n,height:s,classes:"ck-merge-field"};if("$defaultValues"===this.previewMode)return r?{label:r,height:s,classes:"ck-merge-field ck-merge-field_with-value"}:{label:n,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_no-default",status:"WARNING_MISSING_DEFAULT_VALUE"};const o=this.getMergeFieldValue(t.id,this.previewMode);return o?{label:o,height:s,classes:"ck-merge-field ck-merge-field_with-value"}:r?{label:r,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_default-value-used",status:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"}:{label:n,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-data",status:"WARNING_MISSING_DATA"}}_createTextualMergeField(e,t,n){const i=e.getAttribute("id"),r=n&&n[i]?n[i]:this._mergeFieldPrefix+i+this._mergeFieldSuffix;let s;if(n)s=t.createRawElement("span",{},(function(e,t){t.setContentOf(e,String(r))}));else{s=t.createContainerElement("span");const e=t.createText(r);t.insert(t.createPositionAt(s,"end"),e)}return t.setCustomProperty("dataPipeline:transparentRendering",!0,s),s}_refreshMergeFields(){this._mergeFieldElements.forEach((e=>{"$graveyard"!==e.root.rootName&&this.editor.editing.reconvertItem(e)}))}_validatePreviewMode(e){if(!this.availablePreviewModes.includes(e))throw new CKEditorError("merge-fields-invalid-preview-mode-set",this,{availablePreviewModes:this.availablePreviewModes,previewMode:e})}_trackAddedMergeFields(){for(const e of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if("insert"!==e.type||"$text"===e.name)continue;if("mergeField"===e.name||"mergeFieldBlock"===e.name){this._mergeFieldElements.add(e.position.nodeAfter);continue}const t=this.editor.model.createRangeIn(e.position.nodeAfter);for(const e of t.getItems())e.is("element","mergeField")&&this._mergeFieldElements.add(e)}}_registerConversionPostFixer(){const e=this.editor;e.model.document.registerPostFixer((t=>{if(!t.batch.isLocal)return!1;const n=[],i=new Set,r=this._mergeFieldRegExp;let s=!1;for(const t of e.model.document.differ.getChanges())if("insert"===t.type||"remove"===t.type){let e="$text"==t.name?t.position.parent:t.position.nodeAfter;if(!e)continue;e.is("$text")&&(e=e.parent),o(e)}for(const i of n.reverse()){const{match:n,item:r}=i,o=t.createPositionAt(r,n.index),c=o.getShiftedBy(n[0].length),l=t.createRange(o,c),d=n[0],u=d.slice(this._mergeFieldPrefix.length,d.length-this._mergeFieldSuffix.length),h=a(l);if(h.set("id",u),"block"===this.getMergeFieldType(u)){const n=t.createElement("mergeFieldBlock",{id:u});t.remove(l),e.model.insertObject(n,null,null,{setSelection:"on",findOptimalPosition:void 0})}else{const n=t.createElement("mergeField",h);e.model.schema.checkChild(l.start,"mergeField")?e.model.insertObject(n,l):t.remove(l)}s=!0}return s;function o(e){let t="",s=0;if(!i.has(e))for(const a of e.getChildren()){const c=a.nextSibling;if(a.is("$text")&&(""===t&&a.startOffset&&(s=a.startOffset),t+=a.data),!c||c.is("element")){for(const i of t.matchAll(r))i.index=i.index+s,n.push({match:i,item:e});i.add(e),t=""}a.is("element")&&o(a)}}function a(e){const t=e.getItems(),n=t.next().value,i=new Map(n.getAttributes());for(const e of t)for(const[t,n]of i)e.getAttribute(t)!==n&&i.delete(t);return i}}))}}async function checkLicense$6(e){const t=g([90,56,65,76,67,119,111,86,50,75,115,74,88,103,113,117,53,83,49,73,85,107,48,82,69,106,57,105,51,97,98,109,99,78,68,114,116,52,84,110,66,77,89,120,100,71,55,80,104,108,81,122,121,72,87,102,112,79,70,54,101,118]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU2MTY0NDB9.eyJqdGkiOjI5ODYzNTE3NDksImFsZyI6IkVTMjU2IiwiaWR4Ijo0NTU4ODYxMjQ1MzYxLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiI2NTU5MjEzMy01ODM2LTRjZTctODNmNy02MzU0MjEzN2QzMTQiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NjE2NDQwLCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTYxNn0.BpO7EV8meattulkvIY29U0Plx-qucuMMabv3SwJTSIw9a6WAtoz9maIhQDCTDOn0VHMpdTGu8G9HqYObXqoYUw"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([90]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([77,70])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class MergeFieldsListView extends ListView{filter(e){return filterGroupAndItemNames(e,this.items)}}class MergeFieldsPanelView extends View{constructor(e){super(e),this.set("text","");const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-merge-fields-form"]},children:[{tag:"div",attributes:{class:["ck","ck-merge-fields-form__status"]},children:[{text:t.to("text")}]}]})}}function getTranslation$6(e,t){const n=e.t;switch(t){case"Search merge field":return n("Search merge field");case"No merge fields found":return n("No merge fields found");case"No merge fields available":return n("No merge fields available");case"Insert merge field":return n("Insert merge field");case"Merge field":return n("Merge field");case"Merge fields preview":return n("Merge fields preview");case"Labels":return n("Labels");case"Default values":return n("Default values");case"WARNING_MISSING_DATA_USED_DEFAULT_VALUE":return n({string:"Default value is used.",id:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"});case"WARNING_MISSING_DEFAULT_VALUE":return n({string:"Default value not available.",id:"WARNING_MISSING_DEFAULT_VALUE"});case"WARNING_MISSING_DATA":return n({string:"Value not available.",id:"WARNING_MISSING_DATA"});default:return t}}var insertMergeFieldIcon='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n<circle cx="10.0001" cy="9.79993" r="1.5"/>\n<path d="M13.2496 2.75005C13.2497 2.00005 13.2498 2.00005 13.2498 2.00005L13.2511 2.00005L13.2534 2.00006L13.2606 2.00009L13.2848 2.0003C13.3052 2.00053 13.3337 2.00098 13.3688 2.00185C13.4386 2.0036 13.536 2.00707 13.6475 2.01402C13.8589 2.02722 14.1651 2.05536 14.4328 2.12276C14.8296 2.22267 15.1705 2.40399 15.4402 2.67392C15.7077 2.94161 15.8688 3.26001 15.9644 3.5803C16.1459 4.18776 16.1145 4.89393 16.0724 5.49256C16.0626 5.6324 16.052 5.76849 16.0416 5.90131C16.0036 6.38849 15.969 6.83163 15.9895 7.25369C16.0151 7.78147 16.1252 8.13279 16.3222 8.3656C16.5447 8.6286 16.8158 8.79405 17.0411 8.89436C17.1523 8.94386 17.2471 8.97509 17.3103 8.99319C17.3417 9.00219 17.3647 9.00776 17.3773 9.01062L17.3868 9.01269L17.9996 9.12173V9.75005H15.5976C15.4541 9.63123 15.3117 9.49364 15.1771 9.33451C14.669 8.73405 14.5235 7.99036 14.4913 7.32643C14.4657 6.79933 14.5105 6.23163 14.5497 5.73429C14.5592 5.61404 14.5683 5.49785 14.5761 5.3874C14.6198 4.76596 14.62 4.32043 14.5272 4.00956C14.4857 3.87069 14.4332 3.78828 14.3791 3.73414C14.3272 3.68223 14.2386 3.6207 14.0665 3.57736C13.9372 3.5448 13.7433 3.52293 13.554 3.51111C13.4651 3.50556 13.3869 3.50277 13.3313 3.50139C13.3037 3.5007 13.282 3.50036 13.2678 3.5002L13.2524 3.50007L13.2493 3.50005L12.4996 3.5L12.4997 2L13.2498 2.00005L13.2496 2.75005Z"/>\n<path d="M13.2496 16.7501C13.2497 17.5001 13.2498 17.5001 13.2498 17.5001L13.2511 17.5001L13.2534 17.5001L13.2606 17.5L13.2848 17.4998C13.3052 17.4996 13.3337 17.4991 13.3688 17.4983C13.4386 17.4965 13.536 17.493 13.6475 17.4861C13.8589 17.4729 14.1651 17.4448 14.4328 17.3774C14.8296 17.2774 15.1705 17.0961 15.4402 16.8262C15.7077 16.5585 15.8688 16.2401 15.9644 15.9198C16.1459 15.3124 16.1145 14.6062 16.0724 14.0076C16.0626 13.8677 16.052 13.7316 16.0416 13.5988C16.0036 13.1116 15.969 12.6685 15.9895 12.2464C16.0151 11.7186 16.1252 11.3673 16.3222 11.1345C16.5447 10.8715 16.8158 10.7061 17.0411 10.6058C17.1523 10.5563 17.2471 10.525 17.3103 10.5069C17.3417 10.4979 17.3647 10.4924 17.3773 10.4895L17.3868 10.4874L17.9996 10.3784V9.75005H15.5976C15.4541 9.86887 15.3117 10.0065 15.1771 10.1656C14.669 10.7661 14.5235 11.5098 14.4913 12.1737C14.4657 12.7008 14.5105 13.2685 14.5497 13.7658C14.5592 13.8861 14.5683 14.0023 14.5761 14.1127C14.6198 14.7341 14.62 15.1797 14.5272 15.4906C14.4857 15.6294 14.4332 15.7118 14.3791 15.766C14.3272 15.8179 14.2386 15.8794 14.0665 15.9228C13.9372 15.9553 13.7433 15.9772 13.554 15.989C13.4651 15.9945 13.3869 15.9973 13.3313 15.9987C13.3037 15.9994 13.282 15.9998 13.2678 15.9999L13.2524 16L13.2493 16.0001L12.4996 16.0001L12.4997 17.5001L13.2498 17.5001L13.2496 16.7501Z"/>\n<path d="M6.75 2.75005C6.74995 2.00005 6.74982 2.00005 6.74982 2.00005L6.74853 2.00005L6.74622 2.00006L6.73903 2.00009L6.71478 2.0003C6.69446 2.00053 6.66594 2.00098 6.63087 2.00185C6.56099 2.0036 6.46364 2.00707 6.35217 2.01402C6.14071 2.02722 5.83458 2.05536 5.56688 2.12276C5.17006 2.22267 4.82913 2.40399 4.55943 2.67392C4.29196 2.94161 4.13085 3.26001 4.03519 3.5803C3.85377 4.18776 3.88516 4.89393 3.92723 5.49256C3.93706 5.6324 3.94768 5.76849 3.95804 5.90131C3.99605 6.38849 4.03062 6.83163 4.01013 7.25369C3.98451 7.78147 3.87445 8.13279 3.67746 8.3656C3.45492 8.6286 3.18386 8.79405 2.95851 8.89436C2.84732 8.94386 2.75258 8.97509 2.68931 8.99319C2.65789 9.00219 2.63488 9.00776 2.62229 9.01062L2.61279 9.01269L2 9.12173V9.75005H4.40205C4.54555 9.63123 4.6879 9.49364 4.82254 9.33451C5.33063 8.73405 5.47613 7.99036 5.50837 7.32643C5.53396 6.79933 5.48918 6.23163 5.44995 5.73429C5.44047 5.61404 5.4313 5.49785 5.42354 5.3874C5.37987 4.76596 5.37961 4.32043 5.47246 4.00956C5.51394 3.87069 5.56644 3.78828 5.62053 3.73414C5.6724 3.68223 5.76099 3.6207 5.93312 3.57736C6.06245 3.5448 6.25632 3.52293 6.4456 3.51111C6.5345 3.50556 6.61271 3.50277 6.6683 3.50139C6.69595 3.5007 6.71765 3.50036 6.73185 3.5002L6.74724 3.50007L6.75029 3.50005L7.50005 3.5L7.49995 2L6.74982 2.00005L6.75 2.75005Z"/>\n<path d="M6.75 16.7501C6.74995 17.5001 6.74982 17.5001 6.74982 17.5001L6.74853 17.5001L6.74622 17.5001L6.73903 17.5L6.71478 17.4998C6.69446 17.4996 6.66594 17.4991 6.63087 17.4983C6.56099 17.4965 6.46364 17.493 6.35217 17.4861C6.14071 17.4729 5.83458 17.4448 5.56688 17.3774C5.17006 17.2774 4.82913 17.0961 4.55943 16.8262C4.29196 16.5585 4.13085 16.2401 4.03519 15.9198C3.85377 15.3124 3.88516 14.6062 3.92723 14.0076C3.93706 13.8677 3.94768 13.7316 3.95804 13.5988C3.99605 13.1116 4.03062 12.6685 4.01013 12.2464C3.98451 11.7186 3.87445 11.3673 3.67746 11.1345C3.45492 10.8715 3.18386 10.7061 2.95851 10.6058C2.84732 10.5563 2.75258 10.525 2.68931 10.5069C2.65789 10.4979 2.63488 10.4924 2.62229 10.4895L2.61279 10.4874L2 10.3784V9.75005H4.40205C4.54555 9.86887 4.6879 10.0065 4.82254 10.1656C5.33063 10.7661 5.47613 11.5098 5.50837 12.1737C5.53396 12.7008 5.48918 13.2685 5.44995 13.7658C5.44047 13.8861 5.4313 14.0023 5.42354 14.1127C5.37987 14.7341 5.37961 15.1797 5.47246 15.4906C5.51394 15.6294 5.56644 15.7118 5.62053 15.766C5.6724 15.8179 5.76099 15.8794 5.93312 15.9228C6.06245 15.9553 6.25632 15.9772 6.4456 15.989C6.5345 15.9945 6.61271 15.9973 6.6683 15.9987C6.69595 15.9994 6.71765 15.9998 6.73185 15.9999L6.74724 16L6.75029 16.0001L7.50005 16.0001L7.49995 17.5001L6.74982 17.5001L6.75 16.7501Z"/>\n</svg>\n',previewMergeFieldsIcon='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n<circle cx="9.00037" cy="9.79993" r="1.5"/>\n<path d="M5.75024 2.75005C5.75019 2.00005 5.75006 2.00005 5.75006 2.00005L5.74877 2.00005L5.74647 2.00006L5.73927 2.00009L5.71503 2.0003C5.6947 2.00053 5.66619 2.00098 5.63111 2.00185C5.56123 2.0036 5.46388 2.00707 5.35241 2.01402C5.14095 2.02722 4.83482 2.05536 4.56712 2.12276C4.1703 2.22267 3.82938 2.40399 3.55967 2.67392C3.29221 2.94161 3.1311 3.26001 3.03544 3.5803C2.85401 4.18776 2.8854 4.89393 2.92747 5.49256C2.9373 5.6324 2.94792 5.76849 2.95828 5.90131C2.99629 6.38849 3.03087 6.83163 3.01038 7.25369C2.98475 7.78147 2.87469 8.13279 2.6777 8.3656C2.45517 8.6286 2.1841 8.79405 1.95875 8.89436C1.84756 8.94386 1.75282 8.97509 1.68956 8.99319C1.65813 9.00219 1.63513 9.00776 1.62253 9.01062L1.61304 9.01269L1.00024 9.12173V9.75005H3.4023C3.54579 9.63123 3.68814 9.49364 3.82278 9.33451C4.33087 8.73405 4.47638 7.99036 4.50861 7.32643C4.5342 6.79933 4.48942 6.23163 4.4502 5.73429C4.44071 5.61404 4.43155 5.49785 4.42378 5.3874C4.38011 4.76596 4.37986 4.32043 4.4727 4.00956C4.51418 3.87069 4.56668 3.78828 4.62078 3.73414C4.67264 3.68223 4.76124 3.6207 4.93336 3.57736C5.06269 3.5448 5.25656 3.52293 5.44585 3.51111C5.53475 3.50556 5.61296 3.50277 5.66854 3.50139C5.6962 3.5007 5.71789 3.50036 5.73209 3.5002L5.74748 3.50007L5.75054 3.50005L6.5003 3.5L6.50019 2L5.75006 2.00005L5.75024 2.75005Z"/>\n<path d="M5.75024 16.7501C5.75019 17.5001 5.75006 17.5001 5.75006 17.5001L5.74877 17.5001L5.74647 17.5001L5.73927 17.5L5.71503 17.4998C5.6947 17.4996 5.66619 17.4991 5.63111 17.4983C5.56123 17.4965 5.46388 17.493 5.35241 17.4861C5.14095 17.4729 4.83482 17.4448 4.56712 17.3774C4.1703 17.2774 3.82938 17.0961 3.55967 16.8262C3.29221 16.5585 3.1311 16.2401 3.03544 15.9198C2.85401 15.3124 2.8854 14.6062 2.92747 14.0076C2.9373 13.8677 2.94792 13.7316 2.95828 13.5988C2.99629 13.1116 3.03087 12.6685 3.01038 12.2464C2.98475 11.7186 2.87469 11.3673 2.6777 11.1345C2.45517 10.8715 2.1841 10.7061 1.95875 10.6058C1.84756 10.5563 1.75282 10.525 1.68956 10.5069C1.65813 10.4979 1.63513 10.4924 1.62253 10.4895L1.61304 10.4874L1.00024 10.3784V9.75005H3.4023C3.54579 9.86887 3.68814 10.0065 3.82278 10.1656C4.33087 10.7661 4.47638 11.5098 4.50861 12.1737C4.5342 12.7008 4.48942 13.2685 4.4502 13.7658C4.44071 13.8861 4.43155 14.0023 4.42378 14.1127C4.38011 14.7341 4.37986 15.1797 4.4727 15.4906C4.51418 15.6294 4.56668 15.7118 4.62078 15.766C4.67264 15.8179 4.76124 15.8794 4.93336 15.9228C5.06269 15.9553 5.25656 15.9772 5.44585 15.989C5.53475 15.9945 5.61296 15.9973 5.66854 15.9987C5.6962 15.9994 5.71789 15.9998 5.73209 15.9999L5.74748 16L5.75054 16.0001L6.5003 16.0001L6.50019 17.5001L5.75006 17.5001L5.75024 16.7501Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12.2514 2.00005L12.2501 2.00005L11.5 2L11.4999 3.5L12.2496 3.50005L12.2527 3.50007L12.2681 3.5002C12.2823 3.50036 12.304 3.5007 12.3316 3.50139C12.3872 3.50277 12.4654 3.50556 12.5543 3.51111C12.7436 3.52293 12.9375 3.5448 13.0668 3.57736C13.2389 3.6207 13.3275 3.68223 13.3794 3.73414C13.4335 3.78828 13.486 3.87069 13.5275 4.00956C13.6203 4.32043 13.6201 4.76596 13.5764 5.3874C13.5686 5.49785 13.5595 5.61404 13.55 5.73429C13.5108 6.23163 13.466 6.79933 13.4916 7.32643C13.5238 7.99036 13.6693 8.73405 14.1774 9.33451C14.312 9.49364 14.4544 9.63123 14.5979 9.75005C14.4544 9.86887 14.312 10.0065 14.1774 10.1656C13.7121 10.7154 13.5509 11.3854 13.5023 12.0042C13.6011 12.0012 13.7003 11.9997 13.7999 11.9997C14.208 11.9997 14.6093 12.0247 15.0018 12.0729C15.0416 11.6402 15.1479 11.3408 15.3225 11.1345C15.545 10.8715 15.8161 10.7061 16.0414 10.6058C16.1526 10.5563 16.2474 10.525 16.3106 10.5069C16.342 10.4979 16.365 10.4924 16.3776 10.4895L16.3871 10.4874L16.9999 10.3784V9.75005V9.12173L16.3871 9.01269L16.3776 9.01062C16.365 9.00776 16.342 9.00219 16.3106 8.99319C16.2474 8.97509 16.1526 8.94386 16.0414 8.89436C15.8161 8.79405 15.545 8.6286 15.3225 8.3656C15.1255 8.13279 15.0154 7.78147 14.9898 7.25369C14.9693 6.83163 15.0039 6.38849 15.0419 5.90131C15.0523 5.76849 15.0629 5.6324 15.0727 5.49256C15.1148 4.89393 15.1462 4.18776 14.9647 3.5803C14.8691 3.26001 14.708 2.94161 14.4405 2.67392C14.1708 2.40399 13.8299 2.22267 13.433 2.12276C13.1654 2.05536 12.8592 2.02722 12.6478 2.01402C12.5363 2.00707 12.4389 2.0036 12.3691 2.00185C12.334 2.00098 12.3055 2.00053 12.2851 2.0003L12.2609 2.00009L12.2537 2.00006L12.2514 2.00005Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M9.00335 17.2062L9.00308 17.2065C8.7234 17.5118 8.24919 17.5327 7.94372 17.2532C7.63816 16.9735 7.61716 16.4991 7.89681 16.1935L8.45008 16.6999C7.89681 16.1935 7.89697 16.1934 7.89713 16.1932L7.89751 16.1928L7.89844 16.1918L7.90098 16.189L7.90879 16.1806L7.93517 16.1526C7.95746 16.1292 7.98914 16.0963 8.02971 16.0555C8.11079 15.9738 8.22768 15.8597 8.37644 15.724C8.6732 15.4532 9.10079 15.0927 9.62744 14.7314C10.6647 14.0198 12.1659 13.2499 13.8501 13.2499C15.5343 13.2499 17.0355 14.0198 18.0727 14.7314C18.5994 15.0927 19.027 15.4532 19.3237 15.724C19.4725 15.8597 19.5894 15.9738 19.6705 16.0555C19.711 16.0963 19.7427 16.1292 19.765 16.1526L19.7914 16.1806L19.7992 16.189L19.8017 16.1918L19.8027 16.1928L19.803 16.1932C19.8032 16.1934 19.8034 16.1935 19.2501 16.6999L19.8034 16.1935C20.083 16.4991 20.062 16.9735 19.7565 17.2532C19.4511 17.5326 18.9772 17.5118 18.6975 17.207L18.6971 17.2065L18.6968 17.2062L18.6945 17.2037L18.6783 17.1865C18.6629 17.1704 18.6386 17.1452 18.6059 17.1123C18.5404 17.0463 18.4414 16.9494 18.3127 16.8321C18.0546 16.5966 17.6814 16.282 17.2242 15.9683C16.9805 15.8012 16.7185 15.6381 16.4421 15.4883C16.7016 15.9322 16.8502 16.4487 16.8502 16.9999C16.8502 18.6567 15.5071 19.9999 13.8502 19.9999C12.1934 19.9999 10.8502 18.6567 10.8502 16.9999C10.8502 16.4486 10.9989 15.932 11.2584 15.4881C10.9819 15.6379 10.7198 15.8011 10.476 15.9683C10.0188 16.282 9.64555 16.5966 9.38746 16.8321C9.25879 16.9494 9.15975 17.0463 9.09425 17.1123C9.06153 17.1452 9.03726 17.1704 9.02192 17.1865L9.00572 17.2037L9.00335 17.2062Z"/>\n<circle cx="14.8253" cy="16.1749" r="1.125" fill="white"/>\n</svg>\n';class MergeFieldsUI extends Plugin{static get requires(){return["Mention",MergeFieldsEditing,ContextualBalloon,Widget]}static get pluginName(){return"MergeFieldsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._balloonPanelView=null,this._removeMenuBarButtonIfUnnecessary(),this._setupMentionConfiguration()}init(){const e=this.editor;e.ui.componentFactory.add("insertMergeField",(t=>{const n=createInsertMergeFieldDropdown(t);return n.bind("isEnabled").toMany([e.commands.get("insertMergeField"),e.commands.get("insertMergeFieldBlock")],"isEnabled",((...e)=>e.some((e=>e)))),n.once("change:isOpen",(()=>{const i={insertInline:e.commands.get("insertMergeField"),insertBlock:e.commands.get("insertMergeFieldBlock")},r=createMergeFieldsListView(t,e.config.get("mergeFields.definitions"),i);r.delegate("execute").to(n),n.on("execute",((t,n)=>{const i=e.plugins.get("MergeFieldsEditing").getMergeFieldType(n);e.execute("text"===i?"insertMergeField":"insertMergeFieldBlock",n),e.editing.view.focus()}));const s=createMergeFieldsSearchTextView(t,r);n.panelView.children.add(s),n.on("change:isOpen",((e,t,n)=>{n&&s.reset()}))})),n})),e.ui.componentFactory.add("menuBar:insertMergeField",(t=>{const n=new MenuBarMenuView(t);n.buttonView.set({label:getTranslation$6(t,"Merge field"),icon:insertMergeFieldIcon}),n.bind("isEnabled").toMany([e.commands.get("insertMergeField"),e.commands.get("insertMergeFieldBlock")],"isEnabled",((...e)=>e.some((e=>e))));const i=[],r=new MenuBarMenuListView(t),s={insertInline:e.commands.get("insertMergeField"),insertBlock:e.commands.get("insertMergeFieldBlock")};for(const o of e.config.get("mergeFields.definitions"))if("groupId"in o){const e=new MenuBarMenuListItemView(t,n),i=createMenuBarSubmenu(t,o,s);e.children.add(i),i.delegate("execute").to(n),r.items.add(e)}else i.push(o);if(i.length)if(0===r.items.length)for(const s of i){const i=createMenuBarListItem(t,s,n,"text"===e.plugins.get("MergeFieldsEditing").getMergeFieldType(s.id)?e.commands.get("insertMergeField"):e.commands.get("insertMergeFieldBlock"));r.items.add(i)}else{const e=new MenuBarMenuListItemView(t,n),o=createMenuBarSubmenu(t,{groupId:"Other",definitions:i},s);e.children.add(o),o.delegate("execute").to(n),r.items.add(e)}return n.panelView.children.add(r),n.on("execute",((t,n)=>{const i=e.plugins.get("MergeFieldsEditing").getMergeFieldType(n);e.execute("text"===i?"insertMergeField":"insertMergeFieldBlock",n),e.editing.view.focus()})),n}));const t=e.config.get("mergeFields.previewModes"),n=[];if(t.includes("$labels")&&n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:getTranslation$6(this.editor.locale,"Labels"),commandValue:"$labels"})}),t.includes("$defaultValues")&&n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:getTranslation$6(this.editor.locale,"Default values"),commandValue:"$defaultValues"})}),t.includes("$dataSets")){const t=e.config.get("mergeFields.dataSets");if(t.length)for(const e of t)n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:e.label||e.id,commandValue:e.id})})}e.ui.componentFactory.add("previewMergeFields",(t=>{const i=e.commands.get("previewMergeFields"),r=new Collection;for(const e of cloneDeep(n))e.model.bind("isOn").to(i,"value",(t=>t===e.model.commandValue)),r.add(e);const s=createDropdown(t),o=getTranslation$6(t,"Merge fields preview");return s.bind("isEnabled").to(i),addListToDropdown(s,r,{ariaLabel:o,role:"menu"}),s.set({class:"ck-merge-fields-preview-dropdown"}),s.buttonView.set({label:o,ariaLabel:o,ariaLabelledBy:void 0,isOn:!1,icon:previewMergeFieldsIcon,tooltip:!0}),this.listenTo(s,"execute",(t=>{const{commandValue:n}=t.source;e.execute("previewMergeFields",n),e.editing.view.focus()})),s})),e.ui.componentFactory.add("menuBar:previewMergeFields",(t=>{const i=new MenuBarMenuView(t),r=e.commands.get("previewMergeFields");i.buttonView.set({label:getTranslation$6(t,"Merge fields preview"),icon:previewMergeFieldsIcon}),i.bind("isEnabled").to(r);const s=new MenuBarMenuListView(t);s.set({ariaLabel:getTranslation$6(t,"Merge fields preview")});for(const o of cloneDeep(n)){const n=new MenuBarMenuListItemView(t,i),a=new MenuBarMenuListItemButtonView(t);o.model.bind("isOn").to(r,"value",(e=>e===o.model.commandValue)),a.isToggleable=!0,a.bind(...Object.keys(o.model)).to(o.model),a.delegate("execute").to(i),a.on("execute",(t=>{const{commandValue:n}=t.source;e.execute("previewMergeFields",n),e.editing.view.focus()})),n.children.add(a),s.items.add(n)}return i.panelView.children.add(s),i})),this._balloon=e.plugins.get(ContextualBalloon),this.listenTo(e.ui,"update",(()=>{this._updateBalloonVisibility()}),{priority:"low"}),this.listenTo(e.ui.focusTracker,"change:isFocused",((e,t,n)=>{this._balloon.visibleView&&this._balloon.visibleView===this._balloonPanelView&&(n?this._updateBalloonVisibility():this._hideBalloon())}),{priority:"low"}),this.editor.once("ready",this._overrideMentionExecuteListener.bind(this)),this.licenseKey=this.editor.config.get("licenseKey");const i=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in i){const n=t,r=i[n];if("mergeFieldsLicenseKeyValid"==r||"mergeFieldsLicenseKeyInvalid"==r||"mergeFieldsLicenseKeyExpired"==r||"mergeFieldsLicenseKeyDomainLimit"==r||"mergeFieldsLicenseKeyNotAllowed"==r||"mergeFieldsLicenseKeyEvaluationLimit"==r||"mergeFieldsLicenseKeyTrialLimit"==r||"mergeFieldsLicenseKeyDevelopmentLimit"==r||"mergeFieldsLicenseKeyUsageLimit"==r){delete i[n],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"mergeFieldsLicenseKeyInvalid"==e&&i._showLicenseError("invalid"),"mergeFieldsLicenseKeyExpired"==e&&i._showLicenseError("expired"),"mergeFieldsLicenseKeyDomainLimit"==e&&i._showLicenseError("domainLimit"),"mergeFieldsLicenseKeyNotAllowed"==e&&i._showLicenseError("featureNotAllowed","MergeFields"),"mergeFieldsLicenseKeyEvaluationLimit"==e&&i._showLicenseError("evaluationLimit"),"mergeFieldsLicenseKeyTrialLimit"==e&&i._showLicenseError("trialLimit"),"mergeFieldsLicenseKeyDevelopmentLimit"==e&&i._showLicenseError("developmentLimit"),"mergeFieldsLicenseKeyUsageLimit"==e&&i._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_updateBalloonVisibility(){const e=this.editor.editing.view.document.selection.getSelectedElement(),t=!(!e||!e.getCustomProperty("mergeFieldStatus"));if(this._balloon.visibleView&&this._balloon.visibleView===this._balloonPanelView)if(t){const t=e.getCustomProperty("mergeFieldStatus");this._balloonPanelView.text=getTranslation$6(this.editor.locale,t),this._balloon.updatePosition(this._getBalloonPositionData())}else this._hideBalloon();else if(t){const t=e.getCustomProperty("mergeFieldStatus");this._showBalloon(getTranslation$6(this.editor.locale,t))}}_showBalloon(e){this._balloonPanelView||(this._balloonPanelView=new MergeFieldsPanelView(this.editor.locale),this._balloonPanelView.text=e),this._balloon.hasView(this._balloonPanelView)||this._balloon.add({stackId:"mergeFieldsBalloon",view:this._balloonPanelView,position:this._getBalloonPositionData()})}_getBalloonPositionData(){const e=this.editor.editing.view;return{target:()=>{const t=e.document.selection.getFirstRange(),n=e.domConverter.mapViewToDom(t.getContainedElement());return n?Array.from(n.getClientRects())[0]:e.domConverter.viewRangeToDom(t)}}}_hideBalloon(){this._balloon.remove(this._balloonPanelView)}_removeMenuBarButtonIfUnnecessary(){const e=this.editor.config;if(e.get("mergeFields.previewModes")){const n=e.get("mergeFields.previewModes");1===n.length&&(n.includes("$dataSets")?1===e.get("mergeFields.dataSets").length&&t():t())}function t(){const t=e.get("menuBar.removeItems");t?(t.push("menuBar:previewMergeFields"),e.set("menuBar.removeItems",t)):e.set("menuBar.removeItems",["menuBar:previewMergeFields"])}}_setupMentionConfiguration(){const e=this.editor,t=e.config.get("mention.feeds"),n=e.config.get("mergeFields.prefix");t.push({marker:n.charAt(0),dropdownLimit:10,feed:t=>{if(t.slice(0,n.length-1)!==n.slice(1))return[];const i=t&&t.toLowerCase().slice(n.length-1);return e.plugins.get("MergeFieldsEditing").flattenedMergeFieldDefinitions.filter((t=>{const n=e.commands.get("insertMergeField").isEnabled,r=e.commands.get("insertMergeFieldBlock").isEnabled,s=e.plugins.get("MergeFieldsEditing").getMergeFieldType(t.id);return!("text"===s&&!n)&&(!("block"===s&&!r)&&e.plugins.get("MergeFieldsEditing").getLabel(t.id).toLowerCase().includes(i))}))},itemRenderer:e=>{const t=document.createElement("button");return t.innerHTML=""+(e.label||e.id),t}}),e.config.set("mention.feeds",t)}_overrideMentionExecuteListener(){const e=this.editor;e.commands.get("mention").on("execute",((t,n)=>{const i=n[0];i.marker===e.config.get("mergeFields.prefix").charAt(0)&&e.model.change((n=>{n.remove(i.range),"text"===e.plugins.get("MergeFieldsEditing").getMergeFieldType(i.mention.id)?e.execute("insertMergeField",i.mention.id):e.execute("insertMergeFieldBlock",i.mention.id,!1),t.stop()}))}),{priority:"high"})}}function createInsertMergeFieldDropdown(e){const t=createDropdown(e);return t.set({class:"ck-insert-merge-field-dropdown",isEnabled:!0}),t.buttonView.set({label:getTranslation$6(e,"Insert merge field"),icon:insertMergeFieldIcon,tooltip:!0}),t}function createMergeFieldsListView(e,t,n){const i=new MergeFieldsListView(e),r=[],s=[];for(const o of t)if("groupId"in o){const t=createMergeFieldsGroupView(e,o.groupLabel||o.groupId,o.definitions,n);t.delegate("execute").to(i),s.push(t)}else r.push(o);if(r.length){const t=createMergeFieldsGroupView(e,"Other",r,n);t.delegate("execute").to(i),s.push(t)}return i.items.addMany(s),i}function createMergeFieldsGroupView(e,t,n,i){const r=new ListItemGroupView(e,new LabelWithHighlightView);r.label=t;for(const t of n){const n=createMergeFieldListItemView(e,t,"block"===t.type?i.insertBlock:i.insertInline);n.delegate("execute").to(r),r.items.add(n)}return r}function createMergeFieldListItemView(e,t,n){const i=new ListItemView(e),r=new ButtonLabelWithHighlightView,s=new ButtonView(e,r);return i.children.add(s),s.set({label:t.label||t.id,withText:!0}),s.bind("isEnabled").to(n),s.on("execute",(()=>{i.fire("execute",t.id)})),i}function createMergeFieldsSearchTextView(e,t){return new SearchTextView(e,{filteredView:t,queryView:{label:getTranslation$6(e,"Search merge field")},class:"ck-merge-fields-search",infoView:{text:{notFound:{primary:getTranslation$6(e,"No merge fields found")},noSearchableItems:{primary:getTranslation$6(e,"No merge fields available")}}}})}function createMenuBarSubmenu(e,t,n){const i=new MenuBarMenuView(e),r=new MenuBarMenuListView(e);for(const s of t.definitions){const t=createMenuBarListItem(e,s,i,"block"===s.type?n.insertBlock:n.insertInline);r.items.add(t)}return i.set({class:"ck-menu-bar__merge-fields-submenu"}),i.buttonView.set({label:t.groupLabel||t.groupId}),i.panelView.children.add(r),i}function createMenuBarListItem(e,t,n,i){const r=new MenuBarMenuListItemView(e,n),s=new MenuBarMenuListItemButtonView(e);return s.set({label:t.label||t.id}),r.delegate("execute").to(n),r.children.add(s),s.bind("isEnabled").to(i),s.on("execute",(()=>{r.fire("execute",t.id)})),r}class MergeFields extends Plugin{static get requires(){return[MergeFieldsEditing,MergeFieldsUI]}static get pluginName(){return"MergeFields"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}const COLUMN_GAP=100,EDITING_RENDER_TIMEOUT=200;class PaginationLookup extends Plugin{constructor(){super(...arguments),this._recalculatePageBreaksDebounced=debounce((()=>this._recalculatePageBreaks()),EDITING_RENDER_TIMEOUT),this._pagesContainer=null}static get pluginName(){return"PaginationLookup"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){if(this.set({pageBreaks:[]}),!this.editor.config.get("pagination"))return void logWarning("pagination-config-not-found",this.editor.config);const e=this.editor.plugins.get("PaginationEditing");this.bind("isEnabled").to(e),this.editor.ui.once("ready",(()=>this._onUiReady())),this.on("change:isEnabled",((e,t,n)=>{n&&this._recalculatePageBreaksDebounced()}))}afterInit(){checkLicense$5(this)}destroy(){super.destroy(),this._pagesContainer&&(this._recalculatePageBreaksDebounced.cancel(),this._pagesContainer.destroy(),this._pagesContainer.element.remove())}_onUiReady(){const e=this.editor,t=e.editing.view,n=this._getAttachedDomRoot();if(!n||0===n.childElementCount)return void e.ui.once("update",(()=>this._onUiReady()));const{pageWidth:i,pageHeight:r}=e.config.get("pagination"),{top:s,left:o,bottom:a,right:c}=this._configuredPaddings;this._pagesContainer=new View(e.locale);const l=this._pagesContainer;l.set("class",""),l.setTemplate({tag:"div",attributes:{contenteditable:!0,style:{columnWidth:i,width:i,height:"calc( "+r+" - "+s+" - "+a+" )",minWidth:"auto",minHeight:"auto",padding:"0 "+c+" 0 "+o,columnGap:COLUMN_GAP+"px",border:0,boxSizing:"border-box",columnCount:"auto",columnFill:"auto",overflow:"hidden",position:"absolute",top:"-99999px",left:"-99999px"},tabindex:"-1",class:l.bindTemplate.to("class")}}),l.render(),n.parentNode.insertBefore(l.element,n.nextSibling),this.listenTo(t,"render",(()=>this._recalculatePageBreaksDebounced()),{priority:"low"}),this._recalculatePageBreaksDebounced()}_getAttachedDomRoot(){for(const e of this.editor.editing.view.domRoots.values())if(e.ownerDocument.body.contains(e))return e;return null}_recalculatePageBreaks(){if(!this.isEnabled)return Promise.resolve();const e=this.editor.editing.view,t=this._pagesContainer,n=this._getAttachedDomRoot();if(!n)return Promise.resolve();for(t.class=["ck-reset","ck-pagination-view",...n.classList].join(" ");t.element.firstChild;)t.element.firstChild.remove();const i=Array.from(e.domRoots);i.sort((([,e],[,t])=>e.compareDocumentPosition(t)==Node.DOCUMENT_POSITION_PRECEDING?1:-1));for(const[e,n]of i){const i=n.cloneNode(!0);"attributeStyleMap"in i&&i.attributeStyleMap.clear(),i.className="",i.removeAttribute("id"),i.dataset.rootName=e,t.element.append(i)}return allImagesAreReady(Array.from(t.element.querySelectorAll("img"))).then((()=>this._updatePageBreaksData()))}_updatePageBreaksData(){const e=this._pagesContainer.element;if(!e.ownerDocument.body.contains(e))return;const t=new Rect(e).excludeScrollbarsAndBorders(),n=_0x56a4f4.window.getComputedStyle(e),i=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),r=Math.floor(t.width+COLUMN_GAP-i),s=findPageStarterInfos(e,Math.floor(t.left-e.scrollLeft),r,t.height).map((e=>this._mapPageStarterInfoToPageBreakInfo(e)));s.every((e=>!!e))&&(this.pageBreaks=s)}_mapPageStarterInfoToPageBreakInfo(e){const t=this.editor.editing.view,n=this.editor.editing.mapper,i=t.domConverter,r=e.path.shift(),s=this._pagesContainer.element.childNodes[r].dataset.rootName,o=t.getDomRoot(s);if(!o)return null;const a=pageElementToViewElement(o,e);if(!a)return null;const c=i.domPositionToView(a,e.textOffset||0);return c?"manual"==e.type?this._mapManualPageStarterInfoToPageBreakInfo(c,a):"text"==e.type&&n.toModelPosition(c).offset?this._mapTextPageStarterInfoToPageBreakInfo(c,a,e.textOffset):this._mapElementPageStarterInfoToPageBreakInfo(c,a,e.offset):null}_mapManualPageStarterInfoToPageBreakInfo(e,t){const n=this.editor.model,i=this.editor.editing.mapper.toModelElement(e.parent),r=n.createRangeOn(i);return new PageBreakInfo({type:"manual",modelRange:r,domNode:t,offset:0})}_mapTextPageStarterInfoToPageBreakInfo(e,t,n){const i=this.editor.model,r=this.editor.editing.mapper,s=this.editor.editing.view.domConverter;if(n>=t.length)return null;const o=r.toModelPosition(e),a=i.createRange(o),c=r.findMappedViewAncestor(e),l=s.mapViewToDom(c);return new PageBreakInfo({type:"text",modelRange:a,domNode:t,offset:findOffsetTopForTextOffset(t,n,l)})}_mapElementPageStarterInfoToPageBreakInfo(e,t,n){const i=this.editor.model,r=this.editor.editing,s=r.mapper,o=r.view.domConverter,a=s.findMappedViewAncestor(e),c=s.toModelElement(a),l=getTopMostParentBlockTouchingPosition(i.createPositionBefore(c))||c;let d=s.toViewElement(l),u=i.createRangeOn(l);const h=i.createPositionBefore(l).nodeBefore;if(h&&h.is("element","imageBlock")){const e=s.toViewElement(h),t=o.mapViewToDom(e),n=_0x56a4f4.window.getComputedStyle(t).float;"left"!=n&&"right"!=n||(u=i.createRangeOn(h))}for(;d.parent!==d.root&&0===d.index;)d=d.parent;const m=new Rect(isHTMLElement(t)?t:createDomRangeOn(t)),g=n?m.height-n:0,p=o.mapViewToDom(d),f=new Rect(p);return new PageBreakInfo({type:"element",modelRange:u,domNode:p,offset:Math.round(g)?g+m.top-f.top:0})}get _configuredPaddings(){const e=this.editor.config.get("pagination.pageMargins");return Object.assign({top:"10mm",bottom:"10mm",left:"10mm",right:"10mm"},e)}static _findPageStarterInfos(e,t,n,i,r){return findPageStarterInfos(e,t,n,i,r)}}class PageBreakInfo{constructor({type:e,modelRange:t,domNode:n,offset:i}){this.type=e,this.modelRange=t,this._domNode=n,this._offset=i}get offset(){if(!this._domNode.ownerDocument.body.contains(this._domNode))return 0;const e=new Rect(isHTMLElement(this._domNode)?this._domNode:createDomRangeOn(this._domNode));return"manual"==this.type?e.top+e.height/2:e.top+this._offset}}function isPageBreak(e){return!(!e||!isHTMLElement(e))&&Boolean(e.classList.contains("page-break")||e.closest(".page-break"))}function pageElementToViewElement(e,t){let n=e;for(const e of t.path){if(!n)return null;n=n.childNodes[e]}return n}function findOffsetTopForTextOffset(e,t,n){const i=createDomRangeOn(e),r=createDomRangeIn(n);let s;s=0==t?createDomRangeMultiNode(r.startContainer,r.startOffset,e.parentNode,Array.from(e.parentNode.childNodes).indexOf(e)):createDomRangeMultiNode(r.startContainer,r.startOffset,e,t);const o=createDomRangeMultiNode(e,t,r.endContainer,r.endOffset),a=new Rect(s).bottom;return(new Rect(o).top+a)/2-new Rect(i).top}function getTopMostParentBlockTouchingPosition(e){const t=e.parent,n=t.root.document.model,i=t.getAncestors({parentFirst:!0,includeSelf:!0});let r=null;for(const t of i){if(t.is("rootElement"))return r;if(!n.createPositionBefore(t).isTouching(e))return r;r=t}}function allImagesAreReady(e){return Promise.all(e.map((e=>Promise.race([imageReady(e),timeout(1e3)]))))}function imageReady(e){return new Promise((t=>{function n(){e.removeEventListener("load",n),e.removeEventListener("error",n),t()}e.complete?t():(e.addEventListener("load",n),e.addEventListener("error",n))}))}function timeout(e){return new Promise((t=>setTimeout(t,e)))}function createDomRangeOn(e){const t=_0x56a4f4.document.createRange();return t.selectNode(e),t}function createDomRangeIn(e){const t=_0x56a4f4.document.createRange();return t.selectNodeContents(e),t}function createDomRange(e,t,n){const i=_0x56a4f4.document.createRange();return i.setStart(e,t),i.setEnd(e,n),i}function createDomRangeMultiNode(e,t,n,i){const r=_0x56a4f4.document.createRange();return r.setStart(e,t),r.setEnd(n,i),r}function findPageStarterInfos(e,t,n,i,r){const s=[];for(const[o,a]of e.childNodes.entries()){let e=[];isHTMLElement(a)&&a.offsetParent&&!a.style.position?e=findPageStartersInElementNode(a,o,t,n,i,r):isText(a)&&(e=findPageStartersInTextNode(a,o,t,n,r)),e.length&&(s.push(...e),t+=e.length*n,r=!1)}return s}function findPageStartersInElementNode(e,t,n,i,r,s){const o=[];if(isPageBreak(e.previousSibling)&&(o.push({type:"manual",offset:0,path:[t-1]}),s=!0),"table-row"==_0x56a4f4.window.getComputedStyle(e).display){let i=0,s=!1;for(const t of e.getClientRects())i+=t.height,t.left>=n&&(s=!0);if(i<r&&s)return o.push({type:"element",offset:0,path:[t]}),o}const a=e.closest("figure.image");if(a&&shouldIgnoreFigure(a)){const e=_0x56a4f4.window.getComputedStyle(a).float;if("left"==e||"right"==e)return o}const c=findPageStarterInfos(e,n,i,r,s);if(c.length){for(const e of c)o.push({type:e.type,offset:e.offset,textOffset:e.textOffset,path:[t,...e.path]}),n+=i,s=!1;return o}return o.push(...findPageStartersInLeafElementNode(e,t,n,i,s)),o}function findPageStartersInLeafElementNode(e,t,n,i,r){const s=[];if("table-cell"==_0x56a4f4.window.getComputedStyle(e).display)return[];const o=[];for(const t of e.getClientRects())if(t.left>=n){for(const e of o)e.height+=t.height;o.push({height:t.height}),n+=i}for(const e of o)r||s.push({type:"element",offset:e.height,textOffset:0,path:[t]}),r=!1;return s}function findPageStartersInTextNode(e,t,n,i,r){const s=createDomRangeOn(e),o=[];let a=0;for(const c of s.getClientRects())if(c.left>=n){const s=findLastTextOffsetOnPage(e,a,n,i);r||o.push({type:"text",path:[t],textOffset:s}),a=s,n+=i,r=!1}return o}function findLastTextOffsetOnPage(e,t,n,i){let r=t,s=e.length;for(;s-r>1;){const t=Math.ceil((r+s)/2);domRangeContainsPageBreak(createDomRange(e,r,t),n,i)?s=t:r=t}return r}function domRangeContainsPageBreak(e,t,n){for(const i of e.getClientRects())if(i.left>=t&&i.left<t+n)return!0;return!1}function shouldIgnoreFigure(e){let t=!1;const n=e.parentElement.dataset.rootName,i=e.nextElementSibling,r=e.previousElementSibling,s=i&&_0x56a4f4.window.getComputedStyle(i).float,o=i&&"ck-fake-selection-container"===i.className;return!n||i||r||(t=!0),n&&!r&&o&&(t=!0),n&&!r&&"none"!==s&&(t=!0),!t}function isHTMLElement(e){return e.nodeType==Node.ELEMENT_NODE}function isText(e){return e.nodeType==Node.TEXT_NODE}async function checkLicense$5(e){const t=g([97,104,107,112,80,71,52,73,77,51,87,48,86,65,115,89,117,90,53,106,119,75,49,83,67,74,109,121,98,99,55,81,100,118,54,110,84,108,116,102,111,76,88,105,113,57,72,122,56,66,114,85,120,101,79,50,69,78,68,82,70,103]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU2NDIyNzF9.eyJqdGkiOjk4NjQ4NDYzNzUsImFsZyI6IkVTMjU2IiwiaWR4IjoyNTY0MzAzMTIwOTQ5LCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiJiYzgyM2VkZi02ZGE4LTRmMDItYTk3Ny04NTZhMTMyNzQ3YzUiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NjQyMjcxLCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTY0Mn0.2e17MCcZg35hCNQcAROZ-N3DFcjs6G_nH1_bkSsnWOPJIJbCghWiHOxXcZgwaJVr1D5lt42SZKjJiJSDvkXKKQ"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([97]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,65,71])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}const toPx=toUnit("px");class LineView extends View{constructor(){super();const e=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null,pageNumber:null}),this.setTemplate({tag:"div",attributes:{"data-page-number":e.to("pageNumber"),class:["ck","ck-pagination-view-line",e.if("isVisible","ck-hidden",(e=>!e))],style:{left:e.to("left",(e=>toPx(e))),top:e.to("top",(e=>toPx(e))),width:e.to("width",(e=>toPx(e)))}}})}}class LinesRepository{constructor(e){this._visibleLines=new Set,this._hiddenLines=new Set,this._viewCollection=e.ui.view.body}destroy(){for(const e of this._hiddenLines)e.destroy()}cleanLines(){for(const e of this._visibleLines)e.isVisible=!1,this._hiddenLines.add(e);this._visibleLines.clear()}showLine(e,t,n,i){let r;this._hiddenLines.size?(r=first(this._hiddenLines.values()),this._hiddenLines.delete(r)):r=new LineView,r.set({pageNumber:i,left:e,top:t,width:n}),r.isVisible=!0,this._viewCollection.has(r)||this._viewCollection.add(r),this._visibleLines.add(r)}}const PLUGIN_ENABLED_CLASS="ck-pagination_enabled";class PaginationRenderer extends Plugin{constructor(){super(...arguments),this._scrollableEditingRootDomAncestor=null,this._resizeObserver=null}static get pluginName(){return"PaginationRenderer"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){this.set({pageNumber:1}),this._linesRepository=new LinesRepository(this.editor),this._scrollableEditingRootDomAncestor=null,this._resizeObserver=null,this._paginationLookupPlugin=this.editor.plugins.get("PaginationLookup"),this.bind("isEnabled").to(this.editor.plugins.get("PaginationEditing")),this.editor.ui.once("ready",(()=>this._onUiReady())),this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS),this.on("change:isEnabled",((e,t,n)=>{n||this._linesRepository.cleanLines(),this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS,n)}))}destroy(){this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS,!1),this._linesRepository.destroy(),this._scrollableEditingRootDomAncestor=null,this._resizeObserver&&this._resizeObserver.destroy()}scrollToPage(e){if(!this.isEnabled)return;const t=e>1?this._getPageBreakLineOffset(e-1):0;this._scrollableEditingRootDomAncestor.scrollTo({top:t-10,left:this._scrollableEditingRootDomAncestor.scrollLeft,behavior:env.isMotionReduced?"instant":"smooth"})}_onUiReady(){const e=this.editor,t=this._getAttachedDomRoot();t?(this._scrollableEditingRootDomAncestor=findScrollableElement(t),e.ui.view.listenTo(this._scrollableEditingRootDomAncestor,"scroll",(()=>{this._updatePageBreakLines()}),{usePassive:!0}),e.ui.view.listenTo(_0x56a4f4.window,"resize",(()=>this._updatePageBreakLines())),this._resizeObserver=new ResizeObserver(this._scrollableEditingRootDomAncestor,(()=>{this._updatePageBreakLines()})),this.listenTo(this._paginationLookupPlugin,"change:pageBreaks",(()=>this._updatePageBreakLines()))):e.ui.once("update",(()=>this._onUiReady()))}_getAttachedDomRoot(){for(const e of this.editor.editing.view.domRoots.values())if(e.ownerDocument.body.contains(e))return e;return null}_updatePageBreakLines(){if(!this.isEnabled)return;const e=this._getAttachedDomRoot(),t=this._paginationLookupPlugin.pageBreaks;if(this._linesRepository.cleanLines(),!e||1==t.length)return void(this.pageNumber=1);const n=new Rect(e).excludeScrollbarsAndBorders(),i=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders(),r=i.top+i.height/3;let s=!1;const o=[];for(let e=1;e<t.length;e++){const t=this._getPageBreakLineOffset(e,i);if(!t)continue;const a=i.top+t-this._scrollableEditingRootDomAncestor.scrollTop;o.push({pageOffsetTop:a,domRootRect:n,domScrollableRect:i,pageNumber:e}),a>r&&!s&&(this.pageNumber=e,s=!0)}this._renderPageBreakLines(o),s||(this.pageNumber=t.length)}_renderPageBreakLines(e){const{scrollX:t,scrollY:n}=_0x56a4f4.window;if(e.length)for(const{domScrollableRect:i,pageOffsetTop:r,domRootRect:s,pageNumber:o}of e)i.top<r&&r<i.bottom&&this._linesRepository.showLine(s.left+t,r+n,s.width,o+1)}_getPageBreakLineOffset(e,t=null){const n=this._paginationLookupPlugin.pageBreaks[e].offset;return n?(t||(t=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders()),n-t.top+this._scrollableEditingRootDomAncestor.scrollTop):0}_toggleEditingRootsClass(e,t=!0){const n=this.editor.editing.view;n.change((i=>{for(const r of n.document.roots)t?i.addClass(e,r):i.removeClass(e,r)}))}}function findScrollableElement(e){let t=e;do{t=t.parentElement;const e=_0x56a4f4.window.getComputedStyle(t).overflowY;if("auto"==e||"scroll"==e)break}while("BODY"!=t.tagName);return t}function getTranslation$5(e,t,...n){const i=e.t;switch(t){case"Go to next page":return i("Go to next page");case"Go to previous page":return i("Go to previous page");case"Current page number (from 1 to %0)":return i("Current page number (from 1 to %0)",...n);case"Keystrokes for navigating through documents":return i("Keystrokes for navigating through documents");case"Go to the previous page (also move selection)":return i("Go to the previous page (also move selection)");case"Go to the next page (also move selection)":return i("Go to the next page (also move selection)");default:return t}}class PaginationEditing extends Plugin{static get pluginName(){return"PaginationEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[PaginationLookup,PaginationRenderer]}init(){this.set({pageNumber:1,totalPages:1});const e=this.editor.plugins.get("Pagination"),t=this.editor.plugins.get(PaginationLookup),n=this.editor.plugins.get(PaginationRenderer);this.bind("isEnabled").to(e),this._setUpDataDowncastConversion(),this.bind("pageNumber").to(n),this.listenTo(t,"change:pageBreaks",((e,t,n,i)=>{this.totalPages=n.length,this._updatePageBreakMarkers(n,i)})),this._setupKeystrokes(),this.licenseKey=this.editor.config.get("licenseKey");const i=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in i){const n=t,r=i[n];if("paginationLicenseKeyValid"==r||"paginationLicenseKeyInvalid"==r||"paginationLicenseKeyExpired"==r||"paginationLicenseKeyDomainLimit"==r||"paginationLicenseKeyNotAllowed"==r||"paginationLicenseKeyEvaluationLimit"==r||"paginationLicenseKeyTrialLimit"==r||"paginationLicenseKeyDevelopmentLimit"==r||"paginationLicenseKeyUsageLimit"==r){delete i[n],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"paginationLicenseKeyInvalid"==e&&i._showLicenseError("invalid"),"paginationLicenseKeyExpired"==e&&i._showLicenseError("expired"),"paginationLicenseKeyDomainLimit"==e&&i._showLicenseError("domainLimit"),"paginationLicenseKeyNotAllowed"==e&&i._showLicenseError("featureNotAllowed","Pagination"),"paginationLicenseKeyEvaluationLimit"==e&&i._showLicenseError("evaluationLimit"),"paginationLicenseKeyTrialLimit"==e&&i._showLicenseError("trialLimit"),"paginationLicenseKeyDevelopmentLimit"==e&&i._showLicenseError("developmentLimit"),"paginationLicenseKeyUsageLimit"==e&&i._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}scrollToPage(e){this.isEnabled&&this.editor.plugins.get(PaginationRenderer).scrollToPage(this._validatePageNumber(e))}moveSelectionToPage(e){if(!this.isEnabled)return;const t=this.editor,n=this.editor.plugins.get(PaginationLookup).pageBreaks[e-1];n&&t.model.change((e=>{switch(n.type){case"manual":{const i=t.model.schema.getNearestSelectionRange(n.modelRange.end,"forward");e.setSelection(i);break}case"element":{const i=t.model.schema.getNearestSelectionRange(n.modelRange.start,"forward");e.setSelection(i);break}case"text":{const t=n.modelRange.start;if(" "===t.textNode.data[t.offset]){const n=e.createPositionAt(t.parent,t.offset+1);e.setSelection(n)}else e.setSelection(n.modelRange)}}t.editing.view.focus()}))}goToNextPage(){const e=this._validatePageNumber(this.pageNumber+1);this.moveSelectionToPage(e),this.scrollToPage(e)}goToPreviousPage(){const e=this._validatePageNumber(this.pageNumber-1);this.moveSelectionToPage(e),this.scrollToPage(e)}_updatePageBreakMarkers(e,t){const n=this.editor.model;this.isEnabled&&n.change((i=>{for(let t=1;t<e.length;t++){const r=e[t].modelRange,s="pagination:"+(t+1);n.markers.has(s)?i.updateMarker(s,{range:r}):i.addMarker(s,{range:r,usingOperation:!1,affectsData:!0})}for(let r=e.length;r<t.length;r++){const e="pagination:"+(r+1);n.markers.has(e)&&i.removeMarker(e)}}))}_setUpDataDowncastConversion(){this.editor.conversion.for("dataDowncast").add((e=>{e.on("addMarker:pagination",((e,{markerRange:t,markerName:n},i)=>{if(!i.options.pagination)return;if(!i.consumable.consume(t,e.name))return;const r=t.getContainedElement();let s=r?i.mapper.toViewElement(r):null;if(!s){const e=t.start;if(i.schema.checkChild(e,"$text")){const t=i.mapper.toViewPosition(e);s=i.writer.createContainerElement("span"),s.getFillerOffset=()=>null,i.writer.insert(t,s)}else{const t=e.nodeAfter;s=i.mapper.toViewElement(t)}}for(;s.parent!==s.root&&0===s.index;)s=s.parent;const o=n.substring(11);s.hasClass("page-break")||(i.writer.setStyle("page-break-before","always",s),i.writer.setAttribute("data-pagination-page",o,s),i.mapper.bindElementToMarker(s,n)),e.stop()}))}))}_setupKeystrokes(){const e=this.editor;e.keystrokes.set("Shift+Pageup",((e,t)=>{this.goToPreviousPage(),t()})),e.keystrokes.set("Shift+Pagedown",((e,t)=>{this.goToNextPage(),t()})),e.accessibility.addKeystrokeInfoGroup({id:"pagination",label:getTranslation$5(e.locale,"Keystrokes for navigating through documents"),keystrokes:[{label:getTranslation$5(e.locale,"Go to the previous page (also move selection)"),keystroke:"Shift+Pageup",mayRequireFn:!0},{label:getTranslation$5(e.locale,"Go to the next page (also move selection)"),keystroke:"Shift+Pagedown",mayRequireFn:!0}]})}_validatePageNumber(e){return e<1&&(e=1),e>this.totalPages&&(e=this.totalPages),e}}class PageNavigatorView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set({pageNumber:1,totalPages:1,isEnabled:!0}),this.pageNumberView=new InputNumberView(e,{min:1,step:1}),this.pageNumberView.set({inputMode:"numeric",tabIndex:-1}),this.pageNumberView.bind("ariaLabel").to(this,"totalPages",(t=>getTranslation$5(e,"Current page number (from 1 to %0)",t))),this.pageNumberView.bind("max").to(this,"totalPages"),this.pageNumberView.bind("isReadOnly").to(this,"isEnabled",(e=>!e)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-page-navigator",t.if("isEnabled","ck-disabled",(e=>!e))]},children:[this.pageNumberView,{tag:"span",children:[{text:t.to("totalPages")}]}]})}render(){super.render();const e=this.pageNumberView.element,t=e=>{this.pageNumberView.element.value=String(e)};t(this.pageNumber),this.on("change:pageNumber",((e,n,i)=>{t(i)})),this.listenTo(e,"keydown",((t,n)=>{if("ArrowUp"===n.key||"ArrowDown"===n.key)return void n.stopPropagation();if(n.keyCode!==keyCodes.enter)return;n.preventDefault();const i=e.valueAsNumber;Number.isNaN(i)?e.value=String(this.pageNumber):(e.checkValidity()?this.pageNumber=i:i>this.totalPages?(this.pageNumber=this.totalPages,e.value=String(this.totalPages)):(this.pageNumber=1,e.value="1"),this.fire("navigation",this.pageNumber))})),this.listenTo(e,"blur",(()=>{e.value=String(this.pageNumber)})),this.listenTo(e,"focus",(()=>{this.pageNumberView.select()}))}focus(){this.element.firstChild.focus()}}var arrowDownIcon$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 .75a9.25 9.25 0 110 18.5 9.25 9.25 0 010-18.5zm0 1.5a7.75 7.75 0 100 15.5 7.75 7.75 0 000-15.5zm0 2.022a.75.75 0 01.743.649l.007.101v8.165l2.714-2.705a.75.75 0 01.977-.07l.084.072a.75.75 0 01.07.976l-.072.084-3.994 3.981a.75.75 0 01-.975.073l-.084-.073-3.99-3.98a.75.75 0 01.975-1.135l.085.072 2.71 2.706V5.022a.75.75 0 01.75-.75z"/></svg>\n',arrowUpIcon$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 19.25a9.25 9.25 0 100-18.5 9.25 9.25 0 000 18.5zm0-1.5a7.75 7.75 0 110-15.5 7.75 7.75 0 010 15.5zm0-2.022a.75.75 0 00.743-.649l.007-.101V6.813l2.714 2.705a.75.75 0 00.977.07l.084-.072a.75.75 0 00.07-.976l-.072-.084-3.994-3.981a.75.75 0 00-.975-.073l-.084.073-3.99 3.98a.75.75 0 00.975 1.135l.085-.072 2.71-2.706v8.166c0 .414.336.75.75.75z"/></svg>\n';class PaginationUI extends Plugin{static get pluginName(){return"PaginationUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.plugins.get("PaginationEditing");e.ui.componentFactory.add("pageNavigation",(e=>{const n=new PageNavigatorView(e);return n.bind("pageNumber").to(t),n.bind("totalPages").to(t),n.bind("isEnabled").to(t),n.on("navigation",((e,n)=>{t.moveSelectionToPage(n),t.scrollToPage(n)})),n})),e.ui.componentFactory.add("nextPage",(n=>{const i=new ButtonView(n);return i.isEnabled=!0,i.label=getTranslation$5(e.locale,"Go to next page"),i.icon=arrowDownIcon$1,i.tooltip=!0,i.keystroke="Shift+PageDown",i.bind("isEnabled").to(t),this.listenTo(i,"execute",(()=>{t.goToNextPage()})),i})),e.ui.componentFactory.add("previousPage",(n=>{const i=new ButtonView(n);return i.isEnabled=!0,i.label=getTranslation$5(e.locale,"Go to previous page"),i.icon=arrowUpIcon$1,i.tooltip=!0,i.keystroke="Shift+PageUp",i.bind("isEnabled").to(t),this.listenTo(i,"execute",(()=>{t.goToPreviousPage()})),i}))}}class Pagination extends Plugin{static get pluginName(){return"Pagination"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[PaginationEditing,PaginationUI]}constructor(e){super(e),this.isEnabled=!1}init(){this.set({pageNumber:1,totalPages:1});const e=this.editor.plugins.get(PaginationEditing);this.bind("pageNumber").to(e),this.bind("totalPages").to(e),env.isBlink||this.editor.config.get("pagination.enableOnUnsupportedBrowsers")?this.editor.on("ready",(()=>{this.isEnabled=!0})):this.forceDisabled("browserCheck")}scrollToPage(e){this.editor.plugins.get(PaginationEditing).scrollToPage(e)}}const MS_EXCEL_META_REGEX=/<meta\s*name="?generator"?\s*content="?microsoft\s*excel\s*\d+"?\/?>/i;function isMSExcelContent(e){return MS_EXCEL_META_REGEX.test(e)}const CSS_SELECTOR_REGEX=/^(?<tagName>(?!\.)[\w-]+)?(\.(?<className>[\w-]+))?$/i;function getMatchingStyles(e,t){const n=new Map;for(const[i,r]of t){if(!i.tagName&&!i.className)continue;const t=!i.tagName||e.name===i.tagName,s=!i.className||e.hasClass(i.className);t&&s&&n.set(i,r)}return n}function extractStyles(e){const t={};for(const n of e)for(const e of n.cssRules)if(e instanceof CSSStyleRule){const n=parseCSSStyleDeclaration(e.style);t[e.selectorText]=Object.assign({},t[e.selectorText]||{},n)}return t}function expandStyles(e){const t=new Map;for(const n in e){const i=parseCSSSelector(n),r=e[n];for(const e of i)t.set(e,r)}return t}function parseCSSStyleDeclaration(e){const t={};for(let n=0;n<e.length;n++){const i=e[n],r=e.getPropertyValue(i);"initial"!==r&&(t[i]=r)}return t}function parseCSSSelector(e){const t=e.split(",").map((e=>e.trim())),n=[];for(const e of t){const t=CSS_SELECTOR_REGEX.exec(e);t&&n.push(t.groups)}return n}function flattenStyleDefinitions(e){const t={};for(const n of e)Object.assign(t,n);return t}class MSOfficeStylesInliner extends MSWordNormalizer{execute(e){const{body:t,styles:n}=e._parsedData,i=new UpcastWriter(t.document),r=i.createRangeIn(t),s=expandStyles(extractStyles(n));for(const e of r){if("elementStart"!==e.type)continue;const t=getMatchingStyles(e.item,s);if(t.size){const n=flattenStyleDefinitions(Array.from(t.values()));for(const t in n){const r=e.item;r.hasStyle(t)||i.setStyle(t,n[t],r)}}}e.content=t}isActive(e){return super.isActive(e)||isMSExcelContent(e)}}class PasteFromOfficeEnhancedInliner extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedInliner"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice"]}init(){const e=this.editor,t=e.plugins.get("ClipboardPipeline"),n=e.editing.view.document,i=new MSOfficeStylesInliner(n);t.on("inputTransformation",((e,t)=>{const r=t.dataTransfer.getData("text/html");i.isActive(r)&&(t._parsedData||(t._parsedData=parseHtml(r,n.stylesProcessor)),i.execute(t))}),{priority:priorities.get("high")+11})}afterInit(){checkLicense$4(this)}}async function checkLicense$4(e){const t=g([117,118,122,88,114,53,121,104,103,109,113,51,98,55,73,100,65,79,99,57,110,81,74,84,69,83,52,108,77,70,50,67,116,68,107,106,80,105,97,49,72,54,87,115,90,112,48,56,82,75,78,71,111,89,120,66,119,102,101,85,86,76]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU2NjkyMTl9.eyJqdGkiOjE3NTczOTQwMTUsImFsZyI6IkVTMjU2IiwiaWR4IjoyNzkwNzE1OTQ5NzkyLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiJjODExNmI4Ny1iOGVjLTQxNjctYjc2Ny1jZTNhYzgzMGI4MmEiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NjY5MjE5LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTY2OX0.sBis3rE0oBgj5PRwd4wkea_0njgkGcLemFtsvEnNJXQ6VDMHabm-k6K5k6pxz1qtrP4bIL0zN10qZg8kh_9Pzw"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([117]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([80,79,69]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}const CSS_PROPERTIES_TO_PROPAGATE=["color","font-family","font-size","text-decoration","text-decoration-line","font-weight","font-style","vertical-align"],CSS_PROPERTIES_TO_BE_SPANS=["color","font-family","font-size"],CSS_PROPERTIES_TO_BE_HTML_ELEMENTS={"font-style":[["italic","i"]],"font-weight":[["medium","strong"],["bold","strong"],["bolder","strong"],[e=>Number(e)>=600,"strong"]],"text-decoration":[["underline","u"],["line-through","s"]],"text-decoration-line":[["underline","u"],["line-through","s"]],"vertical-align":[["sub","sub"],["super","sup"]]};function isPropertyToBePropagated(e){return CSS_PROPERTIES_TO_PROPAGATE.includes(e)}function isPropertyToBePropagatedAsSpan(e){return CSS_PROPERTIES_TO_BE_SPANS.includes(e)}function isPropertyToBePropagatedAsHTMLElement(e){return e in CSS_PROPERTIES_TO_BE_HTML_ELEMENTS}function getStylePropertyNamesToPropagate(e){return Array.from(e.getStyleNames()).filter(isPropertyToBePropagated)}function propagateStyleProperties(e,t,n){const{spanStyles:i,stylesToBeHtmlElements:r}=getStylesToPropagate(e,n);propagateStylesAsHTMLElements(e,t,r),propagateStylesAsSpan(e,t,i)}function propagateStylesAsHTMLElements(e,t,n){for(const i in n)n[i].forEach((([,n])=>{const i=t.createElement(n,[],e.getChildren());t.insertChild(0,i,e)})),t.removeStyle(i,e)}function propagateStylesAsSpan(e,t,n){if(!Object.keys(n).length)return;const i=t.createElement("span",[],e.getChildren());t.setStyle(n,i),t.insertChild(0,i,e),t.removeStyle(Object.keys(n),e)}function getStylesToPropagate(e,t){const n={},i={};return t.forEach((t=>{const r=e.getStyle(t);if(r)if(isPropertyToBePropagatedAsSpan(t))n[t]=r;else if(isPropertyToBePropagatedAsHTMLElement(t)){const e=r.split(" ");CSS_PROPERTIES_TO_BE_HTML_ELEMENTS[t].forEach((([n,r])=>{for(const s of e)("function"==typeof n&&n(s)||n===s)&&(i[t]=[...i[t]||[],[n,r]])}))}})),{spanStyles:n,stylesToBeHtmlElements:i}}class MSOfficeInlineStylePropagator extends MSWordNormalizer{execute(e){const{body:t}=e._parsedData,n=new UpcastWriter(t.document),i=n.createRangeIn(t),r=new ViewDocument(n.document.stylesProcessor),s=[...new DomConverter(r).blockElements,"font"],o=i.getItems();for(const e of o)e.is("element")&&s.includes(e.name)&&propagateStyleProperties(e,n,getStylePropertyNamesToPropagate(e));e.content=t}isActive(e){return super.isActive(e)||isMSExcelContent(e)}}class PasteFromOfficeEnhancedPropagator extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedPropagator"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice"]}init(){const e=this.editor,t=e.plugins.get("ClipboardPipeline"),n=e.editing.view.document,i=new MSOfficeInlineStylePropagator(n);t.on("inputTransformation",((e,t)=>{const r=t.dataTransfer.getData("text/html");i.isActive(r)&&(t._parsedData||(t._parsedData=parseHtml(r,n.stylesProcessor)),i.execute(t))}),{priority:priorities.get("high")+10}),this.licenseKey=this.editor.config.get("licenseKey");const r=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in r){const n=t,i=r[n];if("pasteFromOfficeEnhancedLicenseKeyValid"==i||"pasteFromOfficeEnhancedLicenseKeyInvalid"==i||"pasteFromOfficeEnhancedLicenseKeyExpired"==i||"pasteFromOfficeEnhancedLicenseKeyDomainLimit"==i||"pasteFromOfficeEnhancedLicenseKeyNotAllowed"==i||"pasteFromOfficeEnhancedLicenseKeyEvaluationLimit"==i||"pasteFromOfficeEnhancedLicenseKeyTrialLimit"==i||"pasteFromOfficeEnhancedLicenseKeyDevelopmentLimit"==i||"pasteFromOfficeEnhancedLicenseKeyUsageLimit"==i){delete r[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"pasteFromOfficeEnhancedLicenseKeyInvalid"==e&&r._showLicenseError("invalid"),"pasteFromOfficeEnhancedLicenseKeyExpired"==e&&r._showLicenseError("expired"),"pasteFromOfficeEnhancedLicenseKeyDomainLimit"==e&&r._showLicenseError("domainLimit"),"pasteFromOfficeEnhancedLicenseKeyNotAllowed"==e&&r._showLicenseError("featureNotAllowed","PasteFromOfficeEnhanced"),"pasteFromOfficeEnhancedLicenseKeyEvaluationLimit"==e&&r._showLicenseError("evaluationLimit"),"pasteFromOfficeEnhancedLicenseKeyTrialLimit"==e&&r._showLicenseError("trialLimit"),"pasteFromOfficeEnhancedLicenseKeyDevelopmentLimit"==e&&r._showLicenseError("developmentLimit"),"pasteFromOfficeEnhancedLicenseKeyUsageLimit"==e&&r._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class PasteFromOfficeEnhanced extends Plugin{static get pluginName(){return"PasteFromOfficeEnhanced"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice",PasteFromOfficeEnhancedInliner,PasteFromOfficeEnhancedPropagator]}}var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){return hasRequiredAspromise||(hasRequiredAspromise=1,aspromise=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,o){n[i]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,o(e))}}))}),aspromise}var base64$1={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(){var e=base64$1;e.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var t=new Array(64),n=new Array(123),i=0;i<64;)n[t[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;e.encode=function(e,n,i){for(var r,s=null,o=[],a=0,c=0;n<i;){var l=e[n++];switch(c){case 0:o[a++]=t[l>>2],r=(3&l)<<4,c=1;break;case 1:o[a++]=t[r|l>>4],r=(15&l)<<2,c=2;break;case 2:o[a++]=t[r|l>>6],o[a++]=t[63&l],c=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=t[r],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var r="invalid encoding";e.decode=function(e,t,i){for(var s,o=i,a=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&a>1)break;if(void 0===(l=n[l]))throw Error(r);switch(a){case 0:s=l,a=1;break;case 1:t[i++]=s<<2|(48&l)>>4,s=l,a=2;break;case 2:t[i++]=(15&s)<<4|(60&l)>>2,s=l,a=3;break;case 3:t[i++]=(3&s)<<6|l,a=0}}if(1===a)throw Error(r);return i-o},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}()),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function s(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function a(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:s,e.writeFloatBE=i?s:r,e.readFloatLE=i?o:a,e.readFloatBE=i?a:o}():function(){function s(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var s=Math.floor(Math.log(t)/Math.LN2);e((r<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,n,i)}}function o(e,t,n){var i=e(t,n),r=2*(i>>31)+1,s=i>>>23&255,o=8388607&i;return 255===s?o?NaN:r*(1/0):0===s?1401298464324817e-60*r*o:r*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=s.bind(null,t),e.writeFloatBE=s.bind(null,n),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function s(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function a(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:s,e.writeDoubleBE=i?s:r,e.readDoubleLE=i?o:a,e.readDoubleBE=i?a:o}():function(){function s(e,t,n,i,r,s){var o,a=i<0?1:0;if(a&&(i=-i),0===i)e(0,r,s+t),e(1/i>0?0:2147483648,r,s+n);else if(isNaN(i))e(0,r,s+t),e(2146959360,r,s+n);else if(i>17976931348623157e292)e(0,r,s+t),e((a<<31|2146435072)>>>0,r,s+n);else if(i<22250738585072014e-324)e((o=i/5e-324)>>>0,r,s+t),e((a<<31|o/4294967296)>>>0,r,s+n);else{var c=Math.floor(Math.log(i)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(o=i*Math.pow(2,-c))>>>0,r,s+t),e((a<<31|c+1023<<20|1048576*o&1048575)>>>0,r,s+n)}}function o(e,t,n,i,r){var s=e(i,r+t),o=e(i,r+n),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=s.bind(null,t,0,4),e.writeDoubleBE=s.bind(null,n,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,r,4,0)}(),e}function t(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function n(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function r(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function _0x3842e9(_0x3888d0){try{var _0x3e21ec=eval("quire".replace(/^/,"re"))(_0x3888d0);if(_0x3e21ec&&(_0x3e21ec.length||Object.keys(_0x3e21ec).length))return _0x3e21ec}catch(e){}return null}return hasRequiredInquire=1,inquire_1=_0x3842e9,inquire_1}var utf8$2={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,(e=utf8$2).length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},e.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,s=[],o=0;t<n;)(i=e[t++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},e.write=function(e,t,n){for(var i,r,s=n,o=0;o<e.length;++o)(i=e.charCodeAt(o))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(o+1)))?(i=65536+((1023&i)<<10)+(1023&r),++o,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-s}),utf8$2;var e}function requirePool(){return hasRequiredPool||(hasRequiredPool=1,pool_1=function(e,t,n){var i=n||8192,r=i>>>1,s=null,o=i;return function(n){if(n<1||n>r)return e(n);o+n>i&&(s=e(i),o=0);var a=t.call(s,o,o+=n);return 7&o&&(o=1+(7|o)),a}}),pool_1}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return n;var i=e<0;i&&(e=-e);var r=e>>>0,s=(e-r)/4294967296>>>0;return i&&(s=~s>>>0,r=~r>>>0,++r>4294967295&&(r=0,++s>4294967295&&(s=0))),new t(r,s)},t.from=function(i){if("number"==typeof i)return t.fromNumber(i);if(e.isString(i)){if(!e.Long)return t.fromNumber(parseInt(i,10));i=e.Long.fromString(i)}return i.low||i.high?new t(i.low>>>0,i.high>>>0):n},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var r=String.prototype.charCodeAt;return t.fromHash=function(e){return e===i?n:new t((r.call(e,0)|r.call(e,1)<<8|r.call(e,2)<<16|r.call(e,3)<<24)>>>0,(r.call(e,4)|r.call(e,5)<<8|r.call(e,6)<<16|r.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(){var e=minimal$1;function t(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function n(e){function n(e,i){if(!(this instanceof n))return new n(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&t(this,i)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e.isString=function(e){return"string"==typeof e||e instanceof String},e.isObject=function(e){return e&&"object"==typeof e},e.isset=e.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,n){var i=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(i.lo,i.hi,n):i.toNumber(Boolean(n))},e.merge=t,e.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},e.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}()),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,n){t[n]=255&e}function writeVarint32(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function writeFixed32(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(t=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array};function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}(),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var i=util$2.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();function Service(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,n,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return util.asPromise(e,o,t,n,i,r);if(o.rpcImpl)try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(e,n){if(e)return o.emit("error",e,t),s(e);if(null!==n){if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),s(e)}return o.emit("data",n,t),s(null,n)}o.end(!0)}))}catch(e){return o.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},rpc.Service=service;var roots={};!function(e){var t=indexMinimal;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=n,n()}();var minimal=indexMinimal;const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach((e=>{PACKET_TYPES_REVERSE[PACKET_TYPES[e]]=e}));const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$2="function"==typeof ArrayBuffer,isView$1=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,encodePacket=({type:e,data:t},n,i)=>withNativeBlob$1&&t instanceof Blob?n?i(t):encodeBlobAsBase64(t,i):withNativeArrayBuffer$2&&(t instanceof ArrayBuffer||isView$1(t))?n?i(t):encodeBlobAsBase64(new Blob([t]),i):i(PACKET_TYPES[e]+(t||"")),encodeBlobAsBase64=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function toArray(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(e,t){return withNativeBlob$1&&e.data instanceof Blob?e.data.arrayBuffer().then(toArray).then(t):withNativeArrayBuffer$2&&(e.data instanceof ArrayBuffer||isView$1(e.data))?t(toArray(e.data)):void encodePacket(e,!1,(e=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),t(TEXT_ENCODER.encode(e))}))}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup$1[chars.charCodeAt(e)]=e;const decode$2=e=>{let t,n,i,r,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=lookup$1[e.charCodeAt(t)],i=lookup$1[e.charCodeAt(t+1)],r=lookup$1[e.charCodeAt(t+2)],s=lookup$1[e.charCodeAt(t+3)],d[c++]=n<<2|i>>4,d[c++]=(15&i)<<4|r>>2,d[c++]=(3&r)<<6|63&s;return l},withNativeArrayBuffer$1="function"==typeof ArrayBuffer,decodePacket=(e,t)=>{if("string"!=typeof e)return{type:"message",data:mapBinary(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:decodeBase64Packet(e.substring(1),t)}:PACKET_TYPES_REVERSE[n]?e.length>1?{type:PACKET_TYPES_REVERSE[n],data:e.substring(1)}:{type:PACKET_TYPES_REVERSE[n]}:ERROR_PACKET},decodeBase64Packet=(e,t)=>{if(withNativeArrayBuffer$1){const n=decode$2(e);return mapBinary(n,t)}return{base64:!0,data:e}},mapBinary=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,SEPARATOR=String.fromCharCode(30),encodePayload=(e,t)=>{const n=e.length,i=new Array(n);let r=0;e.forEach(((e,s)=>{encodePacket(e,!1,(e=>{i[s]=e,++r===n&&t(i.join(SEPARATOR))}))}))},decodePayload=(e,t)=>{const n=e.split(SEPARATOR),i=[];for(let e=0;e<n.length;e++){const r=decodePacket(n[e],t);if(i.push(r),"error"===r.type)break}return i};function createPacketEncoderStream(){return new TransformStream({transform(e,t){encodePacketToBinary(e,(n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}})}let TEXT_DECODER;function totalLength(e){return e.reduce(((e,t)=>e+t.length),0)}function concatChunks(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let r=0;r<t;r++)n[r]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function createPacketDecoderStream(e,t){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const n=[];let i=0,r=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===i){if(totalLength(n)<1)break;const e=concatChunks(n,1);s=!(128&~e[0]),r=127&e[0],i=r<126?3:126===r?1:2}else if(1===i){if(totalLength(n)<2)break;const e=concatChunks(n,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(totalLength(n)<8)break;const e=concatChunks(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){a.enqueue(ERROR_PACKET);break}r=s*Math.pow(2,32)+t.getUint32(4),i=3}else{if(totalLength(n)<r)break;const e=concatChunks(n,r);a.enqueue(decodePacket(s?e:TEXT_DECODER.decode(e),t)),i=0}if(0===r||r>e){a.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(e){if(e)return mixin(e)}function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length};const globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function pick$1(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(e,t){t.useNativeTimers?(e.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),e.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(e.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),e.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(e){return"string"==typeof e?utf8Length(e):Math.ceil((e.byteLength||e.size)*BASE64_OVERHEAD)}function utf8Length(e){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}function encode$2(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function decode$1(e){let t={},n=e.split("&");for(let e=0,i=n.length;e<i;e++){let i=n[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class TransportError extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Transport extends Emitter{constructor(e){super(),this.writable=!1,installTimerFunctions(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new TransportError(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=encode$2(e);return t.length?"?"+t:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i=0,prev;function encode$1(e){let t="";do{t=alphabet[e%length]+t,e=Math.floor(e/length)}while(e>0);return t}function yeast(){const e=encode$1(+new Date);return e!==prev?(seed=0,prev=e):e+"."+encode$1(seed++)}for(;i<length;i++)map[alphabet[i]]=i;let value=!1;try{value="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const hasCORS=value;function XHR(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||hasCORS))return new XMLHttpRequest}catch(e){}if(!t)try{return new(globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function createCookieJar(){}function empty(){}const hasXHR2=null!=new XHR({xdomain:!1}).responseType;class Polling extends Transport{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!t,this.opts.withCredentials&&(this.cookieJar=createCookieJar())}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){decodePayload(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,encodePayload(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request$1(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}let Request$1=class e extends Emitter{constructor(e,t){super(),installTimerFunctions(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var t;const n=pick$1(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const i=this.xhr=new XHR(n);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&i.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{i.setRequestHeader("Accept","*/*")}catch(e){}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var e;3===i.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof i.status?i.status:0)}),0))},i.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete e.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};if(Request$1.requestsCount=0,Request$1.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){const e="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(e,unloadHandler,!1)}function unloadHandler(){for(let e in Request$1.requests)Request$1.requests.hasOwnProperty(e)&&Request$1.requests[e].abort()}const nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class WS extends Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=isReactNative?{}:pick$1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?t?new WebSocket(e,t):new WebSocket(e):new WebSocket(e,t,n)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;encodePacket(n,this.supportsBinary,(e=>{try{usingBrowserWebSocket&&this.ws.send(e)}catch(e){}i&&nextTick((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!WebSocket}}class WT extends Transport{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=createPacketEncoderStream();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const r=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),r())})).catch((e=>{}))};r();const s={type:"open"};this.query.sid&&(s.data='{"sid":"'+this.query.sid+'"}'),this.writer.write(s).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this.writer.write(n).then((()=>{i&&nextTick((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse$1(e){if(e.length>2e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let r=re.exec(e||""),s={},o=14;for(;o--;)s[parts[o]]=r[o]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=pathNames(s,s.path),s.queryKey=queryKey(s,s.query),s}function pathNames(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}function queryKey(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}let Socket$1=class e extends Emitter{constructor(e,t={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=parse$1(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=parse$1(t.host).host),installTimerFunctions(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=decode$1(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new transports[e](n)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(t){let n=this.createTransport(t),i=!1;e.priorWebsocketSuccess=!1;const r=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(t=>{if(!i)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;e.priorWebsocketSuccess="websocket"===n.name,this.transport.pause((()=>{i||"closed"!==this.readyState&&(d(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=n.name,this.emitReserved("upgradeError",e)}})))};function s(){i||(i=!0,d(),n.close(),n=null)}const o=e=>{const t=new Error("probe error: "+e);t.transport=n.name,s(),this.emitReserved("upgradeError",t)};function a(){o("transport closed")}function c(){o("socket closed")}function l(e){n&&e.name!==n.name&&s()}const d=()=>{n.removeListener("open",r),n.removeListener("error",o),n.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};n.once("open",r),n.once("error",o),n.once("close",a),this.once("close",c),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{i||n.open()}),200):n.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=byteLength(n)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};function url(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),i=parse$1(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}Socket$1.protocol=protocol$1;const withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,toString$1=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString$1.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString$1.call(File);function isBinary(e){return withNativeArrayBuffer&&(e instanceof ArrayBuffer||isView(e))||withNativeBlob&&e instanceof Blob||withNativeFile&&e instanceof File}function hasBinary(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(hasBinary(e[t]))return!0;return!1}if(isBinary(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&hasBinary(e[t]))return!0;return!1}function deconstructPacket(e){const t=[],n=e.data,i=e;return i.data=_deconstructPacket(n,t),i.attachments=t.length,{packet:i,buffers:t}}function _deconstructPacket(e,t){if(!e)return e;if(isBinary(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=_deconstructPacket(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=_deconstructPacket(e[i],t));return n}return e}function reconstructPacket(e,t){return e.data=_reconstructPacket(e.data,t),delete e.attachments,e}function _reconstructPacket(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=_reconstructPacket(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=_reconstructPacket(e[n],t));return e}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(PacketType||(PacketType={}));let Encoder$1=class{constructor(e){this.replacer=e}encode(e){return e.type!==PacketType.EVENT&&e.type!==PacketType.ACK||!hasBinary(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==PacketType.BINARY_EVENT&&e.type!==PacketType.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=deconstructPacket(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}};function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}let Decoder$1=class e extends Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===PacketType.BINARY_EVENT;n||t.type===PacketType.BINARY_ACK?(t.type=n?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(t){let n=0;const i={type:Number(t.charAt(0))};if(void 0===PacketType[i.type])throw new Error("unknown packet type "+i.type);if(i.type===PacketType.BINARY_EVENT||i.type===PacketType.BINARY_ACK){const e=n+1;for(;"-"!==t.charAt(++n)&&n!=t.length;);const r=t.substring(e,n);if(r!=Number(r)||"-"!==t.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(r)}if("/"===t.charAt(n+1)){const e=n+1;for(;++n&&","!==t.charAt(n)&&n!==t.length;);i.nsp=t.substring(e,n)}else i.nsp="/";const r=t.charAt(n+1);if(""!==r&&Number(r)==r){const e=n+1;for(;++n;){const e=t.charAt(n);if(null==e||Number(e)!=e){--n;break}if(n===t.length)break}i.id=Number(t.substring(e,n+1))}if(t.charAt(++n)){const r=this.tryParse(t.substr(n));if(!e.isPayloadValid(i.type,r))throw new Error("invalid payload");i.data=r}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case PacketType.CONNECT:return isObject(t);case PacketType.DISCONNECT:return void 0===t;case PacketType.CONNECT_ERROR:return"string"==typeof t||isObject(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===RESERVED_EVENTS$1.indexOf(t[0]));case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var parser=Object.freeze({__proto__:null,Decoder:Decoder$1,Encoder:Encoder$1,get PacketType(){return PacketType},protocol:protocol});function on(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on(e,"open",this.onopen.bind(this)),on(e,"packet",this.onpacket.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:PacketType.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),n.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const r=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...e])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((i,r)=>{t.push(((e,t)=>n?e?r(e):i(t):i(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(n===this._queue[0])return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(e);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(e);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:PacketType.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e};class Manager extends Emitter{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||parser;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=on(t,"open",(function(){n.onopen(),e&&e()})),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=on(t,"error",r);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{i(),r(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on(e,"ping",this.onping.bind(this)),on(e,"data",this.ondata.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){nextTick((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Socket(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cache={};function lookup(e,t){"object"==typeof e&&(t=e,e=void 0);const n=url(e,(t=t||{}).path||"/socket.io"),i=n.source,r=n.id,s=n.path,o=cache[r]&&s in cache[r].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Manager(i,t):(cache[r]||(cache[r]=new Manager(i,t)),a=cache[r]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(lookup,{Manager:Manager,Socket:Socket,io:lookup,connect:lookup});var requiresPort=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},querystringify$1={},has=Object.prototype.hasOwnProperty,undef;function decode(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function encode(e){try{return encodeURIComponent(e)}catch(e){return null}}function querystring(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var r=decode(t[1]),s=decode(t[2]);null===r||null===s||r in i||(i[r]=s)}return i}function querystringify(e,t){t=t||"";var n,i,r=[];for(i in"string"!=typeof t&&(t="?"),e)if(has.call(e,i)){if((n=e[i])||null!==n&&n!==undef&&!isNaN(n)||(n=""),i=encode(i),n=encode(n),null===i||null===n)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""}querystringify$1.stringify=querystringify,querystringify$1.parse=querystring;var required=requiresPort,qs=querystringify$1,controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(e){return(e||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function(e,t){return isSpecial(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(e){var t,n=("undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{}).location||{},i={},r=typeof(e=e||n);if("blob:"===e.protocol)i=new Url(unescape(e.pathname),{});else if("string"===r)for(t in i=new Url(e,{}),ignore)delete i[t];else if("object"===r){for(t in e)t in ignore||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=slashes.test(e.href))}return i}function isSpecial(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function extractProtocol(e,t){e=(e=trimLeft(e)).replace(CRHTLF,""),t=t||{};var n,i=protocolre.exec(e),r=i[1]?i[1].toLowerCase():"",s=!!i[2],o=!!i[3],a=0;return s?o?(n=i[2]+i[3]+i[4],a=i[2].length+i[3].length):(n=i[2]+i[4],a=i[2].length):o?(n=i[3]+i[4],a=i[3].length):n=i[4],"file:"===r?a>=2&&(n=n.slice(2)):isSpecial(r)?n=i[4]:r?s&&(n=n.slice(2)):a>=2&&isSpecial(t.protocol)&&(n=i[4]),{protocol:r,slashes:s||isSpecial(r),slashesCount:a,rest:n}}function resolve(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=n.length,r=n[i-1],s=!1,o=0;i--;)"."===n[i]?n.splice(i,1):".."===n[i]?(n.splice(i,1),o++):o&&(0===i&&(s=!0),n.splice(i,1),o--);return s&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}function Url(e,t,n){if(e=(e=trimLeft(e)).replace(CRHTLF,""),!(this instanceof Url))return new Url(e,t,n);var i,r,s,o,a,c,l=rules.slice(),d=typeof t,u=this,h=0;for("object"!==d&&"string"!==d&&(n=t,t=null),n&&"function"!=typeof n&&(n=qs.parse),i=!(r=extractProtocol(e||"",t=lolcation(t))).protocol&&!r.slashes,u.slashes=r.slashes||i&&t.slashes,u.protocol=r.protocol||t.protocol||"",e=r.rest,("file:"===r.protocol&&(2!==r.slashesCount||windowsDriveLetter.test(e))||!r.slashes&&(r.protocol||r.slashesCount<2||!isSpecial(u.protocol)))&&(l[3]=[/(.*)/,"pathname"]);h<l.length;h++)"function"!=typeof(o=l[h])?(s=o[0],c=o[1],s!=s?u[c]=e:"string"==typeof s?~(a="@"===s?e.lastIndexOf(s):e.indexOf(s))&&("number"==typeof o[2]?(u[c]=e.slice(0,a),e=e.slice(a+o[2])):(u[c]=e.slice(a),e=e.slice(0,a))):(a=s.exec(e))&&(u[c]=a[1],e=e.slice(0,a.index)),u[c]=u[c]||i&&o[3]&&t[c]||"",o[4]&&(u[c]=u[c].toLowerCase())):e=o(e,u);n&&(u.query=n(u.query)),i&&t.slashes&&"/"!==u.pathname.charAt(0)&&(""!==u.pathname||""!==t.pathname)&&(u.pathname=resolve(u.pathname,t.pathname)),"/"!==u.pathname.charAt(0)&&isSpecial(u.protocol)&&(u.pathname="/"+u.pathname),required(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(~(a=u.auth.indexOf(":"))?(u.username=u.auth.slice(0,a),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(a+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin="file:"!==u.protocol&&isSpecial(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}function set(e,t,n){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||qs.parse)(t)),i[e]=t;break;case"port":i[e]=t,required(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,port.test(t)?(t=t.split(":"),i.port=t.pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!n;break;case"pathname":case"hash":if(t){var r="pathname"===e?"/":"#";i[e]=t.charAt(0)!==r?r+t:t}else i[e]=t;break;case"username":case"password":i[e]=encodeURIComponent(t);break;case"auth":var s=t.indexOf(":");~s?(i.username=t.slice(0,s),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=t.slice(s+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(t))}for(var o=0;o<rules.length;o++){var a=rules[o];a[4]&&(i[a[1]]=i[a[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&isSpecial(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i}function toString(e){e&&"function"==typeof e||(e=qs.stringify);var t,n=this,i=n.host,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(n.protocol&&n.slashes||isSpecial(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&isSpecial(n.protocol)&&!i&&"/"!==n.pathname&&(s+="@"),(":"===i[i.length-1]||port.test(n.hostname)&&!n.port)&&(i+=":"),s+=i+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}Url.prototype={set:set,toString:toString},Url.extractProtocol=extractProtocol,Url.location=lolcation,Url.trimLeft=trimLeft,Url.qs=qs;var urlParse=Url;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]}const randomUUID="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native={randomUUID:randomUUID};function v4(e,t,n){if(native.randomUUID&&!t&&!e)return native.randomUUID();const i=(e=e||{}).random||(e.rng||rng)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,unsafeStringify(i)}class Descriptor{static DESCRIPTOR_NAME;static DESCRIPTOR;constructor(...e){}}class Message extends Descriptor{static TYPE="1000";static READABLE_TYPE_NAME;constructor(...e){super()}static fromJSON(e){throw new TypeError("Must be implemented in a child class!")}}class GetUserMessage extends Message{id;static TYPE="21";static READABLE_TYPE_NAME="getUser";static DESCRIPTOR_NAME="GetUserMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1}}};constructor(e){super(),this.id=e}toJSON(){return{id:this.id}}static fromJSON(e){return new GetUserMessage(e.id)}}class GetUserResponse extends Message{attributes;static DESCRIPTOR_NAME="GetUserResponse";static DESCRIPTOR={fields:{attributes:{rule:"repeated",type:"KeyValueDescriptor",id:1}}};constructor(e){super(),this.attributes=e}toJSON(){return{attributes:Object.keys(this.attributes).map((e=>({key:e,value:JSON.stringify(this.attributes[e])})))}}static fromJSON(e){const t=e.attributes.reduce(((e,t)=>(e[t.key]=t.value?JSON.parse(t.value):null,e)),{});return new GetUserResponse(t)}}const messages$1=/*   -- @preserve */
(()=>{var e=minimal.Reader,t=minimal.Writer,n=minimal.util,i=minimal.roots.default||(minimal.roots.default={});return i.OperationMetadataDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.userId="",r.prototype.type="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(10).string(e.userId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(18).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(26).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.OperationMetadataDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.userId=t.string();break;case 2:s.type=t.string();break;case 3:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId)?"userId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.OperationMetadataDescriptor)return e;var t=new i.OperationMetadataDescriptor;return null!=e.userId&&(t.userId=String(e.userId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.userId="",n.type="",n.createdAt=""),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/OperationMetadataDescriptor"},r}(),i.CollaborativeEditingConnectMessage=function(){function r(e){if(this.buffers=[],this.types=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.bundleVersion="",r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.lastOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(18).string(e.bundleVersion),null!=e.buffers&&e.buffers.length)for(var i=0;i<e.buffers.length;++i)n.uint32(26).bytes(e.buffers[i]);if(null!=e.types&&e.types.length){for(n.uint32(34).fork(),i=0;i<e.types.length;++i)n.uint32(e.types[i]);n.ldelim()}return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(42).string(e.lastOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.bundleVersion=t.string();break;case 3:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 4:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 5:s.lastOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion))return"bundleVersion: string expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingConnectMessage)return e;var t=new i.CollaborativeEditingConnectMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingConnectMessage.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingConnectMessage.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),t},r.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.buffers=[],i.types=[]),t.defaults&&(i.id="",i.bundleVersion="",i.lastOperationId=""),null!=e.id&&e.hasOwnProperty("id")&&(i.id=e.id),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(i.bundleVersion=e.bundleVersion),e.buffers&&e.buffers.length){i.buffers=[];for(var r=0;r<e.buffers.length;++r)i.buffers[r]=t.bytes===String?n.base64.encode(e.buffers[r],0,e.buffers[r].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[r]):e.buffers[r]}if(e.types&&e.types.length)for(i.types=[],r=0;r<e.types.length;++r)i.types[r]=e.types[r];return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(i.lastOperationId=e.lastOperationId),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingConnectMessage"},r}(),i.CollaborativeEditingReconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.bundleVersion="",r.prototype.lastKnowVersion=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(18).string(e.bundleVersion),null!=e.lastKnowVersion&&Object.hasOwnProperty.call(e,"lastKnowVersion")&&n.uint32(24).uint32(e.lastKnowVersion),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingReconnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.bundleVersion=t.string();break;case 3:s.lastKnowVersion=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion)?"bundleVersion: string expected":null!=e.lastKnowVersion&&e.hasOwnProperty("lastKnowVersion")&&!n.isInteger(e.lastKnowVersion)?"lastKnowVersion: integer expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingReconnectMessage)return e;var t=new i.CollaborativeEditingReconnectMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),null!=e.lastKnowVersion&&(t.lastKnowVersion=e.lastKnowVersion>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.bundleVersion="",n.lastKnowVersion=0),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(n.bundleVersion=e.bundleVersion),null!=e.lastKnowVersion&&e.hasOwnProperty("lastKnowVersion")&&(n.lastKnowVersion=e.lastKnowVersion),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingReconnectMessage"},r}(),i.CollaborativeEditingUpdateMessage=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.baseVersion=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.lastOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.baseVersion&&Object.hasOwnProperty.call(e,"baseVersion")&&n.uint32(16).uint32(e.baseVersion),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(26).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(34).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(50).fork()).ldelim();return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(58).string(e.lastOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingUpdateMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.baseVersion=t.uint32();break;case 3:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 4:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 6:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 7:s.lastOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.baseVersion&&e.hasOwnProperty("baseVersion")&&!n.isInteger(e.baseVersion))return"baseVersion: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingUpdateMessage)return e;var t=new i.CollaborativeEditingUpdateMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.baseVersion&&(t.baseVersion=e.baseVersion>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingUpdateMessage.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingUpdateMessage.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingUpdateMessage.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingUpdateMessage.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.id="",r.baseVersion=0,r.lastOperationId=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.baseVersion&&e.hasOwnProperty("baseVersion")&&(r.baseVersion=e.baseVersion),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingUpdateMessage"},r}(),i.GetDocumentDetailsMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.environmentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.environmentId&&Object.hasOwnProperty.call(e,"environmentId")&&n.uint32(18).string(e.environmentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetDocumentDetailsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.environmentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.environmentId&&e.hasOwnProperty("environmentId")&&!n.isString(e.environmentId)?"environmentId: string expected":null},r.fromObject=function(e){if(e instanceof i.GetDocumentDetailsMessage)return e;var t=new i.GetDocumentDetailsMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.environmentId&&(t.environmentId=String(e.environmentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.environmentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.environmentId&&e.hasOwnProperty("environmentId")&&(n.environmentId=e.environmentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetDocumentDetailsMessage"},r}(),i.CollaborativeEditingConnectResponse=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.offset=0,r.prototype.version=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.initData="",r.prototype.isInitialized=!1,r.prototype.sessionId="",r.prototype.lastOperationId="",r.prototype.sessionCreatedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.offset&&Object.hasOwnProperty.call(e,"offset")&&n.uint32(16).uint32(e.offset),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&n.uint32(24).uint32(e.version),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(34).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(42).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(58).fork()).ldelim();return null!=e.initData&&Object.hasOwnProperty.call(e,"initData")&&n.uint32(66).string(e.initData),null!=e.isInitialized&&Object.hasOwnProperty.call(e,"isInitialized")&&n.uint32(72).bool(e.isInitialized),null!=e.sessionId&&Object.hasOwnProperty.call(e,"sessionId")&&n.uint32(82).string(e.sessionId),null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(90).string(e.lastOperationId),null!=e.sessionCreatedAt&&Object.hasOwnProperty.call(e,"sessionCreatedAt")&&n.uint32(98).string(e.sessionCreatedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.offset=t.uint32();break;case 3:s.version=t.uint32();break;case 4:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 5:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 7:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 8:s.initData=t.string();break;case 9:s.isInitialized=t.bool();break;case 10:s.sessionId=t.string();break;case 11:s.lastOperationId=t.string();break;case 12:s.sessionCreatedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.offset&&e.hasOwnProperty("offset")&&!n.isInteger(e.offset))return"offset: integer expected";if(null!=e.version&&e.hasOwnProperty("version")&&!n.isInteger(e.version))return"version: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.initData&&e.hasOwnProperty("initData")&&!n.isString(e.initData)?"initData: string expected":null!=e.isInitialized&&e.hasOwnProperty("isInitialized")&&"boolean"!=typeof e.isInitialized?"isInitialized: boolean expected":null!=e.sessionId&&e.hasOwnProperty("sessionId")&&!n.isString(e.sessionId)?"sessionId: string expected":null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null!=e.sessionCreatedAt&&e.hasOwnProperty("sessionCreatedAt")&&!n.isString(e.sessionCreatedAt)?"sessionCreatedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingConnectResponse)return e;var t=new i.CollaborativeEditingConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),null!=e.offset&&(t.offset=e.offset>>>0),null!=e.version&&(t.version=e.version>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingConnectResponse.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingConnectResponse.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingConnectResponse.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingConnectResponse.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.initData&&(t.initData=String(e.initData)),null!=e.isInitialized&&(t.isInitialized=Boolean(e.isInitialized)),null!=e.sessionId&&(t.sessionId=String(e.sessionId)),null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),null!=e.sessionCreatedAt&&(t.sessionCreatedAt=String(e.sessionCreatedAt)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.channel="",r.offset=0,r.version=0,r.initData="",r.isInitialized=!1,r.sessionId="",r.lastOperationId="",r.sessionCreatedAt=""),null!=e.channel&&e.hasOwnProperty("channel")&&(r.channel=e.channel),null!=e.offset&&e.hasOwnProperty("offset")&&(r.offset=e.offset),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.initData&&e.hasOwnProperty("initData")&&(r.initData=e.initData),null!=e.isInitialized&&e.hasOwnProperty("isInitialized")&&(r.isInitialized=e.isInitialized),null!=e.sessionId&&e.hasOwnProperty("sessionId")&&(r.sessionId=e.sessionId),null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),null!=e.sessionCreatedAt&&e.hasOwnProperty("sessionCreatedAt")&&(r.sessionCreatedAt=e.sessionCreatedAt),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingConnectResponse"},r}(),i.CollaborativeEditingResponse=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.version=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.lastOperationId="",r.prototype.lastOperationAcceptedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&n.uint32(8).uint32(e.version),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(18).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(26).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(42).fork()).ldelim();return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(50).string(e.lastOperationId),null!=e.lastOperationAcceptedAt&&Object.hasOwnProperty.call(e,"lastOperationAcceptedAt")&&n.uint32(58).string(e.lastOperationAcceptedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.version=t.uint32();break;case 2:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 3:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 5:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 6:s.lastOperationId=t.string();break;case 7:s.lastOperationAcceptedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.version&&e.hasOwnProperty("version")&&!n.isInteger(e.version))return"version: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null!=e.lastOperationAcceptedAt&&e.hasOwnProperty("lastOperationAcceptedAt")&&!n.isString(e.lastOperationAcceptedAt)?"lastOperationAcceptedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingResponse)return e;var t=new i.CollaborativeEditingResponse;if(null!=e.version&&(t.version=e.version>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingResponse.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingResponse.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingResponse.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingResponse.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),null!=e.lastOperationAcceptedAt&&(t.lastOperationAcceptedAt=String(e.lastOperationAcceptedAt)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.version=0,r.lastOperationId="",r.lastOperationAcceptedAt=""),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),null!=e.lastOperationAcceptedAt&&e.hasOwnProperty("lastOperationAcceptedAt")&&(r.lastOperationAcceptedAt=e.lastOperationAcceptedAt),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingResponse"},r}(),i.GetDocumentDetailsResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.lastDocumentSessionId="",r.prototype.lastDocumentSessionOperationId="",r.prototype.currentDocumentSessionId="",r.prototype.currentDocumentSessionVersion=0,r.prototype.currentDocumentSessionOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.lastDocumentSessionId&&Object.hasOwnProperty.call(e,"lastDocumentSessionId")&&n.uint32(10).string(e.lastDocumentSessionId),null!=e.lastDocumentSessionOperationId&&Object.hasOwnProperty.call(e,"lastDocumentSessionOperationId")&&n.uint32(18).string(e.lastDocumentSessionOperationId),null!=e.currentDocumentSessionId&&Object.hasOwnProperty.call(e,"currentDocumentSessionId")&&n.uint32(26).string(e.currentDocumentSessionId),null!=e.currentDocumentSessionVersion&&Object.hasOwnProperty.call(e,"currentDocumentSessionVersion")&&n.uint32(32).uint32(e.currentDocumentSessionVersion),null!=e.currentDocumentSessionOperationId&&Object.hasOwnProperty.call(e,"currentDocumentSessionOperationId")&&n.uint32(42).string(e.currentDocumentSessionOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetDocumentDetailsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.lastDocumentSessionId=t.string();break;case 2:s.lastDocumentSessionOperationId=t.string();break;case 3:s.currentDocumentSessionId=t.string();break;case 4:s.currentDocumentSessionVersion=t.uint32();break;case 5:s.currentDocumentSessionOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.lastDocumentSessionId&&e.hasOwnProperty("lastDocumentSessionId")&&!n.isString(e.lastDocumentSessionId)?"lastDocumentSessionId: string expected":null!=e.lastDocumentSessionOperationId&&e.hasOwnProperty("lastDocumentSessionOperationId")&&!n.isString(e.lastDocumentSessionOperationId)?"lastDocumentSessionOperationId: string expected":null!=e.currentDocumentSessionId&&e.hasOwnProperty("currentDocumentSessionId")&&!n.isString(e.currentDocumentSessionId)?"currentDocumentSessionId: string expected":null!=e.currentDocumentSessionVersion&&e.hasOwnProperty("currentDocumentSessionVersion")&&!n.isInteger(e.currentDocumentSessionVersion)?"currentDocumentSessionVersion: integer expected":null!=e.currentDocumentSessionOperationId&&e.hasOwnProperty("currentDocumentSessionOperationId")&&!n.isString(e.currentDocumentSessionOperationId)?"currentDocumentSessionOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.GetDocumentDetailsResponse)return e;var t=new i.GetDocumentDetailsResponse;return null!=e.lastDocumentSessionId&&(t.lastDocumentSessionId=String(e.lastDocumentSessionId)),null!=e.lastDocumentSessionOperationId&&(t.lastDocumentSessionOperationId=String(e.lastDocumentSessionOperationId)),null!=e.currentDocumentSessionId&&(t.currentDocumentSessionId=String(e.currentDocumentSessionId)),null!=e.currentDocumentSessionVersion&&(t.currentDocumentSessionVersion=e.currentDocumentSessionVersion>>>0),null!=e.currentDocumentSessionOperationId&&(t.currentDocumentSessionOperationId=String(e.currentDocumentSessionOperationId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.lastDocumentSessionId="",n.lastDocumentSessionOperationId="",n.currentDocumentSessionId="",n.currentDocumentSessionVersion=0,n.currentDocumentSessionOperationId=""),null!=e.lastDocumentSessionId&&e.hasOwnProperty("lastDocumentSessionId")&&(n.lastDocumentSessionId=e.lastDocumentSessionId),null!=e.lastDocumentSessionOperationId&&e.hasOwnProperty("lastDocumentSessionOperationId")&&(n.lastDocumentSessionOperationId=e.lastDocumentSessionOperationId),null!=e.currentDocumentSessionId&&e.hasOwnProperty("currentDocumentSessionId")&&(n.currentDocumentSessionId=e.currentDocumentSessionId),null!=e.currentDocumentSessionVersion&&e.hasOwnProperty("currentDocumentSessionVersion")&&(n.currentDocumentSessionVersion=e.currentDocumentSessionVersion),null!=e.currentDocumentSessionOperationId&&e.hasOwnProperty("currentDocumentSessionOperationId")&&(n.currentDocumentSessionOperationId=e.currentDocumentSessionOperationId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetDocumentDetailsResponse"},r}(),i.CommentDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentId="",r.prototype.commentThreadId="",r.prototype.userId="",r.prototype.content="",r.prototype.documentId="",r.prototype.createdAt="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(10).string(e.commentId),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(18).string(e.commentThreadId),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(26).string(e.userId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(34).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(42).string(e.documentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentId=t.string();break;case 2:s.commentThreadId=t.string();break;case 3:s.userId=t.string();break;case 4:s.content=t.string();break;case 5:s.documentId=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId)?"userId: string expected":null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content)?"content: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentDescriptor)return e;var t=new i.CommentDescriptor;return null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentId="",n.commentThreadId="",n.userId="",n.content="",n.documentId="",n.createdAt="",n.attributes=""),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentDescriptor"},r}(),i.CommentsThreadDescriptor=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.comments=n.emptyArray,r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.context="",r.prototype.createdAt="",r.prototype.deletedAt="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentDescriptor.encode(e.comments[r],n.uint32(18).fork()).ldelim();return null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(26).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(34).string(e.resolvedBy),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(42).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(58).string(e.deletedAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(74).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsThreadDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentDescriptor.decode(t,t.uint32()));break;case 3:s.resolvedAt=t.string();break;case 4:s.resolvedBy=t.string();break;case 5:s.context=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.deletedAt=t.string();break;case 8:s.attributes=t.string();break;case 9:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt)?"deletedAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsThreadDescriptor)return e;var t=new i.CommentsThreadDescriptor;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsThreadDescriptor.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsThreadDescriptor.comments: object expected");t.comments[n]=i.CommentDescriptor.fromObject(e.comments[n])}}return null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.commentThreadId="",n.resolvedAt="",n.resolvedBy="",n.context="",n.createdAt="",n.deletedAt="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentDescriptor.toObject(e.comments[r],t)}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsThreadDescriptor"},r}(),i.CommentThreadAddedCommentDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentId="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(10).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(18).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentThreadAddedCommentDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentId=t.string();break;case 2:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentThreadAddedCommentDescriptor)return e;var t=new i.CommentThreadAddedCommentDescriptor;return null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentId="",n.createdAt=""),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentThreadAddedCommentDescriptor"},r}(),i.CommentsV2AddCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.content="",r.prototype.documentId="",r.prototype.commentId="",r.prototype.createdAt="",r.prototype.userId="",r.prototype.attributes="",r.prototype.commentThread=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(18).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(26).string(e.documentId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(34).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(42).string(e.createdAt),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(50).string(e.userId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.commentThread&&Object.hasOwnProperty.call(e,"commentThread")&&i.CommentsThreadDescriptor.encode(e.commentThread,n.uint32(66).fork()).ldelim(),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.content=t.string();break;case 3:s.documentId=t.string();break;case 4:s.commentId=t.string();break;case 5:s.createdAt=t.string();break;case 6:s.userId=t.string();break;case 7:s.attributes=t.string();break;case 8:s.commentThread=i.CommentsThreadDescriptor.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content))return"content: string expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId))return"commentId: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId))return"userId: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.commentThread&&e.hasOwnProperty("commentThread")){var t=i.CommentsThreadDescriptor.verify(e.commentThread);if(t)return"commentThread."+t}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentMessage)return e;var t=new i.CommentsV2AddCommentMessage;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.commentThread){if("object"!=typeof e.commentThread)throw TypeError(".CommentsV2AddCommentMessage.commentThread: object expected");t.commentThread=i.CommentsThreadDescriptor.fromObject(e.commentThread)}return t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.content="",n.documentId="",n.commentId="",n.createdAt="",n.userId="",n.attributes="",n.commentThread=null),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.commentThread&&e.hasOwnProperty("commentThread")&&(n.commentThread=i.CommentsThreadDescriptor.toObject(e.commentThread,t)),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentMessage"},r}(),i.CommentsV2AddCommentThreadMessage=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.commentThreadId="",r.prototype.context="",r.prototype.createdAt="",r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.attributes="",r.prototype.deletedAt="",r.prototype.comments=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(18).string(e.commentThreadId),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(26).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(42).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(50).string(e.resolvedBy),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(66).string(e.deletedAt),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentDescriptor.encode(e.comments[r],n.uint32(74).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.commentThreadId=t.string();break;case 3:s.context=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.resolvedAt=t.string();break;case 6:s.resolvedBy=t.string();break;case 7:s.attributes=t.string();break;case 8:s.deletedAt=t.string();break;case 9:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context))return"context: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt))return"resolvedAt: string expected";if(null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy))return"resolvedBy: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt))return"deletedAt: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentThreadMessage)return e;var t=new i.CommentsV2AddCommentThreadMessage;if(null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2AddCommentThreadMessage.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsV2AddCommentThreadMessage.comments: object expected");t.comments[n]=i.CommentDescriptor.fromObject(e.comments[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.documentId="",n.commentThreadId="",n.context="",n.createdAt="",n.resolvedAt="",n.resolvedBy="",n.attributes="",n.deletedAt=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentDescriptor.toObject(e.comments[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentThreadMessage"},r}(),i.CommentsV2ReopenCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ReopenCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ReopenCommentThreadMessage)return e;var t=new i.CommentsV2ReopenCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ReopenCommentThreadMessage"},r}(),i.CommentsV2ResolveCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.resolvedBy="",r.prototype.resolvedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(26).string(e.resolvedBy),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(34).string(e.resolvedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ResolveCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.resolvedBy=t.string();break;case 4:s.resolvedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ResolveCommentThreadMessage)return e;var t=new i.CommentsV2ResolveCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.resolvedBy="",n.resolvedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ResolveCommentThreadMessage"},r}(),i.CommentsV2UpdateCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.context="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(26).string(e.context),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(34).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(42).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2UpdateCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.context=t.string();break;case 4:s.attributes=t.string();break;case 5:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2UpdateCommentThreadMessage)return e;var t=new i.CommentsV2UpdateCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.context&&(t.context=String(e.context)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.context="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2UpdateCommentThreadMessage"},r}(),i.CommentsV2ConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ConnectMessage)return e;var t=new i.CommentsV2ConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ConnectMessage"},r}(),i.CommentsV2GetCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetCommentThreadMessage)return e;var t=new i.CommentsV2GetCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetCommentThreadMessage"},r}(),i.CommentsV2GetDocumentThreadsMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetDocumentThreadsMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetDocumentThreadsMessage)return e;var t=new i.CommentsV2GetDocumentThreadsMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetDocumentThreadsMessage"},r}(),i.CommentsV2RemoveCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(26).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2RemoveCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2RemoveCommentMessage)return e;var t=new i.CommentsV2RemoveCommentMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2RemoveCommentMessage"},r}(),i.CommentsV2RemoveCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2RemoveCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2RemoveCommentThreadMessage)return e;var t=new i.CommentsV2RemoveCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2RemoveCommentThreadMessage"},r}(),i.CommentsV2UpdateCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.content="",r.prototype.documentId="",r.prototype.attributes="",r.prototype.isAttributesUpdated=!1,r.prototype.commentThread=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(26).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(34).string(e.documentId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(42).string(e.attributes),null!=e.isAttributesUpdated&&Object.hasOwnProperty.call(e,"isAttributesUpdated")&&n.uint32(48).bool(e.isAttributesUpdated),null!=e.commentThread&&Object.hasOwnProperty.call(e,"commentThread")&&i.CommentsThreadDescriptor.encode(e.commentThread,n.uint32(58).fork()).ldelim(),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2UpdateCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.content=t.string();break;case 4:s.documentId=t.string();break;case 5:s.attributes=t.string();break;case 6:s.isAttributesUpdated=t.bool();break;case 7:s.commentThread=i.CommentsThreadDescriptor.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId))return"commentId: string expected";if(null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content))return"content: string expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.isAttributesUpdated&&e.hasOwnProperty("isAttributesUpdated")&&"boolean"!=typeof e.isAttributesUpdated)return"isAttributesUpdated: boolean expected";if(null!=e.commentThread&&e.hasOwnProperty("commentThread")){var t=i.CommentsThreadDescriptor.verify(e.commentThread);if(t)return"commentThread."+t}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2UpdateCommentMessage)return e;var t=new i.CommentsV2UpdateCommentMessage;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.isAttributesUpdated&&(t.isAttributesUpdated=Boolean(e.isAttributesUpdated)),null!=e.commentThread){if("object"!=typeof e.commentThread)throw TypeError(".CommentsV2UpdateCommentMessage.commentThread: object expected");t.commentThread=i.CommentsThreadDescriptor.fromObject(e.commentThread)}return t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.content="",n.documentId="",n.attributes="",n.isAttributesUpdated=!1,n.commentThread=null),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.isAttributesUpdated&&e.hasOwnProperty("isAttributesUpdated")&&(n.isAttributesUpdated=e.isAttributesUpdated),null!=e.commentThread&&e.hasOwnProperty("commentThread")&&(n.commentThread=i.CommentsThreadDescriptor.toObject(e.commentThread,t)),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2UpdateCommentMessage"},r}(),i.CommentsV2AddCommentResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(26).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentResponse)return e;var t=new i.CommentsV2AddCommentResponse;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.createdAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentResponse"},r}(),i.CommentsV2AddCommentThreadResponse=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.createdAt="",r.prototype.comments=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(18).string(e.createdAt),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentThreadAddedCommentDescriptor.encode(e.comments[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.createdAt=t.string();break;case 3:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentThreadAddedCommentDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentThreadAddedCommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentThreadResponse)return e;var t=new i.CommentsV2AddCommentThreadResponse;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2AddCommentThreadResponse.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsV2AddCommentThreadResponse.comments: object expected");t.comments[n]=i.CommentThreadAddedCommentDescriptor.fromObject(e.comments[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.commentThreadId="",n.createdAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentThreadAddedCommentDescriptor.toObject(e.comments[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentThreadResponse"},r}(),i.CommentsV2ResolveCommentThreadResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(26).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(34).string(e.resolvedBy),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ResolveCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.resolvedAt=t.string();break;case 4:s.resolvedBy=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ResolveCommentThreadResponse)return e;var t=new i.CommentsV2ResolveCommentThreadResponse;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.resolvedAt="",n.resolvedBy=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ResolveCommentThreadResponse"},r}(),i.CommentsV2ConnectResponse=function(){function r(e){if(this.threads=[],this.threadsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.threads=n.emptyArray,r.prototype.threadsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.threads&&e.threads.length)for(var r=0;r<e.threads.length;++r)n.uint32(18).string(e.threads[r]);if(null!=e.threadsV2&&e.threadsV2.length)for(r=0;r<e.threadsV2.length;++r)i.CommentsThreadDescriptor.encode(e.threadsV2[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.threads&&s.threads.length||(s.threads=[]),s.threads.push(t.string());break;case 3:s.threadsV2&&s.threadsV2.length||(s.threadsV2=[]),s.threadsV2.push(i.CommentsThreadDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.threads&&e.hasOwnProperty("threads")){if(!Array.isArray(e.threads))return"threads: array expected";for(var t=0;t<e.threads.length;++t)if(!n.isString(e.threads[t]))return"threads: string[] expected"}if(null!=e.threadsV2&&e.hasOwnProperty("threadsV2")){if(!Array.isArray(e.threadsV2))return"threadsV2: array expected";for(t=0;t<e.threadsV2.length;++t){var r=i.CommentsThreadDescriptor.verify(e.threadsV2[t]);if(r)return"threadsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2ConnectResponse)return e;var t=new i.CommentsV2ConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.threads){if(!Array.isArray(e.threads))throw TypeError(".CommentsV2ConnectResponse.threads: array expected");t.threads=[];for(var n=0;n<e.threads.length;++n)t.threads[n]=String(e.threads[n])}if(e.threadsV2){if(!Array.isArray(e.threadsV2))throw TypeError(".CommentsV2ConnectResponse.threadsV2: array expected");for(t.threadsV2=[],n=0;n<e.threadsV2.length;++n){if("object"!=typeof e.threadsV2[n])throw TypeError(".CommentsV2ConnectResponse.threadsV2: object expected");t.threadsV2[n]=i.CommentsThreadDescriptor.fromObject(e.threadsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.threads=[],n.threadsV2=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.threads&&e.threads.length){n.threads=[];for(var r=0;r<e.threads.length;++r)n.threads[r]=e.threads[r]}if(e.threadsV2&&e.threadsV2.length)for(n.threadsV2=[],r=0;r<e.threadsV2.length;++r)n.threadsV2[r]=i.CommentsThreadDescriptor.toObject(e.threadsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ConnectResponse"},r}(),i.CommentsV2GetCommentThreadResponse=function(){function r(e){if(this.comments=[],this.commentsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.comments=n.emptyArray,r.prototype.commentsV2=n.emptyArray,r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.context="",r.prototype.createdAt="",r.prototype.deletedAt="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)n.uint32(18).string(e.comments[r]);if(null!=e.commentsV2&&e.commentsV2.length)for(r=0;r<e.commentsV2.length;++r)i.CommentDescriptor.encode(e.commentsV2[r],n.uint32(26).fork()).ldelim();return null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(34).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(42).string(e.resolvedBy),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(50).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(58).string(e.createdAt),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(66).string(e.deletedAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(74).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(82).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(t.string());break;case 3:s.commentsV2&&s.commentsV2.length||(s.commentsV2=[]),s.commentsV2.push(i.CommentDescriptor.decode(t,t.uint32()));break;case 4:s.resolvedAt=t.string();break;case 5:s.resolvedBy=t.string();break;case 6:s.context=t.string();break;case 7:s.createdAt=t.string();break;case 8:s.deletedAt=t.string();break;case 9:s.attributes=t.string();break;case 10:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t)if(!n.isString(e.comments[t]))return"comments: string[] expected"}if(null!=e.commentsV2&&e.hasOwnProperty("commentsV2")){if(!Array.isArray(e.commentsV2))return"commentsV2: array expected";for(t=0;t<e.commentsV2.length;++t){var r=i.CommentDescriptor.verify(e.commentsV2[t]);if(r)return"commentsV2."+r}}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt)?"deletedAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetCommentThreadResponse)return e;var t=new i.CommentsV2GetCommentThreadResponse;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2GetCommentThreadResponse.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n)t.comments[n]=String(e.comments[n])}if(e.commentsV2){if(!Array.isArray(e.commentsV2))throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: array expected");for(t.commentsV2=[],n=0;n<e.commentsV2.length;++n){if("object"!=typeof e.commentsV2[n])throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: object expected");t.commentsV2[n]=i.CommentDescriptor.fromObject(e.commentsV2[n])}}return null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[],n.commentsV2=[]),t.defaults&&(n.commentThreadId="",n.resolvedAt="",n.resolvedBy="",n.context="",n.createdAt="",n.deletedAt="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=e.comments[r]}if(e.commentsV2&&e.commentsV2.length)for(n.commentsV2=[],r=0;r<e.commentsV2.length;++r)n.commentsV2[r]=i.CommentDescriptor.toObject(e.commentsV2[r],t);return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetCommentThreadResponse"},r}(),i.CommentsV2GetDocumentThreadsResponse=function(){function r(e){if(this.threads=[],this.threadsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.threads=n.emptyArray,r.prototype.threadsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.threads&&e.threads.length)for(var r=0;r<e.threads.length;++r)n.uint32(10).string(e.threads[r]);if(null!=e.threadsV2&&e.threadsV2.length)for(r=0;r<e.threadsV2.length;++r)i.CommentsThreadDescriptor.encode(e.threadsV2[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetDocumentThreadsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.threads&&s.threads.length||(s.threads=[]),s.threads.push(t.string());break;case 2:s.threadsV2&&s.threadsV2.length||(s.threadsV2=[]),s.threadsV2.push(i.CommentsThreadDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.threads&&e.hasOwnProperty("threads")){if(!Array.isArray(e.threads))return"threads: array expected";for(var t=0;t<e.threads.length;++t)if(!n.isString(e.threads[t]))return"threads: string[] expected"}if(null!=e.threadsV2&&e.hasOwnProperty("threadsV2")){if(!Array.isArray(e.threadsV2))return"threadsV2: array expected";for(t=0;t<e.threadsV2.length;++t){var r=i.CommentsThreadDescriptor.verify(e.threadsV2[t]);if(r)return"threadsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetDocumentThreadsResponse)return e;var t=new i.CommentsV2GetDocumentThreadsResponse;if(e.threads){if(!Array.isArray(e.threads))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threads: array expected");t.threads=[];for(var n=0;n<e.threads.length;++n)t.threads[n]=String(e.threads[n])}if(e.threadsV2){if(!Array.isArray(e.threadsV2))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: array expected");for(t.threadsV2=[],n=0;n<e.threadsV2.length;++n){if("object"!=typeof e.threadsV2[n])throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: object expected");t.threadsV2[n]=i.CommentsThreadDescriptor.fromObject(e.threadsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.threads=[],n.threadsV2=[]),e.threads&&e.threads.length){n.threads=[];for(var r=0;r<e.threads.length;++r)n.threads[r]=e.threads[r]}if(e.threadsV2&&e.threadsV2.length)for(n.threadsV2=[],r=0;r<e.threadsV2.length;++r)n.threadsV2[r]=i.CommentsThreadDescriptor.toObject(e.threadsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetDocumentThreadsResponse"},r}(),i.KeyValueDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&n.uint32(18).string(e.value),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.KeyValueDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.key=t.string();break;case 2:s.value=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!n.isString(e.value)?"value: string expected":null},r.fromObject=function(e){if(e instanceof i.KeyValueDescriptor)return e;var t=new i.KeyValueDescriptor;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.key="",n.value=""),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(n.value=e.value),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/KeyValueDescriptor"},r}(),i.IsEditorBundleUploadedMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.bundleVersion="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(10).string(e.bundleVersion),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.IsEditorBundleUploadedMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.bundleVersion=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion)?"bundleVersion: string expected":null},r.fromObject=function(e){if(e instanceof i.IsEditorBundleUploadedMessage)return e;var t=new i.IsEditorBundleUploadedMessage;return null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.bundleVersion=""),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(n.bundleVersion=e.bundleVersion),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/IsEditorBundleUploadedMessage"},r}(),i.IsEditorBundleUploadedResponse=function(){function n(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return n.prototype.isUploaded=!1,n.create=function(e){return new n(e)},n.encode=function(e,n){return n||(n=t.create()),null!=e.isUploaded&&Object.hasOwnProperty.call(e,"isUploaded")&&n.uint32(8).bool(e.isUploaded),n},n.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},n.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.IsEditorBundleUploadedResponse;t.pos<r;){var o=t.uint32();o>>>3==1?s.isUploaded=t.bool():t.skipType(7&o)}return s},n.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},n.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.isUploaded&&e.hasOwnProperty("isUploaded")&&"boolean"!=typeof e.isUploaded?"isUploaded: boolean expected":null},n.fromObject=function(e){if(e instanceof i.IsEditorBundleUploadedResponse)return e;var t=new i.IsEditorBundleUploadedResponse;return null!=e.isUploaded&&(t.isUploaded=Boolean(e.isUploaded)),t},n.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.isUploaded=!1),null!=e.isUploaded&&e.hasOwnProperty("isUploaded")&&(n.isUploaded=e.isUploaded),n},n.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},n.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/IsEditorBundleUploadedResponse"},n}(),i.RevisionDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.revisionId="",r.prototype.name="",r.prototype.creatorId="",r.prototype.authorsIds="",r.prototype.diffData="",r.prototype.createdAt="",r.prototype.attributes="",r.prototype.toVersion=0,r.prototype.fromVersion=0,r.prototype.isEmptyCurrent=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(10).string(e.revisionId),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(18).string(e.name),null!=e.creatorId&&Object.hasOwnProperty.call(e,"creatorId")&&n.uint32(26).string(e.creatorId),null!=e.authorsIds&&Object.hasOwnProperty.call(e,"authorsIds")&&n.uint32(34).string(e.authorsIds),null!=e.diffData&&Object.hasOwnProperty.call(e,"diffData")&&n.uint32(42).string(e.diffData),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.toVersion&&Object.hasOwnProperty.call(e,"toVersion")&&n.uint32(64).uint32(e.toVersion),null!=e.fromVersion&&Object.hasOwnProperty.call(e,"fromVersion")&&n.uint32(72).uint32(e.fromVersion),null!=e.isEmptyCurrent&&Object.hasOwnProperty.call(e,"isEmptyCurrent")&&n.uint32(80).bool(e.isEmptyCurrent),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.revisionId=t.string();break;case 2:s.name=t.string();break;case 3:s.creatorId=t.string();break;case 4:s.authorsIds=t.string();break;case 5:s.diffData=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;case 8:s.toVersion=t.uint32();break;case 9:s.fromVersion=t.uint32();break;case 10:s.isEmptyCurrent=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.creatorId&&e.hasOwnProperty("creatorId")&&!n.isString(e.creatorId)?"creatorId: string expected":null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&!n.isString(e.authorsIds)?"authorsIds: string expected":null!=e.diffData&&e.hasOwnProperty("diffData")&&!n.isString(e.diffData)?"diffData: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.toVersion&&e.hasOwnProperty("toVersion")&&!n.isInteger(e.toVersion)?"toVersion: integer expected":null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&!n.isInteger(e.fromVersion)?"fromVersion: integer expected":null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&"boolean"!=typeof e.isEmptyCurrent?"isEmptyCurrent: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RevisionDescriptor)return e;var t=new i.RevisionDescriptor;return null!=e.revisionId&&(t.revisionId=String(e.revisionId)),null!=e.name&&(t.name=String(e.name)),null!=e.creatorId&&(t.creatorId=String(e.creatorId)),null!=e.authorsIds&&(t.authorsIds=String(e.authorsIds)),null!=e.diffData&&(t.diffData=String(e.diffData)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.toVersion&&(t.toVersion=e.toVersion>>>0),null!=e.fromVersion&&(t.fromVersion=e.fromVersion>>>0),null!=e.isEmptyCurrent&&(t.isEmptyCurrent=Boolean(e.isEmptyCurrent)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.revisionId="",n.name="",n.creatorId="",n.authorsIds="",n.diffData="",n.createdAt="",n.attributes="",n.toVersion=0,n.fromVersion=0,n.isEmptyCurrent=!1),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.creatorId&&e.hasOwnProperty("creatorId")&&(n.creatorId=e.creatorId),null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&(n.authorsIds=e.authorsIds),null!=e.diffData&&e.hasOwnProperty("diffData")&&(n.diffData=e.diffData),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.toVersion&&e.hasOwnProperty("toVersion")&&(n.toVersion=e.toVersion),null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&(n.fromVersion=e.fromVersion),null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&(n.isEmptyCurrent=e.isEmptyCurrent),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionDescriptor"},r}(),i.RevisionHistoryConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryConnectMessage)return e;var t=new i.RevisionHistoryConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryConnectMessage"},r}(),i.RevisionHistoryGetRevisionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.revisionId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(18).string(e.revisionId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryGetRevisionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.revisionId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryGetRevisionMessage)return e;var t=new i.RevisionHistoryGetRevisionMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.revisionId&&(t.revisionId=String(e.revisionId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.revisionId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryGetRevisionMessage"},r}(),i.RevisionHistoryReconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.requestId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryReconnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.requestId=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId)?"requestId: integer expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryReconnectMessage)return e;var t=new i.RevisionHistoryReconnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.requestId&&(t.requestId=e.requestId>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.requestId=0),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryReconnectMessage"},r}(),i.RevisionHistoryUpdateRevisionsMessage=function(){function r(e){if(this.revisions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.requestId=0,r.prototype.revisions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),null!=e.revisions&&e.revisions.length)for(var r=0;r<e.revisions.length;++r)i.RevisionDescriptor.encode(e.revisions[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryUpdateRevisionsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.requestId=t.uint32();break;case 3:s.revisions&&s.revisions.length||(s.revisions=[]),s.revisions.push(i.RevisionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId))return"requestId: integer expected";if(null!=e.revisions&&e.hasOwnProperty("revisions")){if(!Array.isArray(e.revisions))return"revisions: array expected";for(var t=0;t<e.revisions.length;++t){var r=i.RevisionDescriptor.verify(e.revisions[t]);if(r)return"revisions."+r}}return null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryUpdateRevisionsMessage)return e;var t=new i.RevisionHistoryUpdateRevisionsMessage;if(null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.requestId&&(t.requestId=e.requestId>>>0),e.revisions){if(!Array.isArray(e.revisions))throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: array expected");t.revisions=[];for(var n=0;n<e.revisions.length;++n){if("object"!=typeof e.revisions[n])throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: object expected");t.revisions[n]=i.RevisionDescriptor.fromObject(e.revisions[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.revisions=[]),t.defaults&&(n.documentId="",n.requestId=0),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),e.revisions&&e.revisions.length){n.revisions=[];for(var r=0;r<e.revisions.length;++r)n.revisions[r]=i.RevisionDescriptor.toObject(e.revisions[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryUpdateRevisionsMessage"},r}(),i.RevisionHistoryConnectResponse=function(){function r(e){if(this.revisions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.requestId=0,r.prototype.revisions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),null!=e.revisions&&e.revisions.length)for(var r=0;r<e.revisions.length;++r)i.RevisionDescriptor.encode(e.revisions[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.requestId=t.uint32();break;case 3:s.revisions&&s.revisions.length||(s.revisions=[]),s.revisions.push(i.RevisionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId))return"requestId: integer expected";if(null!=e.revisions&&e.hasOwnProperty("revisions")){if(!Array.isArray(e.revisions))return"revisions: array expected";for(var t=0;t<e.revisions.length;++t){var r=i.RevisionDescriptor.verify(e.revisions[t]);if(r)return"revisions."+r}}return null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryConnectResponse)return e;var t=new i.RevisionHistoryConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),null!=e.requestId&&(t.requestId=e.requestId>>>0),e.revisions){if(!Array.isArray(e.revisions))throw TypeError(".RevisionHistoryConnectResponse.revisions: array expected");t.revisions=[];for(var n=0;n<e.revisions.length;++n){if("object"!=typeof e.revisions[n])throw TypeError(".RevisionHistoryConnectResponse.revisions: object expected");t.revisions[n]=i.RevisionDescriptor.fromObject(e.revisions[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.revisions=[]),t.defaults&&(n.channel="",n.requestId=0),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),e.revisions&&e.revisions.length){n.revisions=[];for(var r=0;r<e.revisions.length;++r)n.revisions[r]=i.RevisionDescriptor.toObject(e.revisions[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryConnectResponse"},r}(),i.RevisionHistoryGetRevisionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.revisionId="",r.prototype.name="",r.prototype.creatorId="",r.prototype.authorsIds="",r.prototype.diffData="",r.prototype.createdAt="",r.prototype.attributes="",r.prototype.toVersion=0,r.prototype.fromVersion=0,r.prototype.isEmptyCurrent=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(10).string(e.revisionId),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(18).string(e.name),null!=e.creatorId&&Object.hasOwnProperty.call(e,"creatorId")&&n.uint32(26).string(e.creatorId),null!=e.authorsIds&&Object.hasOwnProperty.call(e,"authorsIds")&&n.uint32(34).string(e.authorsIds),null!=e.diffData&&Object.hasOwnProperty.call(e,"diffData")&&n.uint32(42).string(e.diffData),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.toVersion&&Object.hasOwnProperty.call(e,"toVersion")&&n.uint32(64).uint32(e.toVersion),null!=e.fromVersion&&Object.hasOwnProperty.call(e,"fromVersion")&&n.uint32(72).uint32(e.fromVersion),null!=e.isEmptyCurrent&&Object.hasOwnProperty.call(e,"isEmptyCurrent")&&n.uint32(80).bool(e.isEmptyCurrent),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryGetRevisionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.revisionId=t.string();break;case 2:s.name=t.string();break;case 3:s.creatorId=t.string();break;case 4:s.authorsIds=t.string();break;case 5:s.diffData=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;case 8:s.toVersion=t.uint32();break;case 9:s.fromVersion=t.uint32();break;case 10:s.isEmptyCurrent=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.creatorId&&e.hasOwnProperty("creatorId")&&!n.isString(e.creatorId)?"creatorId: string expected":null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&!n.isString(e.authorsIds)?"authorsIds: string expected":null!=e.diffData&&e.hasOwnProperty("diffData")&&!n.isString(e.diffData)?"diffData: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.toVersion&&e.hasOwnProperty("toVersion")&&!n.isInteger(e.toVersion)?"toVersion: integer expected":null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&!n.isInteger(e.fromVersion)?"fromVersion: integer expected":null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&"boolean"!=typeof e.isEmptyCurrent?"isEmptyCurrent: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryGetRevisionResponse)return e;var t=new i.RevisionHistoryGetRevisionResponse;return null!=e.revisionId&&(t.revisionId=String(e.revisionId)),null!=e.name&&(t.name=String(e.name)),null!=e.creatorId&&(t.creatorId=String(e.creatorId)),null!=e.authorsIds&&(t.authorsIds=String(e.authorsIds)),null!=e.diffData&&(t.diffData=String(e.diffData)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.toVersion&&(t.toVersion=e.toVersion>>>0),null!=e.fromVersion&&(t.fromVersion=e.fromVersion>>>0),null!=e.isEmptyCurrent&&(t.isEmptyCurrent=Boolean(e.isEmptyCurrent)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.revisionId="",n.name="",n.creatorId="",n.authorsIds="",n.diffData="",n.createdAt="",n.attributes="",n.toVersion=0,n.fromVersion=0,n.isEmptyCurrent=!1),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.creatorId&&e.hasOwnProperty("creatorId")&&(n.creatorId=e.creatorId),null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&(n.authorsIds=e.authorsIds),null!=e.diffData&&e.hasOwnProperty("diffData")&&(n.diffData=e.diffData),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.toVersion&&e.hasOwnProperty("toVersion")&&(n.toVersion=e.toVersion),null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&(n.fromVersion=e.fromVersion),null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&(n.isEmptyCurrent=e.isEmptyCurrent),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryGetRevisionResponse"},r}(),i.RevisionHistoryUpdateRevisionsResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.requestId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(8).uint32(e.requestId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryUpdateRevisionsResponse;t.pos<r;){var o=t.uint32();o>>>3==1?s.requestId=t.uint32():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId)?"requestId: integer expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryUpdateRevisionsResponse)return e;var t=new i.RevisionHistoryUpdateRevisionsResponse;return null!=e.requestId&&(t.requestId=e.requestId>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.requestId=0),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryUpdateRevisionsResponse"},r}(),i.SessionsSocketDescriptor=function(){function r(e){if(this.permissions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.session="",r.prototype.user="",r.prototype.role="",r.prototype.permissions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&n.uint32(10).string(e.session),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&n.uint32(18).string(e.user),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&n.uint32(26).string(e.role),null!=e.permissions&&e.permissions.length)for(var i=0;i<e.permissions.length;++i)n.uint32(34).string(e.permissions[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsSocketDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.session=t.string();break;case 2:s.user=t.string();break;case 3:s.role=t.string();break;case 4:s.permissions&&s.permissions.length||(s.permissions=[]),s.permissions.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.session&&e.hasOwnProperty("session")&&!n.isString(e.session))return"session: string expected";if(null!=e.user&&e.hasOwnProperty("user")&&!n.isString(e.user))return"user: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!n.isString(e.role))return"role: string expected";if(null!=e.permissions&&e.hasOwnProperty("permissions")){if(!Array.isArray(e.permissions))return"permissions: array expected";for(var t=0;t<e.permissions.length;++t)if(!n.isString(e.permissions[t]))return"permissions: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.SessionsSocketDescriptor)return e;var t=new i.SessionsSocketDescriptor;if(null!=e.session&&(t.session=String(e.session)),null!=e.user&&(t.user=String(e.user)),null!=e.role&&(t.role=String(e.role)),e.permissions){if(!Array.isArray(e.permissions))throw TypeError(".SessionsSocketDescriptor.permissions: array expected");t.permissions=[];for(var n=0;n<e.permissions.length;++n)t.permissions[n]=String(e.permissions[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.permissions=[]),t.defaults&&(n.session="",n.user="",n.role=""),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.user&&e.hasOwnProperty("user")&&(n.user=e.user),null!=e.role&&e.hasOwnProperty("role")&&(n.role=e.role),e.permissions&&e.permissions.length){n.permissions=[];for(var i=0;i<e.permissions.length;++i)n.permissions[i]=e.permissions[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsSocketDescriptor"},r}(),i.SessionsConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.sessionType=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.sessionType&&Object.hasOwnProperty.call(e,"sessionType")&&n.uint32(16).uint32(e.sessionType),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.sessionType=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.sessionType&&e.hasOwnProperty("sessionType")&&!n.isInteger(e.sessionType)?"sessionType: integer expected":null},r.fromObject=function(e){if(e instanceof i.SessionsConnectMessage)return e;var t=new i.SessionsConnectMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.sessionType&&(t.sessionType=e.sessionType>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.sessionType=0),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.sessionType&&e.hasOwnProperty("sessionType")&&(n.sessionType=e.sessionType),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsConnectMessage"},r}(),i.SocketConnectMessage=function(){function r(e){if(this.permissions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.userId="",r.prototype.role="",r.prototype.permissions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(18).string(e.userId),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&n.uint32(26).string(e.role),null!=e.permissions&&e.permissions.length)for(var i=0;i<e.permissions.length;++i)n.uint32(34).string(e.permissions[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SocketConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.userId=t.string();break;case 3:s.role=t.string();break;case 4:s.permissions&&s.permissions.length||(s.permissions=[]),s.permissions.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId))return"userId: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!n.isString(e.role))return"role: string expected";if(null!=e.permissions&&e.hasOwnProperty("permissions")){if(!Array.isArray(e.permissions))return"permissions: array expected";for(var t=0;t<e.permissions.length;++t)if(!n.isString(e.permissions[t]))return"permissions: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.SocketConnectMessage)return e;var t=new i.SocketConnectMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.role&&(t.role=String(e.role)),e.permissions){if(!Array.isArray(e.permissions))throw TypeError(".SocketConnectMessage.permissions: array expected");t.permissions=[];for(var n=0;n<e.permissions.length;++n)t.permissions[n]=String(e.permissions[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.permissions=[]),t.defaults&&(n.id="",n.userId="",n.role=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.role&&e.hasOwnProperty("role")&&(n.role=e.role),e.permissions&&e.permissions.length){n.permissions=[];for(var i=0;i<e.permissions.length;++i)n.permissions[i]=e.permissions[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SocketConnectMessage"},r}(),i.SocketDisconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SocketDisconnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.id=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null},r.fromObject=function(e){if(e instanceof i.SocketDisconnectMessage)return e;var t=new i.SocketDisconnectMessage;return null!=e.id&&(t.id=String(e.id)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SocketDisconnectMessage"},r}(),i.SessionsConnectResponse=function(){function r(e){if(this.sockets=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.sockets=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.sockets&&e.sockets.length)for(var r=0;r<e.sockets.length;++r)i.SessionsSocketDescriptor.encode(e.sockets[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.sockets&&s.sockets.length||(s.sockets=[]),s.sockets.push(i.SessionsSocketDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.sockets&&e.hasOwnProperty("sockets")){if(!Array.isArray(e.sockets))return"sockets: array expected";for(var t=0;t<e.sockets.length;++t){var r=i.SessionsSocketDescriptor.verify(e.sockets[t]);if(r)return"sockets."+r}}return null},r.fromObject=function(e){if(e instanceof i.SessionsConnectResponse)return e;var t=new i.SessionsConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.sockets){if(!Array.isArray(e.sockets))throw TypeError(".SessionsConnectResponse.sockets: array expected");t.sockets=[];for(var n=0;n<e.sockets.length;++n){if("object"!=typeof e.sockets[n])throw TypeError(".SessionsConnectResponse.sockets: object expected");t.sockets[n]=i.SessionsSocketDescriptor.fromObject(e.sockets[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sockets=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.sockets&&e.sockets.length){n.sockets=[];for(var r=0;r<e.sockets.length;++r)n.sockets[r]=i.SessionsSocketDescriptor.toObject(e.sockets[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsConnectResponse"},r}(),i.SuggestionDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SuggestionDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.SuggestionDescriptor)return e;var t=new i.SuggestionDescriptor;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SuggestionDescriptor"},r}(),i.TrackChangesAddSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.prototype.type="",r.prototype.data="",r.prototype.originalSuggestionId="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(34).string(e.data),null!=e.originalSuggestionId&&Object.hasOwnProperty.call(e,"originalSuggestionId")&&n.uint32(42).string(e.originalSuggestionId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(50).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesAddSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;case 3:s.type=t.string();break;case 4:s.data=t.string();break;case 5:s.originalSuggestionId=t.string();break;case 6:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.originalSuggestionId&&e.hasOwnProperty("originalSuggestionId")&&!n.isString(e.originalSuggestionId)?"originalSuggestionId: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesAddSuggestionMessage)return e;var t=new i.TrackChangesAddSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.type&&(t.type=String(e.type)),null!=e.data&&(t.data=String(e.data)),null!=e.originalSuggestionId&&(t.originalSuggestionId=String(e.originalSuggestionId)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId="",n.type="",n.data="",n.originalSuggestionId="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.originalSuggestionId&&e.hasOwnProperty("originalSuggestionId")&&(n.originalSuggestionId=e.originalSuggestionId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesAddSuggestionMessage"},r}(),i.TrackChangesBatchUpdateSuggestionsStateMessage=function(){function r(e){if(this.ids=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.ids=n.emptyArray,r.prototype.documentId="",r.prototype.state="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.ids&&e.ids.length)for(var i=0;i<e.ids.length;++i)n.uint32(10).string(e.ids[i]);return null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(26).string(e.state),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesBatchUpdateSuggestionsStateMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.ids&&s.ids.length||(s.ids=[]),s.ids.push(t.string());break;case 2:s.documentId=t.string();break;case 3:s.state=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.ids&&e.hasOwnProperty("ids")){if(!Array.isArray(e.ids))return"ids: array expected";for(var t=0;t<e.ids.length;++t)if(!n.isString(e.ids[t]))return"ids: string[] expected"}return null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesBatchUpdateSuggestionsStateMessage)return e;var t=new i.TrackChangesBatchUpdateSuggestionsStateMessage;if(e.ids){if(!Array.isArray(e.ids))throw TypeError(".TrackChangesBatchUpdateSuggestionsStateMessage.ids: array expected");t.ids=[];for(var n=0;n<e.ids.length;++n)t.ids[n]=String(e.ids[n])}return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.state&&(t.state=String(e.state)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ids=[]),t.defaults&&(n.documentId="",n.state=""),e.ids&&e.ids.length){n.ids=[];for(var i=0;i<e.ids.length;++i)n.ids[i]=e.ids[i]}return null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesBatchUpdateSuggestionsStateMessage"},r}(),i.TrackChangesConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesConnectMessage)return e;var t=new i.TrackChangesConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesConnectMessage"},r}(),i.TrackChangesGetAllSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetAllSuggestionMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetAllSuggestionMessage)return e;var t=new i.TrackChangesGetAllSuggestionMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetAllSuggestionMessage"},r}(),i.TrackChangesGetSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetSuggestionMessage)return e;var t=new i.TrackChangesGetSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetSuggestionMessage"},r}(),i.TrackChangesUpdateSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.prototype.hasComments=!1,r.prototype.isHasCommentsModified=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(24).bool(e.hasComments),null!=e.isHasCommentsModified&&Object.hasOwnProperty.call(e,"isHasCommentsModified")&&n.uint32(32).bool(e.isHasCommentsModified),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(42).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(50).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesUpdateSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;case 3:s.hasComments=t.bool();break;case 4:s.isHasCommentsModified=t.bool();break;case 5:s.state=t.string();break;case 6:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.isHasCommentsModified&&e.hasOwnProperty("isHasCommentsModified")&&"boolean"!=typeof e.isHasCommentsModified?"isHasCommentsModified: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesUpdateSuggestionMessage)return e;var t=new i.TrackChangesUpdateSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.isHasCommentsModified&&(t.isHasCommentsModified=Boolean(e.isHasCommentsModified)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId="",n.hasComments=!1,n.isHasCommentsModified=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.isHasCommentsModified&&e.hasOwnProperty("isHasCommentsModified")&&(n.isHasCommentsModified=e.isHasCommentsModified),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesUpdateSuggestionMessage"},r}(),i.TrackChangesAddSuggestionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesAddSuggestionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesAddSuggestionResponse)return e;var t=new i.TrackChangesAddSuggestionResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesAddSuggestionResponse"},r}(),i.TrackChangesConnectResponse=function(){function r(e){if(this.suggestions=[],this.suggestionsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.suggestions=n.emptyArray,r.prototype.suggestionsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.suggestions&&e.suggestions.length)for(var r=0;r<e.suggestions.length;++r)n.uint32(18).string(e.suggestions[r]);if(null!=e.suggestionsV2&&e.suggestionsV2.length)for(r=0;r<e.suggestionsV2.length;++r)i.SuggestionDescriptor.encode(e.suggestionsV2[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.suggestions&&s.suggestions.length||(s.suggestions=[]),s.suggestions.push(t.string());break;case 3:s.suggestionsV2&&s.suggestionsV2.length||(s.suggestionsV2=[]),s.suggestionsV2.push(i.SuggestionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.suggestions&&e.hasOwnProperty("suggestions")){if(!Array.isArray(e.suggestions))return"suggestions: array expected";for(var t=0;t<e.suggestions.length;++t)if(!n.isString(e.suggestions[t]))return"suggestions: string[] expected"}if(null!=e.suggestionsV2&&e.hasOwnProperty("suggestionsV2")){if(!Array.isArray(e.suggestionsV2))return"suggestionsV2: array expected";for(t=0;t<e.suggestionsV2.length;++t){var r=i.SuggestionDescriptor.verify(e.suggestionsV2[t]);if(r)return"suggestionsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.TrackChangesConnectResponse)return e;var t=new i.TrackChangesConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.suggestions){if(!Array.isArray(e.suggestions))throw TypeError(".TrackChangesConnectResponse.suggestions: array expected");t.suggestions=[];for(var n=0;n<e.suggestions.length;++n)t.suggestions[n]=String(e.suggestions[n])}if(e.suggestionsV2){if(!Array.isArray(e.suggestionsV2))throw TypeError(".TrackChangesConnectResponse.suggestionsV2: array expected");for(t.suggestionsV2=[],n=0;n<e.suggestionsV2.length;++n){if("object"!=typeof e.suggestionsV2[n])throw TypeError(".TrackChangesConnectResponse.suggestionsV2: object expected");t.suggestionsV2[n]=i.SuggestionDescriptor.fromObject(e.suggestionsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.suggestions=[],n.suggestionsV2=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.suggestions&&e.suggestions.length){n.suggestions=[];for(var r=0;r<e.suggestions.length;++r)n.suggestions[r]=e.suggestions[r]}if(e.suggestionsV2&&e.suggestionsV2.length)for(n.suggestionsV2=[],r=0;r<e.suggestionsV2.length;++r)n.suggestionsV2[r]=i.SuggestionDescriptor.toObject(e.suggestionsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesConnectResponse"},r}(),i.TrackChangesGetAllSuggestionsResponse=function(){function r(e){if(this.suggestions=[],this.suggestionsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.suggestions=n.emptyArray,r.prototype.suggestionsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.suggestions&&e.suggestions.length)for(var r=0;r<e.suggestions.length;++r)n.uint32(10).string(e.suggestions[r]);if(null!=e.suggestionsV2&&e.suggestionsV2.length)for(r=0;r<e.suggestionsV2.length;++r)i.SuggestionDescriptor.encode(e.suggestionsV2[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetAllSuggestionsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.suggestions&&s.suggestions.length||(s.suggestions=[]),s.suggestions.push(t.string());break;case 2:s.suggestionsV2&&s.suggestionsV2.length||(s.suggestionsV2=[]),s.suggestionsV2.push(i.SuggestionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.suggestions&&e.hasOwnProperty("suggestions")){if(!Array.isArray(e.suggestions))return"suggestions: array expected";for(var t=0;t<e.suggestions.length;++t)if(!n.isString(e.suggestions[t]))return"suggestions: string[] expected"}if(null!=e.suggestionsV2&&e.hasOwnProperty("suggestionsV2")){if(!Array.isArray(e.suggestionsV2))return"suggestionsV2: array expected";for(t=0;t<e.suggestionsV2.length;++t){var r=i.SuggestionDescriptor.verify(e.suggestionsV2[t]);if(r)return"suggestionsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetAllSuggestionsResponse)return e;var t=new i.TrackChangesGetAllSuggestionsResponse;if(e.suggestions){if(!Array.isArray(e.suggestions))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestions: array expected");t.suggestions=[];for(var n=0;n<e.suggestions.length;++n)t.suggestions[n]=String(e.suggestions[n])}if(e.suggestionsV2){if(!Array.isArray(e.suggestionsV2))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: array expected");for(t.suggestionsV2=[],n=0;n<e.suggestionsV2.length;++n){if("object"!=typeof e.suggestionsV2[n])throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: object expected");t.suggestionsV2[n]=i.SuggestionDescriptor.fromObject(e.suggestionsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.suggestions=[],n.suggestionsV2=[]),e.suggestions&&e.suggestions.length){n.suggestions=[];for(var r=0;r<e.suggestions.length;++r)n.suggestions[r]=e.suggestions[r]}if(e.suggestionsV2&&e.suggestionsV2.length)for(n.suggestionsV2=[],r=0;r<e.suggestionsV2.length;++r)n.suggestionsV2[r]=i.SuggestionDescriptor.toObject(e.suggestionsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetAllSuggestionsResponse"},r}(),i.TrackChangesGetSuggestionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetSuggestionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetSuggestionResponse)return e;var t=new i.TrackChangesGetSuggestionResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetSuggestionResponse"},r}(),i.UserDescriptor=function(){function r(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.attributes=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.attributes&&e.attributes.length)for(var r=0;r<e.attributes.length;++r)i.KeyValueDescriptor.encode(e.attributes[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.UserDescriptor;t.pos<r;){var o=t.uint32();o>>>3==1?(s.attributes&&s.attributes.length||(s.attributes=[]),s.attributes.push(i.KeyValueDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")){if(!Array.isArray(e.attributes))return"attributes: array expected";for(var t=0;t<e.attributes.length;++t){var n=i.KeyValueDescriptor.verify(e.attributes[t]);if(n)return"attributes."+n}}return null},r.fromObject=function(e){if(e instanceof i.UserDescriptor)return e;var t=new i.UserDescriptor;if(e.attributes){if(!Array.isArray(e.attributes))throw TypeError(".UserDescriptor.attributes: array expected");t.attributes=[];for(var n=0;n<e.attributes.length;++n){if("object"!=typeof e.attributes[n])throw TypeError(".UserDescriptor.attributes: object expected");t.attributes[n]=i.KeyValueDescriptor.fromObject(e.attributes[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.attributes=[]),e.attributes&&e.attributes.length){n.attributes=[];for(var r=0;r<e.attributes.length;++r)n.attributes[r]=i.KeyValueDescriptor.toObject(e.attributes[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/UserDescriptor"},r}(),i.GetManyUsersMessage=function(){function r(e){if(this.ids=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.ids=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.ids&&e.ids.length)for(var i=0;i<e.ids.length;++i)n.uint32(10).string(e.ids[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetManyUsersMessage;t.pos<r;){var o=t.uint32();o>>>3==1?(s.ids&&s.ids.length||(s.ids=[]),s.ids.push(t.string())):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.ids&&e.hasOwnProperty("ids")){if(!Array.isArray(e.ids))return"ids: array expected";for(var t=0;t<e.ids.length;++t)if(!n.isString(e.ids[t]))return"ids: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.GetManyUsersMessage)return e;var t=new i.GetManyUsersMessage;if(e.ids){if(!Array.isArray(e.ids))throw TypeError(".GetManyUsersMessage.ids: array expected");t.ids=[];for(var n=0;n<e.ids.length;++n)t.ids[n]=String(e.ids[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ids=[]),e.ids&&e.ids.length){n.ids=[];for(var i=0;i<e.ids.length;++i)n.ids[i]=e.ids[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetManyUsersMessage"},r}(),i.GetUserMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetUserMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.id=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null},r.fromObject=function(e){if(e instanceof i.GetUserMessage)return e;var t=new i.GetUserMessage;return null!=e.id&&(t.id=String(e.id)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetUserMessage"},r}(),i.GetManyUsersResponse=function(){function r(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.users=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.users&&e.users.length)for(var r=0;r<e.users.length;++r)i.UserDescriptor.encode(e.users[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetManyUsersResponse;t.pos<r;){var o=t.uint32();o>>>3==1?(s.users&&s.users.length||(s.users=[]),s.users.push(i.UserDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.users&&e.hasOwnProperty("users")){if(!Array.isArray(e.users))return"users: array expected";for(var t=0;t<e.users.length;++t){var n=i.UserDescriptor.verify(e.users[t]);if(n)return"users."+n}}return null},r.fromObject=function(e){if(e instanceof i.GetManyUsersResponse)return e;var t=new i.GetManyUsersResponse;if(e.users){if(!Array.isArray(e.users))throw TypeError(".GetManyUsersResponse.users: array expected");t.users=[];for(var n=0;n<e.users.length;++n){if("object"!=typeof e.users[n])throw TypeError(".GetManyUsersResponse.users: object expected");t.users[n]=i.UserDescriptor.fromObject(e.users[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.users=[]),e.users&&e.users.length){n.users=[];for(var r=0;r<e.users.length;++r)n.users[r]=i.UserDescriptor.toObject(e.users[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetManyUsersResponse"},r}(),i.GetUserResponse=function(){function r(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.attributes=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.attributes&&e.attributes.length)for(var r=0;r<e.attributes.length;++r)i.KeyValueDescriptor.encode(e.attributes[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetUserResponse;t.pos<r;){var o=t.uint32();o>>>3==1?(s.attributes&&s.attributes.length||(s.attributes=[]),s.attributes.push(i.KeyValueDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")){if(!Array.isArray(e.attributes))return"attributes: array expected";for(var t=0;t<e.attributes.length;++t){var n=i.KeyValueDescriptor.verify(e.attributes[t]);if(n)return"attributes."+n}}return null},r.fromObject=function(e){if(e instanceof i.GetUserResponse)return e;var t=new i.GetUserResponse;if(e.attributes){if(!Array.isArray(e.attributes))throw TypeError(".GetUserResponse.attributes: array expected");t.attributes=[];for(var n=0;n<e.attributes.length;++n){if("object"!=typeof e.attributes[n])throw TypeError(".GetUserResponse.attributes: object expected");t.attributes[n]=i.KeyValueDescriptor.fromObject(e.attributes[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.attributes=[]),e.attributes&&e.attributes.length){n.attributes=[];for(var r=0;r<e.attributes.length;++r)n.attributes[r]=i.KeyValueDescriptor.toObject(e.attributes[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetUserResponse"},r}(),i.ChannelMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.type=0,r.prototype.socketId="",r.prototype.data=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).uint32(e.type),null!=e.socketId&&Object.hasOwnProperty.call(e,"socketId")&&n.uint32(18).string(e.socketId),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(26).bytes(e.data),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ChannelMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.type=t.uint32();break;case 2:s.socketId=t.string();break;case 3:s.data=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isInteger(e.type)?"type: integer expected":null!=e.socketId&&e.hasOwnProperty("socketId")&&!n.isString(e.socketId)?"socketId: string expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null},r.fromObject=function(e){if(e instanceof i.ChannelMessage)return e;var t=new i.ChannelMessage;return null!=e.type&&(t.type=e.type>>>0),null!=e.socketId&&(t.socketId=String(e.socketId)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=0,i.socketId="",t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data)))),null!=e.type&&e.hasOwnProperty("type")&&(i.type=e.type),null!=e.socketId&&e.hasOwnProperty("socketId")&&(i.socketId=e.socketId),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ChannelMessage"},r}(),i.BytesBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=n.newBuffer([]),r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).bytes(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.BytesBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.bytes();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.BytesBytesPacketDataMessage)return e;var t=new i.BytesBytesPacketDataMessage;return null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data))),t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/BytesBytesPacketDataMessage"},r}(),i.NumberBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.NumberBytesPacketDataMessage)return e;var t=new i.NumberBytesPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data=0,t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberBytesPacketDataMessage"},r}(),i.NumberNumberPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(16).uint32(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberNumberPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isInteger(e.data1)?"data1: integer expected":null},r.fromObject=function(e){if(e instanceof i.NumberNumberPacketDataMessage)return e;var t=new i.NumberNumberPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=e.data1>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=0),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberNumberPacketDataMessage"},r}(),i.NumberObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.NumberObjectPacketDataMessage)return e;var t=new i.NumberObjectPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberObjectPacketDataMessage"},r}(),i.NumberStringPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberStringPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.NumberStringPacketDataMessage)return e;var t=new i.NumberStringPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberStringPacketDataMessage"},r}(),i.ObjectBufferPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ObjectBufferPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.ObjectBufferPacketDataMessage)return e;var t=new i.ObjectBufferPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data="",t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ObjectBufferPacketDataMessage"},r}(),i.ObjectObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ObjectObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.ObjectObjectPacketDataMessage)return e;var t=new i.ObjectObjectPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ObjectObjectPacketDataMessage"},r}(),i.PacketMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.type=0,r.prototype.id=0,r.prototype.nsp="",r.prototype.data=n.newBuffer([]),r.prototype.options=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).uint32(e.type),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(16).uint32(e.id),null!=e.nsp&&Object.hasOwnProperty.call(e,"nsp")&&n.uint32(26).string(e.nsp),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(34).bytes(e.data),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&n.uint32(42).bytes(e.options),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.PacketMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.type=t.uint32();break;case 2:s.id=t.uint32();break;case 3:s.nsp=t.string();break;case 4:s.data=t.bytes();break;case 5:s.options=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isInteger(e.type)?"type: integer expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isInteger(e.id)?"id: integer expected":null!=e.nsp&&e.hasOwnProperty("nsp")&&!n.isString(e.nsp)?"nsp: string expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null!=e.options&&e.hasOwnProperty("options")&&!(e.options&&"number"==typeof e.options.length||n.isString(e.options))?"options: buffer expected":null},r.fromObject=function(e){if(e instanceof i.PacketMessage)return e;var t=new i.PacketMessage;return null!=e.type&&(t.type=e.type>>>0),null!=e.id&&(t.id=e.id>>>0),null!=e.nsp&&(t.nsp=String(e.nsp)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),null!=e.options&&("string"==typeof e.options?n.base64.decode(e.options,t.options=n.newBuffer(n.base64.length(e.options)),0):e.options.length>=0&&(t.options=e.options)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=0,i.id=0,i.nsp="",t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data))),t.bytes===String?i.options="":(i.options=[],t.bytes!==Array&&(i.options=n.newBuffer(i.options)))),null!=e.type&&e.hasOwnProperty("type")&&(i.type=e.type),null!=e.id&&e.hasOwnProperty("id")&&(i.id=e.id),null!=e.nsp&&e.hasOwnProperty("nsp")&&(i.nsp=e.nsp),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.options&&e.hasOwnProperty("options")&&(i.options=t.bytes===String?n.base64.encode(e.options,0,e.options.length):t.bytes===Array?Array.prototype.slice.call(e.options):e.options),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/PacketMessage"},r}(),i.PacketOptionsMessage=function(){function r(e){if(this.rooms=[],this.except=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.flags="",r.prototype.rooms=n.emptyArray,r.prototype.except=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&n.uint32(10).string(e.flags),null!=e.rooms&&e.rooms.length)for(var i=0;i<e.rooms.length;++i)n.uint32(18).string(e.rooms[i]);if(null!=e.except&&e.except.length)for(i=0;i<e.except.length;++i)n.uint32(26).string(e.except[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.PacketOptionsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.flags=t.string();break;case 2:s.rooms&&s.rooms.length||(s.rooms=[]),s.rooms.push(t.string());break;case 3:s.except&&s.except.length||(s.except=[]),s.except.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.flags&&e.hasOwnProperty("flags")&&!n.isString(e.flags))return"flags: string expected";if(null!=e.rooms&&e.hasOwnProperty("rooms")){if(!Array.isArray(e.rooms))return"rooms: array expected";for(var t=0;t<e.rooms.length;++t)if(!n.isString(e.rooms[t]))return"rooms: string[] expected"}if(null!=e.except&&e.hasOwnProperty("except")){if(!Array.isArray(e.except))return"except: array expected";for(t=0;t<e.except.length;++t)if(!n.isString(e.except[t]))return"except: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.PacketOptionsMessage)return e;var t=new i.PacketOptionsMessage;if(null!=e.flags&&(t.flags=String(e.flags)),e.rooms){if(!Array.isArray(e.rooms))throw TypeError(".PacketOptionsMessage.rooms: array expected");t.rooms=[];for(var n=0;n<e.rooms.length;++n)t.rooms[n]=String(e.rooms[n])}if(e.except){if(!Array.isArray(e.except))throw TypeError(".PacketOptionsMessage.except: array expected");for(t.except=[],n=0;n<e.except.length;++n)t.except[n]=String(e.except[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.rooms=[],n.except=[]),t.defaults&&(n.flags=""),null!=e.flags&&e.hasOwnProperty("flags")&&(n.flags=e.flags),e.rooms&&e.rooms.length){n.rooms=[];for(var i=0;i<e.rooms.length;++i)n.rooms[i]=e.rooms[i]}if(e.except&&e.except.length)for(n.except=[],i=0;i<e.except.length;++i)n.except[i]=e.except[i];return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/PacketOptionsMessage"},r}(),i.StringBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.StringBytesPacketDataMessage)return e;var t=new i.StringBytesPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data="",t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringBytesPacketDataMessage"},r}(),i.StringNumberPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(16).uint32(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringNumberPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isInteger(e.data1)?"data1: integer expected":null},r.fromObject=function(e){if(e instanceof i.StringNumberPacketDataMessage)return e;var t=new i.StringNumberPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=e.data1>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=0),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringNumberPacketDataMessage"},r}(),i.StringObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.StringObjectPacketDataMessage)return e;var t=new i.StringObjectPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringObjectPacketDataMessage"},r}(),i.StringStringPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringStringPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.StringStringPacketDataMessage)return e;var t=new i.StringStringPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringStringPacketDataMessage"},r}(),i})();class MessagesCompressor{static decode(e,t){const n=_getType(t).decode("undefined"==typeof window?e:new Uint8Array(e));return t.fromJSON({...n})}static encode(e){const t=_getType(e.constructor),n=e.toJSON(),i=t.verify(n);if(i)throw Error(i);return t.encode(t.create(n)).finish()}}function _getType(e){return messages$1[e.DESCRIPTOR_NAME]}class GetManyUsersMessage extends Message{ids;static TYPE="22";static READABLE_TYPE_NAME="getManyUsers";static DESCRIPTOR_NAME="GetManyUsersMessage";static DESCRIPTOR={fields:{ids:{id:1,type:"string",rule:"repeated"}}};constructor(e){super(),this.ids=e}toJSON(){return{ids:this.ids}}static fromJSON(e){return new GetManyUsersMessage(e.ids)}}class GetManyUsersResponse extends Message{users;static DESCRIPTOR_NAME="GetManyUsersResponse";static DESCRIPTOR={fields:{users:{rule:"repeated",type:"UserDescriptor",id:1}}};constructor(e){super(),this.users=e}toJSON(){return{users:this.users.map(_userToJson)}}static fromJSON(e){return new GetManyUsersResponse(e.users.map(_userFromJson))}}function _userToJson(e){return{attributes:Object.keys(e).map((t=>({key:t,value:JSON.stringify(e[t])})))}}function _userFromJson(e){return e.attributes.reduce(((e,t)=>(e[t.key]=t.value?JSON.parse(t.value):null,e)),{})}class User{static _SERVICE=2;id;_attributes;constructor(e={}){this._attributes=new Map;for(const t of Object.keys(e))"id"!==t?(this._attributes.set(t,e[t]),Object.defineProperty(this,t,{enumerable:!0,configurable:!1,get:()=>this._attributes.get(t)})):this.id=e.id}static fromData(e){return new User(e)}static async get(e,t){const n=new GetUserMessage(t);try{const t=await e._sendRequest(User._SERVICE,GetUserMessage.TYPE,MessagesCompressor.encode(n)),i=MessagesCompressor.decode(t,GetUserResponse);return new User(i.attributes)}catch(e){return new User({id:t})}}static async getMany(e,t){const n=new GetManyUsersMessage(t);try{const t=await e._sendRequest(User._SERVICE,GetManyUsersMessage.TYPE,MessagesCompressor.encode(n));return MessagesCompressor.decode(t,GetManyUsersResponse).users.map((e=>new User(e)))}catch(e){return t.map((e=>new User({id:e})))}}}class ChannelMessage extends Message{type;socketId;data;static DESCRIPTOR_NAME="ChannelMessage";static DESCRIPTOR={fields:{type:{type:"uint32",id:1},socketId:{type:"string",id:2},data:{type:"bytes",id:3}}};constructor(e,t,n){super(),this.type=e,this.socketId=t,this.data=n}toJSON(){return{type:this.type,socketId:this.socketId,data:this.data}}static fromJSON(e){return new ChannelMessage(e.type,e.socketId,e.data)}}class Channel extends(/*   -- @preserve */
EmitterMixin()){_channelName;_wsGateway;_socket;constructor(e,t,n){super(),this._channelName=e,this._wsGateway=t,this._socket=n,this._subscribeToChannel()}remove(){this._socket.off(this._channelName)}getEventName(e,t=!1){let n="";return t&&(n+="all:"),n+="event",e&&(n+=":"+e),n}_subscribeToChannel(){this._socket.on(this._channelName,(e=>{const t=MessagesCompressor.decode(e,ChannelMessage);this.fire(this.getEventName(t.type,!0),t.data,t.socketId),t.socketId!==this._wsGateway.socketId&&this.fire(this.getEventName(t.type),t.data,t.socketId)}))}}class CKEditorCloudServicesError extends Error{context;code;data;constructor(e,t,n=null,i={}){super("cloud-services-internal-error: "+e),this.context=t,this.code=n,this.data=i,this.name="CKEditorError"}static fromPublicError(e){return new CKEditorCloudServicesError(function(e){let t="cloud-services-error: "+e.message;return e.data&&(t+="\nError data: "+JSON.stringify(e.data)),e.explanation&&(t+="\nExplanation: "+e.explanation),e.action&&(t+="\nAction: "+e.action),e.traceId&&(t+="\nTraceId: "+e.traceId),e.code&&(t+="\nCode: "+e.code),t}(e),e)}}class CKEditorCloudServicesServerError extends Error{code;traceId;data;constructor(e,t){super(),this.name="CKEditorCloudServicesServerError",this.stack=void 0,this.message=e,this.code=t.code,this.traceId=t.traceId,this.data=t.data}static fromPublicError(e){return new CKEditorCloudServicesServerError(function(e){let t="cloud-services-server-error: "+e.message;return e.explanation&&(t+="\nExplanation: "+e.explanation),e.action&&(t+="\nAction: "+e.action),e.traceId&&(t+="\nTraceId: "+e.traceId),e.code&&(t+="\nCode: "+e.code),t}(e),e)}}class PacketOptionsMessage extends Message{flags;rooms;except;static TYPE=11;static DESCRIPTOR_NAME="PacketOptionsMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{flags:{type:"string",id:1},rooms:{type:"string",id:2,rule:"repeated"},except:{type:"string",id:3,rule:"repeated"}}}))();constructor(e,t=[],n=[]){super(),this.flags=e,this.rooms=t,this.except=n}toJSON(){return{flags:this.flags?JSON.stringify(this.flags):void 0,rooms:this.rooms?.length?this.rooms:void 0,except:this.except?.length?this.except:void 0}}static fromJSON(e){return new PacketOptionsMessage(e.flags&&JSON.parse(e.flags),e.rooms,e.except)}}const IS_NODE=/*   -- @preserve */
(()=>!("undefined"==typeof process||!process.versions||!process.versions.node))(),MessageDataTypes_BUFFER=1,MessageDataTypes_STRING=2,MessageDataTypes_NUMBER=3,MessageDataTypes_OBJECT=4;class ParserUtils{static getPacketType(...e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*Math.pow(10,e.length-n-1);return t}static getType(e){if(ParserUtils.isBuffer(e))return MessageDataTypes_BUFFER;const t=typeof e;return"string"===t?MessageDataTypes_STRING:"number"===t?MessageDataTypes_NUMBER:MessageDataTypes_OBJECT}static isBuffer(e){return IS_NODE&&Buffer.isBuffer(e)||e instanceof ArrayBuffer||e instanceof Uint8Array||this._isBufferView(e)}static _isBufferView(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}}class PackageDataMessage extends Message{data;data1;static create(e,t){throw new TypeError("Must be implemented in a child class!")}}class NumberBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="NumberBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberBytesPacketDataMessage(e,t)}}class StringBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="StringBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringBytesPacketDataMessage(e,t)}}class BytesBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_BUFFER,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="BytesBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"bytes",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new BytesBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new BytesBytesPacketDataMessage(e,t)}}class StringObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="StringObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new StringObjectPacketDataMessage(e.data,e.data1&&JSON.parse(e.data1))}static create(e,t){return new StringObjectPacketDataMessage(e,t)}}class NumberObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="NumberObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new NumberObjectPacketDataMessage(e.data,e.data1&&JSON.parse(e.data1))}static create(e,t){return new NumberObjectPacketDataMessage(e,t)}}class ObjectObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="ObjectObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new ObjectObjectPacketDataMessage(e.data&&JSON.parse(e.data),e.data1&&JSON.parse(e.data1))}static create(e,t){return new ObjectObjectPacketDataMessage(e,t)}}class ObjectBufferPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="ObjectBufferPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1}}static fromJSON(e){return new ObjectBufferPacketDataMessage(e.data&&JSON.parse(e.data),e.data1)}static create(e,t){return new ObjectBufferPacketDataMessage(e,t)}}class StringStringPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_STRING))();static DESCRIPTOR_NAME="StringStringPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringStringPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringStringPacketDataMessage(e,t)}}class StringNumberPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_NUMBER))();static DESCRIPTOR_NAME="StringNumberPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"uint32",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringNumberPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringNumberPacketDataMessage(e,t)}}class NumberNumberPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_NUMBER))();static DESCRIPTOR_NAME="NumberNumberPacketDataMessage";static DESCRIPTOR={fields:{data:{type:"uint32",id:1},data1:{type:"uint32",id:2}}};constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberNumberPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberNumberPacketDataMessage(e,t)}}class NumberStringPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_STRING))();static DESCRIPTOR_NAME="NumberStringPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberStringPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberStringPacketDataMessage(e,t)}}const PACKET_DATA_MESSAGES=/*   -- @preserve */
(()=>[NumberBytesPacketDataMessage,StringBytesPacketDataMessage,BytesBytesPacketDataMessage,StringObjectPacketDataMessage,NumberObjectPacketDataMessage,ObjectObjectPacketDataMessage,ObjectBufferPacketDataMessage,StringStringPacketDataMessage,StringNumberPacketDataMessage,NumberNumberPacketDataMessage,NumberStringPacketDataMessage].reduce(((e,t)=>(e[t.TYPE]=t,e)),{}))();class PacketMessage extends Message{type;data;id;nsp;options;static TYPE=10;static DESCRIPTOR_NAME="PacketMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{type:{type:"uint32",id:1},id:{type:"uint32",id:2},nsp:{type:"string",id:3},data:{type:"bytes",id:4},options:{type:"bytes",id:5}}}))();constructor(e,t,n,i="/",r){super(),this.type=e,this.data=t,this.id=n,this.nsp=i,this.options=r??new PacketOptionsMessage}get packetData(){return void 0===this.data.data&&void 0===this.data.data1?[]:this.data.data&&void 0===this.data.data1?[this.data.data]:[this.data.data,this.data.data1]}toJSON(){const e=MessagesCompressor.encode(this.options),t=MessagesCompressor.encode(this.data);return{type:this.type+10*this.data.constructor.TYPE,id:this.id,nsp:"/"===this.nsp?void 0:this.nsp,data:t,options:e}}static fromJSON(e){const t=Math.floor(e.type/10);return new PacketMessage(e.type-10*t,MessagesCompressor.decode(e.data,PACKET_DATA_MESSAGES[t]),e.id,e.nsp,e.options?MessagesCompressor.decode(e.options,PacketOptionsMessage):new PacketOptionsMessage)}static create(e,t={}){const n=ParserUtils.getPacketType(ParserUtils.getType(e.data[0]),ParserUtils.getType(e.data[1]??e.data[0]));return new PacketMessage(e.type,PACKET_DATA_MESSAGES[n].create(e.data[0],e.data[1]),e.id,e.nsp,new PacketOptionsMessage(t.flags,t.rooms,t.except))}}class PacketParser{encode(e,t,n,i="/",r={}){if(t.length>2)throw new Error("PacketParser supports only 2 elements in data");const s={type:e,data:t,id:n,nsp:i};return MessagesCompressor.encode(PacketMessage.create(s,r))}decode(e){const t=MessagesCompressor.decode(e,PacketMessage);return{packet:{id:t.id,type:t.type,data:t.packetData,nsp:t.nsp},options:{flags:t.options.flags,rooms:t.options.rooms,except:t.options.except}}}}const ENCODED_TYPES=/*   -- @preserve */
(()=>[PacketType.EVENT,PacketType.ACK,PacketType.BINARY_ACK,PacketType.BINARY_EVENT])();class Encoder extends Encoder$1{_packetParser;constructor(e){super(),this._packetParser=e??new PacketParser}encode(e){if(ENCODED_TYPES.includes(e.type))try{return[this._packetParser.encode(e.type,e.data,e.id,e.nsp)]}catch(e){console.error("Can not properly serialize or deserialize messages. Check the original error.",{originalError:{message:e.message}})}return super.encode(e)}}class Decoder extends Decoder$1{_packetParser;constructor(e){super(),this._packetParser=e??new PacketParser}add(e){if(!ParserUtils.isBuffer(e))return super.add(e);let t;try{t=this._packetParser.decode(e).packet}catch(t){return super.add(e)}super.emitReserved("decoded",t)}}class WebSocketRequest{_context;_deferredPromise;timeout;constructor(e,t){this._context=e,this._deferredPromise=/*   -- @preserve */
_deferPromise(),this.timeout=setTimeout((()=>this.error(new CKEditorCloudServicesError("Request timeout.",this._context))),t)}get promise(){return this._deferredPromise.promise}response(e){this._deferredPromise.resolve(e)}error(e){this._deferredPromise.reject(e)}}class WebSocketGatewayRequestsManager{_context;_requests;constructor(e){this._context=e,this._requests=new Set}async send(e,t=45e3){const n=this._createRequest(t);try{return e(n),await n.promise}finally{this._finishRequest(n)}}errorAll(e){for(const t of this._requests)t.error(e)}waitForAllRequests(e=45e3){return this._waitForRequests(e)}_createRequest(e){const t=new WebSocketRequest(this._context,e);return this._requests.add(t),t}_finishRequest(e){this._requests.delete(e),clearTimeout(e.timeout)}async _waitForRequests(e=5e3,t=0){return!this._requests.size||t>=e/500?Promise.resolve():(await new Promise((e=>{setTimeout(e,500)})),this._waitForRequests(e,t++))}}function _deferPromise(){let e,t;const n=new Promise(((n,i)=>{e=n,t=i}));return{resolve:e,reject:t,promise:n}}const WEB_SOCKET_GATEWAY_STATES={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"};let WebSocketGateway$1=class e extends(/*   -- @preserve */
_0x411082()){_requestsManager;_url;_socket;_socketAuth;_channels;_connectionAttempt=0;_token;_options;_connectionProvider;_userFactory;static STATE_DISCONNECTED=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.DISCONNECTED)();static STATE_CONNECTING=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.CONNECTING)();static STATE_CONNECTED=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.CONNECTED)();static _CHANGE_STATE_EVENT_PRIORITY=/*   -- @preserve */
(()=>priorities$1.get("highest")+999999)();constructor(t,n,i,r,s){if(super(),this._token=n,this._options=i??{},this._connectionProvider=r??lookup,this._userFactory=s??User.get,this._requestsManager=new WebSocketGatewayRequestsManager(this),this._channels=new Map,!t)throw new TypeError("Api address must be provided.");if(!this._token)throw new TypeError("Token must be provided.");this._options.requestTimeout||(this._options.requestTimeout=2e4),this._url=urlParse(t.replace(/^(?!(?:\w+:)?\/\/)/,"https://")),this.set("state",WEB_SOCKET_GATEWAY_STATES.DISCONNECTED),this.set("socketId",void 0),this.set("me",void 0),this.on("change:state",(async(t,n,i)=>{if(this._debugEvent("ws-gw:change:state",i),i!==e.STATE_CONNECTED){if(i===e.STATE_DISCONNECTED)return this._requestsManager.errorAll(new CKEditorCloudServicesError("Not connected.",this))}else try{this.me=await this._userFactory.call(User,this,this._socketAuth?.userId)}catch(e){}}),{priority:e._CHANGE_STATE_EVENT_PRIORITY}),this.on("error",((e,t)=>{this._options.onError?this._options.onError(t):console.error(t)}))}get sessionId(){return this.socketId}waitForAllRequests(e){return this._requestsManager.waitForAllRequests(e)}disconnect(){this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&(this._socket?.disconnect(),this._socket=void 0,this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED)}async reconnect(){this._socket||this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED||(await this._token.refreshToken(),await this._connect())}static async connect(t,n="local.cs.dev:443/ws-v2",i={},r=lookup,s=User.get){const o=new e(n,t,i,r,s);return await o._connect(),o}_sendRequest(t,n,i){if(!t)throw new CKEditorCloudServicesError("`serviceName` must be provided.",this);if(this.state!==e.STATE_CONNECTED)throw new CKEditorCloudServicesError("Not connected.",this);if(!this._socketAuth||!this._socketAuth.isAuthenticated)throw new CKEditorCloudServicesError("Not authenticated.",this);const r=new ArrayBuffer(i.length+2),s=new Uint8Array(r);return s[0]=t,s[1]=parseInt(n),s.set(i,2),this._emit(1,s)}_getChannel(e,t){const n=""+e+t;return!this._channels.has(n)&&this._socket&&this._channels.set(n,new Channel(n,this,this._socket)),this._channels.get(n)}_connect(){return new Promise(((e,t)=>{const n=this._setupSocket();!this.socketId&&n.io.on("reconnect_error",(()=>{this._debugEvent("reconnect_error"),this._reconnectionAttemptError(t)})),n.once("connect",(async()=>{this._debugEvent("once-connect");try{await this._onConnect(),e()}catch(e){t(e)}})),n.connect()}))}_getPortByProtocol(e){return["http:","ws:"].includes(e)?80:443}_setupSocket(){if(this._socket)return this._socket;const e=this._url.port||this._getPortByProtocol(this._url.protocol),t=(this._url.protocol||"https:")+"//"+this._url.hostname+":"+e,n=this._url.pathname.match(/^\/.*\/ws/)?this._url.pathname.split("/ws")[0]:"",i=this._connectionProvider(t,{parser:{Encoder:Encoder,Decoder:Decoder},path:n+"/ws-v2/ws",transports:["websocket"],timeout:void 0!==this._options.timeout?this._options.timeout:5e3,reconnection:void 0===this._options.autoReconnect||this._options.autoReconnect,reconnectionDelay:1e3,reconnectionDelayMax:5e3,rejectUnauthorized:void 0===this._options.rejectUnauthorized||this._options.rejectUnauthorized,query:{version:"52.6.11"},agent:this._options.agent??!1,closeOnBeforeunload:!1});return this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,i.on("connect",(()=>{this._debugEvent("connect"),this.socketId=i.id})),i.on("connect_error",(e=>{this._debugEvent("connect_error",e)})),i.on("disconnect",(()=>{this._debugEvent("disconnect"),this._onDisconnect()})),i.io.on("reconnect",(async()=>{this._debugEvent("reconnect"),await this._onReconnect()})),i.io.on("reconnect_attempt",(e=>{this._debugEvent("reconnect_attempt",e),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,this._connectionAttempt=e})),i.on("unauthorized",(e=>{this._debugEvent("unauthorized"),this._onUnauthorized(e)})),i.on("authenticationRequest",(async e=>{this._debugEvent("authenticationRequest",e.attempt),await this._onReconnect()})),this._socket=i,i}_emit(e,t){const n=this._socket;return this._requestsManager.send((i=>{n.emit(e,t,((e,t)=>{if(e)return i.error(CKEditorCloudServicesServerError.fromPublicError(e));i.response(t)}))}),this._options.requestTimeout)}_addAuthData(e,t){this._socketAuth={environmentId:e,userId:t,isAuthenticated:!0}}_removeAuthData(){this._socketAuth=void 0}async _onConnect(){await this._authenticate(this._token.value),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED;const e=async(e,t,n)=>{this._debugEvent("token:value:change");try{await this._authenticate(n)}catch(e){}};this._token.on("change:value",e),this._socket.io.off("reconnect_error"),this.on("disconnect",(()=>{this._token.off("change:value",e)}))}async _onReconnect(){await this._token.refreshToken(),await this._onConnect()}_onDisconnect(){this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._connectionAttempt=0,this.fire("disconnect");for(const e of this._channels.values())e.remove();this._channels.clear(),void 0===this._options.autoReconnect||this._options.autoReconnect||(this._socket=void 0)}_debugEvent(e,t){if(!this._isDebugModeEnabled())return;const n=void 0!==t?", data: "+t:"";console.info((new Date).toLocaleString()+" "+e+n)}_reconnectionAttemptError(e){this._connectionAttempt>=2&&(this.disconnect(),e(CKEditorCloudServicesError.fromPublicError({message:"The number of initial connection attempts exceeded.",explanation:"Three initial connection attempts failed. It can be caused by a slow, unstable, missing or blocked Internet connection.",action:"Please verify the stability of your Internet connection and ensure that no antivirus or firewall software blocks the Web Socket protocol connections."})))}_onUnauthorized({error:e}){this._removeAuthData(),this.fire("error",CKEditorCloudServicesServerError.fromPublicError(e))}async _authenticate(e){try{this._debugEvent("authenticate:start");const t=await this._emit(2,{token:e});this._debugEvent("authenticate:success","envId: "+t.environmentId+", userId: "+t.userId),this._addAuthData(t.environmentId,t.userId)}catch(e){throw this._debugEvent("authenticate:error",e.message),this._removeAuthData(),e}}_isDebugModeEnabled(){return!!_0x448d4e.window.localStorage&&"true"===(_0x448d4e.window.localStorage.getItem("csClientDebugMode")??"false").toLowerCase()}};class IsEditorBundleUploadedMessage extends Message{bundleVersion;static TYPE="131";static READABLE_TYPE_NAME="isEditorBundleUploaded";static DESCRIPTOR_NAME="IsEditorBundleUploadedMessage";static DESCRIPTOR={fields:{bundleVersion:{type:"string",id:1}}};constructor(e){super(),this.bundleVersion=e}toJSON(){return{bundleVersion:this.bundleVersion}}static fromJSON(e){return new IsEditorBundleUploadedMessage(e.bundleVersion)}}class IsEditorBundleUploadedResponse extends Message{isUploaded;static DESCRIPTOR_NAME="IsEditorBundleUploadedResponse";static DESCRIPTOR={fields:{isUploaded:{type:"bool",id:1}}};constructor(e){super(),this.isUploaded=e}toJSON(){return{isUploaded:this.isUploaded}}static fromJSON(e){return new IsEditorBundleUploadedResponse(e.isUploaded)}}class EditorService extends(/*   -- @preserve */
EmitterMixin()){static _SERVICE=13;static async isBundleUploaded(e,t){const n=new IsEditorBundleUploadedMessage(t);if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const i=await e._sendRequest(EditorService._SERVICE,IsEditorBundleUploadedMessage.TYPE,MessagesCompressor.encode(n));return MessagesCompressor.decode(i,IsEditorBundleUploadedResponse).isUploaded}}class RevisionHistoryGetRevisionMessage extends Message{documentId;revisionId;static TYPE="123";static READABLE_TYPE_NAME="getRevision";static DESCRIPTOR_NAME="RevisionHistoryGetRevisionMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},revisionId:{type:"string",id:2}}};constructor(e,t){super(),this.documentId=e,this.revisionId=t}toJSON(){return{documentId:this.documentId,revisionId:this.revisionId}}static fromJSON(e){return new RevisionHistoryGetRevisionMessage(e.documentId,e.revisionId)}}class RevisionDescriptor extends Descriptor{static DESCRIPTOR_NAME="RevisionDescriptor";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{revisionId:{type:"string",id:1},name:{type:"string",id:2},creatorId:{type:"string",id:3},authorsIds:{type:"string",id:4},diffData:{type:"string",id:5},createdAt:{type:"string",id:6},attributes:{type:"string",id:7},toVersion:{type:"uint32",id:8},fromVersion:{type:"uint32",id:9},isEmptyCurrent:{type:"bool",id:10}}}))();static create(e){return{revisionId:e.id,name:e.name,creatorId:e.creatorId,createdAt:e.createdAt,fromVersion:e.fromVersion,toVersion:e.toVersion,isEmptyCurrent:e.isEmptyCurrent,diffData:e.diffData?JSON.stringify(e.diffData):void 0,attributes:e.attributes,authorsIds:e.authorsIds}}static toJSON(e){return{revisionId:e.revisionId,name:e.name,creatorId:e.creatorId,authorsIds:e.authorsIds?JSON.stringify(e.authorsIds):void 0,diffData:e.diffData,createdAt:e.createdAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):void 0,toVersion:e.toVersion,fromVersion:e.fromVersion,isEmptyCurrent:e.isEmptyCurrent}}static fromJSON(e){return{revisionId:(e={...e}).revisionId,name:e.name,creatorId:e.creatorId,authorsIds:e.authorsIds?JSON.parse(e.authorsIds):void 0,diffData:e.diffData,createdAt:e.createdAt?new Date(e.createdAt):void 0,attributes:e.attributes?JSON.parse(e.attributes):void 0,toVersion:e.toVersion,fromVersion:e.fromVersion,isEmptyCurrent:e.isEmptyCurrent}}static toObject(e){return function(e){for(const[t,n]of Object.entries(e))void 0===n&&delete e[t];return e}({id:e.revisionId,name:e.name,creatorId:e.creatorId,createdAt:e.createdAt,fromVersion:e.fromVersion,toVersion:e.toVersion,isEmptyCurrent:e.isEmptyCurrent,diffData:e.diffData?JSON.parse(e.diffData):void 0,attributes:e.attributes,authorsIds:e.authorsIds})}}class RevisionHistoryGetRevisionResponse extends Message{revisionId;name;creatorId;authorsIds;createdAt;diffData;attributes;fromVersion;toVersion;isEmptyCurrent;static DESCRIPTOR_NAME="RevisionHistoryGetRevisionResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>RevisionDescriptor.DESCRIPTOR)();constructor(e,t,n,i,r,s,o,a,c,l){super(),this.revisionId=e,this.name=t,this.creatorId=n,this.authorsIds=i,this.createdAt=r,this.diffData=s,this.attributes=o,this.fromVersion=a,this.toVersion=c,this.isEmptyCurrent=l}toJSON(){return RevisionDescriptor.toJSON(this)}toObject(){return RevisionDescriptor.toObject(this)}static create(e){return new RevisionHistoryGetRevisionResponse(e.revisionId,e.name,e.creatorId,e.authorsIds,e.createdAt,e.diffData,e.attributes,e.fromVersion,e.toVersion,e.isEmptyCurrent)}static fromJSON(e){return new RevisionHistoryGetRevisionResponse(e.revisionId,e.name,e.creatorId,e.authorsIds?JSON.parse(e.authorsIds):void 0,e.createdAt?new Date(e.createdAt):void 0,e.diffData,e.attributes?JSON.parse(e.attributes):void 0,e.fromVersion,e.toVersion,e.isEmptyCurrent)}}class RevisionHistoryUpdateRevisionsMessage extends Message{documentId;requestId;revisions;static TYPE="124";static READABLE_TYPE_NAME="updateRevisions";static DESCRIPTOR_NAME="RevisionHistoryUpdateRevisionsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}};constructor(e,t,n){super(),this.documentId=e,this.requestId=t,this.revisions=n}toJSON(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static create(e){return new RevisionHistoryUpdateRevisionsMessage(e.documentId,e.requestId,e.revisions.map(RevisionDescriptor.create))}static fromJSON(e){return new RevisionHistoryUpdateRevisionsMessage(e.documentId,e.requestId,e.revisions.map(RevisionDescriptor.fromJSON))}}class RevisionHistoryUpdateRevisionsResponse extends Message{requestId;static DESCRIPTOR_NAME="RevisionHistoryUpdateRevisionsResponse";static DESCRIPTOR={fields:{requestId:{type:"uint32",id:1}}};constructor(e){super(),this.requestId=e}toJSON(){return{requestId:this.requestId}}static fromJSON(e){return new RevisionHistoryUpdateRevisionsResponse(e.requestId)}}class RevisionHistoryConnectMessage extends Message{documentId;static TYPE="121";static READABLE_TYPE_NAME="connectToRevisionHistory";static DESCRIPTOR_NAME="RevisionHistoryConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new RevisionHistoryConnectMessage(e.documentId)}}class RevisionHistoryConnectResponse extends Message{channel;requestId;revisions;static DESCRIPTOR_NAME="RevisionHistoryConnectResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{channel:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}}))();constructor(e,t,n){super(),this.channel=e,this.requestId=t,this.revisions=n}toJSON(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static fromJSON(e){return new RevisionHistoryConnectResponse(e.channel,e.requestId,e.revisions.map(RevisionDescriptor.fromJSON))}}class RevisionHistoryReconnectMessage extends Message{documentId;requestId;static TYPE="122";static READABLE_TYPE_NAME="reconnectToRevisionHistory";static DESCRIPTOR_NAME="RevisionHistoryReconnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2}}};constructor(e,t){super(),this.documentId=e,this.requestId=t}toJSON(){return{documentId:this.documentId,requestId:this.requestId}}static fromJSON(e){return new RevisionHistoryReconnectMessage(e.documentId,e.requestId)}}class ServiceNotConnectedError extends CKEditorCloudServicesError{constructor(e,t){super(e+" Service is not connected.",t)}}class RevisionHistoryService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;static _SERVICE=12;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}connect(e){return this._isConnected?Promise.resolve():this._connect(e,new RevisionHistoryConnectMessage(this._documentId))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}reconnect(e,t){if(this.isConnected)throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",e);return this._connect(e,new RevisionHistoryReconnectMessage(this._documentId,t))}async updateRevisions(e,t){const n=RevisionHistoryUpdateRevisionsMessage.create({documentId:this._documentId,requestId:t,revisions:e}),i=await this._sendRequest(RevisionHistoryUpdateRevisionsMessage.TYPE,n),{requestId:r}=MessagesCompressor.decode(i,RevisionHistoryUpdateRevisionsResponse);return r}async getRevision(e){const t=new RevisionHistoryGetRevisionMessage(this._documentId,e),n=await this._sendRequest(RevisionHistoryGetRevisionMessage.TYPE,t);return MessagesCompressor.decode(n,RevisionHistoryGetRevisionResponse).toObject()}async _connect(e,t){if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(12,t.constructor.TYPE,MessagesCompressor.encode(t)),{channel:i,requestId:r,revisions:s}=MessagesCompressor.decode(n,RevisionHistoryConnectResponse).toObject();return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i),this._isConnected=!0,this.fire("connected"),{revisions:s,requestId:r}}_connectToChannel(e,t){this._channel=e._getChannel(RevisionHistoryService._SERVICE,t),this._channel&&this.listenTo(this._channel,this._channel.getEventName(RevisionHistoryUpdateRevisionsMessage.TYPE),((e,t)=>{const{documentId:n,requestId:i,revisions:r}=MessagesCompressor.decode(t,RevisionHistoryUpdateRevisionsMessage).toObject();this.fire("revisionsUpdated",{documentId:n,requestId:i,revisionsData:r})}))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Revision History",this);return this._wsGateway._sendRequest(12,e,MessagesCompressor.encode(t))}}class AddSuggestionMessage extends Message{id;documentId;type;data;originalSuggestionId;attributes;static TYPE="101";static READABLE_TYPE_NAME="addSuggestion";static DESCRIPTOR_NAME="TrackChangesAddSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},type:{type:"string",id:3},data:{type:"string",id:4},originalSuggestionId:{type:"string",id:5},attributes:{type:"string",id:6}}};constructor(e,t,n,i={},r=null,s=null){super(),this.id=e,this.documentId=t,this.type=n,this.data=i,this.originalSuggestionId=r,this.attributes=s}toJSON(){return{id:this.id,documentId:this.documentId,type:this.type,data:JSON.stringify(this.data),originalSuggestionId:this.originalSuggestionId,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new AddSuggestionMessage(e.id,e.documentId,e.type,JSON.parse(e.data),e.originalSuggestionId??null,e.attributes?JSON.parse(e.attributes):null)}}class AddSuggestionResponse extends Message{id;authorId;type;hasComments;state;data;attributes;createdAt;static DESCRIPTOR_NAME="TrackChangesAddSuggestionResponse";static DESCRIPTOR={fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}};constructor(e,t,n,i,r,s,o={},a=null){super(),this.id=e,this.authorId=t,this.type=n,this.hasComments=r,this.state=s,this.data=o,this.attributes=a,this.createdAt=i?new Date(i):void 0}toJSON(){return{id:this.id,authorId:this.authorId,type:this.type,createdAt:this.createdAt?.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new AddSuggestionResponse(e.id,e.authorId,e.type,e.createdAt,e.hasComments,e.state,JSON.parse(e.data),e.attributes?JSON.parse(e.attributes):null)}}class GetSuggestionMessage extends Message{id;documentId;static TYPE="103";static READABLE_TYPE_NAME="getSuggestion";static DESCRIPTOR_NAME="TrackChangesGetSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.id=e,this.documentId=t}toJSON(){return{id:this.id,documentId:this.documentId}}static fromJSON(e){return new GetSuggestionMessage(e.id,e.documentId)}}class GetSuggestionResponse extends Message{id;authorId;type;hasComments;state;data;attributes;createdAt;static DESCRIPTOR_NAME="TrackChangesGetSuggestionResponse";static DESCRIPTOR={fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}};constructor(e,t,n,i,r,s,o={},a=null){super(),this.id=e,this.authorId=t,this.type=n,this.hasComments=r,this.state=s,this.data=o,this.attributes=a,this.createdAt=new Date(i)}toJSON(){return{id:this.id,authorId:this.authorId,type:this.type,createdAt:this.createdAt.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new GetSuggestionResponse(e.id,e.authorId,e.type,e.createdAt,e.hasComments,e.state,JSON.parse(e.data),e.attributes?JSON.parse(e.attributes):null)}}class GetAllSuggestionsMessage extends Message{documentId;static TYPE="102";static READABLE_TYPE_NAME="getAllSuggestions";static DESCRIPTOR_NAME="TrackChangesGetAllSuggestionMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetAllSuggestionsMessage(e.documentId)}}class SuggestionDescriptor extends Descriptor{static DESCRIPTOR_NAME="SuggestionDescriptor";static DESCRIPTOR={fields:{id:{id:1,type:"string"},authorId:{id:2,type:"string"},type:{id:3,type:"string"},createdAt:{id:4,type:"string"},data:{id:5,type:"string"},hasComments:{id:6,type:"bool"},state:{id:7,type:"string"},attributes:{id:8,type:"string"}}};static toJSON(e){return{...e,data:e.data?JSON.stringify(e.data):e.data,attributes:e.attributes?JSON.stringify(e.attributes):e.attributes,createdAt:e.createdAt?.toISOString()}}static fromJSON(e){return{...e,data:e.data?JSON.parse(e.data):e.data,attributes:e.attributes?JSON.parse(e.attributes):e.attributes,createdAt:e.createdAt?new Date(e.createdAt):void 0}}}class GetAllSuggestionResponse extends Message{_suggestions;_suggestionsV2;suggestions;static DESCRIPTOR_NAME="TrackChangesGetAllSuggestionsResponse";static DESCRIPTOR={fields:{suggestions:{type:"string",rule:"repeated",id:1},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:2}}};constructor(e,t){super(),this._suggestions=e,this._suggestionsV2=t,this.suggestions=t?.length?t:e}toJSON(){return{suggestions:this._suggestions?.map((e=>JSON.stringify(e))),suggestionsV2:this._suggestionsV2?.map(SuggestionDescriptor.toJSON)}}static fromJSON(e){return new GetAllSuggestionResponse(e.suggestions?.map(_suggestionFromString),e.suggestionsV2?.map(SuggestionDescriptor.fromJSON))}}function _suggestionFromString(e){const t=JSON.parse(e);return t.createdAt=t.createdAt?new Date(t.createdAt):void 0,t}class UpdateSuggestionMessage extends Message{id;documentId;hasComments;isHasCommentsModified;state;attributes;static TYPE="104";static READABLE_TYPE_NAME="updateSuggestion";static DESCRIPTOR_NAME="TrackChangesUpdateSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},hasComments:{type:"bool",id:3},isHasCommentsModified:{type:"bool",id:4},state:{type:"string",id:5},attributes:{type:"string",id:6}}};constructor(e,t,n,i,r,s=null){super(),this.id=e,this.documentId=t,this.hasComments=n,this.isHasCommentsModified=i,this.state=r,this.attributes=s}toJSON(){return{id:this.id,documentId:this.documentId,hasComments:this.hasComments,isHasCommentsModified:this.isHasCommentsModified,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new UpdateSuggestionMessage(e.id,e.documentId,e.hasComments,e.isHasCommentsModified,e.state,e.attributes?JSON.parse(e.attributes):null)}}let ConnectMessage$1=class e extends Message{documentId;static TYPE="105";static READABLE_TYPE_NAME="connectToSuggestions";static DESCRIPTOR_NAME="TrackChangesConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new e(t.documentId)}},ConnectResponse$1=class e extends Message{channel;_suggestions;_suggestionsV2;suggestions;static DESCRIPTOR_NAME="TrackChangesConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},suggestions:{type:"string",rule:"repeated",id:2},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:3}}};constructor(e,t,n){super(),this.channel=e,this._suggestions=t,this._suggestionsV2=n,this.suggestions=n?.length?n:t}toJSON(){return{channel:this.channel,suggestions:this._suggestions?.map((e=>JSON.stringify(e))),suggestionsV2:this._suggestionsV2?.map(SuggestionDescriptor.toJSON)}}static fromJSON(t){return new e(t.channel,t.suggestions?.map((e=>JSON.parse(e))),t.suggestionsV2?.map(SuggestionDescriptor.fromJSON))}};class BatchUpdateSuggestionsStateMessage extends Message{ids;documentId;state;static TYPE="106";static READABLE_TYPE_NAME="batchUpdateSuggestionsState";static DESCRIPTOR_NAME="TrackChangesBatchUpdateSuggestionsStateMessage";static DESCRIPTOR={fields:{ids:{type:"string",rule:"repeated",id:1},documentId:{type:"string",id:2},state:{type:"string",id:3}}};constructor(e,t,n){super(),this.ids=e,this.documentId=t,this.state=n}toJSON(){return{ids:this.ids,documentId:this.documentId,state:this.state}}static fromJSON(e){return new BatchUpdateSuggestionsStateMessage(e.ids,e.documentId,e.state)}}class TrackChangesService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;static _SERVICE=10;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(e){if(this._isConnected)return;if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const t=new ConnectMessage$1(this._documentId);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(10,ConnectMessage$1.TYPE,MessagesCompressor.encode(t)),i=MessagesCompressor.decode(n,ConnectResponse$1);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i.channel),this._isConnected=!0,this.fire("connected"),i.suggestions}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}async add(e,t,n,i=null,r){const s=new AddSuggestionMessage(e,this._documentId,t,n,i,r),o=await this._sendRequest(AddSuggestionMessage.TYPE,s);return MessagesCompressor.decode(o,AddSuggestionResponse)}async get(e,t=1){const n=new GetSuggestionMessage(e,this._documentId);try{const e=await this._sendRequest(GetSuggestionMessage.TYPE,n);return MessagesCompressor.decode(e,GetSuggestionResponse)}catch(n){if("CKEditorCloudServicesServerError"===n.name&&"404"===n.code&&t<5)return await(i=100*t,new Promise((e=>{setTimeout(e,i)}))),this.get(e,t+1);if("CKEditorCloudServicesServerError"===n.name)throw n;throw CKEditorCloudServicesServerError.fromPublicError(n)}var i}async getAll(){const e=new GetAllSuggestionsMessage(this._documentId),t=await this._sendRequest(GetAllSuggestionsMessage.TYPE,e),{suggestions:n}=MessagesCompressor.decode(t,GetAllSuggestionResponse);return n}async update(e,t={}){const{hasComments:n,state:i,attributes:r}=t,s=void 0!==n,o=new UpdateSuggestionMessage(e,this._documentId,n,s,i,r);await this._sendRequest(UpdateSuggestionMessage.TYPE,o)}async batchUpdateState(e){const t=new BatchUpdateSuggestionsStateMessage(e.ids,this._documentId,e.state);await this._sendRequest(BatchUpdateSuggestionsStateMessage.TYPE,t)}_connectToChannel(e,t){this._channel=e._getChannel(TrackChangesService._SERVICE,t),this._channel&&this.listenTo(this._channel,this._channel.getEventName(UpdateSuggestionMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateSuggestionMessage);this.fire("suggestionUpdated",n)}))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Track Changes",this);return this._wsGateway._sendRequest(10,e,MessagesCompressor.encode(t))}}class SessionsConnectResponse extends Message{channel;sockets;static DESCRIPTOR_NAME="SessionsConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},sockets:{rule:"repeated",type:"SessionsSocketDescriptor",id:2}}};constructor(e,t=[]){super(),this.channel=e,this.sockets=t}toJSON(){return{channel:this.channel,sockets:this.sockets.map((e=>({user:e.userId,session:e.id,role:e.role,permissions:e.permissions})))}}static fromJSON(e){return new SessionsConnectResponse(e.channel,e.sockets.map((e=>({id:e.session,userId:e.user,role:e.role,permissions:e.permissions}))))}}class SessionsConnectMessage extends Message{id;sessionType;static TYPE="31";static READABLE_TYPE_NAME="getConnectedSockets";static DESCRIPTOR_NAME="SessionsConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},sessionType:{type:"uint32",id:2}}};constructor(e,t){super(),this.id=e,this.sessionType=t}toJSON(){return{id:this.id,sessionType:this.sessionType}}static fromJSON(e){return new SessionsConnectMessage(e.id,e.sessionType)}}class SocketConnectMessage extends Message{id;userId;role;permissions;static TYPE="32";static READABLE_TYPE_NAME="connectSocket";static DESCRIPTOR_NAME="SocketConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},userId:{type:"string",id:2},role:{type:"string",id:3},permissions:{rule:"repeated",type:"string",id:4}}};constructor(e,t,n,i){super(),this.id=e,this.userId=t,this.role=n,this.permissions=i}toJSON(){return{id:this.id,userId:this.userId??void 0,role:this.role??void 0,permissions:this.permissions??void 0}}static fromJSON(e){return new SocketConnectMessage(e.id,e.userId,e.role,e.permissions)}}class SocketDisconnectMessage extends Message{id;static TYPE="33";static READABLE_TYPE_NAME="disconnectSocket";static DESCRIPTOR_NAME="SocketDisconnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1}}};constructor(e){super(),this.id=e}toJSON(){return{id:this.id}}static fromJSON(e){return new SocketDisconnectMessage(e.id)}}class SessionCollection extends Collection$1{_id;_sessionType;_handlers;_channel;_wsGateway;_connected;_eventsQueue;_isRunning;constructor(e,t){super({idProperty:"id"}),this._id=e,this._sessionType=t,this._handlers=new Map,this._eventsQueue=[],this._isRunning=!1}async connect(e){this._wsGateway=e,this.stopListening(e,"change:state");const t=new SessionsConnectMessage(this._id,this._sessionType);let n;try{const e=await this._wsGateway._sendRequest(3,SessionsConnectMessage.TYPE,MessagesCompressor.encode(t));n=MessagesCompressor.decode(e,SessionsConnectResponse)}catch(e){n=new SessionsConnectResponse(this._id,[])}this._connectToChannel(this._wsGateway,n.channel,this._sessionType);const i=await async function(e,t){const n=t.map((e=>e.userId)),i=n.length?await User.getMany(e,n):[];return t.map((e=>{const t={id:e.id,role:e.role,permissions:e.permissions};return t.user=e.userId&&i.find((t=>t.id===e.userId))||new User,t}))}(this._wsGateway,n.sockets);for(const e of i)super.add(e);this._connected=!0,this.fire("connected"),this.listenTo(this._wsGateway,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),await this._runQueue()}disconnect(e=!0){if(this._connected){for(this._connected=!1,this._eventsQueue=[];this.length;)super.remove(0);this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._wsGateway&&e&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this.fire("disconnected"),e&&this.stopListening()}}add(e,t){throw new TypeError("The collection is read-only.")}remove(e){throw new TypeError("The collection is read-only.")}_connectToChannel(e,t,n){this._channel=e._getChannel(n,t),this._channel&&(this._addHandler(this._channel,SocketConnectMessage.TYPE,(async t=>{const n=MessagesCompressor.decode(t,SocketConnectMessage);if(-1===this.getIndex(n.id)){const t={id:n.id,role:n.role,permissions:n.permissions};n.userId&&(t.user=await User.get(e,n.userId)),super.add(t)}})),this._addHandler(this._channel,SocketDisconnectMessage.TYPE,(e=>{const t=MessagesCompressor.decode(e,SocketDisconnectMessage);-1!==this.getIndex(t.id)&&super.remove(t.id)})))}async _onWsGatewayStateChange(e){e===WebSocketGateway$1.STATE_DISCONNECTED&&this.disconnect(!1),e===WebSocketGateway$1.STATE_CONNECTED&&await this.connect(this._wsGateway)}async _runQueue(){if(this._isRunning||!this._connected)return;let e;for(this._isRunning=!0;e=this._eventsQueue.shift();){const t=this._handlers.get(e.eventName);t&&await t(e.data)}this._isRunning=!1}_addHandler(e,t,n){const i=e.getEventName(t,!0);this.listenTo(e,i,(async(e,t)=>{const n=e.name;this._eventsQueue.push({eventName:n,data:t}),await this._runQueue()})),this._handlers.set(i,n)}}let Sessions$1=class{static async getConnectedSessions(e,t,n){const i=new SessionCollection(t,n);return await i.connect(e),i}};class CollaborativeEditingConnectMessage extends Message{id;buffers;types;bundleVersion;lastOperationId;static TYPE="11";static READABLE_TYPE_NAME="connectToDocument";static DESCRIPTOR_NAME="CollaborativeEditingConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},lastOperationId:{type:"string",id:5}}};constructor(e,t,n,i,r=""){super(),this.id=e,this.buffers=t,this.types=n,this.bundleVersion=i,this.lastOperationId=r}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,bundleVersion:this.bundleVersion,lastOperationId:this.lastOperationId}}static fromJSON(e){return new CollaborativeEditingConnectMessage(e.id,e.buffers,e.types,e.bundleVersion,e.lastOperationId)}}class OperationMetadataHelpers{static prepareMetadataForOperations(e,t){if(!(e&&e.length&&t&&t.length))return[];const n=[];let i=0;for(const r of e)if(0!==r){if(!t[i])throw new Error("Missing metadata for a operation");n.push(t[i]),i++}else n.push(n[n.length-1]);return n}static removeUnnecessaryMetadata(e,t){if(!(e&&e.length&&t&&t.length))return[];const n=[];for(let i=0;i<e.length;i++)if(0!==e[i]){if(!t[i])throw new Error("Missing metadata for a operation");n.push(t[i])}return n}}class OperationMetadataDescriptor extends Descriptor{static DESCRIPTOR_NAME="OperationMetadataDescriptor";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{userId:{type:"string",id:1},type:{type:"string",id:2},createdAt:{type:"string",id:3}}}))();static toJSON({createdAt:e,...t}){const n={...t};return e?.toISOString&&(n.createdAt=e.toISOString()),n}static fromJSON({createdAt:e,...t}){const n={...t};return e&&(n.createdAt=new Date(e)),n}}class CollaborativeEditingUpdateMessage extends Message{id;buffers;types;baseVersion;metadata;lastOperationId;static TYPE="13";static READABLE_TYPE_NAME="updateDocument";static DESCRIPTOR_NAME="CollaborativeEditingUpdateMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},baseVersion:{type:"uint32",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:6},lastOperationId:{type:"string",id:7}}};constructor(e,t,n,i,r=[],s=""){super(),this.id=e,this.buffers=t,this.types=n,this.baseVersion=i,this.metadata=r,this.lastOperationId=s}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,lastOperationId:this.lastOperationId}}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId}}static fromJSON(e){return new CollaborativeEditingUpdateMessage(e.id,e.buffers,e.types,e.baseVersion,OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),e.lastOperationId)}}class CollaborativeEditingReconnectMessage extends Message{id;lastKnowVersion;bundleVersion;static TYPE="12";static READABLE_TYPE_NAME="reconnectToDocument";static DESCRIPTOR_NAME="CollaborativeEditingReconnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},lastKnowVersion:{type:"uint32",id:3}}};constructor(e,t,n){super(),this.id=e,this.lastKnowVersion=t,this.bundleVersion=n}toJSON(){return{id:this.id,bundleVersion:this.bundleVersion,lastKnowVersion:this.lastKnowVersion}}static fromJSON(e){return new CollaborativeEditingReconnectMessage(e.id,e.lastKnowVersion,e.bundleVersion)}}class CollaborativeEditingResponse extends Message{version;buffers;types;metadata;lastOperationId;lastOperationAcceptedAt;static DESCRIPTOR_NAME="CollaborativeEditingResponse";static DESCRIPTOR={fields:{version:{type:"uint32",id:1},buffers:{rule:"repeated",type:"bytes",id:2},types:{rule:"repeated",type:"uint32",id:3},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:5},lastOperationId:{type:"string",id:6},lastOperationAcceptedAt:{type:"string",id:7}}};constructor(e,t=[],n=[],i=[],r="",s=null){super(),this.version=e,this.buffers=t,this.types=n,this.metadata=i,this.lastOperationId=r,this.lastOperationAcceptedAt=s}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt}}get wereChangesApplied(){return!this.types?.length}toJSON(){return{version:this.version,buffers:this.buffers,types:this.types,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt instanceof Date?this.lastOperationAcceptedAt.toISOString():this.lastOperationAcceptedAt}}static fromJSON(e){return new CollaborativeEditingResponse(e.version,e.buffers,e.types,OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),e.lastOperationId,e.lastOperationAcceptedAt?new Date(e.lastOperationAcceptedAt):null)}static create(e){return new CollaborativeEditingResponse(e.version,e.buffers,e.types,e.metadata,e.lastOperationId,e.lastOperationAcceptedAt?new Date(e.lastOperationAcceptedAt):null)}}class CollaborativeEditingConnectResponse extends Message{channel;version;buffers;types;offset;metadata;initData;sessionId;lastOperationId;sessionCreatedAt;static DESCRIPTOR_NAME="CollaborativeEditingConnectResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{channel:{type:"string",id:1},offset:{type:"uint32",id:2},version:{type:"uint32",id:3},buffers:{rule:"repeated",type:"bytes",id:4},types:{rule:"repeated",type:"uint32",id:5},metadata:{rule:"repeated",type:OperationMetadataDescriptor.DESCRIPTOR_NAME,id:7},initData:{type:"string",id:8},isInitialized:{type:"bool",id:9},sessionId:{type:"string",id:10},lastOperationId:{type:"string",id:11},sessionCreatedAt:{type:"string",id:12}}}))();constructor(e,t,n=[],i=[],r=0,s=[],o=null,a="",c="",l=null){super(),this.channel=e,this.version=t,this.buffers=n,this.types=i,this.offset=r,this.metadata=s,this.initData=o,this.sessionId=a,this.lastOperationId=c,this.sessionCreatedAt=l}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt}}get wereChangesApplied(){return!this.types?.length&&null===this.initData}toJSON(){return{channel:this.channel,version:this.version,sessionId:this.sessionId,buffers:this.buffers,types:this.types,offset:this.offset,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),initData:this.initData??"",isInitialized:"string"==typeof this.initData,lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt?this.sessionCreatedAt.toISOString():null}}static create(e){return new CollaborativeEditingConnectResponse(e.channel,e.version,e.buffers,e.types,e.offset,e.metadata,e.initData,e.sessionId,e.lastOperationId,e.sessionCreatedAt)}static fromJSON(e){let t=null;return!0===e.isInitialized?t=e.initData??"":"boolean"!=typeof e.isInitialized&&e.initData&&(t=e.initData),CollaborativeEditingConnectResponse.create({channel:e.channel,version:e.version,buffers:e.buffers,types:e.types,offset:e.offset,metadata:OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),initData:t,sessionId:e.sessionId,lastOperationId:e.lastOperationId,sessionCreatedAt:e.sessionCreatedAt?new Date(e.sessionCreatedAt):null})}}class GetDocumentDetailsResponse extends Message{lastDocumentSession;currentDocumentSession;static DESCRIPTOR_NAME="GetDocumentDetailsResponse";static DESCRIPTOR={fields:{lastDocumentSessionId:{type:"string",id:1},lastDocumentSessionOperationId:{type:"string",id:2},currentDocumentSessionId:{type:"string",id:3},currentDocumentSessionVersion:{type:"uint32",id:4},currentDocumentSessionOperationId:{type:"string",id:5}}};constructor(e,t){super(),this.lastDocumentSession=e,this.currentDocumentSession=t}get data(){return{lastDocumentSessionId:this.lastDocumentSession?.id,lastDocumentSessionOperationId:this.lastDocumentSession?.lastOperationId,currentDocumentSessionId:this.currentDocumentSession?.id,currentDocumentSessionVersion:this.currentDocumentSession?.version,currentDocumentSessionOperationId:this.currentDocumentSession?.lastOperationId}}toJSON(){return{lastDocumentSessionId:this.lastDocumentSession?.id,lastDocumentSessionOperationId:this.lastDocumentSession?.lastOperationId,currentDocumentSessionId:this.currentDocumentSession?.id,currentDocumentSessionVersion:this.currentDocumentSession?.version,currentDocumentSessionOperationId:this.currentDocumentSession?.lastOperationId}}static fromJSON(e){const t=e.lastDocumentSessionId?{id:e.lastDocumentSessionId,lastOperationId:e.lastDocumentSessionOperationId}:void 0,n=e.currentDocumentSessionId?{lastOperationId:e.currentDocumentSessionOperationId,version:e.currentDocumentSessionVersion,id:e.currentDocumentSessionId}:void 0;return new GetDocumentDetailsResponse(t,n)}}class GetDocumentDetailsMessage extends Message{documentId;static TYPE="14";static READABLE_TYPE_NAME="getDocumentDetails";static DESCRIPTOR_NAME="GetDocumentDetailsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},environmentId:{type:"string",id:2}}};constructor(e){super(),this.documentId=e}get data(){return{documentId:this.documentId}}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetDocumentDetailsMessage(e.documentId)}}class CollaborativeEditingService extends(/*   -- @preserve */
EmitterMixin()){static _SERVICE=1;_bundleVersion;_id;_isConnected;_wsGateway;_channel;_connectedSessions;constructor(e,t){if(super(),!e)throw new TypeError('Param "bundleVersion" must be provided.');this._id=t??v4(),this._isConnected=!1,this._bundleVersion=e}getId(){return this._id}isConnected(){return this._isConnected}connect(e,t={buffers:[],types:[]},n){const i=new CollaborativeEditingConnectMessage(this.getId(),t.buffers,t.types,this._bundleVersion,n);return this._connect(e,i)}reconnect(e,t){if(this.isConnected())throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",e);return this._connect(e,new CollaborativeEditingReconnectMessage(this.getId(),t,this._bundleVersion))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async getDocumentDetails(){const e=new GetDocumentDetailsMessage(this.getId());if(!this._wsGateway)throw new ServiceNotConnectedError("Collaborative Editing",this);const t=await this._wsGateway._sendRequest(1,GetDocumentDetailsMessage.TYPE,MessagesCompressor.encode(e));return MessagesCompressor.decode(t,GetDocumentDetailsResponse)}async sendOperations(e,t,n){if(!e||!e.types||!e.types.length)throw new CKEditorCloudServicesError("Cannot send empty update.",this._wsGateway);const i="number"==typeof t?t:parseInt(t);if(!Number.isInteger(i)||i<0)throw new CKEditorCloudServicesError("Base version not provided.",this._wsGateway);const r=new CollaborativeEditingUpdateMessage(this.getId(),e.buffers,e.types,i,[],n);if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);const s=await this._wsGateway._sendRequest(1,CollaborativeEditingUpdateMessage.TYPE,MessagesCompressor.encode(r));return MessagesCompressor.decode(s,CollaborativeEditingResponse)}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);return this._connectedSessions||(this._connectedSessions=await Sessions$1.getConnectedSessions(this._wsGateway,this._id,1)),this._connectedSessions}static getConnectedSessions(e,t){return Sessions$1.getConnectedSessions(e,t,1)}async _connect(e,t){if(this.isConnected())return;if(e.state!==WebSocketGateway$1.STATE_CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(1,t.constructor.TYPE,MessagesCompressor.encode(t)),i=MessagesCompressor.decode(n,CollaborativeEditingConnectResponse);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i.channel),this._isConnected=!0,this.fire("connected"),i}_connectToChannel(e,t){this._channel=e._getChannel(1,t),this.listenTo(this._channel,this._channel.getEventName(CollaborativeEditingUpdateMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,CollaborativeEditingUpdateMessage);this.fire("operationsReceived",n.baseVersion,n.data,n.metadata)}))}_onWsGatewayStateChange(e){e===WebSocketGateway$1.STATE_DISCONNECTED&&this.disconnect()}}class CommentDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentDescriptor";static DESCRIPTOR={fields:{commentId:{id:1,type:"string"},commentThreadId:{id:2,type:"string"},userId:{id:3,type:"string"},content:{id:4,type:"string"},documentId:{id:5,type:"string"},createdAt:{id:6,type:"string"},attributes:{id:7,type:"string"}}};static toJSON(e){return{...e,createdAt:e.createdAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):null}}static fromJSON(e){return{...e,createdAt:new Date(e.createdAt),attributes:e.attributes?JSON.parse(e.attributes):null}}}class CommentsThreadDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentsThreadDescriptor";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},comments:{type:"CommentDescriptor",rule:"repeated",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4},context:{type:"string",id:5},createdAt:{type:"string",id:6},deletedAt:{type:"string",id:7},attributes:{type:"string",id:8},unlinkedAt:{type:"string",id:9}}};static toJSON(e){return{...e,createdAt:e.createdAt?.toISOString(),deletedAt:e.deletedAt?.toISOString(),resolvedAt:e.resolvedAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):null,context:e.context?JSON.stringify(e.context):e.context,comments:e.comments?.map(CommentDescriptor.toJSON),unlinkedAt:e.unlinkedAt?.toISOString()}}static fromJSON(e){return{...e,createdAt:e.createdAt?new Date(e.createdAt):void 0,deletedAt:e.deletedAt?new Date(e.deletedAt):void 0,resolvedAt:e.resolvedAt?new Date(e.resolvedAt):void 0,attributes:e.attributes?JSON.parse(e.attributes):null,context:e.context?JSON.parse(e.context):void 0,comments:e.comments?.map(CommentDescriptor.fromJSON),unlinkedAt:e.unlinkedAt?new Date(e.unlinkedAt):void 0}}}class AddCommentMessage extends Message{documentId;commentThreadId;content;commentId;userId;attributes;commentThread;createdAt;static TYPE="91";static READABLE_TYPE_NAME="addComment";static DESCRIPTOR_NAME="CommentsV2AddCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},content:{type:"string",id:2},documentId:{type:"string",id:3},commentId:{type:"string",id:4},createdAt:{type:"string",id:5},userId:{type:"string",id:6},attributes:{type:"string",id:7},commentThread:{type:"CommentsThreadDescriptor",id:8}}};constructor(e,t,n,i="",r,s="",o=null,a){super(),this.documentId=e,this.commentThreadId=t,this.content=n,this.commentId=i,this.userId=s,this.attributes=o,this.commentThread=a,this.createdAt=r?new Date(r):""}toJSON(){return{commentThreadId:this.commentThreadId,content:this.content,documentId:this.documentId,commentId:this.commentId,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,userId:this.userId,attributes:JSON.stringify(this.attributes),commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(e){return new AddCommentMessage(e.documentId,e.commentThreadId,e.content,e.commentId?e.commentId:void 0,e.createdAt?new Date(e.createdAt):void 0,e.userId?e.userId:void 0,e.attributes?JSON.parse(e.attributes):{},e.commentThread?CommentsThreadDescriptor.fromJSON(e.commentThread):void 0)}}class AddCommentResponse extends Message{commentThreadId;commentId;createdAt;static DESCRIPTOR_NAME="CommentsV2AddCommentResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},createdAt:{type:"string",id:3}}};constructor(e,t,n){super(),this.commentThreadId=e,this.commentId=t,this.createdAt=new Date(n)}toJSON(){return{commentThreadId:this.commentThreadId,commentId:this.commentId,createdAt:this.createdAt.toISOString()}}static fromJSON(e){return new AddCommentResponse(e.commentThreadId,e.commentId,e.createdAt)}}class ConnectMessage extends Message{documentId;static TYPE="92";static READABLE_TYPE_NAME="connectToComment";static DESCRIPTOR_NAME="CommentsV2ConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new ConnectMessage(e.documentId)}}class ConnectResponse extends Message{channel;_threads;_threadsV2;threads;static DESCRIPTOR_NAME="CommentsV2ConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},threads:{type:"string",rule:"repeated",id:2},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:3}}};constructor(e,t,n){super(),this.channel=e,this._threads=t,this._threadsV2=n,this.threads=n?.length?n:t}toJSON(){return{channel:this.channel,threads:this._threads?.map((e=>JSON.stringify(e))),threadsV2:this._threadsV2?.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(e){return new ConnectResponse(e.channel,e.threads?.map((e=>JSON.parse(e))),e.threadsV2?.map(CommentsThreadDescriptor.fromJSON))}}class RemoveCommentMessage extends Message{documentId;commentThreadId;commentId;static TYPE="95";static READABLE_TYPE_NAME="removeComment";static DESCRIPTOR_NAME="CommentsV2RemoveCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},documentId:{type:"string",id:3}}};constructor(e,t,n){super(),this.documentId=e,this.commentThreadId=t,this.commentId=n}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId}}static fromJSON(e){return new RemoveCommentMessage(e.documentId,e.commentThreadId,e.commentId)}}class RemoveCommentThreadMessage extends Message{documentId;commentThreadId;static TYPE="97";static READABLE_TYPE_NAME="removeCommentThread";static DESCRIPTOR_NAME="CommentsV2RemoveCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.documentId=e,this.commentThreadId=t}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(e){return new RemoveCommentThreadMessage(e.documentId,e.commentThreadId)}}class UpdateCommentMessage extends Message{documentId;commentThreadId;commentId;content;attributes;isAttributesUpdated;commentThread;static TYPE="96";static READABLE_TYPE_NAME="updateComment";static DESCRIPTOR_NAME="CommentsV2UpdateCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},content:{type:"string",id:3},documentId:{type:"string",id:4},attributes:{type:"string",id:5},isAttributesUpdated:{type:"bool",id:6},commentThread:{type:"CommentsThreadDescriptor",id:7}}};constructor(e,t,n,i,r=null,s=!1,o){super(),this.documentId=e,this.commentThreadId=t,this.commentId=n,this.content=i,this.attributes=r,this.isAttributesUpdated=s,this.commentThread=o}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId,content:this.content,attributes:this.attributes?JSON.stringify(this.attributes):null,isAttributesUpdated:this.isAttributesUpdated,commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(e){return new UpdateCommentMessage(e.documentId,e.commentThreadId,e.commentId,e.content,e.attributes?JSON.parse(e.attributes):null,e.isAttributesUpdated,e.commentThread?CommentsThreadDescriptor.fromJSON(e.commentThread):void 0)}}class GetCommentThreadMessage extends Message{commentThreadId;documentId;static TYPE="93";static READABLE_TYPE_NAME="getComment";static DESCRIPTOR_NAME="CommentsV2GetCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.commentThreadId=e,this.documentId=t}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId}}static fromJSON(e){return new GetCommentThreadMessage(e.commentThreadId,e.documentId)}}class GetCommentThreadResponse extends Message{commentThreadId;_comments;_commentsV2;resolvedBy;comments;createdAt;deletedAt;resolvedAt;attributes;context;unlinkedAt;static DESCRIPTOR_NAME="CommentsV2GetCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},comments:{type:"string",rule:"repeated",id:2},commentsV2:{type:"CommentDescriptor",rule:"repeated",id:3},resolvedAt:{type:"string",id:4},resolvedBy:{type:"string",id:5},context:{type:"string",id:6},createdAt:{type:"string",id:7},deletedAt:{type:"string",id:8},attributes:{type:"string",id:9},unlinkedAt:{type:"string",id:10}}};constructor(e,t,n,i,r,s,o,a,c,l){super(),this.commentThreadId=e,this._comments=t,this._commentsV2=n,this.resolvedBy=r,this.comments=n?.length?n:t,this.createdAt=o?new Date(o):void 0,this.deletedAt="string"==typeof a?new Date(a):a,this.resolvedAt="string"==typeof c?new Date(c):c,this.unlinkedAt="string"==typeof l?new Date(l):l,this.attributes="string"==typeof i?JSON.parse(i):i,this.context="string"==typeof s?JSON.parse(s):s}toJSON(){return{commentThreadId:this.commentThreadId,comments:this._comments?.map((e=>JSON.stringify(e))),commentsV2:this._commentsV2?.map(CommentDescriptor.toJSON),attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,context:this.context?JSON.stringify(this.context):this.context,resolvedBy:this.resolvedBy,createdAt:this.createdAt?.toISOString(),deletedAt:this.deletedAt?.toISOString(),resolvedAt:this.resolvedAt?.toISOString(),unlinkedAt:this.unlinkedAt?.toISOString()}}static fromJSON(e){return new GetCommentThreadResponse(e.commentThreadId,e.comments?.map((e=>function(e){const t=JSON.parse(e);return{...t,createdAt:new Date(t.createdAt)}}(e))),e.commentsV2?.map(CommentDescriptor.fromJSON),e.attributes?JSON.parse(e.attributes):e.attributes,e.resolvedBy,e.context?JSON.parse(e.context):e.context,e.createdAt,e.deletedAt,e.resolvedAt,e.unlinkedAt)}}class GetDocumentThreadsMessage extends Message{documentId;static TYPE="94";static READABLE_TYPE_NAME="getDocumentThreads";static DESCRIPTOR_NAME="CommentsV2GetDocumentThreadsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetDocumentThreadsMessage(e.documentId)}}class GetDocumentThreadsResponse extends Message{_threads;_threadsV2;threads;static DESCRIPTOR_NAME="CommentsV2GetDocumentThreadsResponse";static DESCRIPTOR={fields:{threads:{type:"string",rule:"repeated",id:1},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:2}}};constructor(e,t){super(),this._threads=e,this._threadsV2=t,this.threads=t?.length?t:e}toJSON(){return{threads:this._threads?.map((e=>JSON.stringify(e))),threadsV2:this._threadsV2?.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(e){return new GetDocumentThreadsResponse(e.threads?.map((e=>function(e){const t=JSON.parse(e),n={...t};return t.comments&&(n.comments=t.comments?.map((e=>({...e,createdAt:new Date(e.createdAt)})))),n}(e))),e.threadsV2?.map(CommentsThreadDescriptor.fromJSON))}}class CommentThreadAddedCommentDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentThreadAddedCommentDescriptor";static DESCRIPTOR={fields:{commentId:{id:1,type:"string"},createdAt:{id:2,type:"string"}}};static toJSON(e){return{commentId:e.commentId,createdAt:e.createdAt?.toISOString()}}static fromJSON(e){return{commentId:e.commentId,createdAt:new Date(e.createdAt)}}}class AddCommentThreadResponse extends Message{commentThreadId;comments;createdAt;static DESCRIPTOR_NAME="CommentsV2AddCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},createdAt:{type:"string",id:2},comments:{type:"CommentThreadAddedCommentDescriptor",rule:"repeated",id:3}}};constructor(e,t,n=[]){super(),this.commentThreadId=e,this.comments=n,this.createdAt=new Date(t)}toJSON(){return{commentThreadId:this.commentThreadId,createdAt:this.createdAt.toISOString(),comments:this.comments.map((e=>CommentThreadAddedCommentDescriptor.toJSON(e)))}}static fromJSON(e){return new AddCommentThreadResponse(e.commentThreadId,e.createdAt,e.comments.map((e=>CommentThreadAddedCommentDescriptor.fromJSON(e))))}}class AddCommentThreadMessage extends Message{documentId;commentThreadId;comments;context;resolvedBy;attributes;createdAt;resolvedAt;deletedAt;static TYPE="140";static READABLE_TYPE_NAME="addCommentThread";static DESCRIPTOR_NAME="CommentsV2AddCommentThreadMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},commentThreadId:{type:"string",id:2},context:{type:"string",id:3},createdAt:{type:"string",id:4},resolvedAt:{type:"string",id:5},resolvedBy:{type:"string",id:6},attributes:{type:"string",id:7},deletedAt:{type:"string",id:8},comments:{type:"CommentDescriptor",rule:"repeated",id:9}}};constructor(e,t,n=[],i,r=null,s=null,o=null,a=null,c=null){super(),this.documentId=e,this.commentThreadId=t,this.comments=n,this.context=i,this.resolvedBy=r,this.attributes=c,this.createdAt=s?new Date(s):"",this.resolvedAt=o?new Date(o):"",this.deletedAt=a?new Date(a):""}toJSON(){return{commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt instanceof Date?this.resolvedAt.toISOString():this.resolvedAt,deletedAt:this.deletedAt instanceof Date?this.deletedAt.toISOString():this.deletedAt,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,comments:this.comments?.map((e=>CommentDescriptor.toJSON(e)))}}static fromJSON(e){return new AddCommentThreadMessage(e.documentId,e.commentThreadId,e.comments?.map((t=>CommentDescriptor.fromJSON({...t,documentId:e.documentId,commentThreadId:e.commentThreadId}))),e.context?JSON.parse(e.context):e.context,e.resolvedBy,e.createdAt?new Date(e.createdAt):void 0,e.resolvedAt?new Date(e.resolvedAt):void 0,e.deletedAt?new Date(e.deletedAt):void 0,e.attributes?JSON.parse(e.attributes):e.attributes)}}class ResolveCommentThreadMessage extends Message{commentThreadId;documentId;resolvedBy;resolvedAt;static TYPE="142";static READABLE_TYPE_NAME="resolveCommentThread";static DESCRIPTOR_NAME="CommentsV2ResolveCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedBy:{type:"string",id:3},resolvedAt:{type:"string",id:4}}};constructor(e,t,n,i){super(),this.commentThreadId=e,this.documentId=t,this.resolvedBy=n,this.resolvedAt=i?new Date(i):void 0}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt?.toISOString()}}static fromJSON(e){return new ResolveCommentThreadMessage(e.commentThreadId,e.documentId,e.resolvedBy,e.resolvedAt)}}class ReopenCommentThreadMessage extends Message{commentThreadId;documentId;static TYPE="141";static READABLE_TYPE_NAME="reopenCommentThread";static DESCRIPTOR_NAME="CommentsV2ReopenCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.commentThreadId=e,this.documentId=t}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(e){return new ReopenCommentThreadMessage(e.commentThreadId,e.documentId)}}class UpdateCommentThreadMessage extends Message{commentThreadId;documentId;context;attributes;unlinkedAt;static TYPE="143";static READABLE_TYPE_NAME="updateCommentThread";static DESCRIPTOR_NAME="CommentsV2UpdateCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},context:{type:"string",id:3},attributes:{type:"string",id:4},unlinkedAt:{type:"string",id:5}}};constructor(e,t,n,i=null,r=null){super(),this.commentThreadId=e,this.documentId=t,this.context=n,this.attributes=i,this.unlinkedAt=r?new Date(r):""}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,attributes:this.attributes?JSON.stringify(this.attributes):null,unlinkedAt:this.unlinkedAt instanceof Date?this.unlinkedAt.toISOString():this.unlinkedAt}}static fromJSON(e){return new UpdateCommentThreadMessage(e.commentThreadId,e.documentId,e.context?JSON.parse(e.context):e.context,e.attributes?JSON.parse(e.attributes):null,e.unlinkedAt?new Date(e.unlinkedAt):null)}}class ResolveCommentThreadResponse extends Message{commentThreadId;documentId;resolvedBy;resolvedAt;static DESCRIPTOR_NAME="CommentsV2ResolveCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4}}};constructor(e,t,n,i){super(),this.commentThreadId=e,this.documentId=t,this.resolvedBy=n,this.resolvedAt=new Date(i)}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt.toISOString()}}static fromJSON(e){return new ResolveCommentThreadResponse(e.commentThreadId,e.documentId,e.resolvedBy,e.resolvedAt)}}class CommentsService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;_connectedSessions;static _SERVICE=9;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(e){if(this._isConnected)return;if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const t=new ConnectMessage(this._documentId);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(9,ConnectMessage.TYPE,MessagesCompressor.encode(t)),{channel:i,threads:r}=MessagesCompressor.decode(n,ConnectResponse);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i),this._isConnected=!0,this.fire("connected"),r}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async addComment(e,t,n,i){const r=new AddCommentMessage(this._documentId,e,n,t,void 0,void 0,i),s=await this._sendRequest(AddCommentMessage.TYPE,r);return MessagesCompressor.decode(s,AddCommentResponse)}async updateComment(e,t,n,i){const r=void 0!==i,s=new UpdateCommentMessage(this._documentId,e,t,n,i,r);await this._sendRequest(UpdateCommentMessage.TYPE,s)}async removeComment(e,t){const n=new RemoveCommentMessage(this._documentId,e,t);await this._sendRequest(RemoveCommentMessage.TYPE,n)}async removeCommentThread(e){const t=new RemoveCommentThreadMessage(this._documentId,e);await this._sendRequest(RemoveCommentThreadMessage.TYPE,t)}async addCommentThread(e){const t=new AddCommentThreadMessage(this._documentId,e.commentThreadId,e.comments?.map((t=>({...t,documentId:this._documentId,commentThreadId:e.commentThreadId}))),e.context,e.resolvedBy,e.createdAt,e.resolvedAt,e.deletedAt,e.attributes),n=await this._sendRequest(AddCommentThreadMessage.TYPE,t);return MessagesCompressor.decode(n,AddCommentThreadResponse)}async resolveCommentThread(e){const t=new ResolveCommentThreadMessage(e,this._documentId),n=await this._sendRequest(ResolveCommentThreadMessage.TYPE,t);return MessagesCompressor.decode(n,ResolveCommentThreadResponse)}async reopenCommentThread(e){const t=new ReopenCommentThreadMessage(e,this._documentId);await this._sendRequest(ReopenCommentThreadMessage.TYPE,t)}async updateCommentThread(e){const t=new UpdateCommentThreadMessage(e.commentThreadId,this._documentId,e.context,e.attributes,e.unlinkedAt);await this._sendRequest(UpdateCommentThreadMessage.TYPE,t)}async getCommentThread(e,t=1){const n=new GetCommentThreadMessage(e,this._documentId);try{const e=await this._sendRequest(GetCommentThreadMessage.TYPE,n),t=MessagesCompressor.decode(e,GetCommentThreadResponse);return{commentThreadId:t.commentThreadId,comments:t.comments,attributes:t.attributes,context:t.context,resolvedAt:t.resolvedAt,resolvedBy:t.resolvedBy,deletedAt:t.deletedAt,unlinkedAt:t.unlinkedAt}}catch(n){if("CKEditorCloudServicesServerError"===n.name&&"404"===n.code&&t<5)return await(i=100*t,new Promise((e=>{setTimeout(e,i)}))),this.getCommentThread(e,t+1);if("CKEditorCloudServicesServerError"===n.name)throw n;throw CKEditorCloudServicesServerError.fromPublicError(n)}var i}async getDocumentThreads(){const e=new GetDocumentThreadsMessage(this._documentId),t=await this._sendRequest(GetDocumentThreadsMessage.TYPE,e),{threads:n}=MessagesCompressor.decode(t,GetDocumentThreadsResponse);return{threads:n}}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._connectedSessions||(this._connectedSessions=await Sessions$1.getConnectedSessions(this._wsGateway,this._documentId,9)),this._connectedSessions}_connectToChannel(e,t){this._channel=e._getChannel(CommentsService._SERVICE,t),this._channel&&(this.listenTo(this._channel,this._channel.getEventName(AddCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,AddCommentMessage);this.fire("commentAdded",n)})),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,RemoveCommentMessage);this.fire("commentRemoved",n)})),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateCommentMessage);this.fire("commentUpdated",n)})),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,RemoveCommentThreadMessage);this.fire("commentThreadRemoved",n)})),this.listenTo(this._channel,this._channel.getEventName(AddCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,AddCommentThreadMessage);this.fire("commentThreadAdded",n)})),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateCommentThreadMessage);this.fire("commentThreadUpdated",n)})),this.listenTo(this._channel,this._channel.getEventName(ResolveCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,ResolveCommentThreadMessage);this.fire("commentThreadResolved",n)})),this.listenTo(this._channel,this._channel.getEventName(ReopenCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,ReopenCommentThreadMessage);this.fire("commentThreadReopened",n)})))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._wsGateway._sendRequest(9,e,MessagesCompressor.encode(t))}}class WebSocketGateway extends ContextPlugin{static get requires(){return["CloudServices",Notification]}static get pluginName(){return"WebSocketGateway"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("state",WEB_SOCKET_GATEWAY_STATES.CONNECTED),this.set("_isBrowserOffline",!1),this._reconnectionStack=new Set,this._shouldPluginsReconnect=!1,this._domEmitter=Object.create(DomEmitterMixin)}init(){const e=this.context,t=e.plugins.get("CloudServices"),n=e.plugins.get(Notification);if(!t.token)throw new CKEditorError("websocketgateway-missing-token",this);if(!t.webSocketUrl)throw new CKEditorError("websocketgateway-missing-websocket-url",this);return this._domEmitter.listenTo(window,"offline",(()=>this._isBrowserOffline=!0)),this._domEmitter.listenTo(window,"online",(()=>this._isBrowserOffline=!1)),this.context.config.define("cloudServices.connectionTimeout",10),this.context.config.define("cloudServices.requestTimeout",20),WebSocketGateway.WebSocketGateway.connect(t.token,t.webSocketUrl,{timeout:1e3*this.context.config.get("cloudServices.connectionTimeout"),requestTimeout:1e3*this.context.config.get("cloudServices.requestTimeout")}).then((e=>{if(this.connection=e,this.bind("state").to(e,"state",this,"_isBrowserOffline",((e,t)=>("connected"!==e&&(this._shouldPluginsReconnect=!0),t||e!==WEB_SOCKET_GATEWAY_STATES.CONNECTED?WEB_SOCKET_GATEWAY_STATES.DISCONNECTED:this.state==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this._shouldPluginsReconnect?(this._shouldPluginsReconnect=!1,this._reconnect(),WEB_SOCKET_GATEWAY_STATES.CONNECTING):WEB_SOCKET_GATEWAY_STATES.CONNECTED))),this.connection.on("error",((e,t)=>{if("limitExceeded"!==t.code)throw console.error(t),new CKEditorError("cloudservices-init",null,{originalError:t});n.showWarning("The limit of maximum concurrent connections that the collaboration server can handle has been reached. Try opening the document again in a few minutes. Please contact your system administrator if the problem persists.",{title:"Connected users limit exceeded",namespace:"real-time-collaboration"})})),!e.me)return new Promise((t=>e.on("change:me",t)))})).catch((e=>{throw console.error(e),new CKEditorError("cloudservices-init",null,{originalError:e})}))}addToReconnectionStack(e){if("function"!=typeof e.reconnect)throw new CKEditorError("websocketgateway-invalid-plugin-interface",this);if(this.isInReconnectionStack(e))throw new CKEditorError("websocketgateway-plugin-already-registered",this,{name:e.constructor.pluginName});this._reconnectionStack.add(e)}removeFromReconnectionStack(e){this._reconnectionStack.delete(e)}isInReconnectionStack(e){return this._reconnectionStack.has(e)}_reconnect(){return this.connection.reconnect().then((()=>Promise.all(Array.from(this._reconnectionStack,(e=>e.reconnect()))))).then((()=>this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED)).catch((e=>{throw console.error(e),new CKEditorError("cloudservices-reconnection-error",this.context)}))}destroy(){this.connection&&this.connection.disconnect(),this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._domEmitter.stopListening(),super.destroy()}}WebSocketGateway.WebSocketGateway=WebSocketGateway$1,WebSocketGateway.initialReconnectionInterval=1e3;class Sessions extends ContextPlugin{static get pluginName(){return"Sessions"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[WebSocketGateway,Users]}constructor(e){super(e),this.channelSessions=new Map,this.channelConnectedUsers=new Map,this.allConnectedUsers=new Collection,this._registeredSessions=new Map,this._uniqueUsersCount=0,this._users=this.context.plugins.get(Users)}init(){const e=this.context.plugins.get(WebSocketGateway);this.listenTo(e,"change:state",((e,t,n)=>{if("connected"!==n)this.channelSessions.forEach((e=>e.clear())),this.channelConnectedUsers.forEach((e=>e.clear())),this.allConnectedUsers.clear();else for(const[e,t]of this._registeredSessions)for(const n of t)this._handleSessionAdd(e,n)})),this._createUser(e.connection.me,!0)}register(e,t){if(this._registeredSessions.has(e))throw new CKEditorError("sessions-register-already-registered",null,{channelId:e});this._registeredSessions.set(e,t),this.channelSessions.set(e,new Collection),this.channelConnectedUsers.set(e,new Collection),this.listenTo(t,"add",((t,n)=>this._handleSessionAdd(e,n))),this.listenTo(t,"remove",((t,n)=>this._handleSessionRemove(e,n)));for(const n of t)this._handleSessionAdd(e,n)}unregister(e){if(!this._registeredSessions.has(e))throw new CKEditorError("sessions-unregister-not-exist",null,{channelId:e});const t=this._registeredSessions.get(e);this.stopListening(t);for(const n of t)"connected"===this.context.plugins.get(WebSocketGateway).state&&this._handleSessionRemove(e,n);this._registeredSessions.delete(e),this.channelSessions.delete(e),this.channelConnectedUsers.delete(e)}get mySessionId(){return this.context.plugins.get(WebSocketGateway).connection.sessionId}getUserBySessionId(e){for(const t of this.channelSessions.values())for(const n of t)if(n.id===e)return n.user}getUserSessions(e,t){const n=t?[this.channelSessions.get(t)]:this.channelSessions.values(),i=new Set;for(const t of n)for(const n of t)n.user.id===e.id&&i.add(n.id);return i}getUserRole(e){for(const t of this.channelSessions.values())for(const n of t)if(n.user===e)return n.role}_handleSessionAdd(e,t){if("connected"!==this.context.plugins.get(WebSocketGateway).state)return;const n=t.user,i=this._users.getUser(n.id)||this._createUser(n),r=Object.assign({},t,{user:i});this.channelSessions.get(e).add(r);const s=this.channelConnectedUsers.get(e);s.has(i.id)||s.add(i),this.allConnectedUsers.has(i.id)||this.allConnectedUsers.add(i,i.isMe?0:void 0),this.fire("sessionAdd:"+e,{channelId:e,session:r})}_handleSessionRemove(e,t){if("connected"!==this.context.plugins.get(WebSocketGateway).state)return;const n=this.channelConnectedUsers.get(e),i=t.user;i.id&&(this.channelSessions.get(e).remove(t.id),n.has(i.id)&&!this.getUserSessions(i,e).size&&n.remove(i.id),this.allConnectedUsers.get(i.id)&&!this.getUserSessions(i).size&&this.allConnectedUsers.remove(i.id))}_createUser(e,t){const n=this._users.addUser(e);return t&&this._users.defineMe(e.id),n.orderNumber=this._uniqueUsersCount++,n}}class UserMarkers extends Plugin{constructor(){super(...arguments),this._domEmitter=new(DomEmitterMixin())}static get requires(){return[Sessions]}static get pluginName(){return"UserMarkers"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.plugins.get(Sessions);e.conversion.for("editingDowncast").markerToElement({model:"user:position",view:(n,{writer:i})=>createUserPositionViewElement(n,i,t,e)}),e.conversion.for("editingDowncast").markerToHighlight({model:"user:range",view:e=>createUserRangeViewElement(e,t)}),createUserMarkerPostFixer(e),this._domEmitter.listenTo(_0x56a4f4.document,"keydown",((t,{key:n})=>{"Escape"===n&&hideHoveredUserPositionMarkersTooltips(e)}),{useCapture:!0})}afterInit(){const e=this.editor,t=e.commands.get("undo");t&&e.model.on("applyOperation",((n,i)=>{const r=i[0];if("marker"!=r.type||!r.name.startsWith("user:"))return;const s=r.batch;t._createdBatches.has(s)&&(r.newRange=r.oldRange?e.model.createRange(r.oldRange.start,r.oldRange.end):null)}),{priority:"highest"})}destroy(){return this._domEmitter.stopListening(),super.destroy()}createUserMarkerOperations(){const e=this.editor,t=e.model.document,n=e.plugins.get(Sessions);e.model.enqueueChange({isUndoable:!1},(i=>{const r="user:range:"+n.mySessionId,s="user:position:"+n.mySessionId,o=e.model.markers.has(r);e.editing.view.hasDomSelection?updateUserMarkers(n.mySessionId,t.selection.getFirstRange(),e.model,i):o&&(i.removeMarker(r),i.removeMarker(s))}))}}function updateUserMarkers(e,t,n,i){const r="user:range:"+e,s="user:position:"+e,o=t.getContainedElement();let a=t.start;o&&o.is("element","tableCell")&&(a=getPositionForText(t,n),t=i.createRange(a));const c=i.createRange(a);n.markers.has(r)?(i.updateMarker(r,{range:t}),i.updateMarker(s,{range:c})):(i.addMarker(r,{range:t,usingOperation:!0}),i.addMarker(s,{range:c,usingOperation:!0}))}function getPositionForText(e,t){for(const n of e.getPositions())if(t.schema.checkChild(n,"$text"))return n}function createUserPositionViewElement(e,t,n,i){const r=e.markerName.split(":")[2],s=n.getUserBySessionId(r);if(!s||r===n.mySessionId)return;if(!i.model.schema.checkChild(e.markerRange.start,"$text"))return;const o={class:"ck-user__marker "+s.color.getMarkerClass(),"data-name":s.name,"data-session-id":r},a=i.model.markers.get(e.markerName).getStart(),c=a.nodeAfter,l=i.model.schema;if(c&&l.isObject(c)&&l.isInline(c)&&!i.model.markers.get("user:range:"+r).getRange().isCollapsed)return;const d=a.parent;return i.model.schema.isLimit(d)&&!i.model.hasContent(d)&&(o.contenteditable=!1),createUserPositionMarkerElement(t,o,s)}function createUserRangeViewElement(e,t){const n=e.markerName.split(":")[2];if(n===t.mySessionId)return null;const i=t.getUserBySessionId(n);return i?{id:n,classes:["ck-user__selection",i.color.getSelectionClass()],attributes:{"data-session-id":n},priority:2e3+i.orderNumber}:{id:n,classes:[]}}function createUserPositionMarkerElement(e,t,n){const i=e.createUIElement("span",t);return e.setCustomProperty("userPositionMarker",!0,i),i.render=function(e){const t=this.toDomElement(e);return t.innerHTML='<span class="ck-user__marker-line" contenteditable="false"><span class="ck-user__marker-dot"></span></span><span class="ck-user__marker-tooltip" contenteditable="false" spellcheck="false">'+n.name+"</span>",t.addEventListener("mouseenter",(()=>{t.classList.add("ck-user__marker_hovered")})),t.addEventListener("mouseleave",(()=>{t.classList.remove("ck-user__marker_hovered")})),t},i.isSimilar=function(e){return!(!this.getCustomProperty("userPositionMarker")||!e.getCustomProperty("userPositionMarker")||this.getAttribute("data-session-id")!=e.getAttribute("data-session-id"))},i}function hideHoveredUserPositionMarkersTooltips(e){e.editing.view.change((t=>{for(const n of e.model.markers){if(!n.name.startsWith("user:position"))continue;const i=e.editing.mapper.markerNameToElements(n.name);if(i)for(const e of i)t.removeClass("ck-user__marker_hovered",e)}}))}function createUserMarkerPostFixer(e){const t=e.model,n=new Map,i=e.plugins.get(Sessions);t.markers.on("update:user:range",((r,s,o,a)=>{if(!a&&n.get(s.name))return n.get(s.name).detach(),void n.delete(s.name);const c=s.name.split(":")[2];if(c===i.mySessionId)return;const l="user:position:"+c;t.markers.has(l)&&e.editing.reconvertMarker(l),s.on("change:range",((e,i,r)=>{if("$graveyard"!=i.root.rootName&&"$graveyard"==s.getRange().root.rootName&&!n.has(s.name)){const e=t.schema.getNearestSelectionRange(r.deletionPosition);if(e){const i=LiveRange.fromRange(e);n.set(s.name,i),i.on("change:range",((e,r,o)=>{if("$graveyard"==i.root.rootName){const e=t.schema.getNearestSelectionRange(o.deletionPosition);e?(i.start=e.start,i.end=e.end):(n.delete(s.name),i.detach())}}))}}}))})),t.document.on("change",(()=>{n.size>0&&t.enqueueChange({isUndoable:!1},(e=>{for(const[i,r]of n)"$graveyard"==t.markers.get(i).getRange().root.rootName&&(updateUserMarkers(i.split(":")[2],r.toRange(),t,e),r.detach());n.clear()}))}))}function getTranslation$4(e,t,n){const i=e.t,r=e.t;switch(t){case"PENDING_ACTION_SENDING_DATA":return r({string:"Sending data to the server.",id:"PENDING_ACTION_SENDING_DATA"});case"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.":return r("The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.");case"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.":return r("The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");case"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.":return r("The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");case"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.":return r("The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");case"Synchronization issue":return r("Synchronization issue");case"Connected users list dropdown menu":return r("Connected users list dropdown menu");case"Collapsed connected users list (press ENTER to open it)":return r("Collapsed connected users list (press ENTER to open it)");case"Connected users list":return r("Connected users list");case"PENDING_ACTION_REVISION_HISTORY":return i({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"CONNECTED_USERS":return r({string:"1 connected user (me)",plural:"%0 connected users",id:"CONNECTED_USERS"},n);default:return""}}const messages=/*   -- @preserve */
(()=>{var e=minimal.Reader,t=minimal.Writer,n=minimal.util,i=minimal.roots.default||(minimal.roots.default={});return i.AttributeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.range=null,r.prototype.key="",r.prototype.oldValueBoolean=!1,r.prototype.oldValueJson="",r.prototype.newValueBoolean=!1,r.prototype.newValueJson="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.range&&Object.hasOwnProperty.call(e,"range")&&i.Range.encode(e.range,n.uint32(10).fork()).ldelim(),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(18).string(e.key),null!=e.oldValueBoolean&&Object.hasOwnProperty.call(e,"oldValueBoolean")&&n.uint32(24).bool(e.oldValueBoolean),null!=e.oldValueJson&&Object.hasOwnProperty.call(e,"oldValueJson")&&n.uint32(34).string(e.oldValueJson),null!=e.newValueBoolean&&Object.hasOwnProperty.call(e,"newValueBoolean")&&n.uint32(40).bool(e.newValueBoolean),null!=e.newValueJson&&Object.hasOwnProperty.call(e,"newValueJson")&&n.uint32(50).string(e.newValueJson),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(56).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.AttributeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.range=i.Range.decode(t,t.uint32());break;case 2:s.key=t.string();break;case 3:s.oldValueBoolean=t.bool();break;case 4:s.oldValueJson=t.string();break;case 5:s.newValueBoolean=t.bool();break;case 6:s.newValueJson=t.string();break;case 7:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.range&&e.hasOwnProperty("range")){var t=i.Range.verify(e.range);if(t)return"range."+t}return null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&"boolean"!=typeof e.oldValueBoolean?"oldValueBoolean: boolean expected":null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&!n.isString(e.oldValueJson)?"oldValueJson: string expected":null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&"boolean"!=typeof e.newValueBoolean?"newValueBoolean: boolean expected":null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&!n.isString(e.newValueJson)?"newValueJson: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.AttributeOperation)return e;var t=new i.AttributeOperation;if(null!=e.range){if("object"!=typeof e.range)throw TypeError(".AttributeOperation.range: object expected");t.range=i.Range.fromObject(e.range)}return null!=e.key&&(t.key=String(e.key)),null!=e.oldValueBoolean&&(t.oldValueBoolean=Boolean(e.oldValueBoolean)),null!=e.oldValueJson&&(t.oldValueJson=String(e.oldValueJson)),null!=e.newValueBoolean&&(t.newValueBoolean=Boolean(e.newValueBoolean)),null!=e.newValueJson&&(t.newValueJson=String(e.newValueJson)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.range=null,n.key="",n.oldValueBoolean=!1,n.oldValueJson="",n.newValueBoolean=!1,n.newValueJson="",n.wasUndone=!1),null!=e.range&&e.hasOwnProperty("range")&&(n.range=i.Range.toObject(e.range,t)),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&(n.oldValueBoolean=e.oldValueBoolean),null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&(n.oldValueJson=e.oldValueJson),null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&(n.newValueBoolean=e.newValueBoolean),null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&(n.newValueJson=e.newValueJson),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/AttributeOperation"},r}(),i.InsertOperation=function(){function r(e){if(this.nodes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.position=null,r.prototype.nodes=n.emptyArray,r.prototype.shouldReceiveAttributes=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.position&&Object.hasOwnProperty.call(e,"position")&&i.Position.encode(e.position,n.uint32(10).fork()).ldelim(),null!=e.nodes&&e.nodes.length)for(var r=0;r<e.nodes.length;++r)i.Element.encode(e.nodes[r],n.uint32(18).fork()).ldelim();return null!=e.shouldReceiveAttributes&&Object.hasOwnProperty.call(e,"shouldReceiveAttributes")&&n.uint32(24).bool(e.shouldReceiveAttributes),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.InsertOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.position=i.Position.decode(t,t.uint32());break;case 2:s.nodes&&s.nodes.length||(s.nodes=[]),s.nodes.push(i.Element.decode(t,t.uint32()));break;case 3:s.shouldReceiveAttributes=t.bool();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.position&&e.hasOwnProperty("position")&&(n=i.Position.verify(e.position)))return"position."+n;if(null!=e.nodes&&e.hasOwnProperty("nodes")){if(!Array.isArray(e.nodes))return"nodes: array expected";for(var t=0;t<e.nodes.length;++t){var n;if(n=i.Element.verify(e.nodes[t]))return"nodes."+n}}return null!=e.shouldReceiveAttributes&&e.hasOwnProperty("shouldReceiveAttributes")&&"boolean"!=typeof e.shouldReceiveAttributes?"shouldReceiveAttributes: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.InsertOperation)return e;var t=new i.InsertOperation;if(null!=e.position){if("object"!=typeof e.position)throw TypeError(".InsertOperation.position: object expected");t.position=i.Position.fromObject(e.position)}if(e.nodes){if(!Array.isArray(e.nodes))throw TypeError(".InsertOperation.nodes: array expected");t.nodes=[];for(var n=0;n<e.nodes.length;++n){if("object"!=typeof e.nodes[n])throw TypeError(".InsertOperation.nodes: object expected");t.nodes[n]=i.Element.fromObject(e.nodes[n])}}return null!=e.shouldReceiveAttributes&&(t.shouldReceiveAttributes=Boolean(e.shouldReceiveAttributes)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.nodes=[]),t.defaults&&(n.position=null,n.shouldReceiveAttributes=!1,n.wasUndone=!1),null!=e.position&&e.hasOwnProperty("position")&&(n.position=i.Position.toObject(e.position,t)),e.nodes&&e.nodes.length){n.nodes=[];for(var r=0;r<e.nodes.length;++r)n.nodes[r]=i.Element.toObject(e.nodes[r],t)}return null!=e.shouldReceiveAttributes&&e.hasOwnProperty("shouldReceiveAttributes")&&(n.shouldReceiveAttributes=e.shouldReceiveAttributes),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/InsertOperation"},r}(),i.MarkerOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.name="",r.prototype.oldRange=null,r.prototype.newRange=null,r.prototype.affectsData=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(10).string(e.name),null!=e.oldRange&&Object.hasOwnProperty.call(e,"oldRange")&&i.Range.encode(e.oldRange,n.uint32(18).fork()).ldelim(),null!=e.newRange&&Object.hasOwnProperty.call(e,"newRange")&&i.Range.encode(e.newRange,n.uint32(26).fork()).ldelim(),null!=e.affectsData&&Object.hasOwnProperty.call(e,"affectsData")&&n.uint32(32).bool(e.affectsData),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MarkerOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.name=t.string();break;case 2:s.oldRange=i.Range.decode(t,t.uint32());break;case 3:s.newRange=i.Range.decode(t,t.uint32());break;case 4:s.affectsData=t.bool();break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.oldRange&&e.hasOwnProperty("oldRange")&&(t=i.Range.verify(e.oldRange))?"oldRange."+t:null!=e.newRange&&e.hasOwnProperty("newRange")&&(t=i.Range.verify(e.newRange))?"newRange."+t:null!=e.affectsData&&e.hasOwnProperty("affectsData")&&"boolean"!=typeof e.affectsData?"affectsData: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MarkerOperation)return e;var t=new i.MarkerOperation;if(null!=e.name&&(t.name=String(e.name)),null!=e.oldRange){if("object"!=typeof e.oldRange)throw TypeError(".MarkerOperation.oldRange: object expected");t.oldRange=i.Range.fromObject(e.oldRange)}if(null!=e.newRange){if("object"!=typeof e.newRange)throw TypeError(".MarkerOperation.newRange: object expected");t.newRange=i.Range.fromObject(e.newRange)}return null!=e.affectsData&&(t.affectsData=Boolean(e.affectsData)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.name="",n.oldRange=null,n.newRange=null,n.affectsData=!1,n.wasUndone=!1),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.oldRange&&e.hasOwnProperty("oldRange")&&(n.oldRange=i.Range.toObject(e.oldRange,t)),null!=e.newRange&&e.hasOwnProperty("newRange")&&(n.newRange=i.Range.toObject(e.newRange,t)),null!=e.affectsData&&e.hasOwnProperty("affectsData")&&(n.affectsData=e.affectsData),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MarkerOperation"},r}(),i.MergeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.sourcePosition=null,r.prototype.targetPosition=null,r.prototype.graveyardPosition=null,r.prototype.howMany=0,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.sourcePosition&&Object.hasOwnProperty.call(e,"sourcePosition")&&i.Position.encode(e.sourcePosition,n.uint32(10).fork()).ldelim(),null!=e.targetPosition&&Object.hasOwnProperty.call(e,"targetPosition")&&i.Position.encode(e.targetPosition,n.uint32(18).fork()).ldelim(),null!=e.graveyardPosition&&Object.hasOwnProperty.call(e,"graveyardPosition")&&i.Position.encode(e.graveyardPosition,n.uint32(26).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(32).uint32(e.howMany),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MergeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.sourcePosition=i.Position.decode(t,t.uint32());break;case 2:s.targetPosition=i.Position.decode(t,t.uint32());break;case 3:s.graveyardPosition=i.Position.decode(t,t.uint32());break;case 4:s.howMany=t.uint32();break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(t=i.Position.verify(e.sourcePosition))?"sourcePosition."+t:null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(t=i.Position.verify(e.targetPosition))?"targetPosition."+t:null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(t=i.Position.verify(e.graveyardPosition))?"graveyardPosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MergeOperation)return e;var t=new i.MergeOperation;if(null!=e.sourcePosition){if("object"!=typeof e.sourcePosition)throw TypeError(".MergeOperation.sourcePosition: object expected");t.sourcePosition=i.Position.fromObject(e.sourcePosition)}if(null!=e.targetPosition){if("object"!=typeof e.targetPosition)throw TypeError(".MergeOperation.targetPosition: object expected");t.targetPosition=i.Position.fromObject(e.targetPosition)}if(null!=e.graveyardPosition){if("object"!=typeof e.graveyardPosition)throw TypeError(".MergeOperation.graveyardPosition: object expected");t.graveyardPosition=i.Position.fromObject(e.graveyardPosition)}return null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourcePosition=null,n.targetPosition=null,n.graveyardPosition=null,n.howMany=0,n.wasUndone=!1),null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(n.sourcePosition=i.Position.toObject(e.sourcePosition,t)),null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(n.targetPosition=i.Position.toObject(e.targetPosition,t)),null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(n.graveyardPosition=i.Position.toObject(e.graveyardPosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MergeOperation"},r}(),i.MoveOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.sourcePosition=null,r.prototype.howMany=0,r.prototype.targetPosition=null,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.sourcePosition&&Object.hasOwnProperty.call(e,"sourcePosition")&&i.Position.encode(e.sourcePosition,n.uint32(10).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(16).uint32(e.howMany),null!=e.targetPosition&&Object.hasOwnProperty.call(e,"targetPosition")&&i.Position.encode(e.targetPosition,n.uint32(26).fork()).ldelim(),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MoveOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.sourcePosition=i.Position.decode(t,t.uint32());break;case 2:s.howMany=t.uint32();break;case 3:s.targetPosition=i.Position.decode(t,t.uint32());break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(t=i.Position.verify(e.sourcePosition))?"sourcePosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(t=i.Position.verify(e.targetPosition))?"targetPosition."+t:null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MoveOperation)return e;var t=new i.MoveOperation;if(null!=e.sourcePosition){if("object"!=typeof e.sourcePosition)throw TypeError(".MoveOperation.sourcePosition: object expected");t.sourcePosition=i.Position.fromObject(e.sourcePosition)}if(null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.targetPosition){if("object"!=typeof e.targetPosition)throw TypeError(".MoveOperation.targetPosition: object expected");t.targetPosition=i.Position.fromObject(e.targetPosition)}return null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourcePosition=null,n.howMany=0,n.targetPosition=null,n.wasUndone=!1),null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(n.sourcePosition=i.Position.toObject(e.sourcePosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(n.targetPosition=i.Position.toObject(e.targetPosition,t)),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MoveOperation"},r}(),i.RenameOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.position=null,r.prototype.oldName="",r.prototype.newName="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.position&&Object.hasOwnProperty.call(e,"position")&&i.Position.encode(e.position,n.uint32(10).fork()).ldelim(),null!=e.oldName&&Object.hasOwnProperty.call(e,"oldName")&&n.uint32(18).string(e.oldName),null!=e.newName&&Object.hasOwnProperty.call(e,"newName")&&n.uint32(26).string(e.newName),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RenameOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.position=i.Position.decode(t,t.uint32());break;case 2:s.oldName=t.string();break;case 3:s.newName=t.string();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.position&&e.hasOwnProperty("position")){var t=i.Position.verify(e.position);if(t)return"position."+t}return null!=e.oldName&&e.hasOwnProperty("oldName")&&!n.isString(e.oldName)?"oldName: string expected":null!=e.newName&&e.hasOwnProperty("newName")&&!n.isString(e.newName)?"newName: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RenameOperation)return e;var t=new i.RenameOperation;if(null!=e.position){if("object"!=typeof e.position)throw TypeError(".RenameOperation.position: object expected");t.position=i.Position.fromObject(e.position)}return null!=e.oldName&&(t.oldName=String(e.oldName)),null!=e.newName&&(t.newName=String(e.newName)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.position=null,n.oldName="",n.newName="",n.wasUndone=!1),null!=e.position&&e.hasOwnProperty("position")&&(n.position=i.Position.toObject(e.position,t)),null!=e.oldName&&e.hasOwnProperty("oldName")&&(n.oldName=e.oldName),null!=e.newName&&e.hasOwnProperty("newName")&&(n.newName=e.newName),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RenameOperation"},r}(),i.RootAttributeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.root="",r.prototype.key="",r.prototype.oldValueBoolean=!1,r.prototype.oldValueJson="",r.prototype.newValueBoolean=!1,r.prototype.newValueJson="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.root&&Object.hasOwnProperty.call(e,"root")&&n.uint32(10).string(e.root),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(18).string(e.key),null!=e.oldValueBoolean&&Object.hasOwnProperty.call(e,"oldValueBoolean")&&n.uint32(24).bool(e.oldValueBoolean),null!=e.oldValueJson&&Object.hasOwnProperty.call(e,"oldValueJson")&&n.uint32(34).string(e.oldValueJson),null!=e.newValueBoolean&&Object.hasOwnProperty.call(e,"newValueBoolean")&&n.uint32(40).bool(e.newValueBoolean),null!=e.newValueJson&&Object.hasOwnProperty.call(e,"newValueJson")&&n.uint32(50).string(e.newValueJson),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(56).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RootAttributeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.root=t.string();break;case 2:s.key=t.string();break;case 3:s.oldValueBoolean=t.bool();break;case 4:s.oldValueJson=t.string();break;case 5:s.newValueBoolean=t.bool();break;case 6:s.newValueJson=t.string();break;case 7:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.root&&e.hasOwnProperty("root")&&!n.isString(e.root)?"root: string expected":null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&"boolean"!=typeof e.oldValueBoolean?"oldValueBoolean: boolean expected":null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&!n.isString(e.oldValueJson)?"oldValueJson: string expected":null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&"boolean"!=typeof e.newValueBoolean?"newValueBoolean: boolean expected":null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&!n.isString(e.newValueJson)?"newValueJson: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RootAttributeOperation)return e;var t=new i.RootAttributeOperation;return null!=e.root&&(t.root=String(e.root)),null!=e.key&&(t.key=String(e.key)),null!=e.oldValueBoolean&&(t.oldValueBoolean=Boolean(e.oldValueBoolean)),null!=e.oldValueJson&&(t.oldValueJson=String(e.oldValueJson)),null!=e.newValueBoolean&&(t.newValueBoolean=Boolean(e.newValueBoolean)),null!=e.newValueJson&&(t.newValueJson=String(e.newValueJson)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.root="",n.key="",n.oldValueBoolean=!1,n.oldValueJson="",n.newValueBoolean=!1,n.newValueJson="",n.wasUndone=!1),null!=e.root&&e.hasOwnProperty("root")&&(n.root=e.root),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&(n.oldValueBoolean=e.oldValueBoolean),null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&(n.oldValueJson=e.oldValueJson),null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&(n.newValueBoolean=e.newValueBoolean),null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&(n.newValueJson=e.newValueJson),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RootAttributeOperation"},r}(),i.RootOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.rootName="",r.prototype.elementName="",r.prototype.isAdd=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.rootName&&Object.hasOwnProperty.call(e,"rootName")&&n.uint32(10).string(e.rootName),null!=e.elementName&&Object.hasOwnProperty.call(e,"elementName")&&n.uint32(18).string(e.elementName),null!=e.isAdd&&Object.hasOwnProperty.call(e,"isAdd")&&n.uint32(24).bool(e.isAdd),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RootOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.rootName=t.string();break;case 2:s.elementName=t.string();break;case 3:s.isAdd=t.bool();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.rootName&&e.hasOwnProperty("rootName")&&!n.isString(e.rootName)?"rootName: string expected":null!=e.elementName&&e.hasOwnProperty("elementName")&&!n.isString(e.elementName)?"elementName: string expected":null!=e.isAdd&&e.hasOwnProperty("isAdd")&&"boolean"!=typeof e.isAdd?"isAdd: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RootOperation)return e;var t=new i.RootOperation;return null!=e.rootName&&(t.rootName=String(e.rootName)),null!=e.elementName&&(t.elementName=String(e.elementName)),null!=e.isAdd&&(t.isAdd=Boolean(e.isAdd)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.rootName="",n.elementName="",n.isAdd=!1,n.wasUndone=!1),null!=e.rootName&&e.hasOwnProperty("rootName")&&(n.rootName=e.rootName),null!=e.elementName&&e.hasOwnProperty("elementName")&&(n.elementName=e.elementName),null!=e.isAdd&&e.hasOwnProperty("isAdd")&&(n.isAdd=e.isAdd),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RootOperation"},r}(),i.SplitOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.splitPosition=null,r.prototype.graveyardPosition=null,r.prototype.howMany=0,r.prototype.insertionPosition=null,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.splitPosition&&Object.hasOwnProperty.call(e,"splitPosition")&&i.Position.encode(e.splitPosition,n.uint32(10).fork()).ldelim(),null!=e.graveyardPosition&&Object.hasOwnProperty.call(e,"graveyardPosition")&&i.Position.encode(e.graveyardPosition,n.uint32(18).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(24).uint32(e.howMany),null!=e.insertionPosition&&Object.hasOwnProperty.call(e,"insertionPosition")&&i.Position.encode(e.insertionPosition,n.uint32(34).fork()).ldelim(),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SplitOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.splitPosition=i.Position.decode(t,t.uint32());break;case 2:s.graveyardPosition=i.Position.decode(t,t.uint32());break;case 3:s.howMany=t.uint32();break;case 4:s.insertionPosition=i.Position.decode(t,t.uint32());break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.splitPosition&&e.hasOwnProperty("splitPosition")&&(t=i.Position.verify(e.splitPosition))?"splitPosition."+t:null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(t=i.Position.verify(e.graveyardPosition))?"graveyardPosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.insertionPosition&&e.hasOwnProperty("insertionPosition")&&(t=i.Position.verify(e.insertionPosition))?"insertionPosition."+t:null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.SplitOperation)return e;var t=new i.SplitOperation;if(null!=e.splitPosition){if("object"!=typeof e.splitPosition)throw TypeError(".SplitOperation.splitPosition: object expected");t.splitPosition=i.Position.fromObject(e.splitPosition)}if(null!=e.graveyardPosition){if("object"!=typeof e.graveyardPosition)throw TypeError(".SplitOperation.graveyardPosition: object expected");t.graveyardPosition=i.Position.fromObject(e.graveyardPosition)}if(null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.insertionPosition){if("object"!=typeof e.insertionPosition)throw TypeError(".SplitOperation.insertionPosition: object expected");t.insertionPosition=i.Position.fromObject(e.insertionPosition)}return null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.splitPosition=null,n.graveyardPosition=null,n.howMany=0,n.insertionPosition=null,n.wasUndone=!1),null!=e.splitPosition&&e.hasOwnProperty("splitPosition")&&(n.splitPosition=i.Position.toObject(e.splitPosition,t)),null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(n.graveyardPosition=i.Position.toObject(e.graveyardPosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.insertionPosition&&e.hasOwnProperty("insertionPosition")&&(n.insertionPosition=i.Position.toObject(e.insertionPosition,t)),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SplitOperation"},r}(),i.Position=function(){function r(e){if(this.path=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.root="",r.prototype.rootMain=!1,r.prototype.rootGraveyard=!1,r.prototype.path=n.emptyArray,r.prototype.stickiness="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.root&&Object.hasOwnProperty.call(e,"root")&&n.uint32(10).string(e.root),null!=e.rootMain&&Object.hasOwnProperty.call(e,"rootMain")&&n.uint32(16).bool(e.rootMain),null!=e.rootGraveyard&&Object.hasOwnProperty.call(e,"rootGraveyard")&&n.uint32(24).bool(e.rootGraveyard),null!=e.path&&e.path.length){n.uint32(34).fork();for(var i=0;i<e.path.length;++i)n.uint32(e.path[i]);n.ldelim()}return null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&n.uint32(42).string(e.stickiness),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.Position;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.root=t.string();break;case 2:s.rootMain=t.bool();break;case 3:s.rootGraveyard=t.bool();break;case 4:if(s.path&&s.path.length||(s.path=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.path.push(t.uint32());else s.path.push(t.uint32());break;case 5:s.stickiness=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.root&&e.hasOwnProperty("root")&&!n.isString(e.root))return"root: string expected";if(null!=e.rootMain&&e.hasOwnProperty("rootMain")&&"boolean"!=typeof e.rootMain)return"rootMain: boolean expected";if(null!=e.rootGraveyard&&e.hasOwnProperty("rootGraveyard")&&"boolean"!=typeof e.rootGraveyard)return"rootGraveyard: boolean expected";if(null!=e.path&&e.hasOwnProperty("path")){if(!Array.isArray(e.path))return"path: array expected";for(var t=0;t<e.path.length;++t)if(!n.isInteger(e.path[t]))return"path: integer[] expected"}return null!=e.stickiness&&e.hasOwnProperty("stickiness")&&!n.isString(e.stickiness)?"stickiness: string expected":null},r.fromObject=function(e){if(e instanceof i.Position)return e;var t=new i.Position;if(null!=e.root&&(t.root=String(e.root)),null!=e.rootMain&&(t.rootMain=Boolean(e.rootMain)),null!=e.rootGraveyard&&(t.rootGraveyard=Boolean(e.rootGraveyard)),e.path){if(!Array.isArray(e.path))throw TypeError(".Position.path: array expected");t.path=[];for(var n=0;n<e.path.length;++n)t.path[n]=e.path[n]>>>0}return null!=e.stickiness&&(t.stickiness=String(e.stickiness)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.path=[]),t.defaults&&(n.root="",n.rootMain=!1,n.rootGraveyard=!1,n.stickiness=""),null!=e.root&&e.hasOwnProperty("root")&&(n.root=e.root),null!=e.rootMain&&e.hasOwnProperty("rootMain")&&(n.rootMain=e.rootMain),null!=e.rootGraveyard&&e.hasOwnProperty("rootGraveyard")&&(n.rootGraveyard=e.rootGraveyard),e.path&&e.path.length){n.path=[];for(var i=0;i<e.path.length;++i)n.path[i]=e.path[i]}return null!=e.stickiness&&e.hasOwnProperty("stickiness")&&(n.stickiness=e.stickiness),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Position"},r}(),i.Range=function(){function n(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return n.prototype.start=null,n.prototype.end=null,n.create=function(e){return new n(e)},n.encode=function(e,n){return n||(n=t.create()),null!=e.start&&Object.hasOwnProperty.call(e,"start")&&i.Position.encode(e.start,n.uint32(10).fork()).ldelim(),null!=e.end&&Object.hasOwnProperty.call(e,"end")&&i.Position.encode(e.end,n.uint32(18).fork()).ldelim(),n},n.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},n.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.Range;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.start=i.Position.decode(t,t.uint32());break;case 2:s.end=i.Position.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},n.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},n.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.start&&e.hasOwnProperty("start")&&(t=i.Position.verify(e.start))?"start."+t:null!=e.end&&e.hasOwnProperty("end")&&(t=i.Position.verify(e.end))?"end."+t:null;var t},n.fromObject=function(e){if(e instanceof i.Range)return e;var t=new i.Range;if(null!=e.start){if("object"!=typeof e.start)throw TypeError(".Range.start: object expected");t.start=i.Position.fromObject(e.start)}if(null!=e.end){if("object"!=typeof e.end)throw TypeError(".Range.end: object expected");t.end=i.Position.fromObject(e.end)}return t},n.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.start=null,n.end=null),null!=e.start&&e.hasOwnProperty("start")&&(n.start=i.Position.toObject(e.start,t)),null!=e.end&&e.hasOwnProperty("end")&&(n.end=i.Position.toObject(e.end,t)),n},n.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},n.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Range"},n}(),i.Element=function(){function r(e){if(this.children=[],this.attributesBoolean={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.name="",r.prototype.children=n.emptyArray,r.prototype.data="",r.prototype.attributesBoolean=n.emptyObject,r.prototype.attributesJson="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(10).string(e.name),null!=e.children&&e.children.length)for(var r=0;r<e.children.length;++r)i.Element.encode(e.children[r],n.uint32(18).fork()).ldelim();if(null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(26).string(e.data),null!=e.attributesBoolean&&Object.hasOwnProperty.call(e,"attributesBoolean")){var s=Object.keys(e.attributesBoolean);for(r=0;r<s.length;++r)n.uint32(34).fork().uint32(10).string(s[r]).uint32(16).bool(e.attributesBoolean[s[r]]).ldelim()}return null!=e.attributesJson&&Object.hasOwnProperty.call(e,"attributesJson")&&n.uint32(42).string(e.attributesJson),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,r){t instanceof e||(t=e.create(t));for(var s,o,a=void 0===r?t.len:t.pos+r,c=new i.Element;t.pos<a;){var l=t.uint32();switch(l>>>3){case 1:c.name=t.string();break;case 2:c.children&&c.children.length||(c.children=[]),c.children.push(i.Element.decode(t,t.uint32()));break;case 3:c.data=t.string();break;case 4:c.attributesBoolean===n.emptyObject&&(c.attributesBoolean={});var d=t.uint32()+t.pos;for(s="",o=!1;t.pos<d;){var u=t.uint32();switch(u>>>3){case 1:s=t.string();break;case 2:o=t.bool();break;default:t.skipType(7&u)}}c.attributesBoolean[s]=o;break;case 5:c.attributesJson=t.string();break;default:t.skipType(7&l)}}return c},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name))return"name: string expected";if(null!=e.children&&e.hasOwnProperty("children")){if(!Array.isArray(e.children))return"children: array expected";for(var t=0;t<e.children.length;++t){var r=i.Element.verify(e.children[t]);if(r)return"children."+r}}if(null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data))return"data: string expected";if(null!=e.attributesBoolean&&e.hasOwnProperty("attributesBoolean")){if(!n.isObject(e.attributesBoolean))return"attributesBoolean: object expected";var s=Object.keys(e.attributesBoolean);for(t=0;t<s.length;++t)if("boolean"!=typeof e.attributesBoolean[s[t]])return"attributesBoolean: boolean{k:string} expected"}return null!=e.attributesJson&&e.hasOwnProperty("attributesJson")&&!n.isString(e.attributesJson)?"attributesJson: string expected":null},r.fromObject=function(e){if(e instanceof i.Element)return e;var t=new i.Element;if(null!=e.name&&(t.name=String(e.name)),e.children){if(!Array.isArray(e.children))throw TypeError(".Element.children: array expected");t.children=[];for(var n=0;n<e.children.length;++n){if("object"!=typeof e.children[n])throw TypeError(".Element.children: object expected");t.children[n]=i.Element.fromObject(e.children[n])}}if(null!=e.data&&(t.data=String(e.data)),e.attributesBoolean){if("object"!=typeof e.attributesBoolean)throw TypeError(".Element.attributesBoolean: object expected");t.attributesBoolean={};var r=Object.keys(e.attributesBoolean);for(n=0;n<r.length;++n)t.attributesBoolean[r[n]]=Boolean(e.attributesBoolean[r[n]])}return null!=e.attributesJson&&(t.attributesJson=String(e.attributesJson)),t},r.toObject=function(e,t){t||(t={});var n,r={};if((t.arrays||t.defaults)&&(r.children=[]),(t.objects||t.defaults)&&(r.attributesBoolean={}),t.defaults&&(r.name="",r.data="",r.attributesJson=""),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),e.children&&e.children.length){r.children=[];for(var s=0;s<e.children.length;++s)r.children[s]=i.Element.toObject(e.children[s],t)}if(null!=e.data&&e.hasOwnProperty("data")&&(r.data=e.data),e.attributesBoolean&&(n=Object.keys(e.attributesBoolean)).length)for(r.attributesBoolean={},s=0;s<n.length;++s)r.attributesBoolean[n[s]]=e.attributesBoolean[n[s]];return null!=e.attributesJson&&e.hasOwnProperty("attributesJson")&&(r.attributesJson=e.attributesJson),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Element"},r}(),i})();class ProtobufFactory{constructor(){this._protobufRoot=messages}getDescriptor(e){return new ProtobufDescriptor(this._protobufRoot[e])}}class ProtobufDescriptor{constructor(e){this._protobuf=e}compress(e){const t=this._protobuf.verify(e);if(t)throw Error(t);return this._protobuf.encode(this._protobuf.create(e)).finish()}decompress(e){return this._protobuf.toObject(this._protobuf.decode(e),{oneofs:!0})}}function getPositionShiftedBy(e,t){const n=cloneDeep(e);return n.path[n.path.length-1]+=t,n}function arePositionsEqual(e,t){return e.root===t.root&&isEqual(e.path,t.path)}function parsePositionBeforeCompression(e){_mapPositions(e,(e=>("main"==e.root?(e.rootMain=!0,delete e.root):"$graveyard"==e.root&&(e.rootGraveyard=!0,delete e.root),e)))}function parsePositionAfterCompression(e){_mapPositions(e,(e=>(e.rootMain?(e.root="main",delete e.rootMain):e.rootGraveyard&&(e.root="$graveyard",delete e.rootGraveyard),e)))}function _mapPositions(e,t){for(const n in e){const i=e[n];"nodes"!==n&&isObject$1(i)&&(i.path&&(i.root||i.rootMain||i.rootGraveyard)?e[n]=t(i):_mapPositions(i,t))}return e}class OperationCompressor{constructor(e,t,n){this._id=e,this._operationName=t,this._protobufDescriptor=n}compress(e,t){const n=t.shift();return parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){t.types.shift();const n=this._protobufDescriptor.decompress(t.buffers.shift());parsePositionAfterCompression(n),n.__className=this._operationName,e.push(n)}}class AttributeOperationCompressor extends OperationCompressor{compress(e,t){const n=t.shift();return this._serializeOneOf("oldValue",n),this._serializeOneOf("newValue",n),parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){const{types:n,buffers:i}=t,r=this._protobufDescriptor.decompress(i.shift());n.shift(),this._deserializeOneOf("oldValue",r),this._deserializeOneOf("newValue",r),parsePositionAfterCompression(r),r.__className=this._operationName,e.push(r)}_serializeOneOf(e,t){const n=t[e];"boolean"==typeof n?t[e+"Boolean"]=n:t[e+"Json"]=JSON.stringify(n)}_deserializeOneOf(e,t){const n=e+"Json";t[n]?(t[e]=JSON.parse(t[n]),delete t[n]):(t[e]=t[e+"Boolean"],delete t[e+"Boolean"])}}class InsertOperationCompressor extends OperationCompressor{compress(e,t){const n=t.shift();return this._serializeNodesAttributes(n.nodes),parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){const{types:n,buffers:i}=t,r=this._protobufDescriptor.decompress(i.shift());n.shift(),r.nodes||(r.nodes=[]),this._deserializeNodesAttributes(r.nodes),parsePositionAfterCompression(r),r.__className=this._operationName,e.push(r)}_serializeNodesAttributes(e){for(const t of e){if(t.attributes){const e=t.attributes;this._areValuesBoolean(e)?t.attributesBoolean=e:t.attributesJson=JSON.stringify(e)}t.children&&this._serializeNodesAttributes(t.children)}}_deserializeNodesAttributes(e){for(const t of e)(t.attributesBoolean||t.attributesJson)&&(t.attributesBoolean?(t.attributes=t.attributesBoolean,delete t.attributesBoolean):(t.attributes=JSON.parse(t.attributesJson),delete t.attributesJson)),t.children&&this._deserializeNodesAttributes(t.children)}_areValuesBoolean(e){return Object.keys(e).every((t=>"boolean"==typeof e[t]))}}class MarkerOperationCompressor extends OperationCompressor{decompress(e,t){super.decompress(e,t);const n=e[e.length-1];n.oldRange||(n.oldRange=null),n.newRange||(n.newRange=null)}}class NoOperationCompressor extends OperationCompressor{compress(e,t){return t.shift(),e.types.push(this._id),!0}decompress(e,t){t.types.shift(),e.push({__className:this._operationName})}}class AnnotationMarkerOperationCompressor extends MarkerOperationCompressor{constructor(e,t,n,i){super(e,t,n),this._omittedNamespace=i+":"}compress(e,t){return!("MarkerOperation"!=t[0].__className||!t[0].name.startsWith(this._omittedNamespace)||(t[0].name=t[0].name.replace(new RegExp("^"+this._omittedNamespace),""),super.compress(e,t),0))}decompress(e,t){super.decompress(e,t);const n=e[e.length-1];n.name=this._omittedNamespace+n.name}}class ActionCompressor{constructor(e,t){this._id=e,this._context=t}compress(e,t){let n;for(;t.length>1&&this._compareOperations(t[0],t[1]);)n?(n=this._combineNext(t.shift(),n),e.types.push(0)):(n=cloneDeep(t.shift()),e.types.push(this._id));return!!n&&(n=this._combineNext(t.shift(),n),e.types.push(0),e.buffers.push(this._compressSingleOperation(n)),!0)}decompress(e,t){const n=this._decompressSingleOperation(t);for(;0==t.types[0];)t.types.shift(),e.push(this._splitCurrent(n));e.push(n)}}class TypingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.nodes[0].data+=e.nodes[0].data,t}_splitCurrent(e){const t=cloneDeep(e),n=t.nodes[0],i=e.nodes[0],r=i.data[Symbol.iterator]().next().value,s=r.length;return n.data=r,i.data=i.data.substr(s),e.position=getPositionShiftedBy(e.position,s),t}_compareOperations(e,t){if(this._checkOperation(e)&&this._checkOperation(t)){const n=e.nodes[0].data.length,i=arePositionsEqual(getPositionShiftedBy(e.position,n),t.position),r=e.nodes[0],s=t.nodes[0];return i&&this._compareAttributes(r,s)}return!1}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("InsertOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("InsertOperation").decompress(t,e),t[0]}_checkOperation(e){return"InsertOperation"==e.__className&&1==e.nodes.length&&e.nodes[0].data&&!e.wasUndone&&1==Array.from(e.nodes[0].data).length}_compareAttributes(e,t){const n=Object.keys(e.attributes||{}),i=Object.keys(t.attributes||{});return n.length===i.length&&n.every((n=>t.attributes[n]&&t.attributes[n]===e.attributes[n]))}}class DeletingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.howMany++,t.sourcePosition=cloneDeep(e.sourcePosition),t}_splitCurrent(e){const t=cloneDeep(e);return e.howMany--,t.howMany=1,t.sourcePosition=getPositionShiftedBy(t.sourcePosition,e.howMany),t}_compareOperations(e,t){return!(!this._checkOperation(e)||!this._checkOperation(t))&&arePositionsEqual(getPositionShiftedBy(e.sourcePosition,-1),t.sourcePosition)&&arePositionsEqual(e.targetPosition,t.targetPosition)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,e),t[0]}_checkOperation(e){return"MoveOperation"==e.__className&&"$graveyard"==e.targetPosition.root&&1==e.howMany&&!e.wasUndone}}class ForwardDeletingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.howMany++,t}_splitCurrent(e){const t=cloneDeep(e);return t.howMany=1,e.howMany--,t}_compareOperations(e,t){return!(!this._checkOperation(e)||!this._checkOperation(t))&&arePositionsEqual(e.sourcePosition,t.sourcePosition)&&arePositionsEqual(e.targetPosition,t.targetPosition)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,e),t[0]}_checkOperation(e){return"MoveOperation"==e.__className&&"$graveyard"==e.targetPosition.root&&1==e.howMany&&!e.wasUndone}}class UserSelectionActionCompressor extends ActionCompressor{compress(e,t){if(!this._compareOperations(t[0],t[1]))return!1;const n=t.shift();return n.oldRange=null,n.newRange&&arePositionsEqual(n.newRange.start,n.newRange.end)&&(n.newRange.end=null),t.shift(),e.types.push(this._id),e.types.push(0),e.buffers.push(this._compressSingleOperation(n)),!0}decompress(e,t){const n=this._decompressSingleOperation(t);n.newRange&&!n.newRange.end&&(n.newRange.end=cloneDeep(n.newRange.start));const i=cloneDeep(n);i.newRange&&(i.newRange.start.stickiness="toNone",i.newRange.end=cloneDeep(i.newRange.start)),i.name="user:position:"+i.name.split(":")[2],t.types.shift(),e.push(n),e.push(i)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MarkerOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MarkerOperation").decompress(t,e),t[0]}_compareOperations(e,t){return!!(e&&t&&"MarkerOperation"==e.__className&&"MarkerOperation"==t.__className&&e.name.startsWith("user:")&&t.name.startsWith("user:")&&e.name!=t.name)}}class Compressor{constructor(){this._compressorById=new Map,this._compressorByName=new Map,this._protobufFactory=new ProtobufFactory;const e=this._protobufFactory.getDescriptor("MarkerOperation");this._registerCompressor(1,"NoOperation",new NoOperationCompressor(1,"NoOperation",void 0)),this._registerOperationCompressor(10,"AttributeOperation",AttributeOperationCompressor),this._registerOperationCompressor(11,"InsertOperation",InsertOperationCompressor),this._registerOperationCompressor(12,"MarkerOperation",MarkerOperationCompressor),this._registerOperationCompressor(13,"MergeOperation",OperationCompressor),this._registerOperationCompressor(14,"MoveOperation",OperationCompressor),this._registerOperationCompressor(15,"RenameOperation",OperationCompressor),this._registerOperationCompressor(16,"RootAttributeOperation",AttributeOperationCompressor),this._registerOperationCompressor(17,"SplitOperation",OperationCompressor),this._registerCompressor(18,"CommentMarkerOperation",new AnnotationMarkerOperationCompressor(18,"MarkerOperation",e,"comment")),this._registerCompressor(19,"SuggestionMarkerOperation",new AnnotationMarkerOperationCompressor(19,"MarkerOperation",e,"suggestion")),this._registerOperationCompressor(20,"RootOperation",OperationCompressor),this._registerActionCompressor(100,"TypingAction",TypingActionCompressor),this._registerActionCompressor(101,"DeletingAction",DeletingActionCompressor),this._registerActionCompressor(102,"ForwardDeletingAction",ForwardDeletingActionCompressor),this._registerActionCompressor(103,"UserSelectionAction",UserSelectionActionCompressor)}compress(e){if(!e||!e[0])throw new CKEditorError("no-operations-provided",this);const t={types:[],buffers:[],baseVersion:e[0].baseVersion};for(;e.length;)this._getCompressorByName("UserSelectionAction").compress(t,e)||this._getCompressorByName("TypingAction").compress(t,e)||this._getCompressorByName("DeletingAction").compress(t,e)||this._getCompressorByName("ForwardDeletingAction").compress(t,e)||this._getCompressorByName("CommentMarkerOperation").compress(t,e)||this._getCompressorByName("SuggestionMarkerOperation").compress(t,e)||this._getCompressorByName(e[0].__className).compress(t,e);return t}decompress(e){const t=[];for(;e.types.length;)this._compressorById.get(e.types[0]).decompress(t,e);return t.forEach(((t,n)=>t.baseVersion=e.baseVersion+n)),t}_getCompressorByName(e){return this._compressorByName.get(e)}_registerOperationCompressor(e,t,n){const i=new n(e,t,this._protobufFactory.getDescriptor(t));this._registerCompressor(e,t,i)}_registerActionCompressor(e,t,n){const i=new n(e,this);this._registerCompressor(e,t,i)}_registerCompressor(e,t,n){this._compressorById.set(e,n),this._compressorByName.set(t,n)}}let requestCount=1;class RealTimeCollaborationClient extends Plugin{static get requires(){return[WebSocketGateway,Sessions,UserMarkers,PendingActions,Users,Notification]}static get pluginName(){return"RealTimeCollaborationClient"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get cloudDocumentVersion(){return this._lastServerVersion+this._offset}get _lastServerVersion(){return this.serverHistory.version-this._offset}get lastSyncVersion(){const e=this.serverHistory.getOperations();for(let t=e.length-1;t>=0;t--){const n=e[t];if(!this._disconnectionOperations.has(n))return n.baseVersion+1-this._offset}return 0}constructor(e){if(super(e),this._offset=0,this.sessionId=null,this.serverHistory=new History,this.editor.config.define("collaboration",{}),this._channelId=this.editor.config.get("collaboration.channelId"),!this._channelId)throw new CKEditorError("collaboration-missing-channelid",this);const t=e.config.get("cloudServices.bundleVersion")||_0x440a6e;this._service=new RealTimeCollaborationClient.CollaborativeEditingService(t,this._channelId),this._document=this.editor.model.document,this._compressor=new Compressor,this._bufferedOperations=[],this._knownOperations=new WeakSet,this._knownRootNames=new Set,this.set("_isPendingUpdate",!1),this.set("_hasSynchronizationProblem",!1),this._pendingAction=null,this._hasSelectionChanged=!1,this._sendBufferedOperationsDelayId=null,this._baseBufferDelay=300,this._currentBufferDelay=this._baseBufferDelay,this._lastSyncedOperationId=null,this._disconnectionOperations=new WeakSet,this._operationIdentifier=new OperationIdentifier(this._disconnectionOperations)}init(){const e=this.editor,t=e.plugins.get(Users),n=e.plugins.get(WebSocketGateway);this.listenTo(t,"getOperationAuthor",((e,n)=>{const i=n[0];i._authorId&&(e.return=t.getUser(i._authorId),e.stop()),null===i._authorId&&(e.return=null,e.stop())}),{priority:"high"}),this.listenTo(e.model.document.selection,"change:range",((e,t)=>{t.directChange&&this._refreshUserSelectionMarkers()})),this.listenTo(e.editing.view,"change:hasDomSelection",(()=>{this._refreshUserSelectionMarkers()})),this._initThrowingOnDataSet(),e.model.on("applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&(this._saveOperationInBuffer(n),this._shouldSendUpdate()&&this._sendBufferedOperationsDelayed())})),this._setUpDataInit(),this.bind("_isEditingAllowed").to(n,"state",this,"_hasSynchronizationProblem",((e,t)=>"connected"===e&&!t)),this.on("change:_isEditingAllowed",(()=>{this._isEditingAllowed?e.disableReadOnlyMode("rtc-offline"):e.enableReadOnlyMode("rtc-offline")})),this._isEditingAllowed?e.disableReadOnlyMode("rtc-offline"):e.enableReadOnlyMode("rtc-offline"),this.set("_isConnected",!1)}async reconnect(){const e=this.editor.plugins.get(Sessions),t=this.editor.plugins.get(WebSocketGateway);try{this._isPendingUpdate=!0,e.unregister(this._channelId);const n=await this._service.reconnect(t.connection,this.lastSyncVersion);await this._handleReconnectionResponse(n)&&(this._isPendingUpdate=!1,this._clearPendingAction());const i=await this._service.getConnectedSessions();e.register(this._channelId,i),this._handleSendingSelectionMarkers(),this._isConnected=!0}catch(e){if(isSessionNotExistingError(e)&&this.sessionId)await this._connectAfterSessionHasBeenFlushed();else if(isBaseVersionMismatchError(e)){const e=getTranslation$4(this.editor.locale,"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(e)}else{if(!(e instanceof ReconnectionError))throw e;this._handleReconnectionError()}}}destroy(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get(Sessions);this.editor.enableReadOnlyMode("rtc-destroyed"),t.channelSessions.has(this._channelId)&&t.unregister(this._channelId),e.removeFromReconnectionStack(this),this._disconnectService(),super.destroy()}async _handleReconnectionResponse(e){if(this.sessionId!==e.sessionId&&this._lastSyncedOperationId!==e.lastOperationId)throw new ReconnectionError;return this.sessionId=e.sessionId,this._handleServerResponse([],{...e,wereChangesApplied:!1,data:e.data},"reconnect")}async _connectService(e,t=!1){const{connection:n}=this.editor.plugins.get(WebSocketGateway);RealTimeCollaborationClient.CollaborativeEditingService.getConnectedSessions(n,this._channelId).then((e=>this._initSessionsHandling(e))).catch((e=>{this._crash("realtimecollaborationclient-init-session-connection-error",e)})),this.listenTo(this._service,"operationsReceived",this._handleReceivedOperations.bind(this)),this.listenTo(this._service,"error",((e,t)=>{this._crash("realtimecollaborationclient-initservice-internal-error",t)})),this.listenTo(this._service,"disconnected",(()=>{this._isConnected=!1}));const i=this._operationIdentifier.getIdOfTheLastOperation(e);this._isPendingUpdate=!0;const r=await this._service.connect(n,this._compressOperations(e),i);if(this.sessionId=r.sessionId,t){if(!r.wereChangesApplied)return void this._handleReconnectionError();this._isPendingUpdate=!1,this._clearPendingAction(),this.serverHistory.reset(),this._offset=r.offset,this.serverHistory.version=this._offset,await this._handleServerResponse(e,r,"reconnection: flushed session")}else await this._handleInitialConnectionData(r,e);this._handleSendingSelectionMarkers(),this._isConnected=!0}_handleSendingSelectionMarkers(){const e=this.editor.plugins.get(Sessions),t=this.editor.plugins.get(UserMarkers),n=e.channelSessions.get(this._channelId);n&&n.length>1?t.createUserMarkerOperations():this.listenTo(e,"sessionAdd:"+this._channelId,(()=>{2===e.channelSessions.get(this._channelId).length&&t.createUserMarkerOperations()}))}async _handleReceivedOperations(e,t,n,i){if(!this._isPendingUpdate&&this._document.version==t){const e=this._decompressOperations(n,i);await this._fetchMissingUsers(e),this._handleExternalOperations(e,t,n.lastOperationId)||this._crash("realtimecollaborationclient-initservice-incorrect-server-operation")}}async _connectAfterSessionHasBeenFlushed(){this._disconnectService();const{locale:e}=this.editor;let t;try{t=await this._service.getDocumentDetails()}catch(t){const n=getTranslation$4(e,"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");return void this._handleReconnectionError(n)}const n=t.currentDocumentSession||t.lastDocumentSession;if(this._lastSyncedOperationId===n.lastOperationId)await this._connectService(this.editor.model.document.history.getOperations(),!0);else{const t=getTranslation$4(e,"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(t)}}_disconnectService(){this._service.disconnect(),this._bufferedOperations=[],clearTimeout(this._sendBufferedOperationsDelayId),this.stopListening(this._service)}_initSessionsHandling(e){const t=this.editor.plugins.get(Sessions);this.listenTo(t,"sessionAdd:"+this._channelId,((e,{session:n})=>{if(n.id===t.mySessionId){e.off();const t=this.editor.plugins.has("CommentsOnly")&&this.editor.plugins.get("CommentsOnly");let i=n.permissions;t&&t.isEnabled&&(i=i.filter((e=>"document:write"!==e))),this.editor.plugins.get("Permissions").setPermissions(i,this._channelId)}})),t.register(this._channelId,e)}_initThrowingOnDataSet(){const e=this.editor.data.set;this.editor.data.set=(...t)=>{if(!t[t.length-1].suppressErrorInCollaboration)throw new CKEditorError("realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration",this);e.apply(this.editor.data,t)}}_setUpDataInit(){this.editor.data.on("init",((e,[t])=>{if(this._document.version)throw new CKEditorError("realtimecollaborationclient-init-document-already-initialized",this);e.stop(),this._setPendingAction();const n=this.editor.config.get("rootsAttributes"),i=this._getOperationsFromInitData(t,n);0==i.length&&i.push(new NoOperation(0)),e.return=this._connectService(i).then((()=>{this.editor.plugins.get(WebSocketGateway).addToReconnectionStack(this),this.editor.data.fire("ready")})).catch((e=>this._crash("realtimecollaborationclient-init-connection-failed",e))).finally((()=>this._clearPendingAction()))}),{priority:"high"}),this.editor.on("loadRoot",(async(e,[t,n])=>{e.stop();const i=this.editor.model.document.getRoot(t);if(!this._knownRootNames.has(t)){const e=n&&n.data?n.data:"",i=n&&n.attributes?n.attributes:{};await this._loadRoot(t,e,i)}this.editor.model.enqueueChange({isUndoable:!1},(()=>{i._isLoaded=!0,this.editor.model.document.differ._bufferRootLoad(i)}))}),{priority:"high"})}async _fetchMissingUsers(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const n of e){const e=n._authorId;e&&!t.getUser(e)&&i.add(e)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}_getOperationsFromInitData(e,t={}){const n=this.editor.model,i=[];let r=0;const s="string"==typeof e?{main:e}:e;for(const e of Object.keys(s)){if(!this._document.roots.has(e))throw new CKEditorError("realtimecollaborationclient-init-non-existent-root",this);const t=this.editor.data.parse(s[e]),o=this._document.getRoot(e),a=new InsertOperation(n.createPositionAt(o,0),t,r++);i.push(a);for(const[e,s]of t.markers){const t=n.createRange(n.createPositionFromPath(o,s.start.path.slice()),n.createPositionFromPath(o,s.end.path.slice())),a=new MarkerOperation(e,null,t,n.markers,!0,r++);i.push(a)}}if(t)for(const[e,s]of Object.entries(t)){const t=n.document.getRoot(e);if(!t)throw new CKEditorError("multi-root-editor-root-attributes-no-root",null);for(const[e,n]of Object.entries(s))if(null!==n){const s=new RootAttributeOperation(t,e,null,n,r++);i.push(s)}}return i}async _loadRoot(e,t,n){this._getOperationsFromInitData({[e]:t},{[e]:n}).forEach(((e,t)=>{e.baseVersion=this._document.version+t,e._isInit=!0,this._saveOperationInBuffer(e)})),this._sendBufferedOperationsDelayed(),await this._waitUntilSynced()}async _handleInitialConnectionData(e,t){let n;this._offset=e.offset;const i=e.wereChangesApplied&&!e.initData,r=i?0:e.data.baseVersion;if(t.forEach((t=>{t._isInit=!0,t.createdAt=e.sessionCreatedAt,t._authorId=null})),i)n=t,this._applyOperationsSet(n,i);else{if(e.initData){const t=this._getOperationsFromInitData(e.initData);this._document.history.version=-t.length,t.forEach((n=>{n.baseVersion-=t.length,n.createdAt=e.sessionCreatedAt,n._isInit=!0,n._authorId=null})),this._applyOperationsSet(t,!0),this.serverHistory.version=-t.length+this._offset,this._updateServerHistory(t)}this._document.history.version=r,n=this._decompressOperations(e.data,e.metadata),await this._fetchMissingUsers(n),this._applyOperationsSet(n,i)}e.lastOperationId&&(this._operationIdentifier.setIdForTheLastOperation(n,e.lastOperationId),this._lastSyncedOperationId=e.lastOperationId),this.serverHistory.version=r+this._offset,this._updateServerHistory(n),t.filter((e=>{const t=this._getAffectedRoot(e);return t&&!this._knownRootNames.has(t)})).forEach(((e,t)=>{e.baseVersion=this._document.version+t,this._saveOperationInBuffer(e)})),this._shouldSendUpdate()?(this._currentBufferDelay=0,this._sendBufferedOperationsDelayed(!0),await this._waitUntilSynced()):(this._isPendingUpdate=!1,this._clearPendingAction())}_crash(e,t,n){throw this._isPendingUpdate=!0,t&&console.error(t),n&&this.editor.enableReadOnlyMode("realtimecollaborationclient-error"),new CKEditorError(e,this.editor)}_saveOperationInBuffer(e){this._knownOperations.has(e)||(this._knownOperations.add(e),this._bufferedOperations.push(e),this._pendingAction||"marker"==e.type&&!e.affectsData||this._setPendingAction())}_sendBufferedOperationsDelayed(e=!1){!e&&this._isPendingUpdate||(this._isPendingUpdate=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._sendBufferedOperationsDelayId=setTimeout((()=>{this._sendBufferedOperations().then((e=>{e&&(this._clearPendingAction(),this._isPendingUpdate=!1)})).catch((e=>{this._clearPendingAction(),this._isPendingUpdate=!1,isDisconnectionError$3(e)||this._crash(e.message,e,!0)}))}),this._currentBufferDelay))}_waitUntilSynced(){return new Promise((e=>{this.on("change:_isPendingUpdate",(()=>{e()}))}))}async _sendBufferedOperations(){const e=this.editor.plugins.get(UserMarkers);if(this._shouldSendSelectionUpdate()&&(e.createUserMarkerOperations(),this._hasSelectionChanged=!1),!this._shouldSendUpdate())return!0;const t=[...this._bufferedOperations];for(const e of t)e.wasUndone=this._document.history.isUndoneOperation(e);const n=this._operationIdentifier.getIdOfTheLastOperation(t),i=requestCount++,r=this._compressOperations(t),s=await this._service.sendOperations(r,r.baseVersion,n);try{return await this._handleServerResponse(t,s,i)}catch(e){return this._crash("realtimecollaborationclient-sendbufferedoperations",e)}}async _handleServerResponse(e,t,n){if("error"in t)throw t.error;let i=!1;if(t.wereChangesApplied){t.lastOperationId&&(this._lastSyncedOperationId=t.lastOperationId),this._bufferedOperations=this._bufferedOperations.filter((t=>!e.includes(t)));for(const n of e)n.createdAt="lastOperationAcceptedAt"in t&&t.lastOperationAcceptedAt||void 0;updateBaseVersions(e,t.version-e.length),this._updateServerHistory(e);const n=e.filter((e=>{if(!e._isInit)return!1;const t=this._getAffectedRoot(e);return t&&!this._knownRootNames.has(t)}));updateBaseVersions(n,this._document.version),this._applyOperationsSet(n),i=!0,this._currentBufferDelay=this._baseBufferDelay}else{const e=this._decompressOperations(t.data,t.metadata).filter((e=>e.baseVersion>=this._lastServerVersion));e.forEach((e=>this._addKnownRoot(e))),this._bufferedOperations=this._bufferedOperations.filter((e=>!e._isInit||!this._knownRootNames.has(this._getAffectedRoot(e)))),this._bufferedOperations.length&&updateBaseVersions(this._bufferedOperations,this._bufferedOperations[0].baseVersion),await this._fetchMissingUsers(e),i=this._handleExternalOperations(e,t.version,t.lastOperationId),this._currentBufferDelay=Math.round(this._currentBufferDelay/2)}return i?!this._shouldSendUpdate()||(this._sendBufferedOperationsDelayed(!0),!1):this._crash("realtimecollaborationclient-handleserverresponse")}_handleExternalOperations(e,t,n){try{const i={document:this._document,useRelations:!1,padWithNoOps:!0},{operationsA:r,operationsB:s,originalOperations:o}=transformSets(e,this._bufferedOperations,i);updateBaseVersions(r,this._document.version),updateBaseVersions(s,t);for(const e of r){const t=o.get(e);e._authorId=t?t._authorId:null}n&&(this._operationIdentifier.setIdForTheLastOperation(e,n),this._lastSyncedOperationId=n),this._bufferedOperations=[...s],this._applyOperationsSet(r),this._updateServerHistory(e)}catch(e){return console.error(e),!1}return!0}_applyOperationsSet(e,t=!1){this.editor.model.enqueueChange({isUndoable:!1,isLocal:!1},(t=>{for(const n of e)this._knownOperations.add(n),this._addKnownRoot(n),t.batch.addOperation(n),this.editor.model.applyOperation(n)}))}_addKnownRoot(e){const t=this._getAffectedRoot(e);t&&this._knownRootNames.add(t)}_getAffectedRoot(e){let t,n;switch(e.type){case"insert":t=e.position.root;break;case"marker":if(n=e.newRange,!n)return null;t=n.root;break;case"addRootAttribute":t=e.root;break;case"addRoot":t=e.affectedSelectable;break;case"move":t=e.targetPosition.root;break;default:return null}return t.rootName}_updateServerHistory(e){e.forEach((e=>{const t=e.clone();t._authorId=e._authorId,t._isInit=!!e._isInit,t.createdAt=e.createdAt,t.baseVersion+=this._offset,e._isDisconnection&&this._disconnectionOperations.add(t),this.serverHistory.addOperation(t)}))}_handleReconnectionError(e){const t=this.editor.plugins.get("Notification"),n=this.editor.locale;e||(e=getTranslation$4(n,"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.")),t.showWarning(e,{title:getTranslation$4(n,"Synchronization issue"),namespace:"real-time-collaboration"}),this._hasSynchronizationProblem=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._bufferedOperations=[],this.editor.plugins.get(WebSocketGateway).destroy()}_setPendingAction(){this._pendingAction||(this._pendingAction=this.editor.plugins.get(PendingActions).add(getTranslation$4(this.editor.locale,"PENDING_ACTION_SENDING_DATA")))}_clearPendingAction(){this._pendingAction&&(this.editor.plugins.get(PendingActions).remove(this._pendingAction),this._pendingAction=null)}_compressOperations(e){const t=e.map((e=>e.toJSON()));return this._compressor.compress(t)}_decompressOperations(e,t){return this._compressor.decompress(e).map(((e,n)=>{const i="init"==t[n].type;if("InsertOperation"==e.__className){const t=e.position.root;!this._document.getRoot(t)&&(this._document.createRoot("$root",t)._isAttached=!1)}const r=OperationFactory.fromJSON(e,this._document);return r.wasUndone=e.wasUndone,r._isInit=i,r._authorId=i?null:t[n].userId,r._isDisconnection="cs:removeUser"===t[n].type,r.createdAt=t[n].createdAt,r}))}_refreshUserSelectionMarkers(){this._hasSelectionChanged=!0,this._shouldSendSelectionUpdate()?this._sendBufferedOperationsDelayed():this._hasSelectionChanged=!1}_shouldSendSelectionUpdate(){const e=this.editor.plugins.get(Sessions).channelSessions.get(this._channelId);return!this.editor.isReadOnly&&!!e&&e.length>1&&this._hasSelectionChanged}_shouldSendUpdate(){return this._bufferedOperations.length>0||this._shouldSendSelectionUpdate()}}RealTimeCollaborationClient.CollaborativeEditingService=CollaborativeEditingService;class ReconnectionError extends Error{}function updateBaseVersions(e,t){for(const n of e)n.baseVersion=t++}function isSessionNotExistingError(e){return"404"===e.code}function isBaseVersionMismatchError(e){return"409"===e.code}function isDisconnectionError$3(e){return e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Collaborative Editing Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}class OperationIdentifier{constructor(e){this._ignoredOperations=e,this._operationToId=new WeakMap}getIdOfTheLastOperation(e){let t=e.length;for(;t--;){const n=e[t];if(!this._ignoredOperations.has(n)){if(!this._operationToId.has(n)){const e=uid().slice(1,18);this._operationToId.set(n,e)}return this._operationToId.get(n)}}}setIdForTheLastOperation(e,t){if(!t)return;let n=e.length;for(;n--;){const i=e[n];this._ignoredOperations.has(i)||this._operationToId.set(i,t)}}}class RealTimeCollaborativeEditing extends Plugin{static get requires(){return[RealTimeCollaborationClient]}static get pluginName(){return"RealTimeCollaborativeEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CloudServicesCommentsAdapter extends ContextPlugin{static get requires(){return[WebSocketGateway,"CommentsRepository",Sessions,Users]}static get pluginName(){return"CloudServicesCommentsAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._services=new Map}async init(){const e=this.context,t=e.plugins.get("CommentsRepository");if(e.plugins.get(WebSocketGateway).addToReconnectionStack(this),t.adapter={addCommentThread:async({channelId:e,threadId:t,comments:n,resolvedAt:i,resolvedBy:r,context:s,attributes:o})=>{const a=await this._getService(e).addCommentThread({commentThreadId:t,comments:n.map((n=>parseLocalCommentToRemote(n,e,t))),resolvedAt:i,resolvedBy:r,context:s,attributes:o}).catch(handleDisconnectionError$1);return{threadId:a.commentThreadId,comments:a.comments}},getCommentThread:async({channelId:e,threadId:t})=>{const n=await this._getService(e).getCommentThread(t).catch(handleDisconnectionError$1);return n.deletedAt?null:(await this._fetchMissingUsersForThreads([n]),{threadId:n.commentThreadId,comments:n.comments.map(parseRemoteCommentToLocal),context:n.context,resolvedAt:n.resolvedAt,resolvedBy:n.resolvedBy,attributes:n.attributes||{}})},updateCommentThread:async({channelId:e,threadId:t,context:n,unlinkedAt:i,attributes:r})=>this._getService(e).updateCommentThread({commentThreadId:t,context:n,attributes:r,unlinkedAt:i}).catch(handleServerError).catch(handleDisconnectionError$1),resolveCommentThread:async({channelId:e,threadId:t})=>{const n=await this._getService(e).resolveCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1);return{threadId:n.commentThreadId,resolvedAt:n.resolvedAt,resolvedBy:n.resolvedBy}},reopenCommentThread:async({channelId:e,threadId:t})=>this._getService(e).reopenCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1),removeCommentThread:({channelId:e,threadId:t})=>this._getService(e).removeCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1),addComment:({channelId:e,threadId:t,commentId:n,content:i,attributes:r})=>this._getService(e).addComment(t,n,i,r).catch(handleDisconnectionError$1),updateComment:({channelId:e,threadId:t,commentId:n,content:i,attributes:r})=>this._getService(e).updateComment(t,n,i,r).catch(handleServerError).catch(handleDisconnectionError$1),removeComment:({channelId:e,threadId:t,commentId:n})=>this._getService(e).removeComment(t,n).catch(handleServerError).catch(handleDisconnectionError$1)},e instanceof Context){const t=e.config.get("collaboration.channelId"),n=e.plugins.get(Sessions);await this._setUpService(t);const i=await this._services.get(t).getConnectedSessions();this.listenTo(n,"sessionAdd:"+t,((e,{session:i})=>{i.id===n.mySessionId&&(e.off(),this.context.plugins.get("Permissions").setPermissions(i.permissions,t))})),n.register(t,i)}}async _setUpService(e){if(this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-connect-already-connected",null,{channelId:e});const t=this.context.plugins.get("CommentsRepository"),n=new CloudServicesCommentsAdapter.CommentsService(e);this._services.set(e,n),this.listenTo(n,"commentThreadAdded",((e,n)=>{const{commentThreadId:i,documentId:r,context:s,attributes:o,resolvedAt:a,resolvedBy:c,comments:l}=n;t.getCommentThread(i)||t.addCommentThread({threadId:i,channelId:r,comments:l?l.map(parseRemoteCommentToLocal):[],context:s,attributes:o,resolvedAt:a,resolvedBy:c,isFromAdapter:!0})})),this.listenTo(n,"commentThreadUpdated",((e,{commentThreadId:n,documentId:i,context:r,unlinkedAt:s,attributes:o})=>{t.getCommentThread(n)&&t.updateCommentThread({threadId:n,channelId:i,context:r,unlinkedAt:s,attributes:o,isFromAdapter:!0})})),this.listenTo(n,"commentThreadResolved",((e,{commentThreadId:n,resolvedBy:i,resolvedAt:r})=>{const s=t.getCommentThread(n);s&&s.resolve({resolvedBy:i,resolvedAt:r,isFromAdapter:!0})})),this.listenTo(n,"commentThreadReopened",((e,{commentThreadId:n})=>{const i=t.getCommentThread(n);i&&i.reopen({isFromAdapter:!0})})),this.listenTo(n,"commentThreadRemoved",((e,{commentThreadId:n})=>{const i=t.getCommentThread(n);i&&i.remove({isFromAdapter:!0})})),this.listenTo(n,"commentAdded",((e,n)=>{const i=n.commentThreadId,r=t.getCommentThread(i);r&&r.addComment({...parseRemoteCommentToLocal(n),isFromAdapter:!0})})),this.listenTo(n,"commentUpdated",((e,{commentThreadId:n,commentId:i,content:r,attributes:s})=>{const o=t.getCommentThread(n);if(o){const e=o.getComment(i);e&&e.update({content:r,attributes:s,isFromAdapter:!0})}})),this.listenTo(n,"commentRemoved",((e,{commentThreadId:n,commentId:i})=>{const r=t.getCommentThread(n);if(r){const e=r.getComment(i);e&&e.remove({isFromAdapter:!0})}})),await this._connectService(e)}destroy(){if(this.context instanceof Context){const e=this.context.config.get("collaboration.channelId");this._terminateService(e)}}_terminateService(e){if(!this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-disconnect-not-exist",null,{channelId:e});this._getService(e).disconnect(),this._services.delete(e)}async reconnect(){for(const e of this._services.keys())await this._connectService(e);if(this.context instanceof Context){const e=this.context.config.get("collaboration.channelId"),t=this.context.plugins.get(Sessions);t.unregister(e);const n=await this._services.get(e).getConnectedSessions();t.register(e,n)}}async _connectService(e){const{connection:t}=this.context.plugins.get(WebSocketGateway),n=this.context.plugins.get("CommentsRepository"),i=this._services.get(e),r=await i.connect(t);await this._fetchMissingUsersForThreads(r);const s=new Set(Array.from(n.getCommentThreads({channelId:e}),(e=>e.id)));for(const e of r)e.deletedAt||s.delete(e.commentThreadId);for(const e of s)n.getCommentThread(e).remove({isFromAdapter:!0});for(const t of r){let i=n.getCommentThread(t.commentThreadId);const{commentThreadId:r,context:s,attributes:o,resolvedBy:a,resolvedAt:c,unlinkedAt:l,deletedAt:d}=t;if(d)continue;i||(i=n.addCommentThread({channelId:e,threadId:r,context:s,attributes:o||{},resolvedBy:a,resolvedAt:c,unlinkedAt:l,isFromAdapter:!0}));const u=new Set(Array.from(i.comments,(e=>e.id)));for(const e of t.comments)u.delete(e.commentId);for(const e of u)i.getComment(e).remove({isFromAdapter:!0});for(const e of t.comments){const t=i.getComment(e.commentId);t?t.content!==e.content&&t.update({content:e.content,isFromAdapter:!0}):i.addComment(Object.assign(parseRemoteCommentToLocal(e),{isFromAdapter:!0}))}}}_getService(e){if(!this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-service-not-exist",null,{channelId:e});return this._services.get(e)}async _fetchMissingUsersForThreads(e){const t=this.context.plugins.get(Users),{connection:n}=this.context.plugins.get(WebSocketGateway),i=new Set;for(const{resolvedBy:n,comments:r}of e){n&&!t.getUser(n)&&i.add(n);for(const{userId:e}of r)t.getUser(e)||i.add(e)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}}async function handleServerError(e){if("404"!==e.code)throw e}function handleDisconnectionError$1(e){if(isDisconnectionError$2(e))return new Promise((()=>{}));throw e}function isDisconnectionError$2(e){return e.message.startsWith("cloud-services-internal-error: Comments Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}function parseRemoteCommentToLocal(e){return{threadId:e.commentThreadId,commentId:e.commentId,content:e.content,createdAt:e.createdAt,authorId:e.userId,attributes:e.attributes||{}}}function parseLocalCommentToRemote(e,t,n){return{commentThreadId:n,commentId:e.commentId,userId:e.authorId,content:e.content,documentId:t,createdAt:e.createdAt,attributes:e.attributes||{}}}CloudServicesCommentsAdapter.CommentsService=CommentsService;class CloudServicesTrackChangesAdapter extends Plugin{static get requires(){return[CloudServicesCommentsAdapter,"TrackChangesEditing",WebSocketGateway]}static get pluginName(){return"CloudServicesTrackChangesAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=this.editor.config.get("collaboration.channelId");this._bufferedRequests=new Map,this._trackChangesService=new CloudServicesTrackChangesAdapter.TrackChangesService(t)}init(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get("TrackChangesEditing");return t.adapter={getSuggestion:async e=>{await this._waitForServiceReady();const t=await this._trackChangesService.get(e).catch(handleDisconnectionError);return await this._fetchMissingUsersForThreads([t]),t},addSuggestion:async({id:e,type:t,data:n,originalSuggestionId:i,attributes:r})=>{await this._waitForServiceReady();const s={id:e,type:t,data:n,originalSuggestionId:i,attributes:r},o=await this._trackChangesService.add(e,t,n,i,r).catch((t=>{if(isDisconnectionError$1(t))return new Promise((t=>{this._bufferedRequests.set(e,{resolve:t,suggestionData:s})}));throw t}));return this._bufferedRequests.delete(e),o},updateSuggestion:async(e,t)=>{if(await this._waitForServiceReady(),"open"!==t.state)return this._trackChangesService.update(e,t).catch(handleDisconnectionError)}},this.listenTo(this._trackChangesService,"suggestionUpdated",((e,n)=>{t.hasSuggestion(n.id)&&(t.getSuggestion(n.id).attributes=n.attributes)})),this._trackChangesService.connect(e.connection).then((n=>(e.addToReconnectionStack(this),this._fetchMissingUsersForThreads(n).then((()=>{for(const e of n)t.addSuggestionData(e)._saved=!0})))))}async reconnect(){const e=this.editor.plugins.get("TrackChangesEditing"),{connection:t}=this.editor.plugins.get(WebSocketGateway),n=await this._trackChangesService.connect(t);await this._fetchMissingUsersForThreads(n);for(const{suggestionData:e,resolve:t}of this._bufferedRequests.values()){let i=n.find((t=>t.id===e.id));i||(i=await this._trackChangesService.add(e.id,e.type,e.data,e.originalSuggestionId)),t(i)}for(const t of n)e.hasSuggestion(t.id)||e.addSuggestionData(t)}async _waitForServiceReady(){this._trackChangesService.isConnected||await new Promise((e=>{this.listenTo(this._trackChangesService,"connected",(t=>{t.off(),e()}))}))}async _fetchMissingUsersForThreads(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const{authorId:n}of e)t.getUser(n)||i.add(n);if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}}function handleDisconnectionError(e){if(isDisconnectionError$1(e))return new Promise((()=>{}));throw e}function isDisconnectionError$1(e){return e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}CloudServicesTrackChangesAdapter.TrackChangesService=TrackChangesService;class RealTimeCollaborativeComments extends Plugin{static get requires(){return["Comments",CloudServicesCommentsAdapter,RealTimeCollaborativeEditing,WebSocketGateway]}static get pluginName(){return"RealTimeCollaborativeComments"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get("CommentsEditing"),n=this.editor.plugins.get(CloudServicesCommentsAdapter);return this.editor.data.once("ready",(()=>{this.listenTo(e,"change:state",((e,n,i)=>{t.isThreadsLoadingPaused="connected"!==i}))})),this.listenTo(e,"change:state",((e,t,n)=>{this.editor.plugins.get("CommentsRepository").switchReadOnly("connected"!==n)})),n._setUpService(this.editor.config.get("collaboration.channelId"))}destroy(){this.editor.plugins.get(CloudServicesCommentsAdapter)._terminateService(this.editor.config.get("collaboration.channelId")),super.destroy()}}class RealTimeCollaborativeTrackChanges extends Plugin{static get requires(){return[RealTimeCollaborativeComments,CloudServicesTrackChangesAdapter,"TrackChanges"]}static get pluginName(){return"RealTimeCollaborativeTrackChanges"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CloudServicesRevisionHistoryAdapter extends Plugin{static get requires(){return[WebSocketGateway,RealTimeCollaborationClient,"RevisionTracker",Sessions,Users]}static get pluginName(){return"CloudServicesRevisionHistoryAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=this.editor.config.get("collaboration.channelId");this._lastRequestId=null,this._revisionTracker=this.editor.plugins.get("RevisionTracker"),this._revisionHistoryService=new CloudServicesRevisionHistoryAdapter.RevisionHistoryService(t)}async init(){const e=this.editor.plugins.get(RealTimeCollaborationClient),t=e.serverHistory,n=this.editor.plugins.get(WebSocketGateway);this._revisionTracker.setSource({history:t,getLatestVersion:()=>this._getLatestVersion(),getCurrentRevisionId:()=>e.sessionId});const i=this.editor.config.get("cloudServices.bundleVersion")||_0x440a6e,r=await EditorService.isBundleUploaded(n.connection,i);this._revisionTracker.adapter={getRevision:async({revisionId:e})=>(await this._waitForServiceReady(),await this._revisionHistoryService.getRevision(e)),updateRevisions:async e=>{await this._waitForServiceReady();const t=this._revisionTracker.currentRevision;if(r&&1===e.length&&e[0].id===t.id)return e;for(const n of e)n.id===t.id&&(n.isEmptyCurrent=n.fromVersion===n.toVersion);return this._revisionHistoryService.updateRevisions(e,this._lastRequestId).then((t=>(this._lastRequestId=t,e))).catch((t=>{if(isDisconnectionError(t)||"400"===t.code&&void 0!==t.data.wrongRequestId){for(const t of e)!this._revisionTracker.repository.getRevision(t.id)||this._revisionTracker._bufferUpdate(t.id,t,!1);if(isDisconnectionError(t))throw t;return e}throw t}))}},this.listenTo(this._revisionHistoryService,"revisionsUpdated",((e,{revisionsData:t,requestId:n})=>{Math.max(...t.map((e=>e.toVersion)))>this._getLatestVersionFromServerOperations()-1?this._getLatestVersion().then((()=>{this._handleRevisionsUpdate(t,n)})):this._handleRevisionsUpdate(t,n)}));const{revisions:s,requestId:o}=await this._revisionHistoryService.connect(n.connection);n.addToReconnectionStack(this),this._lastRequestId=o,await this._fetchMissingUsers(s);for(const e of s)this._revisionTracker.addRevisionData(e);this.listenTo(e,"change:_isConnected",((t,n,i)=>{i&&(this._oldOffset=e._offset,t.off())})),this._revisionTracker.bind("isEnabled").to(n,"state",(e=>e===WEB_SOCKET_GATEWAY_STATES.CONNECTED))}async reconnect(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get(RealTimeCollaborationClient),n=async()=>{const n=this._revisionTracker.currentRevision,i=n.id,r=i!==t.sessionId;if(r){const e=t._offset-this._oldOffset,r=this._getLatestVersionFromServerOperations();if(this._revisionTracker._revisionDataBuilder.reInit(),n.toVersion+e!==r){const t=n.fromVersion+e,i=this.editor.plugins.get(Users),s=this._revisionTracker.buildRevisionData({revision:n,from:t,to:r});s.id=n.id;const o=s.authorsIds.map((e=>i.getUser(e)));n._update({...s,authors:o},!0),this._revisionTracker._bufferUpdate(n.id,s,!0)}this._revisionTracker._startingVersion=r,n.toVersion===n.fromVersion&&!this._revisionTracker._bufferedUpdates.has(i)&&this._revisionTracker.repository._revisions.remove(i),this._revisionTracker._createCurrentRevision(r)}const{revisions:s,requestId:o}=await this._revisionHistoryService.reconnect(e.connection,this._lastRequestId);r&&s.length>0?t._handleReconnectionError():(await this._fetchMissingUsers(s),this._handleRevisionsUpdate(s,o),this._revisionTracker.sendBufferedUpdates())};return t._isConnected?n():new Promise(((e,i)=>{t.once("change:_isConnected",(()=>{n().then(e).catch(i)}))}))}destroy(){super.destroy()}async _waitForServiceReady(){this._revisionHistoryService.isConnected||await new Promise((e=>{this.listenTo(this._revisionHistoryService,"connected",(t=>{t.off(),e()}))}))}_getLatestVersionFromServerOperations(){const e=this.editor.plugins.get(RealTimeCollaborationClient).serverHistory.getOperations().reverse();for(const t of e)if("marker"!==t.type||t.affectsData)return t.baseVersion+1}_getLatestVersion(){const e=this.editor.plugins.get(RealTimeCollaborationClient);return new Promise((t=>{e._isPendingUpdate?e.once("change:_isPendingUpdate",(()=>{t(this._getLatestVersionFromServerOperations())})):t(this._getLatestVersionFromServerOperations())}))}_handleRevisionsUpdate(e,t){const n=this._revisionTracker.repository;this._lastRequestId=t;for(const t of e){const e=n.getRevision(t.id);if(e){if((t.fromVersion||t.toVersion)&&(t.diffData=null),e===this._revisionTracker.currentRevision){const n=Math.max(e.toVersion,t.toVersion),i=Math.max(e.fromVersion,t.fromVersion);let r;e.toVersion===t.toVersion&&e.fromVersion===t.fromVersion?(r=!0,this._preventResendingRevisionData(t)):t.toVersion===n&&t.fromVersion===i?r=!1:(e.toVersion===n&&e.fromVersion===i||this._fixRevision({revision:e,from:i,to:n}),r=!0),r&&(delete t.fromVersion,delete t.toVersion,delete t.diffData,delete t.createdAt,delete t.authorsIds)}this._revisionTracker.setRevisionData(t),this._preventResendingRevisionData(t)}else this._revisionTracker.addRevisionData(t)}const i=n.getRevisions();i.reverse();for(let e=0;e<i.length-1;e++){const t=i[e],n=i[e+1];if(t.fromVersion<n.toVersion){const e=n.toVersion,i=Math.max(e,t.toVersion);this._fixRevision({revision:t,from:e,to:i})}}}_fixRevision({revision:e,from:t,to:n}={}){const i=this.editor.plugins.get(Users),r=this._revisionTracker.buildRevisionData({revision:e,from:t,to:n});r.authors=r.authorsIds.map((e=>i.getUser(e))),e._update(r)}_preventResendingRevisionData(e){const t={};t.id=e.id;for(const n of Object.keys(e))"id"!==n&&(t[n]=void 0);this._revisionTracker._bufferUpdate(t.id,t,!0)}async _fetchMissingUsers(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const t of e){for(const e of t.authorsIds)s(e);t.creatorId&&s(t.creatorId)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e);function s(e){t.getUser(e)||i.add(e)}}}function isDisconnectionError(e){return e.message.startsWith("cloud-services-internal-error: Revision History Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}CloudServicesRevisionHistoryAdapter.RevisionHistoryService=RevisionHistoryService;class RealTimeCollaborativeRevisionHistory extends Plugin{static get requires(){return["RevisionHistory",CloudServicesRevisionHistoryAdapter,RealTimeCollaborativeEditing]}static get pluginName(){return"RealTimeCollaborativeRevisionHistory"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class PresenceCounterView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("usersCount",0),this.set("isHidden",!0),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list__counter",t.if("isHidden","ck-presence-list__counter--hidden")]},children:[{text:t.to("usersCount",(t=>getTranslation$4(e,"CONNECTED_USERS",t)))}]})}}class PresenceInlineListView extends View{constructor(e){super(e);const t=this.bindTemplate;this.items=this.createCollection(),this.keystrokes=new KeystrokeHandler,this.set({hasPopup:!1,isExpanded:!1}),this.setTemplate({tag:"div",attributes:{"aria-haspopup":t.if("hasPopup"),"aria-expanded":t.to("isExpanded",(e=>this.hasPopup&&String(e))),"aria-label":t.to("hasPopup",(t=>getTranslation$4(e,t?"Collapsed connected users list (press ENTER to open it)":"Connected users list"))),role:"list",tabindex:t.to("hasPopup",(e=>!!e&&0)),class:["ck","ck-presence-list__list"]},children:this.items,on:{click:t.to((()=>this.fire("execute")))}}),this.on("change:hasPopup",((e,t,n)=>{this.element&&(n?this.element.setAttribute("aria-expanded",String(this.isExpanded)):this.element.removeAttribute("aria-expanded"))}))}focus(){this.element.focus()}render(){super.render(),this.keystrokes.listenTo(this.element)}}class PresenceListView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("isCollapsed",!0),this.counterView=new PresenceCounterView(this.locale),this.inlineListView=new PresenceInlineListView(e),this.inlineListView.bind("hasPopup").to(this,"isCollapsed"),this.listenTo(this.inlineListView.items,"change",(()=>{for(const e of this.inlineListView.items)e.tooltipPosition="s";this.inlineListView.items.first&&(this.inlineListView.items.first.tooltipPosition="se")})),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list","ck-reset","ck-rounded-corners",t.if("isCollapsed","ck-presence-list--collapsed")]},children:[this.counterView,this.inlineListView]})}}class PresenceDropdownListView extends View{constructor(e,t){super(e),this.listWrapperView=new PresenceDropdownListWrapperView(e,t),this.setTemplate({tag:"div",attributes:{tabindex:-1,role:"application",class:["ck","ck-presence-list__dropdown-list"],"aria-label":getTranslation$4(e,"Connected users list dropdown menu")},children:[this.listWrapperView]})}}class PresenceDropdownListWrapperView extends ListView{constructor(e,t){super(e);const n=this.bindTemplate;this.set("_isScrollable",!1),this.setTemplate({tag:t?"div":"ul",attributes:{class:["ck","ck-reset","ck-list","ck-presence-list__dropdown-list-wrapper",n.if("_isScrollable","ck-presence-list__dropdown-list-wrapper_scrollable")],role:n.to("role"),"aria-label":n.to("ariaLabel"),"aria-labelledby":n.to("ariaLabelledBy")},children:this.items}),this.listenTo(_0x56a4f4.window,"resize",(()=>this.checkIfScrollable())),this.items.on("change",(()=>this.checkIfScrollable()))}render(){super.render(),this.checkIfScrollable()}checkIfScrollable(){const e=this.element;e&&(this._isScrollable=Math.max(e.scrollHeight,e.clientHeight)>.8*window.innerHeight)}}class PresenceDropdownListItemView extends ListItemView{constructor(e,t,n){super(e);const i=this.bindTemplate;this.userView=new UserView(e,t);const r={tag:"li",attributes:{class:["ck","ck-presence-list__dropdown-list-item"],tabindex:-1,role:"presentation","aria-label":t.name},children:[this.userView,{tag:"span",attributes:{class:["ck","ck-user__full-name"]},children:[{text:t.name}]},{tag:"span",attributes:{class:["ck","ck-presence-list__marker",t.color.getBackgroundColorClass()],"aria-hidden":"true"}}]};n&&(r.tag="button",r.on={click:i.to((()=>this.fire("execute")))}),this.setTemplate(r)}focus(){this.element.focus()}}class PresenceInlineListItemView extends View{constructor(e,t,n){super(e);const i=this.bindTemplate;this.set("isFocusable",!1),this.set("hasTooltip",!0),this.set("tooltipPosition",""),this.userView=new UserView(e,t),this.markerView=new MarkerView(e,t);const r=new LabelView(e);r.template.tag="span",r.text=t.name;const s={tag:"div",attributes:{class:["ck","ck-presence-list__list-item"],role:"listitem",tabindex:i.to("isFocusable",(e=>!!e&&0)),"aria-labelledby":r.id,"data-cke-tooltip-text":this.userView.name,"data-cke-tooltip-position":i.to("tooltipPosition"),"data-cke-tooltip-disabled":i.to("hasTooltip",(e=>!e)),"data-cke-tooltip-class":"ck-presence-list__list-item__tooltip"},children:[this.userView,this.markerView,r]};n&&(s.tag="button",s.on={click:i.to((()=>this.fire("execute")))}),this.setTemplate(s)}}class MarkerView extends View{constructor(e,t){super(e),this.setTemplate({tag:"span",attributes:{class:["ck","ck-presence-list__marker",t.color.getBackgroundColorClass()],"aria-hidden":"true"}})}}const defaultPresenceListConfig={collapseAt:6,displayMe:!0};class PresenceListUI extends ContextPlugin{constructor(e){super(e),this._bodyCollection=null,this.context.config.define("presenceList",defaultPresenceListConfig);const t=e.config.get("presenceList.collapseAt");if("number"!=typeof t)throw new CKEditorError("presencelist-collapseat-invalid-format",this);if(t<1)throw new CKEditorError("presencelist-collapseat-invalid-format",this);this._allConnectedUsers=this.context.plugins.get(Sessions).allConnectedUsers,this.set("usersCount",0),this.currentDisplayedUsers=new Collection,this.balloonPanelView=new BalloonPanelView,this.balloonPanelView.class="ck ck-presence-list__balloon",this.view=this._createView(),this.presenceDropdownView=void 0}static get requires(){return[Sessions]}init(){for(const e of this._allConnectedUsers)this._handleUserAdd(e);this.listenTo(this._allConnectedUsers,"add",((e,t)=>{this._handleUserAdd(t)})),this.listenTo(this._allConnectedUsers,"remove",((e,t)=>{this._handleUserRemove(t)}))}_createView(){const e=this.context,t=new PresenceListView(this.context.locale),n=this.balloonPanelView;if(!isElement$2(e.config.get("presenceList.container")))throw new CKEditorError("presencelist-missing-container",this);return t.counterView.bind("usersCount").to(this),t.bind("isCollapsed").to(this,"usersCount",(n=>{const{collapseAt:i,displayMe:r}=e.config.get("presenceList"),s=n>=i;return t.counterView.isHidden=!(1==n&&r||s),s||this.hideDropdown(),s})),t.inlineListView.items.bindTo(this.currentDisplayedUsers).using((n=>{const i=e.config.get("presenceList"),r=new PresenceInlineListItemView(e.locale,n,!!i.onClick);return r.bind("hasTooltip").to(t,"isCollapsed",(e=>!e)),r.bind("isFocusable").to(t,"isCollapsed",(e=>!e)),i.onClick&&this.listenTo(r,"execute",(()=>{this.view.isCollapsed||i.onClick(n,r.element)})),r})),this.listenTo(t.inlineListView,"execute",(()=>{this.presenceDropdownView?this.hideDropdown():this.view.isCollapsed&&this.showDropdown()})),t.inlineListView.keystrokes.set("Enter",((e,t)=>{this.view.isCollapsed&&(this.showDropdown(),t())})),t.render(),n.render(),clickOutsideHandler({emitter:t,activator:()=>n.isVisible,contextElements:[n.element,t.inlineListView.element],callback:()=>this.hideDropdown()}),e.config.get("presenceList.container").appendChild(t.element),this._bodyCollection=new BodyCollection(this.context.locale),this._bodyCollection.attachToDom(),this._bodyCollection.add(this.balloonPanelView),t}_handleUserAdd(e){if(!this.context.config.get("presenceList.displayMe")&&e.isMe)return;const t=this.context.config.get("presenceList.collapseAt")-1;this.usersCount++,this.currentDisplayedUsers.length==t&&this.currentDisplayedUsers.length>1&&this.currentDisplayedUsers.remove(1);const n=e.isMe?0:this.currentDisplayedUsers.length;this.currentDisplayedUsers.add(e,n)}_handleUserRemove(e){if(this.usersCount--,this.currentDisplayedUsers.get(e.id)&&(this.currentDisplayedUsers.remove(e.id),this.currentDisplayedUsers.length<this.usersCount))for(const e of Array.from(this._allConnectedUsers).reverse())if(!this.currentDisplayedUsers.get(e.id))return void this.currentDisplayedUsers.add(e,Math.min(this.currentDisplayedUsers.length,1))}showDropdown(){if(this.presenceDropdownView)return;const e=this.context.config.get("presenceList");this.presenceDropdownView=new PresenceDropdownListView(this.context.locale,!!e.onClick),this.view.inlineListView.isExpanded=!0;const{listWrapperView:t}=this.presenceDropdownView;t.items.bindTo(this._allConnectedUsers).using((t=>{if(!e.displayMe&&t.isMe)return null;const n=new PresenceDropdownListItemView(this.context.locale,t,!!e.onClick);return e.onClick&&this.listenTo(n,"execute",(()=>{e.onClick(t,n.element)})),n})),this.balloonPanelView.content.add(this.presenceDropdownView),this.balloonPanelView.pin({target:this.view.inlineListView.element}),t.focus(),t.checkIfScrollable();const n=(e,t)=>{this.hideDropdown(),this.view.inlineListView.focus(),t()};t.keystrokes.set("Esc",n),t.keystrokes.set("Shift+Tab",n),t.keystrokes.set("Tab",((e,t)=>{focusNextElement(this.view.element),this.hideDropdown(),t()})),t.focusTracker.add(this.view.element),t.focusTracker.on("change:isFocused",((e,t,n)=>{n||this.hideDropdown()}))}hideDropdown(){this.presenceDropdownView&&(this.view.inlineListView.isExpanded=!1,this.balloonPanelView.unpin(),this.balloonPanelView.content.remove(this.presenceDropdownView),this.presenceDropdownView.destroy(),this.presenceDropdownView=void 0)}destroy(){super.destroy(),this.view&&this.view.isRendered&&this.view.destroy(),this._bodyCollection&&(this._bodyCollection.detachFromDom(),this._bodyCollection.destroy(),this._bodyCollection=null)}}function focusNextElement(e){const t=["a","button","input","select","textarea","[tabindex]","[contenteditable]"].map((e=>e+':not([disabled]):not([tabindex="-1"])')).join(","),n=[...document.body.querySelectorAll(t)].filter((e=>e===document.activeElement||e.offsetWidth+e.offsetHeight>0)).sort(((e,t)=>(e.tabIndex||0)-(t.tabIndex||0))),i=n.indexOf(e),r=n[(i+1)%n.length];r&&r.focus()}class PresenceList extends ContextPlugin{static get requires(){return[Sessions,PresenceListUI]}static get pluginName(){return"PresenceList"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class Revision extends(/*   -- @preserve */
ObservableMixin()){constructor(e){super(),this.id=e.id||uid(),this.creator=e.creator||null,this.authors=e.authors||[],this.diffData=e.diffData||null,this.toVersion=e.toVersion||0,this.fromVersion=e.fromVersion||0,this.set("name",e.name||""),this.set("createdAt",e.createdAt||new Date),this.set("attributes",e.attributes||{})}setName(e){this._update({name:e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this._update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this._update({attributes:t})}_update(e,t=!1){let n=!1;const i={id:this.id},r=["name","createdAt","diffData","authors","attributes","toVersion","fromVersion","creatorId"];for(const t of r){const r=e[t];void 0!==r&&r!==this[t]&&(this[t]=r,i[t]=r,n=!0)}n&&(i.authors&&(i.authorsIds=i.authors.map((e=>e.id)),delete i.authors),this.fire("_update",i,t))}toJSON(){return{id:this.id,name:this.name,creatorId:this.creator?this.creator.id:null,authorsIds:this.authors.map((e=>e.id)),diffData:this.diffData,createdAt:this.createdAt,attributes:this.attributes,fromVersion:this.fromVersion,toVersion:this.toVersion}}}class RevisionsRepository extends Plugin{static get requires(){return[Users]}static get pluginName(){return"RevisionsRepository"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get length(){return this._revisions.length}constructor(e){super(e),this._revisions=new Collection}afterInit(){checkLicense$3(this)}createRevision(e){const t=this.editor.plugins.get("Users");return new Revision({id:e.id,name:e.name,creator:e.creatorId?t.getUser(e.creatorId):null,diffData:e.diffData||e.data,authors:e.authorsIds.map((e=>t.getUser(e))),createdAt:new Date(e.createdAt),attributes:e.attributes,fromVersion:e.fromVersion,toVersion:e.toVersion})}addRevision(e,t=0){this._revisions.add(e,t)}getRevision(e){return this._revisions.get(e)}getRevisions(e={toJSON:!1}){const t=Array.from(this._revisions);return t.reverse(),e.toJSON?t.map((e=>e.toJSON())):t}getIndex(e){return this._revisions.getIndex(e)}getEarlierVisibleRevision(e){const[,t]=this.getRevisionsIterator(e,{direction:"earlier"});return t}getLaterVisibleRevision(e){const[,t]=this.getRevisionsIterator(e,{direction:"later"});return t}getRevisionsInDiff(e){const t=[];for(const n of this.getRevisionsIterator(e.newRevisionId))if(t.push(n),n.id===e.oldRevisionId)break;return t}*getRevisionsIterator(e,{direction:t="earlier",filter:n=()=>!0}={}){const i="earlier"===t?1:-1;let r=this._revisions.get(e),s=this.getIndex(r);for(yield r;r;){if(s+=i,r=this.getRevision(s),!r)return;n(r)&&(yield r)}}}async function checkLicense$3(e){const t=b([71,113,101,111,84,57,83,90,114,105,50,82,74,109,112,72,89,51,122,99,76,80,117,66,116,79,77,85,100,86,119,54,78,102,104,88,108,118,56,110,70,75,106,107,98,73,48,49,52,65,120,115,87,69,68,67,81,97,121,103,55,53]),n=964649,i=window[b([68,97,116,101])][b([110,111,119])](),r=e[b([101,100,105,116,111,114])],s=new(window[b([80,114,111,109,105,115,101])])((e=>{r[b([111,110,99,101])](b([114,101,97,100,121]),e)})),o=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU3MDM5OTV9.eyJqdGkiOjcyODk2Nzg3OTksImFsZyI6IkVTMjU2IiwiaWR4IjoyMjkyNDg2NzQxMTEyMSwieCI6IjEyQzlieE5tX1NwOFNoOVVMVEoxbGthb0JQR3VhWGxuMzZRb2JSRVlnTmsiLCJjcnYiOiJQLTI1NiIsImt0eSI6IkVDIiwianR1IjoiOTk0ZmQ5OTQtY2QzOC00YTRkLTk4YzQtODJmNTQ0NWIxZTFiIiwidXNlIjoic2lnIiwiZGF0ZSI6MTczOTM1NTcwMzk5NSwieSI6InRBbjNtNlZWQzI2Q0JsQ3RNcmZUbXFyaC05RUxvZGNJMGFjdzEyNlVYS2MiLCJpYXQiOjE3MzkzNTU3MDN9.NnIU6tNYAKCTC5JUQKTm0qU9MHqArZ--fdBcIh1JmWi6w-eBmq01TSXrl7ILwmUgW4tddw4uYjcwLVm9TVaNPQ"),a=r[b([99,111,110,102,105,103])][b([103,101,116])](b([108,105,99,101,110,115,101,75,101,121]));function c(t){const i=[new(window[b([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),s[b([116,104,101,110])]((()=>new(window[b([80,114,111,109,105,115,101])])((t=>{const n=e[b([95,114,101,118,105,115,105,111,110,115])];function i(){n[b([108,101,110,103,116,104])]>=7&&t()}i(),n[b([111,110])](b([97,100,100]),i)})))),new(window[b([80,114,111,109,105,115,101])])((e=>{p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&function t(){for(const t in window)if(window[b([78,117,109,98,101,114])].isNaN(window[b([78,117,109,98,101,114])](t))&&window[t]==n)return e();r[b([115,116,97,116,101])]!=b([100,101,115,116,114,111,121,101,100])&&window[b([115,101,116,84,105,109,101,111,117,116])](t,5e3)}()}))];return window[b([80,114,111,109,105,115,101])][b([114,97,99,101])](i)[b([116,104,101,110])]((()=>t))}function l(){const e=window[b([83,116,114,105,110,103])](window[b([112,101,114,102,111,114,109,97,110,99,101])][b([110,111,119])]())[b([114,101,112,108,97,99,101])](b([46]),"");let n=b([71]);for(let i=0;i<e[b([108,101,110,103,116,104])];i+=2){let r=window[b([112,97,114,115,101,73,110,116])](e[b([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[b([108,101,110,103,116,104])]&&(r-=t[b([108,101,110,103,116,104])]),n+=t[r]}return n}function d(e){return e[b([115,116,97,114,116,115,87,105,116,104])](b([101,121]))?JSON[b([112,97,114,115,101])](u(e)):null}function u(e){return window[b([97,116,111,98])](e[b([114,101,112,108,97,99,101])](/-/g,b([43]))[b([114,101,112,108,97,99,101])](/_/g,b([47])))}function h(e){let t=5381;function n(e){for(let n=0;n<e[b([108,101,110,103,116,104])];n++){const i=e[b([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[b([105,115,65,114,114,97,121])](t)?t[b([102,111,114,69,97,99,104])](e):t&&typeof t==b([111,98,106,101,99,116])?Object[b([101,110,116,114,105,101,115])](t)[b([115,111,114,116])]()[b([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[b([83,116,114,105,110,103])](t))}(e),t>>>0}function m(e){return e[b([116,111,83,116,114,105,110,103])](16)[b([112,97,100,83,116,97,114,116])](8,b([48]))}function g(e){return e[b([115,112,108,105,116])]("")[b([114,101,118,101,114,115,101])]()[b([106,111,105,110])]("")}function p(e){return r[b([112,108,117,103,105,110,115])][b([104,97,115])](e)}function f(e){return r[b([112,108,117,103,105,110,115])][b([103,101,116])](e)}function y(){}function b(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(t){const i=l();r[i]=b([114,101,118,105,115,105,111,110,72,105,115,116,111,114,121,76,105,99,101,110,115,101,75,101,121])+t,t[b([101,110,100,115,87,105,116,104])](b([76,105,109,105,116]))&&(window[l()]=n),t!=b([86,97,108,105,100])&&async function(){if(await s,p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const t=e[b([103,101,116,82,101,118,105,115,105,111,110])](0),n=e[b([103,101,116,69,97,114,108,105,101,114,86,105,115,105,98,108,101,82,101,118,105,115,105,111,110])](t[b([105,100])]),i=f(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]));return await i[b([99,111,109,112,97,114,101])](t.id,n?n.id:null,!0),i[b([117,110,98,105,110,100])](b([105,115,69,110,97,98,108,101,100])),i[b([105,115,69,110,97,98,108,101,100])]=!1,i[b([99,111,109,112,97,114,101])]=y,void(i[b([95,103,101,116,68,105,102,102])]=y)}if(p(b([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))){const e=f(b([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]));e[b([117,110,98,105,110,100])](b([105,115,69,110,97,98,108,101,100])),e[b([105,115,69,110,97,98,108,101,100])]=!1,e[b([117,112,100,97,116,101])]=y,e[b([115,97,118,101,82,101,118,105,115,105,111,110])]=y}r[b([109,111,100,101,108])][b([99,104,97,110,103,101])]=y,r[b([109,111,100,101,108])][b([101,110,113,117,101,117,101,67,104,97,110,103,101])]=y,r[b([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](b([109,111,100,101,108]))}()}(await async function(){let e,t=null,n=null;try{if(a==b([71,80,76]))return b([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=a[b([115,112,108,105,116])](b([46]));if(3!=e[b([108,101,110,103,116,104])])return null;return function(e){const t=d(e);return t&&function(){const e=t[b([106,116,105])],n=window[b([112,97,114,115,101,73,110,116])](e[b([115,117,98,115,116,114,105,110,103])](e[b([108,101,110,103,116,104])]-8),16),i={...t,[b([106,116,105])]:e[b([115,117,98,115,116,114,105,110,103])](0,e[b([108,101,110,103,116,104])]-8)};return delete i[b([118,99])],h(i)==n}()?t:null}(e[1])}(),!e)return b([73,110,118,97,108,105,100]);e[b([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(l=e[b([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[b([106,116,105])],n=new(window[b([80,114,111,109,105,115,101])])((e=>{if(r[b([101,100,105,116,105,110,103])][b([118,105,101,119])][b([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==b([97,117,116,111]))return e(b([86,97,108,105,100]));r[b([101,100,105,116,105,110,103])][b([118,105,101,119])][b([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=b([97,117,116,111]),r[b([100,101,99,111,114,97,116,101])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const n=uid();function o(t){var r;(r=t,new(window[b([80,114,111,109,105,115,101])])(((e,t)=>{r[b([116,104,101,110])](e,t),window[b([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[b([116,104,101,110])]((e=>e&&e[b([115,116,97,116,117,115])]==b([111,107])?m(h(n+y))!=e[b([118,101,114,105,102,105,99,97,116,105,111,110])]?b([85,115,97,103,101,76,105,109,105,116]):b([86,97,108,105,100]):b([85,115,97,103,101,76,105,109,105,116])))[b([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=b([108,108,99,116,45])+m(h(l)),t=window[b([108,111,99,97,108,83,116,111,114,97,103,101])][b([103,101,116,73,116,101,109])](e);return t?window[b([112,97,114,115,101,73,110,116])](g(t),16)*s:null}();return null==e?(o(),b([86,97,108,105,100])):b(i-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[b([116,104,101,110])](e)[b([99,97,116,99,104])]((()=>{e(b([85,115,97,103,101,76,105,109,105,116]))}));const s=36e5;function o(){const e=b([108,108,99,116,45])+m(h(l)),t=g(m(window[b([77,97,116,104])][b([99,101,105,108])](i/s)));window[b([108,111,99,97,108,83,116,111,114,97,103,101])][b([115,101,116,73,116,101,109])](e,t)}}r[b([111,110])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,i)=>{if(i[0]!=l)return e(b([85,115,97,103,101,76,105,109,105,116]));i[1]={...i[1],[b([114,101,113,117,101,115,116,73,100])]:n}}),{[b([112,114,105,111,114,105,116,121])]:b([104,105,103,104])}),r[b([111,110])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[b([114,101,116,117,114,110])])&&(typeof n===b([111,98,106,101,99,116])||typeof n===b([102,117,110,99,116,105,111,110]))&&typeof n[b([116,104,101,110])]===b([102,117,110,99,116,105,111,110])&&typeof n[b([99,97,116,99,104])]===b([102,117,110,99,116,105,111,110])&&(t=!0,o(e[b([114,101,116,117,114,110])]))}),{[b([112,114,105,111,114,105,116,121])]:b([108,111,119])}),s[b([116,104,101,110])]((()=>{t||e(b([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=a[b([115,112,108,105,116])](b([46])),[n,i,r]=t;return function(t){const n=d(t);n&&n[b([97,108,103])]==b([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[b([85,105,110,116,56,65,114,114,97,121])][b([102,114,111,109])](u(i),(e=>e[b([99,104,97,114,67,111,100,101,65,116])](0))),s=(new(window[b([84,101,120,116,69,110,99,111,100,101,114])]))[b([101,110,99,111,100,101])](t+b([46])+n),a=window[b([99,114,121,112,116,111])][b([115,117,98,116,108,101])];if(!a)return;const c=await a[b([105,109,112,111,114,116,75,101,121])](b([106,119,107]),o,{[b([110,97,109,101])]:b([69,67,68,83,65]),[b([110,97,109,101,100,67,117,114,118,101])]:b([80,45,50,53,54])},!1,[b([118,101,114,105,102,121])]);await a[b([118,101,114,105,102,121])]({[b([110,97,109,101])]:b([69,67,68,83,65]),[b([104,97,115,104])]:{[b([110,97,109,101])]:b([83,72,65,45,50,53,54])}},c,r,s)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[b([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[b([105,110,99,108,117,100,101,115])](b([42])))return!0;if(t[b([105,110,99,108,117,100,101,115])](b([82,72])))return!0;if(t[b([105,110,99,108,117,100,101,115])](b([82,82,72]))){if(p(b([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&f(b([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[b([115,116,97,116,101])]==b([99,111,110,110,101,99,116,101,100]))return!0;if(p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||p(b([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}return!1}()?function(){const t=[b([101,118,97,108,117,97,116,105,111,110]),b([116,114,105,97,108])][b([105,110,99,108,117,100,101,115])](e[b([108,105,99,101,110,115,101,84,121,112,101])])?i/1e3:1734307200;return e[b([101,120,112])]<t}()?b([69,120,112,105,114,101,100]):function(){const t=e[b([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[b([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[b([108,111,99,97,116,105,111,110])].href);if(t[b([105,110,99,108,117,100,101,115])](n))return!0;const i=n[b([115,112,108,105,116])](b([46]));return t[b([102,105,108,116,101,114])]((e=>e[b([105,110,99,108,117,100,101,115])](b([42]))))[b([109,97,112])]((e=>e[b([115,112,108,105,116])](b([46]))))[b([115,111,109,101])]((e=>i[b([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===b([42])))))}()?(e[b([108,105,99,101,110,115,101,84,121,112,101])]==b([101,118,97,108,117,97,116,105,111,110])&&(t=c(b([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[b([108,105,99,101,110,115,101,84,121,112,101])]==b([116,114,105,97,108])&&(t=c(b([84,114,105,97,108,76,105,109,105,116]))),e[b([108,105,99,101,110,115,101,84,121,112,101])]==b([100,101,118,101,108,111,112,109,101,110,116])&&(t=c(b([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&n?new(window[b([80,114,111,109,105,115,101])])(((e,i)=>{t[b([116,104,101,110])](e,i),n[b([116,104,101,110])]((t=>{t!=b([86,97,108,105,100])&&e(t)}),i)})):t||n||b([86,97,108,105,100]))):b([68,111,109,97,105,110,76,105,109,105,116]):b([78,111,116,65,108,108,111,119,101,100]):b([73,110,118,97,108,105,100])}catch(e){return b([73,110,118,97,108,105,100])}var l,y}())}function getTranslation$3(e,t,n){const i=e.t;switch(t){case"Revision history":return i("Revision history");case"Open revision history":return i("Open revision history");case"Restored":return i("Restored");case"Empty document":return i("Empty document");case"Initial revision":return i("Initial revision");case"Suggested by":return i("Suggested by");case"Added by":return i("Added by");case"Removed by":return i("Removed by");case"Show more items":return i("Show more items");case"Compare against selected":return i("Compare against selected");case"Name this revision":return i("Name this revision");case"Restore this revision":return i("Restore this revision");case"Back to editing":return i("Back to editing");case"Loading...":return i("Loading...");case"No changes":return i("No changes");case"NUMBER_OF_CHANGES":return i({string:"%0 change",plural:"%0 changes",id:"NUMBER_OF_CHANGES"},n);case"X_OF_Y_CHANGES":return i({string:"%0 of %1",id:"X_OF_Y_CHANGES"},n);case"Show previous change":return i("Show previous change");case"Show next change":return i("Show next change");case"EDIT_X_OF_Y_REVISIONS":return i({string:"Edit",id:"EDIT_X_OF_Y_REVISIONS"});case"Total":return i("Total");case"Revision creator":return i("Revision creator");case"Revision author":return i("Revision author");case"Revision name":return i("Revision name");case"Save current revision":return i("Save current revision");case"Accept":return i("Accept");case"Save":return i("Save");case"Cancel":return i("Cancel");case"Name of the revision":return i("Name of the revision");case"optional":return i("optional");case"PENDING_ACTION_REVISION_HISTORY":return i({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"The revision name cannot be empty.":return i("The revision name cannot be empty.");case"Enter the revision name":return i("Enter the revision name");default:return""}}const charToViewElementClass={c:ViewContainerElement,a:ViewAttributeElement,e:ViewEmptyElement,r:ViewRawElement,u:ViewUIElement};class RevisionTracker extends Plugin{static get pluginName(){return"RevisionTracker"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Users,RevisionsRepository,PendingActions]}constructor(e){super(e),this.adapter=null,this.currentRevision=null,this._revisionDataBuilder=new RevisionDataBuilder(this.editor),this._initialRevisionId=this.editor.config.get("collaboration.channelId")||"initial",this._bufferedUpdates=new Map,this._loadedStateData=null;const t=uid();this._source={history:this.editor.model.document.history,getLatestVersion:()=>Promise.resolve(this.editor.model.document.version),getCurrentRevisionId:()=>t},this.set("isReady",!1),this.set("isEnabled",!0),this.set("_isPendingUpdate",!1),this.editor.config.define("revisionHistory.resumeUnsavedRevision",!0),this.editor.conversion.for("upcast").dataToMarker({view:"revision"})}init(){this.repository=this.editor.plugins.get("RevisionsRepository"),this._setConversion(),this.editor.data.on("ready",(()=>{const e=this.repository.getRevision(0),t=e&&null===e.creator?e:null;if(this._continueCurrentRevision=!!t&&this.editor.config.get("revisionHistory.resumeUnsavedRevision"),this.editor.plugins.has("RealTimeCollaborationClient")){const n=this._source.getCurrentRevisionId(),i=this.repository.getRevision(n);if(i)this._startingVersion=i.fromVersion,this._continueCurrentRevision=!1;else{const n=this._source.history._operations.find((e=>!e._isInit)),i=n?n.baseVersion:this._source.history.version;e?(e.toVersion<i&&e._update({toVersion:i}),this._continueCurrentRevision?(this._source.getCurrentRevisionId=()=>t.id,this._startingVersion=t.fromVersion):(this._startingVersion=e.toVersion,this._continueCurrentRevision=!1)):(this._startingVersion=i,this._continueCurrentRevision=!1)}}else t&&(this.editor.model.document.history.version=Math.max(t.toVersion,this.editor.model.document.history.version),t.fromVersion===t.toVersion?(0!==t.fromVersion&&(this._source.getCurrentRevisionId=()=>t.id),this._continueCurrentRevision=!1):this._continueCurrentRevision&&(this._source.getCurrentRevisionId=()=>t.id,this._startingVersion=t.fromVersion)),this._continueCurrentRevision||(this._startingVersion=this.editor.model.document.version);this._revisionDataBuilder.init(this._source.history),this._createInitialRevision(this._startingVersion),this._createCurrentRevision(this._startingVersion),this.adapter&&this.sendBufferedUpdates()})),this.bind("isReady").to(this,"_isPendingUpdate",(e=>!e)),this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("revisionHistoryLicenseKeyValid"==r||"revisionHistoryLicenseKeyInvalid"==r||"revisionHistoryLicenseKeyExpired"==r||"revisionHistoryLicenseKeyDomainLimit"==r||"revisionHistoryLicenseKeyNotAllowed"==r||"revisionHistoryLicenseKeyEvaluationLimit"==r||"revisionHistoryLicenseKeyTrialLimit"==r||"revisionHistoryLicenseKeyDevelopmentLimit"==r||"revisionHistoryLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"revisionHistoryLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"revisionHistoryLicenseKeyExpired"==t&&e._showLicenseError("expired"),"revisionHistoryLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"revisionHistoryLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","RevisionHistory"),"revisionHistoryLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"revisionHistoryLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"revisionHistoryLicenseKeyDevelopmentLimit"==t&&e._showLicenseError("developmentLimit"),"revisionHistoryLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}async afterInit(){if(this.repository.length>0){const e=this.repository.getRevision(0),t=await this.getRevisionDocumentData(e),n=await this.getRevisionRootsAttributes(e);this._replaceEditorDataWithRevisionData(t,n)}}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}setSource(e){this._source=e}async update(){const e=await this._source.getLatestVersion();if(e>this.currentRevision.toVersion){await this._loadState();const t=this.buildRevisionData({revision:this.currentRevision,to:e});t.authors=t.authorsIds.map((e=>this.editor.plugins.get("Users").getUser(e))),this.currentRevision._update(t)}}async _loadState(){this._continueCurrentRevision&&!this._loadedStateData&&(await this._loadRevisionData(this.currentRevision),this._revisionDataBuilder.loadState(this.currentRevision),this._loadedStateData={fromVersion:this.currentRevision.fromVersion,authors:this.currentRevision.authors.slice()})}async saveRevision(e={},t=null){const n=[];await this._loadState(),this._continueCurrentRevision=!1,t>this.currentRevision.toVersion&&(t=null),null===t&&(t=await this._source.getLatestVersion());const i=this._getFromVersion(t),r=this.buildRevisionData({from:i,to:t});if(this.currentRevision.toVersion<t){const e=this.buildRevisionData({revision:this.currentRevision,from:t,to:t});e.authors=[],e.authorsIds=[],e.id=this.currentRevision.id,this.currentRevision._update(e,!0),delete e.authors,n.push(e)}e.creatorId=this.editor.plugins.get("Users").me.id,e.name=e.name||null,e.id=e.id||uid(),e={...e,...r};const s=this.addRevisionData(e);n.push(e);const o=this.repository.getIndex(s);if(0!==o){const i=this.repository.getRevision(o-1);if(i.fromVersion!==t){const r=this._revisionDataBuilder.getData(t,i.toVersion),s={id:i.id,diffData:r.diffData,authorsIds:r.authorsIds,authors:r.authorsIds.map((e=>this.editor.plugins.get("Users").getUser(e))),fromVersion:t};i===this.currentRevision&&(s.createdAt=new Date(e.createdAt.getTime()+10)),i._update(s,!0),delete s.authors,n.push(s)}}if(this.adapter){for(const e of n)this._bufferUpdate(e.id,e,!0);this.sendBufferedUpdates()}return s}addRevisionData(e){const t=this.repository.createRevision(e);return this.adapter&&t.on("_update",((e,t,n)=>{n||(this._bufferUpdate(t.id,t,!0),this.sendBufferedUpdates())})),this.repository.addRevision(t,this._findInsertionIndex(t)),t}async getRevisionDocumentData(e){await this._loadRevisionData(e);const t={};for(const n in e.diffData){if(e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached)continue;const i=this._removeRevisionMarkers(JSON.parse(e.diffData[n].insertions)),r=this.editor.editing.view.document,s=new ViewDocumentFragment(r,i.map((e=>getViewObj(e,this.editor))));this.editor.data.processor.useFillerType("marked"),t[n]=this.editor.data.processor.toData(s),this.editor.data.processor.useFillerType("default")}return t}async getRevisionRootsAttributes(e){await this._loadRevisionData(e);const t={};for(const n in e.diffData)e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached||(t[n]=e.diffData[n].attributesAfter||{});return t}sendBufferedUpdates(){if(0===this._bufferedUpdates.size)return;if(this._isPendingUpdate)return;let e=Array.from(this._bufferedUpdates.values());this._bufferedUpdates.clear();for(let t=0;t<e.length;t++){const n=e[t];let i=!1;for(const e of Object.keys(n))void 0===n[e]?delete n[e]:"id"!==e&&(i=!0);i||(e[t]=null)}if(e=e.filter((e=>null!==e)),!e.length)return;for(let t=0;t<e.length;t++){const n=e[t];void 0!==n.fromVersion&&void 0===n.toVersion&&(n.toVersion=this.repository.getRevision(n.id).toVersion),void 0!==n.toVersion&&void 0===n.fromVersion&&(n.fromVersion=this.repository.getRevision(n.id).fromVersion)}const t=this.editor.config.get("collaboration.channelId");this._isPendingUpdate=!0,this._addPendingAction(),this.adapter.updateRevisions(e,t).finally((()=>{this._isPendingUpdate=!1})).then((e=>{if(e)for(const t of e)this.setRevisionData({id:t.id,createdAt:t.createdAt});this._removePendingAction(),this.sendBufferedUpdates()}))}_replaceEditorDataWithRevisionData(e,t){let n=this.editor.config.get("initialData"),i=this.editor.config.get("rootsAttributes");if(void 0===n){n={};for(const e of this.editor.model.document.getRootNames())n[e]=""}if("string"==typeof n&&(n={main:n}),void 0===i){i={};for(const e of this.editor.model.document.getRootNames())i[e]={}}let r=!1;const s=Object.keys(n),o=Object.keys(e);for(const o of s){if(n[o]!==e[o]&&""!==n[o].trim()){r=!0;break}if(!isEqual(i[o],t[o])&&Object.keys(i[o]).length>0){r=!0;break}}r||(r=o.some((e=>!this.editor.model.document.getRoot(e)))),r&&logWarning("editor-initial-data-replaced-with-revision-data",{editorData:n,editorRootsAttributes:i,revisionData:e,revisionRootsAttributes:t}),this.editor.config.set("initialData",e),this.editor.config.set("rootsAttributes",t)}_addPendingAction(){if(!this._pendingAction){const e=this.editor.plugins.get("PendingActions");this._pendingAction=e.add(getTranslation$3(this.editor.locale,"PENDING_ACTION_REVISION_HISTORY"))}}_removePendingAction(){this._pendingAction&&(this.editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null)}_findInsertionIndex(e){const t=this.repository.getRevisions();t.reverse();let n=0;for(;n<t.length;){const i=t[n];if(i===this.currentRevision){n++;continue}if(i.id===this._initialRevisionId)break;const r=e.toVersion-i.toVersion||e.fromVersion-i.fromVersion;if(r>0)break;if(r<0)n++;else{if(!e.creator&&i.creator)break;if(i.creator||!e.creator){if(e.createdAt>i.createdAt)break;n++}else n++}}return n}setRevisionData(e){const t=this.repository.getRevision(e.id);if(e.createdAt&&(e.createdAt=new Date(e.createdAt)),e.authorsIds){const t=this.editor.plugins.get("Users");e.authors=e.authorsIds.map((e=>t.getUser(e)))}t._update(e,!0)}buildRevisionData({revision:e=null,from:t=null,to:n=null}){t=null!==t?t:e.fromVersion,n=null!==n?n:e.toVersion;const i=this._revisionDataBuilder.getData(t,n),r={diffData:i.diffData,authorsIds:i.authorsIds,fromVersion:t,toVersion:n};if(!e||n!==e.toVersion){const e=n-1,t=this._source.history.getOperation(e);r.createdAt=t&&t.createdAt||new Date}if(this._loadedStateData&&t===this._loadedStateData.fromVersion)for(const e of this._loadedStateData.authors)r.authorsIds.includes(e.id)||r.authorsIds.push(e.id);return r}_loadRevisionData(e){if(!e||e.diffData)return Promise.resolve();{const t=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:t,revisionId:e.id}).then((t=>{e.diffData=t.diffData}))}}_bufferUpdate(e,t,n){if(this._bufferedUpdates.has(e)){const i=this._bufferedUpdates.get(e);t=n?{...i,...t}:{...t,...i}}this._bufferedUpdates.set(e,t)}_getFromVersion(e){const t=this.repository.getRevisions();t.reverse(),t.shift();const n=t.find((t=>t.toVersion<=e)).toVersion;return n<this._startingVersion?this._startingVersion:n}_createInitialRevision(e){const t=this.repository.getRevision(this.repository.length-1);if(t)this._initialRevisionId=t.id;else{const t=!this.editor.model.document.roots.find((e=>this.editor.model.hasContent(e))),n=this.editor.plugins.get("Users").me.id,i=getTranslation$3(this.editor.locale,t?"Empty document":"Initial revision");this._makeRevision({from:e,to:e,id:this._initialRevisionId,name:i,creatorId:n})}}_createCurrentRevision(e){const t=this._source.getCurrentRevisionId();this.currentRevision=this.repository.getRevision(t),this.currentRevision||(this.currentRevision=this._makeRevision({from:e,to:e,id:t,name:"",creatorId:null}))}_makeRevision({name:e,from:t,to:n,creatorId:i,id:r}){const s=this.buildRevisionData({from:t,to:n});s.name=e,s.creatorId=i,s.id=r;const o=this.addRevisionData(s);return this.adapter&&this._bufferUpdate(s.id,s,!0),o}_setConversion(){this.editor.conversion.for("dataDowncast").markerToData({model:"revision"})}_removeRevisionMarkers(e){return(e=e.filter((e=>!e.name||"revision-start"!==e.name&&"revision-end"!==e.name))).forEach((e=>{"string"!=typeof e&&(e.children=this._removeRevisionMarkers(e.children),e.attributes=e.attributes.filter((e=>!e[0].startsWith("data-revision-"))))})),e}}function getViewObj(e,t){const n=t.editing.view.document;if("string"==typeof e)return new ViewText(n,e);{const i=e.children.map((e=>getViewObj(e,t)));return new(charToViewElementClass[e.type]||ViewElement)(n,e.name,e.attributes,i)}}class RevisionDataBuilder{constructor(e){this.editor=e,this._savedMetaData=new Map,this._lastFrom=-1,this._lastTo=-1,this._markers=new Map,this._diffRoots=new Map,this._diffRootsAttributes=new Map,this._baseRoots=new Map,this._baseRootsAttributes=new Map,this._idsRoots=new Map,this._baseIdsRoots=new Map,this._touched=new Map,this._touchedMarkers=new Map,this._touchedRoots=new Map,this._revisionId=1}init(e){this.source=e;const t=new Map,n=new Map,i=this.editor.model.document.roots.map((e=>e.rootName));for(const e of i){const i=this.editor.model.document.getRoot(e),r=_cloneRoot(i);t.set(e,r),n.set(e,Object.fromEntries(i.getAttributes()))}const r=Array.from(this.editor.model.markers).map((e=>[e.name,e.getRange()])),s=this.source.version;this._saveMetaData(s,t,r,n),this._startingRevisionId=this._revisionId;const o=new Map,a=new Map;for(const e of i){const t=_emptyRoot(e);o.set(e,t),a.set(e,{})}this._saveMetaData(Number.NEGATIVE_INFINITY,o,[],a)}getData(e,t){if(this._lastFrom===e&&this._lastTo<=t)this._savedMetaData.size>1&&this._removeMetaData(this._lastTo),this._applyOperations(this._lastTo,t,!0);else{if(!this._savedMetaData.has(e)){const t=this._getPreviousFrom(e);this._calculateMetaData(t,e,!1)}this._calculateMetaData(e,t,!0)}return this._lastFrom=e,this._lastTo=t,this._getState()}loadState(e){this._reset(),this._lastFrom=e.fromVersion,this._lastTo=e.toVersion;for(const t in e.diffData){const n=e.diffData[t].attachChange,i=cloneDeep(e.diffData[t].attributesBefore)||{},r=this._makeModelFromViewString(e.diffData[t].deletions);r.rootName=t,r._isAttached=!n||!n.isAttached,r.isAttached=()=>r._isAttached,this._baseRoots.set(t,r),this._baseRootsAttributes.set(t,i),n&&this._touchedRoots.set(t,n);const s=this._makeIdsRoot(r);this._baseIdsRoots.set(t,s);for(const[e,t]of r.markers){if(!e.startsWith("revision:"))continue;const n=e.split(":")[2];for(const e of t.getWalker({singleCharacters:!0})){const t=this._getVidAttributeName(e),i="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path,r=s.getNodeByPath(i).getAttribute(t);this._touched.set(r,{userId:n})}}}this._startingRevisionId=this._revisionId;const t=[...Array(this._revisionId).keys()].slice(1).filter((e=>!this._touched.has(e)));let n=0;const i=new Map;for(const r in e.diffData){const s=e.diffData[r].attachChange,o=cloneDeep(e.diffData[r].attributesAfter)||{},a=this._makeModelFromViewString(e.diffData[r].insertions);a.rootName=r,a._isAttached=!s||s.isAttached,a.isAttached=()=>a._isAttached,this._diffRoots.set(r,a),this._diffRootsAttributes.set(r,o);const c=this._makeIdsRoot(a,Number.NEGATIVE_INFINITY);this._idsRoots.set(r,c),i.set(r,a.isAttached()?o:{});for(const[e,t]of a.markers){if(!e.startsWith("revision:"))continue;const n=e.split(":")[2];for(const e of t.getWalker({singleCharacters:!0})){const t=this._getVidAttributeName(e),i=this._revisionId++,r="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path;c.getNodeByPath(r)._setAttribute(t,i),this._touched.set(i,{userId:n})}}for(const e of this.editor.model.createRangeIn(a).getWalker({singleCharacters:!0})){const i=this._getVidAttributeName(e),r="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path,s=c.getNodeByPath(r);s.getAttribute(i)>0||s._setAttribute(i,t[n++])}for(const[e,t]of a.markers)e.startsWith("revision:")||this._markers.set(e,t)}const r=_emptyRoot("$graveyard");this._baseRoots.set("$graveyard",r),this._baseIdsRoots.set("$graveyard",this._makeIdsRoot(r,1));const s=_emptyRoot("$graveyard");this._diffRoots.set("$graveyard",s),this._idsRoots.set("$graveyard",this._makeIdsRoot(s,1));const o=Array.from(this._diffRoots).map((([e,t])=>[e,_cloneRoot(t)]));this._saveMetaData(this._lastTo,o,this._markers,i)}_makeModelFromViewString(e){const t=JSON.parse(e),n=this.editor.editing.view.document,i=new ViewDocumentFragment(n,t.map((e=>getViewObj(e,this.editor))));return this.editor.data.toModel(i)}_saveMetaData(e,t,n,i){const r=new Map(t),s=new Map(cloneDeep(i)),o=new Map;for(const[e,t]of n)o.set(e,{start:t.start.clone(),end:t.end.clone(),rootName:t.root.rootName});this._savedMetaData.set(e,{roots:r,markers:o,rootsAttributes:s})}_removeMetaData(e){this._savedMetaData.delete(e)}reInit(){this._reset(),this._lastFrom=-1,this._lastTo=-1,this._savedMetaData.clear(),this.init(this.source)}_reset(){this._touched.clear(),this._touchedMarkers.clear(),this._touchedRoots.clear(),this._diffRoots.clear(),this._diffRootsAttributes.clear(),this._baseRoots.clear(),this._baseRootsAttributes.clear(),this._idsRoots.clear(),this._baseIdsRoots.clear(),this._markers.clear(),this._revisionId=1,this._startingRevisionId=this._revisionId}_makeIdsRoot(e,t=null){let n=null;e.is("documentFragment")||(n=new Element(e.name,{vid_start:null===t?this._revisionId++:t++}));const i=[];for(const n of e.getChildren())if(n.is("element")){i.push(this._makeIdsRoot(n,t));const e=i[i.length-1];null!==t&&(t=e.is("element","$text")?e.getAttribute("vid")+1:e.getAttribute("vid_end")+1)}else for(let e=0;e<n.offsetSize;e++)i.push(new Element("$text",{vid:null===t?this._revisionId++:t++}));if(e.is("documentFragment")){const t=_emptyRoot(e.rootName);return t._insertChild(0,i),t}return n._setAttribute("vid_end",null===t?this._revisionId++:t++),n._insertChild(0,i),n}_calculateMetaData(e,t,n){this._reset();const{roots:i,markers:r,rootsAttributes:s}=this._savedMetaData.get(e);this._baseRoots=new Map(i),this._baseRootsAttributes=new Map(cloneDeep(s));for(const[e,t]of this._baseRoots)if("$graveyard"!==e&&(this._diffRoots.set(e,_cloneRoot(t)),this._diffRootsAttributes=new Map(cloneDeep(s)),n)){const n=this._revisionId;this._idsRoots.set(e,this._makeIdsRoot(t)),this._baseIdsRoots.set(e,this._makeIdsRoot(t,n))}this._startingRevisionId=this._revisionId,this._diffRoots.set("$graveyard",_cloneRoot(this._baseRoots.get("$graveyard"))),n&&this._idsRoots.set("$graveyard",this._makeIdsRoot(this._baseRoots.get("$graveyard")));for(const[e,t]of r){const n=this._baseRoots.get(t.rootName),i=this._diffRoots.get(t.rootName),r=new Range(this._fixPosition(t.start,n),this._fixPosition(t.end,n)),s=this._fixRange(r,i);n.markers.set(e,r),this._markers.set(e,s)}this._applyOperations(e,t,n)}_applyOperations(e,t,n){for(const i of this.source.getOperations(e,t))this._handleOperation(i,n);for(const e of this._diffRoots.values())e.markers.clear();for(const[e,t]of this._markers)this._diffRoots.get(t.root.rootName).markers.set(e,t.clone());const i=new Map,r=new Map;for(const[e,t]of this._diffRoots)i.set(e,_cloneRoot(t)),r.set(e,this._diffRootsAttributes.get(e));this._saveMetaData(t,i,this._markers,r)}_getPreviousFrom(e){const t=Array.from(this._savedMetaData.keys());t.sort(((e,t)=>e-t)),t.reverse();for(const n of t)if(n<e)return n;return Number.NEGATIVE_INFINITY}_copyMarkers(e,t){const n=Array.from(t.markers).map((([t,n])=>[t,this._fixRange(n,e)]));e.markers=new Map(n)}_transformMarkers(e){for(const t of this._markers.values()){const n=t.getTransformedByOperation(e),i=Range._createFromRanges(n);t.start=i.start,t.end=i.end}}_handleOperation(e,t){if("addRoot"!=e.type&&"detachRoot"!=e.type){if("insert"==e.type){const n=e.position.root.rootName;this._diffRoots.has(n)||(this._diffRoots.set(n,_emptyRoot(n,!0)),this._diffRootsAttributes.set(n,{}),t&&this._idsRoots.set(n,_emptyRoot(n,!0)))}else{if("addRootAttribute"==e.type||"removeRootAttribute"==e.type||"changeRootAttribute"==e.type)return void this._handleRootAttributeOperation(e);"marker"==e.type&&this._handleMarkerOperation(e)}if("marker"!==e.type){const t=this._cloneOperation(e,this._diffRoots);t._execute(),this._transformMarkers(t)}if(t)switch(e.type){case"insert":this._handleInsertOperation(e);break;case"move":case"remove":case"reinsert":this._handleMoveOperation(e);break;case"merge":this._handleMergeOperation(e);break;case"split":this._handleSplitOperation(e)}}else this._handleRootOperation(e,t)}_cloneOperation(e,t){const n=e.clone();return n._authorId=e._authorId,this._fixOperation(n,t),n}_getBaseVids(e){return e.map((e=>{const t=this._getVidAttributeName(e);return Number(e.item.getAttribute(t))}))}_generateTape(e,t){if(e.is("element","$text"))t.push({item:e,type:"text"});else{e.is("element")&&t.push({item:e,type:"elementStart"});for(const n of e.getChildren())this._generateTape(n,t);e.is("element")&&t.push({item:e,type:"elementEnd"})}return t}_getState(){const e=new Map(this._touched),t=new Map(e),n=new Map,i={insertions:{},deletions:{}},r={insertions:{},deletions:{}},s=new Map,o=new Set([...this._baseRoots.keys(),...this._diffRoots.keys()]);o.delete("$graveyard");for(const e of o){const t=this._diffRoots.get(e)||_emptyRoot(e,!1),n=this._baseRoots.get(e)||_emptyRoot(e,!1);t.isAttached()||n.isAttached()?(i.insertions[e]=_cloneRoot(t),i.deletions[e]=_cloneRoot(n),this._copyMarkers(i.deletions[e],n),this._copyMarkers(i.insertions[e],t),r.insertions[e]=this._generateTape(this._idsRoots.get(e),[]),r.deletions[e]=this._generateTape(this._baseIdsRoots.get(e)||_emptyRoot(e,!1),[])):o.delete(e)}for(const i of o){const s=r.insertions[i];for(const i of s){const r=this._getVidAttributeName(i),s=i.item.getAttribute(r);t.delete(s),s>=this._startingRevisionId&&n.set(s,e.get(s))}}for(const i of o){const o=r.insertions[i],a=this._getBaseVids(r.deletions[i]);let c=0;for(const i of o){const r=this._getVidAttributeName(i),o=i.item.getAttribute(r);if(!n.has(o)&&!s.has(o))if(t.has(o))c++;else{if(o!=a[c]){const n=e.get(o)||e.get(a[c]);for(;o!=a[c];)t.has(a[c])||(s.set(a[c],n),e.set(a[c],n)),c++}c++}}}for(const e of o){const i=r.insertions[e];for(const e of i){const i=this._getVidAttributeName(e),r=e.item.getAttribute(i);if(s.has(r)){const e=s.get(r);t.has(r)||t.set(r,{...e}),n.set(r,{...e})}}}for(const e of t.keys())e>=this._startingRevisionId&&t.delete(e);const a=new Map;for(const e of o){let i=r.insertions[e];for(const e of i)if(e.item.is("element","tableCell")){const t=this._getVidAttributeName(e),i=e.item.getAttribute(t);if(n.has(i)){const t=e.item.parent.parent.getAttribute("vid_start"),r=a.get(t)||new Set;r.add(n.get(i).userId),a.set(t,r)}}i=r.deletions[e];for(const e of i)if(e.item.is("element","tableCell")){const n=this._getVidAttributeName(e),i=e.item.getAttribute(n);if(t.has(i)){const n=e.item.parent.parent.getAttribute("vid_start"),r=a.get(n)||new Set;r.add(t.get(i).userId),a.set(n,r)}}for(const e of a.keys())(n.has(e)||t.has(e))&&a.delete(e)}for(const e of o){const i=r.insertions[e];let s=null,o=null;for(const e of i){const i=this._getVidAttributeName(e),r=e.item.getAttribute(i),c=a.get(r);c&&"elementStart"==e.type&&(s=Array.from(c)[0],o=e.item.getAttribute("vid_end")),s&&(t.set(r,{userId:s}),n.set(r,{userId:s})),r==o&&(s=null,o=null)}}const c={},l=new Set;for(const e of o){const s=i.deletions[e],o=i.insertions[e];for(const{userId:e}of this._touchedMarkers.values())null!==e&&l.add(e);for(const{userId:e}of this._touchedRoots.values())null!==e&&l.add(e);this._markChanges(o,r.insertions[e],n,"insertion",l),this._markChanges(s,r.deletions[e],t,"deletion",l),c[e]={insertions:this._prepareViewToSave(o),deletions:this._prepareViewToSave(s),attachChange:this._touchedRoots.get(e)||null,attributesBefore:cloneDeep(this._baseRootsAttributes.get(e))||{},attributesAfter:cloneDeep(this._diffRootsAttributes.get(e))}}return{diffData:c,authorsIds:Array.from(l)}}_processRootBeforeSave(e){for(const[,t]of e.markers){const e=t.start.getAncestors().filter((e=>"tableCell"==e.name));for(const t of e)1==t.childCount&&t.getChild(0).is("element","paragraph")&&t.getChild(0)._setAttribute("keepParagraph",!0)}}_prepareViewToSave(e){this._processRootBeforeSave(e);const t=this.editor.data.toView(e,{}),n=Array.from(t.getChildren()).map((e=>this._getViewJson(e)));return JSON.stringify(n)}_getViewJson(e){if(e.is("$text"))return e.data;{const t=e;return{type:Object.keys(charToViewElementClass).find((t=>e instanceof charToViewElementClass[t])),name:t.name,attributes:Array.from(t.getAttributes()),children:Array.from(t.getChildren()).map((e=>this._getViewJson(e)))}}}_markChanges(e,t,n,i,r){let s=null,o=null,a=0;const c=this.editor.model;for(let i=0;i<t.length;i++){const r=this._getVidAttributeName(t[i]),a=t[i].item.getAttribute(r),d=n.get(a),u=i==t.length-1;!s&&d&&(s=d,o=t[i]),s&&(!d||d.userId!=s.userId)&&(l(d,_getPosBefore(o,e,c),_getPosBefore(t[i],e,c)),s=d||null,o=d?t[i]:null),s&&u&&l(d,_getPosBefore(o,e,c),_getPosAfter(t[i],e,c))}function l(t,n,o){const l=s.userId,d="revision:"+i+":"+l+":"+a++,u=c.createRange(n,o);e.markers.set(d,u),null!==l&&r.add(l)}}_getVidAttributeName(e){switch(e.type){case"elementStart":return"vid_start";case"elementEnd":return"vid_end";default:return"vid"}}_fixOperation(e,t){e.baseVersion=null;for(const n in e){const i=e[n];if(i instanceof Position){const r=t.get(i.root.rootName);e[n]=this._fixPosition(i,r)}if(i instanceof Range){const r=t.get(i.root.rootName);e[n]=this._fixRange(i,r)}"root"===n&&(e.root=t.get(e.root.rootName))}}_fixRange(e,t){return this.editor.model.createRange(this._fixPosition(e.start,t),this._fixPosition(e.end,t))}_fixPosition(e,t){return this.editor.model.createPositionFromPath(t,e.path,e.stickiness)}_handleInsertOperation(e){const t=this._idsRoots.get(e.position.root.rootName),n=this._fixPosition(e.position,t),i=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,r=n.parent,s=this._revisionId,o=[];for(const t of e.nodes)if(t.is("element"))o.push(this._makeIdsRoot(t));else for(let e=0;e<t.offsetSize;e++)o.push(new Element("$text",{vid:this._revisionId++}));const a=this._revisionId;for(let e=s;e<a;e++)this._touched.set(e,{userId:i});r._insertChild(n.offset,o)}_handleMoveOperation(e){(e=this._cloneOperation(e,this._idsRoots))._execute();const t=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.getMovedRangeStart(),i=n.parent,r=n.offset;!function e(n,i,r,s){for(let o=r;o<s;o++){const r=i.getChild(o);r.is("element","$text")?n.set(r.getAttribute("vid"),{userId:t}):(n.set(r.getAttribute("vid_start"),{userId:t}),e(n,r,0,r.childCount),n.set(r.getAttribute("vid_end"),{userId:t}))}}(this._touched,i,r,r+e.howMany)}_handleMergeOperation(e){const t=null===(e=this._cloneOperation(e,this._idsRoots))._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.targetPosition.parent,i=e.sourcePosition.parent,r=n.getAttribute("vid_end"),s=i.getAttribute("vid_start");n._setAttribute("vid_end",i.getAttribute("vid_end")),i._setAttribute("vid_end",r),this._touched.set(s,{userId:t}),this._touched.set(r,{userId:t}),e._execute()}_handleSplitOperation(e){const t=null===(e=this._cloneOperation(e,this._idsRoots))._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.graveyardPosition,i=e.splitPosition.parent;e._execute();const r=i.getAttribute("vid_end"),s=e.insertionPosition.nodeAfter;if(n){const e=s.getAttribute("vid_end"),n=i.getAttribute("vid_end");i._setAttribute("vid_end",e),s._setAttribute("vid_end",n),this._touched.set(i.getAttribute("vid_end"),{userId:t}),this._touched.set(s.getAttribute("vid_start"),{userId:t})}else{const e=this._revisionId++,n=this._revisionId++;i._setAttribute("vid_end",e),s._setAttribute("vid_start",n),s._setAttribute("vid_end",r),this._touched.set(e,{userId:t}),this._touched.set(n,{userId:t})}}_handleMarkerOperation(e){if(!e.affectsData)return;const t=(e=this._cloneOperation(e,this._diffRoots)).oldRange?e.oldRange.root:null,n=e.newRange?e.newRange.root:null;t&&this._markers.delete(e.name),n&&this._markers.set(e.name,e.newRange.clone());const i=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,r=e.name;if(!this._touchedMarkers.has(r))return void this._touchedMarkers.set(r,{range:e.oldRange,userId:i});const s=this._touchedMarkers.get(r),o=s.range,a=e.newRange;null==o&&null==a||o&&a&&o.isEqual(a)?this._touchedMarkers.delete(e.name):s.userId=i}_handleRootOperation(e,t){this._diffRoots.has(e.rootName)?this._diffRoots.get(e.rootName)._isAttached=e.isAdd:(this._diffRoots.set(e.rootName,_emptyRoot(e.rootName,!0)),this._diffRootsAttributes.set(e.rootName,{}),t&&this._idsRoots.set(e.rootName,_emptyRoot(e.rootName,!0)));const n=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,i=this._touchedRoots.get(e.rootName);i&&i.userId===n?this._touchedRoots.delete(e.rootName):this._touchedRoots.set(e.rootName,{userId:n,isAttached:e.isAdd})}_handleRootAttributeOperation(e){const t=this._diffRootsAttributes.get(e.root.rootName);null===e.newValue?delete t[e.key]:t[e.key]=e.newValue}}function _cloneRoot(e){const t=_emptyRoot(e.rootName,e.isAttached());for(const n of e.getChildren()){const e=n._clone(!0);t._appendChild(e)}return t}function _emptyRoot(e,t=!0){const n=new DocumentFragment;return n.rootName=e,n._isAttached=t,n.isAttached=()=>n._isAttached,n}function _getPosBefore(e,t,n){const i="elementEnd"==e.type?n.createPositionAt(e.item,"end"):n.createPositionBefore(e.item);return n.createPositionFromPath(t,i.path,i.stickiness)}function _getPosAfter(e,t,n){const i="elementStart"==e.type?n.createPositionAt(e.item,0):n.createPositionAfter(e.item);return n.createPositionFromPath(t,i.path,i.stickiness)}class RevisionHistorySaveRevisionFormView extends View{constructor(e,t){super(e),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.set("revisionNameInputValue",""),this.revisionNameInputView=this._createRevisionNameInput(t),this.setTemplate({tag:"form",attributes:{class:["ck","ck-revision-history-save-revision-form","ck-responsive-form"],tabindex:"-1"},children:[this.revisionNameInputView]}),injectCssTransitionDisabler(this)}render(){super.render(),submitHandler({view:this}),this.focusTracker.add(this.revisionNameInputView.element),this.keystrokes.listenTo(this.element);const e=e=>e.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}focus(){this.revisionNameInputView.focus()}get revisionName(){return this.revisionNameInputView.fieldView.element.value.trim()}set revisionName(e){this.revisionNameInputView.fieldView.element.value=e.trim()}reset(){this.revisionNameInputView.fieldView.element.value="",this.revisionNameInputView.errorText=null}_createRevisionNameInput(e){const t=new LabeledFieldView(this.locale,createLabeledInputText),n=t.fieldView;n.extendTemplate({attributes:{maxlength:"220"}});let i=getTranslation$3(this.locale,"Name of the revision");return!e&&(i+=" ("+getTranslation$3(this.locale,"optional")+")"),t.label=i,n.on("input",(()=>{this.revisionNameInputValue=n.element.value.trim()})),t}}class RevisionHistoryUI extends Plugin{static get pluginName(){return"RevisionHistoryUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionTracker]}init(){const e=this.editor,t=e.plugins.get("RevisionTracker");e.ui.componentFactory.add("revisionHistory",(n=>{const i=createDropdown(n),r=i.panelView.children,s=new ListView(n),o=new ListItemView(n),a=new ButtonView(n),c=new ListItemView(n),l=new ButtonView(n);return i.bind("isEnabled").to(t,"isReady",t,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n)),i.buttonView.set({icon:_0x27b58d.history,label:getTranslation$3(n,"Revision history"),tooltip:!0}),a.set({label:getTranslation$3(n,"Save current revision"),withText:!0,role:"menuitem"}),a.bind("isEnabled").to(t,"isReady",t,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n)),a.on("execute",(()=>this._showDialog())),l.set({label:getTranslation$3(n,"Open revision history"),withText:!0,role:"menuitem"}),l.bind("isEnabled").to(t,"isReady",e,"isReadOnly",((e,t)=>e&&!t)),l.on("execute",(()=>{e.config.get("revisionHistory").showRevisionViewerCallback(),i.isOpen=!1,e.editing.view.focus()})),o.children.add(a),c.children.add(l),s.role="menu",s.items.addMany([o,c]),r.add(s),i})),e.ui.componentFactory.add("menuBar:revisionHistory",(()=>this._registerMenuComponent()))}_registerMenuComponent(){const e=this.editor,t=e.locale,n=new MenuBarMenuView(t),i=new MenuBarMenuListView(t);n.buttonView.set({icon:_0x27b58d.history,label:getTranslation$3(t,"Revision history")});const r=new MenuBarMenuListItemView(t,n),s=new MenuBarMenuListItemButtonView(t);s.set({label:getTranslation$3(t,"Save current revision")}),s.delegate("execute").to(n),s.on("execute",(()=>{this._showDialog()})),r.children.add(s),i.items.add(r);const o=new MenuBarMenuListItemView(t,n),a=new MenuBarMenuListItemButtonView(t);return a.set({label:getTranslation$3(t,"Open revision history")}),a.delegate("execute").to(n),a.on("execute",(()=>{e.config.get("revisionHistory").showRevisionViewerCallback()})),o.children.add(a),i.items.add(o),n.panelView.children.add(i),n}_showDialog(){const e=this.editor,t=e.locale,n=e.plugins.get("Dialog"),i=e.plugins.get("RevisionTracker");function r(i){e.config.get("revisionHistory.requireRevisionName")&&""===i.revisionName?i.revisionNameInputView.errorText=getTranslation$3(t,"The revision name cannot be empty."):(e.plugins.get(RevisionTracker).saveRevision({name:i.revisionName}),n.hide())}this._saveRevisionFormView||(this._createSaveRevisionFormView(),this._saveRevisionFormView.on("submit",(()=>r(this._saveRevisionFormView)))),this._saveRevisionFormView.reset(),n.show({id:"revisionSave",title:getTranslation$3(t,"Save current revision"),isModal:!0,content:this._saveRevisionFormView,actionButtons:[{label:getTranslation$3(e.locale,"Cancel"),withText:!0,onExecute:()=>n.hide()},{label:getTranslation$3(e.locale,"Accept"),class:"ck-button-action",withText:!0,onCreate(t){t.bind("isEnabled").to(i,"isReady",i,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n))},onExecute:()=>r(this._saveRevisionFormView)}]})}_createSaveRevisionFormView(){const e=this.editor,t=e.locale;this._saveRevisionFormView=new RevisionHistorySaveRevisionFormView(t,e.config.get("revisionHistory.requireRevisionName")),this._saveRevisionFormView.render()}}class ChangeDetailsView extends View{constructor(e,t){super(e),this._model=t,this.changeId=t.id;const n=this.bindTemplate,i=getTranslation$3(e,t.data.isSuggestion?"Suggested by":"add"==t.type?"Added by":"Removed by");this.set("type",t.type),this.setTemplate({tag:"div",attributes:{class:["ck-annotation","ck-revision-change",n.to("type",(e=>"ck-revision-change__"+e))],tabindex:-1},children:[{tag:"span",children:[{tag:"span",attributes:{class:["ck-revision-change__label"]},children:[{text:i}]},{text:" "+t.author.name}]}]})}focus(){this.element.focus()}}class ChangeItem extends(/*   -- @preserve */
ObservableMixin()){constructor(e){super(),this.id=e.id||uid(),this.author=e.author,this.type=e.type,this.data=e.data||{},this.rootName=e.rootName,this.set("createdAt",e.createdAt)}toJSON(){return{id:this.id,authorId:this.author.id,type:this.type,data:this.data,createdAt:this.createdAt}}}class RevisionDiff{constructor(e,t){this.newRevisionId=e,this.oldRevisionId=t,this.changes=new Collection}_setChanges(e){for(const t of e)this.changes.add(t)}}const typeToClass={c:ViewContainerElement,a:ViewAttributeElement,e:ViewEmptyElement,r:ViewRawElement,u:ViewUIElement};class RevisionViewer extends Plugin{static get pluginName(){return"RevisionViewer"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Users,ContextualBalloon,RevisionsRepository]}constructor(e){super(e),this.repository=this.editor.plugins.get("RevisionsRepository"),this.set("activeChange",null),this.set("activeView",null),this._activeViewTarget=null,this.set("diff",null),this.set("isReady",!1),this.set("isEnabled",!0),this.on("change:isEnabled",((e,t,n)=>{this.activeChange=null,this.activeView=null,this.editor.editing.view.change((e=>{for(const t of this.editor.editing.view.document.roots)n?e.removeClass("ck-editor__editable__overlay",t):e.addClass("ck-editor__editable__overlay",t)}))})),this.bind("isNavigationMode").to(this,"activeChange",(e=>null!==e)),this.bind("currentChangeNumber").to(this,"isReady",this,"diff",this,"activeChange",((e,t,n)=>e&&n?t.changes.getIndex(n):0)),this.bind("numberOfChanges").to(this,"isReady",this,"diff",((e,t)=>e?t.changes.length:0)),this._changeView=null,this._changeIdToChange=new Map,this.adapter=null,this._balloon=this.editor.plugins.get(ContextualBalloon)}init(){const e=this.editor,t=new ShowChangeCommand(e,{direction:"backward"}),n=new ShowChangeCommand(e,{direction:"forward"});e.commands.add("showPreviousChange",t),e.commands.add("showNextChange",n),e.commands.add("restoreRevision",new RestoreRevisionCommand(e)),this.on("change:numberOfChanges",(()=>{t.refresh(),n.refresh()})),this._setConversion(),this._initInteractions(),e.enableReadOnlyMode("revision-viewer"),e.plugins.has("WidgetToolbarRepository")&&e.plugins.get("WidgetToolbarRepository").forceDisabled("revision-viewer")}async getRevisionData(e){await this.loadRevisionData(e);const t={};for(const n in e.diffData){if(e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached)continue;const i=this._removeRevisionMarkers(JSON.parse(e.diffData[n].insertions)),r=this.editor.editing.view.document,s=new ViewDocumentFragment(r,i.map((e=>this._getViewObj(e))));this.editor.data.processor.useFillerType("marked"),t[n]=this.editor.data.processor.toData(s),this.editor.data.processor.useFillerType("default")}return t}async getRevisionRootsAttributes(e){await this.loadRevisionData(e);const t={};for(const n in e.diffData)e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached||(t[n]=e.diffData[n].attributesAfter||{});return t}_removeRevisionMarkers(e){return(e=e.filter((e=>!e.name||"revision-start"!==e.name&&"revision-end"!==e.name))).forEach((e=>{"string"!=typeof e&&(e.children=this._removeRevisionMarkers(e.children),e.attributes=e.attributes.filter((e=>!e[0].startsWith("data-revision-"))))})),e}async compare(e,t,n=!1){if(!this.isEnabled)return;const i=this.diff,r=this.repository,s="string"==typeof e?r.getRevision(e):e,o="string"==typeof t?r.getRevision(t):t,a=s.id,c=o?o.id:null;if(!n&&this.diff&&this.diff.newRevisionId===a&&this.diff.oldRevisionId===c)return Promise.resolve();this.isReady=!1,this.activeView=null,this.activeChange=null,this.diff=new RevisionDiff(a,c);const l=this._getRevisionsRange(s,o,!0).map((e=>this.loadRevisionData(e)));return l.push(new Promise((e=>{setTimeout(e,20)}))),Promise.all(l).then((()=>{if(!this.isEnabled)return;this._cleanUp();const e=this._getDiff(a,c);for(const t of e.changes)this._changeIdToChange.set(t.id,t);this.editor.model.enqueueChange({isUndoable:!1},(t=>{for(const e of this.editor.model.document.getRootNames())t.detachRoot(e);for(const n of Object.keys(e.model)){const i=t.addRoot(n);for(const r of Object.keys(e.attributes[n]))t.setAttribute(r,e.attributes[n][r],i);t.insert(e.model[n],i,0)}})),this.diff._setChanges(this._sortAndFilterDiffChanges(e.changes)),this.isReady=!0})).catch((e=>{console.error(e),this._cleanUp(),i&&(this.diff=i),this.isReady=!0}))}addRevisionData(e,t){const n=this.repository.createRevision(e);return n.on("_update",((e,i,r)=>t(i,r,n))),this.repository.addRevision(n),n}loadRevisionData(e){if(!e||e.diffData)return Promise.resolve();{const t=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:t,revisionId:e.id}).then((t=>{e._update({diffData:t.diffData},!0)}))}}_cleanUp(){this.activeChange=null,this._cleanMarkers(),this._changeView&&this._changeView.destroy(),this._changeView=null,this._changeIdToChange.clear(),this.editor.model.enqueueChange({isUndoable:!1},(e=>{for(const t of this.editor.model.document.getRootNames())e.detachRoot(t)}))}_sortAndFilterDiffChanges(e){const t=[],n=new Map;for(const e of this.editor.model.document.getRootNames()){const i=this.editor.editing.view.getDomRoot(e);if(!i)continue;const r=i.getClientRects().item(0);r&&(t.push(e),n.set(e,r))}return t.sort(((e,t)=>{const i=n.get(e),r=n.get(t);return i.y-r.y||i.x-r.x})),(e=e.filter((e=>t.includes(e.rootName)))).sort(((e,n)=>t.indexOf(e.rootName)-t.indexOf(n.rootName))),e}_makeTape(e){const t=Array.from(e.markers).filter((([e,t])=>e.startsWith("revision:")&&!t.isCollapsed)),n=Array.from(this.editor.model.createRangeIn(e).getWalker({singleCharacters:!0}));if(0!=t.length)for(const e of n){const[n,i]=t[0],[,r,s]=n.split(":");if(i.end.isEqual(e.nextPosition)&&t.shift(),(e.previousPosition.isEqual(i.start)||e.previousPosition.isAfter(i.start))&&("insertion"==r?e.isAdded={userId:s}:"deletion"==r&&(e.isRemoved={userId:s})),0==t.length)break}return n}_refreshStartEndIndex(e){const t=new Map;for(let n=0;n<e.length;n++)"text"===e[n].type?(e[n].item.startIndex=n,e[n].item.endIndex=n):("elementStart"===e[n].type?e[n].item.startIndex=n:"elementEnd"===e[n].type&&(e[n].item.endIndex=n),t.set(e[n].id,n));for(const n of t.values())"elementStart"===e[n].type?e[n].item.endIndex=t.get(e[n].pairId):"elementEnd"===e[n].type&&(e[n].item.startIndex=t.get(e[n].pairId))}_processTape(e){for(let t=0;t<e.length;t++){if("elementStart"===e[t].type)e[t].item.startIndex=t;else if("elementEnd"===e[t].type){e[t].item.endIndex=t;const n=e[t].item.startIndex;e[n].pairId=e[t].id,e[t].pairId=e[n].id}else e[t].item.startIndex=t,e[t].item.endIndex=t,e[t].pairId=null;e[t].markersStart||(e[t].markersStart=[],e[t].markersEnd=[])}}_markInsertions(e,t){const n=e.filter((e=>!e.isAdded));for(let e=0;e<t.length;e++)t[e].isAdded&&(n[e].isAdded=t[e].isAdded)}_makeModelFromViewString(e){const t=JSON.parse(e),n=this.editor.editing.view.document,i=new ViewDocumentFragment(n,t.map((e=>this._getViewObj(e))));return this.editor.data.toModel(i)}_getViewObj(e){const t=this.editor.editing.view.document;if("string"==typeof e)return new ViewText(t,e);{const n=e.children.map((e=>this._getViewObj(e)));return new(typeToClass[e.type]||ViewElement)(t,e.name,e.attributes,n)}}_getDiff(e,t=null){const n=this.repository.getRevision(e),i=t?this.repository.getRevision(t):null,r=this._getRevisionsRange(n,i),s=r[r.length-1],o=new Map,a={model:{},attributes:{},changes:[]},c=new Set,l=new Map;for(let e=r.length-1;e>=0;e--){const t=r[e];for(const e of Object.keys(t.diffData))if(t.diffData[e].attachChange){const n=t.diffData[e].attachChange;n.isAttached?(c.add(e),l.has(e)&&l.get(e).userId==n.userId?l.delete(e):l.set(e,n)):l.has(e)?(c.delete(e),l.delete(e)):(c.add(e),l.set(e,n))}else c.add(e)}for(const e of c){const t=l.has(e)&&!l.get(e).isAttached;let n=t?r.length-1:0;const i=t?-1:1;for(;r[n];){const s=r[n];if(s.diffData[e]){const n=t?s.diffData[e].attributesBefore:s.diffData[e].attributesAfter;a.attributes[e]=n?cloneDeep(n):{};break}n+=i}}for(const e of r){e.model={};for(const t of e.authors)o.set(t.id,t);for(const t of c){const n=e.diffData[t]?e.diffData[t].insertions:"[]",i=e.diffData[t]?e.diffData[t].deletions:"[]";e.model[t]={insertions:this._makeModelFromViewString(n),deletions:this._makeModelFromViewString(i)}}}for(const e of c){let t=null,i=0;const c=new Map(Array.from(n.model[e].insertions.markers).filter((([e])=>!e.startsWith("revision:"))));let d=0;for(const s of r){const r=this._makeTape(s.model[e].insertions);s==n?(t=r,i=t.length,t.forEach((e=>{e.id=d++})),this._processTape(t)):this._markInsertions(t,r);const o=t.filter((e=>!e.isAdded)).map((e=>e.id));let a=0;const l=this._makeTape(s.model[e].deletions);l.forEach((e=>{e.isRemoved?e.id=i++:e.id=o[a++]})),this._processTape(l),this._setDistance(t,"isAdded"),this._setDistance(l,"isRemoved"),s==n&&this._markMarkers(t,c),t=this._joinTapes(t,l),this._refreshStartEndIndex(t),this._setDistance(t,"isRemoved")}t=t.filter((e=>!(e.isAdded&&e.isRemoved)));const u=new Map(s.model[e].deletions.markers),h=new Set(c.keys());for(const e of u.keys())h.delete(e);this._markSuggestions(t,h),this._fixObsoleteTags(t),t=this._removeMissingPairs(t),t=this._markMismatchedRemovedTags(t),t=this._removeUnsupportedChanges(t);const{root:m,changes:g}=this._makeModelFromTape(t,o,e);a.model[e]=m;const p=l.get(e);if(p){const t=o.get(p.userId),n=new ChangeItem({author:t,type:p.isAttached?"add":"remove",data:{isOnRoot:!0},createdAt:new Date,rootName:e});g.unshift(n),a.attributes[e].revisionHistoryAttachChange=n.id}a.changes=a.changes.concat(g)}return a}_markMarkers(e,t){for(let n=0;n<e.length;n++)for(const[i,r]of t)r.start.isEqual(e[n].previousPosition)&&e[n].markersStart.push(i),r.end.isEqual(e[n].nextPosition)&&e[n].markersEnd.push(i)}_joinTapes(e,t){let n=[],i=0,r=0;for(;i<e.length||r<t.length;){const s=e[i]||{},o=t[r]||{};if(s.id==o.id)i++,r++,n.push(s);else if(o.isRemoved&&s.isAdded){const{commonTape:s,iEnd:o,jEnd:a}=this._threeWayMerge(e,i,t,r);n=n.concat(s),i=o,r=a}else o.isRemoved?(r++,n.push(o)):(i++,n.push(s))}return n}_markSuggestions(e,t){const n=[];for(let s=0;s<e.length;s++){for(let r=0;r<e[s].markersStart.length;r++){const o=e[s].markersStart[r];if(!t.has(o))continue;const{group:a,type:c,authorId:l}=i(o);"revision-suggestion"!=a||"insertion"!=c&&"deletion"!=c||(n.unshift({type:c,name:o,userId:l}),e[s].markersStart.splice(r,1),r--)}r(e[s]);for(let r=0;r<e[s].markersEnd.length;r++){const o=e[s].markersEnd[r];if(!t.has(o))continue;const{group:a,type:c}=i(o);if("revision-suggestion"!=a||"insertion"!=c&&"deletion"!=c)continue;e[s].markersEnd.splice(r,1),r--;const l=n.findIndex((e=>e.name==o));l>-1&&n.splice(l,1)}}function i(e){const t=e.split(":");return{group:t[0],type:t[1],subType:t.length>=5?t[2]:null,id:t.length<5?t[2]:t[3],authorId:t.length<5?t[3]:t[4],markerCount:6==t.length?t[5]:null}}function r(e){for(let t=0;t<n.length;t++){if(e.isAdded&&"insertion"==n[t].type)return e.isAddSuggestion=n[t],void delete e.isAdded;if(!e.isAdded&&!e.isRemoved&&"deletion"==n[t].type)return void(e.isRemoveSuggestion=n[t])}}}_setDistance(e,t){let n=0,i=!1;const r=new Map;for(const s of e)s[t]?i&&(n++,i=!1):(n++,i=!0),r.set(s.id,n);for(let n=0;n<e.length;n++){if("isRemoved"==t&&e[n].isAdded||"isAdded"==t&&e[n].isRemoved)continue;if("text"==e[n].type){e[n].distance=0;continue}const i=r.get(e[n].pairId),s=r.get(e[n].id);e[n].distance=i-s}}_getRevisionsRange(e,t,n=!1){const i=[];let r=this.repository.getIndex(e),s=this.repository.getIndex(t);for(-1==s&&(s=this.repository._revisions.length,n=!1);r<s;)i.push(this.repository.getRevision(r)),r++;return n&&i.push(this.repository.getRevision(r)),i}_threeWayMerge(e,t,n,i){const r=this.editor.model.schema;let s=t;for(;e[s]&&e[s].isAdded;)s++;let o=i;for(;n[o]&&n[o].isRemoved;)o++;c(e,t,s),c(n,i,o);const a=n.slice(i,o).concat(e.slice(t,s));return a.sort(((e,t)=>e.side!=t.side?e.side-t.side:e.level!=t.level?e.level-t.level:e.distance!=t.distance?t.distance-e.distance:!!e.isAdded!=!!t.isAdded?-1==e.side||0==e.side?e.isAdded?-1:1:e.isAdded?1:-1:e.index-t.index)),{commonTape:a,iEnd:s,jEnd:o};function c(e,t,n){let i=-1,s=Number.POSITIVE_INFINITY,o=!0;for(let a=t;a<n;a++)if(r.isInline(e[a].item)||(o=!1),e[a].item.startIndex<t&&(i=a),e[a].item.endIndex>=n){s=a;break}o&&(i=n-1);for(let r=t;r<n;r++)e[r].side=r<=i?-1:r<s?0:1,e[r].index=r;let a=0;for(let n=t;n<=i;n++)0==e[n].distance?e[n].level=a:(a++,e[n].level=a,a++);for(let i=t;i<n;i++)0==e[i].side&&(e[i].level=a);a=0;for(let t=n-1;t>=s;t--)0==e[t].distance?e[t].level=a:(a--,e[t].level=a,a--)}}_fixObsoleteTags(e){const t=new Map,n=this.editor.model.schema;for(let i=1;i<e.length;i++){let r,s,o;const a=e[i],c=e[i-1];if("text"==a.type)continue;if(a.type!=c.type)continue;if(!n.isBlock(c.item)||n.isLimit(c.item))continue;if(!n.isBlock(a.item)||n.isLimit(a.item))continue;if((e[i].isAdded||e[i].isAddSuggestion)&&e[i-1].isRemoved)r=e[i],s=e[i-1],o=i-1;else{if(!e[i].isRemoved||!e[i-1].isAdded&&!e[i-1].isAddSuggestion)continue;r=e[i-1],s=e[i],o=i}const l=r.level==s.level,d=Math.abs(r.level)<Math.abs(s.level)&&0==s.distance;(l||d)&&(t.set(s.id,r.id),e.splice(o,1),i--,r.isAdded=!1)}for(let n=0;n<e.length;n++)t.has(e[n].pairId)&&(e[n].pairId=t.get(e[n].pairId))}_removeMissingPairs(e){const t=new Set(e.map((e=>e.id)));for(let n=0;n<e.length;n++)t.has(e[n].pairId)||0==e[n].distance||(e[n].isIncorrect=!0);return e.filter((e=>!e.isIncorrect))}_markMismatchedRemovedTags(e){const t=new Set;for(let n=0;n<e.length;n++){if(t.has(e[n].id)&&e[n].isRemoved&&(e[n].isIncorrect=!0),e[n].isIncorrect)continue;if(0==e[n].distance)continue;if("elementStart"!=e[n].type)continue;if(null==e[n].pairId)continue;let i=n+1,r=0;for(;e[i].id!=e[n].pairId;)"elementStart"==e[i].type?r++:"elementEnd"==e[i].type&&r--,i++;if(0!=r)if(e[n].isRemoved)e[n].isIncorrect=!0;else for(;i!=n;)e[i].isRemoved&&0!=e[i].distance&&(e[i].isIncorrect=!0,t.add(e[i].pairId)),i--}return e.filter((e=>!e.isIncorrect))}_removeUnsupportedChanges(e){const t=this.editor.model.schema;for(let n=0;n<e.length;n++){if(!(e[n].isAdded||e[n].isAddSuggestion||e[n].isRemoved||e[n].isRemoveSuggestion))continue;if(0==e[n].distance)continue;const i=e[n].item;t.isBlock(i)||t.isLimit(i)||(e[n].isAdded&&delete e[n].isAdded,e[n].isAddSuggestion&&delete e[n].isAddSuggestion,e[n].isRemoveSuggestion&&delete e[n].isRemoveSuggestion,e[n].isRemoved&&(e[n].isIncorrect=!0))}return e.filter((e=>!e.isIncorrect))}_makeModelFromTape(e,t,n){const i=new DocumentFragment,r=[],s=new Map,o=this.editor.model,a=o.schema,c=[i],l={},d={isAdded:[],isRemoved:[],isAddSuggestion:[],isRemoveSuggestion:[]};let u=null;const h=[0];for(let t=0;t<e.length;t++)if("elementStart"===e[t].type){e[t].previousPosition=o.createPositionFromPath(i,h);const n=new Element(e[t].item.name,e[t].item.getAttributes());c[0]._appendChild(n),h.push(0),c.unshift(n),e[t].nextPosition=o.createPositionFromPath(i,h)}else"elementEnd"===e[t].type?(c.shift(),e[t].previousPosition=o.createPositionFromPath(i,h),h.pop(),h[h.length-1]++,e[t].nextPosition=o.createPositionFromPath(i,h)):(e[t].previousPosition=o.createPositionFromPath(i,h),u?u._data+=e[t].item.data:u=new Text(e[t].item.data,e[t].item.getAttributes()),e[t+1]&&"text"===e[t+1].type&&p(u,e[t+1].item)||(c[0]._appendChild(u),u=null),h[h.length-1]+=e[t].item.offsetSize,e[t].nextPosition=o.createPositionFromPath(i,h));for(let t=0;t<e.length;t++){const n=e[t].previousPosition,i=e[t].nextPosition;for(const i of e[t].markersStart)s.set(i,{start:n,end:null});m("isRemoveSuggestion",t,n,i),m("isAddSuggestion",t,n,i),m("isRemoved",t,n,i),m("isAdded",t,n,i);for(const n of e[t].markersEnd)s.get(n).end=i}for(const[e,t]of s){const n=this.editor.model.createRange(t.start,t.end);i.markers.set(e,n)}return r.sort(((e,t)=>{const n=i.markers.get("revision:"+e.id),r=i.markers.get("revision:"+t.id);return n.start.isBefore(r.start)?-1:n.start.isAfter(r.start)?1:n.end.isBefore(r.end)?-1:n.end.isAfter(r.end)?1:"add"===e.type?-1:1})),{root:i,changes:r};function m(t,n,i,r){const s=!!e[n][t],o=s?e[n][t].userId:null,c=n===e.length-1,u=d[t][0],h=a.isObject(e[n].item);!l[t]&&s?l[t]={start:i,tapeItem:e[n],userId:o,type:t}:l[t]&&!s?(l[t].end=i,g(l[t]),l[t]=null):l[t]&&s&&l[t].userId!==o&&(l[t].end=i,u&&u.userId===l[t].userId||g(l[t]),l[t]={start:i,tapeItem:e[n],userId:o,type:t}),l[t]&&h&&("elementStart"!==e[n].type||u&&u.userId===o||d[t].unshift({userId:o,object:e[n].item,change:l[t]}),"elementEnd"===e[n].type&&u&&u.object===e[n].item&&(d[t].shift(),l[t]=u.change)),l[t]&&c&&(l[t].end=r,g(l[t]),l[t]=null)}function g({start:e,end:s,tapeItem:a,userId:c,type:l}){const d=a.item,u=o.schema.isBlock(d)&&!o.schema.isLimit(d),h=e.nodeAfter==s.parent&&s.isAtStart;if(u&&h)return;const m=o.createRange(e,s),g=t.get(c),p=new ChangeItem({author:g,type:"isAdded"==l||"isAddSuggestion"==l?"add":"remove",data:{isSuggestion:"isAddSuggestion"==l||"isRemoveSuggestion"==l},createdAt:new Date,rootName:n});r.push(p),i.markers.set("revision:"+p.id,m)}function p(e,t){const n=e.getAttributes(),i=t.getAttributes();for(const e of n){if(e[1]!==t.getAttribute(e[0]))return!1;i.next()}return i.next().done}}_setConversion(){this.editor.conversion.for("upcast").dataToMarker({view:"revision"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision",view:e=>{const t=e.markerName.split(":")[1],n=this._getChangeFromId(t);if(!n)return null;const i="add"==n.type?"insertion":"deletion",r=["ck-suggestion-marker","ck-suggestion-marker-"+i];return n.data.isSuggestion&&r.push("ck-suggestion-marker-"+i+"-new"),this.activeChange==n&&r.push("ck-suggestion-marker--active"),{classes:r,attributes:{"data-change-id":t}}}}),this.editor.conversion.for("upcast").add((e=>{e.on("element:pre",((e,t,n)=>{const i=t.viewItem.getChild(0);if(!i||!i.is("element","code"))return;if(!n.consumable.consume(i,{attributes:["vid_start","vid_end"]}))return;const r=t.modelRange.start.nodeAfter;n.writer.setAttribute("vid_start",i.getAttribute("vid_start"),r),n.writer.setAttribute("vid_end",i.getAttribute("vid_end"),r)}),{priority:"low"})})),this.editor.conversion.for("upcast").add((e=>{e.on("element",((e,t,n)=>{if(!n.consumable.consume(t.viewItem,{attributes:["vid_start","vid_end"]}))return;if(t.modelRange.isCollapsed)return;const i=t.modelRange.start.nodeAfter;i.hasAttribute("vid_start")||i.hasAttribute("vid")||(n.writer.setAttribute("vid_start",t.viewItem.getAttribute("vid_start"),i),n.writer.setAttribute("vid_end",t.viewItem.getAttribute("vid_end"),i))}),{priority:"low"})})),this.editor.conversion.for("upcast").elementToAttribute({view:{name:"span",attributes:{vid:!0}},model:{key:"vid",value:e=>e.getAttribute("vid")}}),this.editor.model.schema.on("checkAttribute",((e,[,t])=>{["vid_start","vid_end","vid"].includes(t)&&(e.return=!0,e.stop())}),{priority:"highest"}),this.editor.conversion.for("dataDowncast").add((e=>{e.on("attribute:vid",((e,t,n)=>{if(" "!=t.item.data||t.item.parent.maxOffset>1)return;if(!n.consumable.consume(t.item,e.name))return;const i=n.writer,r=n.mapper.toViewRange(t.range);i.wrap(r,i.createAttributeElement("span"))}))})),this.editor.conversion.for("dataDowncast").markerToData({model:"revision"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",downcastSplitMergeMarker$2(this.editor),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)(e.hasClass("ck-suggestion-marker-split")||e.hasClass("ck-suggestion-marker-merge"))&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",((e,t,n)=>{const i=t.markerName.split(":")[1],r=this._getChangeFromId(i);if(!r)return null;const s="add"==r.type?"split":"merge";if(n.consumable.test(t.markerRange,e.name))for(const e of t.markerRange.getItems()){if(!e.is("element","softBreak"))continue;const i=n.writer.createUIElement("span",{class:"ck-suggestion-marker-"+s}),o=n.mapper.toViewPosition(this.editor.model.createPositionBefore(e));r.data.isSuggestion&&n.writer.addClass("ck-suggestion-marker-"+s+"-new",i),this.activeChange==r&&n.writer.addClass("ck-suggestion-marker--active",i),n.writer.insert(o,i),n.mapper.bindElementToMarker(i,t.markerName)}}),{priority:"high"}),this.editor.model.document.on("change",(()=>{this.editor.editing.view.change((e=>{for(const t of this.editor.model.document.getRootNames()){const n=this.editor.model.document.getRoot(t),i=this.editor.editing.view.document.getRoot(t);if(i){const t=n.getAttribute("revisionHistoryAttachChange");if(e.removeAttribute("data-change-id",i),e.removeClass("ck-revision-history-root-add",i),e.removeClass("ck-revision-history-root-remove",i),e.removeClass("ck-revision-history-root--active",i),t){const n=this._getChangeFromId(t);if(!n)return null;e.setAttribute("data-change-id",t,i),e.addClass("ck-revision-history-root-"+n.type,i),this.activeChange==n&&e.addClass("ck-revision-history-root--active",i)}}}}))})),this.editor.conversion.for("upcast").dataToMarker({view:"comment",model:e=>"revision-comment:"+e,converterPriority:"highest"}),this.editor.conversion.for("upcast").dataToMarker({view:"suggestion",model:e=>"revision-suggestion:"+e,converterPriority:"highest"}),this.editor.conversion.for("dataDowncast").markerToData({model:"revision-suggestion",view:e=>({name:"suggestion:"+e,group:"revision-suggestion"}),converterPriority:"highest"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision-suggestion",view:e=>{const t=e.markerName.split(":")[1];return"insertion"!=t&&"deletion"!=t?null:{classes:["ck-suggestion-preview-marker","ck-suggestion-preview-marker-"+t]}}}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:deletion",downcastSplitMergeMarkerSuggestion(this.editor,"merge"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:insertion",downcastSplitMergeMarkerSuggestion(this.editor,"split"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision-suggestion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.is("uiElement")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"})}_getChangeFromId(e){return this._changeIdToChange.get(e)}_getViewForChange(e){return this._changeView&&this._changeView.destroy(),this._changeView=new ChangeDetailsView(this.editor.locale,e),this._changeView}_initInteractions(){this.editor.model.document.selection.observeMarkers("revision"),this.on("change:activeView",((e,t,n,i)=>{i&&this._balloon.remove(i),n&&(this._balloon.add({view:n,stackId:"revisionHistoryLabel",position:{target:()=>{const e=this.editor.editing,t=this._getChangeFromId(n.changeId);let i;if(t.data.isOnRoot){const n=e.view.getDomRoot(t.rootName);i=Array.from(n.getClientRects())}else{const t=this.editor.model.markers.get("revision:"+n.changeId);i=Array.from(e.mapper.markerNameToElements(t.name)).map((t=>e.view.domConverter.mapViewToDom(t))).map((e=>Array.from(e.getClientRects()))).flat()}return this._activeViewTarget&&i.find((e=>e.top-3<=this._activeViewTarget.y&&e.bottom+3>=this._activeViewTarget.y&&e.left-3<=this._activeViewTarget.x&&e.right+3>=this._activeViewTarget.x))||i[0]}}}),this._balloon.showStack("revisionHistoryLabel"))})),this.on("change:activeChange",((e,t,n,i)=>{this.activeView=n?this._getViewForChange(n):null,this.editor.model.change((()=>{const e=this.editor.editing;i&&(i.data.isOnRoot?e.view.change((t=>{t.removeClass("ck-revision-history-root--active",e.view.document.getRoot(i.rootName))})):e.reconvertMarker("revision:"+i.id)),n&&(n.data.isOnRoot?e.view.change((t=>{t.addClass("ck-revision-history-root--active",e.view.document.getRoot(n.rootName))})):e.reconvertMarker("revision:"+n.id))}))})),this.listenTo(this.editor.editing.view.document,"mouseover",((e,t)=>{if(this.activeChange)return;const n=this._findChangeIdFromDomTarget(t.target),i=this._changeIdToChange.get(n);i?(this._activeViewTarget={x:t.domEvent.x,y:t.domEvent.y},this.activeView=this._getViewForChange(i)):(this._activeViewTarget=null,this.activeView=null)})),this.listenTo(this.editor.editing.view.document,"mousedown",((e,t)=>{const n=this._findChangeIdFromDomTarget(t.target),i=this._changeIdToChange.get(n);i?(this._activeViewTarget={x:t.domEvent.x,y:t.domEvent.y},i===this.activeChange?this._balloon.updatePosition():this.activeChange=i):(this._activeViewTarget=null,this.activeChange=null)}))}_findChangeIdFromDomTarget(e){do{const t=e.getAttribute("data-change-id");if(t)return t;e=e.parent}while(e);return null}_cleanMarkers(){this.editor.model.change((e=>{for(const t of this.editor.model.markers)e.removeMarker(t)}))}}function downcastSplitMergeMarker$2(e){const t=e.plugins.get("RevisionViewer");return(n,i,r)=>{const s=i.markerName.split(":")[1],o=t._getChangeFromId(s);if(!o)return null;const a="add"==o.type?"split":"merge";if(!r.consumable.test(i.markerRange,n.name))return;const c=i.markerRange.getWalker(),l=i.markerRange.start,d=e.model.schema;let u=null,h=null,m=!1,g=!1;for(const e of c){const t=e.item;m=m||d.isContent(t);const n=r.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&d.isBlock(t)&&!d.isLimit(t)&&(t.nextSibling||l.isAtEnd?u&&u.parent==t||(u=t,p(e.previousPosition),g=!0):h=h||e.previousPosition)}function p(e){const n=r.writer.createUIElement("span",{class:"ck-suggestion-marker-"+a}),s=r.mapper.toViewPosition(e);o.data.isSuggestion&&r.writer.addClass("ck-suggestion-marker-"+a+"-new",n),t.activeChange==o&&r.writer.addClass("ck-suggestion-marker--active",n),r.writer.insert(s,n),r.mapper.bindElementToMarker(n,i.markerName)}m||g||!h||p(h)}}function downcastSplitMergeMarkerSuggestion(e,t){return(n,i,r)=>{if(!r.consumable.test(i.markerRange,n.name))return;const s=i.markerRange.getWalker(),o=i.markerRange.start,a=e.model.schema;let c=null,l=null,d=!1,u=!1;for(const e of s){const t=e.item;d=d||a.isContent(t);const n=r.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&a.isBlock(t)&&!a.isLimit(t)&&(t.nextSibling||o.isAtEnd?c&&c.parent==t||(c=t,h(e.previousPosition),u=!0):l=l||e.previousPosition)}function h(e){const n=r.mapper.toViewPosition(e),s=r.writer.createUIElement("span",{class:"ck-suggestion-preview-marker-"+t});r.writer.insert(n,s),r.mapper.bindElementToMarker(s,i.markerName)}d||u||!l||h(l)}}class RestoreRevisionCommand extends _0x354f99{constructor(e){super(e);const t=e.plugins.get(RevisionViewer);this.affectsData=!1,this.listenTo(t,"change:isReady",(()=>this.refresh())),this.listenTo(t,"change:isEnabled",(()=>this.refresh()))}execute(){const e=this.editor,t=e.plugins.get(RevisionViewer),n=t.isReady?t.diff.newRevisionId:null;e.config.get("revisionHistory").restoreRevisionCallback(n)}refresh(){const{isReady:e,isEnabled:t,repository:n,diff:i}=this.editor.plugins.get(RevisionViewer),r=i&&n.getLaterVisibleRevision(i.newRevisionId);this.isEnabled=e&&t&&Boolean(r)}}class ShowChangeCommand extends _0x354f99{constructor(e,{direction:t}){super(e);const n=e.plugins.get(RevisionViewer);this.affectsData=!1,this._step="forward"===t?1:-1,this.listenTo(n,"change:isReady",(()=>this.refresh())),this.listenTo(n,"change:isEnabled",(()=>this.refresh())),this.listenTo(n,"change:activeChange",(()=>this.refresh()))}execute(){const e=this.editor,t=e.plugins.get(RevisionViewer),{isNavigationMode:n,currentChangeNumber:i}=t;let r;if(t.activeChange=n?t.diff.changes.get(i+this._step):t.diff.changes.first,t.activeChange.data.isOnRoot)r=e.editing.view.getDomRoot(t.activeChange.rootName);else{const n=e.model.markers.get("revision:"+t.activeChange.id);r=getMarkerDomElement(e.editing,n)}scrollViewportToShowTarget({target:r,viewportOffset:40})}refresh(){const{isNavigationMode:e,currentChangeNumber:t,numberOfChanges:n,isReady:i,isEnabled:r}=this.editor.plugins.get(RevisionViewer);this.isEnabled=!!(r&&i&&n)&&(!e||(1===this._step?t<n-1:t>0))}}var arrowUpIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 14.494a.75.75 0 0 0 1.197-.899l-.067-.089-6.992-8a.75.75 0 0 0-1.05-.078l-.079.078-7.008 8a.75.75 0 0 0 1.049 1.066l.08-.078 6.442-7.354 6.428 7.354z"/></svg>\n',arrowDownIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 5.506a.75.75 0 0 1 1.197.899l-.067.089-6.992 8a.75.75 0 0 1-1.05.078l-.079-.078-7.008-8a.75.75 0 0 1 1.049-1.066l.08.078 6.442 7.354 6.428-7.354z"/></svg>\n';class ChangesNavigationView extends View{constructor(e){super(e);const t=this.bindTemplate,n=new ButtonView(e),i=new ButtonView(e);this.set("isNavigationMode",!1),this.set("isReady",!1),this.set("currentChangeNumber",0),this.set("numberOfChanges",0),this.set("isForwardNavigationEnabled",!1),this.set("isBackwardNavigationEnabled",!1),this.bind("_isStatusLabelVisible").to(this,"isReady",this,"numberOfChanges",((e,t)=>e&&t>0)),this.bind("_statusText").to(this,"isReady",this,"currentChangeNumber",this,"numberOfChanges",this,"isNavigationMode",((t,n,i,r)=>{if(!t)return getTranslation$3(e,"Loading...");if(!i)return getTranslation$3(e,"No changes");const s=getTranslation$3(e,"NUMBER_OF_CHANGES",i);return r?getTranslation$3(e,"X_OF_Y_CHANGES",[n+1,i]):s})),n.set({label:getTranslation$3(e,"Show previous change"),tooltip:!0,icon:arrowUpIcon}),i.set({label:getTranslation$3(e,"Show next change"),tooltip:!0,icon:arrowDownIcon}),n.bind("isEnabled").to(this,"isBackwardNavigationEnabled"),i.bind("isEnabled").to(this,"isForwardNavigationEnabled"),n.on("execute",(()=>this.fire("execute","backward"))),i.on("execute",(()=>this.fire("execute","forward"))),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-ui","ck-revision-history-ui__changes-navigation"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__wrapper"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__label",t.if("_isStatusLabelVisible","ck-hidden",(e=>!e))]},children:[{text:t.to("isNavigationMode",(t=>t?getTranslation$3(e,"EDIT_X_OF_Y_REVISIONS")+": ":getTranslation$3(e,"Total")+": "))}]},{text:t.to("_statusText")}]},new ToolbarSeparatorView,{tag:"div",attributes:{class:["ck-revision-history-ui__changes-navigation__navigation"]},children:[n,i]}]})}}const OVERLAY_CSS_CLASS="ck-editor__editable__loading-overlay";class RevisionViewerLoadingOverlay extends Plugin{static get pluginName(){return"RevisionViewerLoadingOverlay"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}show(){const e=this.editor.editing.view;e.change((t=>{for(const n of e.document.roots)t.addClass(OVERLAY_CSS_CLASS,n)}))}hide(){const e=this.editor.editing.view;e.change((t=>{for(const n of e.document.roots)t.removeClass(OVERLAY_CSS_CLASS,n)}))}}class RevisionViewerUI extends Plugin{static get pluginName(){return"RevisionViewerUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionViewer,RevisionViewerLoadingOverlay]}init(){const e=this.editor,t=e.plugins.get(RevisionViewer),n=e.plugins.get(RevisionViewerLoadingOverlay);e.ui.componentFactory.add("exitToEditing",(t=>{const n=new ButtonView(t);return n.set({label:getTranslation$3(t,"Back to editing"),icon:_0x27b58d.undo,withText:!0,tooltip:!0,class:"ck-revision-history-ui__back-to-editing"}),this.listenTo(n,"execute",(()=>{e.config.get("revisionHistory").closeRevisionViewerCallback()})),n})),e.ui.componentFactory.add("restoreRevision",(t=>{const n=new ButtonView(t);return n.set({label:getTranslation$3(t,"Restore this revision"),withText:!0,tooltip:!0}),n.bind("isEnabled").to(e.commands.get("restoreRevision")),this.listenTo(n,"execute",(()=>e.execute("restoreRevision"))),n})),e.ui.componentFactory.add("changesNavigation",(n=>{const i=new ChangesNavigationView(n),r=e.commands.get("showPreviousChange"),s=e.commands.get("showNextChange");return i.bind("isBackwardNavigationEnabled").to(r,"isEnabled"),i.bind("isForwardNavigationEnabled").to(s,"isEnabled"),i.bind("isReady","currentChangeNumber","numberOfChanges","isNavigationMode").to(t),this.listenTo(i,"execute",((t,n)=>{e.execute("forward"===n?"showNextChange":"showPreviousChange")})),i})),n.show(),t.on("change:isReady",((e,t,i)=>{i?n.hide():n.show()}))}}class RevisionNameView extends LabeledFieldView{constructor(e,t){super(e,t),this._resizeObserver=null;const n=this.bindTemplate;this.set({label:getTranslation$3(e,"Revision name"),_tooltipString:""}),this.fieldView.placeholder=getTranslation$3(e,"Enter the revision name"),this.extendTemplate({tag:"span",attributes:{class:["ck-revision-history-sidebar__revision-name"],"data-cke-tooltip-text":n.to("_tooltipString"),"data-cke-tooltip-position":"s","data-cke-tooltip-class":"ck-tooltip_multi-line"}})}render(){super.render(),this._resizeObserver=new ResizeObserver(this.fieldView.element,(()=>this._updateTooltipText())),this.listenTo(this.fieldView,"input",(()=>this._updateTooltipText()))}destroy(){super.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_updateTooltipText(){const e=this.fieldView.element;this._tooltipString=e.scrollWidth>e.clientWidth&&e.value||""}}var userIcon='<svg viewBox="0 0 11 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M5.5 5C8.538 5 11 7.015 11 9.5c0 .17-.011.336-.034.5H.034A3.732 3.732 0 0 1 0 9.5C0 7.015 2.462 5 5.5 5zm0-5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5z" /></svg>\n';class RevisionAuthorView extends View{constructor(e,t,n){super(e);const i=new IconView;i.set({content:userIcon,viewBox:"0 0 11 10"});const r=["ck","ck-revision-history-sidebar__revision-author"];n&&r.push("ck-revision-history-sidebar__revision-author_creator");const s=[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision-author__name"],title:getTranslation$3(e,n?"Revision creator":"Revision author")},children:[i,t.name]}];this.setTemplate({tag:"li",attributes:{class:r},children:s})}}function dateToPrettyFormat(e,t){return t.toLocaleDateString(e,{month:"long",day:"numeric"})+", "+t.toLocaleTimeString(e,{hour:"numeric",minute:"numeric"})}function createActionsDropdownView(e,t){const n=e.bindTemplate,i=e.locale,r=createDropdown(i);r.panelPosition="sw";const s=_createDropdownOptions(e,t);return e.bind("isActionsDropdownOpen").to(r,"isOpen"),r.buttonView.set({label:getTranslation$3(i,"Show more items"),tooltip:!0,tooltipPosition:"sw",icon:_0x27b58d.threeVerticalDots}),r.extendTemplate({attributes:{class:["ck-revision-history-sidebar__revision__actions",n.if("isActionsDropdownOpen","ck-on")]},on:{click:n.to((e=>e.stopPropagation()))}}),r.on("execute",(t=>{e.isReady&&"function"==typeof t.source._action&&t.source._action(e)})),addListToDropdown(r,s,{role:"menu"}),r.listenTo(e,"change:isActionsDropdownOpen",((n,i,s)=>{if(s)for(const n of r.listView.items){const i=n.children.first,r=t.find((e=>e.action===i._action)).isVisible;n.isVisible=void 0===r||r(e)}})),r}function _createDropdownOptions(e,t){const n=_getLocalizedOptions(e,t),i=new Collection;for(const t of n){const n={type:"button",model:new ViewModel({label:t.name,class:t.class,withText:!0,role:"menuitem",_action:t.action})};n.model.bind("isEnabled").to(e,"isActionsDropdownOpen",(n=>"function"!=typeof t.isEnabled||!n||t.isEnabled(e))),i.add(n)}return i}function _getLocalizedOptions(e,t){const n=e.locale,i={"Compare against selected":getTranslation$3(n,"Compare against selected"),"Name this revision":getTranslation$3(n,"Name this revision"),"Restore this revision":getTranslation$3(n,"Restore this revision")};return t.map((e=>{const t=i[e.name];return t&&t!==e.name&&(e.name=t),e}))}class RevisionView extends(/*   -- @preserve */
ConfirmMixin(View)){constructor(e,t,n,i){super(e);const r=this.bindTemplate,s=getAuthorViews(e,t);this.id=t.id,this._revision=t,this._requireRevisionName=i,this.bind("name","createdAt").to(t),this.bind("_createdAtFormatted").to(this,"createdAt",(t=>dateToPrettyFormat(e.uiLanguage,t))),this.set("isSelected",!1),this.set("isHighlighted",!1),this.set("isActionsDropdownOpen",!1),this.set("isReady",!1),this.set("isEnabled",!1),this.revisionNameView=new RevisionNameView(e,createLabeledInputText),this.revisionNameView.fieldView.extendTemplate({attributes:{maxlength:"220"}}),this.revisionNameView.fieldView.bind("value").to(this,"name",(e=>e||this._createdAtFormatted)),this.revisionNameView.bind("isEnabled").to(this,"isSelected",this,"isEnabled",((e,t)=>e&&t)),this.revisionActionsView=n&&n.length?createActionsDropdownView(this,n):"",this.revisionActionsView&&this.revisionActionsView.bind("isEnabled").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision-wrapper",r.if("isConfirm","ck-revision-history-sidebar__revision-wrapper_confirmation_visible")]},children:[{tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision",r.if("isEnabled","ck-disabled",(e=>!e)),r.if("isSelected","ck-revision-history-sidebar__revision_selected"),r.if("isHighlighted","ck-revision-history-sidebar__revision_highlighted"),r.if("isActionsDropdownOpen","ck-revision-history-sidebar__actions_dropdown_open")]},children:[this.revisionNameView,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision__date"]},children:[{text:r.to("_createdAtFormatted")}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__revision__controls-wrapper"]},children:[{tag:"ul",attributes:{class:["ck","ck-revision-history-sidebar__revision-authors"]},children:s}]},this.revisionActionsView],on:{click:r.to((e=>{e.srcElement.closest(".ck-thread__remove-confirm")||this.isReady&&this.isEnabled&&this.fire("select",{id:this.id})}))}}]})}render(){super.render();const e=this.revisionNameView.fieldView.element;this.listenTo(e,"change",(()=>{this._requireRevisionName&&!e.value||this.fire("setName",{id:this.id,name:e.value}),e.value||(e.value=this.name?this.name:this._createdAtFormatted)}))}select(){this.isSelected=!0}deselect(){this.isSelected=!1}highlight(){this.isHighlighted=!0}unhighlight(){this.isHighlighted=!1}}function getAuthorViews(e,t){const n=Array.from(t.authors).filter((e=>e!=t.creator));return t.creator&&n.unshift(t.creator),n.map((n=>new RevisionAuthorView(e,n,n==t.creator)))}var luxon={};function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)},_wrapNativeSuper(e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _createForOfIteratorHelperLoose(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}Object.defineProperty(luxon,"__esModule",{value:!0});var LuxonError=function(e){function t(){return e.apply(this,arguments)||this}return _inheritsLoose(t,e),t}(_wrapNativeSuper(Error)),InvalidDateTimeError=function(e){function t(t){return e.call(this,"Invalid DateTime: "+t.toMessage())||this}return _inheritsLoose(t,e),t}(LuxonError),InvalidIntervalError=function(e){function t(t){return e.call(this,"Invalid Interval: "+t.toMessage())||this}return _inheritsLoose(t,e),t}(LuxonError),InvalidDurationError=function(e){function t(t){return e.call(this,"Invalid Duration: "+t.toMessage())||this}return _inheritsLoose(t,e),t}(LuxonError),ConflictingSpecificationError=function(e){function t(){return e.apply(this,arguments)||this}return _inheritsLoose(t,e),t}(LuxonError),InvalidUnitError=function(e){function t(t){return e.call(this,"Invalid unit "+t)||this}return _inheritsLoose(t,e),t}(LuxonError),InvalidArgumentError=function(e){function t(){return e.apply(this,arguments)||this}return _inheritsLoose(t,e),t}(LuxonError),ZoneIsAbstractError=function(e){function t(){return e.call(this,"Zone is an abstract class")||this}return _inheritsLoose(t,e),t}(LuxonError),n="numeric",s="short",l="long",DATE_SHORT={year:n,month:n,day:n},DATE_MED={year:n,month:s,day:n},DATE_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s},DATE_FULL={year:n,month:l,day:n},DATE_HUGE={year:n,month:l,day:n,weekday:l},TIME_SIMPLE={hour:n,minute:n},TIME_WITH_SECONDS={hour:n,minute:n,second:n},TIME_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,timeZoneName:s},TIME_WITH_LONG_OFFSET={hour:n,minute:n,second:n,timeZoneName:l},TIME_24_SIMPLE={hour:n,minute:n,hour12:!1},TIME_24_WITH_SECONDS={hour:n,minute:n,second:n,hour12:!1},TIME_24_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,hour12:!1,timeZoneName:s},TIME_24_WITH_LONG_OFFSET={hour:n,minute:n,second:n,hour12:!1,timeZoneName:l},DATETIME_SHORT={year:n,month:n,day:n,hour:n,minute:n},DATETIME_SHORT_WITH_SECONDS={year:n,month:n,day:n,hour:n,minute:n,second:n},DATETIME_MED={year:n,month:s,day:n,hour:n,minute:n},DATETIME_MED_WITH_SECONDS={year:n,month:s,day:n,hour:n,minute:n,second:n},DATETIME_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s,hour:n,minute:n},DATETIME_FULL={year:n,month:l,day:n,hour:n,minute:n,timeZoneName:s},DATETIME_FULL_WITH_SECONDS={year:n,month:l,day:n,hour:n,minute:n,second:n,timeZoneName:s},DATETIME_HUGE={year:n,month:l,day:n,weekday:l,hour:n,minute:n,timeZoneName:l},DATETIME_HUGE_WITH_SECONDS={year:n,month:l,day:n,weekday:l,hour:n,minute:n,second:n,timeZoneName:l};function isUndefined(e){return void 0===e}function isNumber(e){return"number"==typeof e}function isInteger(e){return"number"==typeof e&&e%1==0}function isString(e){return"string"==typeof e}function isDate(e){return"[object Date]"===Object.prototype.toString.call(e)}function hasIntl(){try{return"undefined"!=typeof Intl&&Intl.DateTimeFormat}catch(e){return!1}}function hasFormatToParts(){return!isUndefined(Intl.DateTimeFormat.prototype.formatToParts)}function hasRelative(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function maybeArray(e){return Array.isArray(e)?e:[e]}function bestBy(e,t,n){if(0!==e.length)return e.reduce((function(e,i){var r=[t(i),i];return e&&n(e[0],r[0])===e[0]?e:r}),null)[1]}function pick(e,t){return t.reduce((function(t,n){return t[n]=e[n],t}),{})}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function integerBetween(e,t,n){return isInteger(e)&&e>=t&&e<=n}function floorMod(e,t){return e-t*Math.floor(e/t)}function padStart(e,t){void 0===t&&(t=2);var n=e<0?"-":"",i=n?-1*e:e;return""+n+(i.toString().length<t?("0".repeat(t)+i).slice(-t):i.toString())}function parseInteger(e){return isUndefined(e)||null===e||""===e?void 0:parseInt(e,10)}function parseMillis(e){if(!isUndefined(e)&&null!==e&&""!==e){var t=1e3*parseFloat("0."+e);return Math.floor(t)}}function roundTo(e,t,n){void 0===n&&(n=!1);var i=Math.pow(10,t);return(n?Math.trunc:Math.round)(e*i)/i}function isLeapYear(e){return e%4==0&&(e%100!=0||e%400==0)}function daysInYear(e){return isLeapYear(e)?366:365}function daysInMonth(e,t){var n=floorMod(t-1,12)+1;return 2===n?isLeapYear(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function objToLocalTS(e){var t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t)).setUTCFullYear(t.getUTCFullYear()-1900),+t}function weeksInWeekYear(e){var t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,n=e-1,i=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return 4===t||3===i?53:52}function untruncateYear(e){return e>99?e:e>60?1900+e:2e3+e}function parseZoneInfo(e,t,n,i){void 0===i&&(i=null);var r=new Date(e),s={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);var o=Object.assign({timeZoneName:t},s),a=hasIntl();if(a&&hasFormatToParts()){var c=new Intl.DateTimeFormat(n,o).formatToParts(r).find((function(e){return"timezonename"===e.type.toLowerCase()}));return c?c.value:null}if(a){var l=new Intl.DateTimeFormat(n,s).format(r);return new Intl.DateTimeFormat(n,o).format(r).substring(l.length).replace(/^[, \u200e]+/,"")}return null}function signedOffset(e,t){var n=parseInt(e,10);Number.isNaN(n)&&(n=0);var i=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-i:i)}function asNumber(e){var t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new InvalidArgumentError("Invalid unit value "+e);return t}function normalizeObject(e,t,n){var i={};for(var r in e)if(hasOwnProperty(e,r)){if(n.indexOf(r)>=0)continue;var s=e[r];if(null==s)continue;i[t(r)]=asNumber(s)}return i}function formatOffset(e,t){var n=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),r=e>=0?"+":"-";switch(t){case"short":return""+r+padStart(n,2)+":"+padStart(i,2);case"narrow":return""+r+n+(i>0?":"+i:"");case"techie":return""+r+padStart(n,2)+padStart(i,2);default:throw new RangeError("Value format "+t+" is out of range for property format")}}function timeObject(e){return pick(e,["hour","minute","second","millisecond"])}var ianaRegex=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z_+-]{1,256}(\/[A-Za-z_+-]{1,256})?)?/;function stringify(e){return JSON.stringify(e,Object.keys(e).sort())}var monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(e){switch(e){case"narrow":return[].concat(monthsNarrow);case"short":return[].concat(monthsShort);case"long":return[].concat(monthsLong);case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(e){switch(e){case"narrow":return[].concat(weekdaysNarrow);case"short":return[].concat(weekdaysShort);case"long":return[].concat(weekdaysLong);case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var meridiems=["AM","PM"],erasLong=["Before Christ","Anno Domini"],erasShort=["BC","AD"],erasNarrow=["B","A"];function eras(e){switch(e){case"narrow":return[].concat(erasNarrow);case"short":return[].concat(erasShort);case"long":return[].concat(erasLong);default:return null}}function meridiemForDateTime(e){return meridiems[e.hour<12?0:1]}function weekdayForDateTime(e,t){return weekdays(t)[e.weekday-1]}function monthForDateTime(e,t){return months(t)[e.month-1]}function eraForDateTime(e,t){return eras(t)[e.year<0?0:1]}function formatRelativeTime(e,t,n,i){void 0===n&&(n="always"),void 0===i&&(i=!1);var r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&s){var o="days"===e;switch(t){case 1:return o?"tomorrow":"next "+r[e][0];case-1:return o?"yesterday":"last "+r[e][0];case 0:return o?"today":"this "+r[e][0]}}var a=Object.is(t,-0)||t<0,c=Math.abs(t),l=1===c,d=r[e],u=i?l?d[1]:d[2]||d[1]:l?r[e][0]:e;return a?c+" "+u+" ago":"in "+c+" "+u}function formatString(e){var t="EEEE, LLLL d, yyyy, h:mm a";switch(stringify(pick(e,["weekday","era","year","month","day","hour","minute","second","timeZoneName","hour12"]))){case stringify(DATE_SHORT):return"M/d/yyyy";case stringify(DATE_MED):return"LLL d, yyyy";case stringify(DATE_MED_WITH_WEEKDAY):return"EEE, LLL d, yyyy";case stringify(DATE_FULL):return"LLLL d, yyyy";case stringify(DATE_HUGE):return"EEEE, LLLL d, yyyy";case stringify(TIME_SIMPLE):return"h:mm a";case stringify(TIME_WITH_SECONDS):return"h:mm:ss a";case stringify(TIME_WITH_SHORT_OFFSET):case stringify(TIME_WITH_LONG_OFFSET):return"h:mm a";case stringify(TIME_24_SIMPLE):return"HH:mm";case stringify(TIME_24_WITH_SECONDS):return"HH:mm:ss";case stringify(TIME_24_WITH_SHORT_OFFSET):case stringify(TIME_24_WITH_LONG_OFFSET):return"HH:mm";case stringify(DATETIME_SHORT):return"M/d/yyyy, h:mm a";case stringify(DATETIME_MED):return"LLL d, yyyy, h:mm a";case stringify(DATETIME_FULL):return"LLLL d, yyyy, h:mm a";case stringify(DATETIME_HUGE):return t;case stringify(DATETIME_SHORT_WITH_SECONDS):return"M/d/yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_SECONDS):return"LLL d, yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_WEEKDAY):return"EEE, d LLL yyyy, h:mm a";case stringify(DATETIME_FULL_WITH_SECONDS):return"LLLL d, yyyy, h:mm:ss a";case stringify(DATETIME_HUGE_WITH_SECONDS):return"EEEE, LLLL d, yyyy, h:mm:ss a";default:return t}}function stringifyTokens(e,t){for(var n,i="",r=_createForOfIteratorHelperLoose(e);!(n=r()).done;){var s=n.value;s.literal?i+=s.val:i+=t(s.val)}return i}var _macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS},Formatter=function(){function e(e,t){this.opts=t,this.loc=e,this.systemLoc=null}e.create=function(t,n){return void 0===n&&(n={}),new e(t,n)},e.parseFormat=function(e){for(var t=null,n="",i=!1,r=[],s=0;s<e.length;s++){var o=e.charAt(s);"'"===o?(n.length>0&&r.push({literal:i,val:n}),t=null,n="",i=!i):i||o===t?n+=o:(n.length>0&&r.push({literal:!1,val:n}),n=o,t=o)}return n.length>0&&r.push({literal:i,val:n}),r},e.macroTokenToFormatOpts=function(e){return _macroTokenToFormatOpts[e]};var t=e.prototype;return t.formatWithSystemDefault=function(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,Object.assign({},this.opts,t)).format()},t.formatDateTime=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,Object.assign({},this.opts,t)).format()},t.formatDateTimeParts=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,Object.assign({},this.opts,t)).formatToParts()},t.resolvedOptions=function(e,t){return void 0===t&&(t={}),this.loc.dtFormatter(e,Object.assign({},this.opts,t)).resolvedOptions()},t.num=function(e,t){if(void 0===t&&(t=0),this.opts.forceSimple)return padStart(e,t);var n=Object.assign({},this.opts);return t>0&&(n.padTo=t),this.loc.numberFormatter(n).format(e)},t.formatDateTimeFromString=function(t,n){var i=this,r="en"===this.loc.listingMode(),s=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar&&hasFormatToParts(),o=function(e,n){return i.loc.extract(t,e,n)},a=function(e){return t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):""},c=function(e,n){return r?monthForDateTime(t,e):o(n?{month:e}:{month:e,day:"numeric"},"month")},l=function(e,n){return r?weekdayForDateTime(t,e):o(n?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday")},d=function(e){return r?eraForDateTime(t,e):o({era:e},"era")};return stringifyTokens(e.parseFormat(n),(function(n){switch(n){case"S":return i.num(t.millisecond);case"u":case"SSS":return i.num(t.millisecond,3);case"s":return i.num(t.second);case"ss":return i.num(t.second,2);case"m":return i.num(t.minute);case"mm":return i.num(t.minute,2);case"h":return i.num(t.hour%12==0?12:t.hour%12);case"hh":return i.num(t.hour%12==0?12:t.hour%12,2);case"H":return i.num(t.hour);case"HH":return i.num(t.hour,2);case"Z":return a({format:"narrow",allowZ:i.opts.allowZ});case"ZZ":return a({format:"short",allowZ:i.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:i.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:i.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:i.loc.locale});case"z":return t.zoneName;case"a":return r?meridiemForDateTime(t):o({hour:"numeric",hour12:!0},"dayperiod");case"d":return s?o({day:"numeric"},"day"):i.num(t.day);case"dd":return s?o({day:"2-digit"},"day"):i.num(t.day,2);case"c":case"E":return i.num(t.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return s?o({month:"numeric",day:"numeric"},"month"):i.num(t.month);case"LL":return s?o({month:"2-digit",day:"numeric"},"month"):i.num(t.month,2);case"LLL":return c("short",!0);case"LLLL":return c("long",!0);case"LLLLL":return c("narrow",!0);case"M":return s?o({month:"numeric"},"month"):i.num(t.month);case"MM":return s?o({month:"2-digit"},"month"):i.num(t.month,2);case"MMM":return c("short",!1);case"MMMM":return c("long",!1);case"MMMMM":return c("narrow",!1);case"y":return s?o({year:"numeric"},"year"):i.num(t.year);case"yy":return s?o({year:"2-digit"},"year"):i.num(t.year.toString().slice(-2),2);case"yyyy":return s?o({year:"numeric"},"year"):i.num(t.year,4);case"yyyyyy":return s?o({year:"numeric"},"year"):i.num(t.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return i.num(t.weekYear.toString().slice(-2),2);case"kkkk":return i.num(t.weekYear,4);case"W":return i.num(t.weekNumber);case"WW":return i.num(t.weekNumber,2);case"o":return i.num(t.ordinal);case"ooo":return i.num(t.ordinal,3);case"q":return i.num(t.quarter);case"qq":return i.num(t.quarter,2);case"X":return i.num(Math.floor(t.ts/1e3));case"x":return i.num(t.ts);default:return u=n,(h=e.macroTokenToFormatOpts(u))?i.formatWithSystemDefault(t,h):u}var u,h}))},t.formatDurationFromString=function(t,n){var i,r=this,s=function(e){switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null}},o=e.parseFormat(n),a=o.reduce((function(e,t){var n=t.literal,i=t.val;return n?e:e.concat(i)}),[]),c=t.shiftTo.apply(t,a.map(s).filter((function(e){return e})));return stringifyTokens(o,(i=c,function(e){var t=s(e);return t?r.num(i.get(t),e.length):e}))},e}(),Invalid=function(){function e(e,t){this.reason=e,this.explanation=t}return e.prototype.toMessage=function(){return this.explanation?this.reason+": "+this.explanation:this.reason},e}(),Zone=function(){function e(){}var t=e.prototype;return t.offsetName=function(e,t){throw new ZoneIsAbstractError},t.formatOffset=function(e,t){throw new ZoneIsAbstractError},t.offset=function(e){throw new ZoneIsAbstractError},t.equals=function(e){throw new ZoneIsAbstractError},_createClass(e,[{key:"type",get:function(){throw new ZoneIsAbstractError}},{key:"name",get:function(){throw new ZoneIsAbstractError}},{key:"universal",get:function(){throw new ZoneIsAbstractError}},{key:"isValid",get:function(){throw new ZoneIsAbstractError}}]),e}(),singleton=null,LocalZone=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var n=t.prototype;return n.offsetName=function(e,t){return parseZoneInfo(e,t.format,t.locale)},n.formatOffset=function(e,t){return formatOffset(this.offset(e),t)},n.offset=function(e){return-new Date(e).getTimezoneOffset()},n.equals=function(e){return"local"===e.type},_createClass(t,[{key:"type",get:function(){return"local"}},{key:"name",get:function(){return hasIntl()?(new Intl.DateTimeFormat).resolvedOptions().timeZone:"local"}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return!0}}],[{key:"instance",get:function(){return null===singleton&&(singleton=new t),singleton}}]),t}(Zone),matchingRegex=RegExp("^"+ianaRegex.source+"$"),dtfCache={};function makeDTF(e){return dtfCache[e]||(dtfCache[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),dtfCache[e]}var typeToPos={year:0,month:1,day:2,hour:3,minute:4,second:5};function hackyOffset(e,t){var n=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(n),r=i[1],s=i[2];return[i[3],r,s,i[4],i[5],i[6]]}function partsOffset(e,t){for(var n=e.formatToParts(t),i=[],r=0;r<n.length;r++){var s=n[r],o=s.type,a=s.value,c=typeToPos[o];isUndefined(c)||(i[c]=parseInt(a,10))}return i}var ianaZoneCache={},IANAZone=function(e){function t(n){var i;return(i=e.call(this)||this).zoneName=n,i.valid=t.isValidZone(n),i}_inheritsLoose(t,e),t.create=function(e){return ianaZoneCache[e]||(ianaZoneCache[e]=new t(e)),ianaZoneCache[e]},t.resetCache=function(){ianaZoneCache={},dtfCache={}},t.isValidSpecifier=function(e){return!(!e||!e.match(matchingRegex))},t.isValidZone=function(e){try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}},t.parseGMTOffset=function(e){if(e){var t=e.match(/^Etc\/GMT(0|[+-]\d{1,2})$/i);if(t)return-60*parseInt(t[1])}return null};var n=t.prototype;return n.offsetName=function(e,t){return parseZoneInfo(e,t.format,t.locale,this.name)},n.formatOffset=function(e,t){return formatOffset(this.offset(e),t)},n.offset=function(e){var t=new Date(e);if(isNaN(t))return NaN;var n=makeDTF(this.name),i=n.formatToParts?partsOffset(n,t):hackyOffset(n,t),r=i[0],s=i[1],o=i[2],a=i[3],c=+t,l=c%1e3;return(objToLocalTS({year:r,month:s,day:o,hour:24===a?0:a,minute:i[4],second:i[5],millisecond:0})-(c-=l>=0?l:1e3+l))/6e4},n.equals=function(e){return"iana"===e.type&&e.name===this.name},_createClass(t,[{key:"type",get:function(){return"iana"}},{key:"name",get:function(){return this.zoneName}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return this.valid}}]),t}(Zone),singleton$1=null,FixedOffsetZone=function(e){function t(t){var n;return(n=e.call(this)||this).fixed=t,n}_inheritsLoose(t,e),t.instance=function(e){return 0===e?t.utcInstance:new t(e)},t.parseSpecifier=function(e){if(e){var n=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(n)return new t(signedOffset(n[1],n[2]))}return null},_createClass(t,null,[{key:"utcInstance",get:function(){return null===singleton$1&&(singleton$1=new t(0)),singleton$1}}]);var n=t.prototype;return n.offsetName=function(){return this.name},n.formatOffset=function(e,t){return formatOffset(this.fixed,t)},n.offset=function(){return this.fixed},n.equals=function(e){return"fixed"===e.type&&e.fixed===this.fixed},_createClass(t,[{key:"type",get:function(){return"fixed"}},{key:"name",get:function(){return 0===this.fixed?"UTC":"UTC"+formatOffset(this.fixed,"narrow")}},{key:"universal",get:function(){return!0}},{key:"isValid",get:function(){return!0}}]),t}(Zone),InvalidZone=function(e){function t(t){var n;return(n=e.call(this)||this).zoneName=t,n}_inheritsLoose(t,e);var n=t.prototype;return n.offsetName=function(){return null},n.formatOffset=function(){return""},n.offset=function(){return NaN},n.equals=function(){return!1},_createClass(t,[{key:"type",get:function(){return"invalid"}},{key:"name",get:function(){return this.zoneName}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return!1}}]),t}(Zone);function normalizeZone(e,t){var n;if(isUndefined(e)||null===e)return t;if(e instanceof Zone)return e;if(isString(e)){var i=e.toLowerCase();return"local"===i?t:"utc"===i||"gmt"===i?FixedOffsetZone.utcInstance:null!=(n=IANAZone.parseGMTOffset(e))?FixedOffsetZone.instance(n):IANAZone.isValidSpecifier(i)?IANAZone.create(e):FixedOffsetZone.parseSpecifier(i)||new InvalidZone(e)}return isNumber(e)?FixedOffsetZone.instance(e):"object"==typeof e&&e.offset&&"number"==typeof e.offset?e:new InvalidZone(e)}var now=function(){return Date.now()},defaultZone=null,defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,throwOnInvalid=!1,Settings=function(){function e(){}return e.resetCaches=function(){Locale.resetCache(),IANAZone.resetCache()},_createClass(e,null,[{key:"now",get:function(){return now},set:function(e){now=e}},{key:"defaultZoneName",get:function(){return e.defaultZone.name},set:function(e){defaultZone=e?normalizeZone(e):null}},{key:"defaultZone",get:function(){return defaultZone||LocalZone.instance}},{key:"defaultLocale",get:function(){return defaultLocale},set:function(e){defaultLocale=e}},{key:"defaultNumberingSystem",get:function(){return defaultNumberingSystem},set:function(e){defaultNumberingSystem=e}},{key:"defaultOutputCalendar",get:function(){return defaultOutputCalendar},set:function(e){defaultOutputCalendar=e}},{key:"throwOnInvalid",get:function(){return throwOnInvalid},set:function(e){throwOnInvalid=e}}]),e}(),intlDTCache={};function getCachedDTF(e,t){void 0===t&&(t={});var n=JSON.stringify([e,t]),i=intlDTCache[n];return i||(i=new Intl.DateTimeFormat(e,t),intlDTCache[n]=i),i}var intlNumCache={};function getCachedINF(e,t){void 0===t&&(t={});var n=JSON.stringify([e,t]),i=intlNumCache[n];return i||(i=new Intl.NumberFormat(e,t),intlNumCache[n]=i),i}var intlRelCache={};function getCachedRTF(e,t){void 0===t&&(t={});var n=t;n.base;var i=_objectWithoutPropertiesLoose(n,["base"]),r=JSON.stringify([e,i]),s=intlRelCache[r];return s||(s=new Intl.RelativeTimeFormat(e,t),intlRelCache[r]=s),s}var sysLocaleCache=null;function systemLocale(){if(sysLocaleCache)return sysLocaleCache;if(hasIntl()){var e=(new Intl.DateTimeFormat).resolvedOptions().locale;return sysLocaleCache=e&&"und"!==e?e:"en-US"}return sysLocaleCache="en-US"}function parseLocaleString(e){var t=e.indexOf("-u-");if(-1===t)return[e];var n,i=e.substring(0,t);try{n=getCachedDTF(e).resolvedOptions()}catch(e){n=getCachedDTF(i).resolvedOptions()}var r=n;return[i,r.numberingSystem,r.calendar]}function intlConfigString(e,t,n){return hasIntl()?n||t?(e+="-u",n&&(e+="-ca-"+n),t&&(e+="-nu-"+t),e):e:[]}function mapMonths(e){for(var t=[],n=1;n<=12;n++){var i=DateTime.utc(2016,n,1);t.push(e(i))}return t}function mapWeekdays(e){for(var t=[],n=1;n<=7;n++){var i=DateTime.utc(2016,11,13+n);t.push(e(i))}return t}function listStuff(e,t,n,i,r){var s=e.listingMode(n);return"error"===s?null:"en"===s?i(t):r(t)}function supportsFastNumbers(e){return(!e.numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||hasIntl()&&"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)}var PolyNumberFormatter=function(){function e(e,t,n){if(this.padTo=n.padTo||0,this.floor=n.floor||!1,!t&&hasIntl()){var i={useGrouping:!1};n.padTo>0&&(i.minimumIntegerDigits=n.padTo),this.inf=getCachedINF(e,i)}}return e.prototype.format=function(e){if(this.inf){var t=this.floor?Math.floor(e):e;return this.inf.format(t)}return padStart(this.floor?Math.floor(e):roundTo(e,3),this.padTo)},e}(),PolyDateFormatter=function(){function e(e,t,n){var i;if(this.opts=n,this.hasIntl=hasIntl(),e.zone.universal&&this.hasIntl){var r=e.offset/60*-1,s=r>=0?"Etc/GMT+"+r:"Etc/GMT"+r,o=IANAZone.isValidZone(s);0!==e.offset&&o?(i=s,this.dt=e):(i="UTC",n.timeZoneName?this.dt=e:this.dt=0===e.offset?e:DateTime.fromMillis(e.ts+60*e.offset*1e3))}else"local"===e.zone.type?this.dt=e:(this.dt=e,i=e.zone.name);if(this.hasIntl){var a=Object.assign({},this.opts);i&&(a.timeZone=i),this.dtf=getCachedDTF(t,a)}}var t=e.prototype;return t.format=function(){if(this.hasIntl)return this.dtf.format(this.dt.toJSDate());var e=formatString(this.opts),t=Locale.create("en-US");return Formatter.create(t).formatDateTimeFromString(this.dt,e)},t.formatToParts=function(){return this.hasIntl&&hasFormatToParts()?this.dtf.formatToParts(this.dt.toJSDate()):[]},t.resolvedOptions=function(){return this.hasIntl?this.dtf.resolvedOptions():{locale:"en-US",numberingSystem:"latn",outputCalendar:"gregory"}},e}(),PolyRelFormatter=function(){function e(e,t,n){this.opts=Object.assign({style:"long"},n),!t&&hasRelative()&&(this.rtf=getCachedRTF(e,n))}var t=e.prototype;return t.format=function(e,t){return this.rtf?this.rtf.format(e,t):formatRelativeTime(t,e,this.opts.numeric,"long"!==this.opts.style)},t.formatToParts=function(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]},e}(),Locale=function(){function e(e,t,n,i){var r=parseLocaleString(e),s=r[0],o=r[1],a=r[2];this.locale=s,this.numberingSystem=t||o||null,this.outputCalendar=n||a||null,this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}e.fromOpts=function(t){return e.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)},e.create=function(t,n,i,r){void 0===r&&(r=!1);var s=t||Settings.defaultLocale;return new e(s||(r?"en-US":systemLocale()),n||Settings.defaultNumberingSystem,i||Settings.defaultOutputCalendar,s)},e.resetCache=function(){sysLocaleCache=null,intlDTCache={},intlNumCache={},intlRelCache={}},e.fromObject=function(t){var n=void 0===t?{}:t,i=n.locale,r=n.numberingSystem,s=n.outputCalendar;return e.create(i,r,s)};var t=e.prototype;return t.listingMode=function(e){void 0===e&&(e=!0);var t=hasIntl()&&hasFormatToParts(),n=this.isEnglish(),i=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t||n&&i||e?!t||n&&i?"en":"intl":"error"},t.clone=function(t){return t&&0!==Object.getOwnPropertyNames(t).length?e.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this},t.redefaultToEN=function(e){return void 0===e&&(e={}),this.clone(Object.assign({},e,{defaultToEN:!0}))},t.redefaultToSystem=function(e){return void 0===e&&(e={}),this.clone(Object.assign({},e,{defaultToEN:!1}))},t.months=function(e,t,n){var i=this;return void 0===t&&(t=!1),void 0===n&&(n=!0),listStuff(this,e,n,months,(function(){var n=t?{month:e,day:"numeric"}:{month:e},r=t?"format":"standalone";return i.monthsCache[r][e]||(i.monthsCache[r][e]=mapMonths((function(e){return i.extract(e,n,"month")}))),i.monthsCache[r][e]}))},t.weekdays=function(e,t,n){var i=this;return void 0===t&&(t=!1),void 0===n&&(n=!0),listStuff(this,e,n,weekdays,(function(){var n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return i.weekdaysCache[r][e]||(i.weekdaysCache[r][e]=mapWeekdays((function(e){return i.extract(e,n,"weekday")}))),i.weekdaysCache[r][e]}))},t.meridiems=function(e){var t=this;return void 0===e&&(e=!0),listStuff(this,void 0,e,(function(){return meridiems}),(function(){if(!t.meridiemCache){var e={hour:"numeric",hour12:!0};t.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map((function(n){return t.extract(n,e,"dayperiod")}))}return t.meridiemCache}))},t.eras=function(e,t){var n=this;return void 0===t&&(t=!0),listStuff(this,e,t,eras,(function(){var t={era:e};return n.eraCache[e]||(n.eraCache[e]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map((function(e){return n.extract(e,t,"era")}))),n.eraCache[e]}))},t.extract=function(e,t,n){var i=this.dtFormatter(e,t).formatToParts().find((function(e){return e.type.toLowerCase()===n}));return i?i.value:null},t.numberFormatter=function(e){return void 0===e&&(e={}),new PolyNumberFormatter(this.intl,e.forceSimple||this.fastNumbers,e)},t.dtFormatter=function(e,t){return void 0===t&&(t={}),new PolyDateFormatter(e,this.intl,t)},t.relFormatter=function(e){return void 0===e&&(e={}),new PolyRelFormatter(this.intl,this.isEnglish(),e)},t.isEnglish=function(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||hasIntl()&&new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")},t.equals=function(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar},_createClass(e,[{key:"fastNumbers",get:function(){return null==this.fastNumbersCached&&(this.fastNumbersCached=supportsFastNumbers(this)),this.fastNumbersCached}}]),e}();function combineRegexes(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.reduce((function(e,t){return e+t.source}),"");return RegExp("^"+i+"$")}function combineExtractors(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(t,n){var i=t[0],r=t[1],s=t[2],o=n(e,s),a=o[0],c=o[1],l=o[2];return[Object.assign(i,a),r||c,l]}),[{},null,1]).slice(0,2)}}function parse(e){if(null==e)return[null,null];for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r],a=o[0],c=o[1],l=a.exec(e);if(l)return c(l)}return[null,null]}function simpleParse(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){var i,r={};for(i=0;i<t.length;i++)r[t[i]]=parseInteger(e[n+i]);return[r,null,n+i]}}var offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,isoTimeRegex=RegExp(""+isoTimeBaseRegex.source+offsetRegex.source+"?"),isoTimeExtensionRegex=RegExp("(?:T"+isoTimeRegex.source+")?"),isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/,isoOrdinalRegex=/(\d{4})-?(\d{3})/,extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay"),extractISOOrdinalData=simpleParse("year","ordinal"),sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/,sqlTimeRegex=RegExp(isoTimeBaseRegex.source+" ?(?:"+offsetRegex.source+"|("+ianaRegex.source+"))?"),sqlTimeExtensionRegex=RegExp("(?: "+sqlTimeRegex.source+")?");function int(e,t,n){var i=e[t];return isUndefined(i)?n:parseInteger(i)}function extractISOYmd(e,t){return[{year:int(e,t),month:int(e,t+1,1),day:int(e,t+2,1)},null,t+3]}function extractISOTime(e,t){return[{hours:int(e,t,0),minutes:int(e,t+1,0),seconds:int(e,t+2,0),milliseconds:parseMillis(e[t+3])},null,t+4]}function extractISOOffset(e,t){var n=!e[t]&&!e[t+1],i=signedOffset(e[t+1],e[t+2]);return[{},n?null:FixedOffsetZone.instance(i),t+3]}function extractIANAZone(e,t){return[{},e[t]?IANAZone.create(e[t]):null,t+1]}var isoTimeOnly=RegExp("^T?"+isoTimeBaseRegex.source+"$"),isoDuration=/^-?P(?:(?:(-?\d{1,9})Y)?(?:(-?\d{1,9})M)?(?:(-?\d{1,9})W)?(?:(-?\d{1,9})D)?(?:T(?:(-?\d{1,9})H)?(?:(-?\d{1,9})M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function extractISODuration(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d="-"===t[0],u=c&&"-"===c[0],h=function(e,t){return void 0===t&&(t=!1),void 0!==e&&(t||e&&d)?-e:e};return[{years:h(parseInteger(n)),months:h(parseInteger(i)),weeks:h(parseInteger(r)),days:h(parseInteger(s)),hours:h(parseInteger(o)),minutes:h(parseInteger(a)),seconds:h(parseInteger(c),"-0"===c),milliseconds:h(parseMillis(l),u)}]}var obsOffsets={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function fromStrings(e,t,n,i,r,s,o){var a={year:2===t.length?untruncateYear(parseInteger(t)):parseInteger(t),month:monthsShort.indexOf(n)+1,day:parseInteger(i),hour:parseInteger(r),minute:parseInteger(s)};return o&&(a.second=parseInteger(o)),e&&(a.weekday=e.length>3?weekdaysLong.indexOf(e)+1:weekdaysShort.indexOf(e)+1),a}var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(e){var t,n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d=e[9],u=e[10],h=e[11],m=fromStrings(n,s,r,i,o,a,c);return t=l?obsOffsets[l]:d?0:signedOffset(u,h),[m,new FixedOffsetZone(t)]}function preprocessRFC2822(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(e){var t=e[1],n=e[2],i=e[3];return[fromStrings(t,e[4],i,n,e[5],e[6],e[7]),FixedOffsetZone.utcInstance]}function extractASCII(e){var t=e[1],n=e[2],i=e[3],r=e[4],s=e[5],o=e[6];return[fromStrings(t,e[7],n,i,r,s,o),FixedOffsetZone.utcInstance]}var isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex),isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex),isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex),isoTimeCombinedRegex=combineRegexes(isoTimeRegex),extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset),extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset),extractISOOrdinalDateAndTime=combineExtractors(extractISOOrdinalData,extractISOTime,extractISOOffset),extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset);function parseISODate(e){return parse(e,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDateAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset])}function parseRFC2822Date(e){return parse(preprocessRFC2822(e),[rfc2822,extractRFC2822])}function parseHTTPDate(e){return parse(e,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII])}function parseISODuration(e){return parse(e,[isoDuration,extractISODuration])}var extractISOTimeOnly=combineExtractors(extractISOTime);function parseISOTimeOnly(e){return parse(e,[isoTimeOnly,extractISOTimeOnly])}var sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex),sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex),extractISOYmdTimeOffsetAndIANAZone=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone),extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(e){return parse(e,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeOffsetAndIANAZone],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone])}var INVALID="Invalid Duration",lowOrderMatrix={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},casualMatrix=Object.assign({years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},lowOrderMatrix),daysInYearAccurate=365.2425,daysInMonthAccurate=30.436875,accurateMatrix=Object.assign({years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:24*daysInYearAccurate,minutes:24*daysInYearAccurate*60,seconds:24*daysInYearAccurate*60*60,milliseconds:24*daysInYearAccurate*60*60*1e3},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:24*daysInYearAccurate/4,minutes:24*daysInYearAccurate*60/4,seconds:24*daysInYearAccurate*60*60/4,milliseconds:24*daysInYearAccurate*60*60*1e3/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:24*daysInMonthAccurate,minutes:24*daysInMonthAccurate*60,seconds:24*daysInMonthAccurate*60*60,milliseconds:24*daysInMonthAccurate*60*60*1e3}},lowOrderMatrix),orderedUnits=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],reverseUnits=orderedUnits.slice(0).reverse();function clone(e,t,n){void 0===n&&(n=!1);var i={values:n?t.values:Object.assign({},e.values,t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new Duration(i)}function antiTrunc(e){return e<0?Math.floor(e):Math.ceil(e)}function convert(e,t,n,i,r){var s=e[r][n],o=t[n]/s,a=Math.sign(o)!==Math.sign(i[r])&&0!==i[r]&&Math.abs(o)<=1?antiTrunc(o):Math.trunc(o);i[r]+=a,t[n]-=a*s}function normalizeValues(e,t){reverseUnits.reduce((function(n,i){return isUndefined(t[i])?n:(n&&convert(e,t,n,t,i),i)}),null)}var Duration=function(){function e(e){var t="longterm"===e.conversionAccuracy||!1;this.values=e.values,this.loc=e.loc||Locale.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=t?accurateMatrix:casualMatrix,this.isLuxonDuration=!0}e.fromMillis=function(t,n){return e.fromObject(Object.assign({milliseconds:t},n))},e.fromObject=function(t){if(null==t||"object"!=typeof t)throw new InvalidArgumentError("Duration.fromObject: argument expected to be an object, got "+(null===t?"null":typeof t));return new e({values:normalizeObject(t,e.normalizeUnit,["locale","numberingSystem","conversionAccuracy","zone"]),loc:Locale.fromObject(t),conversionAccuracy:t.conversionAccuracy})},e.fromISO=function(t,n){var i=parseISODuration(t)[0];if(i){var r=Object.assign(i,n);return e.fromObject(r)}return e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.fromISOTime=function(t,n){var i=parseISOTimeOnly(t)[0];if(i){var r=Object.assign(i,n);return e.fromObject(r)}return e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.invalid=function(t,n){if(void 0===n&&(n=null),!t)throw new InvalidArgumentError("need to specify a reason the Duration is invalid");var i=t instanceof Invalid?t:new Invalid(t,n);if(Settings.throwOnInvalid)throw new InvalidDurationError(i);return new e({invalid:i})},e.normalizeUnit=function(e){var t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new InvalidUnitError(e);return t},e.isDuration=function(e){return e&&e.isLuxonDuration||!1};var t=e.prototype;return t.toFormat=function(e,t){void 0===t&&(t={});var n=Object.assign({},t,{floor:!1!==t.round&&!1!==t.floor});return this.isValid?Formatter.create(this.loc,n).formatDurationFromString(this,e):INVALID},t.toObject=function(e){if(void 0===e&&(e={}),!this.isValid)return{};var t=Object.assign({},this.values);return e.includeConfig&&(t.conversionAccuracy=this.conversionAccuracy,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t},t.toISO=function(){if(!this.isValid)return null;var e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=roundTo(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e},t.toISOTime=function(e){if(void 0===e&&(e={}),!this.isValid)return null;var t=this.toMillis();if(t<0||t>=864e5)return null;e=Object.assign({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e);var n=this.shiftTo("hours","minutes","seconds","milliseconds"),i="basic"===e.format?"hhmm":"hh:mm";e.suppressSeconds&&0===n.seconds&&0===n.milliseconds||(i+="basic"===e.format?"ss":":ss",e.suppressMilliseconds&&0===n.milliseconds||(i+=".SSS"));var r=n.toFormat(i);return e.includePrefix&&(r="T"+r),r},t.toJSON=function(){return this.toISO()},t.toString=function(){return this.toISO()},t.toMillis=function(){return this.as("milliseconds")},t.valueOf=function(){return this.toMillis()},t.plus=function(e){if(!this.isValid)return this;for(var t,n=friendlyDuration(e),i={},r=_createForOfIteratorHelperLoose(orderedUnits);!(t=r()).done;){var s=t.value;(hasOwnProperty(n.values,s)||hasOwnProperty(this.values,s))&&(i[s]=n.get(s)+this.get(s))}return clone(this,{values:i},!0)},t.minus=function(e){if(!this.isValid)return this;var t=friendlyDuration(e);return this.plus(t.negate())},t.mapUnits=function(e){if(!this.isValid)return this;for(var t={},n=0,i=Object.keys(this.values);n<i.length;n++){var r=i[n];t[r]=asNumber(e(this.values[r],r))}return clone(this,{values:t},!0)},t.get=function(t){return this[e.normalizeUnit(t)]},t.set=function(t){return this.isValid?clone(this,{values:Object.assign(this.values,normalizeObject(t,e.normalizeUnit,[]))}):this},t.reconfigure=function(e){var t=void 0===e?{}:e,n=t.locale,i=t.numberingSystem,r=t.conversionAccuracy,s={loc:this.loc.clone({locale:n,numberingSystem:i})};return r&&(s.conversionAccuracy=r),clone(this,s)},t.as=function(e){return this.isValid?this.shiftTo(e).get(e):NaN},t.normalize=function(){if(!this.isValid)return this;var e=this.toObject();return normalizeValues(this.matrix,e),clone(this,{values:e},!0)},t.shiftTo=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!this.isValid)return this;if(0===n.length)return this;n=n.map((function(t){return e.normalizeUnit(t)}));for(var r,s,o={},a={},c=this.toObject(),l=_createForOfIteratorHelperLoose(orderedUnits);!(s=l()).done;){var d=s.value;if(n.indexOf(d)>=0){r=d;var u=0;for(var h in a)u+=this.matrix[h][d]*a[h],a[h]=0;isNumber(c[d])&&(u+=c[d]);var m=Math.trunc(u);for(var g in o[d]=m,a[d]=u-m,c)orderedUnits.indexOf(g)>orderedUnits.indexOf(d)&&convert(this.matrix,c,g,o,d)}else isNumber(c[d])&&(a[d]=c[d])}for(var p in a)0!==a[p]&&(o[r]+=p===r?a[p]:a[p]/this.matrix[r][p]);return clone(this,{values:o},!0).normalize()},t.negate=function(){if(!this.isValid)return this;for(var e={},t=0,n=Object.keys(this.values);t<n.length;t++){var i=n[t];e[i]=-this.values[i]}return clone(this,{values:e},!0)},t.equals=function(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(var t,n=_createForOfIteratorHelperLoose(orderedUnits);!(t=n()).done;){var i=t.value;if(r=this.values[i],s=e.values[i],!(void 0===r||0===r?void 0===s||0===s:r===s))return!1}var r,s;return!0},_createClass(e,[{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"years",get:function(){return this.isValid?this.values.years||0:NaN}},{key:"quarters",get:function(){return this.isValid?this.values.quarters||0:NaN}},{key:"months",get:function(){return this.isValid?this.values.months||0:NaN}},{key:"weeks",get:function(){return this.isValid?this.values.weeks||0:NaN}},{key:"days",get:function(){return this.isValid?this.values.days||0:NaN}},{key:"hours",get:function(){return this.isValid?this.values.hours||0:NaN}},{key:"minutes",get:function(){return this.isValid?this.values.minutes||0:NaN}},{key:"seconds",get:function(){return this.isValid?this.values.seconds||0:NaN}},{key:"milliseconds",get:function(){return this.isValid?this.values.milliseconds||0:NaN}},{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),e}();function friendlyDuration(e){if(isNumber(e))return Duration.fromMillis(e);if(Duration.isDuration(e))return e;if("object"==typeof e)return Duration.fromObject(e);throw new InvalidArgumentError("Unknown duration argument "+e+" of type "+typeof e)}var INVALID$1="Invalid Interval";function validateStartEnd(e,t){return e&&e.isValid?t&&t.isValid?t<e?Interval.invalid("end before start","The end of an interval must be after its start, but you had start="+e.toISO()+" and end="+t.toISO()):null:Interval.invalid("missing or invalid end"):Interval.invalid("missing or invalid start")}var Interval=function(){function e(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}e.invalid=function(t,n){if(void 0===n&&(n=null),!t)throw new InvalidArgumentError("need to specify a reason the Interval is invalid");var i=t instanceof Invalid?t:new Invalid(t,n);if(Settings.throwOnInvalid)throw new InvalidIntervalError(i);return new e({invalid:i})},e.fromDateTimes=function(t,n){var i=friendlyDateTime(t),r=friendlyDateTime(n),s=validateStartEnd(i,r);return null==s?new e({start:i,end:r}):s},e.after=function(t,n){var i=friendlyDuration(n),r=friendlyDateTime(t);return e.fromDateTimes(r,r.plus(i))},e.before=function(t,n){var i=friendlyDuration(n),r=friendlyDateTime(t);return e.fromDateTimes(r.minus(i),r)},e.fromISO=function(t,n){var i=(t||"").split("/",2),r=i[0],s=i[1];if(r&&s){var o,a,c,l;try{a=(o=DateTime.fromISO(r,n)).isValid}catch(e){a=!1}try{l=(c=DateTime.fromISO(s,n)).isValid}catch(e){l=!1}if(a&&l)return e.fromDateTimes(o,c);if(a){var d=Duration.fromISO(s,n);if(d.isValid)return e.after(o,d)}else if(l){var u=Duration.fromISO(r,n);if(u.isValid)return e.before(c,u)}}return e.invalid("unparsable",'the input "'+t+"\" can't be parsed as ISO 8601")},e.isInterval=function(e){return e&&e.isLuxonInterval||!1};var t=e.prototype;return t.length=function(e){return void 0===e&&(e="milliseconds"),this.isValid?this.toDuration.apply(this,[e]).get(e):NaN},t.count=function(e){if(void 0===e&&(e="milliseconds"),!this.isValid)return NaN;var t=this.start.startOf(e),n=this.end.startOf(e);return Math.floor(n.diff(t,e).get(e))+1},t.hasSame=function(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))},t.isEmpty=function(){return this.s.valueOf()===this.e.valueOf()},t.isAfter=function(e){return!!this.isValid&&this.s>e},t.isBefore=function(e){return!!this.isValid&&this.e<=e},t.contains=function(e){return!!this.isValid&&this.s<=e&&this.e>e},t.set=function(t){var n=void 0===t?{}:t,i=n.start,r=n.end;return this.isValid?e.fromDateTimes(i||this.s,r||this.e):this},t.splitAt=function(){var t=this;if(!this.isValid)return[];for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(var s=i.map(friendlyDateTime).filter((function(e){return t.contains(e)})).sort(),o=[],a=this.s,c=0;a<this.e;){var l=s[c]||this.e,d=+l>+this.e?this.e:l;o.push(e.fromDateTimes(a,d)),a=d,c+=1}return o},t.splitBy=function(t){var n=friendlyDuration(t);if(!this.isValid||!n.isValid||0===n.as("milliseconds"))return[];for(var i,r=this.s,s=1,o=[];r<this.e;){var a=this.start.plus(n.mapUnits((function(e){return e*s})));i=+a>+this.e?this.e:a,o.push(e.fromDateTimes(r,i)),r=i,s+=1}return o},t.divideEqually=function(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]},t.overlaps=function(e){return this.e>e.s&&this.s<e.e},t.abutsStart=function(e){return!!this.isValid&&+this.e==+e.s},t.abutsEnd=function(e){return!!this.isValid&&+e.e==+this.s},t.engulfs=function(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e},t.equals=function(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)},t.intersection=function(t){if(!this.isValid)return this;var n=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return n>=i?null:e.fromDateTimes(n,i)},t.union=function(t){if(!this.isValid)return this;var n=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return e.fromDateTimes(n,i)},e.merge=function(e){var t=e.sort((function(e,t){return e.s-t.s})).reduce((function(e,t){var n=e[0],i=e[1];return i?i.overlaps(t)||i.abutsStart(t)?[n,i.union(t)]:[n.concat([i]),t]:[n,t]}),[[],null]),n=t[0],i=t[1];return i&&n.push(i),n},e.xor=function(t){for(var n,i,r=null,s=0,o=[],a=t.map((function(e){return[{time:e.s,type:"s"},{time:e.e,type:"e"}]})),c=_createForOfIteratorHelperLoose((n=Array.prototype).concat.apply(n,a).sort((function(e,t){return e.time-t.time})));!(i=c()).done;){var l=i.value;1===(s+="s"===l.type?1:-1)?r=l.time:(r&&+r!=+l.time&&o.push(e.fromDateTimes(r,l.time)),r=null)}return e.merge(o)},t.difference=function(){for(var t=this,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e.xor([this].concat(i)).map((function(e){return t.intersection(e)})).filter((function(e){return e&&!e.isEmpty()}))},t.toString=function(){return this.isValid?"["+this.s.toISO()+"  "+this.e.toISO()+")":INVALID$1},t.toISO=function(e){return this.isValid?this.s.toISO(e)+"/"+this.e.toISO(e):INVALID$1},t.toISODate=function(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():INVALID$1},t.toISOTime=function(e){return this.isValid?this.s.toISOTime(e)+"/"+this.e.toISOTime(e):INVALID$1},t.toFormat=function(e,t){var n=(void 0===t?{}:t).separator,i=void 0===n?"  ":n;return this.isValid?""+this.s.toFormat(e)+i+this.e.toFormat(e):INVALID$1},t.toDuration=function(e,t){return this.isValid?this.e.diff(this.s,e,t):Duration.invalid(this.invalidReason)},t.mapEndpoints=function(t){return e.fromDateTimes(t(this.s),t(this.e))},_createClass(e,[{key:"start",get:function(){return this.isValid?this.s:null}},{key:"end",get:function(){return this.isValid?this.e:null}},{key:"isValid",get:function(){return null===this.invalidReason}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),e}(),Info=function(){function e(){}return e.hasDST=function(e){void 0===e&&(e=Settings.defaultZone);var t=DateTime.now().setZone(e).set({month:12});return!e.universal&&t.offset!==t.set({month:6}).offset},e.isValidIANAZone=function(e){return IANAZone.isValidSpecifier(e)&&IANAZone.isValidZone(e)},e.normalizeZone=function(e){return normalizeZone(e,Settings.defaultZone)},e.months=function(e,t){void 0===e&&(e="long");var n=void 0===t?{}:t,i=n.locale,r=void 0===i?null:i,s=n.numberingSystem,o=void 0===s?null:s,a=n.locObj,c=void 0===a?null:a,l=n.outputCalendar,d=void 0===l?"gregory":l;return(c||Locale.create(r,o,d)).months(e)},e.monthsFormat=function(e,t){void 0===e&&(e="long");var n=void 0===t?{}:t,i=n.locale,r=void 0===i?null:i,s=n.numberingSystem,o=void 0===s?null:s,a=n.locObj,c=void 0===a?null:a,l=n.outputCalendar,d=void 0===l?"gregory":l;return(c||Locale.create(r,o,d)).months(e,!0)},e.weekdays=function(e,t){void 0===e&&(e="long");var n=void 0===t?{}:t,i=n.locale,r=void 0===i?null:i,s=n.numberingSystem,o=void 0===s?null:s,a=n.locObj;return((void 0===a?null:a)||Locale.create(r,o,null)).weekdays(e)},e.weekdaysFormat=function(e,t){void 0===e&&(e="long");var n=void 0===t?{}:t,i=n.locale,r=void 0===i?null:i,s=n.numberingSystem,o=void 0===s?null:s,a=n.locObj;return((void 0===a?null:a)||Locale.create(r,o,null)).weekdays(e,!0)},e.meridiems=function(e){var t=(void 0===e?{}:e).locale,n=void 0===t?null:t;return Locale.create(n).meridiems()},e.eras=function(e,t){void 0===e&&(e="short");var n=(void 0===t?{}:t).locale,i=void 0===n?null:n;return Locale.create(i,null,"gregory").eras(e)},e.features=function(){var e=!1,t=!1,n=!1,i=!1;if(hasIntl()){e=!0,t=hasFormatToParts(),i=hasRelative();try{n="America/New_York"===new Intl.DateTimeFormat("en",{timeZone:"America/New_York"}).resolvedOptions().timeZone}catch(e){n=!1}}return{intl:e,intlTokens:t,zones:n,relative:i}},e}();function dayDiff(e,t){var n=function(e){return e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()},i=n(t)-n(e);return Math.floor(Duration.fromMillis(i).as("days"))}function highOrderDiffs(e,t,n){for(var i,r,s={},o=0,a=[["years",function(e,t){return t.year-e.year}],["quarters",function(e,t){return t.quarter-e.quarter}],["months",function(e,t){return t.month-e.month+12*(t.year-e.year)}],["weeks",function(e,t){var n=dayDiff(e,t);return(n-n%7)/7}],["days",dayDiff]];o<a.length;o++){var c=a[o],l=c[0],d=c[1];if(n.indexOf(l)>=0){var u;i=l;var h,m=d(e,t);(r=e.plus(((u={})[l]=m,u)))>t?(e=e.plus(((h={})[l]=m-1,h)),m-=1):e=r,s[l]=m}}return[e,s,r,i]}function _diff(e,t,n,i){var r,s=highOrderDiffs(e,t,n),o=s[0],a=s[1],c=s[2],l=s[3],d=t-o,u=n.filter((function(e){return["hours","minutes","seconds","milliseconds"].indexOf(e)>=0}));0===u.length&&(c<t&&(c=o.plus(((r={})[l]=1,r))),c!==o&&(a[l]=(a[l]||0)+d/(c-o)));var h,m=Duration.fromObject(Object.assign(a,i));return u.length>0?(h=Duration.fromMillis(d,i)).shiftTo.apply(h,u).plus(m):m}var numberingSystems={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(e){var t=parseInt(e,10);if(isNaN(t)){t="";for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(-1!==e[n].search(numberingSystems.hanidec))t+=hanidecChars.indexOf(e[n]);else for(var r in numberingSystemsUTF16){var s=numberingSystemsUTF16[r],o=s[0],a=s[1];i>=o&&i<=a&&(t+=i-o)}}return parseInt(t,10)}return t}function digitRegex(e,t){var n=e.numberingSystem;return void 0===t&&(t=""),new RegExp(""+numberingSystems[n||"latn"]+t)}var MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(e,t){return void 0===t&&(t=function(e){return e}),{regex:e,deser:function(e){var n=e[0];return t(parseDigits(n))}}}var NBSP=String.fromCharCode(160),spaceOrNBSP="( |"+NBSP+")",spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(e){return e.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP)}function stripInsensitivities(e){return e.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase()}function oneOf(e,t){return null===e?null:{regex:RegExp(e.map(fixListRegex).join("|")),deser:function(n){var i=n[0];return e.findIndex((function(e){return stripInsensitivities(i)===stripInsensitivities(e)}))+t}}}function offset(e,t){return{regex:e,deser:function(e){return signedOffset(e[1],e[2])},groups:t}}function simple(e){return{regex:e,deser:function(e){return e[0]}}}function escapeToken(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function unitForToken(e,t){var n=digitRegex(t),i=digitRegex(t,"{2}"),r=digitRegex(t,"{3}"),s=digitRegex(t,"{4}"),o=digitRegex(t,"{6}"),a=digitRegex(t,"{1,2}"),c=digitRegex(t,"{1,3}"),l=digitRegex(t,"{1,6}"),d=digitRegex(t,"{1,9}"),u=digitRegex(t,"{2,4}"),h=digitRegex(t,"{4,6}"),m=function(e){return{regex:RegExp(escapeToken(e.val)),deser:function(e){return e[0]},literal:!0}},g=function(g){if(e.literal)return m(g);switch(g.val){case"G":return oneOf(t.eras("short",!1),0);case"GG":return oneOf(t.eras("long",!1),0);case"y":return intUnit(l);case"yy":case"kk":return intUnit(u,untruncateYear);case"yyyy":case"kkkk":return intUnit(s);case"yyyyy":return intUnit(h);case"yyyyyy":return intUnit(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return intUnit(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return intUnit(i);case"MMM":return oneOf(t.months("short",!0,!1),1);case"MMMM":return oneOf(t.months("long",!0,!1),1);case"LLL":return oneOf(t.months("short",!1,!1),1);case"LLLL":return oneOf(t.months("long",!1,!1),1);case"o":case"S":return intUnit(c);case"ooo":case"SSS":return intUnit(r);case"u":return simple(d);case"a":return oneOf(t.meridiems(),0);case"E":case"c":return intUnit(n);case"EEE":return oneOf(t.weekdays("short",!1,!1),1);case"EEEE":return oneOf(t.weekdays("long",!1,!1),1);case"ccc":return oneOf(t.weekdays("short",!0,!1),1);case"cccc":return oneOf(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return offset(new RegExp("([+-]"+a.source+")(?::("+i.source+"))?"),2);case"ZZZ":return offset(new RegExp("([+-]"+a.source+")("+i.source+")?"),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);default:return m(g)}}(e)||{invalidReason:MISSING_FTP};return g.token=e,g}var partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function tokenForPart(e,t,n){var i=e.type,r=e.value;if("literal"===i)return{literal:!0,val:r};var s=n[i],o=partTypeStyleToTokenVal[i];return"object"==typeof o&&(o=o[s]),o?{literal:!1,val:o}:void 0}function buildRegex(e){return["^"+e.map((function(e){return e.regex})).reduce((function(e,t){return e+"("+t.source+")"}),"")+"$",e]}function match(e,t,n){var i=e.match(t);if(i){var r={},s=1;for(var o in n)if(hasOwnProperty(n,o)){var a=n[o],c=a.groups?a.groups+1:1;!a.literal&&a.token&&(r[a.token.val[0]]=a.deser(i.slice(s,s+c))),s+=c}return[i,r]}return[i,{}]}function dateTimeFromMatches(e){var t;return t=isUndefined(e.Z)?isUndefined(e.z)?null:IANAZone.create(e.z):new FixedOffsetZone(e.Z),isUndefined(e.q)||(e.M=3*(e.q-1)+1),isUndefined(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),isUndefined(e.u)||(e.S=parseMillis(e.u)),[Object.keys(e).reduce((function(t,n){var i=function(e){switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}}(n);return i&&(t[i]=e[n]),t}),{}),t]}var dummyDateTimeCache=null;function getDummyDateTime(){return dummyDateTimeCache||(dummyDateTimeCache=DateTime.fromMillis(1555555555555)),dummyDateTimeCache}function maybeExpandMacroToken(e,t){if(e.literal)return e;var n=Formatter.macroTokenToFormatOpts(e.val);if(!n)return e;var i=Formatter.create(t,n).formatDateTimeParts(getDummyDateTime()).map((function(e){return tokenForPart(e,t,n)}));return i.includes(void 0)?e:i}function expandMacroTokens(e,t){var n;return(n=Array.prototype).concat.apply(n,e.map((function(e){return maybeExpandMacroToken(e,t)})))}function explainFromTokens(e,t,n){var i=expandMacroTokens(Formatter.parseFormat(n),e),r=i.map((function(t){return unitForToken(t,e)})),s=r.find((function(e){return e.invalidReason}));if(s)return{input:t,tokens:i,invalidReason:s.invalidReason};var o=buildRegex(r),a=o[0],c=o[1],l=RegExp(a,"i"),d=match(t,l,c),u=d[0],h=d[1],m=h?dateTimeFromMatches(h):[null,null],g=m[0],p=m[1];if(hasOwnProperty(h,"a")&&hasOwnProperty(h,"H"))throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:u,matches:h,result:g,zone:p}}function parseFromTokens(e,t,n){var i=explainFromTokens(e,t,n);return[i.result,i.zone,i.invalidReason]}var nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(e,t){return new Invalid("unit out of range","you specified "+t+" (of type "+typeof t+") as a "+e+", which is invalid")}function dayOfWeek(e,t,n){var i=new Date(Date.UTC(e,t-1,n)).getUTCDay();return 0===i?7:i}function computeOrdinal(e,t,n){return n+(isLeapYear(e)?leapLadder:nonLeapLadder)[t-1]}function uncomputeOrdinal(e,t){var n=isLeapYear(e)?leapLadder:nonLeapLadder,i=n.findIndex((function(e){return e<t}));return{month:i+1,day:t-n[i]}}function gregorianToWeek(e){var t,n=e.year,i=e.month,r=e.day,s=computeOrdinal(n,i,r),o=dayOfWeek(n,i,r),a=Math.floor((s-o+10)/7);return a<1?a=weeksInWeekYear(t=n-1):a>weeksInWeekYear(n)?(t=n+1,a=1):t=n,Object.assign({weekYear:t,weekNumber:a,weekday:o},timeObject(e))}function weekToGregorian(e){var t,n=e.weekYear,i=e.weekNumber,r=e.weekday,s=dayOfWeek(n,1,4),o=daysInYear(n),a=7*i+r-s-3;a<1?a+=daysInYear(t=n-1):a>o?(t=n+1,a-=daysInYear(n)):t=n;var c=uncomputeOrdinal(t,a),l=c.month,d=c.day;return Object.assign({year:t,month:l,day:d},timeObject(e))}function gregorianToOrdinal(e){var t=e.year,n=computeOrdinal(t,e.month,e.day);return Object.assign({year:t,ordinal:n},timeObject(e))}function ordinalToGregorian(e){var t=e.year,n=uncomputeOrdinal(t,e.ordinal),i=n.month,r=n.day;return Object.assign({year:t,month:i,day:r},timeObject(e))}function hasInvalidWeekData(e){var t=isInteger(e.weekYear),n=integerBetween(e.weekNumber,1,weeksInWeekYear(e.weekYear)),i=integerBetween(e.weekday,1,7);return t?n?!i&&unitOutOfRange("weekday",e.weekday):unitOutOfRange("week",e.week):unitOutOfRange("weekYear",e.weekYear)}function hasInvalidOrdinalData(e){var t=isInteger(e.year),n=integerBetween(e.ordinal,1,daysInYear(e.year));return t?!n&&unitOutOfRange("ordinal",e.ordinal):unitOutOfRange("year",e.year)}function hasInvalidGregorianData(e){var t=isInteger(e.year),n=integerBetween(e.month,1,12),i=integerBetween(e.day,1,daysInMonth(e.year,e.month));return t?n?!i&&unitOutOfRange("day",e.day):unitOutOfRange("month",e.month):unitOutOfRange("year",e.year)}function hasInvalidTimeData(e){var t=e.hour,n=e.minute,i=e.second,r=e.millisecond,s=integerBetween(t,0,23)||24===t&&0===n&&0===i&&0===r,o=integerBetween(n,0,59),a=integerBetween(i,0,59),c=integerBetween(r,0,999);return s?o?a?!c&&unitOutOfRange("millisecond",r):unitOutOfRange("second",i):unitOutOfRange("minute",n):unitOutOfRange("hour",t)}var INVALID$2="Invalid DateTime",MAX_DATE=864e13;function unsupportedZone(e){return new Invalid("unsupported zone",'the zone "'+e.name+'" is not supported')}function possiblyCachedWeekData(e){return null===e.weekData&&(e.weekData=gregorianToWeek(e.c)),e.weekData}function clone$1(e,t){var n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new DateTime(Object.assign({},n,t,{old:n}))}function fixOffset(e,t,n){var i=e-60*t*1e3,r=n.offset(i);if(t===r)return[i,t];i-=60*(r-t)*1e3;var s=n.offset(i);return r===s?[i,r]:[e-60*Math.min(r,s)*1e3,Math.max(r,s)]}function tsToObj(e,t){var n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function objToTS(e,t,n){return fixOffset(objToLocalTS(e),t,n)}function adjustTime(e,t){var n=e.o,i=e.c.year+Math.trunc(t.years),r=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s=Object.assign({},e.c,{year:i,month:r,day:Math.min(e.c.day,daysInMonth(i,r))+Math.trunc(t.days)+7*Math.trunc(t.weeks)}),o=Duration.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=fixOffset(objToLocalTS(s),n,e.zone),c=a[0],l=a[1];return 0!==o&&(c+=o,l=e.zone.offset(c)),{ts:c,o:l}}function parseDataToDateTime(e,t,n,i,r){var s=n.setZone,o=n.zone;if(e&&0!==Object.keys(e).length){var a=t||o,c=DateTime.fromObject(Object.assign(e,n,{zone:a,setZone:void 0}));return s?c:c.setZone(o)}return DateTime.invalid(new Invalid("unparsable",'the input "'+r+"\" can't be parsed as "+i))}function toTechFormat(e,t,n){return void 0===n&&(n=!0),e.isValid?Formatter.create(Locale.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function toTechTimeFormat(e,t){var n=t.suppressSeconds,i=void 0!==n&&n,r=t.suppressMilliseconds,s=void 0!==r&&r,o=t.includeOffset,a=t.includePrefix,c=void 0!==a&&a,l=t.includeZone,d=void 0!==l&&l,u=t.spaceZone,h=void 0!==u&&u,m=t.format,g=void 0===m?"extended":m,p="basic"===g?"HHmm":"HH:mm";i&&0===e.second&&0===e.millisecond||(p+="basic"===g?"ss":":ss",s&&0===e.millisecond||(p+=".SSS")),(d||o)&&h&&(p+=" "),d?p+="z":o&&(p+="basic"===g?"ZZZ":"ZZ");var f=toTechFormat(e,p);return c&&(f="T"+f),f}var defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0},orderedUnits$1=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(e){var t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new InvalidUnitError(e);return t}function quickDT(e,t){for(var n,i=_createForOfIteratorHelperLoose(orderedUnits$1);!(n=i()).done;){var r=n.value;isUndefined(e[r])&&(e[r]=defaultUnitValues[r])}var s=hasInvalidGregorianData(e)||hasInvalidTimeData(e);if(s)return DateTime.invalid(s);var o=Settings.now(),a=objToTS(e,t.offset(o),t),c=a[0],l=a[1];return new DateTime({ts:c,zone:t,o:l})}function diffRelative(e,t,n){var i=!!isUndefined(n.round)||n.round,r=function(e,r){return e=roundTo(e,i||n.calendary?0:2,!0),t.loc.clone(n).relFormatter(n).format(e,r)},s=function(i){return n.calendary?t.hasSame(e,i)?0:t.startOf(i).diff(e.startOf(i),i).get(i):t.diff(e,i).get(i)};if(n.unit)return r(s(n.unit),n.unit);for(var o,a=_createForOfIteratorHelperLoose(n.units);!(o=a()).done;){var c=o.value,l=s(c);if(Math.abs(l)>=1)return r(l,c)}return r(e>t?-0:0,n.units[n.units.length-1])}var DateTime=function(){function e(e){var t=e.zone||Settings.defaultZone,n=e.invalid||(Number.isNaN(e.ts)?new Invalid("invalid input"):null)||(t.isValid?null:unsupportedZone(t));this.ts=isUndefined(e.ts)?Settings.now():e.ts;var i=null,r=null;if(!n)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t)){var s=[e.old.c,e.old.o];i=s[0],r=s[1]}else{var o=t.offset(this.ts);i=tsToObj(this.ts,o),i=(n=Number.isNaN(i.year)?new Invalid("invalid input"):null)?null:i,r=n?null:o}this._zone=t,this.loc=e.loc||Locale.create(),this.invalid=n,this.weekData=null,this.c=i,this.o=r,this.isLuxonDateTime=!0}e.now=function(){return new e({})},e.local=function(t,n,i,r,s,o,a){return isUndefined(t)?e.now():quickDT({year:t,month:n,day:i,hour:r,minute:s,second:o,millisecond:a},Settings.defaultZone)},e.utc=function(t,n,i,r,s,o,a){return isUndefined(t)?new e({ts:Settings.now(),zone:FixedOffsetZone.utcInstance}):quickDT({year:t,month:n,day:i,hour:r,minute:s,second:o,millisecond:a},FixedOffsetZone.utcInstance)},e.fromJSDate=function(t,n){void 0===n&&(n={});var i=isDate(t)?t.valueOf():NaN;if(Number.isNaN(i))return e.invalid("invalid input");var r=normalizeZone(n.zone,Settings.defaultZone);return r.isValid?new e({ts:i,zone:r,loc:Locale.fromObject(n)}):e.invalid(unsupportedZone(r))},e.fromMillis=function(t,n){if(void 0===n&&(n={}),isNumber(t))return t<-MAX_DATE||t>MAX_DATE?e.invalid("Timestamp out of range"):new e({ts:t,zone:normalizeZone(n.zone,Settings.defaultZone),loc:Locale.fromObject(n)});throw new InvalidArgumentError("fromMillis requires a numerical input, but received a "+typeof t+" with value "+t)},e.fromSeconds=function(t,n){if(void 0===n&&(n={}),isNumber(t))return new e({ts:1e3*t,zone:normalizeZone(n.zone,Settings.defaultZone),loc:Locale.fromObject(n)});throw new InvalidArgumentError("fromSeconds requires a numerical input")},e.fromObject=function(t){var n=normalizeZone(t.zone,Settings.defaultZone);if(!n.isValid)return e.invalid(unsupportedZone(n));var i=Settings.now(),r=n.offset(i),s=normalizeObject(t,normalizeUnit,["zone","locale","outputCalendar","numberingSystem"]),o=!isUndefined(s.ordinal),a=!isUndefined(s.year),c=!isUndefined(s.month)||!isUndefined(s.day),l=a||c,d=s.weekYear||s.weekNumber,u=Locale.fromObject(t);if((l||o)&&d)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&o)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");var h,m,g=d||s.weekday&&!l,p=tsToObj(i,r);g?(h=orderedWeekUnits,m=defaultWeekUnitValues,p=gregorianToWeek(p)):o?(h=orderedOrdinalUnits,m=defaultOrdinalUnitValues,p=gregorianToOrdinal(p)):(h=orderedUnits$1,m=defaultUnitValues);for(var f,y=!1,b=_createForOfIteratorHelperLoose(h);!(f=b()).done;){var w=f.value;isUndefined(s[w])?s[w]=y?m[w]:p[w]:y=!0}var v=(g?hasInvalidWeekData(s):o?hasInvalidOrdinalData(s):hasInvalidGregorianData(s))||hasInvalidTimeData(s);if(v)return e.invalid(v);var T=objToTS(g?weekToGregorian(s):o?ordinalToGregorian(s):s,r,n),_=new e({ts:T[0],zone:n,o:T[1],loc:u});return s.weekday&&l&&t.weekday!==_.weekday?e.invalid("mismatched weekday","you can't specify both a weekday of "+s.weekday+" and a date of "+_.toISO()):_},e.fromISO=function(e,t){void 0===t&&(t={});var n=parseISODate(e);return parseDataToDateTime(n[0],n[1],t,"ISO 8601",e)},e.fromRFC2822=function(e,t){void 0===t&&(t={});var n=parseRFC2822Date(e);return parseDataToDateTime(n[0],n[1],t,"RFC 2822",e)},e.fromHTTP=function(e,t){void 0===t&&(t={});var n=parseHTTPDate(e);return parseDataToDateTime(n[0],n[1],t,"HTTP",t)},e.fromFormat=function(t,n,i){if(void 0===i&&(i={}),isUndefined(t)||isUndefined(n))throw new InvalidArgumentError("fromFormat requires an input string and a format");var r=i,s=r.locale,o=void 0===s?null:s,a=r.numberingSystem,c=void 0===a?null:a,l=parseFromTokens(Locale.fromOpts({locale:o,numberingSystem:c,defaultToEN:!0}),t,n),d=l[0],u=l[1],h=l[2];return h?e.invalid(h):parseDataToDateTime(d,u,i,"format "+n,t)},e.fromString=function(t,n,i){return void 0===i&&(i={}),e.fromFormat(t,n,i)},e.fromSQL=function(e,t){void 0===t&&(t={});var n=parseSQL(e);return parseDataToDateTime(n[0],n[1],t,"SQL",e)},e.invalid=function(t,n){if(void 0===n&&(n=null),!t)throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");var i=t instanceof Invalid?t:new Invalid(t,n);if(Settings.throwOnInvalid)throw new InvalidDateTimeError(i);return new e({invalid:i})},e.isDateTime=function(e){return e&&e.isLuxonDateTime||!1};var t=e.prototype;return t.get=function(e){return this[e]},t.resolvedLocaleOpts=function(e){void 0===e&&(e={});var t=Formatter.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t.locale,numberingSystem:t.numberingSystem,outputCalendar:t.calendar}},t.toUTC=function(e,t){return void 0===e&&(e=0),void 0===t&&(t={}),this.setZone(FixedOffsetZone.instance(e),t)},t.toLocal=function(){return this.setZone(Settings.defaultZone)},t.setZone=function(t,n){var i=void 0===n?{}:n,r=i.keepLocalTime,s=void 0!==r&&r,o=i.keepCalendarTime,a=void 0!==o&&o;if((t=normalizeZone(t,Settings.defaultZone)).equals(this.zone))return this;if(t.isValid){var c=this.ts;if(s||a){var l=t.offset(this.ts);c=objToTS(this.toObject(),l,t)[0]}return clone$1(this,{ts:c,zone:t})}return e.invalid(unsupportedZone(t))},t.reconfigure=function(e){var t=void 0===e?{}:e,n=t.locale,i=t.numberingSystem,r=t.outputCalendar;return clone$1(this,{loc:this.loc.clone({locale:n,numberingSystem:i,outputCalendar:r})})},t.setLocale=function(e){return this.reconfigure({locale:e})},t.set=function(e){if(!this.isValid)return this;var t,n=normalizeObject(e,normalizeUnit,[]),i=!isUndefined(n.weekYear)||!isUndefined(n.weekNumber)||!isUndefined(n.weekday),r=!isUndefined(n.ordinal),s=!isUndefined(n.year),o=!isUndefined(n.month)||!isUndefined(n.day),a=s||o,c=n.weekYear||n.weekNumber;if((a||r)&&c)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&r)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");i?t=weekToGregorian(Object.assign(gregorianToWeek(this.c),n)):isUndefined(n.ordinal)?(t=Object.assign(this.toObject(),n),isUndefined(n.day)&&(t.day=Math.min(daysInMonth(t.year,t.month),t.day))):t=ordinalToGregorian(Object.assign(gregorianToOrdinal(this.c),n));var l=objToTS(t,this.o,this.zone);return clone$1(this,{ts:l[0],o:l[1]})},t.plus=function(e){return this.isValid?clone$1(this,adjustTime(this,friendlyDuration(e))):this},t.minus=function(e){return this.isValid?clone$1(this,adjustTime(this,friendlyDuration(e).negate())):this},t.startOf=function(e){if(!this.isValid)return this;var t={},n=Duration.normalizeUnit(e);switch(n){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0}if("weeks"===n&&(t.weekday=1),"quarters"===n){var i=Math.ceil(this.month/3);t.month=3*(i-1)+1}return this.set(t)},t.endOf=function(e){var t;return this.isValid?this.plus((t={},t[e]=1,t)).startOf(e).minus(1):this},t.toFormat=function(e,t){return void 0===t&&(t={}),this.isValid?Formatter.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):INVALID$2},t.toLocaleString=function(e){return void 0===e&&(e=DATE_SHORT),this.isValid?Formatter.create(this.loc.clone(e),e).formatDateTime(this):INVALID$2},t.toLocaleParts=function(e){return void 0===e&&(e={}),this.isValid?Formatter.create(this.loc.clone(e),e).formatDateTimeParts(this):[]},t.toISO=function(e){return void 0===e&&(e={}),this.isValid?this.toISODate(e)+"T"+this.toISOTime(e):null},t.toISODate=function(e){var t=(void 0===e?{}:e).format,n="basic"===(void 0===t?"extended":t)?"yyyyMMdd":"yyyy-MM-dd";return this.year>9999&&(n="+"+n),toTechFormat(this,n)},t.toISOWeekDate=function(){return toTechFormat(this,"kkkk-'W'WW-c")},t.toISOTime=function(e){var t=void 0===e?{}:e,n=t.suppressMilliseconds,i=void 0!==n&&n,r=t.suppressSeconds,s=void 0!==r&&r,o=t.includeOffset,a=void 0===o||o,c=t.includePrefix,l=void 0!==c&&c,d=t.format;return toTechTimeFormat(this,{suppressSeconds:s,suppressMilliseconds:i,includeOffset:a,includePrefix:l,format:void 0===d?"extended":d})},t.toRFC2822=function(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)},t.toHTTP=function(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")},t.toSQLDate=function(){return toTechFormat(this,"yyyy-MM-dd")},t.toSQLTime=function(e){var t=void 0===e?{}:e,n=t.includeOffset,i=void 0===n||n,r=t.includeZone;return toTechTimeFormat(this,{includeOffset:i,includeZone:void 0!==r&&r,spaceZone:!0})},t.toSQL=function(e){return void 0===e&&(e={}),this.isValid?this.toSQLDate()+" "+this.toSQLTime(e):null},t.toString=function(){return this.isValid?this.toISO():INVALID$2},t.valueOf=function(){return this.toMillis()},t.toMillis=function(){return this.isValid?this.ts:NaN},t.toSeconds=function(){return this.isValid?this.ts/1e3:NaN},t.toJSON=function(){return this.toISO()},t.toBSON=function(){return this.toJSDate()},t.toObject=function(e){if(void 0===e&&(e={}),!this.isValid)return{};var t=Object.assign({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t},t.toJSDate=function(){return new Date(this.isValid?this.ts:NaN)},t.diff=function(e,t,n){if(void 0===t&&(t="milliseconds"),void 0===n&&(n={}),!this.isValid||!e.isValid)return Duration.invalid(this.invalid||e.invalid,"created by diffing an invalid DateTime");var i=Object.assign({locale:this.locale,numberingSystem:this.numberingSystem},n),r=maybeArray(t).map(Duration.normalizeUnit),s=e.valueOf()>this.valueOf(),o=_diff(s?this:e,s?e:this,r,i);return s?o.negate():o},t.diffNow=function(t,n){return void 0===t&&(t="milliseconds"),void 0===n&&(n={}),this.diff(e.now(),t,n)},t.until=function(e){return this.isValid?Interval.fromDateTimes(this,e):this},t.hasSame=function(e,t){if(!this.isValid)return!1;var n=e.valueOf(),i=this.setZone(e.zone,{keepLocalTime:!0});return i.startOf(t)<=n&&n<=i.endOf(t)},t.equals=function(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)},t.toRelative=function(t){if(void 0===t&&(t={}),!this.isValid)return null;var n=t.base||e.fromObject({zone:this.zone}),i=t.padding?this<n?-t.padding:t.padding:0,r=["years","months","days","hours","minutes","seconds"],s=t.unit;return Array.isArray(t.unit)&&(r=t.unit,s=void 0),diffRelative(n,this.plus(i),Object.assign(t,{numeric:"always",units:r,unit:s}))},t.toRelativeCalendar=function(t){return void 0===t&&(t={}),this.isValid?diffRelative(t.base||e.fromObject({zone:this.zone}),this,Object.assign(t,{numeric:"auto",units:["years","months","days"],calendary:!0})):null},e.min=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!n.every(e.isDateTime))throw new InvalidArgumentError("min requires all arguments be DateTimes");return bestBy(n,(function(e){return e.valueOf()}),Math.min)},e.max=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!n.every(e.isDateTime))throw new InvalidArgumentError("max requires all arguments be DateTimes");return bestBy(n,(function(e){return e.valueOf()}),Math.max)},e.fromFormatExplain=function(e,t,n){void 0===n&&(n={});var i=n,r=i.locale,s=void 0===r?null:r,o=i.numberingSystem,a=void 0===o?null:o;return explainFromTokens(Locale.fromOpts({locale:s,numberingSystem:a,defaultToEN:!0}),e,t)},e.fromStringExplain=function(t,n,i){return void 0===i&&(i={}),e.fromFormatExplain(t,n,i)},_createClass(e,[{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}},{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"outputCalendar",get:function(){return this.isValid?this.loc.outputCalendar:null}},{key:"zone",get:function(){return this._zone}},{key:"zoneName",get:function(){return this.isValid?this.zone.name:null}},{key:"year",get:function(){return this.isValid?this.c.year:NaN}},{key:"quarter",get:function(){return this.isValid?Math.ceil(this.c.month/3):NaN}},{key:"month",get:function(){return this.isValid?this.c.month:NaN}},{key:"day",get:function(){return this.isValid?this.c.day:NaN}},{key:"hour",get:function(){return this.isValid?this.c.hour:NaN}},{key:"minute",get:function(){return this.isValid?this.c.minute:NaN}},{key:"second",get:function(){return this.isValid?this.c.second:NaN}},{key:"millisecond",get:function(){return this.isValid?this.c.millisecond:NaN}},{key:"weekYear",get:function(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN}},{key:"weekNumber",get:function(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN}},{key:"weekday",get:function(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN}},{key:"ordinal",get:function(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN}},{key:"monthShort",get:function(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null}},{key:"monthLong",get:function(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null}},{key:"weekdayShort",get:function(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}},{key:"weekdayLong",get:function(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}},{key:"offset",get:function(){return this.isValid?+this.o:NaN}},{key:"offsetNameShort",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}},{key:"offsetNameLong",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}},{key:"isOffsetFixed",get:function(){return this.isValid?this.zone.universal:null}},{key:"isInDST",get:function(){return!this.isOffsetFixed&&(this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset)}},{key:"isInLeapYear",get:function(){return isLeapYear(this.year)}},{key:"daysInMonth",get:function(){return daysInMonth(this.year,this.month)}},{key:"daysInYear",get:function(){return this.isValid?daysInYear(this.year):NaN}},{key:"weeksInWeekYear",get:function(){return this.isValid?weeksInWeekYear(this.weekYear):NaN}}],[{key:"DATE_SHORT",get:function(){return DATE_SHORT}},{key:"DATE_MED",get:function(){return DATE_MED}},{key:"DATE_MED_WITH_WEEKDAY",get:function(){return DATE_MED_WITH_WEEKDAY}},{key:"DATE_FULL",get:function(){return DATE_FULL}},{key:"DATE_HUGE",get:function(){return DATE_HUGE}},{key:"TIME_SIMPLE",get:function(){return TIME_SIMPLE}},{key:"TIME_WITH_SECONDS",get:function(){return TIME_WITH_SECONDS}},{key:"TIME_WITH_SHORT_OFFSET",get:function(){return TIME_WITH_SHORT_OFFSET}},{key:"TIME_WITH_LONG_OFFSET",get:function(){return TIME_WITH_LONG_OFFSET}},{key:"TIME_24_SIMPLE",get:function(){return TIME_24_SIMPLE}},{key:"TIME_24_WITH_SECONDS",get:function(){return TIME_24_WITH_SECONDS}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function(){return TIME_24_WITH_SHORT_OFFSET}},{key:"TIME_24_WITH_LONG_OFFSET",get:function(){return TIME_24_WITH_LONG_OFFSET}},{key:"DATETIME_SHORT",get:function(){return DATETIME_SHORT}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function(){return DATETIME_SHORT_WITH_SECONDS}},{key:"DATETIME_MED",get:function(){return DATETIME_MED}},{key:"DATETIME_MED_WITH_SECONDS",get:function(){return DATETIME_MED_WITH_SECONDS}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function(){return DATETIME_MED_WITH_WEEKDAY}},{key:"DATETIME_FULL",get:function(){return DATETIME_FULL}},{key:"DATETIME_FULL_WITH_SECONDS",get:function(){return DATETIME_FULL_WITH_SECONDS}},{key:"DATETIME_HUGE",get:function(){return DATETIME_HUGE}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function(){return DATETIME_HUGE_WITH_SECONDS}}]),e}();function friendlyDateTime(e){if(DateTime.isDateTime(e))return e;if(e&&e.valueOf&&isNumber(e.valueOf()))return DateTime.fromJSDate(e);if(e&&"object"==typeof e)return DateTime.fromObject(e);throw new InvalidArgumentError("Unknown datetime argument: "+e+", of type "+typeof e)}var VERSION="1.28.1",DateTime_1=luxon.DateTime=DateTime;function getDateTimePeriodInfo(e,t){const n=DateTime_1.fromJSDate(e).setLocale(t),i=DateTime_1.local(),r=i.minus({days:1}).startOf("day");let s,o;return n.hasSame(i,"day")?(s=n.startOf("day").toJSDate(),o=n.toRelativeCalendar()):n.hasSame(r,"day")?(s=r.toJSDate(),o=n.toRelativeCalendar()):n.hasSame(i,"week")?(s=n.startOf("week").toJSDate(),o=n.weekdayLong||""):n.hasSame(i,"year")?(s=n.startOf("month").toJSDate(),o=n.monthLong||""):(s=n.startOf("year").toJSDate(),o=String(n.year)),{startDate:s,localizedPeriodName:o}}luxon.Duration=Duration,luxon.FixedOffsetZone=FixedOffsetZone,luxon.IANAZone=IANAZone,luxon.Info=Info,luxon.Interval=Interval,luxon.InvalidZone=InvalidZone,luxon.LocalZone=LocalZone,luxon.Settings=Settings,luxon.VERSION=VERSION,luxon.Zone=Zone;class RevisionsSidebarTimePeriodView extends View{constructor(e,t,n,i){super(e);const r=getDateTimePeriodInfo(t,this.locale.uiLanguage).localizedPeriodName;this.startDate=t,this.revisionViews=this.createCollection(),this._revisionActions=n,this._requireRevisionName=i,this.revisionViews.delegate("select").to(this),this.revisionViews.delegate("setName").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period"]},children:[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__time-period__label"]},children:[{text:r}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period__revisions"]},children:this.revisionViews}]})}addRevision(e){const t=new RevisionView(this.locale,e,this._revisionActions,this._requireRevisionName);this.revisionViews.add(t)}removeRevision(e){const t=this.revisionViews.find((t=>t.id===e.id));this.revisionViews.remove(t)}}class RevisionsSidebarHeaderView extends View{constructor(e){super(e);const t=new IconView;t.content=_0x27b58d.history,this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all","ck-revision-history-sidebar__header"]},children:[t,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__header__label"]},children:[getTranslation$3(e,"Revision history")]}]})}}class RevisionsSidebarView extends View{constructor(e,t,n,i){super(e);const r=this.bindTemplate;this.timePeriodViews=this.createCollection(),this.timePeriodViews.delegate("select").to(this),this.timePeriodViews.delegate("setName").to(this),this._revisions=t,this._revisionActions=n,this._requireRevisionName=i,this.on("select",((e,t)=>{this.fire("revisionSelected",t)})),this.on("setName",((e,t)=>{this.fire("revisionSetName",t)})),this.set("isEnabled",!1),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-rounded-corners","ck-revision-history-sidebar"]},children:[new RevisionsSidebarHeaderView(e),{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__timeline",r.if("isEnabled","ck-disabled",(e=>!e))]},children:this.timePeriodViews}]})}render(){super.render();for(const e of this._revisions)this._addRevision(e);this._revisions.on("add",((e,t)=>{this._addRevision(t)})),this._revisions.on("remove",((e,t)=>{this._removeRevision(t)}))}get revisionViews(){return this.timePeriodViews.map((e=>e.revisionViews.map((e=>e)))).flat()}selectRevision(e){for(const t of this.revisionViews)e&&e.id===t.id?t.select():t.deselect()}highlightRevisions(e){for(const t of this.revisionViews)e.some((({id:e})=>e===t.id))?t.highlight():t.unhighlight()}_addRevision(e){const t=getDateTimePeriodInfo(e.createdAt,this.locale.uiLanguage).startDate;let n=this.timePeriodViews.get(0);n&&n.startDate.getTime()===t.getTime()||(n=new RevisionsSidebarTimePeriodView(this.locale,t,this._revisionActions,this._requireRevisionName),this.timePeriodViews.add(n)),n.addRevision(e)}_removeRevision(e){const t=getDateTimePeriodInfo(e.createdAt,this.locale.uiLanguage).startDate;this._getTimePeriodViewByStartDate(t).removeRevision(e)}_getTimePeriodViewByStartDate(e){return this.timePeriodViews.find((t=>t.startDate.getTime()===e.getTime()))}}class RevisionsSidebar extends Plugin{static get pluginName(){return"RevisionsSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionViewer]}constructor(e){super(e),this._revisionViewer=e.plugins.get(RevisionViewer),this._revisionsRepository=this._revisionViewer.repository,this._sidebarView=null}init(){const e=this._revisionsRepository._revisions,t=this._createRevisionActions(),n=this.editor.config.get("revisionHistory.viewerSidebarContainer");this._sidebarView=new RevisionsSidebarView(this.editor.locale,e,t,this.editor.config.get("revisionHistory.requireRevisionName")),this._sidebarView.on("revisionSelected",this._handleRevisionSelected.bind(this)),this._sidebarView.on("revisionSetName",this._handleRevisionSetName.bind(this)),this._sidebarView.bind("isEnabled").to(this._revisionViewer),this._sidebarView.timePeriodViews.on("add",((e,t)=>{t.revisionViews.on("add",((e,t)=>{t.bind("isEnabled","isReady").to(this._revisionViewer)}))})),this._sidebarView.render(),this.listenTo(this.editor.data,"ready",this._handleEditorDataReady.bind(this)),this.listenTo(this._revisionViewer,"change:diff",this._handleDiffChange.bind(this)),n.appendChild(this._sidebarView.element)}destroy(){this._sidebarView.element.remove(),this._sidebarView.destroy()}_handleEditorDataReady(){const e=this._revisionsRepository.getRevision(0);if(e){const t=this._revisionsRepository.getEarlierVisibleRevision(e.id);this._revisionViewer.compare(e,t)}}_handleRevisionSelected(e,t){const n=this._revisionsRepository.getRevision(t.id),i=this._revisionsRepository.getEarlierVisibleRevision(n.id);this._revisionViewer.compare(n,i)}_handleRevisionSetName(e,t){this._revisionsRepository.getRevision(t.id).setName(t.name)}_handleDiffChange(e,t,n){const i=this._revisionsRepository.getRevisionsInDiff(n);i.length>2?(this._sidebarView.highlightRevisions(i),this._sidebarView.selectRevision(null)):(this._sidebarView.highlightRevisions([]),this._sidebarView.selectRevision(i[0]))}_createRevisionActions(){const e=this.editor,t=RevisionsSidebar.availableRevisionActions,n=e.config.get("revisionHistory.revisionActions")||RevisionsSidebar.defaultRevisionActions;if(n.length)return n.map((n=>{const i="string"==typeof n?Object.assign({},t[n]):n;return i.action=i.action.bind(this,e),i.isVisible&&(i.isVisible=i.isVisible.bind(this,e)),i}))}}function availableRevisionActions(){return{compareAgainstSelected:{name:"Compare against selected",action:({plugins:e},t)=>{const n=e.get(RevisionViewer),i=n.repository;let r=n.diff.newRevisionId,s=t.id;i.getIndex(r)>i.getIndex(s)&&([r,s]=[s,r]),n.compare(r,s)},isVisible:({plugins:e},t)=>{const n=e.get(RevisionViewer);return!(n.repository.getRevisionsInDiff(n.diff).length>2||t.isSelected)}},restoreRevision:{name:"Restore this revision",action:(e,{id:t})=>{e.config.get("revisionHistory").restoreRevisionCallback(t)},isVisible:({plugins:e},t)=>!!e.get(RevisionViewer).repository.getLaterVisibleRevision(t.id)},nameRevision:{name:"Name this revision",action:({plugins:e},{id:t,revisionNameView:n})=>{const i=e.get(RevisionViewer),r=i.repository.getEarlierVisibleRevision(t);i.compare(t,r),n.focus(),n.fieldView.select()}}}}RevisionsSidebar.defaultRevisionActions=["compareAgainstSelected","restoreRevision","nameRevision"],RevisionsSidebar.availableRevisionActions=availableRevisionActions();class RevisionViewerEditorUI extends EditorUI{get view(){return this._view}constructor(e,t){super(e),this._view=t,this._toolbarConfig=normalizeToolbarConfig(e.config.get("toolbar")),this._elementReplacer=new ElementReplacer}get element(){return this.view.element}init(e){const t=this.editor,n=this.view,i=t.editing.view,r=n.editable,s=i.document.getRoot();r.name=s.rootName,n.render();const o=r.element;this.setEditableElement(r.name,o),n.editable.bind("isFocused").to(this.focusTracker),i.attachDomRoot(o),this._elementReplacer.replace(e,this.element),this._initToolbar(),this.fire("ready")}destroy(){super.destroy();const e=this.view,t=this.editor.editing.view;this._elementReplacer.restore(),t.detachDomRoot(e.editable.name),e.destroy()}_initToolbar(){const e=this.view;e.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),e.stickyPanel.limiterElement=e.element,e.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",(({top:e})=>e)),e.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(e.toolbar)}}class RevisionViewerEditorUIView extends BoxedEditorUIView{get editable(){return this._editable}constructor(e,t,n={}){super(e),this.stickyPanel=new StickyPanelView(e),this.toolbar=new ToolbarView(e,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull}),this._editable=new InlineEditableUIView(e,t)}render(){super.render(),this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}class RevisionViewerEditor extends(/*   -- @preserve */
ElementApiMixin(Editor)){get ui(){return this._ui}constructor(e,t){super(t),this.sourceElement=e,this.model.document.createRoot();const n=new RevisionViewerEditorUIView(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:!0});this._ui=new RevisionViewerEditorUI(this,n)}destroy(){return this.updateSourceElement(),this.ui.destroy(),super.destroy()}static async create(e,t){const n=new this(e,t);return await n.initPlugins(),await n.ui.init(e),await n.data.init(n.config.get("initialData")||""),n.fire("ready"),n}}const blackListedPlugins$1=["RevisionHistoryUI","RestrictedEditingMode"];class RevisionViewerIntegration extends Plugin{static get pluginName(){return"RevisionViewerIntegration"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}super(e),this.result="end",e[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),e[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}}class RevisionHistory extends Plugin{static get pluginName(){return"RevisionHistory"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionTracker,RevisionHistoryUI]}constructor(e){if(super(e),!this.editor.config.get("revisionHistory"))throw new CKEditorError("revision-history-missing-configuration",this);this._viewerEditor=null,this.editor.config.define("revisionHistory.showRevisionViewerCallback",(e=>this._showRevisionViewer({...e,translations:this.editor.locale.translations}))),this.editor.config.define("revisionHistory.closeRevisionViewerCallback",(e=>this._closeRevisionViewer(e))),this.editor.config.define("revisionHistory.restoreRevisionCallback",(e=>this._restoreRevision(e))),this.editor.config.define("revisionHistory.requireRevisionName",!1),this._enhanceShowRevisionViewerCallback(),this._enhanceCloseRevisionViewerCallback()}set adapter(e){this.editor.plugins.get("RevisionTracker").adapter=e}get adapter(){return this.editor.plugins.get("RevisionTracker").adapter}addRevisionData(e){return this.editor.plugins.get("RevisionTracker").addRevisionData(e)}getRevision(e){return this.editor.plugins.get("RevisionsRepository").getRevision(e)}getRevisions(e){return this.editor.plugins.get("RevisionsRepository").getRevisions(e||{toJSON:!1})}_getRevisionViewerEditorConfig(){const e=this.editor,t=sanitizeEditorConfig(e,blackListedPlugins$1),n=e.plugins.get("RevisionTracker"),i=e.plugins.get("Users").users;return t.toolbar=["exitToEditing","restoreRevision","changesNavigation"],delete t.lazyRoots,t.plugins.push(RevisionViewerIntegration,RevisionViewer,RevisionViewerUI,class extends Plugin{static get requires(){return[RevisionViewer,"Users"]}init(){const t=this.editor.plugins.get("Users");for(const e of i)e.isAnonymous||t.getUser(e.id)||t.addUser(e);const r=n.repository.getRevisions();let s=null;const o=this.editor.plugins.get("RevisionViewer");o.adapter=n.adapter,o.bind("isEnabled").to(n),this.editor.commands.get("restoreRevision").bind("isEnabled").to(e,"isReadOnly",(e=>!e));for(const e of r){const t=null===e.creator;if(t&&e.toVersion===e.fromVersion)continue;const i=e.toJSON();o.addRevisionData(i,((i,r,o)=>{if(t){if(s)s._update(i,r);else if(!r){const e=o.toJSON();e.id=uid(),n.saveRevision(e,o.toVersion).then((e=>{s=e}))}}else e._update(i,r)}))}}},RevisionsSidebar),t}_enhanceShowRevisionViewerCallback(){const e=this.editor.config.get("revisionHistory").showRevisionViewerCallback;this.editor.config.set("revisionHistory.showRevisionViewerCallback",(async()=>{this.editor.enableReadOnlyMode("revision-history-viewer-opened");const t=this.editor.plugins.get("RevisionTracker");if(this.editor.plugins.has("Autosave")){const e=this.editor.plugins.get("Autosave");await e.save()}else await t.update();if(this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this.editor.plugins.has("Dialog")){const e=this.editor.plugins.get("Dialog");e.isOpen&&e.hide()}const n=this._getRevisionViewerEditorConfig();return e(n).then((e=>(this._viewerEditor=e,this.editor.plugins.has("Annotations")&&this.editor.plugins.get("Annotations").refreshVisibility(),e))).catch((e=>(console.error(e),this.editor.disableReadOnlyMode("revision-history-viewer-opened"),null)))}))}_enhanceCloseRevisionViewerCallback(){const e=this.editor.config.get("revisionHistory").closeRevisionViewerCallback;this.editor.config.set("revisionHistory.closeRevisionViewerCallback",(()=>(this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this._viewerEditor.plugins.get("RevisionViewer")._cleanUp(),e(this._viewerEditor).then((()=>{if(this.editor.disableReadOnlyMode("revision-history-viewer-opened"),this._viewerEditor=null,this.editor.plugins.has("Annotations")){const e=this.editor.plugins.get("Annotations");e.refreshVisibility(),e.refreshPositioning()}})))))}_showRevisionViewer(e){const t=this.editor.config.get("revisionHistory.editorContainer"),n=this.editor.config.get("revisionHistory.viewerContainer"),i=this.editor.config.get("revisionHistory.viewerEditorElement");return RevisionViewerEditor.create(i,e).then((e=>(n.style.display="block",t.style.display="none",e)))}_closeRevisionViewer(e){const t=this.editor.config.get("revisionHistory.editorContainer");return this.editor.config.get("revisionHistory.viewerContainer").style.display="none",t.style.display="",e.destroy()}async _restoreRevision(e){const t=this.editor,n=this._viewerEditor.plugins.get("RevisionViewer"),i=t.plugins.get("RevisionTracker"),r=n.repository.getRevision(e);let s,o,a;try{s=await n.getRevisionData(r),o=await n.getRevisionRootsAttributes(r)}catch(e){return void console.error(e)}t.model.change((e=>{for(const n of Array.from(t.model.markers.getMarkersGroup("restrictedEditingException")))e.removeMarker(n)})),n.isReady=!1,t.model.enqueueChange((e=>{e.setSelection(null),e.removeSelectionAttribute(t.model.document.selection.getAttributeKeys());const n=Object.keys(s);for(const i of t.model.document.roots)"$graveyard"!=i.rootName&&i.isAttached()&&!n.includes(i.rootName)&&e.detachRoot(i);for(const i of n){let n=t.model.document.getRoot(i);n&&n.isAttached()||(n=e.addRoot(i));const r=o[i],a=Object.keys(r),c=s[i];for(const t of n.getAttributeKeys())a.includes(t)||e.removeAttribute(t,n);for(const t of a)e.setAttribute(t,o[i][t],n);e.remove(e.createRangeIn(n)),e.insert(t.data.parse(c,n),n,0)}}));const c=getTranslation$3(t.locale,"Restored");return a=r.name?-1==r.name.indexOf(c)?c+": "+r.name:r.name:c+": "+r.createdAt.toLocaleDateString(t.locale.uiLanguage,{month:"long",day:"numeric"})+", "+r.createdAt.toLocaleTimeString(t.locale.uiLanguage,{hour:"numeric",minute:"numeric"}),await i.saveRevision({name:a}),n.isReady=!0,t.config.get("revisionHistory").closeRevisionViewerCallback()}}function getTranslation$2(e,t){const n=e.t,i=e.t;switch(t){case"AI Assistant":return i("AI Assistant");case"Block quote":return i("Block quote");case"Bulleted list":return i("Bulleted list");case"Insert code block":return i("Insert code block");case"Open file manager":return i("Open file manager");case"Insert image":return i("Insert image");case"Heading 1":return i("Heading 1");case"Heading 2":return i("Heading 2");case"Heading 3":return i("Heading 3");case"Heading 4":return i("Heading 4");case"Heading 5":return i("Heading 5");case"Heading 6":return i("Heading 6");case"Horizontal line":return i("Horizontal line");case"Insert HTML":return i("Insert HTML");case"Increase indent":return i("Increase indent");case"Insert table":return i("Insert table");case"Table of contents":return i("Table of contents");case"Numbered list":return i("Numbered list");case"Decrease indent":return i("Decrease indent");case"Paragraph":return i("Paragraph");case"To-do list":return i("To-do list");case"Create a block quote":return n("Create a block quote");case"Create a bulleted list":return n("Create a bulleted list");case"Create a code block":return n("Create a code block");case"Open file manager to insert an image or a file":return n("Open file manager to insert an image or a file");case"Open file browser to insert an image or a file":return n("Open file browser to insert an image or a file");case"Create a heading level 1":return n("Create a heading level 1");case"Create a heading level 2":return n("Create a heading level 2");case"Create a heading level 3":return n("Create a heading level 3");case"Create a heading level 4":return n("Create a heading level 4");case"Create a heading level 5":return n("Create a heading level 5");case"Create a heading level 6":return n("Create a heading level 6");case"Insert a horizontal line":return n("Insert a horizontal line");case"Insert an HTML snippet":return n("Insert an HTML snippet");case"Increase the indentation":return n("Increase the indentation");case"Insert Mermaid diagram":return n("Insert Mermaid diagram");case"Insert the Mermaid diagram":return n("Insert the Mermaid diagram");case"Create a table":return n("Create a table");case"Insert table of contents":return n("Insert table of contents");case"Create a numbered list":return n("Create a numbered list");case"Decrease the indentation":return n("Decrease the indentation");case"Insert a paragraph":return n("Insert a paragraph");case"Create a to-do list":return n("Create a to-do list");case"Open the AI Assistant to generate content":return n("Open the AI Assistant to generate content");default:return t}}class SlashCommandConfig extends Plugin{static get pluginName(){return"SlashCommandConfig"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._allowedCommands=null}afterInit(){const e=this.editor.config.get("slashCommand.removeCommands")||[],t=getExcludedHeadings(this.editor.config.get("heading.options"));let n=this.getDefaultCommands().filter((e=>!t.includes(e.id))).filter((t=>!e.includes(t.commandName)));const i=this.editor.config.get("slashCommand.extraCommands");i&&i.length&&(n=n.concat(i));const r=this.editor.config.get("template.definitions");r&&r.length&&(n=n.concat(mapTemplates(r)));const s=this.editor.config.get("style.definitions");s&&s.length&&(n=n.concat(mapStyles(s)));const o=n.filter((e=>!e.commandName||void 0!==this.editor.commands.get(e.commandName))),a=[];for(const e of o)a.push({id:e.id,commandName:e.commandName,title:"function"==typeof e.title?e.title(this.editor):e.title,description:e.description,icon:e.icon,isIconColorInherited:e.isIconColorInherited,aliases:e.aliases,isEnabled:()=>this._proxyIsEnabled(e),execute:()=>this._proxyExecute(e)});this._allowedCommands=a.sort(compareCommands),checkLicense$2(this)}getAllowedCommands(){return this._allowedCommands}getDefaultCommands(){const e=e=>getTranslation$2(this.editor.locale,e);return[{id:"aiAssistant",commandName:"showAIAssistant",icon:icons.robotPencil,title:e("AI Assistant"),description:e("Open the AI Assistant to generate content"),execute:e=>{setTimeout((()=>e.execute("showAIAssistant")))}},{id:"blockQuote",commandName:"blockQuote",icon:_0x27b58d.quote,title:e("Block quote"),description:e("Create a block quote")},{id:"bulletedList",commandName:"bulletedList",icon:_0x27b58d.bulletedList,title:e("Bulleted list"),description:e("Create a bulleted list")},{id:"codeBlock",commandName:"codeBlock",icon:_0x27b58d.codeBlock,title:e("Insert code block"),description:e("Create a code block")},{id:"ckbox",commandName:"ckbox",icon:_0x27b58d.browseFiles,title:e("Open file manager"),description:e("Open file manager to insert an image or a file"),aliases:["ckfinder","filemanager","upload"]},{id:"ckfinder",commandName:"ckfinder",icon:_0x27b58d.browseFiles,title:e("Insert image"),description:e("Open file browser to insert an image or a file"),aliases:["ckbox","filemanager","upload"]},{id:"heading1",commandName:"heading",icon:_0x27b58d.heading1,title:e("Heading 1"),description:e("Create a heading level 1"),execute:e=>{e.execute("heading",{value:"heading1"})}},{id:"heading2",commandName:"heading",icon:_0x27b58d.heading2,title:e("Heading 2"),description:e("Create a heading level 2"),execute:e=>{e.execute("heading",{value:"heading2"})}},{id:"heading3",commandName:"heading",icon:_0x27b58d.heading3,title:e("Heading 3"),description:e("Create a heading level 3"),execute:e=>{e.execute("heading",{value:"heading3"})}},{id:"heading4",commandName:"heading",icon:_0x27b58d.heading4,title:e("Heading 4"),description:e("Create a heading level 4"),execute:e=>{e.execute("heading",{value:"heading4"})}},{id:"heading5",commandName:"heading",icon:_0x27b58d.heading5,title:e("Heading 5"),description:e("Create a heading level 5"),execute:e=>{e.execute("heading",{value:"heading5"})}},{id:"heading6",commandName:"heading",icon:_0x27b58d.heading6,title:e("Heading 6"),description:e("Create a heading level 6"),execute:e=>{e.execute("heading",{value:"heading6"})}},{id:"horizontalLine",commandName:"horizontalLine",icon:_0x27b58d.horizontalLine,title:e("Horizontal line"),description:e("Insert a horizontal line")},{id:"htmlEmbed",commandName:"htmlEmbed",icon:_0x27b58d.html,title:e("Insert HTML"),description:e("Insert an HTML snippet")},{id:"indent",commandName:"indent",icon:_0x27b58d.indent,title:e("Increase indent"),description:e("Increase the indentation")},{id:"insertMermaidCommand",commandName:"insertMermaidCommand",title:e("Insert Mermaid diagram"),description:e("Insert the Mermaid diagram")},{id:"insertTable",commandName:"insertTable",icon:_0x27b58d.table,title:e("Insert table"),description:e("Create a table")},{id:"insertTableOfContents",commandName:"insertTableOfContents",icon:icons.tableOfContents,title:e("Table of contents"),description:e("Insert table of contents"),aliases:["toc"]},{id:"numberedList",commandName:"numberedList",icon:_0x27b58d.numberedList,title:e("Numbered list"),description:e("Create a numbered list")},{id:"outdent",commandName:"outdent",icon:_0x27b58d.outdent,title:e("Decrease indent"),description:e("Decrease the indentation")},{id:"paragraph",commandName:"paragraph",icon:_0x27b58d.paragraph,title:e("Paragraph"),description:e("Insert a paragraph")},{id:"todoList",commandName:"todoList",icon:_0x27b58d.todoList,title:e("To-do list"),description:e("Create a to-do list")}]}_proxyIsEnabled(e){return e.isEnabled?e.isEnabled(this.editor):!e.commandName||this.editor.commands.get(e.commandName).isEnabled}_proxyExecute(e){if(e.execute)e.execute(this.editor);else{if(!e.commandName)throw new CKEditorError("slash-command-execute-missing",this.editor,{commandDefinition:e});this.editor.execute(e.commandName)}}}function compareCommands(e,t){return e.title<t.title?-1:e.title>t.title?1:0}function convertTitleToId(e,t){return t+"-"+e.toLowerCase().split(" ").join("-")}function mapTemplates(e){return e.map((e=>{const{title:t,icon:n,description:i,data:r}=e,s={id:convertTitleToId(t,"template"),commandName:"insertTemplate",execute:e=>{e.execute("insertTemplate",r)},description:i,icon:n,title:t};return n&&(s.isIconColorInherited=!1),s}))}function mapStyles(e){return e.map((e=>({id:convertTitleToId(e.name,"style"),commandName:"style",execute:t=>{t.execute("style",{styleName:e.name})},isEnabled:t=>{const n=t.commands.get("style");return n.isEnabled&&n.enabledStyles.includes(e.name)},title:e.name})))}function getExcludedHeadings(e){let t=["heading4","heading5","heading6"];if(e){const n=e.map((e=>e.model));t=["heading1","heading2","heading3","heading4","heading5","heading6"].filter((e=>!n.includes(e)))}return t}async function checkLicense$2(e){const t=g([70,89,121,115,122,80,73,90,111,103,67,75,108,69,105,81,72,53,76,77,118,48,98,71,102,78,99,101,117,97,119,104,65,110,84,57,55,52,112,83,85,56,74,86,50,66,68,49,113,54,82,51,88,106,87,100,109,107,79,120,114,116]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU3Mjg3ODB9.eyJqdGkiOjg2MDg1ODY1MzAsImFsZyI6IkVTMjU2IiwiaWR4Ijo1NTAxNzcyMjgxMjUyLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiI5MTA5NGQ1ZC0yNjQzLTQ5MTUtYTYxNi1jNWNjYWIzNDM5MDYiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NzI4NzgwLCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTcyOH0.P36BYNWB-_CDayIyM-ogkt-XGo4v1awV-dvak9UpkzHcTr61-ruhttG97sT620v2iw_PWfAilvqIPoPzFG7-ZA"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([70]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([83,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class SlashCommandEditing extends Plugin{static get pluginName(){return"SlashCommandEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[SlashCommandConfig]}getMatchingCommands(e){const t=e&&e.toLowerCase();let n=this.editor.plugins.get("SlashCommandConfig").getAllowedCommands();if(n=n.filter((e=>e.isEnabled())),t){const e=[],i=[],r=[],s=[];for(const o of n)o.id.toLowerCase().includes(t)?e.push(o):o.title.toLowerCase().includes(t)?i.push(o):o.aliases&&o.aliases.some((e=>e.toLowerCase().includes(t)))?r.push(o):o.description&&o.description.toLowerCase().includes(t)&&s.push(o);n=e.concat(i,r,s)}return n}}var defaultIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M10 19a9 9 0 1 0 0-18 9 9 0 0 0 0 18Zm3.45-9.872a1 1 0 0 1 0 1.744l-4.96 2.79A1 1 0 0 1 7 12.79V7.21a1 1 0 0 1 1.49-.872l4.96 2.79Z"/></svg>';class SlashCommandButtonView extends ButtonView{constructor(e,t){super(e),this.textPartView=this._createTextPartView(e,t),void 0!==t.isIconColorInherited&&(this.iconView.isColorInherited=t.isIconColorInherited),this.set({icon:t.icon||defaultIcon,withText:!0,label:t.title,class:"ck-slash-command-button"})}render(){super.render(),this.children.add(this.textPartView)}_createTextPartView(e,t){const n=new View(e);return n.setTemplate({tag:"div",attributes:{class:["ck","ck-slash-command-button__text-part"]},children:t.description?[this.labelView,{tag:"span",attributes:{class:["ck","ck-slash-command-button__description"]},children:[{text:t.description}]}]:[this.labelView]}),n}}class SlashCommandUI extends Plugin{static get pluginName(){return"SlashCommandUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._setupMentionConfiguration()}init(){this.editor.once("ready",this._overrideMentionExecuteListener.bind(this)),this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("slashCommandLicenseKeyValid"==r||"slashCommandLicenseKeyInvalid"==r||"slashCommandLicenseKeyExpired"==r||"slashCommandLicenseKeyDomainLimit"==r||"slashCommandLicenseKeyNotAllowed"==r||"slashCommandLicenseKeyEvaluationLimit"==r||"slashCommandLicenseKeyTrialLimit"==r||"slashCommandLicenseKeyDevelopmentLimit"==r||"slashCommandLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"slashCommandLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"slashCommandLicenseKeyExpired"==t&&e._showLicenseError("expired"),"slashCommandLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"slashCommandLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","SlashCommand"),"slashCommandLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"slashCommandLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"slashCommandLicenseKeyDevelopmentLimit"==t&&e._showLicenseError("developmentLimit"),"slashCommandLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_setupMentionConfiguration(){const e=this.editor,t=this.editor.plugins.get("SlashCommandEditing"),n=e.config.get("mention.feeds");n.push({marker:"/",feed:e=>t.getMatchingCommands(e),itemRenderer:this._customItemRenderer.bind(this),dropdownLimit:e.config.get("slashCommand.dropdownLimit")||1/0}),e.config.set("mention.feeds",n)}_overrideMentionExecuteListener(){const e=this.editor;e.commands.get("mention").on("execute",((t,n)=>{const i=n[0],r=e.model;"/"===i.marker&&r.change((e=>{e.remove(i.range),i.mention.execute(),t.stop()}))}),{priority:"high"})}_customItemRenderer(e){const t=this.editor.locale,n=new SlashCommandButtonView(t,e);return n.render(),n.element}}class SlashCommand extends Plugin{static get requires(){return["Mention",SlashCommandEditing,SlashCommandUI]}static get pluginName(){return"SlashCommand"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class TemplateCommand extends _0x354f99{execute(e){const{model:t}=this.editor;let n;switch(typeof e){case"string":n=e;break;case"function":n=e()}"string"==typeof n&&t.change((()=>{const e=this.editor.data.htmlProcessor.toView(n),i=this.editor.data.toModel(e);t.insertContent(i)}))}}class TemplateEditing extends Plugin{static get pluginName(){return"TemplateEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this;e.commands.add("insertTemplate",new TemplateCommand(e)),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("templateLicenseKeyValid"==r||"templateLicenseKeyInvalid"==r||"templateLicenseKeyExpired"==r||"templateLicenseKeyDomainLimit"==r||"templateLicenseKeyNotAllowed"==r||"templateLicenseKeyEvaluationLimit"==r||"templateLicenseKeyTrialLimit"==r||"templateLicenseKeyDevelopmentLimit"==r||"templateLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"templateLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"templateLicenseKeyExpired"==e&&t._showLicenseError("expired"),"templateLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"templateLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","Template"),"templateLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"templateLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"templateLicenseKeyDevelopmentLimit"==e&&t._showLicenseError("developmentLimit"),"templateLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TemplateListView extends ListView{filter(e){if(!e)return this._resetFiltering();const t=new Map,n=this.items.map((n=>{const i=n.buttonView.isMatching(e);return n.isVisible=!!i,n.buttonView.highlightText(i?e:null),i&&t.set(n,i),n})).sort(unsortListItemsCallback).sort(getSortListItemsCallback(t));return this.items.clear(),this.items.addMany(n),{resultsCount:t.size,totalItemsCount:this.items.length}}_resetFiltering(){const e=this.items.map((e=>e)).sort(unsortListItemsCallback);return e.forEach((e=>{e.isVisible=!0,e.buttonView.highlightText(null)})),this.items.clear(),this.items.addMany(e),{resultsCount:e.length,totalItemsCount:e.length}}}function getSortListItemsCallback(e){return function(t,n){const i=e.get(t),r=e.get(n);return i&&!r?-1:r&&!i?1:i||r?i.title&&!r.title?-1:!i.title&&r.title?1:0:0}}function unsortListItemsCallback(e,t){return e.originalIndex-t.originalIndex}class TemplateListItemView extends ListItemView{constructor(e,t){super(e),this.originalIndex=t,this.buttonView=null}}var templateDefaultIcon='<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45">\n  <path fill="#F0F0F0" d="M2 0h41s2 0 2 2v41s0 2 -2 2h-41s-2 0 -2 -2v-41s0 -2 2 -2" />\n  <path fill="#D5D5D5" d="M11 10h10s1 0 1 1v24s0 1 -1 1h-10s-1 0 -1 -1v-24s0 -1 1 -1" />\n  <path fill="#D5D5D5" d="M25 10h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />\n  <path fill="#D5D5D5" d="M25 24h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />\n</svg>\n';class TemplateListButtonView extends ButtonView{constructor(e,t){super(e),this.templateDefinition=t,this.textPartView=null;const{icon:n=templateDefaultIcon}=t;this.set({withText:!0,class:"ck-template-button",role:"option",icon:n}),this.iconView.isColorInherited=!1}render(){super.render(),this.textPartView=new TextPartView(this.locale,this.templateDefinition,this.labelView.element.id),this.children.remove(this.labelView),this.children.add(this.textPartView)}destroy(){super.destroy(),this.labelView.destroy()}isMatching(e){const{title:t,description:n}=this.templateDefinition,i=!!t.match(e),r=!(!n||!n.match(e));return i||r?{title:i,description:r}:null}highlightText(e){this.textPartView.highlightText(e)}}class TextPartView extends View{constructor(e,t,n){super(e),this.title=t.title,this.description=t.description,this.titleView=new HighlightedTextView,this.titleView.text=this.title,this.titleView.extendTemplate({tag:"span",attributes:{class:["ck-button__label"],id:n}});const i=[this.titleView];this.description&&(this.descriptionView=new HighlightedTextView,this.descriptionView.text=this.description,this.descriptionView.extendTemplate({tag:"p",attributes:{class:["ck-template-form__description"]}}),i.push(this.descriptionView)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-template-form__text-part"]},children:i})}highlightText(e){this.titleView.highlightText(e),this.description&&this.descriptionView.highlightText(e)}}function getTranslation$1(e,t,...n){const i=e.t;switch(t){case'No templates were found matching "%0".':return i('No templates were found matching "%0".',...n);case"Please try a different phrase or check the spelling.":return i("Please try a different phrase or check the spelling.");case"No templates available.":return i("No templates available.");case"%0 templates found":return i("%0 templates found",...n);case"Search template":return i("Search template");case"Template":return i("Template");case"Insert template":return i("Insert template");default:return t}}class TemplateUI extends Plugin{static get pluginName(){return"TemplateUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this,t=e.config.get("template.definitions")||[];e.ui.componentFactory.add("insertTemplate",(n=>{const i=createDropdown(n),r=this._createTemplateListView(n,t),s=new SearchTextView(n,{filteredView:r,queryView:{label:getTranslation$1(n,"Search template")},class:"ck-template-form",infoView:{text:{notFound:{primary:e=>getTranslation$1(n,'No templates were found matching "%0".',e),secondary:getTranslation$1(n,"Please try a different phrase or check the spelling.")},noSearchableItems:{primary:getTranslation$1(n,"No templates available.")}}}}),o=e.commands.get("insertTemplate");return s.on("search",((t,i)=>{i.query&&i.query.length&&e.ui.ariaLiveAnnouncer.announce(getTranslation$1(n,"%0 templates found",i.resultsCount))})),i.bind("isEnabled").to(o),i.panelView.children.add(s),i.buttonView.set({label:getTranslation$1(n,"Insert template"),icon:icons.template,tooltip:!0}),i.on("change:isOpen",((e,t,n)=>{n||s.reset()})),i})),e.ui.componentFactory.add("menuBar:insertTemplate",(n=>{const i=e.commands.get("insertTemplate"),r=new MenuBarMenuView(n);r.buttonView.set({label:getTranslation$1(n,"Template"),icon:icons.template});const s=new MenuBarMenuListView(n);if(!t||!t.length){const t=new MenuBarMenuListItemView(n,r),i=new MenuBarMenuListItemButtonView(n);i.set({label:getTranslation$1(n,"No templates available.")}),i.delegate("execute").to(r),i.on("execute",(()=>{e.editing.view.focus()})),t.children.add(i),s.items.add(t)}for(const i of t){const t=new MenuBarMenuListItemView(n,r),o=new MenuBarMenuListItemButtonView(n);o.set({class:"ck-template-button",label:i.title,icon:i.icon||templateDefaultIcon}),o.delegate("execute").to(r),o.on("execute",(()=>{e.execute("insertTemplate",i.data),e.editing.view.focus()})),t.children.add(o),s.items.add(t)}return r.panelView.children.add(s),r.bind("isEnabled").to(i,"isEnabled"),r}))}afterInit(){checkLicense$1(this)}_createTemplateListView(e,t){const{editor:n}=this,i=new TemplateListView(e);return i.extendTemplate({attributes:{role:"listbox",class:["ck-template-list"]}}),i.items.addMany(t.map(((t,i)=>{const r=new TemplateListItemView(e,i),s=new TemplateListButtonView(e,t);return r.buttonView=s,r.children.add(s),r.buttonView.on("execute",(e=>{n.execute("insertTemplate",e.source.templateDefinition.data),n.editing.view.focus()})),r}))),i}}async function checkLicense$1(e){const t=g([115,65,75,72,73,70,78,86,66,97,57,119,117,114,74,103,49,90,102,113,100,71,101,84,53,50,107,82,69,68,122,88,108,112,111,56,118,76,79,52,67,80,81,120,99,77,104,89,121,48,105,109,116,87,55,98,83,106,51,54,110,85]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU3Njg2Njl9.eyJqdGkiOjUxNDY1Nzk4MTIsImFsZyI6IkVTMjU2IiwiaWR4IjozOTU5NDY3NDU2MzUzLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiIyMWY5MGI3My00NDM0LTRlOWYtOWNhMi02Y2M4MzhhMWQ2YzciLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1NzY4NjY5LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTc2OH0.CnyM3YNUjlouHzkWPTG0H4gLV3aOJzb6sdIgLJQ-97yWIb7Gm1gGNO2PzSh-g1L3KnYTwnmGbmJOqWyg-luJzQ"),o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function c(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](l(e)):null}function l(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([115]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](l(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const c=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([84,80,76]))||(!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))||!(!t[g([105,110,99,108,117,100,101,115])](g([68,82,85,80]))||!window[g([68,114,117,112,97,108])]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(g([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class Template extends Plugin{static get requires(){return[TemplateEditing,TemplateUI]}static get pluginName(){return"Template"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class TrackChangesCommand extends _0x354f99{constructor(e,t){super(e),this._enabledCommands=t,this.value=!1,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(){this.value=!this.value,this.value?this._disableUnsupportedCommands():this._enableCommands()}_disableUnsupportedCommands(){for(const e of this.editor.commands.commands())e.affectsData&&!this._enabledCommands.has(e)&&e.forceDisabled("TrackChangesCommand")}_enableCommands(){for(const e of this.editor.commands.commands())e.affectsData&&!this._enabledCommands.has(e)&&e.clearForceDisabled("TrackChangesCommand")}}class AcceptSuggestionCommand extends _0x354f99{constructor(e,t){super(e),this._suggestions=t,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-accept-suggestion-not-found",this);const n=t.getRanges();this.editor.model.canEditAt(n)&&this.editor.plugins.get("TrackChangesEditing").acceptSuggestion(t)}}class DiscardSuggestionCommand extends _0x354f99{constructor(e,t){super(e),this._suggestions=t,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-discard-suggestion-not-found",this);const n=t.getRanges();this.editor.model.canEditAt(n)&&this.editor.plugins.get("TrackChangesEditing").discardSuggestion(t)}}function renderDescription(e,t){let n="";return n+=e.split("*").map(((e,t)=>t%2!=0?'<span class="ck-suggestion-type">'+sanitize(e)+"</span>":sanitize(e))).join(""),t&&(n+='<span class="ck-suggestion-color" style="background-color: '+t.value+'" title="'+t.title+'"></span>'),n}function sanitize(e){const t=document.createElement("span");return t.innerText=e,t.innerHTML}function sortSuggestions(e){return e.sort(((e,t)=>"deletion"==e.type&&"deletion"!=t.type?-1:"deletion"!=e.type&&"deletion"==t.type?1:0))}function getSelectedSuggestions(e,t){const n=Array.from(e.getRanges()),i=new Set;for(const r of t)if(r.isInContent)for(const t of n)for(const n of r.getRanges())(t.isIntersecting(n)||e.isCollapsed&&!r.isMultiRange&&r.next&&n.end.isTouching(t.start))&&i.add(r);return i}function getRangesOfBlockGroups(e,t){let n,i=0;const r=[],s=t.schema;for(;i<e.length;){const o=e[i],a=e[i+1];n||(n=t.createPositionBefore(o)),areNeighbourBlocks(t,o,a)||(r.push(t.createRange(n,s.isObject(o)?t.createPositionAfter(o):t.createPositionAt(o,"end"))),n=null),i++}return r}function areNeighbourBlocks(e,t,n){if(!n)return!1;const i=e.createPositionAfter(t),r=e.createPositionBefore(n);return i.isTouching(r)}const MAX_SUGGESTION_ACTIONS_IN_BATCH=100;function executeCommandForSuggestions(e,t,n){for(;n.length;){const i=n.splice(0,MAX_SUGGESTION_ACTIONS_IN_BATCH);e.change((()=>{for(const e of i)e.isInContent&&t.execute(e.id)}))}}class ExecuteOnAllSuggestionsCommand extends _0x354f99{constructor(e,t,n){super(e),this._command=t,this._suggestions=n,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const e=Array.from(this._suggestions.values()).some((e=>e.isInContent));this.isEnabled=this._command.isEnabled&&e}execute(){const e=sortSuggestions(Array.from(this._suggestions.values()));for(const t of e){const e=t.getRanges();if(!this.editor.model.canEditAt(e))return}executeCommandForSuggestions(this.editor.model,this._command,e)}}class ExecuteOnSelectedSuggestionsCommand extends _0x354f99{constructor(e,t,n){super(e),this._command=t,this._suggestions=n,this._selectedSuggestions=new Set,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const e=this.editor.model.document.selection,t=Array.from(this._suggestions.values());this._selectedSuggestions=getSelectedSuggestions(e,t),this.isEnabled=this._command.isEnabled&&!!this._selectedSuggestions.size}execute(){const e=sortSuggestions(Array.from(this._selectedSuggestions));for(const t of e){const e=t.getRanges();if(!this.editor.model.canEditAt(e))return}executeCommandForSuggestions(this.editor.model,this._command,e)}}class Suggestion extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super(),this._isDataLoaded=!1,this.id=t.id,this.type=t.type,this.subType=t.subType||null,this.author=t.author,this.creator=t.creator||t.author,this.isExternal=Boolean(t.attributes&&t.attributes["@external"]),this.data=null,this._model=e,this._onAccept=t.onAccept,this._onDiscard=t.onDiscard,this._onAttributesChange=t.onAttributesChange,this._markerNames=new Set,this.createdAt=null,this.set("authoredAt",null),this.set("attributes",t.attributes||{}),this.set("previous",null),this.set("next",null),this.set("commentThread",null),this.set("_saved",!1),this.decorate("accept"),this.decorate("discard")}get head(){let e=this;for(;e.previous;)e=e.previous;return e}get hasComments(){return!!this.commentThread&&this.commentThread.length>0}get isMultiRange(){return 0!=this._markerNames.size&&6==Array.from(this._markerNames)[0].split(":").length}get isInContent(){return null!==this.getFirstMarker()}addMarkerName(e){this._markerNames.add(e)}getMarkerNames(){return Array.from(this._markerNames)}getMarkers(){return this.getMarkerNames().map((e=>this._model.markers.get(e))).filter((e=>e))}getFirstMarker(){return this.getMarkers()[0]||null}removeMarkers(){this._model.change((e=>{for(const t of this.getMarkers())e.removeMarker(t)})),this._markerNames.clear()}removeMarker(e){this._model.change((t=>{t.removeMarker(e)})),this._markerNames.delete(e)}addRange(e){const t="suggestion:"+this.type+":"+this.subType+":"+this.id+":"+this.creator.id+":"+Suggestion.getMultiRangeId();this.addMarkerName(t),this._model.change((n=>{n.addMarker(t,{range:e,usingOperation:!0,affectsData:!0})}))}isIntersectingWithRange(e){for(const t of this.getRanges())if(t.isIntersecting(e))return!0;return!1}getRanges(){return this.getMarkers().map((e=>e.getRange()))}getItems(){return this.getRanges().reduce(((e,t)=>[...e,...t.getItems()]),[])}getFirstRange(){var e;return(null===(e=this.getFirstMarker())||void 0===e?void 0:e.getRange())||null}getContainedElement(){const e=this.getRanges();if(1!=e.length)return null;const t=e[0],n=t.start.nodeAfter,i=t.end.nodeBefore;return n instanceof Element?n!=i?null:n:null}accept(){this._onAccept(this.getRanges(),this.data,this.attributes),this.removeMarkers()}discard(){this._onDiscard(this.getRanges(),this.data,this.attributes),this.removeMarkers()}getAllAdjacentSuggestions(){const e=[];let t=this.head;for(;t;)e.push(t),t=t.next;return e}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),isEqual(n,this.attributes)||(this.attributes=n,this._onAttributesChange(n))}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),isEqual(t,this.attributes)||(this.attributes=t,this._onAttributesChange(this.attributes))}toJSON(){return{id:this.id,type:this.subType?this.type+":"+this.subType:this.type,authorId:this.creator.id,createdAt:this.createdAt,hasComments:this.hasComments,data:this.data,attributes:this.attributes}}static getMultiRangeId(){return uid().substr(1,5)}}function getTranslation(e,t,n){const i=e.t,r=e.t;switch(t){case"Track changes":return r("Track changes");case"Accept suggestion":return r("Accept suggestion");case"Discard suggestion":return r("Discard suggestion");case"Accept all suggestions":return r("Accept all suggestions");case"Accept all selected suggestions":return r("Accept all selected suggestions");case"Discard all suggestions":return r("Discard all suggestions");case"Discard all selected suggestions":return r("Discard all selected suggestions");case"*Reset font size*":return r("*Reset font size*");case"*Reset font family*":return r("*Reset font family*");case"*Reset font color*":return r("*Reset font color*");case"*Reset font background color*":return r("*Reset font background color*");case"*Remove image text alternative*":return r("*Remove image text alternative*");case"*Reset image width*":return r("*Reset image width*");case"*Remove link*":return r("*Remove link*");case"*Check item*":return r("*Check item*");case"*Uncheck item*":return r("*Uncheck item*");case"*Remove all formatting*":return r("*Remove all formatting*");case"*Replace table cells*":return r("*Replace table cells*");case"*Merge cells*":return r("*Merge cells*");case"*Split cell:* vertically":return r("*Split cell:* vertically");case"*Split cell:* horizontally":return r("*Split cell:* horizontally");case"*Indent:* %0":return r("*Indent:* %0",n);case"*Outdent:* %0":return r("*Outdent:* %0",n);case"*Change to:* %0":return r("*Change to:* %0",n);case"*Insert:* %0":return r("*Insert:* %0",n);case"*Format:* %0":return r("*Format:* %0",n);case"*Format:* change table properties":return r("*Format:* change table properties");case"*Format:* change table cell properties":return r("*Format:* change table cell properties");case"*Format:* insert into %0":return r("*Format:* insert into %0",n);case"*Format:* remove from %0":return r("*Format:* remove from %0",n);case"*Replace image URL*":return r("*Replace image URL*");case"*Format:* resize table":return r("*Format:* resize table");case"*Format:* set order to reversed":return r("*Format:* set order to reversed");case"*Format:* set order to regular":return r("*Format:* set order to regular");case"*Format:* set start index to %0":return r("*Format:* set start index to %0",n);case"*Change %0 content*":return r("*Change %0 content*",n);case"*Remove:* %0":return r("*Remove:* %0",n);case"*Merge:* %0":return r("*Merge:* %0",n);case"*Split:* %0":return r("*Split:* %0",n);case"*Remove format:* %0":return r("*Remove format:* %0",n);case"*Set bookmark:* %0":return r("*Set bookmark:* %0",n);case"*Set font size:* %0":return r("*Set font size:* %0",n);case"*Set font family:* %0":return r("*Set font family:* %0",n);case"*Set format to:* %0":return r("*Set format to:* %0",n);case"*Set font color:* %0":return r("*Set font color:* %0",n);case"*Set font background color:* %0":return r("*Set font background color:* %0",n);case"*Set format:* %0":return r("*Set format:* %0",n);case"*Set image text alternative:* %0":return r("*Set image text alternative:* %0",n);case"*Set image width:* %0":return r("*Set image width:* %0",n);case"*Set link:* %0":return r("*Set link:* %0",n);case"*Set highlight:* %0":return r("*Set highlight:* %0",n);case"*Remove highlight*":return r("*Remove highlight*");case"FORMAT_HIGHLIGHT":return r({string:"highlight",id:"FORMAT_HIGHLIGHT"});case"FORMAT_RESTRICTED_ENABLED":return r({string:"*Enable in restricted editing mode*",id:"FORMAT_RESTRICTED_ENABLED"});case"FORMAT_RESTRICTED_DISABLED":return r({string:"*Disable in restricted editing mode*",id:"FORMAT_RESTRICTED_DISABLED"});case"ELEMENT_TABLE":return r({string:"table",plural:"%0 tables",id:"ELEMENT_TABLE"},n);case"ELEMENT_PARAGRAPH":return r({string:"paragraph",plural:"%0 paragraphs",id:"ELEMENT_PARAGRAPH"},n);case"ELEMENT_PAGE_BREAK":return r({string:"page break",plural:"%0 page breaks",id:"ELEMENT_PAGE_BREAK"},n);case"ELEMENT_MEDIA":return r({string:"media item",plural:"%0 media items",id:"ELEMENT_MEDIA"},n);case"ELEMENT_IMAGE":return r({string:"image",plural:"%0 images",id:"ELEMENT_IMAGE"},n);case"ELEMENT_INLINE_IMAGE":return r({string:"image",plural:"%0 images",id:"ELEMENT_INLINE_IMAGE"},n);case"FORMAT_SIDE_IMAGE":return r({string:"side image",id:"FORMAT_SIDE_IMAGE"});case"ELEMENT_CAPTION":return r({string:"caption",id:"ELEMENT_CAPTION"});case"ELEMENT_HORIZONTAL_LINE":return r({string:"horizontal line",plural:"%0 horizontal lines",id:"ELEMENT_HORIZONTAL_LINE"},n);case"ELEMENT_HTML_EMBED":return r({string:"HTML embed",plural:"%0 HTML embeds",id:"ELEMENT_HTML_EMBED"},n);case"ELEMENT_HEADING":return r({string:"heading (level %1)",plural:"%0 headings (level %1)",id:"ELEMENT_HEADING"},n);case"ELEMENT_HEADING_CUSTOM":return r({string:"heading (%1)",plural:"%0 headings (%1)",id:"ELEMENT_HEADING_CUSTOM"},n);case"ELEMENT_LIST_ITEM":return r({string:"list item",plural:"%0 list items",id:"ELEMENT_LIST_ITEM"},n);case"ELEMENT_DEFAULT_LIST_DEFAULT":return r({string:"default list style",id:"ELEMENT_DEFAULT_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST":return r({string:"bulleted list",id:"ELEMENT_BULLETED_LIST"});case"ELEMENT_BULLETED_LIST_DEFAULT":return r({string:"bulleted list (default)",id:"ELEMENT_BULLETED_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST_CIRCLE":return r({string:"bulleted list (circle)",id:"ELEMENT_BULLETED_LIST_CIRCLE"});case"ELEMENT_BULLETED_LIST_DISC":return r({string:"bulleted list (disc)",id:"ELEMENT_BULLETED_LIST_DISC"});case"ELEMENT_BULLETED_LIST_SQUARE":return r({string:"bulleted list (square)",id:"ELEMENT_BULLETED_LIST_SQUARE"});case"ELEMENT_NUMBERED_LIST_DEFAULT":return r({string:"numbered list (default)",id:"ELEMENT_NUMBERED_LIST_DEFAULT"});case"ELEMENT_NUMBERED_LIST":return r({string:"numbered list",id:"ELEMENT_NUMBERED_LIST"});case"ELEMENT_NUMBERED_LIST_DECIMAL":return r({string:"numbered list (decimal)",id:"ELEMENT_NUMBERED_LIST_DECIMAL"});case"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO":return r({string:"numbered list (decimal with leading zero)",id:"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO"});case"ELEMENT_NUMBERED_LIST_LOWER_LATIN":return r({string:"numbered list (lower-latin)",id:"ELEMENT_NUMBERED_LIST_LOWER_LATIN"});case"ELEMENT_NUMBERED_LIST_LOWER_ROMAN":return r({string:"numbered list (lower-roman)",id:"ELEMENT_NUMBERED_LIST_LOWER_ROMAN"});case"ELEMENT_NUMBERED_LIST_UPPER_LATIN":return r({string:"numbered list (upper-latin)",id:"ELEMENT_NUMBERED_LIST_UPPER_LATIN"});case"ELEMENT_NUMBERED_LIST_UPPER_ROMAN":return r({string:"numbered list (upper-roman)",id:"ELEMENT_NUMBERED_LIST_UPPER_ROMAN"});case"ELEMENT_TODO_LIST":return r({string:"to-do list",id:"ELEMENT_TODO_LIST"});case"ELEMENT_MULTI_LEVEL_LIST":return r({string:"multi-level list",id:"ELEMENT_MULTI_LEVEL_LIST"});case"REPLACE_TEXT":return r({string:"*Replace:* %0 *with* %1",id:"REPLACE_TEXT"},n);case"ELEMENT_SPACE":return r({string:"space",plural:"%0 spaces",id:"ELEMENT_SPACE"},n);case"FORMAT_ALIGNMENT":return r({string:"alignment",id:"FORMAT_ALIGNMENT"});case"FORMAT_ALIGN_TO_LEFT":return r({string:"align to left",id:"FORMAT_ALIGN_TO_LEFT"});case"FORMAT_ALIGN_TO_RIGHT":return r({string:"align to right",id:"FORMAT_ALIGN_TO_RIGHT"});case"FORMAT_ALIGN_TO_CENTER":return r({string:"align to center",id:"FORMAT_ALIGN_TO_CENTER"});case"FORMAT_JUSTIFY_TEXT":return r({string:"justify",id:"FORMAT_JUSTIFY_TEXT"});case"FORMAT_BOLD":return r({string:"bold",id:"FORMAT_BOLD"});case"FORMAT_ITALIC":return r({string:"italic",id:"FORMAT_ITALIC"});case"FORMAT_UNDERLINE":return r({string:"underline",id:"FORMAT_UNDERLINE"});case"FORMAT_CODE":return r({string:"code",id:"FORMAT_CODE"});case"FORMAT_STRIKETHROUGH":return r({string:"strikethrough",id:"FORMAT_STRIKETHROUGH"});case"FORMAT_SUBSCRIPT":return r({string:"subscript",id:"FORMAT_SUBSCRIPT"});case"FORMAT_SUPERSCRIPT":return r({string:"superscript",id:"FORMAT_SUPERSCRIPT"});case"ELEMENT_BLOCK_QUOTE":return r({string:"block quote",id:"ELEMENT_BLOCK_QUOTE"});case"ELEMENT_CODE_BLOCK":return r({string:"code block",plural:"%0 code blocks",id:"ELEMENT_CODE_BLOCK"},n);case"FORMAT_HEADER_COLUMN":return r({string:"header column",id:"FORMAT_HEADER_COLUMN"});case"FORMAT_REGULAR_COLUMN":return r({string:"regular column",id:"FORMAT_REGULAR_COLUMN"});case"FORMAT_HEADER_ROW":return r({string:"header row",id:"FORMAT_HEADER_ROW"});case"FORMAT_REGULAR_ROW":return r({string:"regular row",id:"FORMAT_REGULAR_ROW"});case"FORMAT_INDENT":return r({string:"indent",id:"FORMAT_INDENT"});case"FORMAT_LIST_REVERSED":return r({string:"list reversed",id:"FORMAT_LIST_REVERSED"});case"FORMAT_LIST_START":return r({string:"list start",id:"FORMAT_LIST_START"});case"FORMAT_FONT_SIZE":return r({string:"font size",id:"FORMAT_FONT_SIZE"});case"FORMAT_FONT_FAMILY":return r({string:"font family",id:"FORMAT_FONT_FAMILY"});case"FORMAT_FONT_COLOR":return r({string:"font color",id:"FORMAT_FONT_COLOR"});case"FORMAT_FONT_BACKGROUND":return r({string:"font background color",id:"FORMAT_FONT_BACKGROUND"});case"FORMAT_IMAGE_SIZE":return r({string:"image size",id:"FORMAT_IMAGE_SIZE"});case"FORMAT_STYLE":return r({string:"style",id:"FORMAT_STYLE"});case"PENDING_ACTION_SUGGESTION":return r({string:"Unsaved change in suggestion.",id:"PENDING_ACTION_SUGGESTION"});case"ELEMENT_TABLE_WITH_TEXT":return r({string:"table *with text* %0",id:"ELEMENT_TABLE_WITH_TEXT"},n);case"ELEMENT_TABLE_ROW":return r({string:"table row",plural:"%0 table rows",id:"ELEMENT_TABLE_ROW"},n);case"ELEMENT_TABLE_ROW_WITH_TEXT":return r({string:"table row *with text* %1",plural:"%0 table rows *with text* %1",id:"ELEMENT_TABLE_ROW_WITH_TEXT"},n);case"ELEMENT_TABLE_COLUMN":return r({string:"table column",plural:"%0 table columns",id:"ELEMENT_TABLE_COLUMN"},n);case"ELEMENT_TABLE_COLUMN_WITH_TEXT":return r({string:"table column *with text* %1",plural:"%0 table columns *with text* %1",id:"ELEMENT_TABLE_COLUMN_WITH_TEXT"},n);case"ELEMENT_TABLE_OF_CONTENTS":return r({string:"table of contents",plural:"%0 tables of contents",id:"ELEMENT_TABLE_OF_CONTENTS"},n);case"ELEMENT_LINE_BREAK":return r({id:"ELEMENT_LINE_BREAK",string:"line break",plural:"%0 line breaks"},n);case"ELEMENT_TITLE":return r({id:"ELEMENT_TITLE",string:"title"});case"ELEMENT_MERGE_FIELD":return r({id:"ELEMENT_MERGE_FIELD",string:"merge field",plural:"%0 merge fields"},n);case"ELEMENT_BOOKMARK":return r({id:"ELEMENT_BOOKMARK",string:"bookmark",plural:"%0 bookmarks"},n);case"EXTERNAL_SUGGESTION":return r({id:"EXTERNAL_SUGGESTION",string:"This suggestion comes from an external source."});case"EXTERNAL_IMPORT_WORD_SUGGESTION":return r({string:"This suggestion comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_SUGGESTION"});case"EXTERNAL_AVATAR":return i({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},n);case"EXTERNAL_IMPORT_WORD_AVATAR":return i({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},n);case"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering insertion suggestion. Press %0 to go to the discussion.",id:"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving insertion suggestion.",id:"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering deletion suggestion. Press %0 to go to the discussion.",id:"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving deletion suggestion.",id:"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering formatting suggestion. Press %0 to go to the discussion.",id:"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving formatting suggestion.",id:"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT"});case"SUGGESTION_THREAD_ARIA_LABEL":return r({string:"Suggestion by %1. Created on %2. %0 reply. %3",plural:"Suggestion by %1. Created on %2. %0 replies. %3",id:"SUGGESTION_THREAD_ARIA_LABEL"},n);case"SUGGESTION_THREAD_DESCRIPTION":return r({string:"Press Enter for more options. Press Escape to exit.",id:"SUGGESTION_THREAD_DESCRIPTION"});default:return t}}class SuggestionDescriptionFactory{constructor(e,t){this._customCallbacks=[],this._itemLabels=new Map,this._itemLabelsCallbacks=[],this._attributeLabels=new Map,this._schema=e,this._locale=t}getDescriptions(e){const t=[],n=new Set,i=new Set;for(let r=0;r<e.length;r++){const s=e[r];if(!s.isInContent)continue;const o=this._handleCustomCallbackDescription(s);if(o){if(null!=s.subType){if(n.has(s.subType))continue;n.add(s.subType)}t.push(o)}else if("attribute"!=s.type)"insertion"!=s.type&&"deletion"!=s.type||this._handleInsertRemoveSuggestionDescription(t,s,e[r+1]);else{const e=s.data.key;if(i.has(e))continue;i.add(s.data.key),e==renameAttributeKey?this._handleRenameSuggestionDescription(t,s):this._handleAttributeSuggestionDescription(t,s)}}return this._resolveDescriptionItems(t)}registerDescriptionCallback(e){this._customCallbacks.push(e)}registerElementLabel(e,t,n=priorities.normal){"function"==typeof e?insertToPriorityArray(this._itemLabelsCallbacks,{matchingCallback:e,label:t,priority:n}):this._itemLabels.set(e,t)}registerAttributeLabel(e,t){this._attributeLabels.set(e,t)}getItemLabel(e,t=1){let n;for(const t of this._itemLabelsCallbacks)if(t.matchingCallback(e)){n=t.label;break}return n||(n=this._itemLabels.get(e.name)),n?n(t):1!==t?t+" "+e.name+"s":""+e.name}_addDescriptionItems(e,t){const n=t.getFirstRange().getWalker(),i="insertion"==t.type?"add":"remove";for(const t of n){const r=t.item,s=e[e.length-1];if(r.is("$textProxy"))s&&s.type.indexOf("Container")>-1&&e.pop(),s&&"text"==s.type?s[i]+=r.data:e.push({type:"text",add:"add"==i?r.data:"",remove:"remove"==i?r.data:""});else if(this._schema.isObject(r)){const o=r;if(s&&s.type.indexOf("Container")>-1&&e.pop(),"elementEnd"==t.type)continue;s&&s.type==i+"Object"&&s.element.name==o.name?s.quantity++:e.push({type:i+"Object",element:o,quantity:1}),n.skip((e=>!("elementEnd"==e.type&&e.item==r)))}else if(this._schema.checkChild(r,"$text")||r.is("element","softBreak")){const n=r;if("add"==i&&"elementStart"==t.type||"remove"==i&&"elementEnd"==t.type)continue;if(s&&-1==s.type.indexOf("Container")){"text"==s.type&&(s[i]+="\n");continue}let o;if(o="add"==i?n.nextSibling&&!this._schema.isObject(n.nextSibling)?n.nextSibling:null:n.previousSibling&&!this._schema.isObject(n.previousSibling)?n.previousSibling:null,n.isEmpty||o&&o.isEmpty){const t=o&&o.isEmpty?o:n;s&&s.type==i+"EmptyContainer"&&s.element.name==t.name?s.quantity++:e.push({type:i+"EmptyContainer",element:t,quantity:1})}else e.push({type:i+"Container",element:n})}}}_resolveDescriptionItems(e){const t=this._locale,n=[],i=[],r=[];for(const s of e)switch(s.type){case"text":if(s.add=s.add.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),s.remove=s.remove.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),""!=s.add&&""!=s.remove){n.push({type:"replace",content:getTranslation(t,"REPLACE_TEXT",['"'+s.remove+'"','"'+s.add+'"'])});continue}if(null!=s.add.match(/^ +$/)){n.push({type:"insertion",content:getTranslation(t,"*Insert:* %0",getTranslation(t,"ELEMENT_SPACE",s.add.length))});continue}if(null!=s.remove.match(/^ +$/)){n.push({type:"deletion",content:getTranslation(t,"*Remove:* %0",getTranslation(t,"ELEMENT_SPACE",s.remove.length))});continue}if(""!=s.add){n.push({type:"insertion",content:getTranslation(t,"*Insert:* %0",'"'+s.add+'"')});continue}n.push({type:"deletion",content:getTranslation(t,"*Remove:* %0",'"'+s.remove+'"')});continue;case"addEmptyContainer":case"addObject":n.push({type:"insertion",content:getTranslation(t,"*Insert:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"removeEmptyContainer":case"removeObject":n.push({type:"deletion",content:getTranslation(t,"*Remove:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"addContainer":n.push({type:"insertion",content:getTranslation(t,"*Split:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"removeContainer":n.push({type:"deletion",content:getTranslation(t,"*Merge:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"addFormat":i.push(s.key);continue;case"removeFormat":r.push(s.key);continue;default:n.push(s)}if(i.length){const e=i.map((e=>this._attributeLabels.has(e)?this._attributeLabels.get(e):e)).join(", ");n.push({type:"format",content:getTranslation(this._locale,"*Set format:* %0",e)})}if(r.length){const e=r.map((e=>this._attributeLabels.has(e)?this._attributeLabels.get(e):e)).join(", ");n.push({type:"format",content:getTranslation(this._locale,"*Remove format:* %0",e)})}return n}_handleCustomCallbackDescription(e){for(const t of this._customCallbacks){const n=t(e);if(n&&"type"in n)return n}}_handleAttributeSuggestionDescription(e,t){const n=t.data,i=void 0===n.newValue?"removeFormat":"addFormat";e.push({type:i,key:n.key})}_handleRenameSuggestionDescription(e,t){e.push({type:"format",content:getTranslation(this._locale,"*Change to:* %0",this.getItemLabel(t.getFirstRange().start.nodeAfter,1))})}_handleInsertRemoveSuggestionDescription(e,t,n){if(this._addDescriptionItems(e,t),n&&n.getFirstRange()&&!t.getFirstRange().end.isEqual(n.getFirstRange().start)){const n=e[e.length-1],i="insertion"==t.type?"add":"remove";n&&"text"==n.type&&(n[i]+="\n")}}}class TrackChangesAIAssistant extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.commands.get("showAIAssistant")&&t.enableCommand("showAIAssistant")}}class TrackChangesAlignment extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("AlignmentEditing"))return;const n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("alignment"),n.registerBlockAttribute("alignment"),n.descriptionFactory.registerAttributeLabel("alignment",getTranslation(t,"FORMAT_ALIGNMENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"alignment"==n.commandName){const e=n.commandParams[0].value;return{type:"format",content:getTranslation(t,"*Format:* %0",function(e){switch(e){case"left":return getTranslation(t,"FORMAT_ALIGN_TO_LEFT");case"right":return getTranslation(t,"FORMAT_ALIGN_TO_RIGHT");case"center":return getTranslation(t,"FORMAT_ALIGN_TO_CENTER");case"justify":return getTranslation(t,"FORMAT_JUSTIFY_TEXT")}}(e))}}}))}}const basicStylesPlugins=["BoldEditing","ItalicEditing","UnderlineEditing","CodeEditing","StrikethroughEditing","SubscriptEditing","SuperscriptEditing"];class TrackChangesBasicStyles extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.locale;for(const i of basicStylesPlugins){if(!e.plugins.has(i))continue;const r=i.slice(0,-7).toLowerCase(),s="FORMAT_"+r.toUpperCase();t.enableDefaultAttributesIntegration(r),t.registerInlineAttribute(r),t.descriptionFactory.registerAttributeLabel(r,getTranslation(n,s))}this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");function i(e,i){n.descriptionFactory.registerDescriptionCallback((n=>{if("formatInline"!=n.type)return;const{data:r}=n;return r&&r.commandName===e?r.commandParams[0].forceValue?{type:"format",content:getTranslation(t,"*Format:* %0",i)}:{type:"format",content:getTranslation(t,"*Remove format:* %0",i)}:void 0}))}i("bold",getTranslation(t,"FORMAT_BOLD")),i("italic",getTranslation(t,"FORMAT_ITALIC")),i("underline",getTranslation(t,"FORMAT_UNDERLINE")),i("code",getTranslation(t,"FORMAT_CODE")),i("strikethrough",getTranslation(t,"FORMAT_STRIKETHROUGH")),i("subscript",getTranslation(t,"FORMAT_SUBSCRIPT")),i("superscript",getTranslation(t,"FORMAT_SUPERSCRIPT"))}}class TrackChangesBlockQuote extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("BlockQuoteEditing"))return;const n=e.plugins.get("TrackChangesEditing"),i=this.editor.commands.get("blockQuote");n.enableCommand("blockQuote",((t,r={})=>{const s=this.editor.model.document.selection,o=r&&void 0!==r.forceValue?r.forceValue:!i.value;let a=[];if(o){const t=Array.from(s.getSelectedBlocks()).filter((e=>isInQuote(e)||checkCanBeQuoted(e,this.editor.model.schema)));a=getRangesOfBlockGroups(t,e.model)}else{const t=Array.from(s.getSelectedBlocks()).filter((e=>isInQuote(e)));a=getRangesOfBlockGroups(t,e.model)}e.model.change((()=>{for(const e of a)n.markBlockFormat(e,{commandName:"blockQuote",commandParams:[{forceValue:o}]})}))})),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(n&&"blockQuote"==n.commandName){const e=getTranslation(t,"ELEMENT_BLOCK_QUOTE");return n.commandParams[0].forceValue?{type:"format",content:getTranslation(t,"*Set format:* %0",e)}:{type:"format",content:getTranslation(t,"*Remove format:* %0",e)}}}))}}function checkCanBeQuoted(e,t){const n=t.checkChild(e.parent,"blockQuote"),i=t.checkChild(["$root","blockQuote"],e);return n&&i}function isInQuote(e){return"blockQuote"==e.parent.name}class TrackChangesBookmark extends Plugin{afterInit(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");e.plugins.has("BookmarkEditing")&&(n.enableCommand("insertBookmark"),n.enableDefaultAttributesIntegration("updateBookmark"),n.registerBlockAttribute("bookmarkId"),n.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"!=e.type&&"deletion"!=e.type&&"attribute"!=e.type)return;const n=e.getContainedElement();if(null==n)return;if(!n.is("element","bookmark"))return;const i=n.getAttribute("bookmarkId");if("insertion"==e.type)return{type:"insertion",content:getTranslation(t,"*Insert:* %0",'"'+i+'" '+getTranslation(t,"ELEMENT_BOOKMARK"))};if("deletion"==e.type)return{type:"deletion",content:getTranslation(t,"*Remove:* %0",'"'+i+'" '+getTranslation(t,"ELEMENT_BOOKMARK"))};const{data:r}=e;return r&&"bookmarkId"==r.key?{type:"format",content:getTranslation(t,"*Set bookmark:* %0",'"'+r.newValue+'"')}:void 0})))}}class TrackChangesCaseChange extends Plugin{afterInit(){const e=this.editor;e.plugins.has("CaseChange")&&(e.plugins.get("TrackChangesEditing").enableCommand("changeCaseUpper"),e.plugins.get("TrackChangesEditing").enableCommand("changeCaseLower"),e.plugins.get("TrackChangesEditing").enableCommand("changeCaseTitle"))}}class TrackChangesCKBox extends Plugin{afterInit(){const e=this.editor;e.commands.get("ckbox")&&e.plugins.get("TrackChangesEditing").enableCommand("ckbox")}}class TrackChangesCodeBlock extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("CodeBlock"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale,i=e.config.get("codeBlock").languages,r=e.commands.get("codeBlock");t.enableCommand("indentCodeBlock"),t.enableCommand("outdentCodeBlock"),t.enableCommand("codeBlock",((n,s={})=>{const o=e.model,a=e.model.document.selection,c=s&&void 0!==s.forceValue?s.forceValue:!r.value;let l;s.language||(s.language=i[0].language),l=c?Array.from(a.getSelectedBlocks()).filter((e=>isCodeBlock(e)||canBeCodeBlock(e,o.schema))):Array.from(a.getSelectedBlocks()).filter((e=>isCodeBlock(e)));const d=getRangesOfBlockGroups(l,o);o.change((()=>{for(const e of d)t.markBlockFormat(e,{commandName:"codeBlock",commandParams:[{...s,forceValue:c}],formatGroupId:"blockName"})}))})),t.descriptionFactory.registerElementLabel("codeBlock",(e=>getTranslation(n,"ELEMENT_CODE_BLOCK",e))),t.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const t=n.t,{data:r}=e;if(!r||"codeBlock"!=r.commandName)return;const s=r.commandParams[0].language,o=t(i.find((e=>e.language===s)).label).toLowerCase();return r.commandParams[0].forceValue?{type:"format",content:getTranslation(n,"*Set format:* %0",getTranslation(n,"ELEMENT_CODE_BLOCK",1)+" ("+o+")")}:{type:"format",content:getTranslation(n,"*Remove format:* %0",getTranslation(n,"ELEMENT_CODE_BLOCK",1))}}))}}function canBeCodeBlock(e,t){return!e.is("rootElement")&&!t.isLimit(e)&&t.checkChild(e.parent,"codeBlock")}function isCodeBlock(e){return"codeBlock"==e.name}class TrackChangesComments extends Plugin{afterInit(){const e=this.editor;e.plugins.has("CommentsEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("addCommentThread")}}function getRangesWithAttribute(e,t,n){const i=[];for(const r of t.getItems())r.hasAttribute(e)&&i.push(n.createRangeOn(r));return i}function downcastSplitMergeMarker$1(e,t,{showActiveMarker:n=!0}={}){const i=e.plugins.get("TrackChangesEditing");return(r,s,o)=>{if(!o.consumable.test(s.markerRange,r.name))return;const a=s.markerRange.getWalker(),c=s.markerRange.start,l=e.model.schema;let d=null,u=null,h=!1,m=!1;for(const e of a){const t=e.item;h=h||l.isContent(t);const n=o.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&l.isBlock(t)&&!l.isLimit(t)&&(t.nextSibling||c.isAtEnd?d&&d.parent==t||(d=t,g(e.previousPosition),m=!0):u=u||e.previousPosition)}function g(e){const{authorId:r}=i._splitMarkerName(s.markerName),a=o.writer.createUIElement("span",{class:"ck-suggestion-marker-"+t,"data-author-id":r}),c=o.mapper.toViewPosition(e);n&&i.activeMarkers.includes(s.markerName)&&o.writer.addClass("ck-suggestion-marker--active",a),o.writer.insert(c,a),o.mapper.bindElementToMarker(a,s.markerName)}h||m||!u||g(u)}}class TrackChangesDeleteCommand extends Plugin{static get requires(){return[Delete]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");t.enableCommand("delete");const n=e.commands.get("deleteForward");t.enableCommand("deleteForward",((t,i={})=>{const r=e.model.createSelection(e.model.document.selection);r.isCollapsed&&e.model.modifySelection(r,{direction:"forward",unit:i.unit});const s=r.getFirstRange(),o=LiveRange.fromRange(s);let a;t(i),a="$graveyard"==o.root.rootName?e.model.createRange(s.start):e.model.createRange(o.start,o.end),o.detach(),e.model.enqueueChange(n.buffer.batch,(e=>{n.buffer.lock(),e.setSelection(e.createRange(a.end)),n.buffer.unlock()}))})),e.editing.downcastDispatcher.on("addMarker:suggestion:deletion",downcastSplitMergeMarker$1(e,"merge"),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion:deletion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker$1(e,"merge",{showActiveMarker:!1}).bind(this)(t,n,i)}),{priority:"high"}),e.editing.downcastDispatcher.on("removeMarker:suggestion:deletion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.is("uiElement")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"})}}class TrackChangesList extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ListEditing"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing"),i=e.plugins.has("TodoListEditing"),r=!!e.config.get("list.multiBlock");function s(e){return{type:"format",content:""+getTranslation(t,"*Set format:* %0",e)}}function o(e){return{type:"format",content:""+getTranslation(t,"*Remove format:* %0",e)}}n.enableDefaultAttributesIntegration("numberedList"),n.enableDefaultAttributesIntegration("bulletedList"),n.enableDefaultAttributesIntegration("customNumberedList"),n.enableDefaultAttributesIntegration("customBulletedList"),n.enableDefaultAttributesIntegration("indentList"),n.enableDefaultAttributesIntegration("outdentList"),n.enableDefaultAttributesIntegration("splitListItemAfter"),n.enableDefaultAttributesIntegration("splitListItemBefore"),n.registerBlockAttribute("listItemId"),n.registerBlockAttribute("listType"),n.registerBlockAttribute("listIndent"),r&&(n.enableDefaultAttributesIntegration("mergeListItemBackward"),n.enableDefaultAttributesIntegration("mergeListItemForward")),i&&(n.enableDefaultAttributesIntegration("todoList"),n.enableDefaultAttributesIntegration("checkTodoList"),n.registerBlockAttribute("todoListChecked"),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(n&&"todoListChecked"==n.key)return{type:"format",content:n.newValue?getTranslation(t,"*Check item*"):getTranslation(t,"*Uncheck item*")}})),this.editor.model.document.registerPostFixer((e=>{if(e.batch.isUndo)return!1;let t=!1;const i=n.getSuggestions({skipNotAttached:!0}).filter((e=>"todoListChecked"===n._getAttributeKey(e)));for(const r of i)"todo"!=r.getFirstRange().start.nodeAfter.getAttribute("listType")&&(n._findSuggestions(r.getFirstRange(),"attribute").find((e=>"listType"===n._getAttributeKey(e.suggestion)))||(e.removeMarker(r.getFirstMarker()),t=!0));return t}))),n.descriptionFactory.registerAttributeLabel("listIndent",getTranslation(t,"FORMAT_INDENT"));const a={type:"format",content:""};n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(!n||"listType"!=n.key)return;let i=e.head;for(;i;){if(i.data&&(("listStyle"==i.data.key||"listMarkerStyle"==i.data.key)&&(i.data.newValue&&"default"!=i.data.newValue||"default"!=i.data.oldValue&&!n.newValue)||!r&&i.data.key==renameAttributeKey))return a;i=i.next}if(null==n.newValue)switch(n.oldValue){case"bulleted":return o(getTranslation(t,"ELEMENT_BULLETED_LIST"));case"numbered":return o(getTranslation(t,"ELEMENT_NUMBERED_LIST"));case"todo":return o(getTranslation(t,"ELEMENT_TODO_LIST"))}switch(n.newValue){case"bulleted":return s(getTranslation(t,"ELEMENT_BULLETED_LIST"));case"numbered":return s(getTranslation(t,"ELEMENT_NUMBERED_LIST"));case"todo":return s(getTranslation(t,"ELEMENT_TODO_LIST"))}})),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listIndent"==t.key)return null==t.newValue||null==t.oldValue&&0==t.newValue?a:void 0})),n.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:n}=e;if(!n||"listItemId"!=n.key)return;const i=checkSiblingsListItemId(e);return"newValue"==i?{type:"format",content:getTranslation(t,"*Merge:* list item")}:"oldValue"==i?{type:"format",content:getTranslation(t,"*Split:* list item")}:a})),e.model.document.registerPostFixer((e=>this.listItemIdFixer(e))),e.model.document.registerPostFixer((e=>this.noTrackChangesFixer(e))),e.model.document.on("change:data",((e,t)=>{if(t.isUndo||!t.isLocal)return!1;this.assureChains()}),{priority:"high"}),this._supportLegacySuggestions()}listItemIdFixer(e){if(e.batch.isUndo||!e.batch.isLocal)return!1;let t=!1;const n=this.editor.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0}).filter((e=>e.data&&"listItemId"==e.data.key)).filter((e=>e.data.newValue&&e.data.oldValue));for(const i of n)checkSiblingsListItemId(i)||(e.removeMarker(i.getFirstMarker()),t=!0);return t}noTrackChangesFixer(e){if(e.batch.isUndo||!e.batch.isLocal)return!1;const t=this.editor.plugins.get("TrackChangesEditing");if(t.trackChangesCommand.value)return!1;let n=!1;const i=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"],r=this.editor.model.document.differ.getChanges().filter((e=>"attribute"==e.type)).filter((e=>i.includes(e.attributeKey)));if(0==r.length)return n;for(const s of r){const r=t._findSuggestions(s.range,"attribute").filter((e=>!e.meta.isNextTo)).map((e=>e.suggestion)).filter((e=>{const n=t._getAttributeKey(e);return i.includes(n)}));if(r.length){for(const t of r)e.removeMarker(t.getFirstMarker());n=!0}}return n}assureChains(){const e=this.editor.plugins.get("TrackChangesEditing"),t=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"];let n;const i=new Set(this.editor.model.document.differ.getChangedMarkers().filter((n=>{if(n.data.oldRange||!n.data.newRange)return null;if(!n.name.startsWith("suggestion:attribute:"))return null;const{id:i}=e._splitMarkerName(n.name);if(!e.hasSuggestion(i))return null;const r=e.getSuggestion(i);return t.includes(r.data.key)})).map((t=>{const{id:i}=e._splitMarkerName(t.name),r=e.getSuggestion(i);return n=r.attributes.groupId,r.getFirstRange().start.nodeAfter})));if(0==i.size)return;const r=e.getSuggestions({skipNotAttached:!0}).filter((e=>"attribute"==e.type&&e.data&&t.includes(e.data.key)&&e.attributes.groupId!=n)).map((e=>({listItem:e.getFirstRange().start.nodeAfter,groupId:e.attributes.groupId}))),s=new Set;for(const{groupId:e,listItem:t}of r)i.has(t)&&s.add(e);for(const t of e.getSuggestions())s.has(t.attributes.groupId)&&t.setAttribute("groupId",n)}_supportLegacySuggestions(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");this._registerLegacyDescription(),n._suggestionFactory.registerCustomCallback("formatBlock","documentList","accept",(function(t,n){const i=[];for(let n of t)n.start.nodeAfter===n.end.parent&&(n=e.model.createRange(e.model.createPositionAt(n.start.nodeAfter,0))),i.push(n);e.model.change((t=>{const r=e.model.document.selection,s=Array.from(r.getRanges()).map((e=>LiveRange.fromRange(e)));t.setSelection(i),e.commands.get(n.commandName).refresh(),n.commandParams.push({forceDefaultExecution:!0}),e.execute(n.commandName,...n.commandParams),t.setSelection(s);for(const e of s)e.detach()}))})),n.descriptionFactory.registerElementLabel((function(t){const n=!e.model.schema.isObject(t),i=t.previousSibling,r=t.nextSibling,s=t.getAttribute("listItemId"),o=!i||i.getAttribute("listItemId")!==s,a=!r||r.getAttribute("listItemId")!==s;return n&&Boolean(s)&&o&&a}),(e=>getTranslation(t,"ELEMENT_LIST_ITEM",e)))}_registerLegacyDescription(){const e=this.editor,t=e.locale;function n(t){const n=e.commands.get("bulletedList").value,i=e.commands.get("numberedList").value;return"numberedList"===t?n:i}e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((function(i){if("formatBlock"!=i.type)return;const{data:r}=i;if(!r)return;let s,o,a,c;switch(r.commandName){case"bulletedList":a=r.commandParams[0].forceValue,c=n(r.commandName),s=a?"*Format:* insert into %0":"*Format:* remove from %0",!c&&e.config.get("list.multiBlock")||(s="*Change to:* %0"),o={type:"format",content:getTranslation(t,s,getTranslation(t,"ELEMENT_BULLETED_LIST"))};break;case"numberedList":a=r.commandParams[0].forceValue,c=n(r.commandName),s=a?"*Format:* insert into %0":"*Format:* remove from %0",!c&&e.config.get("list.multiBlock")||(s="*Change to:* %0"),o={type:"format",content:getTranslation(t,s,getTranslation(t,"ELEMENT_NUMBERED_LIST"))};break;case"indentList":s="*Indent:* %0",o={type:"format",content:getTranslation(t,s,getTranslation(t,"ELEMENT_LIST_ITEM"))};break;case"outdentList":s=function(e){const t=e.getFirstRange();let n=t.start.nodeAfter;for(;n&&t.containsItem(n);){if(n.getAttribute("listIndent")>0)return!1;n=n.nextSibling}return!0}(i)?getTranslation(t,"*Format:* remove from %0",getTranslation(t,"ELEMENT_"+i.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST")):getTranslation(t,"*Outdent:* %0",getTranslation(t,"ELEMENT_LIST_ITEM")),o={type:"format",content:s};break;case"mergeListItemBackward":case"mergeListItemForward":!1===r.multipleBlocks&&(s="*Merge:* %0",o={type:"deletion",content:getTranslation(t,s,getTranslation(t,"ELEMENT_LIST_ITEM"))})}return o}))}}function checkSiblingsListItemId(e){let t=e.getFirstRange().start.nodeAfter.previousSibling;for(;t;){const n=t.getAttribute("listItemId");if(!n)return!1;if(n==e.data.newValue)return"newValue";if(n==e.data.oldValue)return"oldValue";t=t.previousSibling}return!1}class TrackChangesDocumentListProperties extends Plugin{afterInit(){if(!this.editor.plugins.has("ListPropertiesEditing"))return;const e=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");e.styles&&(t.enableDefaultAttributesIntegration("listStyle"),t.registerBlockAttribute("listStyle")),e.reversed&&(t.enableDefaultAttributesIntegration("listReversed"),t.registerBlockAttribute("listReversed")),e.startIndex&&(t.enableDefaultAttributesIntegration("listStart"),t.registerBlockAttribute("listStart"));const n={type:"format",content:""};t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this));const i=this.editor.locale;t.descriptionFactory.registerAttributeLabel("listReversed",getTranslation(i,"FORMAT_LIST_REVERSED")),t.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listReversed"==t.key)return null==t.newValue||0==t.newValue&&null==t.oldValue?n:void 0})),t.descriptionFactory.registerAttributeLabel("listStart",getTranslation(i,"FORMAT_LIST_START")),t.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listStart"==t.key)return null==t.newValue||1==t.newValue&&null==t.oldValue?n:void 0})),this.editor.model.document.registerPostFixer((e=>{if(e.batch.isUndo)return!1;let n=!1;const i=t.getSuggestions({skipNotAttached:!0}).filter((e=>{const n=t._getAttributeKey(e);return"listStart"==n||"listReversed"==n}));for(const r of i){const i=r.getFirstRange().start.nodeAfter.getAttribute("listType");"numbered"!=i&&"customNumbered"!=i&&(t._findSuggestions(r.getFirstRange(),"attribute").find((e=>"listType"==t._getAttributeKey(e.suggestion)))||(e.removeMarker(r.getFirstMarker()),n=!0))}return n})),this._registerLegacyDescription()}handleDescriptions(e){const t=this.editor.locale,{data:n}=e,i={type:"format",content:""};if(!n||"listStyle"!=n.key)return;if(!n.oldValue)return"default"==n.newValue?i:{type:"format",content:""+getTranslation(t,"*Set format:* %0",getTranslation(t,this._getTranslationKeyForListStyle(n.newValue)))};if(!n.newValue){if("default"==n.oldValue)return i;let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue)return i;r=r.next}return{type:"format",content:""+getTranslation(t,"*Remove format:* %0",getTranslation(t,this._getTranslationKeyForListStyle(n.oldValue)))}}if("default"!=n.newValue)return{type:"format",content:""+getTranslation(t,"*Set format:* %0",getTranslation(t,this._getTranslationKeyForListStyle(n.newValue)))};let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue&&r.data.oldValue)return i;r=r.next}return{type:"format",content:getTranslation(t,"*Set format:* %0",getTranslation(t,"ELEMENT_"+e.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST_DEFAULT"))}}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(!n)return;let i,r;switch(n.commandName){case"listStyle":i="*Change to:* %0",r={type:"format",content:getTranslation(t,i,getTranslation(t,this._getTranslationKeyForListStyle(n.commandParams[0].type)))};break;case"listReversed":i=n.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",r={type:"format",content:getTranslation(t,i)};break;case"listStart":i="*Format:* set start index to %0",r={type:"format",content:getTranslation(t,i,n.commandParams[0].startIndex)}}return r}))}_getTranslationKeyForListStyle(e){return"ELEMENT_"+getListTypeFromListStyleType(e).toUpperCase()+"_LIST_"+e.toUpperCase().replace(/-/g,"_")}}const BULLETED_LIST_STYLE_TYPES=["disc","circle","square"],NUMBERED_LIST_STYLE_TYPES=["decimal","decimal-leading-zero","lower-roman","upper-roman","lower-latin","upper-latin"];function getListTypeFromListStyleType(e){return BULLETED_LIST_STYLE_TYPES.includes(e)?"bulleted":NUMBERED_LIST_STYLE_TYPES.includes(e)?"numbered":null}class TrackChangesEnterCommand extends Plugin{static get requires(){return[Enter]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("enter");t.enableCommand("enter",(()=>{e.model.change((i=>{const r=e.model.document.selection,s=r.getFirstPosition(),o=LiveRange.fromRange(r.getFirstRange());if(n.enterBlock(i)){const n=e.model.createPositionAt(s.parent.nextSibling,0),r=i.createRange(s,n);t.markInsertion(r)}else i.setSelection(i.createRange(o.end));o.detach(),n.fire("afterExecute",{writer:i})}))})),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastSplitMergeMarker$1(e,"split"),{priority:"high"}),e.editing.downcastDispatcher.on("removeMarker:suggestion:insertion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.hasClass("ck-suggestion-marker-split")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion:insertion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker$1(e,"split",{showActiveMarker:!1}).bind(this)(t,n,i)}),{priority:"high"})}}class TrackChangesFindAndReplace extends Plugin{afterInit(){if(!this.editor.plugins.has("FindAndReplaceEditing"))return;const e=this.editor.plugins.get("TrackChangesEditing");e.enableCommand("find",this.handleFindCommand.bind(this)),e.enableCommand("findNext"),e.enableCommand("findPrevious"),e.enableCommand("replace"),e.enableCommand("replaceAll")}handleFindCommand(e,t,n={}){const i=this.editor.plugins.get("FindAndReplaceUtils");return e((e=>{let r=("string"==typeof t?i.findByTextCallback(t,n):t)(e);Array.isArray(r)&&(r={results:r,searchText:"string"==typeof t?t:""});const s=r.results.filter((t=>!1===this._isInDeletionRange(t,e.item)));return{...r,results:s}}),n)}_isInDeletionRange(e,t){const n=this.editor.model.createRange(this.editor.model.createPositionAt(t,e.start),this.editor.model.createPositionAt(t,e.end));for(const e of this.editor.model.markers.getMarkersGroup("suggestion:deletion"))if(null!==n.getIntersection(e.getRange()))return!0;return!1}}const fontPlugins=[{pluginName:"FontSizeEditing",commandName:"fontSize"},{pluginName:"FontFamilyEditing",commandName:"fontFamily"},{pluginName:"FontColorEditing",commandName:"fontColor"},{pluginName:"FontBackgroundColorEditing",commandName:"fontBackgroundColor"}];class TrackChangesFont extends Plugin{afterInit(){const e=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");for(const{pluginName:e,commandName:n}of fontPlugins)this.editor.plugins.has(e)&&(t.enableDefaultAttributesIntegration(n),t.registerInlineAttribute(n));t.descriptionFactory.registerAttributeLabel("fontSize",getTranslation(e,"FORMAT_FONT_SIZE")),t.descriptionFactory.registerAttributeLabel("fontFamily",getTranslation(e,"FORMAT_FONT_FAMILY")),t.descriptionFactory.registerAttributeLabel("fontColor",getTranslation(e,"FORMAT_FONT_COLOR")),t.descriptionFactory.registerAttributeLabel("fontBackgroundColor",getTranslation(e,"FORMAT_FONT_BACKGROUND")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{const n=t.t;if("formatInline"!=e.type)return;const{data:i}=e;if(null!=i){if("fontSize"==i.commandName){const e=i.commandParams[0].value;if(e){const i=n(this.editor.plugins.get("FontSize").normalizeSizeOptions(this.editor.config.get("fontSize.options")).find((t=>t.model==e)).title).toLowerCase();return{type:"format",content:getTranslation(t,"*Set font size:* %0",i)}}return{type:"format",content:getTranslation(t,"*Reset font size*")}}if("fontFamily"==i.commandName){const e=i.commandParams[0].value;return e?{type:"format",content:getTranslation(t,"*Set font family:* %0",e)}:{type:"format",content:getTranslation(t,"*Reset font family*")}}if("fontColor"==i.commandName){const e=i.commandParams[0].value;if(e){const i=normalizeColorOptions(this.editor.config.get("fontColor.colors")).find((t=>t.model==e));let r=e,s="";return i&&(r=i.label,s=n(r).toLowerCase()),{type:"format",content:getTranslation(t,"*Set font color:* %0",s).trim(),color:{value:e,title:s||r}}}return{type:"format",content:getTranslation(t,"*Reset font color*")}}if("fontBackgroundColor"==i.commandName){const e=i.commandParams[0].value;if(e){const i=normalizeColorOptions(this.editor.config.get("fontBackgroundColor.colors")).find((t=>t.model==e));let r=e,s="";return i&&(r=i.label,s=n(r).toLowerCase()),{type:"format",content:getTranslation(t,"*Set font background color:* %0",s).trim(),color:{value:e,title:s||r}}}return{type:"format",content:getTranslation(t,"*Reset font background color*")}}}}))}}class TrackChangesFormatPainter extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("copyFormat"),i=e.commands.get("pasteFormat");n&&i&&(t.enableDefaultAttributesIntegration("pasteFormat"),t.enableCommand("copyFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((n=>{if("formatBlock"!=n.type&&"formatInline"!=n.type)return;const{data:i}=n;if(i&&"pasteFormat"===i.commandName){const n=[],r=i.commandParams[0];for(const[t,i]of Object.entries(r))n.push(translateFormatting(e,t,i));return n.length?{type:"format",content:getTranslation(t,"*Set format to:* %0",n.join(", "))}:{type:"format",content:getTranslation(t,"*Remove all formatting*")}}}))}}function translateFormatting(e,t,n){const i=e.locale.t,r=t.split(/(?=[A-Z])/).join(" "),s=i(r.charAt(0).toUpperCase()+r.slice(1)).toLowerCase();if("boolean"==typeof n)return s;if("fontColor"===t||"fontBackgroundColor"===t){const t=normalizeColorOptions(e.config.get("fontColor.colors")).find((e=>e.model==n));return s+" ("+(t?i(t.label).toLowerCase():n)+")"}if("fontSize"===t&&isNaN(parseFloat(n))){const t=e.plugins.get("FontSize").normalizeSizeOptions(e.config.get("fontSize.options")).find((e=>e.model==n));return s+" ("+(t?i(t.title).toLowerCase():n)+")"}return s+" ("+n+")"}class TrackChangesHeading extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HeadingEditing"))return;this._headingOptions=e.config.get("heading.options");const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("heading");for(const e of this._headingOptions)"paragraph"!=e.model&&n.descriptionFactory.registerElementLabel(e.model,(n=>{const i=this._getHeadingLevel(e.model);return null!==i?getTranslation(t,"ELEMENT_HEADING",[n,i]):(r=n,s=e.title,getTranslation(t,"ELEMENT_HEADING_CUSTOM",[r,s]));var r,s}));this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"heading"==n.commandName){const e=n.commandParams[0].value,o=this._getHeadingLevel(e);if(null!==o)return{type:"format",content:getTranslation(t,"*Change to:* %0",(s=o,getTranslation(t,"ELEMENT_HEADING",[1,s])))};const a=this._headingOptions.find((t=>t.model===e)).title;return{type:"format",content:getTranslation(t,"*Change to:* %0",(i=1,r=a,getTranslation(t,"ELEMENT_HEADING_CUSTOM",[i,r])))}}var i,r,s}))}_getHeadingLevel(e){var t,n;const i=e.match(/^heading(\d+)/);if(i)return i[1];const r=null===(t=this._headingOptions)||void 0===t?void 0:t.find((t=>t.model==e));if(r&&r.view){const e=r.view,t=(null!==(n=e.name)&&void 0!==n?n:e).match(/^h(\d+)/);if(t)return t[1]}return null}}class TrackChangesHighlight extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HighlightEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.enableDefaultAttributesIntegration("highlight"),t.registerInlineAttribute("highlight"),t.descriptionFactory.registerAttributeLabel("highlight",getTranslation(n,"FORMAT_HIGHLIGHT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((n=>{if("formatInline"!=n.type)return;const{data:i}=n;if(i&&"highlight"==i.commandName){const n=t.t,r=i.commandParams[0].value;if(r){const i=e.config.get("highlight.options").find((e=>e.model==r)),s=n(i.title).toLowerCase();return{type:"format",content:getTranslation(t,"*Set highlight:* %0",s),color:{value:i.color,title:i.title}}}return{type:"format",content:getTranslation(t,"*Remove highlight*",getTranslation(t,"FORMAT_HIGHLIGHT"))}}}))}}class TrackChangesHorizontalLine extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HorizontalLineEditing"))return;e.plugins.get("TrackChangesEditing").enableCommand("horizontalLine");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("horizontalLine",(e=>getTranslation(n,"ELEMENT_HORIZONTAL_LINE",e))),e.conversion.for("dataDowncast").elementToStructure({model:"horizontalLine",view:(e,{writer:t,options:n})=>{if(!n.showSuggestionHighlights)return null;const i=t.createContainerElement("div"),r=t.createEmptyElement("hr");return t.addClass("ck-horizontal-line",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}}class TrackChangesHtmlEmbed extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HtmlEmbed"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("rawHtml",(e=>getTranslation(n,"ELEMENT_HTML_EMBED",e))),t.enableDefaultAttributesIntegration("htmlEmbed"),t.registerBlockAttribute("value"),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;if(t&&"value"==t.key&&e.getFirstRange().start.nodeAfter.is("element","rawHtml")){const e=getTranslation(n,"ELEMENT_HTML_EMBED");return{type:"format",content:getTranslation(n,"*Change %0 content*",e)}}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"htmlEmbed"==n.commandName){const e=getTranslation(t,"ELEMENT_HTML_EMBED");return{type:"format",content:getTranslation(t,"*Change %0 content*",e)}}}))}}class TrackChangesImage extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ImageEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("ImageUtils"),i=e.locale;t.enableCommand("insertImage"),t.descriptionFactory.registerElementLabel("imageBlock",(e=>getTranslation(i,"ELEMENT_IMAGE",e))),t.descriptionFactory.registerElementLabel("imageInline",(e=>getTranslation(i,"ELEMENT_INLINE_IMAGE",e))),t.descriptionFactory.registerElementLabel("caption",(()=>getTranslation(i,"ELEMENT_CAPTION"))),e.plugins.has("ImageUploadEditing")&&t.enableCommand("uploadImage"),e.plugins.has("ImageBlockEditing")&&e.plugins.has("ImageInlineEditing")&&(t.enableCommand("imageTypeInline",((i,r)=>{const s=n.getClosestSelectedImageElement(e.model.document.selection);e.model.change((()=>{t.markBlockFormat(s,{commandName:"imageTypeInline",commandParams:[r]},[],"convertBlockImageToInline")}))})),t.enableCommand("imageTypeBlock",((i,r)=>{e.model.change((s=>{let o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.createRangeOn(o);const c=LivePosition.fromPosition(a.start,"toPrevious"),l=LivePosition.fromPosition(a.end,"toNext");t.forceDefaultExecution((()=>i(r))),o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.createRangeOn(o);const d=s.createRange(c,l);c.detach(),l.detach(),t.markBlockFormat(o,{commandName:"imageTypeInline",commandParams:[r]},[],"convertInlineImageToBlock"),d.start.isBefore(a.start)&&t.markInsertion(s.createRange(d.start,a.start),"convertInlineImageToBlock"),a.end.isBefore(d.end)&&t.markInsertion(s.createRange(a.end,d.end),"convertInlineImageToBlock")}))})),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","accept",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","discard",t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","discard",(([n])=>{const i=t._suggestionFactory.getSuggestionCallback("insertion","","discard");let r=n.start,s=n.end;const o=e.model.schema.getNearestSelectionRange(r,"backward"),a=e.model.schema.getNearestSelectionRange(s,"forward");o.isCollapsed&&(r=o.start),a.isCollapsed&&(s=a.end),i([e.model.createRange(r,s)])})),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","chain",o),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","chain",o)),e.plugins.has("ImageCaptionEditing")&&(t.enableCommand("toggleImageCaption",((i,r)=>{const s=e.plugins.get("ImageCaptionUtils");let o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.getCaptionFromImageModelElement(o);e.model.change((()=>{if(a)return void t.markDeletion(e.model.createRangeOn(a));const c=n.isBlockImage(o);i(r),o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.getCaptionFromImageModelElement(o),t.markInsertion(e.model.createRangeOn(a),c?null:"imageCaption")}))})),t._suggestionFactory.registerCustomCallback("insertion","imageCaption","chain",o));const r=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function s(e,i){const s=r.findIndex((({type:t,subType:n})=>e.type==t&&e.subType==n)),o=r.findIndex((({type:e,subType:t})=>i.type==e&&i.subType==t));if(s<0||o<0)return!1;const a=e.getFirstRange(),c=i.getFirstRange();if((0==s||1==s)&&2==o&&a.isIntersecting(c))return!0;if(2==s&&3==o){const e=t._findSuggestions(a,"insertion").filter((({suggestion:e,meta:t})=>t.isOwn&&"convertInlineImageToBlock"==e.subType));if(e.length>1&&c.end.isEqual(a.start))return!0;if(1==e.length&&(a.start.isEqual(c.end)||a.end.isEqual(c.start)))return!0}if(3==s&&3==o&&a.start.isBefore(c.start)){const e=a.end.nodeAfter,t=c.start.nodeBefore;return n.isBlockImage(e)&&e===t}return!1}function o(e,t){return s(e,t)?[e,t]:s(t,e)?[t,e]:null}e.plugins.has("ImageResize")&&(t.enableDefaultAttributesIntegration("resizeImage"),t.registerBlockAttribute("resizedWidth"),t.descriptionFactory.registerAttributeLabel("resizedWidth",getTranslation(i,"FORMAT_IMAGE_SIZE"))),e.plugins.has("ImageTextAlternativeEditing")&&(t.enableDefaultAttributesIntegration("imageTextAlternative"),t.registerBlockAttribute("alt")),t.descriptionFactory.registerDescriptionCallback((e=>{if(r.find((({type:t,subType:n})=>e.type==t&&e.subType==n)))return e.previous?{}:void 0})),t.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"==e.type||"deletion"==e.type){const t=e.getContainedElement();if(t&&t.is("element","caption"))return{type:"insertion"==e.type?"addObject":"removeObject",element:t,quantity:1}}})),t.descriptionFactory.registerDescriptionCallback((e=>"formatBlock"==e.type&&"convertInlineImageToBlock"==e.subType?{type:"format",content:"Inline image to block image"}:"formatBlock"==e.type&&"convertBlockImageToInline"==e.subType?{type:"format",content:"Block image to inline image"}:void 0)),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;if(!t||"alt"!=t.key)return;const n=t.newValue;return n?{type:"format",content:getTranslation(i,"*Set image text alternative:* %0",'"'+n+'"')}:{type:"format",content:getTranslation(i,"*Remove image text alternative*")}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;if(n){if("imageTextAlternative"==n.commandName){const e=n.commandParams[0].newValue;return e?{type:"format",content:getTranslation(t,"*Set image text alternative:* %0",'"'+e+'"')}:{type:"format",content:getTranslation(t,"*Remove image text alternative*")}}if("resizeImage"==n.commandName){const e=n.commandParams[0].width;return e?{type:"format",content:getTranslation(t,"*Set image width:* %0",e)}:{type:"format",content:getTranslation(t,"*Reset image width*")}}}}))}}class TrackChangesImageReplace extends Plugin{afterInit(){if(!this.editor.plugins.has("ImageEditing"))return;const e=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");t.enableDefaultAttributesIntegration("replaceImageSource"),t.registerBlockAttribute("src"),t.descriptionFactory.registerDescriptionCallback((t=>{if("attribute"!=t.type)return;const{data:n}=t;return n&&"src"==n.key?n.newValue&&n.oldValue?{type:"format",content:getTranslation(e,"*Replace image URL*")}:{type:"format",content:""}:void 0})),this._handleLegacySuggestions()}_handleLegacySuggestions(){const e=this.editor.plugins.get("TrackChangesEditing");e._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","discard",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;return n&&"replaceImageSource"==n.commandName?{type:"format",content:getTranslation(t,"*Format:* replace image URL")}:void 0}))}}class TrackChangesImageStyle extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ImageStyleEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("ImageUtils"),i={};t.enableCommand("imageStyle",((i,r)=>{const s=e.plugins.get("Users").me,o=e.commands.get("imageStyle");let a=n.getClosestSelectedImageElement(e.model.document.selection),c=e.model.createRangeOn(a),l=o.value;if(l==r.value)return;const d={commandName:"imageStyle",commandParams:[r],formatGroupId:uid()};e.model.change((()=>{if(t.getSuggestions().filter((e=>e.isInContent&&s==e.author&&("formatBlock"==e.type||"formatInline"==e.type)&&("imageStylePreApply"==e.subType||"imageStylePostApply"==e.subType)&&e.getFirstRange().isEqual(c))).forEach((e=>t.discardSuggestion(e.head))),a=n.getClosestSelectedImageElement(e.model.document.selection),c=e.model.createRangeOn(a),o.refresh(),e.commands.get("imageTypeInline").refresh(),e.commands.get("imageTypeBlock").refresh(),l=o.value,l!=r.value)return n.isInlineImage(a)&&o.shouldConvertImageType(r.value,a)?(i({...r,setImageSizes:!1}),a=n.getClosestSelectedImageElement(e.model.document.selection),void t.markBlockFormat(a,{...d,commandReversedParams:[{value:l||null,setImageSizes:!1}]},[],"imageStylePreApply")):void(n.isBlockImage(a)?t.markBlockFormat(a,d,[],"imageStylePostApply"):t.markInlineFormat(c,d,"imageStylePostApply"))}))}));for(const t of e.plugins.get("ImageStyleEditing").normalizedStyles)i[t.name]=t.title.toLowerCase();t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePostApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatInline","imageStylePostApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","accept",(([e])=>{n.setImageNaturalSizeAttributes(e.getContainedElement())})),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","discard",((e,n)=>{t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")(e,{commandName:n.commandName,commandParams:n.commandReversedParams})})),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","chain",(function(e,t){return s(e,t)?[e,t]:s(t,e)?[t,e]:null}));const r=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function s(e,i){const s=r.findIndex((({type:t,subType:n})=>e.type==t&&e.subType==n)),o=r.findIndex((({type:e,subType:t})=>i.type==e&&i.subType==t));if(s<0||o<0)return!1;const a=e.getFirstRange(),c=i.getFirstRange();if((0==s||1==s)&&2==o&&a.isIntersecting(c))return!0;if(2==s&&3==o){const e=t._findSuggestions(a,"insertion").filter((({suggestion:e,meta:t})=>t.isOwn&&"convertInlineImageToBlock"==e.subType));if(e.length>1&&c.end.isEqual(a.start))return!0;if(1==e.length&&(a.start.isEqual(c.end)||a.end.isEqual(c.start)))return!0}if(3==s&&3==o&&a.start.isBefore(c.start)){const e=a.end.nodeAfter,t=c.start.nodeBefore;return n.isBlockImage(e)&&e===t}return!1}e.model.document.registerPostFixer((()=>{let i=!1;const r=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:e,data:s}of r){const{group:r,type:o,subType:a,id:c}=t._splitMarkerName(e);if("suggestion"==r&&t.hasSuggestion(c)){if("formatBlock"==o&&("imageStylePreApply"==a||"imageStylePostApply"==a)){const e=t.getSuggestion(c);if(s.newRange){const r=e.getFirstRange().getContainedElement();if(n.isBlockImage(r))continue;t.discardSuggestion(e),i=!0}}if("insertion"==o&&"imageCaption"==a&&!s.newRange){const e=t.getSuggestion(c);e.next&&e.next.isInContent&&(t.discardSuggestion(e.next),i=!0)}}}return i})),this._registerLegacyDescription(i)}_registerLegacyDescription(e){const t=this.editor,n=t.locale;t.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((t=>{if("formatBlock"!=t.type&&"formatInline"!=t.type)return;const{data:i}=t;if(!i||"imageStyle"!=i.commandName)return;const r=i.commandParams[0].value;return s="side"===r?getTranslation(n,"FORMAT_SIDE_IMAGE"):e[r]||r,{type:"format",content:getTranslation(n,"*Format:* %0",s)};var s}))}}class TrackChangesImportWord extends Plugin{constructor(e){super(e),this._trackChangesValueDuringImport=!1,this._trackChangesExecuted=!1}afterInit(){const e=this.editor,t=e.commands.get("importWord"),n=e.commands.get("trackChanges");t&&(t.on("execute",((e,[,t])=>{this._trackChangesValueDuringImport=n.value,t.collaboration_features.track_changes=!this._trackChangesValueDuringImport}),{priority:"high"}),this.listenTo(t,"dataInsert",this._handleImportedData.bind(this)),this.listenTo(t,"dataInsert",(()=>{this._trackChangesExecuted&&(n.execute(),this._trackChangesExecuted=!1)}),{priority:"lowest"}),e.plugins.get("TrackChangesEditing").enableCommand("importWord"))}_handleImportedData(e,t){const{suggestions:n}=t,i=this.editor.commands.get("trackChanges"),r=i.value;this._trackChangesValueDuringImport!==r&&(i.execute(),this._trackChangesExecuted=!0),n&&n.forEach((({id:e,type:t,author:n,created_at:i})=>{const r={id:e,type:t,authorId:this.editor.plugins.get("Users").me.id,createdAt:new Date,data:null,hasComments:!1,attributes:{"@external":{authorName:n,createdAt:i?new Date(i):new Date,source:"importWord"}}};this.editor.plugins.get("TrackChangesEditing")._setSuggestionData(r)}))}}class TrackChangesIndent extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");if(e.plugins.has("IndentEditing")&&(t.enableCommand("indent"),t.enableCommand("outdent")),e.plugins.has("IndentBlock"))for(const e of["indentBlock","outdentBlock"])t.enableDefaultAttributesIntegration(e);const n=e.locale;t.registerBlockAttribute("blockIndent"),t.descriptionFactory.registerAttributeLabel("blockIndent",getTranslation(n,"FORMAT_INDENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");n.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:i}=e;if(!i)return;if("indentBlock"!=i.commandName&&"outdentBlock"!=i.commandName)return;const r=e.getItems()[0],s=n.descriptionFactory.getItemLabel(r);return"indentBlock"==i.commandName?{type:"format",content:getTranslation(t,"*Indent:* %0",s)}:"outdentBlock"==i.commandName?{type:"format",content:getTranslation(t,"*Outdent:* %0",s)}:void 0}))}}class TrackChangesInputCommand extends Plugin{static get requires(){return[Input]}init(){this.editor.plugins.get("TrackChangesEditing").enableCommand("input")}}class TrackChangesLink extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("LinkEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("link");t.enableDefaultAttributesIntegration("link"),t.enableDefaultAttributesIntegration("unlink"),t.registerInlineAttribute("linkHref");for(const e of n.manualDecorators)t.registerInlineAttribute(e.id),t.descriptionFactory.registerAttributeLabel(e.id,"link ("+e.label.toLowerCase()+")");t.descriptionFactory.registerDescriptionCallback((t=>{if("attribute"!=t.type)return;const{data:n}=t;if(!n||"linkHref"!=n.key)return;const i=n.newValue,r=e.locale;return{type:"format",content:null==i?getTranslation(r,"*Remove link*"):getTranslation(r,"*Set link:* %0",'"'+i+'"')}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatInline"!=e.type)return;const{data:n}=e;if(n){if("link"==n.commandName){const e=n.commandParams[0];return{type:"format",content:getTranslation(t,"*Set link:* %0",'"'+e+'"')}}return"unlink"==n.commandName?{type:"format",content:getTranslation(t,"*Remove link*")}:void 0}}))}}class TrackChangesLegacyList extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("LegacyListEditing"))return;const n=e.plugins.get("TrackChangesEditing"),i=e.plugins.has("LegacyTodoListEditing");function r(t){return()=>{const i=e.model.document.selection,r=e.commands.get(t);if(r.value)return void e.execute("paragraph",{});const s=t.slice(0,-4),o=getBlocksToMarkForListTypeChange(i.getSelectedBlocks(),s,e.model.schema);e.model.change((()=>{for(const e of o)n.markBlockFormat(e,{commandName:t,commandParams:[{forceValue:!r.value}],formatGroupId:"blockName"},getBlocksAffectedByListTypeChange(e))}))}}function s(t){return()=>{const i=getBlocksToMarkForIndentChange(e.model.document.selection.getSelectedBlocks()),r=e.model.createRange(e.model.createPositionAt(i[0],"before"),e.model.createPositionAt(i[i.length-1],"end"));e.model.change((()=>{n.markBlockFormat(r,{commandName:t,commandParams:[],formatGroupId:"listIndent"},getBlocksAffectedByIndent(i))}))}}n.enableCommand("numberedList",r("numberedList")),n.enableCommand("bulletedList",r("bulletedList")),i&&n.enableCommand("todoList",r("todoList")),n.enableCommand("indentList",s("indentList")),n.enableCommand("outdentList",s("outdentList")),i&&n.enableCommand("checkTodoList",(()=>{const t=e.commands.get("checkTodoList"),i=Array.from(t._selectedElements);i.filter((e=>e.getAttribute("todoListChecked")!=t.value)),e.model.change((()=>{for(const e of i)n.markBlockFormat(e,{commandName:"checkTodoList",commandParams:[{forceValue:!t.value}]})}))})),n.descriptionFactory.registerElementLabel("listItem",(e=>getTranslation(t,"ELEMENT_LIST_ITEM",e))),n.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;if(n){if("numberedList"==n.commandName||"bulletedList"==n.commandName||"todoList"==n.commandName)switch(n.commandName.replace("List","")){case"bulleted":return i(getTranslation(t,"ELEMENT_BULLETED_LIST"));case"numbered":return i(getTranslation(t,"ELEMENT_NUMBERED_LIST"));case"todo":return i(getTranslation(t,"ELEMENT_TODO_LIST"))}if("indentList"==n.commandName)return{type:"format",content:getTranslation(t,"*Indent:* %0",getTranslation(t,"ELEMENT_LIST_ITEM"))};if("outdentList"==n.commandName)return{type:"format",content:getTranslation(t,"*Outdent:* %0",getTranslation(t,"ELEMENT_LIST_ITEM"))};if("checkTodoList"==n.commandName)return n.commandParams[0].forceValue?{type:"format",content:getTranslation(t,"*Check item*")}:{type:"format",content:getTranslation(t,"*Uncheck item*")}}function i(e){return{type:"format",content:getTranslation(t,"*Change to:* %0",e)}}}))}}function getBlocksToMarkForListTypeChange(e,t,n){let i=Array.from(e).filter((e=>checkCanBecomeListItem(e,n)));i=i.filter((e=>!e.is("element","listItem")||e.getAttribute("listType")!=t));const r=new Set;for(const e of i)e.is("element","listItem")?r.add(getListHead(e)):r.add(e);return Array.from(r)}function checkCanBecomeListItem(e,t){return t.checkChild(e.parent,"listItem")&&!t.isObject(e)}function getBlocksToMarkForIndentChange(e){let t=Array.from(e);const n=t.findIndex((e=>"listItem"!=e.name));return n>-1&&(t=t.slice(0,n)),t}function getListHead(e){const t=e.getAttribute("listIndent");if(0==t)return e;let n=e;for(;e.previousSibling&&e.previousSibling.is("element","listItem");){const i=e.previousSibling.getAttribute("listIndent");if(i==t)n=e.previousSibling;else if(i<t)break;e=e.previousSibling}return n}function getBlocksAffectedByListTypeChange(e){const t=[];if(e.is("element","listItem")&&e.getAttribute("listIndent")>0){let n=e.nextSibling;for(;n&&"listItem"==n.name&&n.getAttribute("listIndent")==e.getAttribute("listIndent");)t.push(n),n=n.nextSibling}return t}function getBlocksAffectedByIndent(e){const t=new Set;for(const n of e){let e=n.nextSibling;for(;e&&e.getAttribute("listIndent")>n.getAttribute("listIndent");)t.add(e),e=e.nextSibling}return Array.from(t)}class TrackChangesListProperties extends Plugin{afterInit(){if(!this.editor.plugins.has("LegacyListPropertiesEditing"))return;const e=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");e.styles&&t.enableCommand("listStyle",this.handleListStyleCommand.bind(this)),e.reversed&&t.enableCommand("listReversed",this.handleListReversedCommand.bind(this)),e.startIndex&&t.enableCommand("listStart",this.handleListStartCommand.bind(this)),t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this))}handleListStyleCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocksForListStyle();this.editor.model.change((()=>{n.markMultiRangeBlockFormat(i,{commandName:"listStyle",commandParams:[{type:t.type}],formatGroupId:"listStyle"})}))}handleListReversedCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocks((e=>e.is("element","listItem")&&"numbered"===e.getAttribute("listType")));if(i.length<1)return;const r=i.map((e=>this.editor.model.createRange(this.editor.model.createPositionAt(e,"before"),this.editor.model.createPositionAt(e,0))));this.editor.model.change((()=>{n.markMultiRangeBlockFormat(r,{commandName:"listReversed",commandParams:[{reversed:t.reversed}],formatGroupId:"listReversed"})}))}handleListStartCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocks((e=>e.is("element","listItem")&&"numbered"===e.getAttribute("listType")));if(i.length<1)return;const r=i.map((e=>this.editor.model.createRange(this.editor.model.createPositionAt(e,"before"),this.editor.model.createPositionAt(e,0))));this.editor.model.change((()=>{n.markMultiRangeBlockFormat(r,{commandName:"listStart",commandParams:[{startIndex:t.startIndex}],formatGroupId:"listStart"})}))}handleDescriptions(e){if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const t=this.editor.locale,{data:n}=e;if(!n)return;let i,r;switch(n.commandName){case"listStyle":i="*Change to:* %0",r={type:"format",content:getTranslation(t,i,getTranslation(t,this._getTranslationKeyForListStyle(n.commandParams[0].type)))};break;case"listReversed":i=n.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",r={type:"format",content:getTranslation(t,i)};break;case"listStart":i="*Format:* set start index to %0",r={type:"format",content:getTranslation(t,i,n.commandParams[0].startIndex)}}return r}_getSuggestionBlocksForListStyle(){var e,t,n,i;const r=this.editor.plugins.get("LegacyListUtils");let s=Array.from(this.editor.model.document.selection.getSelectedBlocks());return(null===(e=s[0])||void 0===e?void 0:e.is("element","listItem"))&&s.unshift(...r.getSiblingNodes(this.editor.model.document.selection.getFirstPosition(),"backward")),(null===(t=s[s.length-1])||void 0===t?void 0:t.is("element","listItem"))&&s.push(...r.getSiblingNodes(this.editor.model.document.selection.getLastPosition(),"forward")),s=[...new Set(s)],(null===(i=null===(n=this.editor.model.document.selection.getFirstPosition())||void 0===n?void 0:n.parent)||void 0===i?void 0:i.is("element","listItem"))&&(s=s.filter((e=>e.is("element","listItem")))),s}_getSuggestionBlocks(e){const t=this.editor.plugins.get("LegacyListUtils");let n=Array.from(this.editor.model.document.selection.getSelectedBlocks()).filter(e).map((e=>{const n=this.editor.model.createPositionAt(e,0);return[...t.getSiblingNodes(n,"backward"),...t.getSiblingNodes(n,"forward")]})).flat();return n=[...new Set(n)],n}_getTranslationKeyForListStyle(e){return"ELEMENT_"+(this.editor.plugins.get("LegacyListUtils").getListTypeFromListStyleType(e)||"default").toUpperCase()+"_LIST_"+e.toUpperCase().replace(/-/g,"_")}}class TrackChangesMediaEmbed extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("MediaEmbedEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.enableCommand("mediaEmbed"),t.descriptionFactory.registerElementLabel("media",(e=>getTranslation(n,"ELEMENT_MEDIA",e))),e.conversion.for("dataDowncast").elementToElement({model:"media",view:(e,{writer:t,options:n})=>{if(n.showSuggestionHighlights)return t.createEmptyElement("div")},converterPriority:"high"}),e.data.downcastDispatcher.on("attribute:url:media",((e,t,n)=>{n.options.showSuggestionHighlights&&e.stop()}),{priority:"high"})}}class TrackChangesMention extends Plugin{afterInit(){const e=this.editor;e.plugins.has("MentionEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("mention")}}class TrackChangesMergeFields extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("MergeFieldsEditing"))return;e.plugins.get("TrackChangesEditing").enableCommand("insertMergeField"),e.plugins.get("TrackChangesEditing").enableCommand("insertMergeFieldBlock");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("mergeField",(e=>getTranslation(n,"ELEMENT_MERGE_FIELD",e))),t.descriptionFactory.registerElementLabel("mergeFieldBlock",(e=>getTranslation(n,"ELEMENT_MERGE_FIELD",e))),t.descriptionFactory.registerDescriptionCallback((t=>{if("insertion"!=t.type&&"deletion"!=t.type)return;const i=t.getContainedElement();if(null==i)return;if(!i.is("element","mergeField")&&!i.is("element","mergeFieldBlock"))return;const r=e.plugins.get("MergeFieldsEditing").getLabel(i.getAttribute("id"));return"insertion"==t.type?{type:"insertion",content:getTranslation(n,"*Insert:* %0",'"'+r+'" '+getTranslation(n,"ELEMENT_MERGE_FIELD"))}:{type:"deletion",content:getTranslation(n,"*Remove:* %0",'"'+r+'" '+getTranslation(n,"ELEMENT_MERGE_FIELD"))}}))}}class TrackChangesMultiLevelList extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.plugins.has("MultiLevelList")&&(t.enableDefaultAttributesIntegration("multiLevelList"),t.registerBlockAttribute("listMarkerStyle"),t.descriptionFactory.registerDescriptionCallback((e=>this.handleDescriptions(e))))}handleDescriptions(e){const t=this.editor.locale,{data:n}=e,i={type:"format",content:""};if(n&&"listMarkerStyle"==n.key){if(!n.oldValue)return{type:"format",content:getTranslation(t,"*Set format:* %0",getTranslation(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+n.newValue+")"};if(!n.newValue){let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue)return i;r=r.next}return{type:"format",content:getTranslation(t,"*Remove format:* %0",getTranslation(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+n.oldValue+")"}}}}}class TrackChangesPageBreak extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("PageBreakEditing"))return;e.plugins.get("TrackChangesEditing").enableCommand("pageBreak");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("pageBreak",(e=>getTranslation(n,"ELEMENT_PAGE_BREAK",e)))}}class TrackChangesParagraph extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Paragraph"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.descriptionFactory.registerElementLabel("paragraph",(e=>getTranslation(t,"ELEMENT_PARAGRAPH",e))),n.enableDefaultAttributesIntegration("paragraph"),n.enableCommand("insertParagraph"),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastInsertSplitMarkerSuggestion(e),{priority:"highest"}),e.data.downcastDispatcher.on("addMarker:suggestion:insertion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastInsertSplitMarkerSuggestion(e,{showActiveMarker:!1})(t,n,i)}),{priority:"highest"});const i=n.descriptionFactory;i.registerDescriptionCallback((n=>{if("insertion"!==n.type)return;const{start:r,end:s}=n.getFirstRange();if(!r.isTouching(s)||!r.nodeAfter)return;const o=e.model.schema,a=r.nodeAfter;return o.isBlock(a)&&!o.isLimit(a)&&o.checkChild(a,"$text")?{type:"insertion",content:getTranslation(t,"*Insert:* %0",i.getItemLabel(a,1))}:void 0})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;return n&&"paragraph"==n.commandName?{type:"format",content:getTranslation(t,"*Change to:* %0",getTranslation(t,"ELEMENT_PARAGRAPH"))}:void 0}))}}function downcastInsertSplitMarkerSuggestion(e,{showActiveMarker:t=!0}={}){return(n,i,r)=>{const s=e.plugins.get("TrackChangesEditing"),o=i.markerRange.start,a=i.markerRange.end,c=e.model.schema;if(!o.isTouching(a)||!o.nodeAfter)return;const l=o.nodeAfter;if(c.isBlock(l)&&!c.isLimit(l)&&c.checkChild(l,"$text")){if(!r.consumable.consume(i.markerRange,n.name))return;const{authorId:e}=s._splitMarkerName(i.markerName),o=r.writer.createUIElement("span",{class:"ck-suggestion-marker-split","data-author-id":e}),c=r.mapper.toViewPosition(a);t&&s.activeMarkers.includes(i.markerName)&&r.writer.addClass("ck-suggestion-marker--active",o),r.writer.insert(c,o),r.mapper.bindElementToMarker(o,i.markerName)}}}class TrackChangesRemoveFormat extends Plugin{afterInit(){const e=this.editor;e.plugins.has("RemoveFormatEditing")&&(e.plugins.get("TrackChangesEditing").enableDefaultAttributesIntegration("removeFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const e=this.editor;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((t=>{if("formatBlock"!=t.type&&"formatInline"!=t.type)return;const{data:n}=t;return n&&"removeFormat"==n.commandName?{type:"format",content:getTranslation(e.locale,"*Remove all formatting*")}:void 0}))}}class TrackChangesRestrictedEditingMode extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("RestrictedEditingModeEditing"))return;const t=e.plugins.get("TrackChangesEditing");t.enableCommand("goToPreviousRestrictedEditingException"),t.enableCommand("goToNextRestrictedEditingException");const n=e.plugins.get("RestrictedEditingModeEditing");n.enableCommand("trackChanges"),n.enableCommand("acceptSuggestion"),n.enableCommand("discardSuggestion"),n.enableCommand("acceptAllSuggestions"),n.enableCommand("discardAllSuggestions"),n.enableCommand("acceptSelectedSuggestions"),n.enableCommand("discardSelectedSuggestions")}}class TrackChangesShiftEnterCommand extends Plugin{static get requires(){return[ShiftEnter]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");t.enableCommand("shiftEnter"),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastSplitMergeMarker(e),{priority:"high"}),e.editing.downcastDispatcher.on("addMarker:suggestion:deletion",downcastSplitMergeMarker(e),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker(e,{showActiveMarker:!1})(t,n,i)})),t.descriptionFactory.registerElementLabel("softBreak",(t=>getTranslation(e.locale,"ELEMENT_LINE_BREAK",t)))}}function downcastSplitMergeMarker(e,{showActiveMarker:t=!0}={}){return(n,i,r)=>{const s=e.plugins.get("TrackChangesEditing");if(!r.consumable.test(i.markerRange,n.name))return;const o=e.model;for(const e of i.markerRange.getItems()){if(!e.is("element","softBreak"))continue;const n="deletion"==i.markerName.split(":")[1]?"merge":"split",{authorId:a}=s._splitMarkerName(i.markerName),c=r.writer.createUIElement("span",{class:"ck-suggestion-marker-"+n,"data-author-id":a}),l=r.mapper.toViewPosition(o.createPositionBefore(e));t&&s.activeMarkers.includes(i.markerName)&&r.writer.addClass("ck-suggestion-marker--active",c),r.writer.insert(l,c),r.mapper.bindElementToMarker(c,i.markerName)}}}class TrackChangesStandardEditingMode extends Plugin{afterInit(){const e=this.editor,t=e.model,n=e.locale;if(!e.plugins.has("StandardEditingModeEditing"))return;const i=e.plugins.get("TrackChangesEditing"),r="restrictedEditingException",s=e.commands.get(r);i.enableCommand(r,((e,n={})=>{const o=t.document.selection;if(o.isCollapsed)return void e(n);const a=void 0!==n.forceValue?n.forceValue:!s.value;t.change((()=>{const e=Array.from(o.getRanges());for(const n of e){const e=a?[n]:getRangesWithAttribute(r,n,t);for(const t of e)i.markInlineFormat(t,{commandName:r,commandParams:[{forceValue:a}]})}}))})),i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t&&t.commandName==r?t.commandParams[0].forceValue?{type:"format",content:getTranslation(n,"FORMAT_RESTRICTED_ENABLED")}:{type:"format",content:getTranslation(n,"FORMAT_RESTRICTED_DISABLED")}:void 0}))}}class TrackChangesStylesDropdown extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Style")||!e.plugins.has("DataSchema"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale,i=e.config.get("style")||{},r=e.plugins.get("GeneralHtmlSupport"),s=e.plugins.get("StyleUtils").normalizeConfig(e.plugins.get("DataSchema"),i.definitions);t.enableDefaultAttributesIntegration("style");const o=new Set;for(const e of s.block){const t=r.getGhsAttributeNameForElement(e.element);o.add(t)}const a=new Set;for(const e of s.inline){const t=r.getGhsAttributeNameForElement(e.element);a.add(t);for(const t of e.ghsAttributes)a.add(t)}for(const e of o)t.registerBlockAttribute(e),t.descriptionFactory.registerAttributeLabel(e,getTranslation(n,"FORMAT_STYLE"));for(const e of a)t.registerInlineAttribute(e),t.descriptionFactory.registerAttributeLabel(e,getTranslation(n,"FORMAT_STYLE"));this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;return n&&"style"===n.commandName?n.commandParams[0].forceValue?{type:"format",content:getTranslation(t,"*Set format:* %0",n.commandParams[0].styleName.toLowerCase())}:{type:"format",content:getTranslation(t,"*Remove format:* %0",n.commandParams[0].styleName.toLowerCase())}:void 0}))}}class TrackChangesTable extends Plugin{constructor(e){super(e),this._tablePostFixingSubtypes=["tableRow","tableColumn"],this._tableSuggestions=new Set}afterInit(){const e=this.editor,t=e.model.document.selection;if(!e.plugins.has("TableEditing"))return;const n=e.locale,i=e.plugins.get("TrackChangesEditing"),r=e.plugins.get("TableUtils");i.descriptionFactory.registerElementLabel("table",(e=>getTranslation(n,"ELEMENT_TABLE",e))),this._setupColumnsRowsFixing(),i.enableCommand("insertTable"),i.enableCommand("selectTableRow"),i.enableCommand("selectTableColumn");for(const n of["insertTableRowAbove","insertTableRowBelow"]){const s=e.commands.get(n);i.enableCommand(n,(n=>{e.model.change((e=>{n();const o="above"===s.order,a=r.getSelectionAffectedTableCells(t),c=r.getRowIndexes(a),l=o?c.first-1:c.last+1,d=a[0].findAncestor("table"),u=r.createTableWalker(d,{startRow:l,endRow:l}),h=Array.from(u).map((t=>e.createRangeOn(t.cell)));i.markMultiRangeInsertion(h,"tableRow")}))}))}for(const n of["insertTableColumnLeft","insertTableColumnRight"]){const s=e.commands.get(n);i.enableCommand(n,(n=>{e.model.change((e=>{n();const o="left"===s.order,a=r.getSelectionAffectedTableCells(t),c=r.getColumnIndexes(a),l=o?c.first-1:c.last+1,d=a[0].findAncestor("table"),u=r.createTableWalker(d,{startRow:0,column:l,includeAllSlots:!1}),h=Array.from(u).map((t=>e.createRangeOn(t.cell)));i.markMultiRangeInsertion(h,"tableColumn")}))}))}for(const n of["removeTableRow","removeTableColumn"]){const s=n.substr(11),o=s.toLowerCase(),a=o.substr(0,3)+"span",c="table"+s,l="min"+s,d="max"+s;i.enableCommand(n,(()=>{e.model.change((e=>{const s=r.getSelectionAffectedTableCells(t),u=s[0].findAncestor("table");let h;if("removeTableRow"==n){const e=r.getRowIndexes(s);h={startRow:e.first,endRow:e.last,includeAllSlots:!0}}else{const e=r.getColumnIndexes(s);h={startColumn:e.first,endColumn:e.last,includeAllSlots:!0}}const m=r.createTableWalker(u,h),g=Array.from(m).map((({cell:e})=>e)),p=uniqueValues(g.filter((e=>e.hasAttribute(a)))),f=uniqueValues(g.filter((e=>!e.hasAttribute(a)))).map((t=>e.createRangeOn(t))),y=i.markMultiRangeDeletion(f,c);if(y&&("tableRow"==y.subType||"tableColumn"==y.subType)){const t=this._getSuggestionCoords(y);for(const n of p){const i=e.createRangeOn(n),s=r.getCellLocation(n),c=n.getAttribute(a)-1,u=t[l],h=t[d];u<=s[o]&&s[o]+c<=h&&y.addRange(i)}}}))}))}function s(n){const i=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));e.model.change((t=>{const r=t.batch;n=n.filter((e=>"$graveyard"!=e.root.rootName)),t.setSelection(n),e.commands.get("removeTableRow").refresh(),e.execute("removeTableRow",{forceDefaultExecution:!0}),e.model.enqueueChange((()=>{e.model.enqueueChange(r,(e=>{const t=i.filter((e=>"$graveyard"!=e.root.rootName));t.length>0&&e.setSelection(t);for(const e of i)e.detach()}))}))}))}function o(n){e.model.change((i=>{const r=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e))),s=[];for(const e of n)for(const t of e.getItems({shallow:!0}))s.push(t);for(const t of s)"$graveyard"!=t.root.rootName&&(i.setSelection(i.createPositionAt(t,0)),e.commands.get("removeTableColumn").refresh(),e.execute("removeTableColumn",{forceDefaultExecution:!0}));const o=r.filter((e=>"$graveyard"!=e.root.rootName));o.length>0&&i.setSelection(o);for(const e of r)e.detach()}))}function a(e,t){return t.every((t=>e.some((e=>e.end.isEqual(t.start)||t.end.isEqual(e.start)))))}function c(e,t){return!e.some((e=>t.some((t=>e.isIntersecting(t)))))&&e.some((e=>t.some((t=>e.end.isTouching(t.start)))))}e.data.downcastDispatcher.on("addMarker:suggestion",((e,t,n)=>{if(!n.options.showSuggestionHighlights)return;const i=t.item;if(!i)return;const r=n.mapper.toViewElement(i);function s(e){return Array.isArray(e)?e:[e]}r&&"tableCell"===i.name&&setHighlightHandling(r,n.writer,((e,t,n)=>n.addClass(s(t.classes),e)),((e,t,n)=>n.removeClass(s(t.classes),e)))}),{priority:"highest"}),i.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"!=e.type&&"deletion"!=e.type)return;const t=e.getContainedElement();if(null!=t&&t.is("element","table")){if("insertion"==e.type){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data));if(t.length)return{type:"insertion",content:getTranslation(n,"*Insert:* %0",getTranslation(n,"ELEMENT_TABLE_WITH_TEXT",'"'+t.join(" ")+'"'))}}if("deletion"==e.type){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data));if(t.length)return{type:"deletion",content:getTranslation(n,"*Remove:* %0",getTranslation(n,"ELEMENT_TABLE_WITH_TEXT",'"'+t.join(" ")+'"'))}}}})),i.descriptionFactory.registerDescriptionCallback((e=>{if("tableRow"==e.subType){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data)),i=this._getSuggestionCoords(e),r=i.maxRow-i.minRow+1;if("insertion"==e.type)return t.length?{type:"insertion",content:getTranslation(n,"*Insert:* %0",getTranslation(n,"ELEMENT_TABLE_ROW_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"insertion",content:getTranslation(n,"*Insert:* %0",getTranslation(n,"ELEMENT_TABLE_ROW",r))};if("deletion"==e.type)return t.length?{type:"deletion",content:getTranslation(n,"*Remove:* %0",getTranslation(n,"ELEMENT_TABLE_ROW_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"deletion",content:getTranslation(n,"*Remove:* %0",getTranslation(n,"ELEMENT_TABLE_ROW",r))}}if("tableColumn"==e.subType){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data)),i=this._getSuggestionCoords(e),r=i.maxColumn-i.minColumn+1;if("insertion"==e.type)return t.length?{type:"insertion",content:getTranslation(n,"*Insert:* %0",getTranslation(n,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"insertion",content:getTranslation(n,"*Insert:* %0",getTranslation(n,"ELEMENT_TABLE_COLUMN",r))};if("deletion"==e.type)return t.length?{type:"deletion",content:getTranslation(n,"*Remove:* %0",getTranslation(n,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"deletion",content:getTranslation(n,"*Remove:* %0",getTranslation(n,"ELEMENT_TABLE_COLUMN",r))}}})),i._suggestionFactory.registerCustomCallback("insertion","tableRow","discard",s),i._suggestionFactory.registerCustomCallback("deletion","tableRow","accept",s),i._suggestionFactory.registerCustomCallback("insertion","tableColumn","discard",o),i._suggestionFactory.registerCustomCallback("deletion","tableColumn","accept",o),i._suggestionFactory.registerCustomCallback("insertion","tableColumn","join",a),i._suggestionFactory.registerCustomCallback("deletion","tableColumn","join",a),i._suggestionFactory.registerCustomCallback("insertion","tableRow","join",c),i._suggestionFactory.registerCustomCallback("deletion","tableRow","join",c)}_acceptFormatSuggestionCallbackFactory(){const e=this.editor,t=e.model.document.selection;return(n,i)=>{e.model.change((r=>{const{commandName:s,commandParams:o}=i;let a=n[0].end.nodeBefore;o&&o[0]&&!1===o[0].forceValue&&(a=n[0].start.nodeAfter);const c=r.createRangeIn(a);if("$graveyard"==c.root.rootName)return;const l=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));r.setSelection(c),e.commands.get(s).refresh(),o.push({forceDefaultExecution:!0}),e.execute(s,...o);const d=l.filter((e=>"$graveyard"!=e.root.rootName));d.length>0&&r.setSelection(d);for(const e of l)e.detach()}))}}_getCoordsForCells(e){const t=this.editor.plugins.get("TableUtils");let n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const o of e){if("$graveyard"==o.root.rootName)continue;const{row:e,column:a}=t.getCellLocation(o),c=o.hasAttribute("rowspan")?o.getAttribute("rowspan")-1:0,l=o.hasAttribute("colspan")?o.getAttribute("colspan")-1:0;n=e<n?e:n,i=e+c>i?e+c:i,r=a<r?a:r,s=a+l>s?a+l:s}return{minRow:n,maxRow:i,minColumn:r,maxColumn:s}}_setupColumnsRowsFixing(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("TableUtils");e.model.document.on("change:data",(()=>{const n=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:e,data:i}of n){const{group:n,id:r,subType:s}=t._splitMarkerName(e);if("suggestion"!=n)continue;if(null!=i.oldRange)continue;const o=t.getSuggestion(r);this._tablePostFixingSubtypes.includes(s)&&this._tableSuggestions.add(o)}}),{priority:"low"});const i=(e,t)=>{let i=!1;const r=t.createRangeOn(e),s=e.findAncestor("table"),o=n.getCellLocation(e);for(const t of this._tableSuggestions){const n=t.subType,a=n.startsWith("tablePaste"),c=n.substr(a?10:5),l=c.toLowerCase(),d=l.substr(0,3)+"span",u="min"+c,h="max"+c;if(!t.isInContent)continue;if(s!=t.getFirstRange().start.findAncestor("table"))continue;if(t.isIntersectingWithRange(r))continue;const m=e.hasAttribute(d)?e.getAttribute(d)-1:0,g=this._getSuggestionCoords(t),p=g[u],f=g[h];p<=o[l]&&o[l]+m<=f&&(t.addRange(r),i=!0)}return i};e.model.document.registerPostFixer((t=>{let n=!1;for(const r of e.model.document.differ.getChanges())if("insert"==r.type)if("tableRow"==r.name)for(const e of r.position.nodeAfter.getChildren())n=n||i(e,t);else"tableCell"==r.name&&(n=n||i(r.position.nodeAfter,t));return n}))}_getSuggestionCoords(e){return this._getCoordsForCells(e.getRanges().map((e=>e.start.nodeAfter)))}}function uniqueValues(e){return Array.from(new Set(e).values())}class TrackChangesTableMergeSplit extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor,t=e.model.document.selection,n=e.locale;if(!e.plugins.has("TableEditing"))return;const i=e.plugins.get("TrackChangesEditing"),r=e.plugins.get("TableUtils"),s=e.plugins.get(TrackChangesTable);s._tablePostFixingSubtypes.push("mergeTableCells"),i.enableCommand("mergeTableCells",(()=>{const t=r.getSelectionAffectedTableCells(e.model.document.selection);e.model.change((()=>{i.markMultiRangeBlockFormat(t,{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")}))})),e.commands.get("mergeTableCells").on("execute",((t,n)=>{e.commands.get("trackChanges").value&&(n.length>0&&n[n.length-1]&&n[n.length-1].forceDefaultExecution||i._isForcedDefaultExecutionBlock||this._areSelectedCellsMergable()||t.stop())}),{priority:"highest"});for(const t of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"]){const n=e.commands.get(t);i.enableCommand(t,(()=>{const t=e.model.document.selection.getFirstPosition().getAncestors().find((e=>e.is("element","tableCell"))),r=n.value;e.model.change((()=>{i.markMultiRangeBlockFormat([t,r],{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")}))}))}for(const t of["splitTableCellVertically","splitTableCellHorizontally"]){const n=e.commands.get(t);i.enableCommand(t,(()=>{const s=r.getSelectionAffectedTableCells(e.model.document.selection)[0],o=s.findAncestor("table"),{column:a,row:c}=r.getCellLocation(s);let l=[];if("horizontally"==n.direction){const e=r.createTableWalker(o,{startRow:c,endRow:c,includeAllSlots:!0});l=Array.from(e).map((e=>e.cell))}else{const e=r.createTableWalker(o,{column:a,includeAllSlots:!0});l=Array.from(e).map((e=>e.cell))}e.model.change((e=>{i.markBlockFormat(e.createRangeOn(s),{commandName:t,commandParams:[]},l,t)}))}))}i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t&&"mergeTableCells"==t.commandName?{type:"format",content:getTranslation(n,"*Merge cells*")}:void 0})),i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t?"splitTableCellVertically"==t.commandName?{type:"format",content:getTranslation(n,"*Split cell:* vertically")}:"splitTableCellHorizontally"==t.commandName?{type:"format",content:getTranslation(n,"*Split cell:* horizontally")}:void 0:void 0}));const o=s._acceptFormatSuggestionCallbackFactory();for(const e of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"])i._suggestionFactory.registerCustomCallback("formatBlock",e,"accept",o);for(const e of["splitTableCellVertically","splitTableCellHorizontally"])i._suggestionFactory.registerCustomCallback("formatBlock",e,"accept",o);i._suggestionFactory.registerCustomCallback("formatBlock","mergeTableCells","accept",(n=>{e.model.change((i=>{const r=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));i.setSelection(n),e.commands.get("mergeTableCells").refresh(),e.execute("mergeTableCells",{forceDefaultExecution:!0});const s=r.filter((e=>"$graveyard"!=e.root.rootName));s.length>0&&i.setSelection(s);for(const e of r)e.detach()}))}));for(const t of["mergeTableCellUp","mergeTableCellDown","mergeTableCellLeft","mergeTableCellRight"]){const n=e.commands.get(t);n.on("set:isEnabled",((t,i,r)=>{if(r){const i=e.model.document.selection.getFirstPosition().getAncestors().find((e=>e.is("element","tableCell")));this._areMergableCells(n.value,i)||(t.return=!1,t.stop())}}),{priority:"low"})}}_areSelectedCellsMergable(){const e=this.editor.commands.get("mergeTableCells"),t=this.editor.plugins.get("TableUtils");if(!e.isEnabled)return!1;const n=t.getSelectionAffectedTableCells(this.editor.model.document.selection);for(const e of n)for(const t of n)if(e!=t&&!this._areMergableCells(e,t))return!1;return!0}_areMergableCells(e,t){const n=this.editor.plugins.get("TrackChangesEditing"),i=this.editor.model.createRangeOn(e),r=this.editor.model.createRangeOn(t),s=new Set,o=new Set;for(const e of n.getSuggestions())if(("insertion"==e.type||"deletion"==e.type||"mergeTableCells"==e.subType)&&e.isInContent)for(const t of e.getRanges())t.containsRange(i,!0)&&s.add(e.type+":"+e.author.id),t.containsRange(r,!0)&&o.add(e.type+":"+e.author.id);if(s.size!=o.size)return!1;for(const e of s)if(!o.has(e))return!1;return!0}}class TrackChangesTableHeadings extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;if(!e.plugins.has("TableEditing"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("setTableRowHeader"),n.enableDefaultAttributesIntegration("setTableColumnHeader"),n.registerBlockAttribute("headingRows"),n.registerBlockAttribute("headingColumns"),n.descriptionFactory.registerAttributeLabel("headingRows",getTranslation(t,"FORMAT_HEADER_ROW")),n.descriptionFactory.registerAttributeLabel("headingColumns",getTranslation(t,"FORMAT_HEADER_COLUMN")),this._handleLegacySuggestions()}_handleLegacySuggestions(){const e=this.editor.plugins.get("TrackChangesEditing"),t=this.editor.plugins.get("TableUtils"),n=this.editor.plugins.get(TrackChangesTable)._acceptFormatSuggestionCallbackFactory();function i({showActiveMarker:n=!0,setDataAttribute:i=!0}={}){return(r,s,o)=>{const{type:a,id:c}=e._splitMarkerName(s.markerName),l=e.getSuggestion(c),d=l.data;if("formatBlock"!=l.type||!d||"setTableColumnHeader"!=d.commandName)return;if(s.item)return void r.stop();if(!o.consumable.consume(s.markerRange,r.name))return;const u=s.markerRange.start.nodeAfter,h=s.markerRange.end.nodeBefore,m=u.parent.parent,{column:g}=t.getCellLocation(u),{column:p}=t.getCellLocation(h);for(let r=g;r<=p;r++){const l=t.createTableWalker(m,{column:r,includeAllSlots:!1});for(const t of l){const r=t.cell,l=o.mapper.toViewElement(r);o.writer.addClass("ck-suggestion-marker-"+a,l),i&&o.writer.setAttribute("data-suggestion",c,l),o.mapper.bindElementToMarker(l,s.markerName),n&&(e.activeMarkers.includes(s.markerName)?o.writer.addClass("ck-suggestion-marker--active",l):o.writer.removeClass("ck-suggestion-marker--active",l))}}}}e._suggestionFactory.registerCustomCallback("formatBlock","setTableRowHeader","accept",n),e._suggestionFactory.registerCustomCallback("formatBlock","setTableColumnHeader","accept",n),this.editor.editing.downcastDispatcher.on("addMarker:suggestion",i(),{priority:"highest"}),this.editor.data.downcastDispatcher.on("addMarker:suggestion",((e,t,n)=>{n.options.showSuggestionHighlights&&i({showActiveMarker:!1,setDataAttribute:!1})(e,t,n)}),{priority:"highest"}),this.editor.editing.downcastDispatcher.on("removeMarker:suggestion",((t,n,i)=>{const{type:r,id:s}=e._splitMarkerName(n.markerName),o=e.getSuggestion(s),a=o.data;if("formatBlock"!=o.type||!a||"setTableColumnHeader"!=a.commandName)return;const c=i.mapper.markerNameToElements(n.markerName);if(c)for(const e of c)i.writer.removeClass("ck-suggestion-marker-"+r,e),i.writer.removeClass("ck-suggestion-marker--active",e),i.writer.removeAttribute("data-suggestion",e),i.mapper.unbindElementFromMarkerName(e,n.markerName)}),{priority:"highest"}),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;function n(e){return{type:"format",content:getTranslation(t,"*Format:* %0",e)}}e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:i}=e;if(i){if("setTableRowHeader"==i.commandName){const e=i.commandParams[0].forceValue;return n(getTranslation(t,e?"FORMAT_HEADER_ROW":"FORMAT_REGULAR_ROW"))}if("setTableColumnHeader"==i.commandName){const e=i.commandParams[0].forceValue;return n(getTranslation(t,e?"FORMAT_HEADER_COLUMN":"FORMAT_REGULAR_COLUMN"))}}}))}}const tableCellStyleAttributeNames=["tableCellBorderWidth","tableCellBorderColor","tableCellBorderStyle","tableCellHorizontalAlignment","tableCellVerticalAlignment","tableCellBackgroundColor","tableCellPadding"],tableCellStyleAttributesObject=Object.fromEntries(tableCellStyleAttributeNames.map((e=>[e,null])));class TrackChangesTableClipboard extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;if(!e.plugins.has("TableClipboard"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("TableUtils"),i=e.plugins.get(TrackChangesTable),r=e.plugins.get("TableClipboard");i._tablePostFixingSubtypes.push("tablePasteRow","tablePasteColumn"),e.model.schema.register("tableCellSuggestion",{allowIn:"tableCell",allowContentOf:"tableCell",isLimit:!0}),e.conversion.elementToElement({model:"tableCellSuggestion",view:"suggestion-td"});let s=null;e.model.on("insertContent",((i,o)=>{const[a,c]=o,l=o[o.length-1];l&&l.forceDefaultExecution||t._isForcedDefaultExecutionBlock||this.editor.commands.get("trackChanges").value&&isPasteTableIntoTable(a,c,e.model,n,r)&&(i.stop(),s={cells:[],insertionRanges:[],deletionRanges:[],rowInsertionRanges:[],rowInsertionIndexes:[],columnInsertionRanges:[],columnInsertionIndexes:[]},e.model.change((()=>{e.model.insertContent(o[0],o[1],o[2],{forceDefaultExecution:!0});const n=uid(),{rowInsertionRanges:i,columnInsertionRanges:r,insertionRanges:a,deletionRanges:c,cells:l}=s;i.length&&t.markMultiRangeInsertion(i,"tablePasteRow",{tablePasteChainId:n}),r.length&&t.markMultiRangeInsertion(r,"tablePasteColumn",{tablePasteChainId:n}),a.length&&(t.markMultiRangeInsertion(a,"tablePaste",{tablePasteChainId:n,skipNestingCheck:!0}),a.forEach((e=>{var t;return null===(t=e.detach)||void 0===t?void 0:t.call(e)}))),c.length&&(t.markMultiRangeDeletion(c,"tablePaste",{tablePasteChainId:n,skipNestingCheck:!0}),c.forEach((e=>{var t;return null===(t=e.detach)||void 0===t?void 0:t.call(e)})));const d=t.markMultiRangeBlockFormat(l.map((({element:e})=>e)),{formatGroupId:uid()},[],"tablePasteCell",{tablePasteChainId:n});if(d){const t=d.getMarkers(),n=[];for(const{element:i,attributes:r}of l){if(!r)continue;const s=e.model.createRangeOn(i),o=t.find((e=>e.getRange().isEqual(s)));o&&n.push([o.name,r])}n.length&&d.setAttribute("markerAttributes",Object.fromEntries(n))}s=null})))}),{priority:priorities.high+10}),e.plugins.get("TableClipboard").on("_replaceTableSlotCell",((e,t)=>{const[n,i,,r]=t;if(!s)return;e.stop();const o=n.cell,a=i,c=isEmpty(o),l=isEmpty(a);e.return=o;let d=null,u=null;if(l||c)if(c&&!l){r.remove(o.getChild(0));for(const e of Array.from(a.getChildren()))r.insert(e,o,"end");const e=s.rowInsertionIndexes.includes(n.row),t=s.columnInsertionIndexes.includes(n.column);e||t||(d=LiveRange.fromRange(r.createRangeIn(o)))}else l&&!c&&(u=r.createRangeIn(o));else{const e=r.createElement("tableCellSuggestion"),t=r.createElement("tableCellSuggestion");r.wrap(r.createRangeIn(o),t),r.insert(e,o,0);for(const t of Array.from(a.getChildren()))r.insert(t,e,"end");d=LiveRange.fromRange(r.createRangeOn(e)),u=LiveRange.fromRange(r.createRangeOn(t))}const h=Array.from(a.getAttributes()).filter((([e])=>tableCellStyleAttributeNames.includes(e)));s.cells.push({element:o,attributes:h.length?Object.fromEntries(h):null}),d&&s.insertionRanges.push(d),u&&s.deletionRanges.push(u)}),{priority:"high"}),n.on("insertColumns",((t,i)=>{const[r,o={}]=i;if(!s)return;const a=o.at||0,c=o.columns||1;s.columnInsertionIndexes=new Array(c).fill(a).map(((e,t)=>e+t));for(const{cell:t}of n.createTableWalker(r,{startColumn:a,endColumn:a+c-1}))s.columnInsertionRanges.push(e.model.createRangeOn(t))}),{priority:"low"}),n.on("insertRows",((t,i)=>{const[r,o={}]=i;if(!s)return;const a=o.at||0,c=o.rows||1;s.rowInsertionIndexes=new Array(c).fill(a).map(((e,t)=>e+t));for(const{cell:t}of n.createTableWalker(r,{startRow:a,endRow:a+c-1}))s.rowInsertionRanges.push(e.model.createRangeOn(t))}),{priority:"low"}),t.descriptionFactory.registerDescriptionCallback((t=>{if(t.subType&&t.subType.startsWith("tablePaste"))return t.previous?{}:{type:"insertion",content:getTranslation(e.locale,"*Replace table cells*")}}));const o=()=>!1;for(const e of["tablePaste","tablePasteColumn","tablePasteRow","tablePasteCell"])t._suggestionFactory.registerCustomCallback("insertion",e,"join",o),t._suggestionFactory.registerCustomCallback("deletion",e,"join",o),t._suggestionFactory.registerCustomCallback("formatBlock",e,"join",o);t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","discard",o),t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","accept",((t,n,i)=>{const r=t.map((e=>e.getContainedElement())).filter((e=>e)),o=new Map(r.map((e=>[e,null])));if(s)for(const{element:e,attributes:t}of s.cells)t&&o.set(e,t);else if(i&&i.markerAttributes)for(const[t,n]of Object.entries(i.markerAttributes)){const i=e.model.markers.get(t),r=i?i.getRange().getContainedElement():null;r&&o.set(r,n)}e.model.change((e=>{for(const[t,n]of o)e.setAttributes({...tableCellStyleAttributesObject,...n},t)}))}));const a=(n,i)=>{t._suggestionFactory.registerCustomCallback(n,"tablePaste",i,((r,s,o)=>{e.model.change((e=>{const a=[];for(const e of r){const t=e.start.nodeAfter;t.is("element","tableCellSuggestion")&&a.push(t)}t._suggestionFactory.getSuggestionCallback(n,null,i)(r,s,o);for(const t of a)"$graveyard"!=t.root.rootName&&e.unwrap(t)}))}))};a("insertion","accept"),a("insertion","discard"),a("deletion","accept"),a("deletion","discard"),t._suggestionFactory.registerCustomCallback("insertion","tablePasteRow","discard",(e=>{const t=e.map((e=>e.getContainedElement())),r=t[0].findAncestor("table"),{minRow:s,maxRow:o}=i._getCoordsForCells(t);n.removeRows(r,{at:s,rows:o-s+1})})),t._suggestionFactory.registerCustomCallback("insertion","tablePasteColumn","discard",(e=>{const t=e.map((e=>e.getContainedElement())),r=t[0].findAncestor("table"),{minColumn:s,maxColumn:o}=i._getCoordsForCells(t);n.removeColumns(r,{at:s,columns:o-s+1})}));const c=(e,n)=>{if(!n.subType||!n.subType.startsWith("tablePaste"))return;const i=n.attributes.tablePasteChainId,r=t.getSuggestions().filter((e=>e.isInContent&&e.attributes&&e.attributes.tablePasteChainId==i));r.length&&n.getAllAdjacentSuggestions().length!=r.length&&r.reduce(((e,t)=>(e.next=t,t.previous=e,t)))};function l(e,n=!0){const{id:i,authorId:r}=t._splitMarkerName(e.markerName),s=["ck-suggestion-marker","ck-suggestion-marker-insertion"],o=t.activeMarkers.includes(e.markerName);return o&&s.push("ck-suggestion-marker--active"),{classes:s,attributes:{"data-suggestion":i,"data-author-id":r},priority:o&&n?3010:3e3}}t.on("suggestionLoaded",c,{priority:"high"}),t.on("suggestionUnloaded",c,{priority:"high"}),e.model.document.registerPostFixer((()=>{let n=!1;const i=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:r,data:s}of i){const{group:i,type:o,id:a}=t._splitMarkerName(r);if("suggestion"!=i||"deletion"!=o||s.oldRange)continue;if(!t.hasSuggestion(a))continue;const c=t.getSuggestion(a).getRanges(),l=e.plugins.get("Users").me;for(const e of t.getSuggestions())if(e.isInContent&&e.author==l&&"formatBlock"==e.type&&"tablePasteCell"==e.subType&&e.getRanges().every((e=>c.some((t=>t.containsRange(e,!0))))))for(const t of e.getAllAdjacentSuggestions())t.isInContent&&(t.discard(),n=!0)}return n})),e.model.document.registerPostFixer((n=>{const i=e.commands.get("redo");if(!i||!i._createdBatches.has(n.batch))return!1;let r=!1;const s=e.plugins.get("Users").me,o=e.model.document.differ.getChanges(),a=Array.from(e.model.document.differ.getChangedMarkers()).filter((({name:e,data:n})=>{const{group:i,subType:r,authorId:o}=t._splitMarkerName(e);return"suggestion"==i&&"tablePaste"==r&&o==s.id&&!n.oldRange}));for(const e of o){if("insert"!=e.type||"tableCellSuggestion"!=e.name||1!=e.length)continue;const t=n.createRange(e.position,e.position.getShiftedBy(1));if(!a.find((({data:e})=>e.newRange.isEqual(t))))for(const{name:e,data:i}of a)if(t.containsRange(i.newRange)){n.updateMarker(e,{range:t}),r=!0;break}}return r})),e.model.document.registerPostFixer((n=>{let i=!1;const r=e.plugins.get("Users").me,s=t.getSuggestions().filter((e=>e.isInContent&&e.author==r)),o=new Set,a=new Set;for(const e of s)if("tablePaste"==e.subType)for(const t of e.getMarkers()){const n=t.getRange().getContainedElement();if(n)if(n.is("element","tableCellSuggestion")&&isEmpty(n)){e.removeMarker(t.name),o.add(n),i=!0;const r=n.nextSibling,s=n.previousSibling,c=r&&r.is("element","tableCellSuggestion"),l=s&&s.is("element","tableCellSuggestion");c&&!o.has(r)&&a.add(r),l&&!o.has(s)&&a.add(s)}else n.is("element","paragraph")&&n.isEmpty&&(e.removeMarker(t.name),i=!0)}else if("tablePasteCell"==e.subType){if(!e.attributes||!e.attributes.tablePasteChainId)continue;const t=e.attributes.markerAttributes;if(t&&Object.keys(t).length)continue;const n=e.attributes.tablePasteChainId;let r=!0,o=!0;for(const t of s)if(t.subType&&t.subType.startsWith("tablePaste")){if(!t.attributes.tablePasteChainId){o=!1;break}if(t.id!=e.id&&t.attributes.tablePasteChainId==n){r=!1;break}}o&&r&&(e.removeMarkers(),i=!0)}for(const e of o)n.remove(e);for(const e of a)n.unwrap(e);return i})),e.conversion.for("editingDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:e=>l(e),converterPriority:"high"}),e.conversion.for("dataDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:(e,t)=>t.options.showSuggestionHighlights?l(e,!1):null,converterPriority:"high"});const d=e.editing.view;this.listenTo(d.document,"clipboardOutput",((e,t)=>{const n=[];for(const e of d.createRangeIn(t.content).getItems())e.is("element","suggestion-td")&&n.push(e);d.change((e=>{for(const t of n)e.move(e.createRangeIn(t),e.createPositionBefore(t)),e.remove(t)}))}))}}function isEmpty(e){if(e.isEmpty)return!0;const t=e.getChild(0);return t.is("element","paragraph")&&t.isEmpty}function isPasteTableIntoTable(e,t,n,i,r){if(t&&!t.is("documentSelection"))return!1;const s=r.getTableIfOnlyTableInContent(e,n);if(!s||!isPlainTable(s,void 0,i))return!1;const o=i.getSelectionAffectedTableCells(n.document.selection);if(!o.length)return!1;const a=o[0].findAncestor("table"),c=i.getRowIndexes(o),l=i.getColumnIndexes(o),d={startRow:c.first,endRow:c.last,startColumn:l.first,endColumn:l.last};return 1==o.length&&(d.endRow+=i.getRows(s)-1,d.endColumn+=i.getColumns(s)-1),isPlainTable(a,d,i)}function isPlainTable(e,t={},n){for(const{isAnchor:i,cellHeight:r,cellWidth:s}of n.createTableWalker(e,{includeAllSlots:!0,...t}))if(!i||1!=r||1!=s)return!1;return!0}class TrackChangesTableColumnResize extends Plugin{afterInit(){if(!this.editor.plugins.has("TableColumnResizeEditing"))return;const e=this.editor.plugins.get("TrackChangesEditing");e.enableCommand("resizeTableWidth",this.handleResizeTableWidthCommand.bind(this)),e._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","discard",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),e.descriptionFactory.registerDescriptionCallback(this.handleSuggestionDescription.bind(this))}handleResizeTableWidthCommand(e,t){const n=this.editor.plugins.get("TrackChangesEditing"),i=this.editor.plugins.get("TableColumnResizeEditing"),r=t.table||this.editor.model.document.selection.getSelectedElement();this.editor.model.change((()=>{const s=i.getColumnGroupElement(r);let o=s?i.getTableColumnsWidths(s):null,a=r.getAttribute("tableWidth")||null;const c=t.tableWidth||a,l=t.columnWidths||o,d=this.editor.plugins.get("Users").me;for(const e of n.getSuggestions()){const t=e.getContainedElement();if("resizeTable"===e.subType&&t===r){e.author!==d&&e.discard();const t=e.data.commandParams;a=t[0].tableWidth,o=t[0].columnWidths;break}}e({table:r,tableWidth:c,columnWidths:l}),n.markBlockFormat(r,{commandName:"resizeTableWidth",commandParams:[{tableWidth:a,columnWidths:o}],formatGroupId:"resizeTable"},[],"resizeTable")}))}handleSuggestionDescription(e){if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;if(t&&"resizeTable"===t.formatGroupId){const e="*Format:* resize table";return{type:"format",content:getTranslation(this.editor.locale,e)}}}}class TrackChangesTemplate extends Plugin{afterInit(){const e=this.editor;e.plugins.has("Template")&&e.plugins.get("TrackChangesEditing").enableCommand("insertTemplate")}}class TrackChangesTableOfContents extends Plugin{afterInit(){const e=this.editor;if(!e.commands.get("insertTableOfContents"))return;e.plugins.get("TrackChangesEditing").enableCommand("insertTableOfContents");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("tableOfContents",(e=>getTranslation(n,"ELEMENT_TABLE_OF_CONTENTS",e)))}}class TrackChangesTitle extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Title"))return;const t=e.plugins.get("TrackChangesEditing");t.descriptionFactory.registerElementLabel("title-content",(()=>getTranslation(e.locale,"ELEMENT_TITLE"))),e.model.document.registerPostFixer((n=>{let i=!1;const r=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:s,data:o}of r){const{group:r}=t._splitMarkerName(s);if("suggestion"!==r||!o.newRange)continue;const a=o.newRange,c=a.end.nodeBefore;if(!c||!c.is("element","title-content"))continue;if(!a.start.isTouching(a.end))continue;const l=e.model.schema.getNearestSelectionRange(a.end,"forward");if(l&&l.isCollapsed){const e=n.createRange(a.start,l.start);e.isEqual(a)||(n.updateMarker(s,{range:e}),i=!0)}i||(n.removeMarker(s),i=!0)}return i}))}}class TrackChangesUndo extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.plugins.has("UndoEditing")&&(t.enableCommand("undo"),t.enableCommand("redo"))}}class TrackChangesTableCaption extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;e.plugins.has("TableCaptionEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("toggleTableCaption")}}class TrackChangesTableProperties extends Plugin{constructor(e){super(e),this.tableProperties=["tableBorderColor","tableBorderStyle","tableBorderWidth","tableAlignment","tableWidth","tableHeight","tableBackgroundColor"],this.tableCellProperties=["tableCellBorderColor","tableCellBorderStyle","tableCellBorderWidth","tableCellPadding","tableCellWidth","tableCellHeight","tableCellBackgroundColor","tableCellHorizontalAlignment","tableCellVerticalAlignment"]}static get pluginName(){return"TrackChangesTableProperties"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){const e=this.editor.plugins.get("TrackChangesEditing");if(this.editor.plugins.has("TablePropertiesEditing")){for(const t of this.tableProperties)e.enableCommand(t,((e,n)=>{const i=this.editor.model.document.selection.getFirstPosition().findAncestor("table");this._handlePropertyChange(t,[i],this.tableProperties,"tableProperties",e,n)}));e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","discard",((e,t)=>this.handleDiscardAction(this.tableProperties,e,t))),e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","join",(()=>!1))}if(this.editor.plugins.has("TableCellPropertiesEditing")){for(const t of this.tableCellProperties)e.enableCommand(t,((e,n)=>{const i=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this._handlePropertyChange(t,i,this.tableCellProperties,"tableCellProperties",e,n)}));e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","discard",((e,t)=>this.handleDiscardAction(this.tableCellProperties,e,t))),e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","join",(()=>!1))}e.descriptionFactory.registerDescriptionCallback((e=>this.handleSuggestionDescription(e)))}_handlePropertyChange(e,t,n,i,r,s){const o=this.editor.plugins.get("TrackChangesEditing");this.editor.model.enqueueChange(s.batch,(()=>{for(const e of t)if(this._getSuggestion(e,i))r(s);else{const t={};for(const i of n){const n=e.getAttribute(i);void 0!==n&&(t[i]=n)}r(s),o.markBlockFormat(e,{commandParams:[t]},[],i)}}))}handleDiscardAction(e,t,n){const i=t[0].start.nodeAfter,r=n.commandParams[0];this.editor.model.change((t=>{for(const n of e)void 0!==r[n]?t.setAttribute(n,r[n],i):t.removeAttribute(n,i)}))}handleSuggestionDescription(e){if(e.data)switch(e.subType){case"tableProperties":return{type:"format",content:getTranslation(this.editor.locale,"*Format:* change table properties")};case"tableCellProperties":return{type:"format",content:getTranslation(this.editor.locale,"*Format:* change table cell properties")}}}_getSuggestion(e,t){const n=this.editor.plugins.get("TrackChangesEditing");for(const i of n.getSuggestions({skipNotAttached:!0})){const n=i.getContainedElement();if(i.subType===t&&n===e)return i}return null}}const renameAttributeKey="$elementName";class TrackChangesEditing extends Plugin{static get requires(){return["CommentsRepository",Users,PendingActions,TrackChangesAIAssistant,TrackChangesAlignment,TrackChangesBasicStyles,TrackChangesBlockQuote,TrackChangesBookmark,TrackChangesCKBox,TrackChangesCaseChange,TrackChangesCodeBlock,TrackChangesComments,TrackChangesDeleteCommand,TrackChangesEnterCommand,TrackChangesFindAndReplace,TrackChangesFont,TrackChangesFormatPainter,TrackChangesHeading,TrackChangesHighlight,TrackChangesHorizontalLine,TrackChangesHtmlEmbed,TrackChangesImage,TrackChangesImageStyle,TrackChangesImageReplace,TrackChangesImportWord,TrackChangesIndent,TrackChangesInputCommand,TrackChangesLegacyList,TrackChangesListProperties,TrackChangesMultiLevelList,TrackChangesLink,TrackChangesList,TrackChangesDocumentListProperties,TrackChangesMediaEmbed,TrackChangesMention,TrackChangesMergeFields,TrackChangesPageBreak,TrackChangesParagraph,TrackChangesRemoveFormat,TrackChangesRestrictedEditingMode,TrackChangesShiftEnterCommand,TrackChangesStandardEditingMode,TrackChangesStylesDropdown,TrackChangesTable,TrackChangesTableMergeSplit,TrackChangesTableHeadings,TrackChangesTableCaption,TrackChangesTableClipboard,TrackChangesTableColumnResize,TrackChangesTableOfContents,TrackChangesTableProperties,TrackChangesTemplate,TrackChangesTitle,TrackChangesUndo]}static get pluginName(){return"TrackChangesEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._recordAttributeSuggestions=!1,this.set("activeMarkers",[]),this.on("change:activeMarkers",((t,n,i,r)=>{this._model.change((()=>{for(const t of[...r,...i])this._model.markers.has(t)&&e.editing.reconvertMarker(t)}))})),this.descriptionFactory=new SuggestionDescriptionFactory(this.editor.model.schema,this.editor.locale),this._adapter=null,this._suggestionFactory=new SuggestionFactory(this.editor),this._suggestions=new Map,this._commentsRepository=e.plugins.get("CommentsRepository"),this._enabledCommands=new Set,this._model=this.editor.model,this._suggestionState=new WeakMap,this._isForcedDefaultExecutionBlock=!1,this._blockAttributeKeys=new Set([renameAttributeKey]),this._inlineAttributeKeys=new Set,e.config.define("trackChanges.trackFormatChanges","default"),this._trackFormatChanges=e.config.get("trackChanges.trackFormatChanges"),e.config.define("trackChanges.mergeNestedSuggestions",!0),this._mergeNestedSuggestions=e.config.get("trackChanges.mergeNestedSuggestions"),this.trackChangesCommand=new TrackChangesCommand(e,this._enabledCommands),this._initAriaMarkerChangeAnnouncements()}init(){const e=this.editor,t=(e,t)=>{if("attribute"!=e)return"ck-suggestion-marker-"+e;const n=t.split("|")[0];return this._isBlockAttribute(n)?"ck-suggestion-marker-formatBlock":"ck-suggestion-marker-formatInline"};e.conversion.for("editingDowncast").markerToHighlight({model:"suggestion",view:e=>{const{id:n,authorId:i,type:r,subType:s}=this._splitMarkerName(e.markerName),o=["ck-suggestion-marker",t(r,s)];let a=3e3;return this.activeMarkers.includes(e.markerName)&&(o.push("ck-suggestion-marker--active"),a=3010),"deletion"==r&&(a+=5),{classes:o,attributes:{"data-suggestion":n,"data-author-id":i},priority:a}}}),e.conversion.for("dataDowncast").add((t=>{t.on("addMarker:suggestion",((t,n,i)=>{if(!i.options.showSuggestionHighlights)return;const r=n.item;if(!r)return;const s=i.mapper.toViewElement(r);e.model.schema.isObject(r)&&s&&!s.getCustomProperty("widget")&&s.is("containerElement")&&toWidget(s,i.writer)}),{priority:"high"})})),e.conversion.for("dataDowncast").markerToHighlight({model:"suggestion",view:(e,n)=>{if(!n.options.showSuggestionHighlights)return null;const{type:i,subType:r}=this._splitMarkerName(e.markerName);return{classes:["ck-suggestion-marker",t(i,r)],priority:3e3}}});const n=({showActiveMarkers:t=!0,isAttributeSuggestion:n=!1}={})=>(i,r,s)=>{if(!r.item)return;const{id:o,authorId:a}=this._splitMarkerName(r.markerName);if(n){const e=this._suggestions.get(o),t=this._getAttributeKey(e);if(!this._isBlockAttribute(t))return}if(r.item.is("selection"))return void s.consumable.consume(r.item,i.name);const c=s.mapper.toViewElement(r.item);if(r.item.is("element")&&e.model.schema.isBlock(r.item)&&!c.getCustomProperty("addHighlight")){s.writer.addClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock"],c),s.writer.setAttribute("data-suggestion",o,c),s.writer.setAttribute("data-author-id",a,c),s.mapper.bindElementToMarker(c,r.markerName),t&&(this.activeMarkers.includes(r.markerName)?s.writer.addClass("ck-suggestion-marker--active",c):s.writer.removeClass("ck-suggestion-marker--active",c));for(const t of e.model.createRangeIn(r.item).getItems())s.consumable.consume(t,i.name);s.consumable.consume(r.item,i.name)}};e.conversion.for("dataDowncast").add((e=>{e.on("addMarker:suggestion:formatBlock",((e,t,i)=>{i.options.showSuggestionHighlights&&n({showActiveMarkers:!1})(e,t,i)}),{priority:"highest"})})),e.conversion.for("dataDowncast").add((e=>{e.on("addMarker:suggestion:attribute",((e,t,i)=>{i.options.showSuggestionHighlights&&n({showActiveMarkers:!1,isAttributeSuggestion:!0})(e,t,i)}),{priority:"highest"})})),e.conversion.for("dataDowncast").markerToData({model:"suggestion",view:(e,t)=>t.options.showSuggestionHighlights?null:{group:"suggestion",name:e.substr(11)}}),e.conversion.for("upcast").elementToElement({view:{name:"suggestion",attributes:{id:/^\w/,"suggestion-type":/^\w/}},model:(e,{writer:t})=>{let n="suggestion:"+e.getAttribute("suggestion-type")+":"+e.getAttribute("id");return e.getAttribute("marker-count")&&(n+=":"+e.getAttribute("marker-count")),t.createElement("$marker",{"data-name":n})}}),e.conversion.for("upcast").dataToMarker({view:"suggestion"}),e.conversion.for("editingDowncast").add((e=>{e.on("addMarker:suggestion:formatBlock",n(),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("addMarker:suggestion:attribute",n({isAttributeSuggestion:!0}),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("removeMarker:suggestion:formatBlock",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.getCustomProperty("addHighlight")||(n.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],e),n.writer.removeAttribute("data-suggestion",e),n.writer.removeAttribute("data-author-id",e),n.mapper.unbindElementFromMarkerName(e,t.markerName))}),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("removeMarker:suggestion:attribute",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(!i)return;const{id:r}=this._splitMarkerName(t.markerName),s=this._suggestions.get(r),o=this._getAttributeKey(s);if(this._isBlockAttribute(o))for(const e of i)e.getCustomProperty("addHighlight")||(n.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],e),n.writer.removeAttribute("data-suggestion",e),n.writer.removeAttribute("data-author-id",e),n.mapper.unbindElementFromMarkerName(e,t.markerName))}),{priority:"high"})})),e.model.document.registerPostFixer((t=>{let n=!1;const i=Array.from(e.model.document.differ.getChangedMarkers()),r=new Set;for(const{name:s,data:o}of i){const{group:i,type:a,subType:c,id:l}=this._splitMarkerName(s);if("suggestion"!==i)continue;const d=this._suggestions.get(l);if(null!=o.newRange){"formatInline"==a&&(n=n||trimFormatInlineSuggestionRange(o.newRange,s,t,e.model.schema));const i="attribute"==a&&this._isBlockAttribute(c.split("|")[0]);if(o.newRange.isCollapsed||"$graveyard"==o.newRange.root.rootName||"formatBlock"==a&&!isCorrectFormatBlockSuggestionRange(o.newRange)||i&&!isCorrectFormatBlockSuggestionRange(o.newRange)||"deletion"==a&&!isCorrectDeletionSuggestionRange(o.newRange))t.removeMarker(s),n=!0;else{if(!d||!d.isInContent)continue;if(o.newRange&&o.oldRange&&o.newRange.isEqual(o.oldRange))continue;r.add(d)}}}return r.size>0&&(n=!!this._joinWithAdjacentSuggestions(r)||n),n})),e.model.document.registerPostFixer((t=>{let n=!1;for(const i of e.model.document.differ.getChanges())if("insert"==i.type)for(const i of this._suggestions.values()){if(i.isMultiRange||!i.isInContent)continue;const r="formatBlock"==i.type,s=this._getAttributeKey(i),o=s&&this._isBlockAttribute(s);if(!r&&!o)continue;const a=i.getFirstRange();if(a.start.parent!=a.end.parent&&!a.end.isAtEnd){const r=e.model.createPositionAt(a.start.nodeAfter,"end"),s=e.model.createRange(a.start,r);t.updateMarker(i.getFirstMarker(),{range:s}),n=!0}}return n})),e.model.document.registerPostFixer((e=>this._processAttributeChanges(e))),e.model.document.registerPostFixer((e=>!e.batch.isLocal&&this._processAttributeSuggestions(e))),e.model.on("_afterChanges",(()=>{this._recordAttributeSuggestions=!1})),e.model.document.on("change:data",((t,n)=>{if(!n.isLocal||n.isUndo)return;if(!this._recordAttributeSuggestions)return;const i=e.model.document.differ.getChanges();if(0==i.length)return;const r=[],s=i.filter((e=>"attribute"==e.type)),o=i.filter((e=>"insert"==e.type&&"$text"!=e.name));for(const t of s)this._isRegisteredAttribute(t.attributeKey)&&r.push({key:t.attributeKey,newValue:t.attributeNewValue,oldValue:t.attributeOldValue,range:extendRange(t.range,e.model)});for(const t of o){if("rename"!=t.action&&"refresh"!=t.action)continue;const n=createBlockFormatRangeForElement(t.position.nodeAfter,e.model),i=t.before;"rename"==t.action&&r.push({key:renameAttributeKey,newValue:t.name,oldValue:i.name,range:n});for(const[e,s]of i.attributes){if(!this._isRegisteredAttribute(e))continue;const i=t.attributes.get(e);s!==i&&r.push({key:e,newValue:i,oldValue:s,range:n})}for(const[e,s]of t.attributes)this._isRegisteredAttribute(e)&&(i.attributes.has(e)||r.push({key:e,newValue:s,oldValue:null,range:n}))}0!=r.length&&e.model.enqueueChange(n,(e=>{const t=uid();for(const{range:e,key:n,oldValue:i,newValue:s}of r)this.markAttributeChange(e,n,i,s,{groupId:t});this._reduceExistingSuggestions(e,r)}))}),{priority:"lowest"}),e.model.markers.on("update:suggestion",((e,t,n)=>{if(null==n){const{id:e}=this._splitMarkerName(t.name),n=this._suggestions.get(e);n&&n.addMarkerName(t.name)}})),e.model.document.on("change:data",(()=>{const t=Array.from(e.model.document.differ.getChangedMarkers()).filter((e=>"suggestion"===this._splitMarkerName(e.name).group));if(0===t.length)return;t.sort(((e,t)=>{const n=e.data.oldRange,i=t.data.oldRange;return null===n&&null===i?0:null===n&&null!==i?-1:null!==n&&null===i?1:n.start.isBefore(i.start)?-1:1}));const n=new Set,i=new Set;for(const{name:e,data:r}of t){const{id:t}=this._splitMarkerName(e);if(null===r.oldRange){const t=this._handleNewSuggestionMarker(e);i.add(t)}else{const e=this._suggestions.get(t);null!==r.newRange||e.isInContent?(n.add(e.head),i.add(e)):this._removeSuggestion(e)}}i.size>0&&this._refreshSuggestionsChain(i);for(const e of n)this.fire("suggestionChanged",e)})),e.model.on("applyOperation",((t,n)=>{const i=n[0];if(!this._suggestions.size)return;if(!i.isDocumentOperation)return;if(i.batch.isUndo||!i.batch.isLocal)return;let r,s;switch(i.type){case"insert":r=e.model.createPositionAt(i.position),s=r.getShiftedBy(i.howMany);break;case"split":r=e.model.createPositionAt(i.splitPosition),s=e.model.createPositionAt(i.moveTargetPosition);break;case"move":r=e.model.createPositionAt(i.targetPosition),s=r.getShiftedBy(i.howMany);break;default:return}const o=e.model.createRange(r,s);e.model.change((()=>{for(const{suggestion:e,meta:t}of this._findSuggestions(o)){if(e.isMultiRange)continue;if("formatInline"==e.type)continue;const n=this._getAttributeKey(e);if(n&&this._isBlockAttribute(n)&&"split"!=i.type)continue;const a=e.data&&e.data.multipleBlocks;("formatBlock"!=e.type||"split"==i.type&&!a)&&(t.containsRangeInObject||"insertion"==e.type&&t.isOwn||e.getFirstRange().containsRange(o)&&this._breakSuggestionMarker(e,r,s))}}))}),{priority:"lowest"}),e.model.on("deleteContent",((t,n)=>{const i=n[0],r=n[1];if(r&&r.forceDefaultExecution)return;if(this._isForcedDefaultExecutionBlock)return;if(!this.trackChangesCommand.value)return;if(i.isCollapsed)return;const s=e.model.schema,{start:o,end:a}=i.getFirstRange(),c=o.nodeAfter&&s.isLimit(o.nodeAfter)?null:s.getNearestSelectionRange(o,"forward"),l=a.nodeBefore&&s.isLimit(a.nodeBefore)?null:s.getNearestSelectionRange(a,"backward"),d=e.model.createRange(c?c.start:o,l?l.end:a);e.model.change((t=>{this.markDeletion(d);const n=e.model.schema.getNearestSelectionRange(d.start);i.is("documentSelection")?t.setSelection(n):i.setTo(n)})),t.stop()}),{priority:priorities.normal+10}),e.model.on("insertContent",((t,n)=>{const i=n[n.length-1];i&&i.forceDefaultExecution||this._isForcedDefaultExecutionBlock||this.trackChangesCommand.value&&(e.model.change((()=>{let i=e.model.insertContent(n[0],n[1],n[2],{forceDefaultExecution:!0});if(!i)return;t.return=i.clone();const r=i.end.nodeBefore,s=e.model.schema;r&&s.isBlock(r)&&!s.isObject(r)&&(i=e.model.createRange(i.start,e.model.createPositionAt(r,"end"))),this.markInsertion(i)})),t.stop())}),{priority:"high"}),this.editor.commands.add("trackChanges",this.trackChangesCommand),this.enableCommand("trackChanges");const i=new AcceptSuggestionCommand(e,this._suggestions);e.commands.add("acceptSuggestion",i),this.enableCommand("acceptSuggestion");const r=new DiscardSuggestionCommand(e,this._suggestions);e.commands.add("discardSuggestion",r),this.enableCommand("discardSuggestion"),e.commands.add("acceptAllSuggestions",new ExecuteOnAllSuggestionsCommand(e,i,this._suggestions)),this.enableCommand("acceptAllSuggestions"),e.commands.add("discardAllSuggestions",new ExecuteOnAllSuggestionsCommand(e,r,this._suggestions)),this.enableCommand("discardAllSuggestions"),e.commands.add("acceptSelectedSuggestions",new ExecuteOnSelectedSuggestionsCommand(e,i,this._suggestions)),this.enableCommand("acceptSelectedSuggestions"),e.commands.add("discardSelectedSuggestions",new ExecuteOnSelectedSuggestionsCommand(e,r,this._suggestions)),this.enableCommand("discardSelectedSuggestions");const s=e.plugins.get("CommentsRepository");this.listenTo(s,"addComment",((e,{threadId:t})=>{const n=this._suggestions.get(t);n&&n.commentThread&&1===n.commentThread.length&&this._updateSuggestionData(t,{hasComments:!0})}),{priority:"low"}),this.listenTo(s,"removeComment",((e,{threadId:t})=>{const n=this._suggestions.get(t);n&&n.commentThread&&!n.commentThread.length&&this._updateSuggestionData(t,{hasComments:!1})}),{priority:"low"})}afterInit(){checkLicense(this)}set adapter(e){if(this._adapter)throw new CKEditorError("track-changes-adapter-already-set",this);this._adapter=e}get adapter(){return this._adapter}getSuggestions({skipNotAttached:e=!1,toJSON:t=!1}={}){const n=[];for(const t of this._suggestions.values())e&&!t.isInContent||n.push(t);return t?n.map((e=>e.toJSON())):n}getSuggestion(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-suggestion-not-found",this);return t}hasSuggestion(e){return this._suggestions.has(e)}addSuggestionData(e){const{authorId:t,id:n,attributes:i}=e,[r,s]=e.type.split(":"),o=this._suggestions.get(n)||this._createSuggestion(r,s,n,t,i);if(this._addThreadToSuggestion(o),this._checkSuggestionCorrectness(o,r,s||null,t),o.createdAt=e.createdAt,o._isDataLoaded=!0,i&&i["@external"]){const e=i["@external"],t=this._getExternalAuthor(e.authorName);o.authoredAt=e.createdAt,o.author=t,o.isExternal=!0}else o.authoredAt=e.createdAt;switch(e.data&&(o.data=e.data),e.attributes&&(o.attributes=e.attributes),this._adapter&&this._adapter.addSuggestion||(o._saved=!0),this._suggestionState.get(o)){case"notReady":this._suggestionState.set(o,"dataReady");break;case"markerReady":o.isInContent?(this._joinWithAdjacentSuggestions(new Set([o])),this._refreshSuggestionsChain(new Set([o])),this._suggestionState.set(o,"ready"),this.fire("suggestionLoaded",o)):this._suggestionState.set(o,"removed")}return o}acceptSuggestion(e){this.forceDefaultExecution((()=>{this.editor.model.change((()=>{for(const t of e.getAllAdjacentSuggestions())t.accept()}))}))}discardSuggestion(e){this.forceDefaultExecution((()=>{this.editor.model.change((()=>{for(const t of e.getAllAdjacentSuggestions())t.discard()}))}))}enableCommand(e,t){const n=this.editor.commands.get(e);if(!n)throw new CKEditorError("track-changes-command-not-found",this,{commandName:e});if(this._enabledCommands.has(n))throw new CKEditorError("track-changes-enable-command-twice",this,{commandName:e});this._enabledCommands.add(n),t&&n.on("execute",((e,i)=>{this.trackChangesCommand.value&&(this._isForcedDefaultExecutionBlock||(i.length>0&&i[i.length-1]&&i[i.length-1].forceDefaultExecution?i.pop():(e.return=t(((...e)=>n.execute(...e,{forceDefaultExecution:!0})),...i),e.stop())))}),{priority:"high"})}forceDefaultExecution(e){let t,n;const i=this._isForcedDefaultExecutionBlock;this._isForcedDefaultExecutionBlock=!0;try{t=e()}catch(e){n=e}return i||(this._isForcedDefaultExecutionBlock=!1),n&&CKEditorError.rethrowUnexpectedError(n,this),t}markInsertion(e,t=null,n={}){if(e.isCollapsed)return null;const i=this.editor.plugins.get("Users").me;for(const{suggestion:i,meta:r}of this._findSuggestions(e,"insertion"))if(r.isOwn){if(!r.isNextTo){if(r.containsRangeInObject){if(!this._mergeNestedSuggestions||!_areSimilarAttributes(i,n))continue;return i}if(_areSimilarAttributes(i,n))return i;this._breakSuggestionMarker(i,e.start,e.end);break}if(t==i.subType&&_areSimilarAttributes(i,n)){const t=i.getFirstRange();return t.start.isEqual(e.end)?this._setSuggestionRange(i,this._model.createRange(e.start,t.end)):this._setSuggestionRange(i,this._model.createRange(t.start,e.end)),i}}const r=uid(),s=i.id,o=t?"insertion:"+t:"insertion",a=this._setSuggestionData({id:r,type:o,createdAt:new Date,authorId:s,attributes:n});return this._addSuggestionMarker(o,r,s,e),a}markMultiRangeInsertion(e,t="multi",n={}){const i=this.editor.plugins.get("Users").me,r=this._suggestionFactory.getSuggestionCallback("insertion",t,"join");for(const s of this.getSuggestions())if(s.author.id==i.id&&"insertion"==s.type&&s.subType==t&&_areSimilarAttributes(s,n)&&(r(s.getRanges(),e)||r(e,s.getRanges()))){for(const t of e)s.addRange(t);return s}for(const{suggestion:t,meta:i}of this._findSuggestions(e,"insertion")){if(!i.isOwn)continue;if(!this._mergeNestedSuggestions&&i.containsRangeInObject)continue;if(!_areSimilarAttributes(t,n))continue;let r=!0;for(const n of t.getRanges())for(const t of e)if(!n.containsRange(t)){r=!1;break}if(r)return t}const s=uid(),o=i.id,a="insertion:"+t,c=this._setSuggestionData({id:s,type:a,createdAt:new Date,authorId:o,attributes:n});for(const t of e)this._addSuggestionMarker(a,s,o,t,Suggestion.getMultiRangeId());return c}markInlineFormat(e,t,n=null,i={}){if(n=n||createFormatSubType(t),e.isCollapsed)return null;if("never"===this._trackFormatChanges){const r=this._suggestionFactory.getSuggestionCallback("formatInline",n,"accept");return this.forceDefaultExecution((()=>r([e],t,i))),null}const r=this.editor.plugins.get("Users").me,s=[];if("always"!==this._trackFormatChanges)for(const{suggestion:t,meta:n}of this._findSuggestions(e,"insertion"))n.isOwn&&!n.isInsideObject&&s.push(...t.getRanges());const o=getIntersectionsWithMultipleRanges(e,s),a=getDifferencesWithMultipleRanges(e,s);o.length&&this._model.change((()=>{for(const e of o){const r=this._suggestionFactory.getSuggestionCallback("formatInline",n,"accept");this.forceDefaultExecution((()=>r([e],t,i)))}}));for(const e of a){let s=null,o=e.start,a=e.end;for(const{suggestion:t,meta:r}of this._findSuggestions(e,"formatInline")){if(!r.isOwn)continue;if(t.subType!=n)continue;if(!_areSimilarAttributes(t,i))continue;const c=t.getFirstRange();if(c.containsRange(e,!0))return null;o=o.isBefore(c.start)?o:c.start,a=a.isAfter(c.end)?a:c.end,s?c.start.isBefore(s.getFirstRange().start)?(s.removeMarkers(),s=t):t.removeMarkers():s=t}const c=this._model.createRange(o,a);if(s)this._setSuggestionRange(s,c);else{const e=uid(),s=r.id;this._setSuggestionData({id:e,type:"formatInline:"+n,data:t,createdAt:new Date,authorId:s,attributes:i}),this._addSuggestionMarker("formatInline:"+n,e,s,c)}}return null}markBlockFormat(e,t,n=[],i=null,r={}){t.formatGroupId||(t.formatGroupId=t.commandName),t.multipleBlocks=e.is("range"),i=i||createFormatSubType(t);const s=n.map((e=>createBlockFormatRangeForElement(e,this._model))),o=e.is("range")?e:createBlockFormatRangeForElement(e,this._model);if("never"===this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e([o],t,r))),null}s.push(o);let a=!0;for(const e of s)if(!this._rangeIsInLocalUserInsertion(e)){a=!1;break}if(a&&"always"!==this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e([o],t,r))),null}let c=null,l=o.start,d=o.end;for(const{suggestion:e,meta:n}of this._findSuggestions(o,"formatBlock")){if(!n.isOwn)continue;if(n.isNextTo||n.containsRangeInObject||n.isInsideObject)continue;if(e.data.formatGroupId!=t.formatGroupId)continue;if(!_areSimilarAttributes(e,r))continue;const s=e.getFirstRange();if(e.subType==i){if(s.containsRange(o,!0))return null;l=l.isBefore(s.start)?l:s.start,d=d.isAfter(s.end)?d:s.end,c?s.start.isBefore(c.getFirstRange().start)?(c.removeMarkers(),c=e):e.removeMarkers():c=e}else{const t=o.getIntersection(s);this._cutOutSuggestionMarker(e,t)}}const u=this.editor.plugins.get("Users").me,h=uid(),m=u.id;if(c)return this._setSuggestionRange(c,this._model.createRange(l,d)),c;{const e=this._setSuggestionData({id:h,type:"formatBlock:"+i,data:t,createdAt:new Date,authorId:m,attributes:r});return this._addSuggestionMarker("formatBlock:"+i,h,m,this._model.createRange(l,d)),e}}markMultiRangeBlockFormat(e,t,n=[],i=null,r={}){t.formatGroupId||(t.formatGroupId=t.commandName);const s=e[0];t.multipleBlocks=s.is("range"),i=i||createFormatSubType(t);const o=n.map((e=>createBlockFormatRangeForElement(e,this._model))),a=s.is("range")?e:e.map((e=>createBlockFormatRangeForElement(e,this._model)));if("never"===this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e(a,t,r))),null}o.push(...a);let c=!0;for(const e of o)if(!this._rangeIsInLocalUserInsertion(e)){c=!1;break}if(c&&"always"!==this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e(a,t,r))),null}const l=this.editor.plugins.get("Users").me;for(const e of this.getSuggestions()){if(e.author.id!=l.id)continue;if("formatBlock"!=e.type||e.data.formatGroupId!=t.formatGroupId)continue;if(!_areSimilarAttributes(e,r))continue;const n=e.subType==i;for(let t=0;t<a.length;t++){const i=a[t];for(const r of e.getMarkers()){const s=r.getRange();if(i.isEqual(s)){n?(a.splice(t,1),t--):e.removeMarker(r.name);break}}}}if(0==a.length)return null;const d=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"join");for(const e of this.getSuggestions())if(e.author.id==l.id&&"formatBlock"==e.type&&e.data.formatGroupId==t.formatGroupId&&e.subType==i&&_areSimilarAttributes(e,r)&&(d(e.getRanges(),a)||d(a,e.getRanges()))){for(const t of a)e.addRange(t);return e}const u=uid(),h=l.id,m="formatBlock:"+i,g=this._setSuggestionData({id:u,type:m,data:t,createdAt:new Date,authorId:h,attributes:r});for(const e of a)this._addSuggestionMarker(m,u,h,e,Suggestion.getMultiRangeId());return g}markDeletion(e,t=null,n={}){if(e.isCollapsed)return null;const i=this.editor.plugins.get("Users").me,r=new LiveRange(e.start,e.end);for(const{suggestion:e,meta:i}of this._findSuggestions(r,"insertion"))if(i.isOwn&&!i.isNextTo)if(e.isMultiRange){const i=e.getRanges().filter((e=>"$graveyard"!=e.root.rootName));if(i.every((e=>r.containsRange(e,!0)))&&e.discard(),i.some((e=>e.containsRange(r,!0)))){const e=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>e([r],null,n))),null}}else{const t=r.getIntersection(e.getFirstRange());null!==t&&e._onDiscard([t],null,n)}if(r.detach(),r.isCollapsed||"$graveyard"==r.root.rootName)return null;let s=null,o=r.start,a=r.end;const c=this._findSuggestions(r,"deletion");for(const{suggestion:e,meta:t}of c){const i=this._model.createRange(o,a);if(t.isOwn&&(this._mergeNestedSuggestions||!t.containsRangeInObject&&!t.isInsideObject))if(e.isMultiRange){if(!_areSimilarAttributes(e,n))continue;let t=!0;for(const n of e.getRanges()){if(n.containsRange(i,!0))return e;i.containsRange(n)||(t=!1)}t&&e.discard()}else{const t=e.getFirstRange();if(t.containsRange(i,!0))return e;if(!_areSimilarAttributes(e,n)){i.containsRange(t)?e.removeMarkers():t.containsPosition(o)?o=t.end:t.containsPosition(a)&&(a=t.start);continue}o=o.isBefore(t.start)?o:t.start,a=a.isAfter(t.end)?a:t.end,n=Object.assign({},e.attributes),s?t.start.isBefore(s.getFirstRange().start)?(s.removeMarkers(),s=e):e.removeMarkers():s=e}}if(s)return this._setSuggestionRange(s,this._model.createRange(o,a)),s;{const e=uid(),r=this._model.createRange(o,a),s=i.id,c=t?"deletion:"+t:"deletion",l=this._setSuggestionData({id:e,type:c,createdAt:new Date,authorId:s,attributes:n});return this._addSuggestionMarker(c,e,s,r),l}}markMultiRangeDeletion(e,t="multi",n={}){const i=this.editor.plugins.get("Users").me,r=e.map((e=>new LiveRange(e.start,e.end))),s=new Set;for(const{suggestion:e,meta:t}of this._findSuggestions(r,"insertion"))t.isOwn&&!t.isNextTo&&s.add(e);for(const i of s)if(i.isMultiRange){const s=i.getRanges();if((!i.attributes||!i.attributes.skipNestingCheck)&&s.every((e=>r.some((t=>t.containsRange(e,!0)))))&&i.discard(),r.every((e=>s.some((t=>t.containsRange(e,!0)))))){const i=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>i(e,null,n))),null}}else{const e=i.getFirstRange();if(r.some((t=>t.containsRange(e,!0)))&&i.discard(),r.every((t=>e.containsRange(t,!0)))){const e=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>e(r,null,n))),null}}const o=this._suggestionFactory.getSuggestionCallback("deletion",t,"join");let a=null;for(const e of this.getSuggestions())if(e.author.id==i.id&&e.isInContent&&"deletion"==e.type&&e.subType==t&&_areSimilarAttributes(e,n)&&(o(e.getRanges(),r)||o(r,e.getRanges())))if(a){if(e.commentThread&&e.commentThread.length)continue;for(const t of e.getRanges())a.isIntersectingWithRange(t)||a.addRange(t);e.removeMarkers()}else{a=e;for(const t of r)e.isIntersectingWithRange(t)||e.addRange(t)}if(a)return a;s.clear();for(const{suggestion:e,meta:t}of this._findSuggestions(r,"deletion"))t.isOwn&&(this._mergeNestedSuggestions||!t.containsRangeInObject&&!t.isInsideObject)&&_areSimilarAttributes(e,n)&&s.add(e);for(const e of s){const t=e.getRanges();if((!n||!n.skipNestingCheck)&&r.every((e=>t.some((t=>t.containsRange(e,!0))))))return e;(!e.attributes||!e.attributes.skipNestingCheck)&&t.every((e=>r.some((t=>t.containsRange(e,!0)))))&&e.discard()}const c=uid(),l=i.id,d="deletion:"+t,u=this._setSuggestionData({id:c,type:d,createdAt:new Date,authorId:l,attributes:n});for(const e of r)e.detach(),e.isCollapsed||"$graveyard"==e.root.rootName||this._addSuggestionMarker(d,c,l,e,Suggestion.getMultiRangeId());return u}markAttributeChange(e,t,n,i,r){if(e.isCollapsed)return[];if("never"===this._trackFormatChanges)return[];const s=this.editor.plugins.get("Users").me.id,o=Array.from(this._suggestions.values()).filter((n=>"attribute"==n.type&&n.data.key==t&&n.isIntersectingWithRange(e)));if("default"===this._trackFormatChanges){const t=this._findSuggestions(e,"insertion").filter((({meta:e})=>e.isOwn&&!e.isInsideObject&&!e.isNextTo)).map((({suggestion:e})=>e));o.unshift(...t)}const a=new Map([[e,n]]);for(const e of o){const r="attribute"==e.type?e.data.oldValue:void 0,s=e.getFirstRange(),o=Array.from(a.keys()).find((e=>e.isIntersecting(s)));if(!o)continue;const c=o.getDifference(s);this._isBlockAttribute(t)&&"insertion"==e.type&&0!=c.length||(a.delete(o),c.forEach((e=>{a.set(e,n)})),"insertion"!=e.type&&r!=i&&a.set(o.getIntersection(s),r))}const c=[];for(const[e,n]of a){const o=uid(),a={key:t,oldValue:n,newValue:i};t.length>37&&console.warn("Creating a suggestion for attribute with too long attribute key. This may lead to errors. Change the attribute key to a value shorter than 37 characters.",{key:t});const l=("attribute:"+t+"|"+createFormatSubType({newValue:i})).substring(0,60),d=this._setSuggestionData({id:o,type:l,data:a,createdAt:new Date,authorId:s,attributes:r});c.push(d),this._addSuggestionMarker(l,o,s,e)}return c}enableDefaultAttributesIntegration(e){this.enableCommand(e,((e,...t)=>{this._recordAttributeChanges((()=>{e(...t)}))}))}registerBlockAttribute(e){this._blockAttributeKeys.add(e)}registerInlineAttribute(e){this._inlineAttributeKeys.add(e)}_getAttributeKey(e){return"attribute"==e.type?_getAttributeKeyFromSubType(e.subType):null}_setSuggestionRange(e,t){const n=e.getFirstMarker();this._model.change((e=>{e.updateMarker(n,{range:t})}))}_addThreadToSuggestion(e){const t=e.id,n=this.editor.config.get("collaboration.channelId");this._commentsRepository.hasCommentThread(t)||this._commentsRepository.addCommentThread({channelId:n,threadId:t,isResolvable:!1,isSubmitted:!0});const i=this._commentsRepository.getCommentThread(t);i.unbind("isRemovable"),i.isRemovable=!1,e.commentThread=i}_checkSuggestionCorrectness(e,t,n,i){if(e.type!=t||e.subType!=n||e.creator.id!=i)throw this.editor.enableReadOnlyMode("track-changes-suggestion-data-mismatch"),new CKEditorError("track-changes-suggestion-data-mismatch",this)}_cutOutSuggestionMarker(e,t){const n=e.getFirstRange();if(t.isEqual(n))e.removeMarkers();else if(n.containsRange(t)){const i=this._model.createPositionAt(t.start.nodeBefore,"end");this._setSuggestionRange(e,this._model.createRange(n.start,i));const r=uid(),s=e.creator.id,o=e.type+":"+e.subType;this._setSuggestionData({id:r,type:o,createdAt:new Date,authorId:s,data:e.data,attributes:e.attributes});const a=this._model.createPositionAt(t.end.parent,"after"),c=this._model.createRange(a,n.end);this._addSuggestionMarker(o,r,s,c)}else if(n.containsPosition(t.start)){const i=this._model.createPositionAt(t.start.nodeBefore,"end");this._setSuggestionRange(e,this._model.createRange(n.start,i))}else{const i=this._model.createPositionAt(t.end.parent,"after");this._setSuggestionRange(e,this._model.createRange(i,n.end))}}_rangeIsInLocalUserInsertion(e){for(const{suggestion:t,meta:n}of this._findSuggestions(e,"insertion")){if(!n.isOwn)continue;const i=t.getRanges();for(const t of i)if(!e.getDifference(t).length)return!0}return!1}_getAuthorFromId(e){const t=this.editor.plugins.get("Users").getUser(e);if(!t)throw new CKEditorError("track-changes-user-not-found",this);return t}_getExternalAuthor(e){const t=this.editor.plugins.get("Users"),n=hashObject("external:"+e);return t.getUser(n)||t.addUser({id:n,name:e})}_createSuggestion(e,t,n,i,r){const s=this._getAuthorFromId(i),o=this._suggestionFactory.buildSuggestion(e,t,n,s,r,(e=>{this._updateSuggestionData(n,{attributes:e});const t=this.getSuggestion(n);this._joinWithAdjacentSuggestions(new Set([t])),this._refreshSuggestionsChain(new Set([t]))}));return this.listenTo(o,"accept",(()=>{this._updateSuggestionData(n,{state:"accepted"})}),{priority:"high"}),this.listenTo(o,"discard",(()=>{this._updateSuggestionData(n,{state:"rejected"})}),{priority:"high"}),this._suggestions.set(n,o),this._suggestionState.set(o,"notReady"),o}_splitMarkerName(e){const t=e.split(":");return{group:t[0],type:t[1],subType:t.length>=5?t[2]:null,id:t.length<5?t[2]:t[3],authorId:t.length<5?t[3]:t[4],markerCount:6==t.length?t[5]:null}}_breakSuggestionMarker(e,t,n){const i=e.getFirstRange(),r=i.start,s=i.end;this._setSuggestionRange(e,this._model.createRange(r,t));const o=uid(),a=e.creator.id,c=e.type+(e.subType?":"+e.subType:"");this._setSuggestionData({id:o,type:c,createdAt:new Date,authorId:a,originalSuggestionId:e.id,attributes:e.attributes,data:e.data});const l=this._getAttributeKey(e);("formatBlock"==e.type||l&&this._isBlockAttribute(l))&&(n=this._model.createPositionBefore(n.parent)),this._addSuggestionMarker(c,o,a,this._model.createRange(n,s))}_findSuggestions(e,t=null){const n=[],i=this.editor.plugins.get("Users").me;Array.isArray(e)||(e=[e]);for(const r of this.getSuggestions()){if(!r.isInContent)continue;if(t&&r.type!=t)continue;let s=!1;for(const t of r.getRanges()){for(const o of e){const e=o.start.isEqual(t.end)||o.end.isEqual(t.start);if(e||o.getIntersection(t)){const a=o.containsRange(t)&&_isInObject(this._model.schema,t.start,o),c=t.containsRange(o)&&_isInObject(this._model.schema,o.start,t);n.push({suggestion:r,meta:{isOwn:i==r.author,isNextTo:e,isInsideObject:a,containsRangeInObject:c}}),s=!0;break}}if(s)break}}return n}_addSuggestionMarker(e,t,n,i,r){this._model.change((s=>{let o="suggestion:"+e+":"+t+":"+n;r&&(o=o+":"+r),s.addMarker(o,{range:i,usingOperation:!0,affectsData:!0})}))}_removeSuggestion(e){const t=e.previous,n=e.next;e.previous=null,e.next=null,null!=t&&t.next==e&&(t.next=n),null!=n&&n.previous==e&&(n.previous=t),"ready"==this._suggestionState.get(e)&&(this._suggestionState.set(e,"removed"),this.fire("suggestionUnloaded",e,t,n))}_setSuggestionData(e){const t=e.id,n=this.addSuggestionData(e);if(this._adapter&&this._adapter.addSuggestion){const i=this.editor.plugins.get("PendingActions"),r=n.hasComments,s=n.subType?n.type+":"+n.subType:n.type,o=this.editor.locale,a=i.add(getTranslation(o,"PENDING_ACTION_SUGGESTION")),c={id:t,type:s,hasComments:r,data:e.data||null,originalSuggestionId:e.originalSuggestionId||null,attributes:n.attributes};this._adapter.addSuggestion(c).then((e=>{n._saved=!0,i.remove(a),e&&e.createdAt&&(this._suggestions.get(t).createdAt=e.createdAt)})).catch((e=>{throw logWarning("error-saving-suggestion-data-suggestion-discarded"),this.editor.model.enqueueChange({isUndoable:!1},(()=>{n.discard()})),n.stopListening(),this._suggestions.delete(n.id),this._suggestionState.delete(n),e}))}return n}_isBlockAttribute(e){return this._blockAttributeKeys.has(e)}_updateSuggestionData(e,t){const n=this.editor.plugins.get("PendingActions"),i=this.getSuggestion(e);if(this._adapter&&this._adapter.updateSuggestion)if(i._saved){const i=n.add(getTranslation(this.editor.locale,"PENDING_ACTION_SUGGESTION"));this._adapter.updateSuggestion(e,t).then((()=>{n.remove(i)}))}else i.on("change:_saved",(()=>{this._updateSuggestionData(e,t)}))}_getSuggestionData(e){if(!this._adapter||!this._adapter.getSuggestion)throw new CKEditorError("track-changes-adapter-missing-getsuggestion",this);return this._adapter.getSuggestion(e)}_handleNewSuggestionMarker(e){const{id:t,type:n,subType:i,authorId:r}=this._splitMarkerName(e),s=this._suggestions.get(t)||this._createSuggestion(n,i,t,r,{});switch(this._checkSuggestionCorrectness(s,n,i,r),this._suggestionState.get(s)){case"notReady":this._getSuggestionData(t).then((e=>{let n=Promise.resolve();e.hasComments&&(n=this._commentsRepository.fetchCommentThread({channelId:this.editor.config.get("collaboration.channelId"),threadId:t})),n.then((()=>{this.addSuggestionData(e)._saved=!0}))})),this._suggestionState.set(s,"markerReady");break;case"removed":this._updateSuggestionData(t,{state:"open"});case"dataReady":this._suggestionState.set(s,"ready"),this.fire("suggestionLoaded",s);break;case"ready":this.fire("suggestionChanged",s)}return s.addMarkerName(e),s}_refreshSuggestionsChain(e){const t=Array.from(e),n=t.filter((e=>"attribute"==e.type));this._refreshAttributeSuggestionsChain(n);const i=t.filter((e=>!e.isMultiRange&&"attribute"!=e.type)),r=this.getSuggestions({skipNotAttached:!0}).filter((e=>!e.isMultiRange&&"attribute"!=e.type)),s=r.filter((t=>!e.has(t))),o=new Map(r.map((e=>[e,this._suggestionFactory.getSuggestionCallback(e.type,e.subType,"chain")]))),a=new Map(r.map((e=>[e,e.getFirstRange()]))),c=new Set,l=new Set;for(let e=0;e<i.length;e++)u(i[e],i,e+1);for(let e=0;e<i.length;e++)u(i[e],s,0);const d=new Set;for(let e=0;e<i.length;e++){const t=i[e];!l.has(t)&&t.previous&&(d.add(t.previous),t.previous.next===t&&(t.previous.next=null),t.previous=null),!c.has(t)&&t.next&&(d.add(t.next),t.next.previous===t&&(t.next.previous=null),t.next=null)}function u(e,t,n){for(let i=n;i<t.length;i++){const n=h(e,t[i]);n&&(n[0].next=n[1],n[1].previous=n[0],c.add(n[0]),l.add(n[1]))}}function h(e,t){if(e.author.id!==t.author.id)return null;const n=o.get(e)(e,t,a.get(e),a.get(t));return n&&o.get(t)(e,t,a.get(e),a.get(t))?n[1].commentThread&&n[1].commentThread.length?null:n:null}d.size&&this._refreshSuggestionsChain(d)}_refreshAttributeSuggestionsChain(e){if(0==e.length)return;const t=this.getSuggestions({skipNotAttached:!0}).filter((e=>"attribute"==e.type&&e._isDataLoaded)),n=[],i=new Map;for(const e of t){const t=hashObject(e.attributes);i.has(t)||(i.set(t,n.length),n.push([]));const r=i.get(t);n[r].push(e)}!function(){n.sort(((e,t)=>{const n=e[0].createdAt,i=t[0].createdAt;return n==i?e[0].attributes.groupId<t[0].attributes.groupId?-1:1:n<i?-1:1}));for(const e of n)e.sort(((e,t)=>e.id<t.id?-1:1))}();for(let e=0;e<n.length;e++){if(0==n[e].length)continue;const t=[];for(let i=e+1;i<n.length;i++)0!=n[i].length&&r(n[e],n[i])&&t.push(i);for(const i of t)n[e]=n[e].concat(n[i]),n[i]=[]}for(const e of n)for(let t=0;t<e.length;t++){const n=e[t+1]||null;e[t].next!==n&&(e[t].next=n)}for(const e of n)for(let t=0;t<e.length;t++){const n=e[t-1]||null;e[t].previous!==n&&(e[t].previous=n)}function r(e,t){return(e[0].attributes.groupId===t[0].attributes.groupId||e[0].author===t[0].author)&&(n=e[0],i=t[0],(!n.hasComments&&!i.hasComments||!(n.hasComments&&i.hasComments||!(n.hasComments&&i.createdAt<n.commentThread.comments.get(0).createdAt||i.hasComments&&n.createdAt<i.commentThread.comments.get(0).createdAt)))&&(!!isEqual(omit(e[0].attributes,"groupId"),omit(t[0].attributes,"groupId"))&&(!!e.every((e=>t.some((t=>e.getFirstRange().isEqual(t.getFirstRange())))))&&t.every((t=>e.some((e=>t.getFirstRange().isEqual(e.getFirstRange()))))))));var n,i}}_joinWithAdjacentSuggestions(e){const t=Array.from(e),n=this.getSuggestions({skipNotAttached:!0}),i=n.filter((t=>!e.has(t))),r=new Map(t.map((e=>[e,this._suggestionFactory.getSuggestionCallback(e.type,e.subType,"join")]))),s=new Map(n.map((e=>[e,e.getRanges()])));for(let e=0;e<t.length;e++)if(o(this,t[e],t,e+1))return!0;for(let e=0;e<t.length;e++)if(o(this,t[e],i,0))return!0;return!1;function o(e,t,n,i){for(let o=i;o<n.length;o++){const i=n[o];if(i.type!==t.type||i.author.id!==t.author.id||i.subType!==t.subType)continue;if(!_haveSameAttributes(t,i))continue;if("attribute"==t.type&&t.data.oldValue!=i.data.oldValue)continue;if("attribute"==t.type&&e._isBlockAttribute(t.data.key))continue;if("formatBlock"==t.type){const n=e.editor.model,i=t.getContainedElement();if(i&&(n.schema.isObject(i)||n.schema.isLimit(i)))continue}const a=r.get(t),c=s.get(t),l=s.get(i),d=t.commentThread&&t.commentThread.length,u=i.commentThread&&i.commentThread.length;if(!d&&a(l,c))return e._joinSuggestions(i,t),s.delete(t),!0;if(!u&&a(c,l))return e._joinSuggestions(t,i),s.delete(i),!0}return!1}}_joinSuggestions(e,t){if(e.isMultiRange)for(const n of t.getRanges())e.addRange(n);else{const n=t.getFirstRange().end;this._setSuggestionRange(e,this._model.createRange(e.getFirstRange().start,n))}t.removeMarkers()}_getMarkerAnnouncementText(e,t,n){const i=e.startsWith("format")||e.startsWith("attribute")?"FORMATTING":e.toUpperCase();return getTranslation(this.editor.locale,t+"_"+i+"_SUGGESTION_ANNOUNCEMENT",n)}_initAriaMarkerChangeAnnouncements(){const e=this.editor;if(!e.ui)return;const{ariaLiveAnnouncer:t}=e.ui;surroundingMarkersDetector(this._model,(({left:e,entered:n})=>{for(const n of e){const{group:e,type:i}=this._splitMarkerName(n.name);if("suggestion"===e){t.announce(this._getMarkerAnnouncementText(i,"LEAVE"));break}}for(const e of n){const{group:n,type:i}=this._splitMarkerName(e.name);if("suggestion"===n){t.announce(this._getMarkerAnnouncementText(i,"ENTER",getEnvKeystrokeText(FOCUS_ANNOTATION_KEYSTROKE)));break}}}))}_processAttributeChanges(e){if(this._recordAttributeSuggestions)return!1;const t=this.editor,n=t.model.document.differ.getChanges();if(0==n.length)return!1;const i=[],r=n.filter((e=>"attribute"==e.type)),s=n.filter((e=>"insert"==e.type&&"$text"!=e.name)),o=n.filter((e=>"remove"==e.type&&"$text"!=e.name));for(const e of r)i.push({key:e.attributeKey,newValue:e.attributeNewValue,oldValue:e.attributeOldValue,range:extendRange(e.range,t.model)});for(const e of s){const n=o.find((t=>t.position.isEqual(e.position)));n&&i.push({key:renameAttributeKey,newValue:e.name,oldValue:n.name,range:t.model.createRangeOn(e.position.nodeAfter)})}return 0!=i.length&&this._reduceExistingSuggestions(e,i)}_processAttributeSuggestions(e){let t=!1;const n=this.editor.model.document.differ.getChangedMarkers().filter((e=>e.data.newRange&&e.name.startsWith("suggestion:attribute:")));for(const i of n){const{subType:n,id:r}=this._splitMarkerName(i.name),s=n.split("|")[0];for(const n of this.getSuggestions({skipNotAttached:!0}))n.id!=r&&"attribute"==n.type&&n.data&&n.data.key==s&&n.getFirstRange().isIntersecting(i.data.newRange)&&(this._reduceSuggestionAttributeRange(n,i.data.newRange,e),t=!0)}return t}_recordAttributeChanges(e){this._recordAttributeSuggestions=!0,e()}_isRegisteredAttribute(e){const t=this._isBlockAttribute(e),n=this._inlineAttributeKeys.has(e);return t||n}_reduceExistingSuggestions(e,t){if(0==t.length)return!1;let n=!1;for(const i of t){const t=this._findSuggestions(i.range,"attribute").filter((e=>!e.meta.isNextTo)).map((e=>e.suggestion)),r=hashObject({newValue:i.newValue});t.filter((e=>{const[t,n]=e.subType.split("|");return t==i.key&&n!=r})).forEach((t=>{this._reduceSuggestionAttributeRange(t,i.range,e),n=!0}))}return n}_reduceSuggestionAttributeRange(e,t,n){const i=e.getFirstRange().getDifference(t);0!==i.length?1!==i.length?this._breakSuggestionMarker(e,t.start,t.end):this._setSuggestionRange(e,i[0]):n.removeMarker(e.getFirstMarker())}}class SuggestionFactory{constructor(e){this._editor=e,this._model=e.model,this._customCallbacks=new Map,this._defaultCallbacks=new Map,this._registerDefaultCallbacks()}buildSuggestion(e,t,n,i,r,s){return new Suggestion(this._model,{type:e,subType:t,id:n,author:i,creator:i,attributes:r,onAttributesChange:s,onAccept:(...n)=>this.getSuggestionCallback(e,t,"accept")(...n),onDiscard:(...n)=>this.getSuggestionCallback(e,t,"discard")(...n)})}registerCustomCallback(e,t,n,i){const r=e+":"+t+":"+n;this._customCallbacks.set(r,i)}getSuggestionCallback(e,t,n){const i=e+":"+t+":"+n;return this._customCallbacks.get(i)||this._defaultCallbacks.get(e+":"+n)}_registerDefaultCallbacks(){const e=()=>!1,t=e=>{e.sort(((e,t)=>e.start.isBefore(t.start)?1:-1)),this._model.change((t=>{for(const n of e){let e;e=n.end.isAtEnd&&n.end.parent==n.start.nodeAfter?t.createSelection(n.start.nodeAfter,"on"):t.createSelection(n),this._model.deleteContent(e,{forceDefaultExecution:!0,doNotAutoparagraph:!0})}}))},n=(e,t)=>{t&&this._model.change((n=>{const{commandName:i,commandParams:r=[]}=t,s=e.map((e=>(rangeOnOpeningTag(e)&&(e=this._model.createRange(e.end)),e))).filter((e=>"$graveyard"!==e.root.rootName));if(s.length<1)return;const o=Array.from(this._model.document.selection.getRanges()).map((e=>LiveRange.fromRange(e)));n.setSelection(s);for(const e of this._editor.commands.commands())e.refresh();r.push({forceDefaultExecution:!0}),this._editor.execute(i,...r);const a=o.filter((e=>"$graveyard"!=e.root.rootName));a.length>0&&n.setSelection(a);for(const e of o)e.detach()}))},i=(e,t)=>1==e.length&&1==t.length&&e[0].end.isEqual(t[0].start),r=(e,t,n,i)=>canChainSuggestions(e,t,n,i)?[e,t]:canChainSuggestions(t,e,i,n)?[t,e]:null;this._defaultCallbacks.set("insertion:accept",e),this._defaultCallbacks.set("insertion:discard",t),this._defaultCallbacks.set("insertion:join",i),this._defaultCallbacks.set("insertion:chain",r),this._defaultCallbacks.set("deletion:accept",t),this._defaultCallbacks.set("deletion:discard",e),this._defaultCallbacks.set("deletion:join",i),this._defaultCallbacks.set("deletion:chain",r),this._defaultCallbacks.set("formatInline:accept",n),this._defaultCallbacks.set("formatInline:discard",e),this._defaultCallbacks.set("formatInline:join",i),this._defaultCallbacks.set("formatInline:chain",e),this._defaultCallbacks.set("formatBlock:accept",n),this._defaultCallbacks.set("formatBlock:discard",e),this._defaultCallbacks.set("formatBlock:join",i),this._defaultCallbacks.set("formatBlock:chain",e),this._defaultCallbacks.set("attribute:accept",e),this._defaultCallbacks.set("attribute:discard",((e,t)=>{if(!t)return;const n=this._editor.plugins.get(TrackChangesEditing);this._model.change((i=>{if(t.key==renameAttributeKey)for(const n of e){const e=n.start.nodeAfter,r=t.oldValue;i.rename(e,r)}else if(n._isBlockAttribute(t.key))for(const n of e)void 0!==t.oldValue?i.setAttribute(t.key,t.oldValue,n.start.nodeAfter):i.removeAttribute(t.key,n.start.nodeAfter);else for(const n of e)t.oldValue?i.setAttribute(t.key,t.oldValue,n):i.removeAttribute(t.key,n)}))})),this._defaultCallbacks.set("attribute:join",i)}}function getIntersectionsWithMultipleRanges(e,t){const n=[];for(const i of t){const t=e.getIntersection(i);t&&n.push(t)}return n}function getDifferencesWithMultipleRanges(e,t){const n=[e];for(const e of t){let t=0;for(;t<n.length;){const i=n[t].getDifference(e);n.splice(t,1,...i),t+=i.length}}return n}function _isInObject(e,t,n){for(const i of t.parent.getAncestors({includeSelf:!0,parentFirst:!0})){if(i.root==i)return!1;if(!n.containsItem(i))return!1;if(e.isObject(i)||e.isLimit(i))return!0}return!1}function rangeOnOpeningTag(e){return e.end.parent==e.start.nodeAfter&&e.end.isAtStart}function rangeOnClosingTag(e){return e.start.parent==e.end.nodeBefore&&e.start.isAtEnd}function trimFormatInlineSuggestionRange(e,t,n,i){const r=e=>!e.item.is("$textProxy")&&!i.isObject(e.item),s=e.start.getLastMatchingPosition(r),o=e.end.getLastMatchingPosition(r,{direction:"backward"});return!(e.start.isEqual(s)&&e.end.isEqual(o)||(s.isBefore(o)?n.updateMarker(t,{range:n.createRange(s,o)}):n.removeMarker(t),0))}function createFormatSubType(e){return hashObject(e)}function isCorrectFormatBlockSuggestionRange(e){const t=e.start.nodeAfter;return t&&t.is("element")}function isCorrectDeletionSuggestionRange(e){return!rangeOnOpeningTag(e)&&!rangeOnClosingTag(e)}function extendRange(e,t){return null==e.end.nodeBefore&&e.end.parent==e.start.nodeAfter?createBlockFormatRangeForElement(e.start.nodeAfter,t):e}function createBlockFormatRangeForElement(e,t){const n=t.schema.isObject(e)||t.schema.isSelectable(e);return t.createRange(t.createPositionAt(e,"before"),n?t.createPositionAfter(e):t.createPositionAt(e,"end"))}function canChainSuggestions(e,t,n,i){return!!_haveSameAttributes(e,t)&&n.end.isEqual(i.start)}function _haveSameAttributes(e,t){if(!e._isDataLoaded||!t._isDataLoaded)return!1;const n=new Set(Object.keys(e.attributes)),i=new Set(Object.keys(t.attributes));if(n.delete("groupId"),i.delete("groupId"),0==n.size&&0==i.size)return!0;if(n.size!=i.size)return!1;const r={...e.attributes},s={...t.attributes};return delete r.groupId,delete s.groupId,JSON.stringify(r)==JSON.stringify(s)}function _areSimilarAttributes(e,t){const n=_cleanUpAttributes(e.attributes),i=_cleanUpAttributes(t);if(!e._isDataLoaded)return!1;for(const e of Object.keys(i))if(!isEqual(n[e],i[e]))return!1;return!0}function _cleanUpAttributes(e){const t=Object.assign({},e);return delete t.skipNestingCheck,delete t.tablePasteChainId,t}function _getAttributeKeyFromSubType(e){return e.split("|")[0]}async function checkLicense(e){const t=p([73,85,67,108,72,116,50,106,87,51,111,81,117,105,83,107,86,103,99,75,52,76,97,55,70,104,68,119,121,112,98,49,110,102,90,79,78,118,109,57,84,48,88,113,114,115,100,80,71,122,53,89,120,65,74,66,56,54,69,101,77,82]),n=window[p([68,97,116,101])][p([110,111,119])](),i=e[p([101,100,105,116,111,114])],r=new(window[p([80,114,111,109,105,115,101])])((e=>{i[p([111,110,99,101])](p([114,101,97,100,121]),e)})),s=HcD("eyJhbGciOiJFUzI1NiIsImRhdGUiOjE3MzkzNTU3ODk1Mjd9.eyJqdGkiOjgwMDA4NDMzMzMsImFsZyI6IkVTMjU2IiwiaWR4Ijo0MTAwNjUxODE0MDEyLCJ4IjoiMTJDOWJ4Tm1fU3A4U2g5VUxUSjFsa2FvQlBHdWFYbG4zNlFvYlJFWWdOayIsImNydiI6IlAtMjU2Iiwia3R5IjoiRUMiLCJqdHUiOiI0ZTEzM2FkMy03YTJlLTQ3ZWUtODA2NC1mZWNmYjFlNzMyYTgiLCJ1c2UiOiJzaWciLCJkYXRlIjoxNzM5MzU1Nzg5NTI3LCJ5IjoidEFuM202VlZDMjZDQmxDdE1yZlRtcXJoLTlFTG9kY0kwYWN3MTI2VVhLYyIsImlhdCI6MTczOTM1NTc4OX0.AtgwHJ7kknzIiDA6b-ldepzxlvicax0Iyr8xQIG64LFUAX3QB-qC0OLPiITq5Yk1bAzvvIbDORTj8IbY549lJQ"),o=i[p([99,111,110,102,105,103])][p([103,101,116])](p([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[p([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[p([116,104,101,110])]((()=>new(window[p([80,114,111,109,105,115,101])])((e=>{let t=0;i[p([109,111,100,101,108])][p([111,110])](p([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][p([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[p([111,102,102])]())}))}))))];return window[p([80,114,111,109,105,115,101])][p([114,97,99,101])](t)[p([116,104,101,110])]((()=>e))}function c(e){return e[p([115,116,97,114,116,115,87,105,116,104])](p([101,121]))?JSON[p([112,97,114,115,101])](l(e)):null}function l(e){return window[p([97,116,111,98])](e[p([114,101,112,108,97,99,101])](/-/g,p([43]))[p([114,101,112,108,97,99,101])](/_/g,p([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[p([108,101,110,103,116,104])];n++){const i=e[p([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[p([105,115,65,114,114,97,121])](t)?t[p([102,111,114,69,97,99,104])](e):t&&typeof t==p([111,98,106,101,99,116])?Object[p([101,110,116,114,105,101,115])](t)[p([115,111,114,116])]()[p([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[p([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[p([116,111,83,116,114,105,110,103])](16)[p([112,97,100,83,116,97,114,116])](8,p([48]))}function h(e){return e[p([115,112,108,105,116])]("")[p([114,101,118,101,114,115,101])]()[p([106,111,105,110])]("")}function m(e){return i[p([112,108,117,103,105,110,115])][p([104,97,115])](e)}function g(){}function p(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[p([83,116,114,105,110,103])](window[p([112,101,114,102,111,114,109,97,110,99,101])][p([110,111,119])]())[p([114,101,112,108,97,99,101])](p([46]),"");let n=p([73]);for(let i=0;i<e[p([108,101,110,103,116,104])];i+=2){let r=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[p([108,101,110,103,116,104])]&&(r-=t[p([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=p([116,114,97,99,107,67,104,97,110,103,101,115,76,105,99,101,110,115,101,75,101,121])+e,e!=p([86,97,108,105,100])&&async function(){await r,i[p([109,111,100,101,108])][p([99,104,97,110,103,101])]=g,i[p([109,111,100,101,108])][p([101,110,113,117,101,117,101,67,104,97,110,103,101])]=g,i[p([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](p([109,111,100,101,108]))}()}(await async function(){let e,t=null,g=null;try{if(o==p([71,80,76]))return p([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[p([115,112,108,105,116])](p([46]));if(3!=e[p([108,101,110,103,116,104])])return null;return function(e){const t=c(e);return t&&function(){const e=t[p([106,116,105])],n=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](e[p([108,101,110,103,116,104])]-8),16),i={...t,[p([106,116,105])]:e[p([115,117,98,115,116,114,105,110,103])](0,e[p([108,101,110,103,116,104])]-8)};return delete i[p([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return p([73,110,118,97,108,105,100]);e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(f=e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[p([106,116,105])],g=new(window[p([80,114,111,109,105,115,101])])((e=>{if(i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==p([97,117,116,111]))return e(p([86,97,108,105,100]));i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=p([97,117,116,111]),i[p([100,101,99,111,114,97,116,101])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[p([80,114,111,109,105,115,101])])(((e,t)=>{i[p([116,104,101,110])](e,t),window[p([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[p([116,104,101,110])]((e=>e&&e[p([115,116,97,116,117,115])]==p([111,107])?u(d(s+y))!=e[p([118,101,114,105,102,105,99,97,116,105,111,110])]?p([85,115,97,103,101,76,105,109,105,116]):p([86,97,108,105,100]):p([85,115,97,103,101,76,105,109,105,116])))[p([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=p([108,108,99,116,45])+u(d(f)),t=window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([103,101,116,73,116,101,109])](e);return t?window[p([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),p([86,97,108,105,100])):p(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[p([116,104,101,110])](e)[p([99,97,116,99,104])]((()=>{e(p([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=p([108,108,99,116,45])+u(d(f)),t=h(u(window[p([77,97,116,104])][p([99,101,105,108])](n/r)));window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([115,101,116,73,116,101,109])](e,t)}}i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=f)return e(p([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[p([114,101,113,117,101,115,116,73,100])]:s}}),{[p([112,114,105,111,114,105,116,121])]:p([104,105,103,104])}),i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[p([114,101,116,117,114,110])])&&(typeof n===p([111,98,106,101,99,116])||typeof n===p([102,117,110,99,116,105,111,110]))&&typeof n[p([116,104,101,110])]===p([102,117,110,99,116,105,111,110])&&typeof n[p([99,97,116,99,104])]===p([102,117,110,99,116,105,111,110])&&(t=!0,o(e[p([114,101,116,117,114,110])]))}),{[p([112,114,105,111,114,105,116,121])]:p([108,111,119])}),r[p([116,104,101,110])]((()=>{t||e(p([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[p([115,112,108,105,116])](p([46])),[n,i,r]=t;return function(t){const n=c(t);n&&n[p([97,108,103])]==p([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[p([85,105,110,116,56,65,114,114,97,121])][p([102,114,111,109])](l(i),(e=>e[p([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[p([84,101,120,116,69,110,99,111,100,101,114])]))[p([101,110,99,111,100,101])](t+p([46])+n),a=window[p([99,114,121,112,116,111])][p([115,117,98,116,108,101])];if(!a)return;const c=await a[p([105,109,112,111,114,116,75,101,121])](p([106,119,107]),s,{[p([110,97,109,101])]:p([69,67,68,83,65]),[p([110,97,109,101,100,67,117,114,118,101])]:p([80,45,50,53,54])},!1,[p([118,101,114,105,102,121])]);await a[p([118,101,114,105,102,121])]({[p([110,97,109,101])]:p([69,67,68,83,65]),[p([104,97,115,104])]:{[p([110,97,109,101])]:p([83,72,65,45,50,53,54])}},c,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[p([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[p([105,110,99,108,117,100,101,115])](p([42])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([84,67])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([82,84,67]))){if(m(p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&(n=p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]),i[p([112,108,117,103,105,110,115])][p([103,101,116])](n))[p([115,116,97,116,101])]==p([99,111,110,110,101,99,116,101,100]))return!0;if(m(p([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||m(p([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}var n;return!1}()?function(){const t=[p([101,118,97,108,117,97,116,105,111,110]),p([116,114,105,97,108])][p([105,110,99,108,117,100,101,115])](e[p([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1734307200;return e[p([101,120,112])]<t}()?p([69,120,112,105,114,101,100]):function(){const t=e[p([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[p([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[p([108,111,99,97,116,105,111,110])].href);if(t[p([105,110,99,108,117,100,101,115])](n))return!0;const i=n[p([115,112,108,105,116])](p([46]));return t[p([102,105,108,116,101,114])]((e=>e[p([105,110,99,108,117,100,101,115])](p([42]))))[p([109,97,112])]((e=>e[p([115,112,108,105,116])](p([46]))))[p([115,111,109,101])]((e=>i[p([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===p([42])))))}()?(e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([101,118,97,108,117,97,116,105,111,110])&&(t=a(p([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([116,114,105,97,108])&&(t=a(p([84,114,105,97,108,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([100,101,118,101,108,111,112,109,101,110,116])&&(t=a(p([68,101,118,101,108,111,112,109,101,110,116,76,105,109,105,116]))),await(t&&g?new(window[p([80,114,111,109,105,115,101])])(((e,n)=>{t[p([116,104,101,110])](e,n),g[p([116,104,101,110])]((t=>{t!=p([86,97,108,105,100])&&e(t)}),n)})):t||g||p([86,97,108,105,100]))):p([68,111,109,97,105,110,76,105,109,105,116]):p([78,111,116,65,108,108,111,119,101,100]):p([73,110,118,97,108,105,100])}catch(e){return p([73,110,118,97,108,105,100])}var f,y}())}class SuggestionController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n,i){super(),this.model=t,this.view=n,this.commentThreadController=i,this._editor=e,this._acceptCommand=e.commands.get("acceptSuggestion"),this._discardCommand=e.commands.get("discardSuggestion"),this.view.bind("isEnabled").to(this._acceptCommand,this._discardCommand,((e,t)=>e||t)),this.view.bind("canAccept").to(this._acceptCommand,"isEnabled",(e=>e&&this._editor.model.canEditAt(t.getRanges()))),this.view.bind("canDiscard").to(this._discardCommand,"isEnabled",(e=>e&&this._editor.model.canEditAt(t.getRanges()))),this._pendingAction=null,n.isDirty&&this._setPendingAction(),this.listenTo(n,"acceptSuggestion",(()=>this.acceptSuggestion())),this.listenTo(n,"discardSuggestion",(()=>this.discardSuggestion())),this.listenTo(n,"change:isDirty",(()=>{n.isDirty?this._setPendingAction():this._removePendingAction()}))}acceptSuggestion(){this._acceptCommand.execute(this.model.id)}discardSuggestion(){this._discardCommand.execute(this.model.id)}destroy(){this.view.unbind("isEnabled"),this.view.unbind("canAccept"),this.view.unbind("canDiscard"),this.stopListening(),this.commentThreadController.destroy(),this._pendingAction&&this._removePendingAction()}_setPendingAction(){const e=getTranslation(this._editor.locale,"PENDING_ACTION_SUGGESTION");this._pendingAction=this._editor.plugins.get("PendingActions").add(e)}_removePendingAction(){null!==this._pendingAction&&this._editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null}}class BaseSuggestionThreadView extends View{constructor(e,t,n,i){super(e),this.commentsListView=null,this.commentThreadInputView=null,this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation(e,"SUGGESTION_THREAD_DESCRIPTION")),this.set("isActive",!1),this.set("authoredAt",t.authoredAt),this.bind("authoredAt").to(t),this.set("descriptionParts",[]),this.set("isDirty",!1),this.set("isEnabled",!1),this.set("canAccept",!1),this.set("canDiscard",!1),this.bind("ariaLabel").to(this,"length",t,"authoredAt",this,"descriptionParts",((e,n,r)=>{const s=r.map((e=>renderDescription(e.content))).join(". ")+".";return getTranslation(this.locale,"SUGGESTION_THREAD_ARIA_LABEL",[e-1,t.author.name,n?i.formatDateTime(n):"",(new DOMParser).parseFromString(s,"text/html").body.textContent])})),this.focusables=new ViewCollection,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this._model=t,this._localUser=n,this._config=i,i.disableComments?this.set("length",1):this._createCommentViews()}render(){super.render(),setupThreadKeyboardNavigation(this,this.focusables)}focus(){this.element.focus()}destroy(){this.commentsListView&&this.commentsListView.destroy(),this.commentThreadInputView&&this.commentThreadInputView.destroy(),super.destroy()}_createCommentViews(){const{CommentsListView:e}=this._config;this.commentsListView=new e(this.locale,this._model.commentThread,Object.assign({CommentView:this._config.CommentView},this._config)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.bind("isActive").to(this),this.set("length",this.commentsListView.length+1),this.bind("length").to(this.commentsListView,"length",(e=>e+1)),this.commentThreadInputView=this._createCommentThreadInputView(),this.on("removeComment",(()=>this.focus())),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",((e,t)=>e||!!t))}_createCommentThreadInputView(){const{CommentThreadInputView:e}=this._config,t=new e(this.locale,this._localUser,this._config.editorConfig),n=t.commentInputView;return t.bind("showInput").to(this,"isActive",this._model.commentThread,"isReadOnly",n,"value",((e,t,n)=>!!n||e&&!t)),n.on("submit",((e,t)=>{this.fire("addComment",t),n.editor.setData("")})),n.on("cancel",(()=>this.focus())),n.bind("disabledSubmit").to(this._model.commentThread,"isReadOnly"),t}}class SuggestionThreadView extends BaseSuggestionThreadView{constructor(e,t,n,i){super(e,t,n,i),this.set("type",""),this.bind("type").to(this,"descriptionParts",(e=>e&&e[0]?e[0].type:"")),this.bind("description").to(this,"descriptionParts",this,"isActive",((e,t)=>{let n="";for(const t of e)n+="<p>"+renderDescription(t.content,t.color)+"</p>";return t?n:trimHtml(n,{limit:140})})),this._descriptionElement=null,this.suggestionView=new i.SuggestionView(e,t,{formatDateTime:i.formatDateTime}),this.suggestionView.bind("description").to(this),this.suggestionView.delegate("acceptSuggestion","discardSuggestion").to(this),this.suggestionView.acceptButton.bind("isEnabled").to(this,"canAccept"),this.suggestionView.discardButton.bind("isEnabled").to(this,"canDiscard"),this.focusables.add(this.suggestionView),this.commentsListView&&this.focusables.add(this.commentsListView),this.commentThreadInputView&&this.focusables.add(this.commentThreadInputView),this.setTemplate(this.getTemplate())}getTemplate(){const e=this.bindTemplate,t=[this.suggestionView];this.commentsListView&&t.push(this.commentsListView),this.commentThreadInputView&&t.push(this.commentThreadInputView),t.push(this.ariaDescriptionView);return{tag:"div",attributes:{class:["ck","ck-rounded-corners","ck-suggestion-wrapper",e.if("isActive","ck-suggestion-wrapper--active"),e.to("type",(e=>"ck-suggestion-"+e)),this._config.disableComments&&"ck-suggestion--disabled-comments"],"data-suggestion-id":this._model.id,"data-thread-id":this._model.commentThread.id,"data-author-id":this._model.author.id,tabindex:0,role:"listitem","aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id},children:t}}render(){super.render(),this.commentsListView&&(this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this)),this.commentThreadInputView&&(this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this))}}class SuggestionView extends View{constructor(e,t,n){super(e),this._model=t,this._config=n,this.set("description",""),this.bind("authoredAt").to(t),this.acceptButton=this._createButton(getTranslation(e,"Accept suggestion"),_0x27b58d.check,"ck-suggestion--accept","acceptSuggestion","sw"),this.discardButton=this._createButton(getTranslation(e,"Discard suggestion"),_0x27b58d.cancel,"ck-suggestion--discard","discardSuggestion","sw"),this.userView=new UserView(e,t.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-suggestion__user","ck-annotation__user"],"aria-hidden":!0}}),this.focusables=new ViewCollection([this.acceptButton,this.discardButton]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"},keystrokeHandlerOptions:{filter:e=>e.target!==this.element}}),this.setTemplate(this.getTemplate())}render(){super.render();const e=this.element.querySelector(".ck-annotation__content-wrapper");e.innerHTML=this.description,this.on("change:description",((t,n,i)=>{e.innerHTML=i})),this._setupKeyboardNavigation()}getTemplate(){const e=this.bindTemplate,t=[{tag:"div",attributes:{class:["ck-suggestion__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-suggestion__info-name","ck-annotation__info-name"]}},{tag:"time",attributes:{datetime:e.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:e.to("authoredAt",(e=>this._config.formatDateTime(e)))}]}]},{tag:"div",attributes:{class:["ck-suggestion__actions","ck-annotation__actions"]},children:[this.acceptButton,this.discardButton]},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]}}];return this._model.isExternal&&t.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalSuggestionNote()}]}),{tag:"div",attributes:{class:["ck-suggestion","ck-annotation"],tabindex:-1},children:[this.userView,{tag:"div",attributes:{class:["ck-suggestion__main","ck-annotation__main"],role:"presentation"},children:t}]}}focus(){this.element.focus()}getUserViewNotificationText(){return this._model.isExternal?"importWord"===this._model.attributes["@external"].source?getTranslation(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):getTranslation(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}getExternalSuggestionNote(){return"importWord"===this._model.attributes["@external"].source?getTranslation(this.locale,"EXTERNAL_IMPORT_WORD_SUGGESTION"):getTranslation(this.locale,"EXTERNAL_SUGGESTION")}_createButton(e,t,n,i,r){const s=new LateFocusButtonView(this.locale);return s.set({label:e,icon:t,tooltip:!0,tooltipPosition:r}),s.extendTemplate({attributes:{class:n}}),s.on("execute",(()=>{this.fire(i,this._model.id)})),s}_setupKeyboardNavigation(){const e=this.element;this.keystrokes.listenTo(e);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element);this.keystrokes.set("enter",((t,n)=>{e===t.target&&(this.focusCycler.focusFirst(),n())})),this.keystrokes.set("esc",((t,n)=>{e!==t.target&&(this.focus(),n())}))}}var trackChangesIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.182 5.514a.643.643 0 0 0-.636.64v-.001a.636.636 0 0 0 .636.639h5.682a.641.641 0 0 0 .636-.638.637.637 0 0 0-.636-.64H6.182Z"/><path d="M6.182 8.5a.642.642 0 0 0-.588.882.636.636 0 0 0 .588.395h5.682a.641.641 0 0 0 .636-.639.635.635 0 0 0-.636-.638H6.182Z"/><path d="M6.18 11.5a.64.64 0 0 0 0 1.278h3.133a.64.64 0 0 0 0-1.278H6.18Z"/><path d="m11.772 18.308.154-.23c-.195-.098-.304-.192-.328-.28-.024-.09 0-.274.076-.551.062-.166.099-.296.11-.393a2.934 2.934 0 0 0 0-.479c-.137-.41-.2-.685-.186-.83.013-.145.117-.335.313-.57l4.465-6.207c.356-.6 1.059-.56 2.11.118 1.05.68 1.443 1.272 1.177 1.772l-3.876 6.833c-.105.27-.22.444-.347.515-.128.07-.4.119-.813.139a2.954 2.954 0 0 0-.487.21c-.127.09-.244.193-.347.31-.193.174-.332.262-.416.262-.064 0-.178-.05-.346-.15l-.204.27-1.056-.739Zm-.184.274 1.039.727-.26.34h-1.496l.717-1.067Z"/><path clip-rule="evenodd" d="M3.272 1A1.28 1.28 0 0 0 2 2.28v14.439a1.276 1.276 0 0 0 1.272 1.28h6.838a2.13 2.13 0 0 1 .003-.61c.024-.18.066-.363.113-.534.012-.046.027-.092.043-.136.011-.029.02-.052.025-.069v-.008a7.395 7.395 0 0 1-.042-.142H3.5V2.46s11 .002 11 .005v6.341l.627-.872c.204-.32.49-.614.873-.819V2.281c0-.707-.569-1.28-1.272-1.28L3.272 1ZM16 9.29l-1.5 2.085V16.5h-2.708c.005.118.002.236-.007.354a.904.904 0 0 1-.013.075l-.001.005a3.108 3.108 0 0 1-.097.312c-.027.101-.048.19-.062.266a.734.734 0 0 0-.014.287.25.25 0 0 0 .068.105.65.65 0 0 0 .088.074l.017.011.016.01h.175L14.73 18c.697 0 1.271-.573 1.271-1.281v-7.43Z"/></svg>\n';class TrackChangesUI extends Plugin{static get requires(){return[TrackChangesEditing,Users,"CommentsRepository","Annotations","EditorAnnotations"]}static get pluginName(){return"TrackChangesUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._suggestionToController=new Map,this._viewToController=new Map,this._annotationViews=new Map,this._handleControllerBuffer=new Map;const t=this.editor.config;t.define("trackChanges.SuggestionThreadView",SuggestionThreadView),t.define("trackChanges.SuggestionView",SuggestionView),t.define("trackChanges.disableComments",!1),this._disableComments=t.get("trackChanges.disableComments")}_handleSuggestionControllerDelayed(e,t){0===this._handleControllerBuffer.size&&setTimeout((()=>{for(const[e,t]of this._handleControllerBuffer){const n=this._suggestionToController.has(e);n||t?n&&t&&this._destroyController(e):this._initializeController(e)}this._handleControllerBuffer.clear(),this.editor.plugins.get("EditorAnnotations").refreshSelectedViews(),this._refreshActiveMarkers()}),10),this._handleControllerBuffer.set(e,t)}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("Annotations"),i=e.plugins.get("EditorAnnotations"),r=e.plugins.get("CommentsRepository");this._addUIComponentsToFactory(),i.addSourceCollector((()=>{const e=[];for(const[t,n]of Array.from(this._suggestionToController)){const i=t.getAllAdjacentSuggestions(),r=[];for(const e of i){if(!e.isInContent)continue;if(e.isMultiRange){r.push(...e.getRanges());continue}const t=e.getFirstRange();if(r.length>0){const e=r[0].getJoined(t);if(e){r[0]=e;continue}}r.push(t)}e.push([n.view,r])}return e})),this.listenTo(t,"suggestionLoaded",((e,t)=>{this.listenTo(t,"change:previous",((e,n,i,r)=>{t.isInContent&&(null==i?(this._updateController(r.head),this._handleSuggestionControllerDelayed(t,!1)):(this._updateController(i.head),null==r&&this._handleSuggestionControllerDelayed(t,!0)))})),null!==t.previous?this._updateController(t.head):this._handleSuggestionControllerDelayed(t,!1)})),this.listenTo(t,"suggestionUnloaded",((e,t,n)=>{this.stopListening(t,"change:previous"),this._handleControllerBuffer.delete(t),this._suggestionToController.has(t)&&this._destroyController(t),n&&this._updateController(n.head)})),this.listenTo(t,"suggestionChanged",((e,t)=>{this._updateController(t)})),this.listenTo(n,"change:activeAnnotations",(()=>{this._refreshActiveMarkers()})),this.listenTo(r,"addComment",((e,{threadId:n,isFromAdapter:i})=>{if(i||!t.hasSuggestion(n))return;const r=t.getSuggestion(n);this._suggestionToController.get(r).view.commentsListView.focus(-1)}),{priority:"lowest"}),this.licenseKey=this.editor.config.get("licenseKey");const s=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in s){const n=t,i=s[n];if("trackChangesLicenseKeyValid"==i||"trackChangesLicenseKeyInvalid"==i||"trackChangesLicenseKeyExpired"==i||"trackChangesLicenseKeyDomainLimit"==i||"trackChangesLicenseKeyNotAllowed"==i||"trackChangesLicenseKeyEvaluationLimit"==i||"trackChangesLicenseKeyTrialLimit"==i||"trackChangesLicenseKeyDevelopmentLimit"==i||"trackChangesLicenseKeyUsageLimit"==i){delete s[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"trackChangesLicenseKeyInvalid"==e&&s._showLicenseError("invalid"),"trackChangesLicenseKeyExpired"==e&&s._showLicenseError("expired"),"trackChangesLicenseKeyDomainLimit"==e&&s._showLicenseError("domainLimit"),"trackChangesLicenseKeyNotAllowed"==e&&s._showLicenseError("featureNotAllowed","TrackChanges"),"trackChangesLicenseKeyEvaluationLimit"==e&&s._showLicenseError("evaluationLimit"),"trackChangesLicenseKeyTrialLimit"==e&&s._showLicenseError("trialLimit"),"trackChangesLicenseKeyDevelopmentLimit"==e&&s._showLicenseError("developmentLimit"),"trackChangesLicenseKeyUsageLimit"==e&&s._showLicenseError("usageLimit")}),1e3)}_refreshActiveMarkers(){const e=this.editor.plugins.get("Annotations"),t=this.editor.plugins.get("TrackChangesEditing"),n=Array.from(e.activeAnnotations,(e=>e.innerView)).filter((e=>this._viewToController.has(e))),i=[];for(const e of n){const t=this._viewToController.get(e).model.getAllAdjacentSuggestions();i.push(...t.reduce(((e,t)=>[...e,...t.getMarkerNames()]),[]))}t.activeMarkers=i}_addUIComponentsToFactory(){const e=this.editor,t=e.locale,n=getTranslation(t,"Track changes"),i=new Collection([{type:"switchbutton",model:new ViewModel({withText:!0,isToggleable:!0,label:n,commandName:"trackChanges",role:"menuitemcheckbox"})},{type:"separator"},{type:"button",model:new ViewModel({withText:!0,label:getTranslation(t,"Accept all suggestions"),commandName:"acceptAllSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation(t,"Accept all selected suggestions"),commandName:"acceptSelectedSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation(t,"Discard all suggestions"),commandName:"discardAllSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation(t,"Discard all selected suggestions"),commandName:"discardSelectedSuggestions",role:"menuitem"})}]);for(const t of i)if(isListDropdownButtonDefinition(t)){const n=e.commands.get(t.model.commandName);t.model.bind("isOn","isEnabled").to(n,"value","isEnabled")}e.ui.componentFactory.add("trackChanges",(e=>this._createToolbarButton(e,i,n))),e.ui.componentFactory.add("menuBar:trackChanges",(e=>this._createMenuBarMenu(e,i,n)))}_createToolbarButton(e,t,n){const i=createDropdown(e,SplitButtonView),r=this.editor.commands.get("trackChanges");i.buttonView.set({tooltip:n,label:n,icon:trackChangesIcon}),i.buttonView.bind("isOn").to(r,"value"),i.buttonView.on("execute",(()=>{r.execute(),this.editor.editing.view.focus()})),addListToDropdown(i,t,{role:"menu"});const s=[];for(const e of t)isListDropdownButtonDefinition(e)&&s.push(this.editor.commands.get(e.model.commandName));const o=i.buttonView;return o.actionView.unbind("isEnabled"),o.arrowView.unbind("isEnabled"),o.actionView.bind("isEnabled").to(r,"isEnabled"),o.arrowView.bind("isEnabled").toMany(s,"isEnabled",((...e)=>e.some((e=>e)))),i.on("execute",(e=>{this.editor.execute(e.source.commandName),this.editor.editing.view.focus()})),i}_createMenuBarMenu(e,t,n){const i=new MenuBarMenuView(e),r=this.editor.commands.get("trackChanges");i.buttonView.set({label:n,icon:trackChangesIcon});const s=new MenuBarMenuListView(e);for(const n of t){if("separator"==n.type){s.items.add(new ListSeparatorView(e));continue}const t=new MenuBarMenuListItemView(e,i),r=new MenuBarMenuListItemButtonView(e),o=n.model;r.bind(...Object.keys(o)).to(o),r.delegate("execute").to(i),r.on("execute",(()=>{this.editor.execute(o.commandName),this.editor.editing.view.focus()})),t.children.add(r),s.items.add(t)}return i.bind("isEnabled").to(r,"isEnabled"),i.panelView.children.add(s),i}_initializeController(e){const t=this.editor,n=t.config,i=t.plugins.get("Annotations"),r=t.plugins.get("CommentsRepository"),s=t.plugins.get("EditorAnnotations"),o=t.plugins.get(Users).me,a=n.get("trackChanges").SuggestionThreadView,c=n.get("trackChanges").SuggestionView,{CommentsListView:l,CommentThreadInputView:d}=t.plugins.get("CommentsUI");let u,h,m;this._annotationViews.has(e.id)?(h=this._annotationViews.get(e.id),u=h.mainView):(u=new a(t.locale,e,o,{disableComments:this._disableComments,editorConfig:{...n.get("comments.editorConfig"),licenseKey:n.get("licenseKey")},maxCommentsWhenCollapsed:n.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:n.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:n.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:getDateTimeFormatter(n.get("locale")),CommentView:n.get("comments").CommentView,CommentsListView:l,CommentThreadInputView:d,SuggestionView:c}),u.suggestionView.acceptButton.on("execute",(()=>{t.editing.view.focus()})),u.suggestionView.discardButton.on("execute",(()=>{t.editing.view.focus()})),h=i.createAnnotationView(this.editor.locale,u),h.bind("isDirty").to(u,"isDirty"),h.bind("length").to(u),h.bind("type").to(u,"type",(e=>"suggestion-"+e)),u.on("escape",(()=>{m.fire("escape")})),this._annotationViews.set(e.id,h));const g=r.createCommentThreadController(e.commentThread,u),p=new SuggestionController(t,e,u,g),f=e.getAllAdjacentSuggestions().filter((e=>e.isInContent));u.descriptionParts=t.plugins.get("TrackChangesEditing").descriptionFactory.getDescriptions(f),this._suggestionToController.set(e,p),this._viewToController.set(u,p),m=i.createAnnotation({view:h,target:()=>{const n=[],i=e.getAllAdjacentSuggestions().filter((e=>e.isInContent));for(const e of i)n.push(...e.getMarkers());return getAllMarkersDomElementsSorted(t.editing,n)},type:()=>"suggestion-"+p.view.type}),r._bindAnnotationToEditors(u,m),i.add(m),s.registerAnnotation(m)}_destroyController(e){const t=this.editor.plugins.get("CommentsRepository"),n=this.editor.plugins.get("Annotations"),i=this._suggestionToController.get(e),r=i.view,s=n.getByInnerView(r);t._unbindEditors(r),s&&n.remove(s),this._suggestionToController.delete(e),this._viewToController.delete(r),i.destroy()}_updateController(e){if(!e.isInContent||!this._suggestionToController.has(e))return;const t=this.editor.plugins.get("TrackChangesEditing"),n=this._suggestionToController.get(e),i=e.getAllAdjacentSuggestions();n.view.descriptionParts=t.descriptionFactory.getDescriptions(i)}destroy(){for(const e of this._suggestionToController.keys())this._destroyController(e);for(const e of this._annotationViews.values())e.mainView.destroy();super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function isListDropdownButtonDefinition(e){return"model"in e}class TrackChanges extends Plugin{static get requires(){return[TrackChangesEditing,TrackChangesUI,"Comments"]}static get pluginName(){return"TrackChanges"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}set adapter(e){this.editor.plugins.get(TrackChangesEditing).adapter=e}get adapter(){return this.editor.plugins.get(TrackChangesEditing).adapter}addSuggestion(e){return this.editor.plugins.get(TrackChangesEditing).addSuggestionData(e)}getSuggestions({skipNotAttached:e=!1,toJSON:t=!1}={}){return this.editor.plugins.get(TrackChangesEditing).getSuggestions({skipNotAttached:e,toJSON:t})}getSuggestion(e){return this.editor.plugins.get(TrackChangesEditing).getSuggestion(e)}}const blackListedPlugins=["Pagination"];class TrackChangesData extends Plugin{static get requires(){return[TrackChangesEditing]}static get pluginName(){return"TrackChangesData"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;if(e.config.define("trackChangesData.editorCreator",(t=>{const n=e.model.document.getRootNames().reduce(((e,t)=>(e[t]="",e)),{});return e.constructor.create(n,t)})),"function"!=typeof e.config.get("trackChangesData").editorCreator)throw new CKEditorError("track-changes-data-invalid-editor-creator")}getDataWithAcceptedSuggestions(e){return getTrackChangesData(this.editor,!0,e)}getDataWithDiscardedSuggestions(e){return getTrackChangesData(this.editor,!1,e)}}class TrackChangesDataGetter extends Plugin{static get pluginName(){return"TrackChangesDataGetter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}super(e),this.result="end",e[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),e[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}init(){this.editor.plugins.get("CommentsRepository")._adapter={addCommentThread:()=>new Promise((()=>{})),getCommentThread:()=>new Promise((()=>{})),updateCommentThread:()=>new Promise((()=>{})),resolveCommentThread:()=>new Promise((()=>{})),reopenCommentThread:()=>new Promise((()=>{})),removeCommentThread:()=>new Promise((()=>{})),addComment:()=>new Promise((()=>{})),updateComment:()=>new Promise((()=>{})),removeComment:()=>new Promise((()=>{}))},this.editor.plugins.get("TrackChangesEditing")._adapter=null}}function isMultiRootEditor(e){return void 0!==e.getRootsAttributes}async function getTrackChangesData(e,t,n){const i=sanitizeEditorConfig(e,blackListedPlugins);i.plugins.push(TrackChangesEditing,TrackChangesDataGetter),i.rootsAttributes=isMultiRootEditor(e)?e.getRootsAttributes():void 0;const r=document.createDocumentFragment(),s=e.config.get("trackChangesData").editorCreator,o=await s(i,(()=>createAttachedElement(r)));copyEditorData(e,o),o.execute(t?"acceptAllSuggestions":"discardAllSuggestions");const a=isMultiRootEditor(o)?o.getFullData(n):o.data.get(n);return await o.destroy(),a}function copyEditorData(e,t){const n=e.model.document.getRootNames().reduce(((t,n)=>(t[n]=e.data.get({rootName:n}),t)),{}),i=e.plugins.get("Users").users.map((e=>({id:e.id,name:e.name}))),r=e.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0,toJSON:!0}),s=e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,toJSON:!0}),o=t.plugins.get("Users"),a=t.plugins.get("TrackChangesEditing"),c=t.plugins.get("CommentsRepository");for(const e of c.getCommentThreads())e.remove();for(const e of i)o.getUser(e.id)||o.addUser(e);o.me||o.useAnonymousUser();for(const e of s)c.addCommentThread(e);for(const e of r)a.addSuggestionData(e);t.data.set(n)}function createAttachedElement(e){const t=document.createElement("div");return e.appendChild(t),t}export{AIAdapter,AIAssistant,AIRequestError,AITextAdapter,AWSTextAdapter,Annotation,AnnotationCollection,AnnotationView,Annotations,AnnotationsUIs,AriaDescriptionView,BaseCommentThreadView,BaseCommentView,BaseSuggestionThreadView,CaseChange,CaseChangeCommand,CaseChangeEditing,CaseChangeUI,CloudServicesCommentsAdapter,CloudServicesRevisionHistoryAdapter,CloudServicesTrackChangesAdapter,Comment,CommentThread,CommentThreadController,CommentThreadInputView,CommentThreadView,CommentView,Comments,CommentsArchive,CommentsArchiveUI,CommentsListView,CommentsOnly,CommentsRepository,CommentsUI,ConfirmMixin,CopyFormatCommand,DocumentOutline,DocumentOutlineUI,DocumentOutlineUtils,EditorAnnotations,ExportPdf,ExportWord,FOCUS_ANNOTATION_KEYSTROKE,FormatPainter,FormatPainterEditing,FormatPainterUI,HeadingId,ImportWord,ImportWordEditing,ImportWordUI,InlineAnnotations,LateFocusButtonView,LateFocusDropdownButtonView,MergeFields,MergeFieldsEditing,MergeFieldsUI,MultiLevelList,MultiLevelListEditing,MultiLevelListUI,NarrowSidebar,OpenAITextAdapter,Pagination,PasteFormatCommand,PasteFromOfficeEnhanced,Permissions,PresenceList,RealTimeCollaborationClient,RealTimeCollaborativeComments,RealTimeCollaborativeEditing,RealTimeCollaborativeRevisionHistory,RealTimeCollaborativeTrackChanges,Revision,RevisionHistory,RevisionHistoryUI,RevisionTracker,RevisionViewer,RevisionViewerLoadingOverlay,RevisionViewerUI,RevisionsRepository,RevisionsSidebar,SlashCommand,SlashCommandConfig,SlashCommandEditing,SlashCommandUI,Suggestion,SuggestionThreadView,SuggestionView,TableOfContents,TableOfContentsCommand,TableOfContentsEditing,TableOfContentsUI,Template,TemplateCommand,TemplateEditing,TemplateUI,TrackChanges,TrackChangesData,TrackChangesEditing,UserView,Users,WideSidebar,getAllMarkersDomElementsSorted,getDateTimeFormatter,getMarkerDomElement,hashObject,icons,sanitizeEditorConfig,setupThreadKeyboardNavigation,surroundingMarkersDetector,trimHtml};