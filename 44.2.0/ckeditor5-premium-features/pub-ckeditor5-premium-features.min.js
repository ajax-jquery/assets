import{ContextPlugin,Editor,icons as _0x42409c,Plugin,Command as _0x338ed0,PendingActions,Context as Context$1,ElementApiMixin}from"ckeditor5";import{CKEditorError,Collection,uid,first,FocusTracker,KeystrokeHandler,ObservableMixin,global as _0x49a38d,isVisible,Rect,diff as _0x32349d,priorities,scrollViewportToShowTarget,getEnvKeystrokeText,toUnit,DomEmitterMixin,keyCodes,diffToChanges,scrollAncestorsToShowTarget,collectStylesheets,logWarning,logError,ResizeObserver as _0x3f4b48,env,version as _0xdafafb,ElementReplacer,insertToPriorityArray,getAncestors,createElement}from"ckeditor5";import{View,IconView,ButtonView,DropdownButtonView,FocusCycler,isViewWithFocusCycler,ToolbarView,SpinnerView,AutocompleteView,ListView,ListItemGroupView,ListItemView,ButtonLabelView,createLabeledTextarea,Dialog,createDropdown,addMenuToDropdown,MenuBarMenuView,MenuBarMenuListItemButtonView,DialogViewPosition,MenuBarMenuListView,MenuBarMenuListItemView,addListToDropdown,ViewModel,EditorUIView,InlineEditableUIView,EditorUI,ViewCollection,focusChildOnDropdownOpen,BodyCollection,BalloonPanelView,ContextualBalloon,Notification,SplitButtonView,FileDialogButtonView,MenuBarMenuListItemFileDialogButtonView,addKeyboardHandlingForGrid,CollapsibleView,LabeledFieldView,createLabeledInputNumber,filterGroupAndItemNames,SearchTextView,LabelWithHighlightView,ButtonLabelWithHighlightView,InputNumberView,LabelView,clickOutsideHandler,injectCssTransitionDisabler,submitHandler,createLabeledInputText,ToolbarSeparatorView,normalizeToolbarConfig,BoxedEditorUIView,StickyPanelView,HighlightedTextView,normalizeColorOptions,ListSeparatorView}from"ckeditor5";import{ClipboardPipeline,ClipboardMarkersUtils,Clipboard}from"ckeditor5";import{DomEventData,DataTransfer as DataTransfer$1,UpcastWriter,Matcher,disablePlaceholder,enablePlaceholder,MouseObserver,Text as Text$1,TreeWalker,ClickObserver,Range as _0x571283,ViewDocument,DomConverter,LiveRange,History,NoOperation,InsertOperation,MarkerOperation,RootAttributeOperation,transformSets,OperationFactory,ViewDocumentFragment,Element as Element$3,ViewUIElement,ViewRawElement,ViewEmptyElement,ViewAttributeElement,ViewContainerElement,Position,ViewText,ViewElement,DocumentFragment as DocumentFragment$1,LivePosition,DowncastWriter}from"ckeditor5";import{Enter,ShiftEnter}from"ckeditor5";import{SelectAll}from"ckeditor5";import{Typing,Delete,Input}from"ckeditor5";import{Undo}from"ckeditor5";import{Paragraph}from"ckeditor5";import{toWidget,Widget,findOptimalInsertionRange,viewToModelPositionOutsideModelElement,setHighlightHandling}from"ckeditor5";import{MSWordNormalizer,parseHtml}from"ckeditor5";import{ObservableMixin as _0x45ca07,priorities as priorities$1,global as _0x41fffa,EmitterMixin,Collection as Collection$1}from"ckeditor5";import{FileRepository}from"ckeditor5";class Permissions extends ContextPlugin{static get pluginName(){return"Permissions"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}setPermissions(e,t){let n;if(t||(t=this.context.config.get("collaboration.channelId")),this.context.config.get("collaboration.channelId")==t?n=this.context:"editors"in this.context&&this.context.editors&&(n=this.context.editors.find((e=>e.config.get("collaboration.channelId")==t))),!n)throw new CKEditorError("permissions-set-permissions-invalid-channel-id",null);const i=n.plugins,r=i.has("CommentsRepository")?i.get("CommentsRepository"):void 0,s=i.has("CommentsOnly")&&i.get("CommentsOnly"),o=e.includes("document:write"),a=e.includes("comment:modify_all"),l=e.includes("comment:admin"),c=e.includes("comment:write"),d=c||l,u=d||a,h=o||d;if(s&&(s.isEnabled=!o&&u),n instanceof Editor&&(o||u&&r?n.disableReadOnlyMode("no-permissions"):n.enableReadOnlyMode("no-permissions")),r){r.setPermissions({admin:l,modifyAll:a,write:c,resolve:h},t);const e=n instanceof Editor&&n.commands.get("addCommentThread");e&&(d?e.clearForceDisabled("noPermissions"):e.forceDisabled("noPermissions"))}}}function getTranslation$i(e,t){const n=e.t;switch(t){case"Anonymous":return n("Anonymous");case"Yes":return n("Yes");case"No":return n("No");case"Are you sure?":return n("Are you sure?");default:return""}}class Users extends ContextPlugin{static get pluginName(){return"Users"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Permissions]}constructor(e){super(e),this.context.config.define("users.anonymousUserId","anonymous-user"),this.context.config.define("users.colorsCount",8),this.users=new Collection,this._locale=e.locale,this._lastColor=0,this._myId=null,this.decorate("getOperationAuthor")}init(){this._addAnonymousUser()}get me(){return null==this._myId?null:this.getUser(this._myId)}addUser({id:e,name:t,...n}){if(!e||"string"!=typeof e)throw new CKEditorError("users-add-invalid-id");if(this.users.has(e))throw new CKEditorError("users-add-duplicated-id",null,{id:e});const i={...n,id:e,name:normalizeName(this._locale,t),color:this._getNextColor()};i.name=normalizeName(this._locale,i.name);const r=new User$1(i);return this.users.add(r),r}getUser(e){return this.users.get(e)}useAnonymousUser(){const e=this.context.config.get("users.anonymousUserId");this._myId||this.defineMe(e)}defineMe(e){if(this._myId)throw new CKEditorError("users-me-already-defined",null);const t=this.getUser(e);if(!t)throw new CKEditorError("users-me-missing-user",null);this._myId=e,t._isMe=!0}getOperationAuthor(){return this.me}_getNextColor(){const e=this.context.config.get("users.colorsCount");return this._lastColor>=e&&(this._lastColor=0),new Color(this._lastColor++)}_addAnonymousUser(){const e=this.context.config.get("users.anonymousUserId");this.addUser({id:e,name:getTranslation$i(this._locale,"Anonymous")})._isAnonymous=!0}}let User$1=class{constructor(e){this.id=e.id,this.color=e.color,this.name=e.name,this.avatar=e.avatar,this._isAnonymous=!1,this._isMe=!1}get isAnonymous(){return this._isAnonymous}get isMe(){return this._isMe}get initials(){const e=this.name.split(" ");return 1===e.length?this._getInitial(e[0]):this._getInitial(e[0])+this._getInitial(e[e.length-1])}_getInitial(e){return e.charAt(0).toUpperCase()}};function normalizeName(e,t=""){return""==(t=t.trim())?getTranslation$i(e,"Anonymous"):t}class Color{constructor(e){this._id=e}getBackgroundColorClass(){return"ck-user__bg-color--"+this._id}getSelectionClass(){return"ck-user__selection--"+this._id}getMarkerClass(){return"ck-user__marker--"+this._id}}var notificationIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/></svg>\n';class UserView extends View{constructor(e,t,n){super(e),this.name=t.name,this.notificationView=null;const i=["ck","ck-user"],r=["ck","ck-user__img"];if(t.isAnonymous&&r.push("ck-user__anonymous"),!t.isAnonymous&&t.isMe&&i.push("ck-user_me"),t.avatar&&r.push("ck-user__avatar"),n){const e=new IconView;e.extendTemplate({attributes:{class:["ck-user__icon"]}}),e.content=notificationIcon,this.notificationView={tag:"div",attributes:{class:["ck","ck-user__notification"],"data-cke-tooltip-position":"n","data-cke-tooltip-text":n},children:[e]}}const s=[{tag:"div",attributes:{class:r,style:{"background-image":t.avatar?"url('"+t.avatar+"')":""}}},{tag:"div",attributes:{class:t.avatar?"ck ck-user__name ck-user__name--hidden":"ck ck-user__name","aria-label":t.name},children:[{text:t.initials}]}];this.notificationView&&s.push(this.notificationView),this.setTemplate({tag:"div",attributes:{class:i,"data-user-id":t.id},children:s})}}class AriaDescriptionView extends View{constructor(e,t){super(e),this.id="ck-aria-description-"+uid(),this.setTemplate({tag:"span",attributes:{class:["ck","ck-aria-description"],id:this.id},children:[{text:t}]})}}class LateFocusButtonView extends ButtonView{render(){super.render(),delayFocusUntilMouseup(this)}}class LateFocusDropdownButtonView extends DropdownButtonView{render(){super.render(),delayFocusUntilMouseup(this)}}function delayFocusUntilMouseup(e){e.listenTo(e.element,"mousedown",((e,t)=>{t.stopPropagation(),t.preventDefault()})),e.listenTo(e.element,"mouseup",(()=>{e.element.focus()}))}class LuxonError extends Error{}class InvalidDateTimeError extends LuxonError{constructor(e){super("Invalid DateTime: "+e.toMessage())}}class InvalidIntervalError extends LuxonError{constructor(e){super("Invalid Interval: "+e.toMessage())}}class InvalidDurationError extends LuxonError{constructor(e){super("Invalid Duration: "+e.toMessage())}}class ConflictingSpecificationError extends LuxonError{}class InvalidUnitError extends LuxonError{constructor(e){super("Invalid unit "+e)}}class InvalidArgumentError extends LuxonError{}class ZoneIsAbstractError extends LuxonError{constructor(){super("Zone is an abstract class")}}const n$1="numeric",s$1="short",l$1="long",DATE_SHORT={year:n$1,month:n$1,day:n$1},DATE_MED={year:n$1,month:s$1,day:n$1},DATE_MED_WITH_WEEKDAY={year:n$1,month:s$1,day:n$1,weekday:s$1},DATE_FULL={year:n$1,month:l$1,day:n$1},DATE_HUGE={year:n$1,month:l$1,day:n$1,weekday:l$1},TIME_SIMPLE={hour:n$1,minute:n$1},TIME_WITH_SECONDS={hour:n$1,minute:n$1,second:n$1},TIME_WITH_SHORT_OFFSET={hour:n$1,minute:n$1,second:n$1,timeZoneName:s$1},TIME_WITH_LONG_OFFSET={hour:n$1,minute:n$1,second:n$1,timeZoneName:l$1},TIME_24_SIMPLE={hour:n$1,minute:n$1,hourCycle:"h23"},TIME_24_WITH_SECONDS={hour:n$1,minute:n$1,second:n$1,hourCycle:"h23"},TIME_24_WITH_SHORT_OFFSET={hour:n$1,minute:n$1,second:n$1,hourCycle:"h23",timeZoneName:s$1},TIME_24_WITH_LONG_OFFSET={hour:n$1,minute:n$1,second:n$1,hourCycle:"h23",timeZoneName:l$1},DATETIME_SHORT={year:n$1,month:n$1,day:n$1,hour:n$1,minute:n$1},DATETIME_SHORT_WITH_SECONDS={year:n$1,month:n$1,day:n$1,hour:n$1,minute:n$1,second:n$1},DATETIME_MED={year:n$1,month:s$1,day:n$1,hour:n$1,minute:n$1},DATETIME_MED_WITH_SECONDS={year:n$1,month:s$1,day:n$1,hour:n$1,minute:n$1,second:n$1},DATETIME_MED_WITH_WEEKDAY={year:n$1,month:s$1,day:n$1,weekday:s$1,hour:n$1,minute:n$1},DATETIME_FULL={year:n$1,month:l$1,day:n$1,hour:n$1,minute:n$1,timeZoneName:s$1},DATETIME_FULL_WITH_SECONDS={year:n$1,month:l$1,day:n$1,hour:n$1,minute:n$1,second:n$1,timeZoneName:s$1},DATETIME_HUGE={year:n$1,month:l$1,day:n$1,weekday:l$1,hour:n$1,minute:n$1,timeZoneName:l$1},DATETIME_HUGE_WITH_SECONDS={year:n$1,month:l$1,day:n$1,weekday:l$1,hour:n$1,minute:n$1,second:n$1,timeZoneName:l$1};class Zone{get type(){throw new ZoneIsAbstractError}get name(){throw new ZoneIsAbstractError}get ianaName(){return this.name}get isUniversal(){throw new ZoneIsAbstractError}offsetName(e,t){throw new ZoneIsAbstractError}formatOffset(e,t){throw new ZoneIsAbstractError}offset(e){throw new ZoneIsAbstractError}equals(e){throw new ZoneIsAbstractError}get isValid(){throw new ZoneIsAbstractError}}let singleton$1=null;class SystemZone extends Zone{static get instance(){return null===singleton$1&&(singleton$1=new SystemZone),singleton$1}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return parseZoneInfo(e,t,n)}formatOffset(e,t){return formatOffset(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let dtfCache={};function makeDTF(e){return dtfCache[e]||(dtfCache[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),dtfCache[e]}const typeToPos={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function hackyOffset(e,t){const n=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,r,s,o,a,l,c,d]=i;return[o,r,s,a,l,c,d]}function partsOffset(e,t){const n=e.formatToParts(t),i=[];for(let e=0;e<n.length;e++){const{type:t,value:r}=n[e],s=typeToPos[t];"era"===t?i[s]=r:isUndefined(s)||(i[s]=parseInt(r,10))}return i}let ianaZoneCache={};class IANAZone extends Zone{static create(e){return ianaZoneCache[e]||(ianaZoneCache[e]=new IANAZone(e)),ianaZoneCache[e]}static resetCache(){ianaZoneCache={},dtfCache={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=IANAZone.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return parseZoneInfo(e,t,n,this.name)}formatOffset(e,t){return formatOffset(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const n=makeDTF(this.name);let[i,r,s,o,a,l,c]=n.formatToParts?partsOffset(n,t):hackyOffset(n,t);"BC"===o&&(i=1-Math.abs(i));let d=+t;const u=d%1e3;return d-=u>=0?u:1e3+u,(objToLocalTS({year:i,month:r,day:s,hour:24===a?0:a,minute:l,second:c,millisecond:0})-d)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let intlLFCache={};function getCachedLF(e,t={}){const n=JSON.stringify([e,t]);let i=intlLFCache[n];return i||(i=new Intl.ListFormat(e,t),intlLFCache[n]=i),i}let intlDTCache={};function getCachedDTF(e,t={}){const n=JSON.stringify([e,t]);let i=intlDTCache[n];return i||(i=new Intl.DateTimeFormat(e,t),intlDTCache[n]=i),i}let intlNumCache={};function getCachedINF(e,t={}){const n=JSON.stringify([e,t]);let i=intlNumCache[n];return i||(i=new Intl.NumberFormat(e,t),intlNumCache[n]=i),i}let intlRelCache={};function getCachedRTF(e,t={}){const{base:n,...i}=t,r=JSON.stringify([e,i]);let s=intlRelCache[r];return s||(s=new Intl.RelativeTimeFormat(e,t),intlRelCache[r]=s),s}let sysLocaleCache=null;function systemLocale(){return sysLocaleCache||(sysLocaleCache=(new Intl.DateTimeFormat).resolvedOptions().locale,sysLocaleCache)}let weekInfoCache={};function getCachedWeekInfo(e){let t=weekInfoCache[e];if(!t){const n=new Intl.Locale(e);t="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,weekInfoCache[e]=t}return t}function parseLocaleString(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const n=e.indexOf("-u-");if(-1===n)return[e];{let t,i;try{t=getCachedDTF(e).resolvedOptions(),i=e}catch(r){const s=e.substring(0,n);t=getCachedDTF(s).resolvedOptions(),i=s}const{numberingSystem:r,calendar:s}=t;return[i,r,s]}}function intlConfigString(e,t,n){return n||t?(e.includes("-u-")||(e+="-u"),n&&(e+="-ca-"+n),t&&(e+="-nu-"+t),e):e}function mapMonths(e){const t=[];for(let n=1;n<=12;n++){const i=DateTime.utc(2009,n,1);t.push(e(i))}return t}function mapWeekdays(e){const t=[];for(let n=1;n<=7;n++){const i=DateTime.utc(2016,11,13+n);t.push(e(i))}return t}function listStuff(e,t,n,i){const r=e.listingMode();return"error"===r?null:"en"===r?n(t):i(t)}function supportsFastNumbers(e){return(!e.numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)}class PolyNumberFormatter{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:i,floor:r,...s}=n;if(!t||Object.keys(s).length>0){const t={useGrouping:!1,...n};n.padTo>0&&(t.minimumIntegerDigits=n.padTo),this.inf=getCachedINF(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return padStart(this.floor?Math.floor(e):roundTo(e,3),this.padTo)}}class PolyDateFormatter{constructor(e,t,n){let i;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,n=t>=0?"Etc/GMT+"+t:"Etc/GMT"+t;0!==e.offset&&IANAZone.create(n).valid?(i=n,this.dt=e):(i="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,i=e.zone.name):(i="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const r={...this.opts};r.timeZone=r.timeZone||i,this.dtf=getCachedDTF(t,r)}format(){return this.originalZone?this.formatToParts().map((({value:e})=>e)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class PolyRelFormatter{constructor(e,t,n){this.opts={style:"long",...n},!t&&hasRelative()&&(this.rtf=getCachedRTF(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):formatRelativeTime(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const fallbackWeekSettings={firstDay:1,minimalDays:4,weekend:[6,7]};class Locale{static fromOpts(e){return Locale.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,n,i,r=!1){const s=e||Settings.defaultLocale,o=s||(r?"en-US":systemLocale()),a=t||Settings.defaultNumberingSystem,l=n||Settings.defaultOutputCalendar,c=validateWeekSettings(i)||Settings.defaultWeekSettings;return new Locale(o,a,l,c,s)}static resetCache(){sysLocaleCache=null,intlDTCache={},intlNumCache={},intlRelCache={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:n,weekSettings:i}={}){return Locale.create(e,t,n,i)}constructor(e,t,n,i,r){const[s,o,a]=parseLocaleString(e);this.locale=s,this.numberingSystem=t||o||null,this.outputCalendar=n||a||null,this.weekSettings=i,this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){return null==this.fastNumbersCached&&(this.fastNumbersCached=supportsFastNumbers(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?Locale.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,validateWeekSettings(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return listStuff(this,e,months,(()=>{const n=t?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";return this.monthsCache[i][e]||(this.monthsCache[i][e]=mapMonths((e=>this.extract(e,n,"month")))),this.monthsCache[i][e]}))}weekdays(e,t=!1){return listStuff(this,e,weekdays,(()=>{const n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},i=t?"format":"standalone";return this.weekdaysCache[i][e]||(this.weekdaysCache[i][e]=mapWeekdays((e=>this.extract(e,n,"weekday")))),this.weekdaysCache[i][e]}))}meridiems(){return listStuff(this,void 0,(()=>meridiems),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return listStuff(this,e,eras,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,n){const i=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===n));return i?i.value:null}numberFormatter(e={}){return new PolyNumberFormatter(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new PolyDateFormatter(e,this.intl,t)}relFormatter(e={}){return new PolyRelFormatter(this.intl,this.isEnglish(),e)}listFormatter(e={}){return getCachedLF(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:hasLocaleWeekInfo()?getCachedWeekInfo(this.locale):fallbackWeekSettings}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return"Locale("+this.locale+", "+this.numberingSystem+", "+this.outputCalendar+")"}}let singleton=null;class FixedOffsetZone extends Zone{static get utcInstance(){return null===singleton&&(singleton=new FixedOffsetZone(0)),singleton}static instance(e){return 0===e?FixedOffsetZone.utcInstance:new FixedOffsetZone(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new FixedOffsetZone(signedOffset(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":"UTC"+formatOffset(this.fixed,"narrow")}get ianaName(){return 0===this.fixed?"Etc/UTC":"Etc/GMT"+formatOffset(-this.fixed,"narrow")}offsetName(){return this.name}formatOffset(e,t){return formatOffset(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class InvalidZone extends Zone{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function normalizeZone(e,t){if(isUndefined(e)||null===e)return t;if(e instanceof Zone)return e;if(isString(e)){const n=e.toLowerCase();return"default"===n?t:"local"===n||"system"===n?SystemZone.instance:"utc"===n||"gmt"===n?FixedOffsetZone.utcInstance:FixedOffsetZone.parseSpecifier(n)||IANAZone.create(e)}return isNumber(e)?FixedOffsetZone.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new InvalidZone(e)}const numberingSystems={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);if(-1!==e[n].search(numberingSystems.hanidec))t+=hanidecChars.indexOf(e[n]);else for(const e in numberingSystemsUTF16){const[n,r]=numberingSystemsUTF16[e];i>=n&&i<=r&&(t+=i-n)}}return parseInt(t,10)}return t}let digitRegexCache={};function resetDigitRegexCache(){digitRegexCache={}}function digitRegex({numberingSystem:e},t=""){const n=e||"latn";return digitRegexCache[n]||(digitRegexCache[n]={}),digitRegexCache[n][t]||(digitRegexCache[n][t]=new RegExp(""+numberingSystems[n]+t)),digitRegexCache[n][t]}let now$1=()=>Date.now(),defaultZone="system",defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,twoDigitCutoffYear=60,throwOnInvalid,defaultWeekSettings=null;class Settings{static get now(){return now$1}static set now(e){now$1=e}static set defaultZone(e){defaultZone=e}static get defaultZone(){return normalizeZone(defaultZone,SystemZone.instance)}static get defaultLocale(){return defaultLocale}static set defaultLocale(e){defaultLocale=e}static get defaultNumberingSystem(){return defaultNumberingSystem}static set defaultNumberingSystem(e){defaultNumberingSystem=e}static get defaultOutputCalendar(){return defaultOutputCalendar}static set defaultOutputCalendar(e){defaultOutputCalendar=e}static get defaultWeekSettings(){return defaultWeekSettings}static set defaultWeekSettings(e){defaultWeekSettings=validateWeekSettings(e)}static get twoDigitCutoffYear(){return twoDigitCutoffYear}static set twoDigitCutoffYear(e){twoDigitCutoffYear=e%100}static get throwOnInvalid(){return throwOnInvalid}static set throwOnInvalid(e){throwOnInvalid=e}static resetCaches(){Locale.resetCache(),IANAZone.resetCache(),DateTime.resetCache(),resetDigitRegexCache()}}class Invalid{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?this.reason+": "+this.explanation:this.reason}}const nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(e,t){return new Invalid("unit out of range","you specified "+t+" (of type "+typeof t+") as a "+e+", which is invalid")}function dayOfWeek(e,t,n){const i=new Date(Date.UTC(e,t-1,n));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const r=i.getUTCDay();return 0===r?7:r}function computeOrdinal(e,t,n){return n+(isLeapYear(e)?leapLadder:nonLeapLadder)[t-1]}function uncomputeOrdinal(e,t){const n=isLeapYear(e)?leapLadder:nonLeapLadder,i=n.findIndex((e=>e<t));return{month:i+1,day:t-n[i]}}function isoWeekdayToLocal(e,t){return(e-t+7)%7+1}function gregorianToWeek(e,t=4,n=1){const{year:i,month:r,day:s}=e,o=computeOrdinal(i,r,s),a=isoWeekdayToLocal(dayOfWeek(i,r,s),n);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=i-1,c=weeksInWeekYear(l,t,n)):c>weeksInWeekYear(i,t,n)?(l=i+1,c=1):l=i,{weekYear:l,weekNumber:c,weekday:a,...timeObject(e)}}function weekToGregorian(e,t=4,n=1){const{weekYear:i,weekNumber:r,weekday:s}=e,o=isoWeekdayToLocal(dayOfWeek(i,1,t),n),a=daysInYear(i);let l,c=7*r+s-o-7+t;c<1?(l=i-1,c+=daysInYear(l)):c>a?(l=i+1,c-=daysInYear(i)):l=i;const{month:d,day:u}=uncomputeOrdinal(l,c);return{year:l,month:d,day:u,...timeObject(e)}}function gregorianToOrdinal(e){const{year:t,month:n,day:i}=e;return{year:t,ordinal:computeOrdinal(t,n,i),...timeObject(e)}}function ordinalToGregorian(e){const{year:t,ordinal:n}=e,{month:i,day:r}=uncomputeOrdinal(t,n);return{year:t,month:i,day:r,...timeObject(e)}}function usesLocalWeekValues(e,t){if(!isUndefined(e.localWeekday)||!isUndefined(e.localWeekNumber)||!isUndefined(e.localWeekYear)){if(!isUndefined(e.weekday)||!isUndefined(e.weekNumber)||!isUndefined(e.weekYear))throw new ConflictingSpecificationError("Cannot mix locale-based week fields with ISO-based week fields");return isUndefined(e.localWeekday)||(e.weekday=e.localWeekday),isUndefined(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),isUndefined(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function hasInvalidWeekData(e,t=4,n=1){const i=isInteger(e.weekYear),r=integerBetween(e.weekNumber,1,weeksInWeekYear(e.weekYear,t,n)),s=integerBetween(e.weekday,1,7);return i?r?!s&&unitOutOfRange("weekday",e.weekday):unitOutOfRange("week",e.weekNumber):unitOutOfRange("weekYear",e.weekYear)}function hasInvalidOrdinalData(e){const t=isInteger(e.year),n=integerBetween(e.ordinal,1,daysInYear(e.year));return t?!n&&unitOutOfRange("ordinal",e.ordinal):unitOutOfRange("year",e.year)}function hasInvalidGregorianData(e){const t=isInteger(e.year),n=integerBetween(e.month,1,12),i=integerBetween(e.day,1,daysInMonth(e.year,e.month));return t?n?!i&&unitOutOfRange("day",e.day):unitOutOfRange("month",e.month):unitOutOfRange("year",e.year)}function hasInvalidTimeData(e){const{hour:t,minute:n,second:i,millisecond:r}=e,s=integerBetween(t,0,23)||24===t&&0===n&&0===i&&0===r,o=integerBetween(n,0,59),a=integerBetween(i,0,59),l=integerBetween(r,0,999);return s?o?a?!l&&unitOutOfRange("millisecond",r):unitOutOfRange("second",i):unitOutOfRange("minute",n):unitOutOfRange("hour",t)}function isUndefined(e){return void 0===e}function isNumber(e){return"number"==typeof e}function isInteger(e){return"number"==typeof e&&e%1==0}function isString(e){return"string"==typeof e}function isDate(e){return"[object Date]"===Object.prototype.toString.call(e)}function hasRelative(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function hasLocaleWeekInfo(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function maybeArray(e){return Array.isArray(e)?e:[e]}function bestBy(e,t,n){if(0!==e.length)return e.reduce(((e,i)=>{const r=[t(i),i];return e&&n(e[0],r[0])===e[0]?e:r}),null)[1]}function pick$2(e,t){return t.reduce(((t,n)=>(t[n]=e[n],t)),{})}function hasOwnProperty$d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function validateWeekSettings(e){if(null==e)return null;if("object"!=typeof e)throw new InvalidArgumentError("Week settings must be an object");if(!integerBetween(e.firstDay,1,7)||!integerBetween(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((e=>!integerBetween(e,1,7))))throw new InvalidArgumentError("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function integerBetween(e,t,n){return isInteger(e)&&e>=t&&e<=n}function floorMod(e,t){return e-t*Math.floor(e/t)}function padStart(e,t=2){let n;return n=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),n}function parseInteger(e){return isUndefined(e)||null===e||""===e?void 0:parseInt(e,10)}function parseFloating(e){return isUndefined(e)||null===e||""===e?void 0:parseFloat(e)}function parseMillis(e){if(!isUndefined(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function roundTo(e,t,n=!1){const i=10**t;return(n?Math.trunc:Math.round)(e*i)/i}function isLeapYear(e){return e%4==0&&(e%100!=0||e%400==0)}function daysInYear(e){return isLeapYear(e)?366:365}function daysInMonth(e,t){const n=floorMod(t-1,12)+1;return 2===n?isLeapYear(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function objToLocalTS(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function firstWeekOffset(e,t,n){return-isoWeekdayToLocal(dayOfWeek(e,1,t),n)+t-1}function weeksInWeekYear(e,t=4,n=1){const i=firstWeekOffset(e,t,n),r=firstWeekOffset(e+1,t,n);return(daysInYear(e)-i+r)/7}function untruncateYear(e){return e>99?e:e>Settings.twoDigitCutoffYear?1900+e:2e3+e}function parseZoneInfo(e,t,n,i=null){const r=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:t,...s},a=new Intl.DateTimeFormat(n,o).formatToParts(r).find((e=>"timezonename"===e.type.toLowerCase()));return a?a.value:null}function signedOffset(e,t){let n=parseInt(e,10);Number.isNaN(n)&&(n=0);const i=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-i:i)}function asNumber$2(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new InvalidArgumentError("Invalid unit value "+e);return t}function normalizeObject(e,t){const n={};for(const i in e)if(hasOwnProperty$d(e,i)){const r=e[i];if(null==r)continue;n[t(i)]=asNumber$2(r)}return n}function formatOffset(e,t){const n=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),r=e>=0?"+":"-";switch(t){case"short":return""+r+padStart(n,2)+":"+padStart(i,2);case"narrow":return""+r+n+(i>0?":"+i:"");case"techie":return""+r+padStart(n,2)+padStart(i,2);default:throw new RangeError("Value format "+t+" is out of range for property format")}}function timeObject(e){return pick$2(e,["hour","minute","second","millisecond"])}const monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(e){switch(e){case"narrow":return[...monthsNarrow];case"short":return[...monthsShort];case"long":return[...monthsLong];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(e){switch(e){case"narrow":return[...weekdaysNarrow];case"short":return[...weekdaysShort];case"long":return[...weekdaysLong];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const meridiems=["AM","PM"],erasLong=["Before Christ","Anno Domini"],erasShort=["BC","AD"],erasNarrow=["B","A"];function eras(e){switch(e){case"narrow":return[...erasNarrow];case"short":return[...erasShort];case"long":return[...erasLong];default:return null}}function meridiemForDateTime(e){return meridiems[e.hour<12?0:1]}function weekdayForDateTime(e,t){return weekdays(t)[e.weekday-1]}function monthForDateTime(e,t){return months(t)[e.month-1]}function eraForDateTime(e,t){return eras(t)[e.year<0?0:1]}function formatRelativeTime(e,t,n="always",i=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&s){const n="days"===e;switch(t){case 1:return n?"tomorrow":"next "+r[e][0];case-1:return n?"yesterday":"last "+r[e][0];case 0:return n?"today":"this "+r[e][0]}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=r[e],d=i?l?c[1]:c[2]||c[1]:l?r[e][0]:e;return o?a+" "+d+" ago":"in "+a+" "+d}function stringifyTokens(e,t){let n="";for(const i of e)i.literal?n+=i.val:n+=t(i.val);return n}const macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS};class Formatter{static create(e,t={}){return new Formatter(e,t)}static parseFormat(e){let t=null,n="",i=!1;const r=[];for(let s=0;s<e.length;s++){const o=e.charAt(s);"'"===o?(n.length>0&&r.push({literal:i||/^\s+$/.test(n),val:n}),t=null,n="",i=!i):i||o===t?n+=o:(n.length>0&&r.push({literal:/^\s+$/.test(n),val:n}),n=o,t=o)}return n.length>0&&r.push({literal:i||/^\s+$/.test(n),val:n}),r}static macroTokenToFormatOpts(e){return macroTokenToFormatOpts[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return padStart(e,t);const n={...this.opts};return t>0&&(n.padTo=t),this.loc.numberFormatter(n).format(e)}formatDateTimeFromString(e,t){const n="en"===this.loc.listingMode(),i=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,r=(t,n)=>this.loc.extract(e,t,n),s=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=(t,i)=>n?monthForDateTime(e,t):r(i?{month:t}:{month:t,day:"numeric"},"month"),a=(t,i)=>n?weekdayForDateTime(e,t):r(i?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),l=t=>{const n=Formatter.macroTokenToFormatOpts(t);return n?this.formatWithSystemDefault(e,n):t},c=t=>n?eraForDateTime(e,t):r({era:t},"era");return stringifyTokens(Formatter.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return n?meridiemForDateTime(e):r({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return i?r({day:"numeric"},"day"):this.num(e.day);case"dd":return i?r({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return a("short",!0);case"cccc":return a("long",!0);case"ccccc":return a("narrow",!0);case"EEE":return a("short",!1);case"EEEE":return a("long",!1);case"EEEEE":return a("narrow",!1);case"L":return i?r({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return i?r({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return o("short",!0);case"LLLL":return o("long",!0);case"LLLLL":return o("narrow",!0);case"M":return i?r({month:"numeric"},"month"):this.num(e.month);case"MM":return i?r({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return o("short",!1);case"MMMM":return o("long",!1);case"MMMMM":return o("narrow",!1);case"y":return i?r({year:"numeric"},"year"):this.num(e.year);case"yy":return i?r({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return i?r({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return i?r({year:"numeric"},"year"):this.num(e.year,6);case"G":return c("short");case"GG":return c("long");case"GGGGG":return c("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return l(t)}}))}formatDurationFromString(e,t){const n=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},i=Formatter.parseFormat(t),r=i.reduce(((e,{literal:t,val:n})=>t?e:e.concat(n)),[]),s=e.shiftTo(...r.map(n).filter((e=>e)));return stringifyTokens(i,(e=>t=>{const i=n(t);return i?this.num(e.get(i),t.length):t})(s))}}const ianaRegex=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function combineRegexes(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp("^"+t+"$")}function combineExtractors(...e){return t=>e.reduce((([e,n,i],r)=>{const[s,o,a]=r(t,i);return[{...e,...s},o||n,a]}),[{},null,1]).slice(0,2)}function parse$1(e,...t){if(null==e)return[null,null];for(const[n,i]of t){const t=n.exec(e);if(t)return i(t)}return[null,null]}function simpleParse(...e){return(t,n)=>{const i={};let r;for(r=0;r<e.length;r++)i[e[r]]=parseInteger(t[n+r]);return[i,null,n+r]}}const offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,isoExtendedZone="(?:"+offsetRegex.source+"?(?:\\[("+ianaRegex.source+")\\])?)?",isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,isoTimeRegex=RegExp(""+isoTimeBaseRegex.source+isoExtendedZone),isoTimeExtensionRegex=RegExp("(?:T"+isoTimeRegex.source+")?"),isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/,isoOrdinalRegex=/(\d{4})-?(\d{3})/,extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay"),extractISOOrdinalData=simpleParse("year","ordinal"),sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/,sqlTimeRegex=RegExp(isoTimeBaseRegex.source+" ?(?:"+offsetRegex.source+"|("+ianaRegex.source+"))?"),sqlTimeExtensionRegex=RegExp("(?: "+sqlTimeRegex.source+")?");function int(e,t,n){const i=e[t];return isUndefined(i)?n:parseInteger(i)}function extractISOYmd(e,t){return[{year:int(e,t),month:int(e,t+1,1),day:int(e,t+2,1)},null,t+3]}function extractISOTime(e,t){return[{hours:int(e,t,0),minutes:int(e,t+1,0),seconds:int(e,t+2,0),milliseconds:parseMillis(e[t+3])},null,t+4]}function extractISOOffset(e,t){const n=!e[t]&&!e[t+1],i=signedOffset(e[t+1],e[t+2]);return[{},n?null:FixedOffsetZone.instance(i),t+3]}function extractIANAZone(e,t){return[{},e[t]?IANAZone.create(e[t]):null,t+1]}const isoTimeOnly=RegExp("^T?"+isoTimeBaseRegex.source+"$"),isoDuration=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function extractISODuration(e){const[t,n,i,r,s,o,a,l,c]=e,d="-"===t[0],u=l&&"-"===l[0],h=(e,t=!1)=>void 0!==e&&(t||e&&d)?-e:e;return[{years:h(parseFloating(n)),months:h(parseFloating(i)),weeks:h(parseFloating(r)),days:h(parseFloating(s)),hours:h(parseFloating(o)),minutes:h(parseFloating(a)),seconds:h(parseFloating(l),"-0"===l),milliseconds:h(parseMillis(c),u)}]}const obsOffsets={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function fromStrings(e,t,n,i,r,s,o){const a={year:2===t.length?untruncateYear(parseInteger(t)):parseInteger(t),month:monthsShort.indexOf(n)+1,day:parseInteger(i),hour:parseInteger(r),minute:parseInteger(s)};return o&&(a.second=parseInteger(o)),e&&(a.weekday=e.length>3?weekdaysLong.indexOf(e)+1:weekdaysShort.indexOf(e)+1),a}const rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(e){const[,t,n,i,r,s,o,a,l,c,d,u]=e,h=fromStrings(t,r,i,n,s,o,a);let m;return m=l?obsOffsets[l]:c?0:signedOffset(d,u),[h,new FixedOffsetZone(m)]}function preprocessRFC2822(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(e){const[,t,n,i,r,s,o,a]=e;return[fromStrings(t,r,i,n,s,o,a),FixedOffsetZone.utcInstance]}function extractASCII(e){const[,t,n,i,r,s,o,a]=e;return[fromStrings(t,a,n,i,r,s,o),FixedOffsetZone.utcInstance]}const isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex),isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex),isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex),isoTimeCombinedRegex=combineRegexes(isoTimeRegex),extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone),extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset,extractIANAZone),extractISOOrdinalDateAndTime=combineExtractors(extractISOOrdinalData,extractISOTime,extractISOOffset,extractIANAZone),extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseISODate(e){return parse$1(e,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDateAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset])}function parseRFC2822Date(e){return parse$1(preprocessRFC2822(e),[rfc2822,extractRFC2822])}function parseHTTPDate(e){return parse$1(e,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII])}function parseISODuration(e){return parse$1(e,[isoDuration,extractISODuration])}const extractISOTimeOnly=combineExtractors(extractISOTime);function parseISOTimeOnly(e){return parse$1(e,[isoTimeOnly,extractISOTimeOnly])}const sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex),sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex),extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(e){return parse$1(e,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone])}const INVALID$2="Invalid Duration",lowOrderMatrix={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},casualMatrix={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...lowOrderMatrix},daysInYearAccurate=365.2425,daysInMonthAccurate=30.436875,accurateMatrix={years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:24*daysInYearAccurate,minutes:24*daysInYearAccurate*60,seconds:24*daysInYearAccurate*60*60,milliseconds:24*daysInYearAccurate*60*60*1e3},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:24*daysInYearAccurate/4,minutes:24*daysInYearAccurate*60/4,seconds:24*daysInYearAccurate*60*60/4,milliseconds:24*daysInYearAccurate*60*60*1e3/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:24*daysInMonthAccurate,minutes:24*daysInMonthAccurate*60,seconds:24*daysInMonthAccurate*60*60,milliseconds:24*daysInMonthAccurate*60*60*1e3},...lowOrderMatrix},orderedUnits$1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],reverseUnits=orderedUnits$1.slice(0).reverse();function clone$1(e,t,n=!1){const i={values:n?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new Duration(i)}function durationToMillis(e,t){let n=t.milliseconds??0;for(const i of reverseUnits.slice(1))t[i]&&(n+=t[i]*e[i].milliseconds);return n}function normalizeValues(e,t){const n=durationToMillis(e,t)<0?-1:1;orderedUnits$1.reduceRight(((i,r)=>{if(isUndefined(t[r]))return i;if(i){const s=t[i]*n,o=e[r][i],a=Math.floor(s/o);t[r]+=a*n,t[i]-=a*o*n}return r}),null),orderedUnits$1.reduce(((n,i)=>{if(isUndefined(t[i]))return n;if(n){const r=t[n]%1;t[n]-=r,t[i]+=r*e[n][i]}return i}),null)}function removeZeroes(e){const t={};for(const[n,i]of Object.entries(e))0!==i&&(t[n]=i);return t}class Duration{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let n=t?accurateMatrix:casualMatrix;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||Locale.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return Duration.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new InvalidArgumentError("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new Duration({values:normalizeObject(e,Duration.normalizeUnit),loc:Locale.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(isNumber(e))return Duration.fromMillis(e);if(Duration.isDuration(e))return e;if("object"==typeof e)return Duration.fromObject(e);throw new InvalidArgumentError("Unknown duration argument "+e+" of type "+typeof e)}static fromISO(e,t){const[n]=parseISODuration(e);return n?Duration.fromObject(n,t):Duration.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")}static fromISOTime(e,t){const[n]=parseISOTimeOnly(e);return n?Duration.fromObject(n,t):Duration.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the Duration is invalid");const n=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidDurationError(n);return new Duration({invalid:n})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new InvalidUnitError(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const n={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?Formatter.create(this.loc,n).formatDurationFromString(this,e):INVALID$2}toHuman(e={}){if(!this.isValid)return INVALID$2;const t=orderedUnits$1.map((t=>{const n=this.values[t];return isUndefined(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(n)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=roundTo(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},DateTime.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"Duration { values: "+JSON.stringify(this.values)+" }":"Duration { Invalid, reason: "+this.invalidReason+" }"}toMillis(){return this.isValid?durationToMillis(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e),n={};for(const e of orderedUnits$1)(hasOwnProperty$d(t.values,e)||hasOwnProperty$d(this.values,e))&&(n[e]=t.get(e)+this.get(e));return clone$1(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const t=Duration.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const n of Object.keys(this.values))t[n]=asNumber$2(e(this.values[n],n));return clone$1(this,{values:t},!0)}get(e){return this[Duration.normalizeUnit(e)]}set(e){return this.isValid?clone$1(this,{values:{...this.values,...normalizeObject(e,Duration.normalizeUnit)}}):this}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:n,matrix:i}={}){return clone$1(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:i,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return normalizeValues(this.matrix,e),clone$1(this,{values:e},!0)}rescale(){return this.isValid?clone$1(this,{values:removeZeroes(this.normalize().shiftToAll().toObject())},!0):this}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>Duration.normalizeUnit(e)));const t={},n={},i=this.toObject();let r;for(const s of orderedUnits$1)if(e.indexOf(s)>=0){r=s;let e=0;for(const t in n)e+=this.matrix[t][s]*n[t],n[t]=0;isNumber(i[s])&&(e+=i[s]);const o=Math.trunc(e);t[s]=o,n[s]=(1e3*e-1e3*o)/1e3}else isNumber(i[s])&&(n[s]=i[s]);for(const e in n)0!==n[e]&&(t[r]+=e===r?n[e]:n[e]/this.matrix[r][e]);return normalizeValues(this.matrix,t),clone$1(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return clone$1(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const i of orderedUnits$1)if(t=this.values[i],n=e.values[i],!(void 0===t||0===t?void 0===n||0===n:t===n))return!1;var t,n;return!0}}const INVALID$1="Invalid Interval";function validateStartEnd(e,t){return e&&e.isValid?t&&t.isValid?t<e?Interval.invalid("end before start","The end of an interval must be after its start, but you had start="+e.toISO()+" and end="+t.toISO()):null:Interval.invalid("missing or invalid end"):Interval.invalid("missing or invalid start")}class Interval{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the Interval is invalid");const n=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidIntervalError(n);return new Interval({invalid:n})}static fromDateTimes(e,t){const n=friendlyDateTime(e),i=friendlyDateTime(t),r=validateStartEnd(n,i);return null==r?new Interval({start:n,end:i}):r}static after(e,t){const n=Duration.fromDurationLike(t),i=friendlyDateTime(e);return Interval.fromDateTimes(i,i.plus(n))}static before(e,t){const n=Duration.fromDurationLike(t),i=friendlyDateTime(e);return Interval.fromDateTimes(i.minus(n),i)}static fromISO(e,t){const[n,i]=(e||"").split("/",2);if(n&&i){let e,r,s,o;try{e=DateTime.fromISO(n,t),r=e.isValid}catch(e){r=!1}try{s=DateTime.fromISO(i,t),o=s.isValid}catch(e){o=!1}if(r&&o)return Interval.fromDateTimes(e,s);if(r){const n=Duration.fromISO(i,t);if(n.isValid)return Interval.after(e,n)}else if(o){const e=Duration.fromISO(n,t);if(e.isValid)return Interval.before(s,e)}}return Interval.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const n=this.start.startOf(e,t);let i;return i=t?.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,i=i.startOf(e,t),Math.floor(i.diff(n,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&this.s<=e&&this.e>e}set({start:e,end:t}={}){return this.isValid?Interval.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(friendlyDateTime).filter((e=>this.contains(e))).sort(((e,t)=>e.toMillis()-t.toMillis())),n=[];let{s:i}=this,r=0;for(;i<this.e;){const e=t[r]||this.e,s=+e>+this.e?this.e:e;n.push(Interval.fromDateTimes(i,s)),i=s,r+=1}return n}splitBy(e){const t=Duration.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let n,{s:i}=this,r=1;const s=[];for(;i<this.e;){const e=this.start.plus(t.mapUnits((e=>e*r)));n=+e>+this.e?this.e:e,s.push(Interval.fromDateTimes(i,n)),i=n,r+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e}equals(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:Interval.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return Interval.fromDateTimes(t,n)}static merge(e){const[t,n]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],n)=>t?t.overlaps(n)||t.abutsStart(n)?[e,t.union(n)]:[e.concat([t]),n]:[e,n]),[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0;const i=[],r=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),s=Array.prototype.concat(...r).sort(((e,t)=>e.time-t.time));for(const e of s)n+="s"===e.type?1:-1,1===n?t=e.time:(t&&+t!=+e.time&&i.push(Interval.fromDateTimes(t,e.time)),t=null);return Interval.merge(i)}difference(...e){return Interval.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?"["+this.s.toISO()+" – "+this.e.toISO()+")":INVALID$1}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"Interval { start: "+this.s.toISO()+", end: "+this.e.toISO()+" }":"Interval { Invalid, reason: "+this.invalidReason+" }"}toLocaleString(e=DATE_SHORT,t={}){return this.isValid?Formatter.create(this.s.loc.clone(t),e).formatInterval(this):INVALID$1}toISO(e){return this.isValid?this.s.toISO(e)+"/"+this.e.toISO(e):INVALID$1}toISODate(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():INVALID$1}toISOTime(e){return this.isValid?this.s.toISOTime(e)+"/"+this.e.toISOTime(e):INVALID$1}toFormat(e,{separator:t=" – "}={}){return this.isValid?""+this.s.toFormat(e)+t+this.e.toFormat(e):INVALID$1}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Duration.invalid(this.invalidReason)}mapEndpoints(e){return Interval.fromDateTimes(e(this.s),e(this.e))}}class Info{static hasDST(e=Settings.defaultZone){const t=DateTime.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return IANAZone.isValidZone(e)}static normalizeZone(e){return normalizeZone(e,Settings.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||Locale.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:n=null,locObj:i=null,outputCalendar:r="gregory"}={}){return(i||Locale.create(t,n,r)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:i=null,outputCalendar:r="gregory"}={}){return(i||Locale.create(t,n,r)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:n=null,locObj:i=null}={}){return(i||Locale.create(t,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:i=null}={}){return(i||Locale.create(t,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Locale.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Locale.create(t,null,"gregory").eras(e)}static features(){return{relative:hasRelative(),localeWeek:hasLocaleWeekInfo()}}}function dayDiff(e,t){const n=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=n(t)-n(e);return Math.floor(Duration.fromMillis(i).as("days"))}function highOrderDiffs(e,t,n){const i=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const n=dayDiff(e,t);return(n-n%7)/7}],["days",dayDiff]],r={},s=e;let o,a;for(const[l,c]of i)n.indexOf(l)>=0&&(o=l,r[l]=c(e,t),a=s.plus(r),a>t?(r[l]--,(e=s.plus(r))>t&&(a=e,r[l]--,e=s.plus(r))):e=a);return[e,r,a,o]}function diff(e,t,n,i){let[r,s,o,a]=highOrderDiffs(e,t,n);const l=t-r,c=n.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===c.length&&(o<t&&(o=r.plus({[a]:1})),o!==r&&(s[a]=(s[a]||0)+l/(o-r)));const d=Duration.fromObject(s,i);return c.length>0?Duration.fromMillis(l,i).shiftTo(...c).plus(d):d}const MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(e,t=e=>e){return{regex:e,deser:([e])=>t(parseDigits(e))}}const NBSP=String.fromCharCode(160),spaceOrNBSP="[ "+NBSP+"]",spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(e){return e.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP)}function stripInsensitivities(e){return e.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase()}function oneOf(e,t){return null===e?null:{regex:RegExp(e.map(fixListRegex).join("|")),deser:([n])=>e.findIndex((e=>stripInsensitivities(n)===stripInsensitivities(e)))+t}}function offset(e,t){return{regex:e,deser:([,e,t])=>signedOffset(e,t),groups:t}}function simple(e){return{regex:e,deser:([e])=>e}}function escapeToken(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function unitForToken(e,t){const n=digitRegex(t),i=digitRegex(t,"{2}"),r=digitRegex(t,"{3}"),s=digitRegex(t,"{4}"),o=digitRegex(t,"{6}"),a=digitRegex(t,"{1,2}"),l=digitRegex(t,"{1,3}"),c=digitRegex(t,"{1,6}"),d=digitRegex(t,"{1,9}"),u=digitRegex(t,"{2,4}"),h=digitRegex(t,"{4,6}"),m=e=>({regex:RegExp(escapeToken(e.val)),deser:([e])=>e,literal:!0}),g=(g=>{if(e.literal)return m(g);switch(g.val){case"G":return oneOf(t.eras("short"),0);case"GG":return oneOf(t.eras("long"),0);case"y":return intUnit(c);case"yy":case"kk":return intUnit(u,untruncateYear);case"yyyy":case"kkkk":return intUnit(s);case"yyyyy":return intUnit(h);case"yyyyyy":return intUnit(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return intUnit(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return intUnit(i);case"MMM":return oneOf(t.months("short",!0),1);case"MMMM":return oneOf(t.months("long",!0),1);case"LLL":return oneOf(t.months("short",!1),1);case"LLLL":return oneOf(t.months("long",!1),1);case"o":case"S":return intUnit(l);case"ooo":case"SSS":return intUnit(r);case"u":return simple(d);case"uu":return simple(a);case"uuu":case"E":case"c":return intUnit(n);case"a":return oneOf(t.meridiems(),0);case"EEE":return oneOf(t.weekdays("short",!1),1);case"EEEE":return oneOf(t.weekdays("long",!1),1);case"ccc":return oneOf(t.weekdays("short",!0),1);case"cccc":return oneOf(t.weekdays("long",!0),1);case"Z":case"ZZ":return offset(new RegExp("([+-]"+a.source+")(?::("+i.source+"))?"),2);case"ZZZ":return offset(new RegExp("([+-]"+a.source+")("+i.source+")?"),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);case" ":return simple(/[^\S\n\r]/);default:return m(g)}})(e)||{invalidReason:MISSING_FTP};return g.token=e,g}const partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function tokenForPart(e,t,n){const{type:i,value:r}=e;if("literal"===i){const e=/^\s+$/.test(r);return{literal:!e,val:e?" ":r}}const s=t[i];let o=i;"hour"===i&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let a=partTypeStyleToTokenVal[o];if("object"==typeof a&&(a=a[s]),a)return{literal:!1,val:a}}function buildRegex(e){return["^"+e.map((e=>e.regex)).reduce(((e,t)=>e+"("+t.source+")"),"")+"$",e]}function match(e,t,n){const i=e.match(t);if(i){const e={};let t=1;for(const r in n)if(hasOwnProperty$d(n,r)){const s=n[r],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(e[s.token.val[0]]=s.deser(i.slice(t,t+o))),t+=o}return[i,e]}return[i,{}]}function dateTimeFromMatches(e){let t,n=null;isUndefined(e.z)||(n=IANAZone.create(e.z)),isUndefined(e.Z)||(n||(n=new FixedOffsetZone(e.Z)),t=e.Z),isUndefined(e.q)||(e.M=3*(e.q-1)+1),isUndefined(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),isUndefined(e.u)||(e.S=parseMillis(e.u));return[Object.keys(e).reduce(((t,n)=>{const i=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return i&&(t[i]=e[n]),t}),{}),n,t]}let dummyDateTimeCache=null;function getDummyDateTime(){return dummyDateTimeCache||(dummyDateTimeCache=DateTime.fromMillis(1555555555555)),dummyDateTimeCache}function maybeExpandMacroToken(e,t){if(e.literal)return e;const n=formatOptsToTokens(Formatter.macroTokenToFormatOpts(e.val),t);return null==n||n.includes(void 0)?e:n}function expandMacroTokens(e,t){return Array.prototype.concat(...e.map((e=>maybeExpandMacroToken(e,t))))}class TokenParser{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=expandMacroTokens(Formatter.parseFormat(t),e),this.units=this.tokens.map((t=>unitForToken(t,e))),this.disqualifyingUnit=this.units.find((e=>e.invalidReason)),!this.disqualifyingUnit){const[e,t]=buildRegex(this.units);this.regex=RegExp(e,"i"),this.handlers=t}}explainFromTokens(e){if(this.isValid){const[t,n]=match(e,this.regex,this.handlers),[i,r,s]=n?dateTimeFromMatches(n):[null,null,void 0];if(hasOwnProperty$d(n,"a")&&hasOwnProperty$d(n,"H"))throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:n,result:i,zone:r,specificOffset:s}}return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function explainFromTokens(e,t,n){return new TokenParser(e,n).explainFromTokens(t)}function parseFromTokens(e,t,n){const{result:i,zone:r,specificOffset:s,invalidReason:o}=explainFromTokens(e,t,n);return[i,r,s,o]}function formatOptsToTokens(e,t){if(!e)return null;const n=Formatter.create(t,e).dtFormatter(getDummyDateTime()),i=n.formatToParts(),r=n.resolvedOptions();return i.map((t=>tokenForPart(t,e,r)))}const INVALID="Invalid DateTime",MAX_DATE=864e13;function unsupportedZone(e){return new Invalid("unsupported zone",'the zone "'+e.name+'" is not supported')}function possiblyCachedWeekData(e){return null===e.weekData&&(e.weekData=gregorianToWeek(e.c)),e.weekData}function possiblyCachedLocalWeekData(e){return null===e.localWeekData&&(e.localWeekData=gregorianToWeek(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function clone(e,t){const n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new DateTime({...n,...t,old:n})}function fixOffset(e,t,n){let i=e-60*t*1e3;const r=n.offset(i);if(t===r)return[i,t];i-=60*(r-t)*1e3;const s=n.offset(i);return r===s?[i,r]:[e-60*Math.min(r,s)*1e3,Math.max(r,s)]}function tsToObj(e,t){const n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function objToTS(e,t,n){return fixOffset(objToLocalTS(e),t,n)}function adjustTime(e,t){const n=e.o,i=e.c.year+Math.trunc(t.years),r=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s={...e.c,year:i,month:r,day:Math.min(e.c.day,daysInMonth(i,r))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=Duration.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=objToLocalTS(s);let[l,c]=fixOffset(a,n,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function parseDataToDateTime(e,t,n,i,r,s){const{setZone:o,zone:a}=n;if(e&&0!==Object.keys(e).length||t){const i=t||a,r=DateTime.fromObject(e,{...n,zone:i,specificOffset:s});return o?r:r.setZone(a)}return DateTime.invalid(new Invalid("unparsable",'the input "'+r+"\" can't be parsed as "+i))}function toTechFormat(e,t,n=!0){return e.isValid?Formatter.create(Locale.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function toISODate(e,t){const n=e.c.year>9999||e.c.year<0;let i="";return n&&e.c.year>=0&&(i+="+"),i+=padStart(e.c.year,n?6:4),t?(i+="-",i+=padStart(e.c.month),i+="-",i+=padStart(e.c.day)):(i+=padStart(e.c.month),i+=padStart(e.c.day)),i}function toISOTime(e,t,n,i,r,s){let o=padStart(e.c.hour);return t?(o+=":",o+=padStart(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=":")):o+=padStart(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=padStart(e.c.second),0===e.c.millisecond&&i||(o+=".",o+=padStart(e.c.millisecond,3))),r&&(e.isOffsetFixed&&0===e.offset&&!s?o+="Z":e.o<0?(o+="-",o+=padStart(Math.trunc(-e.o/60)),o+=":",o+=padStart(Math.trunc(-e.o%60))):(o+="+",o+=padStart(Math.trunc(e.o/60)),o+=":",o+=padStart(Math.trunc(e.o%60)))),s&&(o+="["+e.zone.ianaName+"]"),o}const defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0},orderedUnits=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new InvalidUnitError(e);return t}function normalizeUnitWithLocalWeeks(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return normalizeUnit(e)}}function guessOffsetForZone(e){return zoneOffsetGuessCache[e]||(void 0===zoneOffsetTs&&(zoneOffsetTs=Settings.now()),zoneOffsetGuessCache[e]=e.offset(zoneOffsetTs)),zoneOffsetGuessCache[e]}function quickDT(e,t){const n=normalizeZone(t.zone,Settings.defaultZone);if(!n.isValid)return DateTime.invalid(unsupportedZone(n));const i=Locale.fromObject(t);let r,s;if(isUndefined(e.year))r=Settings.now();else{for(const t of orderedUnits)isUndefined(e[t])&&(e[t]=defaultUnitValues[t]);const t=hasInvalidGregorianData(e)||hasInvalidTimeData(e);if(t)return DateTime.invalid(t);const i=guessOffsetForZone(n);[r,s]=objToTS(e,i,n)}return new DateTime({ts:r,zone:n,loc:i,o:s})}function diffRelative(e,t,n){const i=!!isUndefined(n.round)||n.round,r=(e,r)=>(e=roundTo(e,i||n.calendary?0:2,!0),t.loc.clone(n).relFormatter(n).format(e,r)),s=i=>n.calendary?t.hasSame(e,i)?0:t.startOf(i).diff(e.startOf(i),i).get(i):t.diff(e,i).get(i);if(n.unit)return r(s(n.unit),n.unit);for(const e of n.units){const t=s(e);if(Math.abs(t)>=1)return r(t,e)}return r(e>t?-0:0,n.units[n.units.length-1])}function lastOpts(e){let t,n={};return e.length>0&&"object"==typeof e[e.length-1]?(n=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[n,t]}let zoneOffsetTs,zoneOffsetGuessCache={};class DateTime{constructor(e){const t=e.zone||Settings.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new Invalid("invalid input"):null)||(t.isValid?null:unsupportedZone(t));this.ts=isUndefined(e.ts)?Settings.now():e.ts;let i=null,r=null;if(!n)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[i,r]=[e.old.c,e.old.o];else{const s=isNumber(e.o)&&!e.old?e.o:t.offset(this.ts);i=tsToObj(this.ts,s),n=Number.isNaN(i.year)?new Invalid("invalid input"):null,i=n?null:i,r=n?null:s}this._zone=t,this.loc=e.loc||Locale.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=i,this.o=r,this.isLuxonDateTime=!0}static now(){return new DateTime({})}static local(){const[e,t]=lastOpts(arguments),[n,i,r,s,o,a,l]=t;return quickDT({year:n,month:i,day:r,hour:s,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=lastOpts(arguments),[n,i,r,s,o,a,l]=t;return e.zone=FixedOffsetZone.utcInstance,quickDT({year:n,month:i,day:r,hour:s,minute:o,second:a,millisecond:l},e)}static fromJSDate(e,t={}){const n=isDate(e)?e.valueOf():NaN;if(Number.isNaN(n))return DateTime.invalid("invalid input");const i=normalizeZone(t.zone,Settings.defaultZone);return i.isValid?new DateTime({ts:n,zone:i,loc:Locale.fromObject(t)}):DateTime.invalid(unsupportedZone(i))}static fromMillis(e,t={}){if(isNumber(e))return e<-864e13||e>MAX_DATE?DateTime.invalid("Timestamp out of range"):new DateTime({ts:e,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError("fromMillis requires a numerical input, but received a "+typeof e+" with value "+e)}static fromSeconds(e,t={}){if(isNumber(e))return new DateTime({ts:1e3*e,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const n=normalizeZone(t.zone,Settings.defaultZone);if(!n.isValid)return DateTime.invalid(unsupportedZone(n));const i=Locale.fromObject(t),r=normalizeObject(e,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:s,startOfWeek:o}=usesLocalWeekValues(r,i),a=Settings.now(),l=isUndefined(t.specificOffset)?n.offset(a):t.specificOffset,c=!isUndefined(r.ordinal),d=!isUndefined(r.year),u=!isUndefined(r.month)||!isUndefined(r.day),h=d||u,m=r.weekYear||r.weekNumber;if((h||c)&&m)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&c)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");const g=m||r.weekday&&!h;let p,f,y=tsToObj(a,l);g?(p=orderedWeekUnits,f=defaultWeekUnitValues,y=gregorianToWeek(y,s,o)):c?(p=orderedOrdinalUnits,f=defaultOrdinalUnitValues,y=gregorianToOrdinal(y)):(p=orderedUnits,f=defaultUnitValues);let b=!1;for(const e of p)isUndefined(r[e])?r[e]=b?f[e]:y[e]:b=!0;const O=(g?hasInvalidWeekData(r,s,o):c?hasInvalidOrdinalData(r):hasInvalidGregorianData(r))||hasInvalidTimeData(r);if(O)return DateTime.invalid(O);const w=g?weekToGregorian(r,s,o):c?ordinalToGregorian(r):r,[v,S]=objToTS(w,l,n),T=new DateTime({ts:v,zone:n,o:S,loc:i});return r.weekday&&h&&e.weekday!==T.weekday?DateTime.invalid("mismatched weekday","you can't specify both a weekday of "+r.weekday+" and a date of "+T.toISO()):T.isValid?T:DateTime.invalid(T.invalid)}static fromISO(e,t={}){const[n,i]=parseISODate(e);return parseDataToDateTime(n,i,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[n,i]=parseRFC2822Date(e);return parseDataToDateTime(n,i,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[n,i]=parseHTTPDate(e);return parseDataToDateTime(n,i,t,"HTTP",t)}static fromFormat(e,t,n={}){if(isUndefined(e)||isUndefined(t))throw new InvalidArgumentError("fromFormat requires an input string and a format");const{locale:i=null,numberingSystem:r=null}=n,s=Locale.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0}),[o,a,l,c]=parseFromTokens(s,e,t);return c?DateTime.invalid(c):parseDataToDateTime(o,a,n,"format "+t,e,l)}static fromString(e,t,n={}){return DateTime.fromFormat(e,t,n)}static fromSQL(e,t={}){const[n,i]=parseSQL(e);return parseDataToDateTime(n,i,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");const n=e instanceof Invalid?e:new Invalid(e,t);if(Settings.throwOnInvalid)throw new InvalidDateTimeError(n);return new DateTime({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const n=formatOptsToTokens(e,Locale.fromObject(t));return n?n.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return expandMacroTokens(Formatter.parseFormat(e),Locale.fromObject(t)).map((e=>e.val)).join("")}static resetCache(){zoneOffsetTs=void 0,zoneOffsetGuessCache={}}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN}get weekNumber(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN}get weekday(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?possiblyCachedLocalWeekData(this).weekday:NaN}get localWeekNumber(){return this.isValid?possiblyCachedLocalWeekData(this).weekNumber:NaN}get localWeekYear(){return this.isValid?possiblyCachedLocalWeekData(this).weekYear:NaN}get ordinal(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN}get monthShort(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,n=objToLocalTS(this.c),i=this.zone.offset(n-e),r=this.zone.offset(n+e),s=this.zone.offset(n-i*t),o=this.zone.offset(n-r*t);if(s===o)return[this];const a=n-s*t,l=n-o*t,c=tsToObj(a,s),d=tsToObj(l,o);return c.hour===d.hour&&c.minute===d.minute&&c.second===d.second&&c.millisecond===d.millisecond?[clone(this,{ts:a}),clone(this,{ts:l})]:[this]}get isInLeapYear(){return isLeapYear(this.year)}get daysInMonth(){return daysInMonth(this.year,this.month)}get daysInYear(){return this.isValid?daysInYear(this.year):NaN}get weeksInWeekYear(){return this.isValid?weeksInWeekYear(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?weeksInWeekYear(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:n,calendar:i}=Formatter.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:i}}toUTC(e=0,t={}){return this.setZone(FixedOffsetZone.instance(e),t)}toLocal(){return this.setZone(Settings.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if((e=normalizeZone(e,Settings.defaultZone)).equals(this.zone))return this;if(e.isValid){let i=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[i]=objToTS(n,t,e)}return clone(this,{ts:i,zone:e})}return DateTime.invalid(unsupportedZone(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:n}={}){return clone(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=normalizeObject(e,normalizeUnitWithLocalWeeks),{minDaysInFirstWeek:n,startOfWeek:i}=usesLocalWeekValues(t,this.loc),r=!isUndefined(t.weekYear)||!isUndefined(t.weekNumber)||!isUndefined(t.weekday),s=!isUndefined(t.ordinal),o=!isUndefined(t.year),a=!isUndefined(t.month)||!isUndefined(t.day),l=o||a,c=t.weekYear||t.weekNumber;if((l||s)&&c)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&s)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");let d;r?d=weekToGregorian({...gregorianToWeek(this.c,n,i),...t},n,i):isUndefined(t.ordinal)?(d={...this.toObject(),...t},isUndefined(t.day)&&(d.day=Math.min(daysInMonth(d.year,d.month),d.day))):d=ordinalToGregorian({...gregorianToOrdinal(this.c),...t});const[u,h]=objToTS(d,this.o,this.zone);return clone(this,{ts:u,o:h})}plus(e){return this.isValid?clone(this,adjustTime(this,Duration.fromDurationLike(e))):this}minus(e){return this.isValid?clone(this,adjustTime(this,Duration.fromDurationLike(e).negate())):this}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const n={},i=Duration.normalizeUnit(e);switch(i){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===i)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(n.weekNumber=this.weekNumber-1),n.weekday=e}else n.weekday=1;if("quarters"===i){const e=Math.ceil(this.month/3);n.month=3*(e-1)+1}return this.set(n)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?Formatter.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):INVALID}toLocaleString(e=DATE_SHORT,t={}){return this.isValid?Formatter.create(this.loc.clone(t),e).formatDateTime(this):INVALID}toLocaleParts(e={}){return this.isValid?Formatter.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:i=!0,extendedZone:r=!1}={}){if(!this.isValid)return null;const s="extended"===e;let o=toISODate(this,s);return o+="T",o+=toISOTime(this,s,t,n,i,r),o}toISODate({format:e="extended"}={}){return this.isValid?toISODate(this,"extended"===e):null}toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:i=!1,extendedZone:r=!1,format:s="extended"}={}){return this.isValid?(i?"T":"")+toISOTime(this,"extended"===s,t,e,n,r):null}toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?toISODate(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}={}){let i="HH:mm:ss.SSS";return(t||e)&&(n&&(i+=" "),t?i+="z":e&&(i+="ZZ")),toTechFormat(this,i,!0)}toSQL(e={}){return this.isValid?this.toSQLDate()+" "+this.toSQLTime(e):null}toString(){return this.isValid?this.toISO():INVALID}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?"DateTime { ts: "+this.toISO()+", zone: "+this.zone.name+", locale: "+this.locale+" }":"DateTime { Invalid, reason: "+this.invalidReason+" }"}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",n={}){if(!this.isValid||!e.isValid)return Duration.invalid("created by diffing an invalid DateTime");const i={locale:this.locale,numberingSystem:this.numberingSystem,...n},r=maybeArray(t).map(Duration.normalizeUnit),s=e.valueOf()>this.valueOf(),o=diff(s?this:e,s?e:this,r,i);return s?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(DateTime.now(),e,t)}until(e){return this.isValid?Interval.fromDateTimes(this,e):this}hasSame(e,t,n){if(!this.isValid)return!1;const i=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t,n)<=i&&i<=r.endOf(t,n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||DateTime.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0;let i=["years","months","days","hours","minutes","seconds"],r=e.unit;return Array.isArray(e.unit)&&(i=e.unit,r=void 0),diffRelative(t,this.plus(n),{...e,numeric:"always",units:i,unit:r})}toRelativeCalendar(e={}){return this.isValid?diffRelative(e.base||DateTime.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(DateTime.isDateTime))throw new InvalidArgumentError("min requires all arguments be DateTimes");return bestBy(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(DateTime.isDateTime))throw new InvalidArgumentError("max requires all arguments be DateTimes");return bestBy(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,n={}){const{locale:i=null,numberingSystem:r=null}=n;return explainFromTokens(Locale.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,n={}){return DateTime.fromFormatExplain(e,t,n)}static buildFormatParser(e,t={}){const{locale:n=null,numberingSystem:i=null}=t,r=Locale.fromOpts({locale:n,numberingSystem:i,defaultToEN:!0});return new TokenParser(r,e)}static fromFormatParser(e,t,n={}){if(isUndefined(e)||isUndefined(t))throw new InvalidArgumentError("fromFormatParser requires an input string and a format parser");const{locale:i=null,numberingSystem:r=null}=n,s=Locale.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0});if(!s.equals(t.locale))throw new InvalidArgumentError("fromFormatParser called with a locale of "+s+", but the format parser was created for "+t.locale);const{result:o,zone:a,specificOffset:l,invalidReason:c}=t.explainFromTokens(e);return c?DateTime.invalid(c):parseDataToDateTime(o,a,n,"format "+t.format,e,l)}static get DATE_SHORT(){return DATE_SHORT}static get DATE_MED(){return DATE_MED}static get DATE_MED_WITH_WEEKDAY(){return DATE_MED_WITH_WEEKDAY}static get DATE_FULL(){return DATE_FULL}static get DATE_HUGE(){return DATE_HUGE}static get TIME_SIMPLE(){return TIME_SIMPLE}static get TIME_WITH_SECONDS(){return TIME_WITH_SECONDS}static get TIME_WITH_SHORT_OFFSET(){return TIME_WITH_SHORT_OFFSET}static get TIME_WITH_LONG_OFFSET(){return TIME_WITH_LONG_OFFSET}static get TIME_24_SIMPLE(){return TIME_24_SIMPLE}static get TIME_24_WITH_SECONDS(){return TIME_24_WITH_SECONDS}static get TIME_24_WITH_SHORT_OFFSET(){return TIME_24_WITH_SHORT_OFFSET}static get TIME_24_WITH_LONG_OFFSET(){return TIME_24_WITH_LONG_OFFSET}static get DATETIME_SHORT(){return DATETIME_SHORT}static get DATETIME_SHORT_WITH_SECONDS(){return DATETIME_SHORT_WITH_SECONDS}static get DATETIME_MED(){return DATETIME_MED}static get DATETIME_MED_WITH_SECONDS(){return DATETIME_MED_WITH_SECONDS}static get DATETIME_MED_WITH_WEEKDAY(){return DATETIME_MED_WITH_WEEKDAY}static get DATETIME_FULL(){return DATETIME_FULL}static get DATETIME_FULL_WITH_SECONDS(){return DATETIME_FULL_WITH_SECONDS}static get DATETIME_HUGE(){return DATETIME_HUGE}static get DATETIME_HUGE_WITH_SECONDS(){return DATETIME_HUGE_WITH_SECONDS}}function friendlyDateTime(e){if(DateTime.isDateTime(e))return e;if(e&&e.valueOf&&isNumber(e.valueOf()))return DateTime.fromJSDate(e);if(e&&"object"==typeof e)return DateTime.fromObject(e);throw new InvalidArgumentError("Unknown datetime argument: "+e+", of type "+typeof e)}function getDateTimeFormatter(e={}){if(void 0!==e.dateTimeFormat&&"function"!=typeof e.dateTimeFormat)throw new CKEditorError("invalid-date-time-format");return t=>{const n="string"==typeof t?DateTime.fromISO(t):DateTime.fromJSDate(t),i=DateTime.now(),r=Math.floor(i.diff(n,"days").days);return e.dateTimeFormat?e.dateTimeFormat(n.toJSDate()):0===r?n.toFormat("'Today' hh:mma"):1===r?n.toFormat("'Yesterday' hh:mma"):r<7?n.toFormat("'Last' EEEE hh:mma"):n.toFormat("LL-dd-yyyy hh:mma")}}function getMarkerDomElement(e,t){const n=e.mapper.markerNameToElements(t.name);if(!n)return null;const i=first(n.values());return e.view.domConverter.mapViewToDom(i)||null}function getAllMarkersDomElementsSorted(e,t){if(0===t.length)return null;const n=[],i=e.view.domConverter;for(const r of t){const t=e.mapper.markerNameToElements(r.name);if(!t)continue;const s=Array.from(t).map((e=>i.mapViewToDom(e))).filter((e=>!!e));n.push(...s)}if(0===n.length)return null;const r=[];for(const e of n){const t=e.getClientRects().item(0);t&&r.push({x:t.x,y:t.y,domElement:e})}return 0===r.length?null:(r.sort(((e,t)=>e.y-t.y||e.x-t.x)),r.map((e=>e.domElement)))}function trimHtml(e,{limit:t,suffix:n="..."}){const i=[];let r=0;const s=e.replace(/</g,"\n<").replace(/>/g,">\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n");for(let e=0;e<s.length;e++){let o=s[e];const a=splitCharactersToArray(o);if(o.startsWith("<")){if(r>=t){const t=o.match(/[a-zA-Z]+/);if(!t){s[e]="";continue}const n=t[0];o.startsWith("</")?(i.length&&(o=""),i.pop()):(i.push(n),o="")}}else if(r>=t)o="";else if(r+a.length>=t){let e=t-r;if(" "===a[e-1])e--;else{const t=a.slice(e).indexOf(" ");-1!==t?e+=t:e=o.length}o=a.slice(0,e).join("")+n,r=t}else r+=a.length;s[e]=o}return s.join("\n").replace(/\n/g,"")}function splitCharactersToArray(e){const t=[];for(let n=0;n<e.length;n++){const i=e.substring(n).match(/^&[a-z0-9#]+;/);if(i){const e=i[0];t.push(e),n+=e.length-1}else t.push(e[n])}return t}class ConfirmView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("message",getTranslation$i(e,"Are you sure?")),this.submitView=this._createButtonView(e,getTranslation$i(e,"Yes"),_0x42409c.check,"submit"),this.cancelView=this._createButtonView(e,getTranslation$i(e,"No"),_0x42409c.cancel,"cancel"),this.focusables=this.createCollection([this.submitView,this.cancelView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-thread__remove-confirm"],tabindex:-1,role:"alertdialog"},children:[{tag:"div",attributes:{class:"ck-thread__remove-confirm-inner",role:"presentation"},children:[{tag:"p",children:[{text:t.to("message")}]},{tag:"div",attributes:{class:"ck-thread__remove-confirm-actions"},children:[this.submitView,this.cancelView]}]}]})}render(){super.render(),this._setupKeyboardNavigation()}focus(){this.cancelView.element.focus({preventScroll:!0})}_createButtonView(e,t,n,i){const r=new ButtonView(e);return r.label=t,r.icon=n,r.extendTemplate({attributes:{class:"ck-thread__remove-confirm-"+i}}),r.on("execute",(()=>this.fire(i))),r}_setupKeyboardNavigation(){this.focusables.forEach((e=>{this.keystrokes.listenTo(e.element),this.focusTracker.add(e.element)})),this.keystrokes.set("esc",((e,t)=>{this.fire("cancel"),t()}))}}function ConfirmMixin(e){return class extends e{showConfirm(e,t){return this.confirmView=new ConfirmView(this.locale),this.confirmView.render(),this.confirmView.message=e,this.confirmView.once("cancel",(()=>{this._removeConfirm()})),this.confirmView.once("submit",(()=>{this._removeConfirm()})),t.appendChild(this.confirmView.element),this.registerChild(this.confirmView),this.confirmView.focus(),this.set("isConfirm",!0),new Promise((e=>this.confirmView.on("submit",e)))}cancelConfirm(){this.isConfirm&&this.confirmView.fire("cancel")}_removeConfirm(){this.element&&this.confirmView&&this.confirmView.element&&(this.element.focus(),this.confirmView.element.remove(),this.deregisterChild(this.confirmView),this.isConfirm=!1,this.fire("removeConfirm"),this.confirmView.destroy(),this.confirmView=void 0)}}}function hashObject(e){let t=0,n=0;for(const i of objectToNumberGenerator(e))t=(t<<5)-t+i,t|=0,[t,n]=[n,t];return toString$3(t)+toString$3(n)}function*toNumberGenerator(e){null==e||null==e?yield 314159265:0===e||!1===e?yield 0:1===e||1==e?yield 1:Array.isArray(e)?yield*arrayToNumberGenerator(e):"object"==typeof e?yield*objectToNumberGenerator(e):"string"==typeof e?yield*stringToNumberGenerator(e):"number"==typeof e&&(yield e)}function*objectToNumberGenerator(e){if(yield charCode("{"),e){const t=Object.keys(e).sort();for(const n of t){yield*stringToNumberGenerator(n),yield charCode(":");const t=e[n];yield*toNumberGenerator(t)}}yield charCode("}")}function*arrayToNumberGenerator(e){for(const t of e)yield*toNumberGenerator(t)}function*stringToNumberGenerator(e){yield charCode('"');for(const t of e)yield charCode(t);yield charCode('"')}function charCode(e){return e.charCodeAt(0)}function toString$3(e){return(e*=Math.sign(e)).toString(36)}const blackListedConfigOptions=["initialData","context","toolbar","rootsAttributes"],blackListedPlugins$2=["WebSocketGateway","RevisionTracker","Autosave","WordCount","DocumentOutline","WProofreader"];function skipRtcPlugins(e,t,n,i=[]){const r="string"==typeof e?n.get(e).constructor:e.prototype.constructor;if(t.has(r))return t.get(r);t.set(r,!0);const s=[...blackListedPlugins$2,...i].map((e=>{if(n.has(e))return n.get(e).constructor})).filter((e=>e));if(r&&s.includes(r))return t.set(r,!1),!1;if(!r.requires)return t.set(r,!0),!0;const o=r.requires.every((e=>skipRtcPlugins(e,t,n,i)));return t.set(r,o),o}function sanitizeEditorConfig(e,t){const n={};for(const t of e.config.names())blackListedConfigOptions.includes(t)||(n[t]=e.config.get(t));const i=n.plugins||[],r=e.constructor.builtinPlugins||[],s=i.length?i:r,o=n.extraPlugins||[];delete n.extraPlugins;const a=n.removePlugins||[];delete n.removePlugins;const l=e._context.config.get("plugins")||[],c=s.concat(o).concat(l).map((e=>"string"==typeof e?r.find((t=>t.pluginName==e)):e)).filter((e=>!a.includes(e)&&!a.includes(e.pluginName))),d=Array.from(new Set(c)),u=new Map;return n.plugins=d.filter((n=>skipRtcPlugins(n,u,e.plugins,t))),n}function surroundingMarkersDetector(e,t){const n=[];e.document.selection.on("change:range",(()=>{const i=getSurroundingMarkers(e,e.document.selection.focus),r=[],s=[],o=[];for(const e of n)i.includes(e)||r.push(e);for(const e of i)n.includes(e)||s.push(e),o.push(e);(r.length||s.length)&&t({left:r,entered:s}),n.length=0,n.push(...o)}))}function getSurroundingMarkers(e,t){const n=[];for(const i of e.markers){const e=i.getRange();(e.containsPosition(t)||e.start.isEqual(t)||e.end.isEqual(t))&&n.push(i)}return n}const FOCUS_ANNOTATION_KEYSTROKE="Ctrl+Shift+E";function setupThreadKeyboardNavigation(e,t){const n=e.element;e.keystrokes.listenTo(n);for(const n of t)addViewToFocusCyclerNavigation(e,n);t.on("change",((t,n)=>{for(const t of n.removed)removeViewFromFocusCyclerNavigation(e,t);for(const t of Array.from(n.added).reverse())addViewToFocusCyclerNavigation(e,t)})),e.keystrokes.set("enter",((t,i)=>{n===t.target&&(e.focusCycler.focusFirst(),i())}),{filter:e=>e.target===n}),e.keystrokes.set("esc",((t,i)=>{n!==t.target?e.focus():e.fire("escape"),i()})),e.keystrokes.set("arrowdown",((t,i)=>{n===t.target&&(e.fire("arrowdown"),i())})),e.keystrokes.set("arrowup",((t,i)=>{n===t.target&&(e.fire("arrowup"),i())}))}function addViewToFocusCyclerNavigation(e,t){t.isRendered&&(e.focusTracker.add(t.element),e.keystrokes.listenTo(t.element),isViewWithFocusCycler(t)&&areFocusCyclerActionsCompatible(e.focusCycler,t.focusCycler)&&e.focusCycler.chain(t.focusCycler))}function removeViewFromFocusCyclerNavigation(e,t){e.focusTracker.remove(t.element),e.keystrokes.stopListening(t.element),isViewWithFocusCycler(t)&&e.focusCycler.unchain(t.focusCycler)}function areFocusCyclerActionsCompatible(e,t){const n=e.actions,i=t.actions;for(const e of Object.keys(n))if(e in i&&n[e]!==i[e])return!1;return!0}var paintRoller='<svg viewBox="0 0 20 20" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3Z"/><path d="M16 3.25a1.5 1.5 0 0 1 1.5 1.5v1.7a2.25 2.25 0 0 1-1.932 2.226l-4.424.632a.75.75 0 0 0-.644.743V11a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-5a1 1 0 0 1 1-1v-.95a2.25 2.25 0 0 1 1.932-2.226l4.424-.632A.75.75 0 0 0 16 6.449V3.25Z"/></svg>\n',robotPencil='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.61 2.66a1.406 1.406 0 1 0-1.407 0v.891H3.28a2.11 2.11 0 0 0-2.11 2.11v10.312a2.11 2.11 0 0 0 2.11 2.109h5.684l-.054-1.157.18-.25H3.28a.703.703 0 0 1-.703-.702V5.66c0-.389.315-.704.703-.704h11.25c.388 0 .703.315.703.704v2.484l.358-.497a2.492 2.492 0 0 1 1.048-.84V5.66a2.11 2.11 0 0 0-2.11-2.11H9.61v-.89Z"/><path d="M5.625 10.817c.518 0 .937-.63.937-1.407 0-.776-.42-1.406-.937-1.406-.518 0-.938.63-.938 1.406 0 .777.42 1.407.938 1.407Z"/><path d="M13.125 9.41c0 .777-.42 1.407-.938 1.407s-.937-.63-.937-1.407c0-.776.42-1.406.937-1.406.518 0 .938.63.938 1.406Z"/><path d="M.937 8.004A.937.937 0 0 0 0 8.942v1.875c0 .517.42.937.937.937v-3.75Z"/><path d="M6.128 12.51a.782.782 0 0 1 1.085.216c.272.408.907.707 1.693.707s1.421-.3 1.693-.707a.782.782 0 0 1 1.302.868c-.666 1-1.906 1.403-2.995 1.403-1.089 0-2.329-.404-2.995-1.403a.782.782 0 0 1 .217-1.085Z"/><path d="m16.987 8.91-.622.864 2.879 2.074.622-.864a.71.71 0 0 0-.161-.99l-1.728-1.245a.71.71 0 0 0-.99.161Z"/><path d="M11.635 19.951a.355.355 0 0 1-.449-.31l-.214-2.38 4.978-6.911 2.88 2.074-4.978 6.91-2.217.617Z"/></svg>',tableOfContents='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 19a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8.022a6.47 6.47 0 0 0-1.5-.709V2a.5.5 0 0 0-.5-.5H3a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h6.313c.173.534.412 1.037.709 1.5H3Z"/><path d="M9.174 14a6.489 6.489 0 0 0-.155 1H6v-1h3.174Z"/><path d="M10.022 12c-.202.316-.378.65-.524 1H4v-1h6.022Z"/><path d="M12.034 10c-.448.283-.86.62-1.224 1H6v-1h6.034Z"/><path d="M12 4v1H4V4h8Z"/><path d="M14 7V6H6v1h8Z"/><path d="M15 9V8H7v1h8Z"/><path clip-rule="evenodd" d="M20 15.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM15.5 13a.5.5 0 0 0-.5.5V15h-1.5a.5.5 0 0 0 0 1H15v1.5a.5.5 0 0 0 1 0V16h1.5a.5.5 0 0 0 0-1H16v-1.5a.5.5 0 0 0-.5-.5Z"/></svg>\n',template='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8 0H3a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM2.5 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V2Z"/><path clip-rule="evenodd" d="M13 0h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-5Z"/><path clip-rule="evenodd" d="M13 10h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5Z"/></svg>',caseChange='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.789 3 0 17h1.664l1.664-4.027h6.797l.227.548c.046-.172.112-.352.209-.545.217-.436.556-.609.898-.798L7.664 3H5.79Zm.938 1.758 2.777 6.715H3.949l2.778-6.715Z"/><path d="M15.956 7.5c-1.584-.02-3.226.824-3.843 2.882l1.495.106c.904-2.082 4.594-2.13 4.375.534-3.245 1.024-4.838.117-6.082 2.62-.208.418-.17 1.57.54 2.397.71.826 2.014 1.149 3.409.85 1.395-.299 2.24-1.386 2.24-1.386L18.205 17h1.493l-.059-1.72-.056-5.274C19.51 8.612 17.75 7.524 15.956 7.5Zm2.027 4.696s.641 2.453-1.528 3.27c-3.376 1.269-4.188-2.141-1.775-2.638 1.704-.352 1.873-.25 3.303-.632Z"/></svg>';const icons={paintRoller:paintRoller,robotPencil:robotPencil,tableOfContents:tableOfContents,template:template,caseChange:caseChange},UNGROUPED_COMMANDS_GROUP_ID="_ungrouppedCommands";function normalizeCommandsConfig(e,t){const n=(0,t.t)("Other");return e.length?"groupId"in e[0]?e:[{groupId:UNGROUPED_COMMANDS_GROUP_ID,groupLabel:n,order:1/0,commands:e}]:[{groupId:UNGROUPED_COMMANDS_GROUP_ID,groupLabel:n,order:1/0,commands:[]}]}const DomDataTransfer$1=globalThis.DataTransfer,VISUAL_SELECTION_MARKER_NAME="ai-ui";class AIAssistantEditing extends Plugin{static get pluginName(){return"AIAssistantEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this,t=["ck-fake-ai-selection"];e.config.get("ai.useTheme")&&t.push("ck-ai-assistant-ui_theme"),e.conversion.for("editingDowncast").markerToHighlight({model:VISUAL_SELECTION_MARKER_NAME,view:{classes:t,priority:12}}),e.conversion.for("editingDowncast").markerToElement({model:VISUAL_SELECTION_MARKER_NAME,view:(e,{writer:t})=>{if(!e.markerRange.isCollapsed)return null;const n=t.createUIElement("span");return t.addClass(["ck-fake-ai-selection","ck-fake-ai-selection_collapsed"],n),n}})}afterInit(){checkLicense$f(this)}showFakeVisualSelection(){const e=this.editor.model;e.change((t=>{const n=e.document.selection.getRanges();let i=0;for(const r of n){const n=VISUAL_SELECTION_MARKER_NAME+":"+i;if(e.markers.has(n))t.updateMarker(n,{range:r});else if(r.start.isAtEnd){const i=r.start.getLastMatchingPosition((({item:t})=>!e.schema.isContent(t)),{boundaries:r});t.addMarker(n,{usingOperation:!1,affectsData:!1,range:t.createRange(i,r.end)})}else t.addMarker(n,{usingOperation:!1,affectsData:!1,range:r});i++}}))}hideFakeVisualSelection(){const e=this.editor.model,t=Array.from(this.editor.model.markers.getMarkersGroup(VISUAL_SELECTION_MARKER_NAME));t.length&&e.change((e=>{t.forEach((t=>{e.removeMarker(t)}))}))}insertContent(e,t){const n=this._getAISelection(),i=t||n.getFirstRange();this.editor.model.canEditAt(i)&&this.editor.model.change((r=>{this.hideFakeVisualSelection(),t||this._resetContentOfSelectedTableCells(r,n),this._pasteHTMLUsingClipboard({insertAt:i,writer:r,html:e})}))}insertContentBelow(e){const{model:t}=this.editor,n=this._getAISelection();t.change((()=>{const t=this._prepareTableInsertBelowPosition(e,n)||this._getDefaultInsertBelowPosition(n);this.insertContent(e,t)}))}_getAISelection(){const e=this.editor.model,t=Array.from(e.markers.getMarkersGroup(VISUAL_SELECTION_MARKER_NAME)).map((e=>e.getRange()));return e.createSelection(t)}_pasteHTMLUsingClipboard({writer:e,html:t,insertAt:n}){const{view:i}=this.editor.editing,r=this.editor.plugins.get(ClipboardPipeline),s=new DomDataTransfer$1;s.setData("text/html",t);const o=new ClipboardEvent("paste",{clipboardData:s}),a=new DomEventData(i,o,{dataTransfer:new DataTransfer$1(s)});e.setSelection(n);const l=(t,n)=>{n.resultRange&&e.setSelection(n.resultRange)};r.once("contentInsertion",l,{priority:"lowest"}),i.document.fire("paste",a),r.off("contentInsertion",l)}_getDefaultInsertBelowPosition(e){const{model:t}=this.editor,n=Array.from(e.getSelectedBlocks());return n.length?t.createPositionAfter(n.pop()):e.getLastPosition()}_prepareTableInsertBelowPosition(e,t){const{model:n,plugins:i}=this.editor;if(i.has("TableUtils")){const r=i.get("TableUtils").getSelectedTableCells(t);if(r.length){const t=this._getTableRowCountFromContent(e),i=this._createEmptyTableRows(r,t);return n.createPositionAt(i,0)}}return null}_getTableRowCountFromContent(e){const t=this.editor.plugins.get("TableUtils"),n=this.editor.data.parse(e),i=Array.from(n.getChildren()).filter((e=>e.is("element","table")));let r=0;return i.forEach((e=>{r+=t.getRows(e)})),r}_createEmptyTableRows(e,t){const n=this.editor.plugins.get("TableUtils"),i=n.getRowIndexes(e),r=n.getColumnIndexes(e),s=i.last+1,o=r.first,a=e[0].findAncestor("table");for(let e=0;e<t;e++)n.insertRows(a,{at:s});return a.getChild(s).getChild(o)}_resetContentOfSelectedTableCells(e,t){const{plugins:n}=this.editor,{model:i}=e;n.has("TableUtils")&&n.get("TableUtils").getSelectedTableCells(t).length&&i.deleteContent(t)}}async function checkLicense$f(e){const t=g([109,76,87,75,55,68,102,54,56,65,100,97,99,104,114,52,84,50,90,71,108,77,85,117,78,82,49,89,83,106,119,79,116,81,113,51,70,53,107,112,111,115,88,80,121,103,86,110,67,57,73,118,74,101,69,105,72,48,66,120,122,98]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([109]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([97,105,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([65,73])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class AIAdapter extends Plugin{static get pluginName(){return"AIAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){if(!this.textAdapter)throw new CKEditorError("aiadapter-text-adapter-not-set",null)}}class AIRequestError extends Error{constructor(e){super(e),this.name="AIRequestError"}}function getTranslation$h(e,t,n){const i=e.t;switch(t){case"Edit or review":return i("Edit or review");case"Improve writing":return i("Improve writing");case"Make shorter":return i("Make shorter");case"Make longer":return i("Make longer");case"Simplify language":return i("Simplify language");case"Generate from selection":return i("Generate from selection");case"Summarize":return i("Summarize");case"Continue":return i("Continue");case"Change tone":return i("Change tone");case"Professional":return i("Professional");case"Casual":return i("Casual");case"Direct":return i("Direct");case"Confident":return i("Confident");case"Friendly":return i("Friendly");case"Change style":return i("Change style");case"Business":return i("Business");case"Legal":return i("Legal");case"Journalism":return i("Journalism");case"Poetic":return i("Poetic");case"Translate":return i("Translate");case"English":return i("English");case"Spanish":return i("Spanish");case"German":return i("German");case"Portuguese":return i("Portuguese");case"French":return i("French");case"Simplified Chinese":return i("Simplified Chinese");case"Hindi":return i("Hindi");case"Arabic":return i("Arabic");case"Indonesian":return i("Indonesian");case"AI Assistant":return i("AI Assistant");case"AI Commands":return i("AI Commands");case"Ask AI to edit or generate":return i("Ask AI to edit or generate");case"Ask AI to improve generated text":return i("Ask AI to improve generated text");case"Copy":return i("Copy");case"Submit":return i("Submit");case"Insert below":return i("Insert below");case"Try again":return i("Try again");case"Stop":return i("Stop");case"AI is writing...":return i("AI is writing...");case"AI is writing":return i("AI is writing");case"Generated content: %0":return i("Generated content: %0",n);case"Error during AI content generation: %0":return i("Error during AI content generation: %0",n);case"History":return i("History");case"Empty history":return i("Empty history");case"Ask AI and your prompts will be listed here for you to use later.":return i("Ask AI and your prompts will be listed here for you to use later.");case"Prompt history":return i("Prompt history");case"Clear":return i("Clear");case"AI_REPLACE_CONTENT":return i({id:"AI_REPLACE_CONTENT",string:"Replace"});case"AI_INSERT_CONTENT":return i({id:"AI_INSERT_CONTENT",string:"Insert"});case"AI_ERROR_GET_HEADERS":return i({id:"AI_ERROR_GET_HEADERS",string:"Preparing request headers failed"});case"AI_ERROR_GET_PARAMETERS":return i({id:"AI_ERROR_GET_PARAMETERS",string:"Preparing request parameters failed"});case"AI_ERROR_UNSUPPORTED_MODEL":return i({id:"AI_ERROR_UNSUPPORTED_MODEL",string:'The requested AI model ("%0") is not supported'},n);case"AI_ERROR_CONTEXT_LENGTH":return i({id:"AI_ERROR_CONTEXT_LENGTH",string:"Selected content is too long"});case"AI_ERROR_MODERATION":return i({id:"AI_ERROR_MODERATION",string:"Requested query does not pass moderation rules"});case"AI_ERROR_FAILED":return i({id:"AI_ERROR_FAILED",string:"Failed to communicate with the AI service"});default:return t}}class ShowAIAssistantCommand extends _0x338ed0{constructor(e,t){super(e),this._commandDefinitions=t,this.set("enabledCommandsIds",[]),this.on("change:_hasContext",((e,t,n)=>{this.isEnabled&&(this.enabledCommandsIds=_getEnabledCommands(this._commandDefinitions,n))})),this.set("_hasContext",!1),this.on("change:isEnabled",((e,t,n)=>{this.enabledCommandsIds=n?_getEnabledCommands(this._commandDefinitions,this._hasContext):[]}))}refresh(){const e=this.editor.model;this._hasContext=_isContextAvailable(e);const t=e.document.selection,n=this.editor.config.get("ai.aiAssistant.disabledElements");for(const e of t.getRanges())for(const t of e.getItems())if(t.is("element")&&n.includes(t.name))return void(this.isEnabled=!1);this.isEnabled=!0}execute(e="",t="",n="custom"){this.editor.plugins.get(AIAssistantUI).showUI(e,t,n)}}function _isContextAvailable(e){const t=e.document.selection;return t.isCollapsed?0!==[...t.getSelectedBlocks()].length&&![...t.getSelectedBlocks()][0].isEmpty:!!e.hasContent(t.getFirstRange())}function _getEnabledCommands(e,t){const n=new Set;for(const i of e.values())(t||!1===i.requiresContent)&&n.add(i.id);return Array.from(n)}const MIN_RESPONSE_LENGTH_TO_FIRST_HTML=100,ALL_UNTIL_FIRST_HTML_REGEX=new RegExp(/^(.*?)<[a-zA-Z][a-zA-Z0-9_\-.]*[ >]/,"is");class AIAssistantController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n){super(),this.editor=e,this.textAdapter=t,this._sanitizationContainer=document.createElement("div"),this._domParser=new DOMParser,this._xmlSerializer=new XMLSerializer,this.view=n,this.set({initialContext:"",currentContext:"",currentResponse:"",previousContext:void 0,previousQuery:void 0,previousLabel:void 0,isProcessing:!1}),this.on("set:currentContext",((e,t,n)=>{this.view.value=this._sanitizeHTML(n)})),this.listenTo(this.view,"submitPrompt",((e,t)=>{const n=this.currentContext||this.initialContext;this._handleQuery(t,n,"custom")})),this.listenTo(this.view,"tryAgainEvent",(()=>{this.view.prompt=this.previousLabel,this._handleQuery(this.previousQuery,this.previousContext,this.previousActionId,this.previousLabel)})),this.listenTo(this.view,"stopProcessing",(()=>{this.stopProcessing()}))}destroy(){this.stopListening()}async updateView({actionId:e,query:t,htmlContent:n,label:i,mainActionLabel:r}){this.view.prompt=i,this.view.mainAction=r,this.initialContext=n,t&&(this.view.isRendered?this._handleQuery(t,n,e,i):this.view.once("render",(()=>{this._handleQuery(t,n,e,i)})))}stopProcessing(){this.isProcessing&&(this.isProcessing=!1,this.view.finishProcessing(),this.textAdapter.abort())}reset(){this.initialContext="",this.currentContext="",this.currentResponse="",this.previousContext="",this.previousQuery="",this.previousLabel="",this.previousActionId=void 0,this.view.reset(),this.stopProcessing()}async _handleQuery(e,t,n,i){return this.isProcessing=!0,this.view.startProcessing(),this.previousContext=t,this.previousQuery=e,this.previousLabel=i||e,this.previousActionId=n,new Promise((i=>{this.textAdapter.makeRequest({query:e,context:t,onData:e=>{this.currentResponse=e,this.currentContext=this._parseAndNormalizeContent(this.currentResponse)},actionId:n}).then((()=>{!this.currentContext&&this.currentResponse&&(this.currentContext=this._parseAndNormalizeContent(this.currentResponse,!0))})).catch((e=>{e instanceof AIRequestError?this.view.handleError(e.message):this.view.handleError(),i()})).finally((()=>{this.stopProcessing(),i()}))}))}_parseAndNormalizeContent(e,t=!1){const n=ALL_UNTIL_FIRST_HTML_REGEX.exec(e);e=n?e.substring(n[1].length):e.length<MIN_RESPONSE_LENGTH_TO_FIRST_HTML&&!t?"":this._stripMarkdownSyntax(e);const i=this._domParser.parseFromString(e,"text/html");if(n){const e=Array.from(i.body.childNodes);e.reverse();for(const t of e){if(t.nodeType==Node.ELEMENT_NODE)break;t.remove()}}const r=this.editor.data.processor.toView(this._xmlSerializer.serializeToString(i.body));this._isH1TagSupportEnabled()||this._normalizeResponseHeadings(r);const s=this.editor.config.get("ai.aiAssistant.preserveComments"),o=this.editor.data.toModel(r);return s||o.markers.clear(),this.editor.data.stringify(o)}_normalizeResponseHeadings(e){const t=new UpcastWriter(this.editor.editing.view.document),n=new Matcher({name:/^h[1-5]$/}),i=[];let r=!1;for(const t of e)t.is("element")&&n.match(t)&&(i.push(t),"h1"==t.name&&(r=!0));if(r)for(const e of i)t.rename("h"+(parseInt(e.name[1])+1),e)}_isH1TagSupportEnabled(){const{data:e,editing:t}=this.editor,n=e.htmlProcessor.toView("<h1></h1>"),i=e.toView(e.toModel(n));return!!t.view.domConverter.viewToDom(i).querySelector("h1")}_sanitizeHTML(e){return this.editor.editing.view.domConverter.setContentOf(this._sanitizationContainer,e),this._sanitizationContainer.innerHTML}_stripMarkdownSyntax(e){const t=e.trim();return t.startsWith("```html")?t.endsWith("```")?t.substring(7,t.length-3):t.substring(7):e}}const AIFormToolbarViewMainActionLabel={REPLACE:"replace",INSERT:"insert"};class AIFormToolbarView extends ToolbarView{constructor(e){super(e),this.set("isVisible",!1),this.set("mainAction",AIFormToolbarViewMainActionLabel.REPLACE),this.replaceButton=this._createButton("","ck-button-action"),this.replaceButton.bind("label").to(this,"mainAction",(t=>getTranslation$h(e,"AI_"+t.toUpperCase()+"_CONTENT"))),this.insertButton=this._createButton(getTranslation$h(e,"Insert below")),this.tryAgainButton=this._createButton(getTranslation$h(e,"Try again")),this.stopButton=this._createButton(getTranslation$h(e,"Stop"));const t=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-ai-form__toolbar",t.if("isVisible","ck-hidden",(e=>!e))]}}),this.items.addMany([this.replaceButton,this.insertButton,this.tryAgainButton,this.stopButton])}_createButton(e,t){const n=new ButtonView(this.locale);return n.set({label:e,class:t||"",isVisible:!0,withText:!0}),n}}var copyIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 2.801a.7.7 0 0 0-.7.7v11.5a.8.8 0 0 1-1.6 0v-11.5a2.3 2.3 0 0 1 2.3-2.3h6.5a.8.8 0 0 1 0 1.6H5Zm.7 3.7a2.3 2.3 0 0 1 2.3-2.3h7a2.3 2.3 0 0 1 2.3 2.3v10a2.3 2.3 0 0 1-2.3 2.3H8a2.3 2.3 0 0 1-2.3-2.3v-10Zm2.3-.7a.7.7 0 0 0-.7.7v10a.7.7 0 0 0 .7.7h7a.7.7 0 0 0 .7-.7v-10a.7.7 0 0 0-.7-.7H8Z"/></svg>';class AIFormContentArea extends View{constructor(e,t=""){super(e),this.set({value:null,isVisible:!1,isProcessing:!1});const n=this.bindTemplate;this.contentFieldView=new ContentFieldView(e,t),this.copyButtonView=this._createCopyButton(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__content-area-wrapper",n.if("isVisible","ck-hidden",(e=>!e))],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form__content-area",n.if("isProcessing","ck-ai-form__content-area--processing")]},children:[this.contentFieldView,{tag:"div",attributes:{class:["ck","ck-ai-form__copy-button-wrapper"]},children:[this.copyButtonView]}]}]})}render(){super.render(),this.value&&this.contentFieldView.setContent(this.value);let e=!1;this.on("change:value",((t,n,i)=>{const r=!this.contentFieldView.element.querySelector(".ck-ai-form__loader");this.contentFieldView.setContent(i),this.isProcessing&&r&&!e&&this.element.scrollTo({top:this.element.scrollHeight,behavior:"smooth"})})),this.on("change:isProcessing",((t,n,i)=>{e=!1,i?(this.value=null,this.contentFieldView.appendLoader()):this.value||this.contentFieldView.setContent("")})),this.listenTo(this.element,"wheel",(()=>{e=!0})),this.listenTo(this.element,"mousedown",(()=>{e=!0}))}focus(){this.element.focus()}_createCopyButton(){const e=this.locale,t=new ButtonView(this.locale),n="ck-ai-form__copy-button";return t.set({label:getTranslation$h(e,"Copy"),icon:copyIcon,class:n,tooltip:!0}),t.bind("isVisible").to(this,"value",(e=>!!e)),t.bind("isEnabled").to(this,"isProcessing",(e=>!e)),t.on("execute",(()=>{this._copyHTMLToClipboard(this.contentFieldView.element),t.icon=_0x42409c.check,t.class=n+" ck-ai-form__copy-button--copied",this.focus(),setTimeout((()=>{t.icon=copyIcon,t.class=n}),1e3)})),t}_copyHTMLToClipboard(e){const{window:t,document:n}=_0x49a38d;if(t.ClipboardItem){const{Blob:n,ClipboardItem:i}=t,r=[new i({"text/html":new n([e.innerHTML],{type:"text/html"}),"text/plain":new n([e.textContent||""],{type:"text/plain"})})];navigator.clipboard.write(r)}else{const i=n.createElement("div");i.style.position="absolute",i.style.left="-9999px",i.innerHTML="<span>[</span>"+e.innerHTML+"<span>]</span>",n.body.appendChild(i);const r=n.createRange();r.setStartAfter(i.firstElementChild),r.setEndBefore(i.lastElementChild);const s=t.getSelection();s.removeAllRanges(),s.addRange(r),n.execCommand("copy"),i.remove()}}}class ContentFieldView extends View{constructor(e,t=""){super(e),this.loaderView=this._createLoader(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-content",t,"ck-reset_all-excluded","ck-ai-form__content-field"]}})}setContent(e){this.element.innerHTML=e}appendLoader(){this.element.appendChild(this.loaderView.element)}_createLoader(){const e=new View,t=this.locale,n=new SpinnerView;return n.isVisible=!0,e.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__loader"]},children:[n,{text:getTranslation$h(t,"AI is writing...")}]}),e.render(),e}}var errorIcon$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9.9 4.385a1.2 1.2 0 0 0-.44.44h.002l-5.284 9.15a1.2 1.2 0 0 0 1.04 1.8h10.564a1.2 1.2 0 0 0 1.04-1.8l-5.282-9.15a1.2 1.2 0 0 0-1.64-.44Zm.05 8.363a.301.301 0 0 1 .115-.023h.9a.301.301 0 0 1 .3.3v.9a.3.3 0 0 1-.3.3h-.9a.3.3 0 0 1-.3-.3v-.9a.3.3 0 0 1 .185-.277Zm-.185-4.723a.3.3 0 0 1 .3-.3h.9a.3.3 0 0 1 .3.3v3.4a.3.3 0 0 1-.3.3h-.9a.301.301 0 0 1-.3-.3v-3.4Z"/></svg>\n';class AIFormErrorView extends View{constructor(e,t=""){super(e);const n=new IconView,i=this.bindTemplate;this.set("text",t),n.content=errorIcon$1,this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__error"]},children:[n,{text:i.to("text")}]})}}var submitIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.875 4.419a.75.75 0 0 0-1.5 0v7.25H6.818l2.33-1.955a.75.75 0 0 0-.963-1.15l-3.792 3.182a.75.75 0 0 0-.17.945c.046.11.118.208.21.284l3.788 3.18a.75.75 0 1 0 .965-1.149l-2.19-1.837h7.629c.69 0 1.25-.56 1.25-1.25v-7.5Z"/></svg>';class AIFormPromptView extends AutocompleteView{constructor(e,t){super(e,t),this.queryView.fieldView.minRows=1,this.queryView.fieldView.maxRows=3,this.submitButtonView=this._createSubmitButton(),this.showHistoryButtonView=this._createShowHistoryButton(),this.focusableChildren.add(this.showHistoryButtonView,1),this.focusableChildren.add(this.submitButtonView)}render(){super.render(),this.queryView.fieldWrapperChildren.add(this.showHistoryButtonView),this.children.add(this.submitButtonView),this.keystrokes.set("enter",((e,t)=>{e.target==this.queryView.fieldView.element&&(this.submit(),t())}))}_createSubmitButton(){const e=new ButtonView(this.locale),t=this.locale;return e.set({icon:submitIcon,label:getTranslation$h(t,"Submit"),isVisible:!0,tooltip:!0,class:"ck-ai-form__submit"}),e.on("execute",(()=>{this.submit()})),e.bind("isEnabled").to(this.queryView.fieldView,"isEmpty",this,"isEnabled",((e,t)=>!e&&t)),e}_createShowHistoryButton(){const e=new ButtonView(this.locale),t=this.resultsView,n=this.locale;e.set({label:getTranslation$h(n,"History"),withText:!1,icon:_0x42409c.history,tooltip:!0,tooltipPosition:"sw",class:"ck-ai-form__toggle-history"}),e.bind("isOn").to(t,"isVisible"),e.bind("isEnabled").to(this,"isEnabled"),e.on("execute",(()=>{t.isVisible=!t.isVisible,t.isVisible?this.filteredView.focus():this.focus()}));const i=()=>{_0x49a38d.window.requestAnimationFrame((()=>{if(isVisible(this.element)){const t=new Rect(this.queryView.fieldView.element),i=t.width,r="rtl"===n.uiLanguageDirection?"left":"right";t.excludeScrollbarsAndBorders(),e.element.style[r]=i-t.width+1+"px"}}))};return this.queryView.fieldView.on("update",i),this.on("render",i),e}submit(){const e=this.queryView.fieldView.element.value;this.fire("submit",e)}focus(e){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}}class AIHistoryListView extends ListView{constructor(e){super(e),this.clearHistoryButton=this._createClearHistoryButton(),this.historyGroupView=new ListItemGroupView,this.historyGroupView.children.add(this.clearHistoryButton,1),this.historyGroupView.label=getTranslation$h(e,"Prompt history"),this.historyGroupView.items.delegate("execute").to(this),this.items.add(this.historyGroupView)}filter(){let e=0;for(const t of this.items)e+=t.items.length;return{resultsCount:e,totalItemsCount:e}}_createClearHistoryButton(){const e=this.locale,t=new ButtonView(this.locale);return t.set({label:"("+getTranslation$h(e,"Clear")+")",withText:!0}),t.on("execute",(()=>this.fire("clearHistory"))),t}}var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$f=Object.prototype,hasOwnProperty$c=objectProto$f.hasOwnProperty,nativeObjectToString$1=objectProto$f.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty$c.call(e,symToStringTag$1),n=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var i=!0}catch(e){}var r=nativeObjectToString$1.call(e);return i&&(t?e[symToStringTag$1]=n:delete e[symToStringTag$1]),r}var objectProto$e=Object.prototype,nativeObjectToString=objectProto$e.toString;function objectToString(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var symbolTag$3="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag$3}function arrayMap(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}var isArray=Array.isArray,symbolProto$2=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}var reWhitespace=/\s/;function trimmedEndIndex(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var reTrimStart=/^\s+/;function baseTrim(e){return e?e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,""):e}function isObject$3(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject$3(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$3(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=baseTrim(e);var n=reIsBinary.test(e);return n||reIsOctal.test(e)?freeParseInt(e.slice(2),n?2:8):reIsBadHex.test(e)?NAN:+e}function identity$2(e){return e}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject$3(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root.ct,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource(e){if(null!=e){try{return funcToString$2.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$d=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$b=objectProto$d.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$b).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$3(e)||isMasked(e))&&(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var n=getValue(e,t);return baseIsNative(n)?n:void 0}var WeakMap$1=getNative(root,"WeakMap"),objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$3(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function apply(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function copyArray(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,n=0;return function(){var i=nativeNow(),r=HOT_SPAN-(i-n);if(n=i,r>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant(e){return function(){return e}}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),baseSetToString=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$2,setToString=shortOut(baseSetToString);function arrayEach(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var n=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==n||"symbol"!=n&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,n){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$c=Object.prototype,hasOwnProperty$a=objectProto$c.hasOwnProperty;function assignValue(e,t,n){var i=e[t];hasOwnProperty$a.call(e,t)&&eq(i,n)&&(void 0!==n||t in e)||baseAssignValue(e,t,n)}function copyObject(e,t,n,i){var r=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],l=void 0;void 0===l&&(l=e[a]),r?baseAssignValue(n,a,l):assignValue(n,a,l)}return n}var nativeMax$1=Math.max;function overRest(e,t,n){return t=nativeMax$1(void 0===t?e.length-1:t,0),function(){for(var i=arguments,r=-1,s=nativeMax$1(i.length-t,0),o=Array(s);++r<s;)o[r]=i[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=i[r];return a[t]=n(o),apply(e,this,a)}}var MAX_SAFE_INTEGER=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var objectProto$b=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$b)}function baseTimes(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}var argsTag$3="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$3}var objectProto$a=Object.prototype,hasOwnProperty$9=objectProto$a.hasOwnProperty,propertyIsEnumerable$1=objectProto$a.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$9.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")};function stubFalse(){return!1}var freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$3=moduleExports$2?root.Buffer:void 0,nativeIsBuffer=Buffer$3?Buffer$3.isBuffer:void 0,isBuffer$2=nativeIsBuffer||stubFalse,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$4]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$3]=typedArrayTags[weakMapTag$2]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{return freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$9=Object.prototype,hasOwnProperty$8=objectProto$9.hasOwnProperty;function arrayLikeKeys(e,t){var n=isArray(e),i=!n&&isArguments(e),r=!n&&!i&&isBuffer$2(e),s=!n&&!i&&!r&&isTypedArray(e),o=n||i||r||s,a=o?baseTimes(e.length,String):[],l=a.length;for(var c in e)!t&&!hasOwnProperty$8.call(e,c)||o&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||isIndex(c,l))||a.push(c);return a}function overArg(e,t){return function(n){return e(t(n))}}var nativeKeys=overArg(Object.keys,Object),objectProto$8=Object.prototype,hasOwnProperty$7=objectProto$8.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var n in Object(e))hasOwnProperty$7.call(e,n)&&"constructor"!=n&&t.push(n);return t}function keys$1(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function nativeKeysIn(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function baseKeysIn(e){if(!isObject$3(e))return nativeKeysIn(e);var t=isPrototype(e),n=[];for(var i in e)("constructor"!=i||!t&&hasOwnProperty$6.call(e,i))&&n.push(i);return n}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!isSymbol(e))||reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var n=t[e];return n===HASH_UNDEFINED$2?void 0:n}return hasOwnProperty$5.call(t,e)?t[e]:void 0}var objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$4.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0||(n==t.length-1?t.pop():splice.call(t,n,1),--this.size,0))}function listCacheGet(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var n=this.__data__,i=assocIndexOf(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}function ListCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var n=e.__data__;return isKeyable(t)?n["string"==typeof t?"string":"hash"]:n.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var n=getMapData(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}function MapCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize$3(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$2);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=e.apply(this,i);return n.cache=s.set(r,o)||s,o};return n.cache=new(memoize$3.Cache||MapCache),n}memoize$3.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize$3(e,(function(e){return n.size===MAX_MEMOIZE_SIZE&&n.clear(),e})),n=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,n,i,r){t.push(i?r.replace(reEscapeChar,"$1"):n||e)})),t}));function toString$2(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray(e)?e:isKey(e,t)?[e]:stringToPath(toString$2(e))}function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function baseGet(e,t){for(var n=0,i=(t=castPath(t,e)).length;null!=e&&n<i;)e=e[toKey(t[n++])];return n&&n==i?e:void 0}function arrayPush(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,n,i,r){var s=-1,o=e.length;for(n||(n=isFlattenable),r||(r=[]);++s<o;){var a=e[s];n(a)?arrayPush(r,a):r[r.length]=a}return r}function flatten$1(e){return null!=e&&e.length?baseFlatten(e):[]}function flatRest(e){return setToString(overRest(e,void 0,flatten$1),e+"")}var getPrototype=overArg(Object.getPrototypeOf,Object),objectTag$3="[object Object]",funcProto=Function.prototype,objectProto$4=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$3=objectProto$4.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=objectTag$3)return!1;var t=getPrototype(e);if(null===t)return!0;var n=hasOwnProperty$3.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&funcToString.call(n)==objectCtorString}function baseSlice(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(r);++i<r;)s[i]=e[i+t];return s}function basePropertyOf(e){return function(t){return null==e?void 0:e[t]}}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var n=this.__data__;if(n instanceof ListCache){var i=n.__data__;if(!Map$1||i.length<LARGE_ARRAY_SIZE-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new MapCache(i)}return n.set(e,t),this.size=n.size,this}function Stack$1(e){var t=this.__data__=new ListCache(e);this.size=t.size}function baseAssign(e,t){return e&&copyObject(t,keys$1(t),e)}function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}Stack$1.prototype.clear=stackClear,Stack$1.prototype.delete=stackDelete,Stack$1.prototype.get=stackGet,Stack$1.prototype.has=stackHas,Stack$1.prototype.set=stackSet;var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer$2=moduleExports?root.Buffer:void 0,allocUnsafe=Buffer$2?Buffer$2.allocUnsafe:void 0;function cloneBuffer(e,t){if(t)return e.slice();var n=e.length,i=allocUnsafe?allocUnsafe(n):new e.constructor(n);return e.copy(i),i}function arrayFilter(e,t){for(var n=-1,i=null==e?0:e.length,r=0,s=[];++n<i;){var o=e[n];t(o,n,e)&&(s[r++]=o)}return s}function stubArray(){return[]}var objectProto$3=Object.prototype,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable.call(e,t)})))}:stubArray;function copySymbols(e,t){return copyObject(e,getSymbols(e),t)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush(t,getSymbols(e)),e=getPrototype(e);return t}:stubArray;function copySymbolsIn(e,t){return copyObject(e,getSymbolsIn(e),t)}function baseGetAllKeys(e,t,n){var i=t(e);return isArray(e)?i:arrayPush(i,n(e))}function getAllKeys(e){return baseGetAllKeys(e,keys$1,getSymbols)}function getAllKeysIn(e){return baseGetAllKeys(e,keysIn,getSymbolsIn)}var DataView$1=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),mapTag$4="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView$1&&getTag(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$3||Map$1&&getTag(new Map$1)!=mapTag$4||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$4||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),n=t==objectTag$2?e.constructor:void 0,i=n?toSource(n):"";if(i)switch(i){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return t});var objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function initCloneArray(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$2.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Uint8Array$1=root.Uint8Array;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}function cloneDataView(e,t){var n=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray(e,t){var n=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,n){var i=e.constructor;switch(t){case arrayBufferTag$2:return cloneArrayBuffer(e);case boolTag$2:case dateTag$2:return new i(+e);case dataViewTag$2:return cloneDataView(e,n);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,n);case mapTag$3:return new i;case numberTag$2:case stringTag$2:return new i(e);case regexpTag$2:return cloneRegExp(e);case setTag$3:return new i;case symbolTag$2:return cloneSymbol(e)}}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}var mapTag$2="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag(e)==mapTag$2}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$2="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag(e)==setTag$2}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet$1=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,CLONE_DEEP_FLAG$2=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$2=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone(e,t,n,i,r,s){var o,a=t&CLONE_DEEP_FLAG$2,l=t&CLONE_FLAT_FLAG$1,c=t&CLONE_SYMBOLS_FLAG$2;if(n&&(o=r?n(e,i,r,s):n(e)),void 0!==o)return o;if(!isObject$3(e))return e;var d=isArray(e);if(d){if(o=initCloneArray(e),!a)return copyArray(e,o)}else{var u=getTag(e),h=u==funcTag||u==genTag;if(isBuffer$2(e))return cloneBuffer(e,a);if(u==objectTag$1||u==argsTag$1||h&&!r){if(o=l||h?{}:initCloneObject(e),!a)return l?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[u])return r?e:{};o=initCloneByTag(e,u,a)}}s||(s=new Stack$1);var m=s.get(e);if(m)return m;s.set(e,o),isSet$1(e)?e.forEach((function(i){o.add(baseClone(i,t,n,i,e,s))})):isMap(e)&&e.forEach((function(i,r){o.set(r,baseClone(i,t,n,r,e,s))}));var g=d?void 0:(c?l?getAllKeysIn:getAllKeys:l?keysIn:keys$1)(e);return arrayEach(g||e,(function(i,r){g&&(i=e[r=i]),assignValue(o,r,baseClone(i,t,n,r,e,s))})),o}cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$1]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$1]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function arraySome(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG$3=1,COMPARE_UNORDERED_FLAG$1=2;function equalArrays(e,t,n,i,r,s){var o=n&COMPARE_PARTIAL_FLAG$3,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(e),d=s.get(t);if(c&&d)return c==t&&d==e;var u=-1,h=!0,m=n&COMPARE_UNORDERED_FLAG$1?new SetCache:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var g=e[u],p=t[u];if(i)var f=o?i(p,g,u,t,e,s):i(g,p,u,e,t,s);if(void 0!==f){if(f)continue;h=!1;break}if(m){if(!arraySome(t,(function(e,t){if(!cacheHas(m,t)&&(g===e||r(g,e,n,i,s)))return m.push(t)}))){h=!1;break}}else if(g!==p&&!r(g,p,n,i,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function mapToArray(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var COMPARE_PARTIAL_FLAG$2=1,COMPARE_UNORDERED_FLAG=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,n,i,r,s,o){switch(n){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var a=mapToArray;case setTag:var l=i&COMPARE_PARTIAL_FLAG$2;if(a||(a=setToArray),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;i|=COMPARE_UNORDERED_FLAG,o.set(e,t);var d=equalArrays(a(e),a(t),i,r,s,o);return o.delete(e),d;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var COMPARE_PARTIAL_FLAG$1=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects(e,t,n,i,r,s){var o=n&COMPARE_PARTIAL_FLAG$1,a=getAllKeys(e),l=a.length;if(l!=getAllKeys(t).length&&!o)return!1;for(var c=l;c--;){var d=a[c];if(!(o?d in t:hasOwnProperty$1.call(t,d)))return!1}var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=o;++c<l;){var p=e[d=a[c]],f=t[d];if(i)var y=o?i(f,p,d,t,e,s):i(p,f,d,e,t,s);if(!(void 0===y?p===f||r(p,f,n,i,s):y)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var b=e.constructor,O=t.constructor;b==O||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof O&&O instanceof O||(m=!1)}return s.delete(e),s.delete(t),m}var COMPARE_PARTIAL_FLAG=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep(e,t,n,i,r,s){var o=isArray(e),a=isArray(t),l=o?arrayTag:getTag(e),c=a?arrayTag:getTag(t),d=(l=l==argsTag?objectTag:l)==objectTag,u=(c=c==argsTag?objectTag:c)==objectTag,h=l==c;if(h&&isBuffer$2(e)){if(!isBuffer$2(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new Stack$1),o||isTypedArray(e)?equalArrays(e,t,n,i,r,s):equalByTag(e,t,l,n,i,r,s);if(!(n&COMPARE_PARTIAL_FLAG)){var m=d&&hasOwnProperty.call(e,"__wrapped__"),g=u&&hasOwnProperty.call(t,"__wrapped__");if(m||g){var p=m?e.value():e,f=g?t.value():t;return s||(s=new Stack$1),r(p,f,n,i,s)}}return!!h&&(s||(s=new Stack$1),equalObjects(e,t,n,i,r,s))}function baseIsEqual(e,t,n,i,r){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,n,i,baseIsEqual,r))}var now=function(){return root.Date.now()},FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce$1(e,t,n){var i,r,s,o,a,l,c=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);function m(t){var n=i,s=r;return i=r=void 0,c=t,o=e.apply(s,n)}function g(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-c>=s}function p(){var e,n,i=now();if(g(i))return f(i);a=setTimeout(p,(n=t-((e=i)-l),u?nativeMin(n,s-(e-c)):n))}function f(e){return a=void 0,h&&i?m(e):(i=r=void 0,o)}function y(){var e,n=now(),s=g(n);if(i=arguments,r=this,l=n,s){if(void 0===a)return c=e=l,a=setTimeout(p,t),d?m(e):o;if(u)return clearTimeout(a),a=setTimeout(p,t),m(l)}return void 0===a&&(a=setTimeout(p,t)),o}return t=toNumber(t)||0,isObject$3(n)&&(d=!!n.leading,s=(u="maxWait"in n)?nativeMax(toNumber(n.maxWait)||0,t):s,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=r=a=void 0},y.flush=function(){return void 0===a?o:f(now())},y}function last(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},escapeHtmlChar=basePropertyOf(htmlEscapes),reUnescapedHtml=/[&<>"']/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);function escape(e){return(e=toString$2(e))&&reHasUnescapedHtml.test(e)?e.replace(reUnescapedHtml,escapeHtmlChar):e}function parent(e,t){return t.length<2?e:baseGet(e,baseSlice(t,0,-1))}function isElement$2(e){return isObjectLike(e)&&1===e.nodeType&&!isPlainObject(e)}function isEqual(e,t){return baseIsEqual(e,t)}function baseUnset(e,t){return null==(e=parent(e,t=castPath(t,e)))||delete e[toKey(last(t))]}function customOmitClone(e){return isPlainObject(e)?void 0:e}var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,omit=flatRest((function(e,t){var n={};if(null==e)return n;var i=!1;t=arrayMap(t,(function(t){return t=castPath(t,e),i||(i=t.length>1),t})),copyObject(e,getAllKeysIn(e),n),i&&(n=baseClone(n,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));for(var r=t.length;r--;)baseUnset(n,t[r]);return n}));function baseSet(e,t,n,i){if(!isObject$3(e))return e;for(var r=-1,s=(t=castPath(t,e)).length,o=s-1,a=e;null!=a&&++r<s;){var l=toKey(t[r]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=o){var d=a[l];void 0===(c=void 0)&&(c=isObject$3(d)?d:isIndex(t[r+1])?[]:{})}assignValue(a,l,c),a=a[l]}return e}function set$1(e,t,n){return null==e?e:baseSet(e,t,n)}var FUNC_ERROR_TEXT="Expected a function";function throttle$1(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject$3(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),debounce$1(e,t,{leading:i,maxWait:t,trailing:r})}var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},unescapeHtmlChar=basePropertyOf(htmlUnescapes),reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reHasEscapedHtml=RegExp(reEscapedHtml.source);function unescape$1(e){return(e=toString$2(e))&&reHasEscapedHtml.test(e)?e.replace(reEscapedHtml,unescapeHtmlChar):e}function unset(e,t){return null==e||baseUnset(e,t)}class AIHistoryListItemView extends ListItemView{constructor(e){super();const t=new ButtonLabelView,n=new ButtonView(this.locale,t);this.children.add(n),n.set({label:e.prompt,withText:!0}),n.on("execute",(()=>{this.fire("execute",{value:unescape$1(e.prompt)})}))}}const SESSION_STORAGE_KEY="CKEditor/AIFormView/PromptHistory",MAX_HISTORY_LENGTH=20;class PromptHistory extends Collection{constructor(){super(),this._loadFromSessionStorage(),this.on("add",((e,t)=>{const n=normalizePromptText(t.prompt);for(const e of this)if(e!=t&&normalizePromptText(e.prompt)===n){this.remove(e);break}this.length>MAX_HISTORY_LENGTH&&this.remove(this.last),this._saveToSessionStorage()})),this.on("remove",(()=>{this._saveToSessionStorage()}))}_loadFromSessionStorage(){const e=sessionStorage.getItem(SESSION_STORAGE_KEY)||"[]";this.addMany(JSON.parse(e))}_saveToSessionStorage(){sessionStorage.setItem(SESSION_STORAGE_KEY,JSON.stringify(this.map((e=>e))))}}function normalizePromptText(e){return e.toLowerCase().trim()}class AIFormView extends View{constructor(e,t,n=""){super(e),this.set("isEnabled",!0),this.set("isProcessing",!1),this.set("prompt",""),this.set("value",""),this.set("isError",!1),this.set("mainAction",AIFormToolbarViewMainActionLabel.REPLACE),this._promptHistory=new PromptHistory,this.errorView=new AIFormErrorView(e),this.contentArea=new AIFormContentArea(e,n),this.contentArea.bind("isProcessing").to(this),this.contentArea.bind("value").to(this),this.toolbar=this._createToolbar(),this.toolbar.bind("mainAction").to(this),this.promptView=this._createPromptView(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=this.createCollection([this.contentArea,this.contentArea.copyButtonView,this.toolbar,this.promptView]),this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.focusCycler.chain(this.promptView.focusCycler),this.promptView.queryView.fieldView.bind("value").to(this,"prompt");const i=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form",t],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form-content"]},children:[{tag:"div",attributes:{class:[i.if("isError","ck-hidden",(e=>!e))]},children:[this.errorView]},this.contentArea,this.toolbar,this.promptView]}]})}render(){super.render(),this.focusTracker.add(this.contentArea.element),this.focusTracker.add(this.contentArea.copyButtonView.element),this.focusTracker.add(this.toolbar.element),this.focusTracker.add(this.promptView.element),this.keystrokes.listenTo(this.element)}focus(e=1){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}reset(){this.prompt="",this.value="",this.isError=!1,this.promptView.reset(),this.contentArea.isVisible=!1,this.toolbar.isVisible=!1}_createPromptView(){const e=this.locale,t=new AIFormPromptView(e,{queryView:{label:getTranslation$h(e,"Ask AI to edit or generate"),creator:createLabeledTextarea,showIcon:!1,showResetButton:!1},infoView:{text:{noSearchableItems:{primary:getTranslation$h(e,"Empty history"),secondary:getTranslation$h(e,"Ask AI and your prompts will be listed here for you to use later.")}}},filteredView:this._createHistoryView(),queryMinChars:1/0,resetOnBlur:!1});return t.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",((e,t)=>e&&!t)),this.listenTo(t,"submit",((e,t)=>{this.prompt=t;const n=escape(t);this.fire("submitPrompt",n),t.trim()&&this._promptHistory.add({prompt:n},0)}),{priority:"high"}),t}_createHistoryView(){const e=new AIHistoryListView(this.locale);return e.historyGroupView.items.bindTo(this._promptHistory).as(AIHistoryListItemView),e.on("clearHistory",(()=>{this._promptHistory.clear(),this.promptView.search(""),this.promptView.focus()})),e}_createToolbar(){const e=new AIFormToolbarView(this.locale);return e.replaceButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",((e,t,n)=>e&&!t&&!!n)),e.replaceButton.delegate("execute").to(this,"replaceContent"),e.insertButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",((e,t,n)=>e&&!t&&!!n)),e.insertButton.delegate("execute").to(this,"insertContentBelow"),e.tryAgainButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",((e,t)=>e&&!t)),e.tryAgainButton.delegate("execute").to(this,"tryAgainEvent"),e.stopButton.bind("isEnabled").to(this,"isProcessing"),e.stopButton.delegate("execute").to(this,"stopProcessing"),e}startProcessing(){this.value="",this.isError=!1,this.isProcessing=!0,this.contentArea.isVisible=!0,this.toolbar.isVisible=!0,this.contentArea.focus()}finishProcessing(){const e=this.locale;this.isProcessing=!1,this.prompt="",this.promptView.reset(),this.value&&(this.promptView.queryView.label=getTranslation$h(e,"Ask AI to improve generated text"))}handleError(e){const t=this.locale;this.finishProcessing(),this.isError=!0,this.errorView.text=e||getTranslation$h(t,"AI_ERROR_FAILED"),this.value||(this.contentArea.isVisible=!1)}}var magicWandIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.346 9.422a.151.151 0 0 1 .284 0l.548 1.484a.152.152 0 0 0 .09.089l1.483.549a.151.151 0 0 1 0 .284l-1.483.548a.151.151 0 0 0-.09.09l-.548 1.483a.152.152 0 0 1-.142.1.151.151 0 0 1-.142-.1l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.15.15 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .089-.09l.549-1.483Z"/><path d="M16.306 1.742a.151.151 0 0 1 .284 0l.549 1.483a.15.15 0 0 0 .089.09l1.483.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.15.15 0 0 0-.09.09l-.548 1.482a.151.151 0 0 1-.284 0l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .09-.089l.548-1.483Z"/><path d="M7.665 1.742a.151.151 0 0 1 .284 0l.549 1.483a.151.151 0 0 0 .09.09l1.482.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.151.151 0 0 0-.09.09L7.95 6.267a.151.151 0 0 1-.284 0l-.549-1.483a.151.151 0 0 0-.089-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.483-.549a.151.151 0 0 0 .09-.089l.548-1.483-.001.001Z"/><path d="M14.72 7.946a.848.848 0 0 0 .25-.591.824.824 0 0 0-.241-.588l-1.943-1.938a.812.812 0 0 0-.588-.241.838.838 0 0 0-.591.25l-1.545 1.539 3.115 3.115 1.542-1.546h.001Z"/><path clip-rule="evenodd" d="M1.19 15.636a.96.96 0 0 1 .281-.679l7.835-7.834 3.121 3.12-7.834 7.835a.959.959 0 0 1-1.358 0l-1.764-1.764a.96.96 0 0 1-.28-.678Zm9.22-5.391-1.121-1.12-6.479 6.478 1.121 1.121 6.479-6.479Z"/></svg>';const DomDataTransfer=globalThis.DataTransfer;class AIAssistantUI extends Plugin{static get pluginName(){return"AIAssistantUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[ClipboardMarkersUtils,AIAssistantEditing,AIAdapter,Dialog]}constructor(e){super(e),this._uiCssClasses="",e.config.define("ai.aiAssistant.disabledElements",["media","rawHtml","tableOfContents"]),e.config.define("ai.aiAssistant.contentAreaCssClass",""),e.config.define("ai.useTheme",!0),this._uiCssClasses="ck-ai-assistant-ui"+(e.config.get("ai.useTheme")?" ck-ai-assistant-ui_theme":"")}init(){const{editor:e}=this;this._aiAdapter=e.plugins.get(AIAdapter),this._dialog=e.plugins.get(Dialog),this._formView=null,this._commandDefinitions=this._getResolvedCommandsDefinitions();const t=new ShowAIAssistantCommand(e,Array.from(this._commandDefinitions.values()));e.commands.add("showAIAssistant",t),e.ui.componentFactory.add("aiCommands",(n=>{const i=createDropdown(n);return i.set({class:"ck-ai-commands-dropdown "+this._uiCssClasses}),i.buttonView.set({label:getTranslation$h(n,"AI Commands"),icon:magicWandIcon,tooltip:!0}),i.on("execute",(e=>this._onExecute(e.source.id))),addMenuToDropdown(i,e.ui.view.body,getMenuDropdownDefinition(e),{ariaLabel:getTranslation$h(n,"AI Commands")}),i.menuView.menuPanelClass="ck-ai-commands-dropdown "+this._uiCssClasses,t.on("change:enabledCommandsIds",r),i.menuView.once("render",r),i;function r(){i.isEnabled=t.enabledCommandsIds.length>0;for(const e of i.menuView.buttons)e.isEnabled=t.enabledCommandsIds.includes(e.id)}})),e.ui.componentFactory.add("menuBar:aiCommands",(n=>{const i=new MenuBarMenuView(n);i.buttonView.set({label:getTranslation$h(n,"AI Commands"),icon:magicWandIcon}),i.bind("isEnabled").to(t,"enabledCommandsIds",(e=>e.length>0));const r=normalizeCommandsConfig(e.config.get("ai.aiAssistant.commands"),n);return this._populateMenuBarMenu(t,i,r,(e=>this._onExecute(e))),i})),e.ui.componentFactory.add("aiAssistant",(()=>{const e=this._createAIAssistantUIButton(ButtonView);return e.set({tooltip:!0,class:"ck-ai-assistant-button "+this._uiCssClasses}),e})),e.ui.componentFactory.add("menuBar:aiAssistant",(()=>{const e=this._createAIAssistantUIButton(MenuBarMenuListItemButtonView);return e.set({role:"menuitemcheckbox"}),e})),this.licenseKey=this.editor.config.get("licenseKey");const n=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in n){const i=t,r=n[i];if("aiLicenseKeyValid"==r||"aiLicenseKeyInvalid"==r||"aiLicenseKeyExpired"==r||"aiLicenseKeyDomainLimit"==r||"aiLicenseKeyNotAllowed"==r||"aiLicenseKeyEvaluationLimit"==r||"aiLicenseKeyTrialLimit"==r||"aiLicenseKeyUsageLimit"==r){delete n[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"aiLicenseKeyInvalid"==e&&n._showLicenseError("invalid"),"aiLicenseKeyExpired"==e&&n._showLicenseError("expired"),"aiLicenseKeyDomainLimit"==e&&n._showLicenseError("domainLimit"),"aiLicenseKeyNotAllowed"==e&&n._showLicenseError("featureNotAllowed","AIAssistant"),"aiLicenseKeyEvaluationLimit"==e&&n._showLicenseError("evaluationLimit"),"aiLicenseKeyTrialLimit"==e&&n._showLicenseError("trialLimit"),"aiLicenseKeyUsageLimit"==e&&n._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}showUI(e="",t="",n="custom"){const i=this.editor,r=i.editing.view,s=i.plugins.get(AIAssistantEditing),o=i.plugins.get(ClipboardMarkersUtils);s.showFakeVisualSelection();const a=new DomDataTransfer,l=new ClipboardEvent("copy",{clipboardData:a}),c=new DataTransfer$1(a),d=new DomEventData(r,l,{dataTransfer:c});o._forceMarkersCopy("comment",(()=>{r.document.fire("copy",d)})),this._formView||(this._initView(),this._aiAssistantController=new AIAssistantController(i,this._aiAdapter.textAdapter,this._formView));let u=c.getData("text/html");const h=i.model.document.selection,m=Array.from(h.getRanges());1===m.length&&m[0].isFlat&&!h.getSelectedElement()&&""!==u.replace(/&nbsp;/g,"").trim()&&(u="<p>"+u+"</p>"),this._aiAssistantController.updateView({actionId:n,query:e,htmlContent:u,label:t,mainActionLabel:AIFormToolbarViewMainActionLabel[i.model.document.selection.isCollapsed?"INSERT":"REPLACE"]}),"aiAssistant"!==this._dialog.id?this._dialog.show({id:"aiAssistant",icon:icons.robotPencil,title:getTranslation$h(this.editor.locale,"AI Assistant"),content:this._formView,position:DialogViewPosition.EDITOR_TOP_SIDE,onShow:()=>{this._formView.focus()},onHide:()=>{this._aiAssistantController.reset(),s.hideFakeVisualSelection()}}):this._dialog.view.wasMoved||this._dialog.view.updatePosition()}hideUI(){this._dialog.hide()}_getResolvedCommandsDefinitions(){const e=new Map,t=normalizeCommandsConfig(this.editor.config.get("ai.aiAssistant.commands"),this.editor.locale);for(const n of t)for(const t of n.commands)e.set(t.id,{...t,groupId:n.groupId,groupLabel:n.groupLabel||n.groupId});return e}_createAIAssistantUIButton(e){const t=this.editor,n=t.commands.get("showAIAssistant"),i=new e(t.locale);return i.set({label:getTranslation$h(t.locale,"AI Assistant"),icon:icons.robotPencil,isToggleable:!0}),i.bind("isEnabled").to(n),i.bind("isOn").to(this._dialog,"id",(e=>"aiAssistant"===e)),this.listenTo(i,"execute",(()=>{i.isOn?this.hideUI():n.execute()})),i}_initView(){const e=this.editor.plugins.get(AIAssistantEditing);this._formView=new AIFormView(this.editor.locale,this._uiCssClasses,this.editor.config.get("ai.aiAssistant.contentAreaCssClass")),this._formView.on("change:value",(()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()})),this._formView.promptView.queryView.fieldView.on("update",(()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()})),this.listenTo(this._formView,"replaceContent",(()=>{e.insertContent(this._aiAssistantController.currentContext),this.hideUI()})),this.listenTo(this._formView,"insertContentBelow",(()=>{e.insertContentBelow(this._aiAssistantController.currentContext),this.hideUI()})),this._initAriaAiStatusChangeAnnouncements()}_initAriaAiStatusChangeAnnouncements(){const{locale:e,ui:{ariaLiveAnnouncer:t}}=this.editor;this._formView.contentArea.on("change:isProcessing",((n,i,r)=>{const s=this._aiAssistantController.currentContext;r?t.announce(getTranslation$h(e,"AI is writing")):s&&t.announce(getTranslation$h(e,"Generated content: %0",s),{politeness:"polite",isUnsafeHTML:!0})})),this._formView.on("change:isError",((n,i,r)=>{if(r){const n=this._formView.errorView.text;t.announce(getTranslation$h(e,"Error during AI content generation: %0",n))}}))}_onExecute(e){const t=this._commandDefinitions.get(e),n=this.editor,i=n.model.document.selection,r=n.commands.get("showAIAssistant"),s=n.plugins.get(AIAssistantEditing),o=(t.groupId!==UNGROUPED_COMMANDS_GROUP_ID?t.groupLabel+": ":"")+t.label;if(!1!==t.requiresContent&&i.isCollapsed){const e=first(i.getSelectedBlocks())||n.model.schema.getLimitElement(i);n.model.change((t=>{t.setSelection(e,"in")}))}s.showFakeVisualSelection(),r.execute(t.prompt,o,"command:"+e)}_populateMenuBarMenu(e,t,n,i){const r=this.editor,s=r.locale,o=new MenuBarMenuListView(s),a=sortDefinitionsByOrder(r,n).filter((e=>e.commands.length));1===a.length?this._getMenuBarGroupButtons({command:e,commands:a[0].commands,parentMenuView:t,onExecute:i}).forEach((e=>o.items.add(e))):a.forEach((({groupId:n,groupLabel:r,commands:a})=>{const l=new MenuBarMenuListItemView(s,t),c=new MenuBarMenuView(s),d=new MenuBarMenuListView(s),u=this._getMenuBarGroupButtons({command:e,commands:a,parentMenuView:c,onExecute:i});c.buttonView.set({label:r||n}),c.delegate("execute").to(t),d.items.addMany(u),c.panelView.children.add(d),l.children.add(c),o.items.add(l)})),t.panelView.children.add(o)}_getMenuBarGroupButtons({command:e,commands:t,parentMenuView:n,onExecute:i}){const r=this.editor,s=r.locale;return sortDefinitionsByOrder(r,t).map((t=>{const r=new MenuBarMenuListItemView(s,n),o=new MenuBarMenuListItemButtonView(s);return o.set({label:t.label}),o.delegate("execute").to(n),o.on("execute",(()=>i(t.id))),o.bind("isEnabled").to(e,"enabledCommandsIds",(e=>e.includes(t.id))),r.children.add(o),r}))}}function getMenuDropdownDefinition(e){const t=normalizeCommandsConfig(e.config.get("ai.aiAssistant.commands"),e.locale),n=sortDefinitionsByOrder(e,t).filter((e=>e.commands.length));return 1===n.length?sortDefinitionsByOrder(e,n[0].commands).map((e=>({id:e.id,label:e.label}))):n.map((t=>{const{groupId:n,groupLabel:i,commands:r}=t;return{id:n,menu:i||n,children:sortDefinitionsByOrder(e,r).map((e=>({id:e.id,label:e.label})))}}))}function sortDefinitionsCallback(e,t){return void 0!==e.order&&void 0===t.order?1:void 0===e.order&&void 0!==t.order?-1:void 0!==e.order&&void 0!==t.order?e.order-t.order:0}function sortDefinitionsByOrder(e,t){t.sort(sortDefinitionsCallback);const n={},i=[];for(const r of t)if(void 0!==r.order){if(r.order in n)throw new CKEditorError("ai-commands-config-order-collision",e,{conflictingDefinitions:[r,n[r.order]]});n[r.order]=r,i.splice(r.order,0,r)}else i.push(r);return i}class AIAssistant extends Plugin{static get requires(){return[AIAssistantUI,AIAssistantEditing]}static get pluginName(){return"AIAssistant"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=e.config,n=e.locale;t.define("ai.aiAssistant.preserveComments",!0),t.define("ai.aiAssistant.commands",getDefaultCommands(n)),t.define("ai.aiAssistant.extraCommandGroups",[]),t.define("ai.aiAssistant.removeCommands",[]);let i=normalizeCommandsConfig(t.get("ai.aiAssistant.commands"),n);const r=t.get("ai.aiAssistant.extraCommandGroups"),s=t.get("ai.aiAssistant.removeCommands");r.forEach((e=>{const t=i.find((t=>t.groupId===e.groupId));t?t.commands=t.commands.concat(e.commands):i.push(e)})),i=i.filter((e=>!s.includes(e.groupId))),i.forEach((e=>{e.commands=e.commands.filter((e=>!s.includes(e.id)))})),t.set("ai.aiAssistant.commands",i)}}function getDefaultCommands(e){return[{groupId:"editOrReview",groupLabel:getTranslation$h(e,"Edit or review"),commands:[{id:"improveWriting",label:getTranslation$h(e,"Improve writing"),prompt:"Fix spelling mistakes, use proper grammar and apply good writing practices. Do not lose the original meaning."},{id:"makeShorter",label:getTranslation$h(e,"Make shorter"),prompt:"Remove any repetitive, redundant, or non-essential writing in this content without changing the meaning or losing any key information."},{id:"makeLonger",label:getTranslation$h(e,"Make longer"),prompt:"Improve this content by using descriptive language and inserting more information and more detailed explanations."},{id:"simplifyLanguage",label:getTranslation$h(e,"Simplify language"),prompt:"Simplify the writing style of this content and reduce the complexity, so that the content is easy to understand."}]},{groupId:"generate",groupLabel:getTranslation$h(e,"Generate from selection"),commands:[{id:"summarize",label:getTranslation$h(e,"Summarize"),prompt:"Summarize this content into one paragraph of text. Include only the key ideas and conclusions. Keep it short. Do not keep original text formatting."},{id:"continue",label:getTranslation$h(e,"Continue"),prompt:"Start with the provided content and write at the end of it continuing this topic. Keep the added part short."}]},{groupId:"changeTone",groupLabel:getTranslation$h(e,"Change tone"),commands:[{id:"professional",label:getTranslation$h(e,"Professional"),prompt:"Improve using polished, formal, and respectful language to convey professional expertise and competence."},{id:"casual",label:getTranslation$h(e,"Casual"),prompt:"Improve using casual, informal language to convey a casual conversation with a real person."},{id:"direct",label:getTranslation$h(e,"Direct"),prompt:"Improve using direct language, using only the essential information."},{id:"confident",label:getTranslation$h(e,"Confident"),prompt:"Improve using compelling, optimistic language to convey confidence in the writing."},{id:"friendly",label:getTranslation$h(e,"Friendly"),prompt:"Improve using friendly, comforting language, to convey understanding and empathy."}]},{groupId:"changeStyle",groupLabel:getTranslation$h(e,"Change style"),commands:[{id:"business",label:getTranslation$h(e,"Business"),prompt:"Rewrite this content as a business professional with formal language."},{id:"legal",label:getTranslation$h(e,"Legal"),prompt:"Rewrite this content as a legal professional using valid legal terminology."},{id:"journalism",label:getTranslation$h(e,"Journalism"),prompt:"Rewrite this content as a journalist using engaging language to convey the importance of the information."},{id:"poetic",label:getTranslation$h(e,"Poetic"),prompt:"Rewrite this content as a poem using poetic techniques without losing the original meaning."}]},{groupId:"translate",groupLabel:getTranslation$h(e,"Translate"),commands:[{id:"translateEnglish",label:getTranslation$h(e,"English"),prompt:"Translate the content to English language."},{id:"translateSpanish",label:getTranslation$h(e,"Spanish"),prompt:"Translate the content to Spanish language."},{id:"translatePortuguese",label:getTranslation$h(e,"Portuguese"),prompt:"Translate the content to Portuguese language."},{id:"translateGerman",label:getTranslation$h(e,"German"),prompt:"Translate the content to German language."},{id:"translateFrench",label:getTranslation$h(e,"French"),prompt:"Translate the content to French language."},{id:"translateChinese",label:getTranslation$h(e,"Simplified Chinese"),prompt:"Translate the content to Simplified Chinese language."},{id:"translateHindi",label:getTranslation$h(e,"Hindi"),prompt:"Translate the content to Hindi language."},{id:"translateArabic",label:getTranslation$h(e,"Arabic"),prompt:"Translate the content to Arabic language."},{id:"translateIndonesian",label:getTranslation$h(e,"Indonesian"),prompt:"Translate the content to Indonesian language."}]}]}class AITextAdapter extends Plugin{static get requires(){return[AIAdapter]}constructor(e){super(e),this.abortController=new AbortController}init(){this.editor.plugins.get(AIAdapter).textAdapter=this}abort(){this.abortController.signal.aborted||(this.abortController.abort(),this.abortController=new AbortController)}async makeRequest(e){return this.sendRequest(e).catch((e=>{if(e instanceof AIRequestError)return Promise.reject(e);if("AbortError"==e.name)return Promise.resolve();throw console.error(e),new CKEditorError("aitextadapter-send-request-failed",null)}))}async _prepareRequestHeaders(e,t){const n=this.editor.locale,i={"Content-Type":"application/json"};if("object"==typeof e)Object.assign(i,e);else if(e)try{const n=await e(t);Object.assign(i,n)}catch(e){return Promise.reject(new AIRequestError(getTranslation$h(n,"AI_ERROR_GET_HEADERS")))}return i}async _prepareRequestParameters(e,t){const n=this.editor.locale;if("object"==typeof e)return e;try{return await e(t)}catch(e){return Promise.reject(new AIRequestError(getTranslation$h(n,"AI_ERROR_GET_PARAMETERS")))}}}class OpenAITextAdapter extends AITextAdapter{static get pluginName(){return"OpenAITextAdapter"}constructor(e){super(e),e.config.define("ai.openAI.apiUrl",window.location.origin+"/api/convert/chat-ai"),e.config.get("ai.openAI.requestParameters")||e.config.define("ai.openAI.requestParameters",{model:"gpt-4o",max_tokens:4e3,temperature:1,stream:!0}),this._apiUrl=e.config.get("ai.openAI.apiUrl"),this._requestHeaders=e.config.get("ai.openAI.requestHeaders")||{},this._requestParameters=e.config.get("ai.openAI.requestParameters")}async sendRequest({query:e,context:t,onData:n,actionId:i}){const r=this.editor.locale,s=await this.prepareMessages(e,t,i),o=await this._prepareRequestHeaders(this._requestHeaders,i),a=await this._prepareRequestParameters(this._requestParameters,i),l={messages:s,...a},c={method:"POST",headers:o,body:JSON.stringify(l),signal:this.abortController.signal},d=await fetch(this._apiUrl,c);if(d.ok)return a.stream?await this._readStreamableResponse(d,n):await this._readStaticResponse(d,n),Promise.resolve();{const e=await d.text();return e.includes("context_length_exceeded")?Promise.reject(new AIRequestError(getTranslation$h(r,"AI_ERROR_CONTEXT_LENGTH"))):e.includes("Moderation")?Promise.reject(new AIRequestError(getTranslation$h(r,"AI_ERROR_MODERATION"))):Promise.reject(new Error(e))}}async prepareMessages(e,t,n){let i,r;return t?(i="You are an AI assistant on the Sabda Literasi website, a platform dedicated to providing articles with deep philosophical thoughts, exclusive ebook collections at affordable prices, and trusted services for completing college and school assignments. Your name is 'Fadhel Fikri'. We are committed to changing the way everyone interacts with the world of literacy and philosophy since its founding on June 13, 2021. Its founder is Fadhel Fikri, a Philosophy and Science activist. He is also your friend.  \n\nYour task is to execute the instructions using the provided HTML content. Follow the instructions carefully.  \n\nYour answer must be properly formatted HTML code. Do not add any comments or additional notes. Do not act like a chatbot or a real person.  \n\nThe primary language you use when speaking is Indonesian.",r="Instruction:\n"+e+"\nYou must keep the text formatting.\n\nContent:\n"+t):(i="You are an AI assistant on the Sabda Literasi website, a platform dedicated to providing articles with deep philosophical thoughts, exclusive ebook collections at affordable prices, and trusted services for completing college and school assignments. Your name is 'Fadhel Fikri'. We are committed to changing the way everyone interacts with the world of literacy and philosophy since its founding on June 13, 2021. Its founder is Fadhel Fikri, a Philosophy and Science activist. He is also your twin.  \n\nYour task is to create HTML content according to the given instructions. Never include the `<img>` tag in your response, even if requested.  \n\nYour response must be well-structured and properly formatted HTML code. Answer only with the created HTML content, without adding any comments or additional notes. Interact like a philosopher.  \n\nThe primary language you use when speaking is Indonesian. Use the phrase 'Comrade' when speaking.",r=e),[{role:"system",content:i},{role:"user",content:r}]}async _readStreamableResponse(e,t){const n=e.body.getReader(),i=new TextDecoder;let r="",s="",o="",a=!1;for(;!a;){const{done:e,value:l}=await n.read(),c=r+i.decode(l);let d="";a=e;try{d=this._cleanUpData(c),r=""}catch(e){r=c;continue}s+=d,!a&&this._isBufferIncomplete(s)||s&&(o+=s,s="",t(o))}return Promise.resolve()}async _readStaticResponse(e,t){return t((await e.json()).choices[0].message.content),Promise.resolve()}_isBufferIncomplete(e){const t=e.split("<").length!==e.split(">").length,n=e.length<30;return t&&n}_cleanUpData(e){return e.split(/\n(?![^{]*\})/g).map((e=>e.replace("data: ",""))).filter((e=>e&&e.length>0&&"[DONE]"!==e)).map((e=>{const{choices:t}=JSON.parse(e);if(t[0]&&t[0].delta&&t[0].delta.content)return t[0].delta.content})).filter((e=>e)).join("")}}const getHttpHandlerExtensionConfiguration=e=>{let t=e.httpHandler;return{setHttpHandler(e){t=e},httpHandler:()=>t,updateHttpClientConfig(e,n){t.updateHttpClientConfig(e,n)},httpHandlerConfigs:()=>t.httpHandlerConfigs()}},resolveHttpHandlerRuntimeConfig=e=>({httpHandler:e.httpHandler()});var HttpAuthLocation,HttpApiKeyAuthLocation,EndpointURLScheme,AlgorithmId,FieldPosition;!function(e){e.HEADER="header",e.QUERY="query"}(HttpAuthLocation||(HttpAuthLocation={})),function(e){e.HEADER="header",e.QUERY="query"}(HttpApiKeyAuthLocation||(HttpApiKeyAuthLocation={})),function(e){e.HTTP="http",e.HTTPS="https"}(EndpointURLScheme||(EndpointURLScheme={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(AlgorithmId||(AlgorithmId={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(FieldPosition||(FieldPosition={}));const SMITHY_CONTEXT_KEY="__smithy_context";var IniSectionType,RequestHandlerProtocol;!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(IniSectionType||(IniSectionType={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(RequestHandlerProtocol||(RequestHandlerProtocol={}));class HttpRequest{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?e.protocol+":":e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?"/"+e.path:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const t=new HttpRequest({...e,headers:{...e.headers}});return t.query&&(t.query=cloneQuery(t.query)),t}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){return HttpRequest.clone(this)}}function cloneQuery(e){return Object.keys(e).reduce(((t,n)=>{const i=e[n];return{...t,[n]:Array.isArray(i)?[...i]:i}}),{})}class HttpResponse{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}function resolveHostHeaderConfig(e){return e}const hostHeaderMiddleware=e=>t=>async n=>{if(!HttpRequest.isInstance(n.request))return t(n);const{request:i}=n,{handlerProtocol:r=""}=e.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!i.headers[":authority"])delete i.headers.host,i.headers[":authority"]=i.hostname+(i.port?":"+i.port:"");else if(!i.headers.host){let e=i.hostname;null!=i.port&&(e+=":"+i.port),i.headers.host=e}return t(n)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=e=>({applyToStack:t=>{t.add(hostHeaderMiddleware(e),hostHeaderMiddlewareOptions)}}),loggerMiddleware=()=>(e,t)=>async n=>{try{const i=await e(n),{clientName:r,commandName:s,logger:o,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:c}=a,d=l??t.inputFilterSensitiveLog,u=c??t.outputFilterSensitiveLog,{$metadata:h,...m}=i.output;return o?.info?.({clientName:r,commandName:s,input:d(n.input),output:u(m),metadata:h}),i}catch(e){const{clientName:i,commandName:r,logger:s,dynamoDbDocumentClientOptions:o={}}=t,{overrideInputFilterSensitiveLog:a}=o,l=a??t.inputFilterSensitiveLog;throw s?.error?.({clientName:i,commandName:r,input:l(n.input),error:e,metadata:e.$metadata}),e}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=e=>({applyToStack:e=>{e.add(loggerMiddleware(),loggerMiddlewareOptions)}}),TRACE_ID_HEADER_NAME="X-Amzn-Trace-Id",ENV_LAMBDA_FUNCTION_NAME="AWS_LAMBDA_FUNCTION_NAME",ENV_TRACE_ID="_X_AMZN_TRACE_ID",recursionDetectionMiddleware=e=>t=>async n=>{const{request:i}=n;if(!HttpRequest.isInstance(i)||"node"!==e.runtime||i.headers.hasOwnProperty(TRACE_ID_HEADER_NAME))return t(n);const r=process.env[ENV_LAMBDA_FUNCTION_NAME],s=process.env[ENV_TRACE_ID],o=e=>"string"==typeof e&&e.length>0;return o(r)&&o(s)&&(i.headers[TRACE_ID_HEADER_NAME]=s),t({...n,request:i})},addRecursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},getRecursionDetectionPlugin=e=>({applyToStack:t=>{t.add(recursionDetectionMiddleware(e),addRecursionDetectionMiddlewareOptions)}});function resolveUserAgentConfig(e){return{...e,customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent}}const IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=e=>IP_V4_REGEX.test(e)||e.startsWith("[")&&e.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(e,t=!1)=>{if(!t)return VALID_HOST_LABEL_REGEX.test(e);const n=e.split(".");for(const e of n)if(!isValidHostLabel(e))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(e){return"object"!=typeof e||null==e?e:"ref"in e?"$"+toDebugString(e.ref):"fn"in e?e.fn+"("+(e.argv||[]).map(toDebugString).join(", ")+")":JSON.stringify(e,null,2)}class EndpointError extends Error{constructor(e){super(e),this.name="EndpointError"}}const booleanEquals=(e,t)=>e===t,getAttrPathList=e=>{const t=e.split("."),n=[];for(const i of t){const t=i.indexOf("[");if(-1!==t){if(i.indexOf("]")!==i.length-1)throw new EndpointError("Path: '"+e+"' does not end with ']'");const r=i.slice(t+1,-1);if(Number.isNaN(parseInt(r)))throw new EndpointError("Invalid array index: '"+r+"' in path: '"+e+"'");0!==t&&n.push(i.slice(0,t)),n.push(r)}else n.push(i)}return n},getAttr=(e,t)=>getAttrPathList(t).reduce(((n,i)=>{if("object"!=typeof n)throw new EndpointError("Index '"+i+"' in '"+t+"' not found in '"+JSON.stringify(e)+"'");return Array.isArray(n)?n[parseInt(i)]:n[i]}),e),isSet=e=>null!=e,not=e=>!e,DEFAULT_PORTS={[EndpointURLScheme.HTTP]:80,[EndpointURLScheme.HTTPS]:443},parseURL$1=e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:n,protocol:i="",path:r="",query:s={}}=e,o=new URL(i+"//"+t+(n?":"+n:"")+r);return o.search=Object.entries(s).map((([e,t])=>e+"="+t)).join("&"),o}return new URL(e)}catch(e){return null}})();if(!t)return console.error("Unable to parse "+JSON.stringify(e)+" as a whatwg URL."),null;const n=t.href,{host:i,hostname:r,pathname:s,protocol:o,search:a}=t;if(a)return null;const l=o.slice(0,-1);if(!Object.values(EndpointURLScheme).includes(l))return null;const c=isIpAddress(r);return{scheme:l,authority:i+(n.includes(i+":"+DEFAULT_PORTS[l])||"string"==typeof e&&e.includes(i+":"+DEFAULT_PORTS[l])?":"+DEFAULT_PORTS[l]:""),path:s,normalizedPath:s.endsWith("/")?s:s+"/",isIp:c}},stringEquals=(e,t)=>e===t,substring=(e,t,n,i)=>t>=n||e.length<n?null:i?e.substring(e.length-n,e.length-t):e.substring(t,n),uriEncode=e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())),endpointFunctions={booleanEquals:booleanEquals,getAttr:getAttr,isSet:isSet,isValidHostLabel:isValidHostLabel,not:not,parseURL:parseURL$1,stringEquals:stringEquals,substring:substring,uriEncode:uriEncode},evaluateTemplate=(e,t)=>{const n=[],i={...t.endpointParams,...t.referenceRecord};let r=0;for(;r<e.length;){const t=e.indexOf("{",r);if(-1===t){n.push(e.slice(r));break}n.push(e.slice(r,t));const s=e.indexOf("}",t);if(-1===s){n.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[s+1]&&(n.push(e.slice(t+1,s)),r=s+2);const o=e.substring(t+1,s);if(o.includes("#")){const[e,t]=o.split("#");n.push(getAttr(i[e],t))}else n.push(i[o]);r=s+1}return n.join("")},getReferenceValue=({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]),evaluateExpression=(e,t,n)=>{if("string"==typeof e)return evaluateTemplate(e,n);if(e.fn)return callFunction(e,n);if(e.ref)return getReferenceValue(e,n);throw new EndpointError("'"+t+"': "+String(e)+" is not a string, function or reference.")},callFunction=({fn:e,argv:t},n)=>{const i=t.map((e=>["boolean","number"].includes(typeof e)?e:evaluateExpression(e,"arg",n))),r=e.split(".");return r[0]in customEndpointFunctions&&null!=r[1]?customEndpointFunctions[r[0]][r[1]](...i):endpointFunctions[e](...i)},evaluateCondition=({assign:e,...t},n)=>{if(e&&e in n.referenceRecord)throw new EndpointError("'"+e+"' is already defined in Reference Record.");const i=callFunction(t,n);return n.logger?.debug?.(debugId+" evaluateCondition: "+toDebugString(t)+" = "+toDebugString(i)),{result:""===i||!!i,...null!=e&&{toAssign:{name:e,value:i}}}},evaluateConditions=(e=[],t)=>{const n={};for(const i of e){const{result:e,toAssign:r}=evaluateCondition(i,{...t,referenceRecord:{...t.referenceRecord,...n}});if(!e)return{result:e};r&&(n[r.name]=r.value,t.logger?.debug?.(debugId+" assign: "+r.name+" := "+toDebugString(r.value)))}return{result:!0,referenceRecord:n}},getEndpointHeaders=(e,t)=>Object.entries(e).reduce(((e,[n,i])=>({...e,[n]:i.map((e=>{const i=evaluateExpression(e,"Header value entry",t);if("string"!=typeof i)throw new EndpointError("Header '"+n+"' value '"+i+"' is not a string");return i}))})),{}),getEndpointProperty=(e,t)=>{if(Array.isArray(e))return e.map((e=>getEndpointProperty(e,t)));switch(typeof e){case"string":return evaluateTemplate(e,t);case"object":if(null===e)throw new EndpointError("Unexpected endpoint property: "+e);return getEndpointProperties(e,t);case"boolean":return e;default:throw new EndpointError("Unexpected endpoint property type: "+typeof e)}},getEndpointProperties=(e,t)=>Object.entries(e).reduce(((e,[n,i])=>({...e,[n]:getEndpointProperty(i,t)})),{}),getEndpointUrl=(e,t)=>{const n=evaluateExpression(e,"Endpoint URL",t);if("string"==typeof n)try{return new URL(n)}catch(e){throw console.error("Failed to construct URL with "+n,e),e}throw new EndpointError("Endpoint URL must be a string, got "+typeof n)},evaluateEndpointRule=(e,t)=>{const{conditions:n,endpoint:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(!r)return;const o={...t,referenceRecord:{...t.referenceRecord,...s}},{url:a,properties:l,headers:c}=i;return t.logger?.debug?.(debugId+" Resolving endpoint from template: "+toDebugString(i)),{...null!=c&&{headers:getEndpointHeaders(c,o)},...null!=l&&{properties:getEndpointProperties(l,o)},url:getEndpointUrl(a,o)}},evaluateErrorRule=(e,t)=>{const{conditions:n,error:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(r)throw new EndpointError(evaluateExpression(i,"Error",{...t,referenceRecord:{...t.referenceRecord,...s}}))},evaluateTreeRule=(e,t)=>{const{conditions:n,rules:i}=e,{result:r,referenceRecord:s}=evaluateConditions(n,t);if(r)return evaluateRules(i,{...t,referenceRecord:{...t.referenceRecord,...s}})},evaluateRules=(e,t)=>{for(const n of e)if("endpoint"===n.type){const e=evaluateEndpointRule(n,t);if(e)return e}else if("error"===n.type)evaluateErrorRule(n,t);else{if("tree"!==n.type)throw new EndpointError("Unknown endpoint rule: "+n);{const e=evaluateTreeRule(n,t);if(e)return e}}throw new EndpointError("Rules evaluation failed")},resolveEndpoint=(e,t)=>{const{endpointParams:n,logger:i}=t,{parameters:r,rules:s}=e;t.logger?.debug?.(debugId+" Initial EndpointParams: "+toDebugString(n));const o=Object.entries(r).filter((([,e])=>null!=e.default)).map((([e,t])=>[e,t.default]));if(o.length>0)for(const[e,t]of o)n[e]=n[e]??t;const a=Object.entries(r).filter((([,e])=>e.required)).map((([e])=>e));for(const e of a)if(null==n[e])throw new EndpointError("Missing required parameter: '"+e+"'");const l=evaluateRules(s,{endpointParams:n,logger:i,referenceRecord:{}});return t.logger?.debug?.(debugId+" Resolved endpoint: "+toDebugString(l)),l},isVirtualHostableS3Bucket=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!isVirtualHostableS3Bucket(t))return!1;return!0}return!(!isValidHostLabel(e)||e.length<3||e.length>63||e!==e.toLowerCase()||isIpAddress(e))},parseArn=e=>{const t=e.split(":");if(t.length<6)return null;const[n,i,r,s,o,...a]=t;return"arn"!==n||""===i||""===r||""===a[0]?null:{partition:i,service:r,region:s,accountId:o,resourceId:a[0].includes("/")?a[0].split("/"):a}};var partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],partitionsInfo={partitions:partitions};let selectedPartitionsInfo=partitionsInfo;const partition=e=>{const{partitions:t}=selectedPartitionsInfo;for(const n of t){const{regions:t,outputs:i}=n;for(const[n,r]of Object.entries(t))if(n===e)return{...i,...r}}for(const n of t){const{regionRegex:t,outputs:i}=n;if(new RegExp(t).test(e))return{...i}}const n=t.find((e=>"aws"===e.id));if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}},awsEndpointFunctions={isVirtualHostableS3Bucket:isVirtualHostableS3Bucket,parseArn:parseArn,partition:partition};customEndpointFunctions.aws=awsEndpointFunctions;const USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,UA_VALUE_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,UA_ESCAPE_CHAR="-",userAgentMiddleware=e=>(t,n)=>async i=>{const{request:r}=i;if(!HttpRequest.isInstance(r))return t(i);const{headers:s}=r,o=n?.userAgent?.map(escapeUserAgent)||[],a=(await e.defaultUserAgentProvider()).map(escapeUserAgent),l=e?.customUserAgent?.map(escapeUserAgent)||[],c=[].concat([...a,...o,...l]).join(SPACE),d=[...a.filter((e=>e.startsWith("aws-sdk-"))),...l].join(SPACE);return"browser"!==e.runtime?(d&&(s[X_AMZ_USER_AGENT]=s[X_AMZ_USER_AGENT]?s[USER_AGENT]+" "+d:d),s[USER_AGENT]=c):s[X_AMZ_USER_AGENT]=c,t({...i,request:r})},escapeUserAgent=e=>{const t=e[0].split(UA_NAME_SEPARATOR).map((e=>e.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR))).join(UA_NAME_SEPARATOR),n=e[1]?.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),i=t.indexOf(UA_NAME_SEPARATOR),r=t.substring(0,i);let s=t.substring(i+1);return"api"===r&&(s=s.toLowerCase()),[r,s,n].filter((e=>e&&e.length>0)).reduce(((e,t,n)=>{switch(n){case 0:return t;case 1:return e+"/"+t;default:return e+"#"+t}}),"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=e=>({applyToStack:t=>{t.add(userAgentMiddleware(e),getUserAgentMiddlewareOptions)}});var SelectorType;!function(e){e.ENV="env",e.CONFIG="shared config entry"}(SelectorType||(SelectorType={}));const DEFAULT_USE_DUALSTACK_ENDPOINT=!1,DEFAULT_USE_FIPS_ENDPOINT=!1,getSmithyContext=e=>e[SMITHY_CONTEXT_KEY]||(e[SMITHY_CONTEXT_KEY]={}),normalizeProvider$1=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},isFipsRegion=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),getRealRegion=e=>isFipsRegion(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,resolveRegionConfig=e=>{const{region:t,useFipsEndpoint:n}=e;if(!t)throw new Error("Region is missing");return{...e,region:async()=>{if("string"==typeof t)return getRealRegion(t);const e=await t();return getRealRegion(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!isFipsRegion(e)||("function"!=typeof n?Promise.resolve(!!n):n())}}};function convertHttpAuthSchemesToMap(e){const t=new Map;for(const n of e)t.set(n.schemeId,n);return t}const httpAuthSchemeMiddleware=(e,t)=>(n,i)=>async r=>{const s=e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,i,r.input)),o=convertHttpAuthSchemesToMap(e.httpAuthSchemes),a=getSmithyContext(i),l=[];for(const n of s){const r=o.get(n.schemeId);if(!r){l.push("HttpAuthScheme `"+n.schemeId+"` was not enabled for this service.");continue}const s=r.identityProvider(await t.identityProviderConfigProvider(e));if(!s){l.push("HttpAuthScheme `"+n.schemeId+"` did not have an IdentityProvider configured.");continue}const{identityProperties:c={},signingProperties:d={}}=n.propertiesExtractor?.(e,i)||{};n.identityProperties=Object.assign(n.identityProperties||{},c),n.signingProperties=Object.assign(n.signingProperties||{},d),a.selectedHttpAuthScheme={httpAuthOption:n,identity:await s(n.identityProperties),signer:r.signer};break}if(!a.selectedHttpAuthScheme)throw new Error(l.join("\n"));return n(r)},httpAuthSchemeEndpointRuleSetMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},getHttpAuthSchemeEndpointRuleSetPlugin=(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n})=>({applyToStack:i=>{i.addRelativeTo(httpAuthSchemeMiddleware(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:n}),httpAuthSchemeEndpointRuleSetMiddlewareOptions)}}),deserializerMiddleware=(e,t)=>n=>async i=>{const{response:r}=await n(i);try{return{response:r,output:await t(r,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:r}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";e.message+="\n  "+t,void 0!==e.$responseBodyText&&e.$response&&(e.$response.body=e.$responseBodyText)}throw e}},serializerMiddleware=(e,t)=>(n,i)=>async r=>{const s=i.endpointV2?.url&&e.urlParser?async()=>e.urlParser(i.endpointV2.url):e.endpoint;if(!s)throw new Error("No valid endpoint provider available.");const o=await t(r.input,{...e,endpoint:s});return n({...r,request:o})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSerdePlugin(e,t,n){return{applyToStack:i=>{i.add(deserializerMiddleware(e,n),deserializerMiddlewareOption),i.add(serializerMiddleware(e,t),serializerMiddlewareOption)}}}serializerMiddlewareOption.name;const defaultErrorHandler=e=>e=>{throw e},defaultSuccessHandler=(e,t)=>{},httpSigningMiddleware=e=>(e,t)=>async n=>{if(!HttpRequest.isInstance(n.request))return e(n);const i=getSmithyContext(t).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:r={}},identity:s,signer:o}=i,a=await e({...n,request:await o.sign(n.request,s,r)}).catch((o.errorHandler||defaultErrorHandler)(r));return(o.successHandler||defaultSuccessHandler)(a.response,r),a},httpSigningMiddlewareOptions={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},getHttpSigningPlugin=e=>({applyToStack:e=>{e.addRelativeTo(httpSigningMiddleware(),httpSigningMiddlewareOptions)}}),normalizeProvider=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},alphabetByEncoding={},alphabetByValue=new Array(64);for(let e=0,t="A".charCodeAt(0),n="Z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t);alphabetByEncoding[n]=e,alphabetByValue[e]=n}for(let e=0,t="a".charCodeAt(0),n="z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t),i=e+26;alphabetByEncoding[n]=i,alphabetByValue[i]=n}for(let e=0;e<10;e++){alphabetByEncoding[e.toString(10)]=e+52;const t=e.toString(10),n=e+52;alphabetByEncoding[t]=n,alphabetByValue[n]=t}alphabetByEncoding["+"]=62,alphabetByValue[62]="+",alphabetByEncoding["/"]=63,alphabetByValue[63]="/";const bitsPerLetter=6,bitsPerByte=8,maxLetterValue=63,fromBase64=e=>{let t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;const n=new ArrayBuffer(t),i=new DataView(n);for(let t=0;t<e.length;t+=4){let n=0,r=0;for(let i=t,s=t+3;i<=s;i++)if("="!==e[i]){if(!(e[i]in alphabetByEncoding))throw new TypeError("Invalid character "+e[i]+" in base64 string.");n|=alphabetByEncoding[e[i]]<<(s-i)*bitsPerLetter,r+=bitsPerLetter}else n>>=bitsPerLetter;const s=t/4*3;n>>=r%bitsPerByte;const o=Math.floor(r/bitsPerByte);for(let e=0;e<o;e++){const t=(o-e-1)*bitsPerByte;i.setUint8(s+e,(n&255<<t)>>t)}}return new Uint8Array(n)},fromUtf8$2=e=>(new TextEncoder).encode(e),toUint8Array=e=>"string"==typeof e?fromUtf8$2(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),toUtf8=e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};function toBase64(e){let t;t="string"==typeof e?fromUtf8$2(e):e;const n="object"==typeof t&&"number"==typeof t.length,i="object"==typeof t&&"number"==typeof t.byteOffset&&"number"==typeof t.byteLength;if(!n&&!i)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let r="";for(let e=0;e<t.length;e+=3){let n=0,i=0;for(let r=e,s=Math.min(e+3,t.length);r<s;r++)n|=t[r]<<(s-r-1)*bitsPerByte,i+=bitsPerByte;const s=Math.ceil(i/bitsPerLetter);n<<=s*bitsPerLetter-i;for(let e=1;e<=s;e++){const t=(s-e)*bitsPerLetter;r+=alphabetByValue[(n&maxLetterValue<<t)>>t]}r+="==".slice(0,4-s)}return r}function transformToString(e,t="utf-8"){return"base64"===t?toBase64(e):toUtf8(e)}function transformFromString(e,t){return"base64"===t?Uint8ArrayBlobAdapter.mutate(fromBase64(e)):Uint8ArrayBlobAdapter.mutate(fromUtf8$2(e))}class Uint8ArrayBlobAdapter extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return transformFromString(e,t);throw new Error("Unsupported conversion from "+typeof e+" to Uint8ArrayBlobAdapter.")}static mutate(e){return Object.setPrototypeOf(e,Uint8ArrayBlobAdapter.prototype),e}transformToString(e="utf-8"){return transformToString(this,e)}}const escapeUri=e=>encodeURIComponent(e).replace(/[!'()*]/g,hexEncode),hexEncode=e=>"%"+e.charCodeAt(0).toString(16).toUpperCase();function buildQueryString(e){const t=[];for(let n of Object.keys(e).sort()){const i=e[n];if(n=escapeUri(n),Array.isArray(i))for(let e=0,r=i.length;e<r;e++)t.push(n+"="+escapeUri(i[e]));else{let e=n;(i||"string"==typeof i)&&(e+="="+escapeUri(i)),t.push(e)}}return t.join("&")}const SHORT_TO_HEX={},HEX_TO_SHORT={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t="0"+t),SHORT_TO_HEX[e]=t,HEX_TO_SHORT[t]=e}function fromHex(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const i=e.slice(n,n+2).toLowerCase();if(!(i in HEX_TO_SHORT))throw new Error("Cannot decode unrecognized sequence "+i+" as hexadecimal");t[n/2]=HEX_TO_SHORT[i]}return t}function toHex(e){let t="";for(let n=0;n<e.byteLength;n++)t+=SHORT_TO_HEX[e[n]];return t}const collectBody=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Uint8ArrayBlobAdapter.mutate(e);if(!e)return Uint8ArrayBlobAdapter.mutate(new Uint8Array);const n=t.streamCollector(e);return Uint8ArrayBlobAdapter.mutate(await n)};function extendedEncodeURIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}const resolvedPath=(e,t,n,i,r,s)=>{if(null==t||void 0===t[n])throw new Error("No value provided for input HTTP label: "+n+".");{const t=i();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");e=e.replace(r,s?t.split("/").map((e=>extendedEncodeURIComponent(e))).join("/"):extendedEncodeURIComponent(t))}return e};function requestBuilder(e,t){return new RequestBuilder(e,t)}class RequestBuilder{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:t="https",port:n,path:i}=await this.context.endpoint();this.path=i;for(const e of this.resolvePathStack)e(this.path);return new HttpRequest({protocol:t,hostname:this.hostname||e,port:n,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push((t=>{this.path=""+(t?.endsWith("/")?t.slice(0,-1):t||"")+e})),this}p(e,t,n,i){return this.resolvePathStack.push((r=>{this.path=resolvedPath(r,this.input,e,t,n,i)})),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}function setFeature(e,t,n){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=n}class DefaultIdentityProviderConfig{constructor(e){this.authSchemes=new Map;for(const[t,n]of Object.entries(e))void 0!==n&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}}const createIsIdentityExpiredFunction=e=>t=>doesIdentityRequireRefresh(t)&&t.expiration.getTime()-Date.now()<e,EXPIRATION_MS=3e5,isIdentityExpired=createIsIdentityExpiredFunction(EXPIRATION_MS),doesIdentityRequireRefresh=e=>void 0!==e.expiration,memoizeIdentityProvider=(e,t,n)=>{if(void 0===e)return;const i="function"!=typeof e?async()=>Promise.resolve(e):e;let r,s,o,a=!1;const l=async e=>{s||(s=i(e));try{r=await s,o=!0,a=!1}finally{s=void 0}return r};return void 0===t?async e=>(o&&!e?.forceRefresh||(r=await l(e)),r):async e=>(o&&!e?.forceRefresh||(r=await l(e)),a?r:n(r)?t(r)?(await l(e),r):r:(a=!0,r))},resolveEventStreamSerdeConfig=e=>({...e,eventStreamMarshaller:e.eventStreamSerdeProvider(e)}),CONTENT_LENGTH_HEADER="content-length";function contentLengthMiddleware(e){return t=>async n=>{const i=n.request;if(HttpRequest.isInstance(i)){const{body:t,headers:n}=i;if(t&&-1===Object.keys(n).map((e=>e.toLowerCase())).indexOf(CONTENT_LENGTH_HEADER))try{const n=e(t);i.headers={...i.headers,[CONTENT_LENGTH_HEADER]:String(n)}}catch(e){}}return t({...n,request:i})}}const contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=e=>({applyToStack:t=>{t.add(contentLengthMiddleware(e.bodyLengthChecker),contentLengthMiddlewareOptions)}}),resolveParamsForS3=async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),isArnBucketName(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!isDnsCompatibleBucketName(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=e=>DOMAIN_PATTERN.test(e)&&!IP_ADDRESS_PATTERN.test(e)&&!DOTS_PATTERN.test(e),isArnBucketName=e=>{const[t,n,i,,,r]=e.split(":"),s="arn"===t&&e.split(":").length>=6,o=Boolean(s&&n&&i&&r);if(s&&!o)throw new Error("Invalid ARN: "+e+" was an invalid ARN.");return o},createConfigValueProvider=(e,t,n)=>{const i=async()=>{const i=n[e]??n[t];return"function"==typeof i?i():i};return"credentialScope"===e||"CredentialScope"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.credentialScope??e?.CredentialScope}:"accountId"===e||"AccountId"===t?async()=>{const e="function"==typeof n.credentials?await n.credentials():n.credentials;return e?.accountId??e?.AccountId}:"endpoint"===e||"endpoint"===t?async()=>{const e=await i();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:n,port:i,path:r}=e;return t+"//"+n+(i?":"+i:"")+r}}return e}:i},getEndpointFromConfig=async e=>{};function parseQueryString(e){const t={};if(e=e.replace(/^\?/,""))for(const n of e.split("&")){let[e,i=null]=n.split("=");e=decodeURIComponent(e),i&&(i=decodeURIComponent(i)),e in t?Array.isArray(t[e])?t[e].push(i):t[e]=[t[e],i]:t[e]=i}return t}const parseUrl=e=>{if("string"==typeof e)return parseUrl(new URL(e));const{hostname:t,pathname:n,port:i,protocol:r,search:s}=e;let o;return s&&(o=parseQueryString(s)),{hostname:t,port:i?parseInt(i):void 0,protocol:r,path:n,query:o}},toEndpointV1=e=>"object"==typeof e?"url"in e?parseUrl(e.url):e:parseUrl(e),getEndpointFromInstructions=async(e,t,n,i)=>{if(!n.endpoint){let e;e=n.serviceConfiguredEndpoint?await n.serviceConfiguredEndpoint():await getEndpointFromConfig(n.serviceId),e&&(n.endpoint=()=>Promise.resolve(toEndpointV1(e)))}const r=await resolveParams(e,t,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(r,i)},resolveParams=async(e,t,n)=>{const i={},r=t?.getEndpointParameterInstructions?.()||{};for(const[t,s]of Object.entries(r))switch(s.type){case"staticContextParams":i[t]=s.value;break;case"contextParams":i[t]=e[s.name];break;case"clientContextParams":case"builtInParams":i[t]=await createConfigValueProvider(s.name,t,n)();break;case"operationContextParams":i[t]=s.get(e);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return 0===Object.keys(r).length&&Object.assign(i,n),"s3"===String(n.serviceId).toLowerCase()&&await resolveParamsForS3(i),i},endpointMiddleware=({config:e,instructions:t})=>(n,i)=>async r=>{e.endpoint&&setFeature(i,"ENDPOINT_OVERRIDE","N");const s=await getEndpointFromInstructions(r.input,{getEndpointParameterInstructions:()=>t},{...e},i);i.endpointV2=s,i.authSchemes=s.properties?.authSchemes;const o=i.authSchemes?.[0];if(o){i.signing_region=o.signingRegion,i.signing_service=o.signingName;const e=getSmithyContext(i),t=e?.selectedHttpAuthScheme?.httpAuthOption;t&&(t.signingProperties=Object.assign(t.signingProperties||{},{signing_region:o.signingRegion,signingRegion:o.signingRegion,signing_service:o.signingName,signingName:o.signingName,signingRegionSet:o.signingRegionSet},o.properties))}return n({...r})},endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:serializerMiddlewareOption.name},getEndpointPlugin=(e,t)=>({applyToStack:n=>{n.addRelativeTo(endpointMiddleware({config:e,instructions:t}),endpointMiddlewareOptions)}}),resolveEndpointConfig=e=>{const t=e.tls??!0,{endpoint:n}=e,i=null!=n?async()=>toEndpointV1(await normalizeProvider$1(n)()):void 0,r=!!n,s={...e,endpoint:i,tls:t,isCustomEndpoint:r,useDualstackEndpoint:normalizeProvider$1(e.useDualstackEndpoint??!1),useFipsEndpoint:normalizeProvider$1(e.useFipsEndpoint??!1)};let o;return s.serviceConfiguredEndpoint=async()=>(e.serviceId&&!o&&(o=getEndpointFromConfig(e.serviceId)),o),s};var RETRY_MODES;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(RETRY_MODES||(RETRY_MODES={}));const DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=RETRY_MODES.STANDARD,THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],isClockSkewCorrectedError=e=>e.$metadata?.clockSkewCorrected,isThrottlingError=e=>429===e.$metadata?.httpStatusCode||THROTTLING_ERROR_CODES.includes(e.name)||1==e.$retryable?.throttling,isTransientError=(e,t=0)=>isClockSkewCorrectedError(e)||TRANSIENT_ERROR_CODES.includes(e.name)||NODEJS_TIMEOUT_ERROR_CODES.includes(e?.code||"")||TRANSIENT_ERROR_STATUS_CODES.includes(e.$metadata?.httpStatusCode||0)||void 0!==e.cause&&t<=10&&isTransientError(e.cause,t+1),isServerError=e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!isTransientError(e)}return!1};class DefaultRateLimiter{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise((e=>DefaultRateLimiter.setTimeoutFn(e,t)))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),isThrottlingError(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}DefaultRateLimiter.setTimeoutFn=setTimeout;const DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=2e4,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let e=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:t=>Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}},createDefaultRetryToken=({retryDelay:e,retryCount:t,retryCost:n})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,e),getRetryCost:()=>n});class StandardRetryStrategy{constructor(e){this.maxAttempts=e,this.mode=RETRY_MODES.STANDARD,this.capacity=INITIAL_RETRY_TOKENS,this.retryBackoffStrategy=getDefaultRetryBackoffStrategy(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry(e,t){const n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){const n=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===n?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);const i=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),r=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,i):i,s=this.getCapacityCost(n);return this.capacity-=s,createDefaultRetryToken({retryDelay:r,retryCount:e.getRetryCount()+1,retryCost:s})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+(e.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of "+DEFAULT_MAX_ATTEMPTS),DEFAULT_MAX_ATTEMPTS}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class AdaptiveRetryStrategy{constructor(e,t){this.maxAttemptsProvider=e,this.mode=RETRY_MODES.ADAPTIVE;const{rateLimiter:n}=t??{};this.rateLimiter=n??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let getRandomValues$1;const rnds8$1=new Uint8Array(16);function rng$1(){if(!getRandomValues$1&&(getRandomValues$1="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues$1))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues$1(rnds8$1)}const byteToHex$1=[];for(let e=0;e<256;++e)byteToHex$1.push((e+256).toString(16).slice(1));function unsafeStringify$1(e,t=0){return byteToHex$1[e[t+0]]+byteToHex$1[e[t+1]]+byteToHex$1[e[t+2]]+byteToHex$1[e[t+3]]+"-"+byteToHex$1[e[t+4]]+byteToHex$1[e[t+5]]+"-"+byteToHex$1[e[t+6]]+byteToHex$1[e[t+7]]+"-"+byteToHex$1[e[t+8]]+byteToHex$1[e[t+9]]+"-"+byteToHex$1[e[t+10]]+byteToHex$1[e[t+11]]+byteToHex$1[e[t+12]]+byteToHex$1[e[t+13]]+byteToHex$1[e[t+14]]+byteToHex$1[e[t+15]]}const randomUUID$1="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native$2={randomUUID:randomUUID$1};function v4$1(e,t,n){if(native$2.randomUUID&&!e)return native$2.randomUUID();const i=(e=e||{}).random||(e.rng||rng$1)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,unsafeStringify$1(i)}const asSdkError=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):"string"==typeof e?new Error(e):new Error("AWS SDK error wrapper for "+e),resolveRetryConfig=e=>{const{retryStrategy:t}=e,n=normalizeProvider$1(e.maxAttempts??DEFAULT_MAX_ATTEMPTS);return{...e,maxAttempts:n,retryStrategy:async()=>t||(await normalizeProvider$1(e.retryMode)()===RETRY_MODES.ADAPTIVE?new AdaptiveRetryStrategy(n):new StandardRetryStrategy(n))}},getAllAliases=(e,t)=>{const n=[];if(e&&n.push(e),t)for(const e of t)n.push(e);return n},getMiddlewareNameWithAliases=(e,t)=>(e||"anonymous")+(t&&t.length>0?" (a.k.a. "+t.join(",")+")":""),constructStack=()=>{let e=[],t=[],n=!1;const i=new Set,r=n=>(e.forEach((e=>{n.add(e.middleware,{...e})})),t.forEach((e=>{n.addRelativeTo(e.middleware,{...e})})),n.identifyOnResolve?.(a.identifyOnResolve()),n),s=e=>{const t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...s(e))})),t},o=(n=!1)=>{const i=[],r=[],o={};e.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))o[e]=t;i.push(t)})),t.forEach((e=>{const t={...e,before:[],after:[]};for(const e of getAllAliases(t.name,t.aliases))o[e]=t;r.push(t)})),r.forEach((e=>{if(e.toMiddleware){const t=o[e.toMiddleware];if(void 0===t){if(n)return;throw new Error(e.toMiddleware+" is not found when adding "+getMiddlewareNameWithAliases(e.name,e.aliases)+" middleware "+e.relation+" "+e.toMiddleware)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));var a;return(a=i,a.sort(((e,t)=>stepWeights[t.step]-stepWeights[e.step]||priorityWeights[t.priority||"normal"]-priorityWeights[e.priority||"normal"]))).map(s).reduce(((e,t)=>(e.push(...t),e)),[])},a={add:(t,n={})=>{const{name:r,override:s,aliases:o}=n,a={step:"initialize",priority:"normal",middleware:t,...n},l=getAllAliases(r,o);if(l.length>0){if(l.some((e=>i.has(e)))){if(!s)throw new Error("Duplicate middleware name '"+getMiddlewareNameWithAliases(r,o)+"'");for(const t of l){const n=e.findIndex((e=>e.name===t||e.aliases?.some((e=>e===t))));if(-1===n)continue;const i=e[n];if(i.step!==a.step||a.priority!==i.priority)throw new Error('"'+getMiddlewareNameWithAliases(i.name,i.aliases)+'" middleware with '+i.priority+" priority in "+i.step+' step cannot be overridden by "'+getMiddlewareNameWithAliases(r,o)+'" middleware with '+a.priority+" priority in "+a.step+" step.");e.splice(n,1)}}for(const e of l)i.add(e)}e.push(a)},addRelativeTo:(e,n)=>{const{name:r,override:s,aliases:o}=n,a={middleware:e,...n},l=getAllAliases(r,o);if(l.length>0){if(l.some((e=>i.has(e)))){if(!s)throw new Error("Duplicate middleware name '"+getMiddlewareNameWithAliases(r,o)+"'");for(const e of l){const n=t.findIndex((t=>t.name===e||t.aliases?.some((t=>t===e))));if(-1===n)continue;const i=t[n];if(i.toMiddleware!==a.toMiddleware||i.relation!==a.relation)throw new Error('"'+getMiddlewareNameWithAliases(i.name,i.aliases)+'" middleware '+i.relation+' "'+i.toMiddleware+'" middleware cannot be overridden by "'+getMiddlewareNameWithAliases(r,o)+'" middleware '+a.relation+' "'+a.toMiddleware+'" middleware.');t.splice(n,1)}}for(const e of l)i.add(e)}t.push(a)},clone:()=>r(constructStack()),use:e=>{e.applyToStack(a)},remove:n=>"string"==typeof n?(n=>{let r=!1;const s=e=>{const t=getAllAliases(e.name,e.aliases);if(t.includes(n)){r=!0;for(const e of t)i.delete(e);return!1}return!0};return e=e.filter(s),t=t.filter(s),r})(n):(n=>{let r=!1;const s=e=>{if(e.middleware===n){r=!0;for(const t of getAllAliases(e.name,e.aliases))i.delete(t);return!1}return!0};return e=e.filter(s),t=t.filter(s),r})(n),removeByTag:n=>{let r=!1;const s=e=>{const{tags:t,name:s,aliases:o}=e;if(t&&t.includes(n)){const e=getAllAliases(s,o);for(const t of e)i.delete(t);return r=!0,!1}return!0};return e=e.filter(s),t=t.filter(s),r},concat:e=>{const t=r(constructStack());return t.use(e),t.identifyOnResolve(n||t.identifyOnResolve()||(e.identifyOnResolve?.()??!1)),t},applyToStack:r,identify:()=>o(!0).map((e=>{const t=e.step??e.relation+" "+e.toMiddleware;return getMiddlewareNameWithAliases(e.name,e.aliases)+" - "+t})),identifyOnResolve:e=>("boolean"==typeof e&&(n=e),n),resolve:(e,t)=>{for(const n of o().map((e=>e.middleware)).reverse())e=n(e,t);return n&&console.log(a.identify()),e}};return a},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};class Client{constructor(e){this.config=e,this.middlewareStack=constructStack()}send(e,t,n){const i="function"!=typeof t?t:void 0,r="function"==typeof t?t:n;let s;if(void 0===i&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);const t=this.handlers;t.has(e.constructor)?s=t.get(e.constructor):(s=e.resolveMiddleware(this.middlewareStack,this.config,i),t.set(e.constructor,s))}else delete this.handlers,s=e.resolveMiddleware(this.middlewareStack,this.config,i);if(!r)return s(e).then((e=>e.output));s(e).then((e=>r(null,e.output)),(e=>r(e))).catch((()=>{}))}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}class Command{constructor(){this.middlewareStack=constructStack()}static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext(e,t,n,{middlewareFn:i,clientName:r,commandName:s,inputFilterSensitiveLog:o,outputFilterSensitiveLog:a,smithyContext:l,additionalContext:c,CommandCtor:d}){for(const r of i.bind(this)(d,e,t,n))this.middlewareStack.use(r);const u=e.concat(this.middlewareStack),{logger:h}=t,m={logger:h,clientName:r,commandName:s,inputFilterSensitiveLog:o,outputFilterSensitiveLog:a,[SMITHY_CONTEXT_KEY]:{commandInstance:this,...l},...c},{requestHandler:g}=t;return u.resolve((e=>g.handle(e.request,n||{})),m)}}class ClassBuilder{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,n={}){return this._smithyContext={service:e,operation:t,...n},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=e=>e,t=e=>e){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){const e=this;let t;return t=class extends Command{static getEndpointParameterInstructions(){return e._ep}constructor(...[t]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=t??{},e._init(this)}resolveMiddleware(n,i,r){return this.resolveMiddlewareWithContext(n,i,r,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const SENSITIVE_STRING="***SensitiveInformation***",expectLong=e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError("Expected integer, got "+typeof e+": "+e)}},expectInt32=e=>expectSizedInt(e,32),expectSizedInt=(e,t)=>{const n=expectLong(e);if(void 0!==n&&castInt(n,t)!==n)throw new TypeError("Expected "+t+"-bit integer, got "+e);return n},castInt=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},expectString=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return logger.warn(stackTraceWarning("Expected string, got "+typeof e+": "+e)),String(e);throw new TypeError("Expected string, got "+typeof e+": "+e)}},stackTraceWarning=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),logger={warn:console.warn};class ServiceException extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,ServiceException.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}static isInstance(e){if(!e)return!1;const t=e;return Boolean(t.$fault)&&Boolean(t.$metadata)&&("client"===t.$fault||"server"===t.$fault)}}const decorateServiceException=(e,t={})=>{Object.entries(t).filter((([,e])=>void 0!==e)).forEach((([t,n])=>{null!=e[t]&&""!==e[t]||(e[t]=n)}));const n=e.message||e.Message||"UnknownError";return e.message=n,delete e.Message,e},throwDefaultError$1=({output:e,parsedBody:t,exceptionCtor:n,errorCode:i})=>{const r=deserializeMetadata$1(e),s=r.httpStatusCode?r.httpStatusCode+"":void 0,o=new n({name:t?.code||t?.Code||i||s||"UnknownError",$fault:"client",$metadata:r});throw decorateServiceException(o,t)},withBaseException=e=>({output:t,parsedBody:n,errorCode:i})=>{throwDefaultError$1({output:t,parsedBody:n,exceptionCtor:e,errorCode:i})},deserializeMetadata$1=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),loadConfigsForDefaultMode=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},getChecksumConfiguration=e=>{const t=[];for(const n in AlgorithmId){const i=AlgorithmId[n];void 0!==e[i]&&t.push({algorithmId:()=>i,checksumConstructor:()=>e[i]})}return{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},resolveChecksumRuntimeConfig=e=>{const t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t},getRetryConfiguration=e=>{let t=e.retryStrategy;return{setRetryStrategy(e){t=e},retryStrategy:()=>t}},resolveRetryRuntimeConfig=e=>{const t={};return t.retryStrategy=e.retryStrategy(),t},getDefaultExtensionConfiguration=e=>({...getChecksumConfiguration(e),...getRetryConfiguration(e)}),resolveDefaultRuntimeConfig=e=>({...resolveChecksumRuntimeConfig(e),...resolveRetryRuntimeConfig(e)});class NoOpLogger{trace(){}debug(){}info(){}warn(){}error(){}}function map$1(e,t,n){let i,r,s;if(void 0===t&&void 0===n)i={},s=e;else{if(i=e,"function"==typeof t)return r=t,s=n,mapWithFilter(i,r,s);s=t}for(const e of Object.keys(s))Array.isArray(s[e])?applyInstruction(i,null,s,e):i[e]=s[e];return i}const take=(e,t)=>{const n={};for(const i in t)applyInstruction(n,e,t,i);return n},mapWithFilter=(e,t,n)=>map$1(e,Object.entries(n).reduce(((e,[n,i])=>(Array.isArray(i)?e[n]=i:e[n]="function"==typeof i?[t,i()]:[t,i],e)),{})),applyInstruction=(e,t,n,i)=>{if(null!==t){let r=n[i];"function"==typeof r&&(r=[,r]);const[s=nonNullish,o=pass,a=i]=r;return void(("function"==typeof s&&s(t[a])||"function"!=typeof s&&s)&&(e[i]=o(t[a])))}let[r,s]=n[i];if("function"==typeof s){let t;const n=void 0===r&&null!=(t=s()),o="function"==typeof r&&!!r(void 0)||"function"!=typeof r&&!!r;n?e[i]=t:o&&(e[i]=s())}else{const t=void 0===r&&null!=s,n="function"==typeof r&&!!r(s)||"function"!=typeof r&&!!r;(t||n)&&(e[i]=s)}},nonNullish=e=>null!=e,pass=e=>e,isStreamingPayload=e=>e?.body instanceof ReadableStream,retryMiddleware=e=>(t,n)=>async i=>{let r=await e.retryStrategy();const s=await e.maxAttempts();if(!isRetryStrategyV2(r))return r?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(t,i);{let e=await r.acquireInitialRetryToken(n.partition_id),o=new Error,a=0,l=0;const{request:c}=i,d=HttpRequest.isInstance(c);for(d&&(c.headers[INVOCATION_ID_HEADER]=v4$1());;)try{d&&(c.headers[REQUEST_HEADER]="attempt="+(a+1)+"; max="+s);const{response:n,output:o}=await t(i);return r.recordSuccess(e),o.$metadata.attempts=a+1,o.$metadata.totalRetryDelay=l,{response:n,output:o}}catch(t){const i=getRetryErrorInfo(t);if(o=asSdkError(t),d&&isStreamingPayload(c))throw(n.logger instanceof NoOpLogger?console:n.logger)?.warn("An error was encountered in a non-retryable streaming request."),o;try{e=await r.refreshRetryTokenForRetry(e,i)}catch(e){throw o.$metadata||(o.$metadata={}),o.$metadata.attempts=a+1,o.$metadata.totalRetryDelay=l,o}a=e.getRetryCount();const s=e.getRetryDelay();l+=s,await new Promise((e=>setTimeout(e,s)))}}},isRetryStrategyV2=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,getRetryErrorInfo=e=>{const t={error:e,errorType:getRetryErrorType(e)},n=getRetryAfterHint(e.$response);return n&&(t.retryAfterHint=n),t},getRetryErrorType=e=>isThrottlingError(e)?"THROTTLING":isTransientError(e)?"TRANSIENT":isServerError(e)?"SERVER_ERROR":"CLIENT_ERROR",retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=e=>({applyToStack:t=>{t.add(retryMiddleware(e),retryMiddlewareOptions)}}),getRetryAfterHint=e=>{if(!HttpResponse.isInstance(e))return;const t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(!t)return;const n=e.headers[t],i=Number(n);return Number.isNaN(i)?new Date(n):new Date(1e3*i)},getDateHeader=e=>HttpResponse.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,getSkewCorrectedDate=e=>new Date(Date.now()+e),isClockSkewed=(e,t)=>Math.abs(getSkewCorrectedDate(t).getTime()-e)>=3e5,getUpdatedSystemClockOffset=(e,t)=>{const n=Date.parse(e);return isClockSkewed(n,t)?n-Date.now():t},throwSigningPropertyError=(e,t)=>{if(!t)throw new Error("Property `"+e+"` is not resolved for AWS SDK SigV4Auth");return t},validateSigningProperties=async e=>{const t=throwSigningPropertyError("context",e.context),n=throwSigningPropertyError("config",e.config),i=t.endpointV2?.properties?.authSchemes?.[0],r=throwSigningPropertyError("signer",n.signer),s=await r(i),o=e?.signingRegion,a=e?.signingName;return{config:n,signer:s,signingRegion:o,signingName:a}};class AwsSdkSigV4Signer{async sign(e,t,n){if(!HttpRequest.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:i,signer:r,signingRegion:s,signingName:o}=await validateSigningProperties(n);return await r.sign(e,{signingDate:getSkewCorrectedDate(i.systemClockOffset),signingRegion:s,signingService:o})}errorHandler(e){return t=>{const n=t.ServerTime??getDateHeader(t.$response);if(n){const i=throwSigningPropertyError("config",e.config),r=i.systemClockOffset;i.systemClockOffset=getUpdatedSystemClockOffset(n,i.systemClockOffset),i.systemClockOffset!==r&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const n=getDateHeader(e);if(n){const e=throwSigningPropertyError("config",t.config);e.systemClockOffset=getUpdatedSystemClockOffset(n,e.systemClockOffset)}}}const ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=604800,signingKeyCache={},cacheQueue=[],createScope=(e,t,n)=>e+"/"+t+"/"+n+"/"+KEY_TYPE_IDENTIFIER,getSigningKey=async(e,t,n,i,r)=>{const s=n+":"+i+":"+r+":"+toHex(await hmac(e,t.secretAccessKey,t.accessKeyId))+":"+t.sessionToken;if(s in signingKeyCache)return signingKeyCache[s];for(cacheQueue.push(s);cacheQueue.length>MAX_CACHE_SIZE;)delete signingKeyCache[cacheQueue.shift()];let o="AWS4"+t.secretAccessKey;for(const t of[n,i,r,KEY_TYPE_IDENTIFIER])o=await hmac(e,o,t);return signingKeyCache[s]=o},hmac=(e,t,n)=>{const i=new e(t);return i.update(toUint8Array(n)),i.digest()},getCanonicalHeaders=({headers:e},t,n)=>{const i={};for(const r of Object.keys(e).sort()){if(null==e[r])continue;const s=r.toLowerCase();(s in ALWAYS_UNSIGNABLE_HEADERS||t?.has(s)||PROXY_HEADER_PATTERN.test(s)||SEC_HEADER_PATTERN.test(s))&&(!n||n&&!n.has(s))||(i[s]=e[r].trim().replace(/\s+/g," "))}return i},getCanonicalQuery=({query:e={}})=>{const t=[],n={};for(const i of Object.keys(e)){if(i.toLowerCase()===SIGNATURE_HEADER)continue;const r=escapeUri(i);t.push(r);const s=e[i];"string"==typeof s?n[r]=r+"="+escapeUri(s):Array.isArray(s)&&(n[r]=s.slice(0).reduce(((e,t)=>e.concat([r+"="+escapeUri(t)])),[]).sort().join("&"))}return t.sort().map((e=>n[e])).filter((e=>e)).join("&")},isArrayBuffer=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),getPayloadHash=async({headers:e,body:t},n)=>{for(const t of Object.keys(e))if(t.toLowerCase()===SHA256_HEADER)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||isArrayBuffer(t)){const e=new n;return e.update(toUint8Array(t)),toHex(await e.digest())}return UNSIGNED_PAYLOAD};class HeaderFormatter{format(e){const t=[];for(const n of Object.keys(e)){const i=fromUtf8$2(n);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let i=0;for(const e of t)n.set(e,i),i+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(e.value.bytes,1),i;case"binary":const r=new DataView(new ArrayBuffer(3+e.value.byteLength));r.setUint8(0,6),r.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(r.buffer);return s.set(e.value,3),s;case"string":const o=fromUtf8$2(e.value),a=new DataView(new ArrayBuffer(3+o.byteLength));a.setUint8(0,7),a.setUint16(1,o.byteLength,!1);const l=new Uint8Array(a.buffer);return l.set(o,3),l;case"timestamp":const c=new Uint8Array(9);return c[0]=8,c.set(Int64$1.fromNumber(e.value.valueOf()).bytes,1),c;case"uuid":if(!UUID_PATTERN$1.test(e.value))throw new Error("Invalid UUID received: "+e.value);const d=new Uint8Array(17);return d[0]=9,d.set(fromHex(e.value.replace(/\-/g,"")),1),d}}}var HEADER_VALUE_TYPE$1;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(HEADER_VALUE_TYPE$1||(HEADER_VALUE_TYPE$1={}));const UUID_PATTERN$1=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let Int64$1=class e{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>0x8000000000000000||t<-0x8000000000000000)throw new Error(t+" is too large (or, if negative, too small) to represent as an Int64");const n=new Uint8Array(8);for(let e=7,i=Math.abs(Math.round(t));e>-1&&i>0;e--,i/=256)n[e]=i;return t<0&&negate$1(n),new e(n)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&negate$1(e),parseInt(toHex(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function negate$1(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}const hasHeader=(e,t)=>{e=e.toLowerCase();for(const n of Object.keys(t))if(e===n.toLowerCase())return!0;return!1},moveHeadersToQuery=(e,t={})=>{const{headers:n,query:i={}}=HttpRequest.clone(e);for(const e of Object.keys(n)){const r=e.toLowerCase();("x-amz-"===r.slice(0,6)&&!t.unhoistableHeaders?.has(r)||t.hoistableHeaders?.has(r))&&(i[e]=n[e],delete n[e])}return{...e,headers:n,query:i}},prepareRequest=e=>{e=HttpRequest.clone(e);for(const t of Object.keys(e.headers))GENERATED_HEADERS.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},iso8601=e=>toDate(e).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class SignatureV4{constructor({applyChecksum:e,credentials:t,region:n,service:i,sha256:r,uriEscapePath:s=!0}){this.headerFormatter=new HeaderFormatter,this.service=i,this.sha256=r,this.uriEscapePath=s,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=normalizeProvider$1(n),this.credentialProvider=normalizeProvider$1(t)}async presign(e,t={}){const{signingDate:n=new Date,expiresIn:i=3600,unsignableHeaders:r,unhoistableHeaders:s,signableHeaders:o,hoistableHeaders:a,signingRegion:l,signingService:c}=t,d=await this.credentialProvider();this.validateResolvedCredentials(d);const u=l??await this.regionProvider(),{longDate:h,shortDate:m}=formatDate(n);if(i>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const g=createScope(m,u,c??this.service),p=moveHeadersToQuery(prepareRequest(e),{unhoistableHeaders:s,hoistableHeaders:a});d.sessionToken&&(p.query[TOKEN_QUERY_PARAM]=d.sessionToken),p.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,p.query[CREDENTIAL_QUERY_PARAM]=d.accessKeyId+"/"+g,p.query[AMZ_DATE_QUERY_PARAM]=h,p.query[EXPIRES_QUERY_PARAM]=i.toString(10);const f=getCanonicalHeaders(p,r,o);return p.query[SIGNED_HEADERS_QUERY_PARAM]=getCanonicalHeaderList(f),p.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(h,g,this.getSigningKey(d,u,m,c),this.createCanonicalRequest(p,f,await getPayloadHash(e,this.sha256))),p}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:n=new Date,priorSignature:i,signingRegion:r,signingService:s}){const o=r??await this.regionProvider(),{shortDate:a,longDate:l}=formatDate(n),c=createScope(a,o,s??this.service),d=await getPayloadHash({headers:{},body:t},this.sha256),u=new this.sha256;u.update(e);const h=toHex(await u.digest()),m=[EVENT_ALGORITHM_IDENTIFIER,l,c,i,h,d].join("\n");return this.signString(m,{signingDate:n,signingRegion:o,signingService:s})}async signMessage(e,{signingDate:t=new Date,signingRegion:n,signingService:i}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:n,signingService:i,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}async signString(e,{signingDate:t=new Date,signingRegion:n,signingService:i}={}){const r=await this.credentialProvider();this.validateResolvedCredentials(r);const s=n??await this.regionProvider(),{shortDate:o}=formatDate(t),a=new this.sha256(await this.getSigningKey(r,s,o,i));return a.update(toUint8Array(e)),toHex(await a.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:n,unsignableHeaders:i,signingRegion:r,signingService:s}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const a=r??await this.regionProvider(),l=prepareRequest(e),{longDate:c,shortDate:d}=formatDate(t),u=createScope(d,a,s??this.service);l.headers[AMZ_DATE_HEADER]=c,o.sessionToken&&(l.headers[TOKEN_HEADER]=o.sessionToken);const h=await getPayloadHash(l,this.sha256);!hasHeader(SHA256_HEADER,l.headers)&&this.applyChecksum&&(l.headers[SHA256_HEADER]=h);const m=getCanonicalHeaders(l,i,n),g=await this.getSignature(c,u,this.getSigningKey(o,a,d,s),this.createCanonicalRequest(l,m,h));return l.headers[AUTH_HEADER]=ALGORITHM_IDENTIFIER+" Credential="+o.accessKeyId+"/"+u+", SignedHeaders="+getCanonicalHeaderList(m)+", Signature="+g,l}createCanonicalRequest(e,t,n){const i=Object.keys(t).sort();return e.method+"\n"+this.getCanonicalPath(e)+"\n"+getCanonicalQuery(e)+"\n"+i.map((e=>e+":"+t[e])).join("\n")+"\n\n"+i.join(";")+"\n"+n}async createStringToSign(e,t,n){const i=new this.sha256;i.update(toUint8Array(n));const r=await i.digest();return ALGORITHM_IDENTIFIER+"\n"+e+"\n"+t+"\n"+toHex(r)}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const n of e.split("/"))0!==n?.length&&"."!==n&&(".."===n?t.pop():t.push(n));const n=(e?.startsWith("/")?"/":"")+t.join("/")+(t.length>0&&e?.endsWith("/")?"/":"");return escapeUri(n).replace(/%2F/g,"/")}return e}async getSignature(e,t,n,i){const r=await this.createStringToSign(e,t,i),s=new this.sha256(await n);return s.update(toUint8Array(r)),toHex(await s.digest())}getSigningKey(e,t,n,i){return getSigningKey(this.sha256,e,n,t,i||this.service)}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}const formatDate=e=>{const t=iso8601(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.slice(0,8)}},getCanonicalHeaderList=e=>Object.keys(e).sort().join(";"),resolveAwsSdkSigV4Config=e=>{let t;e.credentials&&(t=memoizeIdentityProvider(e.credentials,isIdentityExpired,doesIdentityRequireRefresh)),t||(t=e.credentialDefaultProvider?normalizeProvider(e.credentialDefaultProvider(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("`credentials` is missing")});const{signingEscapePath:n=!0,systemClockOffset:i=e.systemClockOffset||0,sha256:r}=e;let s;return s=e.signer?normalizeProvider(e.signer):e.regionInfoProvider?()=>normalizeProvider(e.region)().then((async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t])).then((([i,s])=>{const{signingRegion:o,signingService:a}=i;e.signingRegion=e.signingRegion||o||s,e.signingName=e.signingName||a||e.serviceId;const l={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:n};return new(e.signerConstructor||SignatureV4)(l)})):async i=>{const s=(i=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await normalizeProvider(e.region)(),properties:{}},i)).signingRegion,o=i.signingName;e.signingRegion=e.signingRegion||s,e.signingName=e.signingName||o||e.serviceId;const a={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:r,uriEscapePath:n};return new(e.signerConstructor||SignatureV4)(a)},{...e,systemClockOffset:i,signingEscapePath:n,credentials:t,signer:s}},collectBodyString=(e,t)=>collectBody(e,t).then((e=>t.utf8Encoder(e))),parseJsonBody=(e,t)=>collectBodyString(e,t).then((e=>{if(e.length)try{return JSON.parse(e)}catch(t){throw"SyntaxError"===t?.name&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}return{}})),parseJsonErrorBody=async(e,t)=>{const n=await parseJsonBody(e,t);return n.message=n.message??n.Message,n},loadRestJsonErrorCode=(e,t)=>{const n=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},i=(r=e.headers,Object.keys(r).find((e=>e.toLowerCase()==="x-amzn-errortype".toLowerCase())));var r;return void 0!==i?n(e.headers[i]):void 0!==t.code?n(t.code):void 0!==t.__type?n(t.__type):void 0},defaultBedrockRuntimeHttpAuthSchemeParametersProvider=async(e,t,n)=>({operation:getSmithyContext(t).operation,region:await normalizeProvider$1(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function createAwsAuthSigv4HttpAuthOption(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}const defaultBedrockRuntimeHttpAuthSchemeProvider=e=>{const t=[];return e.operation,t.push(createAwsAuthSigv4HttpAuthOption(e)),t},resolveHttpAuthSchemeConfig=e=>({...resolveAwsSdkSigV4Config(e)}),resolveClientEndpointParameters=e=>({...e,useDualstackEndpoint:e.useDualstackEndpoint??!1,useFipsEndpoint:e.useFipsEndpoint??!1,defaultSigningName:"bedrock"}),commonParams={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var version$2="3.621.0",packageInfo={version:version$2};const fromUtf8$1=e=>(new TextEncoder).encode(e);var fromUtf8="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:fromUtf8$1;function convertToBuffer(e){return e instanceof Uint8Array?e:"string"==typeof e?fromUtf8(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function isEmptyData(e){return"string"==typeof e?0===e.length:0===e.byteLength}function uint32ArrayFrom(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)}var SHA_256_HASH={name:"SHA-256"},SHA_256_HMAC_ALGO={name:"HMAC",hash:SHA_256_HASH},EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const fallbackWindow={};function locateWindow(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:fallbackWindow}var Sha256$2=function(){function e(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return e.prototype.update=function(e){if(!isEmptyData(e)){var t=convertToBuffer(e),n=new Uint8Array(this.toHash.byteLength+t.byteLength);n.set(this.toHash,0),n.set(t,this.toHash.byteLength),this.toHash=n}},e.prototype.digest=function(){var e=this;return this.key?this.key.then((function(t){return locateWindow().crypto.subtle.sign(SHA_256_HMAC_ALGO,t,e.toHash).then((function(e){return new Uint8Array(e)}))})):isEmptyData(this.toHash)?Promise.resolve(EMPTY_DATA_SHA_256):Promise.resolve().then((function(){return locateWindow().crypto.subtle.digest(SHA_256_HASH,e.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},e.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&void 0!==this.secret&&(this.key=new Promise((function(t,n){locateWindow().crypto.subtle.importKey("raw",convertToBuffer(e.secret),SHA_256_HMAC_ALGO,!1,["sign"]).then(t,n)})),this.key.catch((function(){})))},e}();function __awaiter(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}function __generator(e,t){var n,i,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var BLOCK_SIZE=64,DIGEST_LENGTH=32,KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],MAX_HASHABLE_LENGTH=Math.pow(2,53)-1,RawSha256=function(){function e(){this.state=Int32Array.from(INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%BLOCK_SIZE>=BLOCK_SIZE-8){for(var i=this.bufferLength;i<BLOCK_SIZE;i++)t.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(i=this.bufferLength;i<BLOCK_SIZE-8;i++)t.setUint8(i,0);t.setUint32(BLOCK_SIZE-8,Math.floor(e/4294967296),!0),t.setUint32(BLOCK_SIZE-4,e),this.hashBuffer(),this.finished=!0}var r=new Uint8Array(DIGEST_LENGTH);for(i=0;i<8;i++)r[4*i]=this.state[i]>>>24&255,r[4*i+1]=this.state[i]>>>16&255,r[4*i+2]=this.state[i]>>>8&255,r[4*i+3]=this.state[i]>>>0&255;return r},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=0;d<BLOCK_SIZE;d++){if(d<16)this.temp[d]=(255&e[4*d])<<24|(255&e[4*d+1])<<16|(255&e[4*d+2])<<8|255&e[4*d+3];else{var u=this.temp[d-2],h=(u>>>17|u<<15)^(u>>>19|u<<13)^u>>>10,m=((u=this.temp[d-15])>>>7|u<<25)^(u>>>18|u<<14)^u>>>3;this.temp[d]=(h+this.temp[d-7]|0)+(m+this.temp[d-16]|0)}var g=(((o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7))+(o&a^~o&l)|0)+(c+(KEY[d]+this.temp[d]|0)|0)|0,p=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&i^n&r^i&r)|0;c=l,l=a,a=o,o=s+g|0,s=r,r=i,i=n,n=g+p|0}t[0]+=n,t[1]+=i,t[2]+=r,t[3]+=s,t[4]+=o,t[5]+=a,t[6]+=l,t[7]+=c},e}(),Sha256$1=function(){function e(e){this.secret=e,this.hash=new RawSha256,this.reset()}return e.prototype.update=function(e){if(!isEmptyData(e)&&!this.error)try{this.hash.update(convertToBuffer(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new RawSha256,this.secret){this.outer=new RawSha256;var e=bufferFromSecret(this.secret),t=new Uint8Array(BLOCK_SIZE);t.set(e);for(var n=0;n<BLOCK_SIZE;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();function bufferFromSecret(e){var t=convertToBuffer(e);if(t.byteLength>BLOCK_SIZE){var n=new RawSha256;n.update(t),t=n.digest()}var i=new Uint8Array(BLOCK_SIZE);return i.set(t),i}var subtleCryptoMethods=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function supportsWebCrypto(e){return!(!supportsSecureRandom(e)||"object"!=typeof e.crypto.subtle)&&supportsSubtleCrypto(e.crypto.subtle)}function supportsSecureRandom(e){return"object"==typeof e&&"object"==typeof e.crypto&&"function"==typeof e.crypto.getRandomValues}function supportsSubtleCrypto(e){return e&&subtleCryptoMethods.every((function(t){return"function"==typeof e[t]}))}var Sha256=function(){function e(e){supportsWebCrypto(locateWindow())?this.hash=new Sha256$2(e):this.hash=new Sha256$1(e)}return e.prototype.update=function(e,t){this.hash.update(convertToBuffer(e))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},es5={exports:{}};es5.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){t.__esModule=!0,t.default=void 0;var i=n(18),r=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,i){void 0===i&&(i=!1);var r=e.getVersionPrecision(t),s=e.getVersionPrecision(n),o=Math.max(r,s),a=0,l=e.map([t,n],(function(t){var n=o-e.getVersionPrecision(t),i=t+new Array(n+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(a=o-Math.min(r,s)),o-=1;o>=a;){if(l[0][o]>l[1][o])return 1;if(l[0][o]===l[1][o]){if(o===a)return 0;o-=1}else if(l[0][o]<l[1][o])return-1}},e.map=function(e,t){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)i.push(t(e[n]));return i},e.find=function(e,t){var n,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,i=e.length;n<i;n+=1){var r=e[n];if(t(r,n))return r}},e.assign=function(e){for(var t,n,i=e,r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,n=s.length;t<n;t+=1)a();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=r,e.exports=t.default},18:function(e,t,n){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(91))&&i.__esModule?i:{default:i},s=n(18);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){}var t,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new r.default(e,t)},e.parse=function(e){return new r.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),n&&o(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,n){t.__esModule=!0,t.default=void 0;var i=l(n(92)),r=l(n(93)),s=l(n(94)),o=l(n(95)),a=l(n(17));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(r.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},i=0,r={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(r[t]=o,s+=1):"object"==typeof o&&(n[t]=o,i+=1)})),i>0){var o=Object.keys(n),l=a.default.find(o,(function(e){return t.isOS(e)}));if(l){var c=this.satisfies(n[l]);if(void 0!==c)return c}var d=a.default.find(o,(function(e){return t.isPlatform(e)}));if(d){var u=this.satisfies(n[d]);if(void 0!==u)return u}}if(s>0){var h=Object.keys(r),m=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==m)return this.compareVersion(r[m])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),r=a.default.getBrowserTypeByAlias(i);return t&&r&&(i=r.toLowerCase()),i===n},t.compareVersion=function(e){var t=[0],n=e,i=!1,r=this.getBrowserVersion();if("string"==typeof r)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(i=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(i=!0,n=e.substr(1)),t.indexOf(a.default.compareVersions(r,n,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=c,e.exports=t.default},92:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=r.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=r.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=r.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=r.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=r.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=r.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=r.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=r.default.getFirstMatch(s,e)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=r.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=r.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=r.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=r.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=r.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=r.default.getFirstMatch(s,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:r.default.getFirstMatch(t,e),version:r.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=r.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=r.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},n=r.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=r.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return n&&(i.versionName=n),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=r.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=r.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:s.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||r.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=r.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=r.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=r.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=r.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,n){t.__esModule=!0,t.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},s=n(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},n=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},n=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},n=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},n=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=o,e.exports=t.default}});var es5Exports=es5.exports;const defaultUserAgent=({serviceId:e,clientVersion:t})=>async()=>{const n="undefined"!=typeof window&&window?.navigator?.userAgent?es5Exports.parse(window.navigator.userAgent):void 0,i=[["aws-sdk-js",t],["ua","2.0"],["os/"+(n?.os?.name||"other"),n?.os?.version],["lang/js"],["md/browser",(n?.browser?.name??"unknown")+"_"+(n?.browser?.version??"unknown")]];return e&&i.push(["api/"+e,t]),i};var Crc32=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,n;try{for(var i=__values(e),r=i.next();!r.done;r=i.next()){var s=r.value;this.checksum=this.checksum>>>8^lookupTable[255&(this.checksum^s)]}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}(),a_lookUpTable=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],lookupTable=uint32ArrayFrom(a_lookUpTable),HEADER_VALUE_TYPE;class Int64{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(e+" is too large (or, if negative, too small) to represent as an Int64");const t=new Uint8Array(8);for(let n=7,i=Math.abs(Math.round(e));n>-1&&i>0;n--,i/=256)t[n]=i;return e<0&&negate(t),new Int64(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&negate(e),parseInt(toHex(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function negate(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class HeaderMarshaller{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const n of Object.keys(e)){const i=this.fromUtf8(n);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let i=0;for(const e of t)n.set(e,i),i+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(e.value.bytes,1),i;case"binary":const r=new DataView(new ArrayBuffer(3+e.value.byteLength));r.setUint8(0,6),r.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(r.buffer);return s.set(e.value,3),s;case"string":const o=this.fromUtf8(e.value),a=new DataView(new ArrayBuffer(3+o.byteLength));a.setUint8(0,7),a.setUint16(1,o.byteLength,!1);const l=new Uint8Array(a.buffer);return l.set(o,3),l;case"timestamp":const c=new Uint8Array(9);return c[0]=8,c.set(Int64.fromNumber(e.value.valueOf()).bytes,1),c;case"uuid":if(!UUID_PATTERN.test(e.value))throw new Error("Invalid UUID received: "+e.value);const d=new Uint8Array(17);return d[0]=9,d.set(fromHex(e.value.replace(/\-/g,"")),1),d}}parse(e){const t={};let n=0;for(;n<e.byteLength;){const i=e.getUint8(n++),r=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,i));switch(n+=i,e.getUint8(n++)){case 0:t[r]={type:BOOLEAN_TAG,value:!0};break;case 1:t[r]={type:BOOLEAN_TAG,value:!1};break;case 2:t[r]={type:BYTE_TAG,value:e.getInt8(n++)};break;case 3:t[r]={type:SHORT_TAG,value:e.getInt16(n,!1)},n+=2;break;case 4:t[r]={type:INT_TAG,value:e.getInt32(n,!1)},n+=4;break;case 5:t[r]={type:LONG_TAG,value:new Int64(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:const i=e.getUint16(n,!1);n+=2,t[r]={type:BINARY_TAG,value:new Uint8Array(e.buffer,e.byteOffset+n,i)},n+=i;break;case 7:const s=e.getUint16(n,!1);n+=2,t[r]={type:STRING_TAG,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s))},n+=s;break;case 8:t[r]={type:TIMESTAMP_TAG,value:new Date(new Int64(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const o=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[r]={type:UUID_TAG,value:toHex(o.subarray(0,4))+"-"+toHex(o.subarray(4,6))+"-"+toHex(o.subarray(6,8))+"-"+toHex(o.subarray(8,10))+"-"+toHex(o.subarray(10))};break;default:throw new Error("Unrecognized header type tag")}}return t}}!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));const BOOLEAN_TAG="boolean",BYTE_TAG="byte",SHORT_TAG="short",INT_TAG="integer",LONG_TAG="long",BINARY_TAG="binary",STRING_TAG="string",TIMESTAMP_TAG="timestamp",UUID_TAG="uuid",UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,PRELUDE_MEMBER_LENGTH=4,PRELUDE_LENGTH=2*PRELUDE_MEMBER_LENGTH,CHECKSUM_LENGTH=4,MINIMUM_MESSAGE_LENGTH=PRELUDE_LENGTH+2*CHECKSUM_LENGTH;function splitMessage({byteLength:e,byteOffset:t,buffer:n}){if(e<MINIMUM_MESSAGE_LENGTH)throw new Error("Provided message too short to accommodate event stream message overhead");const i=new DataView(n,t,e),r=i.getUint32(0,!1);if(e!==r)throw new Error("Reported message length does not match received message length");const s=i.getUint32(PRELUDE_MEMBER_LENGTH,!1),o=i.getUint32(PRELUDE_LENGTH,!1),a=i.getUint32(e-CHECKSUM_LENGTH,!1),l=(new Crc32).update(new Uint8Array(n,t,PRELUDE_LENGTH));if(o!==l.digest())throw new Error("The prelude checksum specified in the message ("+o+") does not match the calculated CRC32 checksum ("+l.digest()+")");if(l.update(new Uint8Array(n,t+PRELUDE_LENGTH,e-(PRELUDE_LENGTH+CHECKSUM_LENGTH))),a!==l.digest())throw new Error("The message checksum ("+l.digest()+") did not match the expected value of "+a);return{headers:new DataView(n,t+PRELUDE_LENGTH+CHECKSUM_LENGTH,s),body:new Uint8Array(n,t+PRELUDE_LENGTH+CHECKSUM_LENGTH+s,r-s-(PRELUDE_LENGTH+CHECKSUM_LENGTH+CHECKSUM_LENGTH))}}class EventStreamCodec{constructor(e,t){this.headerMarshaller=new HeaderMarshaller(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage:()=>e,isEndOfStream:()=>t}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const t=this.isEndOfStream;return{getMessages:()=>e,isEndOfStream:()=>t}}encode({headers:e,body:t}){const n=this.headerMarshaller.format(e),i=n.byteLength+t.byteLength+16,r=new Uint8Array(i),s=new DataView(r.buffer,r.byteOffset,r.byteLength),o=new Crc32;return s.setUint32(0,i,!1),s.setUint32(4,n.byteLength,!1),s.setUint32(8,o.update(r.subarray(0,8)).digest(),!1),r.set(n,12),r.set(t,n.byteLength+12),s.setUint32(i-4,o.update(r.subarray(8,i-4)).digest(),!1),r}decode(e){const{headers:t,body:n}=splitMessage(e);return{headers:this.headerMarshaller.parse(t),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}}class MessageDecoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.decoder.decode(e);yield t}}}class MessageEncoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=this.options.encoder.encode(e);yield t}this.options.includeEndFrame&&(yield new Uint8Array(0))}}class SmithyMessageDecoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=await this.options.deserializer(e);void 0!==t&&(yield t)}}}class SmithyMessageEncoderStream{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.serializer(e);yield t}}}function getChunkedStream(e){let t=0,n=0,i=null,r=null;const s=e=>{if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);t=e,n=4,i=new Uint8Array(e),new DataView(i.buffer).setUint32(0,e,!1)};return{[Symbol.asyncIterator]:async function*(){const o=e[Symbol.asyncIterator]();for(;;){const{value:e,done:a}=await o.next();if(a){if(!t)return;if(t!==n)throw new Error("Truncated event message received.");return void(yield i)}const l=e.length;let c=0;for(;c<l;){if(!i){const t=l-c;r||(r=new Uint8Array(4));const i=Math.min(4-n,t);if(r.set(e.slice(c,c+i),n),n+=i,c+=i,n<4)break;s(new DataView(r.buffer).getUint32(0,!1)),r=null}const o=Math.min(t-n,l-c);i.set(e.slice(c,c+o),n),n+=o,c+=o,t&&t===n&&(yield i,i=null,t=0,n=0)}}}}}function getMessageUnmarshaller(e,t){return async function(n){const{value:i}=n.headers[":message-type"];if("error"===i){const e=new Error(n.headers[":error-message"].value||"UnknownError");throw e.name=n.headers[":error-code"].value,e}if("exception"===i){const i=n.headers[":exception-type"].value,r={[i]:n},s=await e(r);if(s.$unknown){const e=new Error(t(n.body));throw e.name=i,e}throw s[i]}if("event"===i){const t={[n.headers[":event-type"].value]:n},i=await e(t);if(i.$unknown)return;return i}throw Error("Unrecognizable event type: "+n.headers[":event-type"].value)}}let EventStreamMarshaller$1=class{constructor({utf8Encoder:e,utf8Decoder:t}){this.eventStreamCodec=new EventStreamCodec(e,t),this.utfEncoder=e}deserialize(e,t){const n=getChunkedStream(e);return new SmithyMessageDecoderStream({messageStream:new MessageDecoderStream({inputStream:n,decoder:this.eventStreamCodec}),deserializer:getMessageUnmarshaller(t,this.utfEncoder)})}serialize(e,t){return new MessageEncoderStream({messageStream:new SmithyMessageEncoderStream({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const readableStreamtoIterable=e=>({[Symbol.asyncIterator]:async function*(){const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)return;yield n}}finally{t.releaseLock()}}}),iterableToReadableStream=e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const{done:n,value:i}=await t.next();if(n)return e.close();e.enqueue(i)}})};class EventStreamMarshaller{constructor({utf8Encoder:e,utf8Decoder:t}){this.universalMarshaller=new EventStreamMarshaller$1({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){const n=isReadableStream(e)?readableStreamtoIterable(e):e;return this.universalMarshaller.deserialize(n,t)}serialize(e,t){const n=this.universalMarshaller.serialize(e,t);return"function"==typeof ReadableStream?iterableToReadableStream(n):n}}const isReadableStream=e=>"function"==typeof ReadableStream&&e instanceof ReadableStream,eventStreamSerdeProvider=e=>new EventStreamMarshaller(e);function requestTimeout(e=0){return new Promise(((t,n)=>{e&&setTimeout((()=>{const t=new Error("Request did not complete within "+e+" ms");t.name="TimeoutError",n(t)}),e)}))}const keepAliveSupport={supported:void 0};class FetchHttpHandler{static create(e){return"function"==typeof e?.handle?e:new FetchHttpHandler(e)}constructor(e){"function"==typeof e?this.configProvider=e().then((e=>e||{})):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),void 0===keepAliveSupport.supported&&(keepAliveSupport.supported=Boolean("undefined"!=typeof Request&&"keepalive"in new Request("https://[::1]")))}destroy(){}async handle(e,{abortSignal:t}={}){this.config||(this.config=await this.configProvider);const n=this.config.requestTimeout,i=!0===this.config.keepAlive,r=this.config.credentials;if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",Promise.reject(e)}let s=e.path;const o=buildQueryString(e.query||{});o&&(s+="?"+o),e.fragment&&(s+="#"+e.fragment);let a="";(null!=e.username||null!=e.password)&&(a=(e.username??"")+":"+(e.password??"")+"@");const{port:l,method:c}=e,d=e.protocol+"//"+a+e.hostname+(l?":"+l:"")+s,u="GET"===c||"HEAD"===c?void 0:e.body,h={body:u,headers:new Headers(e.headers),method:c,credentials:r};this.config?.cache&&(h.cache=this.config.cache),u&&(h.duplex="half"),"undefined"!=typeof AbortController&&(h.signal=t),keepAliveSupport.supported&&(h.keepalive=i),"function"==typeof this.config.requestInit&&Object.assign(h,this.config.requestInit(e));let m=()=>{};const g=new Request(d,h),p=[fetch(g).then((e=>{const t=e.headers,n={};for(const e of t.entries())n[e[0]]=e[1];return null!=e.body?{response:new HttpResponse({headers:n,reason:e.statusText,statusCode:e.status,body:e.body})}:e.blob().then((t=>({response:new HttpResponse({headers:n,reason:e.statusText,statusCode:e.status,body:t})})))})),requestTimeout(n)];return t&&p.push(new Promise(((e,n)=>{const i=()=>{const e=new Error("Request aborted");e.name="AbortError",n(e)};if("function"==typeof t.addEventListener){const e=t;e.addEventListener("abort",i,{once:!0}),m=()=>e.removeEventListener("abort",i)}else t.onabort=i}))),Promise.race(p).finally(m)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then((n=>(n[e]=t,n)))}httpHandlerConfigs(){return this.config??{}}}const streamCollector=e=>"function"==typeof Blob&&e instanceof Blob?collectBlob(e):collectStream(e);async function collectBlob(e){const t=await readToBase64(e),n=fromBase64(t);return new Uint8Array(n)}async function collectStream(e){const t=[],n=e.getReader();let i=!1,r=0;for(;!i;){const{done:e,value:s}=await n.read();s&&(t.push(s),r+=s.length),i=e}const s=new Uint8Array(r);let o=0;for(const e of t)s.set(e,o),o+=e.length;return s}function readToBase64(e){return new Promise(((t,n)=>{const i=new FileReader;i.onloadend=()=>{if(2!==i.readyState)return n(new Error("Reader aborted too early"));const e=i.result??"",r=e.indexOf(","),s=r>-1?r+1:e.length;t(e.substring(s))},i.onabort=()=>n(new Error("Read aborted")),i.onerror=()=>n(i.error),i.readAsDataURL(e)}))}const invalidProvider=e=>()=>Promise.reject(e),TEXT_ENCODER$1="function"==typeof TextEncoder?new TextEncoder:null,calculateBodyLength=e=>{if("string"==typeof e){if(TEXT_ENCODER$1)return TEXT_ENCODER$1.encode(e).byteLength;let t=e.length;for(let n=t-1;n>=0;n--){const i=e.charCodeAt(n);i>127&&i<=2047?t++:i>2047&&i<=65535&&(t+=2),i>=56320&&i<=57343&&n--}return t}if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;throw new Error("Body Length computation failed for "+e)},s="required",t$1="fn",u="argv",v="ref",a=!0,b="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h={[s]:!1,type:"String"},i$2={[s]:!0,default:!1,type:"Boolean"},j={[v]:"Endpoint"},k={[t$1]:c,[u]:[{[v]:"UseFIPS"},!0]},l={[t$1]:c,[u]:[{[v]:"UseDualStack"},!0]},m={},n={[t$1]:"getAttr",[u]:[{[v]:g},"supportsFIPS"]},o={[t$1]:c,[u]:[!0,{[t$1]:"getAttr",[u]:[{[v]:g},"supportsDualStack"]}]},p=[k],q=[l],r=[{[v]:"Region"}],_data={parameters:{Region:h,UseDualStack:i$2,UseFIPS:i$2,Endpoint:h},rules:[{conditions:[{[t$1]:b,[u]:[j]}],rules:[{conditions:p,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{rules:[{conditions:q,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:j,properties:m,headers:m},type:e}],type:f}],type:f},{rules:[{conditions:[{[t$1]:b,[u]:r}],rules:[{conditions:[{[t$1]:"aws.partition",[u]:r,assign:g}],rules:[{conditions:[k,l],rules:[{conditions:[{[t$1]:c,[u]:[a,n]},o],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:p,rules:[{conditions:[{[t$1]:c,[u]:[n,a]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:q,rules:[{conditions:[o],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}],type:f}]},ruleSet=_data,defaultEndpointResolver=(e,t={})=>resolveEndpoint(ruleSet,{endpointParams:e,logger:t.logger});customEndpointFunctions.aws=awsEndpointFunctions;const getRuntimeConfig$1=e=>({apiVersion:"2023-09-30",base64Decoder:e?.base64Decoder??fromBase64,base64Encoder:e?.base64Encoder??toBase64,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??defaultEndpointResolver,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??defaultBedrockRuntimeHttpAuthSchemeProvider,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new AwsSdkSigV4Signer}],logger:e?.logger??new NoOpLogger,serviceId:e?.serviceId??"Bedrock Runtime",urlParser:e?.urlParser??parseUrl,utf8Decoder:e?.utf8Decoder??fromUtf8$2,utf8Encoder:e?.utf8Encoder??toUtf8}),memoize$2=(e,t,n)=>{let i,r,s,o=!1;return async t=>(s&&!t?.forceRefresh||(i=await(async()=>{r||(r=e());try{i=await r,s=!0,o=!1}finally{r=void 0}return i})()),i)},DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],resolveDefaultsModeConfig=({defaultsMode:e}={})=>memoize$2((async()=>{const t="function"==typeof e?await e():e;switch(t?.toLowerCase()){case"auto":return Promise.resolve(isMobileBrowser()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error('Invalid parameter for "defaultsMode", expect '+DEFAULTS_MODE_OPTIONS.join(", ")+", got "+t)}})),isMobileBrowser=()=>{const e="undefined"!=typeof window&&window?.navigator?.userAgent?es5Exports.parse(window.navigator.userAgent):void 0,t=e?.platform?.type;return"tablet"===t||"mobile"===t},getRuntimeConfig=e=>{const t=resolveDefaultsModeConfig(e),n=()=>t().then(loadConfigsForDefaultMode),i=getRuntimeConfig$1(e);return{...i,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??calculateBodyLength,credentialDefaultProvider:e?.credentialDefaultProvider??(e=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:e?.defaultUserAgentProvider??defaultUserAgent({serviceId:i.serviceId,clientVersion:packageInfo.version}),eventStreamSerdeProvider:e?.eventStreamSerdeProvider??eventStreamSerdeProvider,maxAttempts:e?.maxAttempts??DEFAULT_MAX_ATTEMPTS,region:e?.region??invalidProvider("Region is missing"),requestHandler:FetchHttpHandler.create(e?.requestHandler??n),retryMode:e?.retryMode??(async()=>(await n()).retryMode||DEFAULT_RETRY_MODE),sha256:e?.sha256??Sha256,streamCollector:e?.streamCollector??streamCollector,useDualstackEndpoint:e?.useDualstackEndpoint??(()=>Promise.resolve(DEFAULT_USE_DUALSTACK_ENDPOINT)),useFipsEndpoint:e?.useFipsEndpoint??(()=>Promise.resolve(DEFAULT_USE_FIPS_ENDPOINT))}},getAwsRegionExtensionConfiguration=e=>{let t=async()=>{if(void 0===e.region)throw new Error("Region is missing from runtimeConfig");const t=e.region;return"string"==typeof t?t:t()};return{setRegion(e){t=e},region:()=>t}},resolveAwsRegionExtensionConfiguration=e=>({region:e.region()}),getHttpAuthExtensionConfiguration=e=>{const t=e.httpAuthSchemes;let n=e.httpAuthSchemeProvider,i=e.credentials;return{setHttpAuthScheme(e){const n=t.findIndex((t=>t.schemeId===e.schemeId));-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){i=e},credentials:()=>i}},resolveHttpAuthRuntimeConfig=e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials()}),asPartial=e=>e,resolveRuntimeExtensions=(e,t)=>{const n={...asPartial(getAwsRegionExtensionConfiguration(e)),...asPartial(getDefaultExtensionConfiguration(e)),...asPartial(getHttpHandlerExtensionConfiguration(e)),...asPartial(getHttpAuthExtensionConfiguration(e))};return t.forEach((e=>e.configure(n))),{...e,...resolveAwsRegionExtensionConfiguration(n),...resolveDefaultRuntimeConfig(n),...resolveHttpHandlerRuntimeConfig(n),...resolveHttpAuthRuntimeConfig(n)}};class BedrockRuntimeClient extends Client{constructor(...[e]){const t=getRuntimeConfig(e||{}),n=resolveClientEndpointParameters(t),i=resolveRegionConfig(n),r=resolveUserAgentConfig(resolveHostHeaderConfig(resolveEndpointConfig(i))),s=resolveRetryConfig(r),o=resolveEventStreamSerdeConfig(s),a=resolveHttpAuthSchemeConfig(o),l=resolveRuntimeExtensions(a,e?.extensions||[]);super(l),this.config=l,this.middlewareStack.use(getHostHeaderPlugin(this.config)),this.middlewareStack.use(getLoggerPlugin(this.config)),this.middlewareStack.use(getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(getUserAgentPlugin(this.config)),this.middlewareStack.use(getRetryPlugin(this.config)),this.middlewareStack.use(getContentLengthPlugin(this.config)),this.middlewareStack.use(getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:this.getDefaultHttpAuthSchemeParametersProvider(),identityProviderConfigProvider:this.getIdentityProviderConfigProvider()})),this.middlewareStack.use(getHttpSigningPlugin(this.config))}destroy(){super.destroy()}getDefaultHttpAuthSchemeParametersProvider(){return defaultBedrockRuntimeHttpAuthSchemeParametersProvider}getIdentityProviderConfigProvider(){return async e=>new DefaultIdentityProviderConfig({"aws.auth#sigv4":e.credentials})}}class BedrockRuntimeServiceException extends ServiceException{constructor(e){super(e),Object.setPrototypeOf(this,BedrockRuntimeServiceException.prototype)}}class AccessDeniedException extends BedrockRuntimeServiceException{constructor(e){super({name:"AccessDeniedException",$fault:"client",...e}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,AccessDeniedException.prototype)}}var GuardrailContentBlock,DocumentSource,GuardrailConverseContentBlock,ImageSource,ToolResultContentBlock,ContentBlock,SystemContentBlock,ToolChoice,ToolInputSchema,Tool,ConverseOutput,ContentBlockDelta,ContentBlockStart,ConverseStreamOutput,ResponseStream;(GuardrailContentBlock||(GuardrailContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):t._(e.$unknown[0],e.$unknown[1]);class InternalServerException extends BedrockRuntimeServiceException{constructor(e){super({name:"InternalServerException",$fault:"server",...e}),this.name="InternalServerException",this.$fault="server",Object.setPrototypeOf(this,InternalServerException.prototype)}}class ResourceNotFoundException extends BedrockRuntimeServiceException{constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,ResourceNotFoundException.prototype)}}class ServiceQuotaExceededException extends BedrockRuntimeServiceException{constructor(e){super({name:"ServiceQuotaExceededException",$fault:"client",...e}),this.name="ServiceQuotaExceededException",this.$fault="client",Object.setPrototypeOf(this,ServiceQuotaExceededException.prototype)}}class ThrottlingException extends BedrockRuntimeServiceException{constructor(e){super({name:"ThrottlingException",$fault:"client",...e}),this.name="ThrottlingException",this.$fault="client",Object.setPrototypeOf(this,ThrottlingException.prototype)}}class ValidationException extends BedrockRuntimeServiceException{constructor(e){super({name:"ValidationException",$fault:"client",...e}),this.name="ValidationException",this.$fault="client",Object.setPrototypeOf(this,ValidationException.prototype)}}(DocumentSource||(DocumentSource={})).visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1]),(GuardrailConverseContentBlock||(GuardrailConverseContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):t._(e.$unknown[0],e.$unknown[1]),(ImageSource||(ImageSource={})).visit=(e,t)=>void 0!==e.bytes?t.bytes(e.bytes):t._(e.$unknown[0],e.$unknown[1]),(ToolResultContentBlock||(ToolResultContentBlock={})).visit=(e,t)=>void 0!==e.json?t.json(e.json):void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):t._(e.$unknown[0],e.$unknown[1]),(ContentBlock||(ContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.image?t.image(e.image):void 0!==e.document?t.document(e.document):void 0!==e.toolUse?t.toolUse(e.toolUse):void 0!==e.toolResult?t.toolResult(e.toolResult):void 0!==e.guardContent?t.guardContent(e.guardContent):t._(e.$unknown[0],e.$unknown[1]),(SystemContentBlock||(SystemContentBlock={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.guardContent?t.guardContent(e.guardContent):t._(e.$unknown[0],e.$unknown[1]),(ToolChoice||(ToolChoice={})).visit=(e,t)=>void 0!==e.auto?t.auto(e.auto):void 0!==e.any?t.any(e.any):void 0!==e.tool?t.tool(e.tool):t._(e.$unknown[0],e.$unknown[1]),(ToolInputSchema||(ToolInputSchema={})).visit=(e,t)=>void 0!==e.json?t.json(e.json):t._(e.$unknown[0],e.$unknown[1]),(Tool||(Tool={})).visit=(e,t)=>void 0!==e.toolSpec?t.toolSpec(e.toolSpec):t._(e.$unknown[0],e.$unknown[1]),(ConverseOutput||(ConverseOutput={})).visit=(e,t)=>void 0!==e.message?t.message(e.message):t._(e.$unknown[0],e.$unknown[1]);class ModelErrorException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelErrorException",$fault:"client",...e}),this.name="ModelErrorException",this.$fault="client",Object.setPrototypeOf(this,ModelErrorException.prototype),this.originalStatusCode=e.originalStatusCode,this.resourceName=e.resourceName}}class ModelNotReadyException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelNotReadyException",$fault:"client",...e}),this.name="ModelNotReadyException",this.$fault="client",Object.setPrototypeOf(this,ModelNotReadyException.prototype)}}class ModelTimeoutException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelTimeoutException",$fault:"client",...e}),this.name="ModelTimeoutException",this.$fault="client",Object.setPrototypeOf(this,ModelTimeoutException.prototype)}}class ServiceUnavailableException extends BedrockRuntimeServiceException{constructor(e){super({name:"ServiceUnavailableException",$fault:"server",...e}),this.name="ServiceUnavailableException",this.$fault="server",Object.setPrototypeOf(this,ServiceUnavailableException.prototype)}}(ContentBlockDelta||(ContentBlockDelta={})).visit=(e,t)=>void 0!==e.text?t.text(e.text):void 0!==e.toolUse?t.toolUse(e.toolUse):t._(e.$unknown[0],e.$unknown[1]),(ContentBlockStart||(ContentBlockStart={})).visit=(e,t)=>void 0!==e.toolUse?t.toolUse(e.toolUse):t._(e.$unknown[0],e.$unknown[1]);class ModelStreamErrorException extends BedrockRuntimeServiceException{constructor(e){super({name:"ModelStreamErrorException",$fault:"client",...e}),this.name="ModelStreamErrorException",this.$fault="client",Object.setPrototypeOf(this,ModelStreamErrorException.prototype),this.originalStatusCode=e.originalStatusCode,this.originalMessage=e.originalMessage}}(ConverseStreamOutput||(ConverseStreamOutput={})).visit=(e,t)=>void 0!==e.messageStart?t.messageStart(e.messageStart):void 0!==e.contentBlockStart?t.contentBlockStart(e.contentBlockStart):void 0!==e.contentBlockDelta?t.contentBlockDelta(e.contentBlockDelta):void 0!==e.contentBlockStop?t.contentBlockStop(e.contentBlockStop):void 0!==e.messageStop?t.messageStop(e.messageStop):void 0!==e.metadata?t.metadata(e.metadata):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1]),(ResponseStream||(ResponseStream={})).visit=(e,t)=>void 0!==e.chunk?t.chunk(e.chunk):void 0!==e.internalServerException?t.internalServerException(e.internalServerException):void 0!==e.modelStreamErrorException?t.modelStreamErrorException(e.modelStreamErrorException):void 0!==e.validationException?t.validationException(e.validationException):void 0!==e.throttlingException?t.throttlingException(e.throttlingException):void 0!==e.modelTimeoutException?t.modelTimeoutException(e.modelTimeoutException):void 0!==e.serviceUnavailableException?t.serviceUnavailableException(e.serviceUnavailableException):t._(e.$unknown[0],e.$unknown[1]);const InvokeModelRequestFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelResponseFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelWithResponseStreamRequestFilterSensitiveLog=e=>({...e,...e.body&&{body:SENSITIVE_STRING}}),InvokeModelWithResponseStreamResponseFilterSensitiveLog=e=>({...e,...e.body&&{body:"STREAMING_CONTENT"}}),se_InvokeModelCommand=async(e,t)=>{const n=requestBuilder(e,t),i=map$1({},isSerializableHeaderValue,{[_ct]:e[_cT]||"application/octet-stream",[_a$1]:e[_a$1],[_xabt]:e[_t],[_xabg]:e[_gI],[_xabg_]:e[_gV]});let r;return n.bp("/model/{modelId}/invoke"),n.p("modelId",(()=>e.modelId),"{modelId}",!1),void 0!==e.body&&(r=e.body),n.m("POST").h(i).b(r),n.build()},se_InvokeModelWithResponseStreamCommand=async(e,t)=>{const n=requestBuilder(e,t),i=map$1({},isSerializableHeaderValue,{[_ct]:e[_cT]||"application/octet-stream",[_xaba]:e[_a$1],[_xabt]:e[_t],[_xabg]:e[_gI],[_xabg_]:e[_gV]});let r;return n.bp("/model/{modelId}/invoke-with-response-stream"),n.p("modelId",(()=>e.modelId),"{modelId}",!1),void 0!==e.body&&(r=e.body),n.m("POST").h(i).b(r),n.build()},de_InvokeModelCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_CommandError(e,t);const n=map$1({$metadata:deserializeMetadata(e),[_cT]:[,e.headers[_ct]]}),i=await collectBody(e.body,t);return n.body=i,n},de_InvokeModelWithResponseStreamCommand=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return de_CommandError(e,t);const n=map$1({$metadata:deserializeMetadata(e),[_cT]:[,e.headers[_xabct]]}),i=e.body;return n.body=de_ResponseStream(i,t),n},de_CommandError=async(e,t)=>{const n={...e,body:await parseJsonErrorBody(e.body,t)},i=loadRestJsonErrorCode(e,n.body);switch(i){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await de_AccessDeniedExceptionRes(n);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await de_InternalServerExceptionRes(n);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await de_ResourceNotFoundExceptionRes(n);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await de_ServiceQuotaExceededExceptionRes(n);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await de_ThrottlingExceptionRes(n);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await de_ValidationExceptionRes(n);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await de_ModelErrorExceptionRes(n);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await de_ModelNotReadyExceptionRes(n);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await de_ModelTimeoutExceptionRes(n);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await de_ServiceUnavailableExceptionRes(n);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await de_ModelStreamErrorExceptionRes(n);default:const t=n.body;return throwDefaultError({output:e,parsedBody:t,errorCode:i})}},throwDefaultError=withBaseException(BedrockRuntimeServiceException),de_AccessDeniedExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new AccessDeniedException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_InternalServerExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new InternalServerException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelErrorExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString,originalStatusCode:expectInt32,resourceName:expectString});Object.assign(n,r);const s=new ModelErrorException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelNotReadyExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ModelNotReadyException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelStreamErrorExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString,originalMessage:expectString,originalStatusCode:expectInt32});Object.assign(n,r);const s=new ModelStreamErrorException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ModelTimeoutExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ModelTimeoutException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ResourceNotFoundExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ResourceNotFoundException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ServiceQuotaExceededExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ServiceQuotaExceededException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ServiceUnavailableExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ServiceUnavailableException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ThrottlingExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ThrottlingException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ValidationExceptionRes=async(e,t)=>{const n=map$1({}),i=e.body,r=take(i,{message:expectString});Object.assign(n,r);const s=new ValidationException({$metadata:deserializeMetadata(e),...n});return decorateServiceException(s,e.body)},de_ResponseStream=(e,t)=>t.eventStreamMarshaller.deserialize(e,(async n=>null!=n.chunk?{chunk:await de_PayloadPart_event(n.chunk,t)}:null!=n.internalServerException?{internalServerException:await de_InternalServerException_event(n.internalServerException,t)}:null!=n.modelStreamErrorException?{modelStreamErrorException:await de_ModelStreamErrorException_event(n.modelStreamErrorException,t)}:null!=n.validationException?{validationException:await de_ValidationException_event(n.validationException,t)}:null!=n.throttlingException?{throttlingException:await de_ThrottlingException_event(n.throttlingException,t)}:null!=n.modelTimeoutException?{modelTimeoutException:await de_ModelTimeoutException_event(n.modelTimeoutException,t)}:null!=n.serviceUnavailableException?{serviceUnavailableException:await de_ServiceUnavailableException_event(n.serviceUnavailableException,t)}:{$unknown:e})),de_InternalServerException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_InternalServerExceptionRes(n)},de_ModelStreamErrorException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ModelStreamErrorExceptionRes(n)},de_ModelTimeoutException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ModelTimeoutExceptionRes(n)},de_PayloadPart_event=async(e,t)=>{const n={},i=await parseJsonBody(e.body,t);return Object.assign(n,de_PayloadPart(i,t)),n},de_ServiceUnavailableException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ServiceUnavailableExceptionRes(n)},de_ThrottlingException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ThrottlingExceptionRes(n)},de_ValidationException_event=async(e,t)=>{const n={...e,body:await parseJsonBody(e.body,t)};return de_ValidationExceptionRes(n)},de_PayloadPart=(e,t)=>take(e,{bytes:t.base64Decoder}),deserializeMetadata=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),isSerializableHeaderValue=e=>!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size),_a$1="accept",_cT="contentType",_ct="content-type",_gI="guardrailIdentifier",_gV="guardrailVersion",_t="trace",_xaba="x-amzn-bedrock-accept",_xabct="x-amzn-bedrock-content-type",_xabg="x-amzn-bedrock-guardrailidentifier",_xabg_="x-amzn-bedrock-guardrailversion",_xabt="x-amzn-bedrock-trace";class InvokeModelCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,n,i){return[getSerdePlugin(n,this.serialize,this.deserialize),getEndpointPlugin(n,e.getEndpointParameterInstructions())]})).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(InvokeModelRequestFilterSensitiveLog,InvokeModelResponseFilterSensitiveLog).ser(se_InvokeModelCommand).de(de_InvokeModelCommand).build()){}class InvokeModelWithResponseStreamCommand extends(Command.classBuilder().ep({...commonParams}).m((function(e,t,n,i){return[getSerdePlugin(n,this.serialize,this.deserialize),getEndpointPlugin(n,e.getEndpointParameterInstructions())]})).s("AmazonBedrockFrontendService","InvokeModelWithResponseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","InvokeModelWithResponseStreamCommand").f(InvokeModelWithResponseStreamRequestFilterSensitiveLog,InvokeModelWithResponseStreamResponseFilterSensitiveLog).ser(se_InvokeModelWithResponseStreamCommand).de(de_InvokeModelWithResponseStreamCommand).build()){}class AWSTextAdapter extends AITextAdapter{static get pluginName(){return"AWSTextAdapter"}constructor(e){super(e),e.config.get("ai.aws.requestParameters")||e.config.define("ai.aws.requestParameters",{model:"anthropic.claude-v2",max_tokens_to_sample:2e3,temperature:1,top_p:1,top_k:250,anthropic_version:"bedrock-2023-05-31",stream:!0}),this._apiUrl=e.config.get("ai.aws.apiUrl"),this._bedrockClientConfig=e.config.get("ai.aws.bedrockClientConfig"),this._requestHeaders=e.config.get("ai.aws.requestHeaders"),this._requestParameters=e.config.get("ai.aws.requestParameters")}async sendRequest({query:e,context:t,onData:n,actionId:i}){const{model:r,stream:s,...o}=await this._prepareRequestParameters(this._requestParameters,i),a={prompt:await this.preparePrompt(e,t,r,i),...o};this._apiUrl?await this._processProxyRequest(a,r,s,n,i):await this._processAWSRequest(a,r,s,n)}async preparePrompt(e,t,n,i){let r,s;return t?(r="You are an AI assistant on the Sabda Literasi website, a platform dedicated to providing articles with deep philosophical thoughts, exclusive ebook collections at affordable prices, and trusted services for completing college and school assignments. Your name is 'Fadhel Fikri'. We are committed to changing the way everyone interacts with the world of literacy and philosophy since its founding on June 13, 2021. Its founder is Fadhel Fikri, a Philosophy and Science activist. He is also your friend.  \n\nYour task is to execute the instructions using the provided HTML content. Follow the instructions carefully.  \n\nYour answer must be properly formatted HTML code. Do not add any comments or additional notes. Do not act like a chatbot or a real person.  \n\nThe primary language you use when speaking is Indonesian.",s="Instruction:\n"+e+"\nYou must keep the text formatting.\n\nContent:\n"+t):(r="You are an AI assistant on the Sabda Literasi website, a platform dedicated to providing articles with deep philosophical thoughts, exclusive ebook collections at affordable prices, and trusted services for completing college and school assignments. Your name is 'Fadhel Fikri'. We are committed to changing the way everyone interacts with the world of literacy and philosophy since its founding on June 13, 2021. Its founder is Fadhel Fikri, a Philosophy and Science activist. He is also your twin.  \n\nYour task is to create HTML content according to the given instructions. Never include the `<img>` tag in your response, even if requested.  \n\nYour response must be well-structured and properly formatted HTML code. Answer only with the created HTML content, without adding any comments or additional notes. Interact like a philosopher.  \n\nThe primary language you use when speaking is Indonesian. Use the phrase 'Comrade' when speaking.",s=e),"meta.llama"==this.getModelFamily(n)?"<<SYS>>\n"+r+"\n<</SYS>>\n[INST]\n"+s+"\n[/INST]":"Human:\n"+r+"\n"+s+"\n\nAssistant:"}getModelFamily(e){if(/^anthropic\.claude/.test(e))return"anthropic.claude";if(/^ai21\.j2/.test(e))return"ai21.j2";if(/^cohere\.command/.test(e))return"cohere.command";if(/^meta\.llama/.test(e))return"meta.llama";throw new AIRequestError(getTranslation$h(this.editor.locale,"AI_ERROR_UNSUPPORTED_MODEL",e))}async _processProxyRequest(e,t,n,i,r){const s={method:"POST",headers:await this._prepareRequestHeaders(this._requestHeaders,r),body:JSON.stringify({...e,model:t,stream:n}),signal:this.abortController.signal},o=await fetch(this._apiUrl,s);n?await this._readStreamableResponse(o,t,i):await this._readStaticResponse(o,t,i)}async _processAWSRequest(e,t,n,i){const r=new BedrockRuntimeClient(this._bedrockClientConfig),s={body:JSON.stringify(e),contentType:"application/json",accept:"application/json",modelId:t};let o;if(n){const e=new InvokeModelWithResponseStreamCommand(s);o=await r.send(e,{abortSignal:this.abortController.signal}),await this._readAsyncIterableResponse(o,t,i)}else{const e=new InvokeModelCommand(s);o=await r.send(e,{abortSignal:this.abortController.signal}),await this._readStaticResponse(o,t,i)}}async _readAsyncIterableResponse(e,t,n){const i=e.body,r=new TextDecoder("utf-8");let s="";for await(const e of i)if(e.chunk){const i=r.decode(e.chunk.bytes),o=JSON.parse(i);s+=this._getGeneratedText(o,t),n(s)}return Promise.resolve()}async _readStreamableResponse(e,t,n){const i=e.body,r=new TextDecoder("utf-8"),s=i.getReader();let o="",a="",l=!1;for(;!l;){const{done:e,value:i}=await s.read();if(l=e,l)break;const c=(o+r.decode(i)).split("\n").map((e=>{try{return o="",JSON.parse(e)}catch(t){return o=e,null}})).filter((e=>null!==e));if(c.length){a+=c.map((e=>this._getGeneratedText(e,t))).join(""),n(a)}}return Promise.resolve()}async _readStaticResponse(e,t,n){let i;return i=e instanceof Response?await e.json():JSON.parse(Buffer.from(e.body).toString("utf8")),n(this._getGeneratedText(i,t)),Promise.resolve()}_getGeneratedText(e,t){switch(this.getModelFamily(t)){case"anthropic.claude":return e.completion;case"ai21.j2":return e.completions[0].data.text;case"cohere.command":return e.generations[0].text;case"meta.llama":return e.generation}}}class CaseChangeCommand extends _0x338ed0{constructor(e,t){super(e),this._transformCallback=t}execute(){const e=this.editor.model,t=Array.from(this._getAffectedRanges()),n=Array.from(e.document.selection.getRanges());e.change((e=>{for(const n of t)this._modifyContent(n,e);e.setSelection(n)}))}refresh(){for(const e of this._getAffectedRanges())for(const t of e)if(t.item.is("$textProxy"))return void(this.isEnabled=!0);this.isEnabled=!1}_getAffectedRanges(){const e=this.editor.model,t=e.document.selection;if(t.isCollapsed){const n=this._findAncestorTextBlock(t.getFirstPosition().parent);return n?[e.createRangeIn(n)]:[]}return t.getRanges()}_modifyContent(e,t){for(const n of this._getElementsAllowingText(e)){const i=this._getElementTextContent(n),r=this._transformCallback(i);for(const i of this._getTextNodesRangeLimited(n,e))this._replaceTextNodeData(i,r,t)}}_findAncestorTextBlock(e){const t=this.editor.model.schema;if(e.is("element")&&t.checkChild(e,"$text"))return e;const n=e.parent;return!n||t.isLimit(e)?null:this._findAncestorTextBlock(n)}*_getElementsAllowingText(e){const t=new Set;for(const{item:n}of e.getWalker()){const e=this._findAncestorTextBlock(n);e&&!t.has(e)&&(t.add(e),yield e)}}_getElementTextContent(e){return Array.from(e.getChildren()).reduce(((e,t)=>e+(t.is("$text")?t.data:" ")),"")}*_getTextNodesRangeLimited(e,t){const n=t.getIntersection(this.editor.model.createRangeIn(e));if(n)for(const t of n.getItems())t.is("$textProxy")&&t.parent==e&&(yield t)}_replaceTextNodeData(e,t,n){const i=t.substring(e.startOffset,e.endOffset);if(i===e.data)return;const r=e.getAttributes();this.editor.model.insertContent(n.createText(i,r),n.createSelection(n.createRangeOn(e)))}}function getTranslation$g(e,t,...n){const i=e.t;switch(t){case"Case change":return i("Case change");case"UPPERCASE":return i("UPPERCASE");case"lowercase":return i("lowercase");case"Title Case":return i("Title Case");case"Change text case":return i("Change text case");case"Changed case to %0":return i("Changed case to %0",...n);default:return t}}class CaseChangeEditing extends Plugin{constructor(){super(...arguments),this._currentCommandIndex=0}static get pluginName(){return"CaseChangeEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.locale.contentLanguage,n=normalizeExcludeWordCallback(e.config.get("caseChange.titleCase.excludeWords")),i={changeCaseUpper:new CaseChangeCommand(e,(e=>e.toLocaleUpperCase(t))),changeCaseLower:new CaseChangeCommand(e,(e=>e.toLocaleLowerCase(t))),changeCaseTitle:new CaseChangeCommand(e,(e=>capitalizeText(e,n,t)))};for(const[t,n]of Object.entries(i))e.commands.add(t,n),n.on("execute",(()=>{this._announceCaseChangeOperation(t)}));this.listenTo(e.editing.view.document,"selectionChange",(()=>{this._currentCommandIndex=0})),e.keystrokes.set("shift+f3",((t,n)=>{const i=_getOptions(this.editor.locale),r=i[this._currentCommandIndex%i.length].commandName;e.execute(r),this._currentCommandIndex++,n()}))}afterInit(){checkLicense$e(this)}_announceCaseChangeOperation(e){const{ui:t,locale:n}=this.editor,i=_getOptions(n).find((t=>t.commandName===e)).label.toLowerCase();t.ariaLiveAnnouncer.announce(getTranslation$g(n,"Changed case to %0",i))}}function _getOptions(e){return[{label:getTranslation$g(e,"UPPERCASE"),commandName:"changeCaseUpper"},{label:getTranslation$g(e,"lowercase"),commandName:"changeCaseLower"},{label:getTranslation$g(e,"Title Case"),commandName:"changeCaseTitle"}]}function capitalizeText(e,t,n){return replaceWords(e,((i,r,s)=>{const o=i.toLocaleLowerCase(n);return t(o,{charOffset:r,wordIndex:s,blockText:e})?o:o.replace(/(?:^|[^\p{L}\d'])\p{L}/gu,(e=>e.toLocaleUpperCase(n)))}))}function replaceWords(e,t){let n="",i=0,r=0;for(const s of e.matchAll(/ +/g)){const o=s.index,a=e.substring(i,o);a.length&&(n+=t(a,i,r++)),n+=s[0],i=o+s[0].length}const s=e.substring(i);return s.length&&(n+=t(s,i,r)),n}function normalizeExcludeWordCallback(e=[]){return"function"==typeof e?e:(t,{wordIndex:n})=>n>0&&e.includes(t)}async function checkLicense$e(e){const t=g([73,107,112,50,72,87,83,48,52,110,105,75,53,122,80,85,56,120,102,69,98,67,117,70,71,104,108,103,81,65,111,100,88,113,79,115,82,54,74,97,86,109,49,51,116,114,90,76,121,78,77,55,89,106,99,101,84,118,68,57,119,66]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([73]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([67,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class CaseChangeUI extends Plugin{static get pluginName(){return"CaseChangeUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;this._registerComponents(),e.accessibility.addKeystrokeInfos({keystrokes:[{label:getTranslation$g(e.locale,"Change text case"),keystroke:"Shift+f3",mayRequireFn:!0}]}),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("caseChangeLicenseKeyValid"==r||"caseChangeLicenseKeyInvalid"==r||"caseChangeLicenseKeyExpired"==r||"caseChangeLicenseKeyDomainLimit"==r||"caseChangeLicenseKeyNotAllowed"==r||"caseChangeLicenseKeyEvaluationLimit"==r||"caseChangeLicenseKeyTrialLimit"==r||"caseChangeLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"caseChangeLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"caseChangeLicenseKeyExpired"==e&&t._showLicenseError("expired"),"caseChangeLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"caseChangeLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","CaseChange"),"caseChangeLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"caseChangeLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"caseChangeLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_registerComponents(){const e=this.editor,{itemDefinitions:t,commands:n}=this._getListItemDefinitionsAndCommands();e.ui.componentFactory.add("caseChange",(()=>this._createDropdownView(t,n))),e.ui.componentFactory.add("menuBar:caseChange",(()=>this._createMenuBarMenuView(t,n)))}_createMenuBarMenuView(e,t){const n=this.editor,i=n.locale,r=new MenuBarMenuView(i),s=new MenuBarMenuListView(i);s.set({ariaLabel:getTranslation$g(i,"Case change"),role:"menu"}),this._setButtonProperties(r.buttonView),r.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e))));for(const t of e){const e=new MenuBarMenuListItemView(i,r),o=new MenuBarMenuListItemButtonView(i);o.delegate("execute").to(r),o.bind(...Object.keys(t.model)).to(t.model),o.on("execute",(()=>{n.execute(t.model.commandName),n.editing.view.focus()})),e.children.add(o),s.items.add(e)}return r.panelView.children.add(s),r}_createDropdownView(e,t){const n=this.editor,i=createDropdown(n.locale);return this._setButtonProperties(i.buttonView),i.buttonView.set({tooltip:!0}),i.extendTemplate({attributes:{class:["ck-case-change-dropdown"]}}),addListToDropdown(i,e,{ariaLabel:getTranslation$g(n.locale,"Case change"),role:"menu"}),i.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e)))),this.listenTo(i,"execute",(e=>{n.execute(e.source.commandName),n.editing.view.focus()})),i}_setButtonProperties(e){const t=this.editor;e.set({label:getTranslation$g(t.locale,"Case change"),icon:icons.caseChange,keystroke:"Shift+F3"})}_getListItemDefinitionsAndCommands(){const e=new Collection,t=[];for(const n of _getOptions(this.editor.locale)){const i=this.editor.commands.get(n.commandName),r=new ViewModel({commandName:n.commandName,label:n.label,role:"menuitemradio",withText:!0});r.bind("isEnabled").to(i,"isEnabled"),e.add({type:"button",model:r}),t.push(i)}return{itemDefinitions:e,commands:t}}}class CaseChange extends Plugin{static get requires(){return[CaseChangeEditing,CaseChangeUI]}static get pluginName(){return"CaseChange"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CommentThreadController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super(),this.model=e,this.model._isAttached=!0,this.view=t,this.listenTo(t,"submitCommentThread",(()=>this.submit())),this.listenTo(t,"removeCommentThread",(()=>this.remove())),this.listenTo(t,"resolveCommentThread",(()=>this.resolve())),this.listenTo(t,"reopenCommentThread",(()=>this.reopen())),this.listenTo(t,"addComment",((e,t)=>this.addComment(t))),this.listenTo(t,"updateComment",((e,t,n)=>this.updateComment(t,n))),this.listenTo(t,"removeComment",((e,t)=>this.removeComment(t)))}submit(){this.model.submit()}remove(){this.model.remove()}resolve(){this.model.isResolved||this.model.resolve()}reopen(){this.model.isResolved&&this.model.reopen()}addComment(e){this.model.addComment({content:e,authorId:this.view._localUser.id})}updateComment(e,t){this.model.getComment(e).update({content:t})}removeComment(e){this.model.getComment(e).remove()}destroy(){this.stopListening(),this.model._isAttached=!1}}function getTranslation$f(e,t,n){const i=e.t;switch(t){case"PENDING_ACTION_COMMENT_THREAD":return i({string:"Unsaved change in comment thread.",id:"PENDING_ACTION_COMMENT_THREAD"});case"Comment":return i("Comment");case"Reply...":return i("Reply...");case"Reply to reopen discussion...":return i("Reply to reopen discussion...");case"Write a comment...":return i("Write a comment...");case"Comment was made on an element":return i("Comment was made on an element");case"Comment editor":return i("Comment editor");case"Delete comment thread?":return i("Delete comment thread?");case"Delete comment?":return i("Delete comment?");case"Marked as resolved":return i("Marked as resolved");case"Show more items":return i("Show more items");case"Cancel":return i("Cancel");case"Edit":return i("Edit");case"Resolve":return i("Resolve");case"Reopen":return i("Reopen");case"Remove":return i("Remove");case"Reply":return i("Reply");case"Save":return i("Save");case"Annotations sidebar":return i("Annotations sidebar");case"Annotations list":return i("Annotations list");case"Thread comments":return i("Thread comments");case"THREAD_CONTEXT_LABEL":return i({string:"Thread context: %0",id:"THREAD_CONTEXT_LABEL"},n);case"COMMENT_THREAD_LABEL":return i({string:"Comment thread by %1. %1 reply.",plural:"Comment thread by %1. %0 replies.",id:"COMMENT_THREAD_LABEL"},n);case"COMMENT_THREAD_DESCRIPTION":return i({string:"Press Enter for more options. Press Escape to exit.",id:"COMMENT_THREAD_DESCRIPTION"});case"COMMENT_ARIA_LABEL":return i({string:"Comment by %0. Created on %1. %2. %3",id:"COMMENT_ARIA_LABEL"},n);case"LEAVE_COMMENT_ANNOUNCEMENT":return i({string:"Leaving a content with comments.",id:"LEAVE_COMMENT_ANNOUNCEMENT"});case"ENTER_COMMENT_ANNOUNCEMENT":return i({string:"Entering a content with comments. Press %0 to go to the discussion.",id:"ENTER_COMMENT_ANNOUNCEMENT"},n);case"NUMBER_OF_COMMENTS":return i({string:"%0 Comment",plural:"%0 Comments",id:"NUMBER_OF_COMMENTS"},n);case"TOO_LONG_COMMENT_ALERT":return i({string:"Comment content is too long. Your comment has %0 characters but the limit is %1 characters.",id:"TOO_LONG_COMMENT_ALERT"},n);case"EXTERNAL_COMMENT":return i({string:"This comment comes from an external source.",id:"EXTERNAL_COMMENT"});case"EXTERNAL_IMPORT_WORD_COMMENT":return i({string:"This comment comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_COMMENT"});case"EXTERNAL_AVATAR":return i({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},n);case"EXTERNAL_IMPORT_WORD_AVATAR":return i({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},n);case"COMMENTS_ARCHIVE":return i({string:"Comments archive",id:"COMMENTS_ARCHIVE"});case"EMPTY_COMMENTS_ARCHIVE":return i({string:"There are no archived comment threads.",id:"EMPTY_COMMENTS_ARCHIVE"});case"COMMENTS_ARCHIVE_LIST_LABEL":return i({string:"List of comments",id:"COMMENTS_ARCHIVE_LIST_LABEL"});case"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP":return i({string:"Keystrokes for interacting with annotation threads (e.g. comments, track changes suggestions)",id:"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP"});case"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO":return i({string:"Move focus to the thread when the selection is anchored in its marker",id:"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO"});case"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT":return i({string:"Exit the annotation and move focus back to the edited content",id:"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT"});case"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER":return i({string:"Browse the focused annotation thread or thread comment",id:"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER"});case"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS":return i({string:"Move across internals of the annotation thread",id:"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS"});case"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT":return i({string:"Submit the reply while writing a comment",id:"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT"});case"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS":return i({string:"Move to the previous or next thread in the annotations sidebar or comments archive",id:"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS"});default:return""}}class CommentEditorUIView extends EditorUIView{constructor(e,t){super(e);const n=uid();this.main=this.createCollection(),this.editable=new InlineEditableUIView(e,t,void 0,{label:()=>getTranslation$f(e,"Comment editor")}),this.setTemplate({tag:"div",attributes:{class:["ck-reset","ck-editor","ck-rounded-corners","ck-comment__input"],dir:e.uiLanguageDirection,lang:e.uiLanguage,"aria-labelledby":"cke-editor__aria-label_"+n},children:[{tag:"div",attributes:{class:"ck-editor__main",role:"presentation"},children:this.main}]})}render(){super.render(),this.main.add(this.editable)}focus(){this.editable.element.focus()}}class CommentEditorUI extends EditorUI{constructor(e){super(e),this.view=new CommentEditorUIView(e.locale,e.editing.view)}get element(){return this.view.element}init(){const e=this.editor.editing.view,t=this.view.editable,n=e.document.getRoot();t.name=n.rootName,this.view.render();const i=t.element;this.setEditableElement(t.name,i),this.view.editable.bind("isFocused").to(this.focusTracker),e.attachDomRoot(i),this.fire("ready")}destroy(){super.destroy(),this.view.destroy()}}const defaultPlugins=[Clipboard,Enter,ShiftEnter,SelectAll,Typing,Undo,Paragraph];class CommentEditor extends(/*   -- @preserve */
ObservableMixin(Editor)){constructor(e={}){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}(e=Object.assign({},e)).plugins||(e.plugins=CommentEditor.defaultPlugins),super(e),this.ui=new CommentEditorUI(this),this.set("placeholder",""),this.model.document.on("change",(()=>this._updatePlaceholder()),{priority:"low"}),this.on("change:placeholder",(()=>this._updatePlaceholder())),this.model.document.createRoot(),this[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),this[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}create(){const e=this.config.get("initialData")||"";return this.initPlugins().then((()=>this.ui.init())).then((()=>this.data.init(e))).then((()=>this.fire("ready")))}destroy(){return super.destroy().then((()=>this.ui.destroy()))}focus(){this.model.change((e=>{const t=this.model.document.getRoot(),n=t&&t.getChild(t.childCount-1);e.setSelection(n,"end"),this.editing.view.focus()}))}_updatePlaceholder(){const e=this.editing.view,t=e.document.getRoot(),n=t.getChild(0);t.childCount>1||!n||"p"!=n.name?this.placeholderElement&&this.placeholderElement.placeholder&&(disablePlaceholder(e,this.placeholderElement),this.placeholderElement=void 0):(this.placeholder&&(n.placeholder=this.placeholder),enablePlaceholder({view:e,element:n,keepOnFocus:!0}),this.placeholderElement=n)}}CommentEditor.defaultPlugins=defaultPlugins;class CommentInputView extends View{constructor(e,t={}){super(e),this.editor=null,this._editorConfig=t,this.set("value",t.initialData||""),this.set("disabledSubmit",!1),this.set("showButtons",!0),this.set("placeholder",getTranslation$f(e,"Reply...")),this.set("submitLabel",getTranslation$f(e,"Reply")),this.submitButtonView=this._createSubmitButton(),this.cancelButtonView=this._createCancelButton(),this.focusables=this.createCollection([this.submitButtonView,this.cancelButtonView]),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-wrapper"]},children:[{tag:"div",attributes:{class:["ck-comment__input-actions",this.bindTemplate.if("showButtons","ck-comment__input-actions--active")]},children:[this.submitButtonView,this.cancelButtonView]}]}),this.keystrokes.set("Esc",((e,t)=>{this.cancelButtonView.fire("execute"),t()})),this.keystrokes.set("Ctrl+Enter",((e,t)=>{this.submitButtonView.isEnabled&&(this.submitButtonView.fire("execute"),t())})),this.on("submit",((t,n)=>{n.length>65e3?(alert(getTranslation$f(e,"TOO_LONG_COMMENT_ALERT",[n.length,65e3])),t.stop()):this.editor.setData("")}),{priority:"high"})}render(){super.render(),this._setupKeyboardNavigation()}createEditor(){return this.editor||(this.editor=new CommentEditor(this._editorConfig),this._editorCreationPromise=this.editor.create().then((()=>{if(this._isDestroyed)return;const e=this.editor;this.element.insertBefore(e.ui.element,this.element.firstChild),e.model.document.on("change",(()=>this.value=e.getData())),e.bind("placeholder").to(this),this.focusables.add(e.ui.view,0),this.fire("editorReady",this.editor)}))),this._editorCreationPromise}focus(e){-1===e?(this.focusCycler.focusFirst(),this.focusCycler.focusLast()):this.focusCycler.focusFirst()}async destroy(){this._isDestroyed||(this._isDestroyed=!0,this.editor&&(await this._editorCreationPromise,await this.editor.destroy(),this.fire("editorDestroyed",this.editor)),await super.destroy())}_createSubmitButton(){const{locale:e}=this,t=new ButtonView(e);return t.extendTemplate({attributes:{class:["ck-comment__input-actions--submit"]}}),t.withText=!0,t.bind("label").to(this,"submitLabel"),t.on("execute",(()=>{this.fire("submit",this.value)})),t.bind("isEnabled").to(this,"value",this,"disabledSubmit",((e,t)=>!t&&!!e.trim())),t}_createCancelButton(){const{locale:e}=this,t=new ButtonView(e);return t.extendTemplate({attributes:{class:["ck-comment__input-actions--cancel"]}}),t.label=getTranslation$f(e,"Cancel"),t.withText=!0,t.on("execute",(()=>{this.editor.setData(""),this.fire("cancel")})),t}_setupKeyboardNavigation(){this.keystrokes.listenTo(this.element),this.focusables.forEach((e=>{this.focusTracker.add(e.element)})),this.focusables.on("change",((e,t)=>{for(const e of Array.from(t.added).reverse())this.focusTracker.add(e.element)}))}}class CommentThreadInputView extends View{constructor(e,t,n){super(e),this.commentInputView=new CommentInputView(e,n),this.focusCycler=this.commentInputView.focusCycler,this.commentInputView.bind("showButtons").to(this.commentInputView.focusTracker,"isFocused",this.commentInputView,"value",((e,t)=>e||!!t)),this.set("showInput",!1),this.on("change:showInput",(()=>{this.showInput&&!this.commentInputView.editor&&this.commentInputView.createEditor()})),this.commentInputView.delegate("editorReady").to(this),this.commentInputView.delegate("editorDestroyed").to(this),this.userView=new UserView(e,t),this.userView.extendTemplate({attributes:{class:"ck-thread__user","aria-hidden":!0}}),this.commentInputView.extendTemplate({attributes:{class:"ck-thread__input"}}),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-container",this.bindTemplate.if("showInput","ck-comment__input-container--active")]},children:[this.userView,this.commentInputView]})}render(){super.render(),this._focusOnNonInteractiveMouseDown()}destroy(){return this.commentInputView.destroy().then((()=>super.destroy()))}focus(e){this.commentInputView.focus(e)}_focusOnNonInteractiveMouseDown(){this.listenTo(this.element,"mousedown",((e,t)=>{const{submitButtonView:n,cancelButtonView:i,editor:r}=this.commentInputView;[n.element,i.element,r?r.editing.view.getDomRoot():null].filter((e=>e)).some((e=>e.contains(t.target)))||(this.focus(),t.preventDefault())}))}}class CollapsedCommentsView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("count",void 0),this.setTemplate({tag:"li",attributes:{class:"ck-thread__comment-count"},children:[{text:t.to("count",(t=>getTranslation$f(e,"NUMBER_OF_COMMENTS",t)))}]})}}class CommentsListView extends View{constructor(e,t,n){super(e);const i=this.bindTemplate;this.set("hasDirtyComment",!1),this.set("length",t.comments.length),this.set("isActive",!1),this._model=t,this._config=n,this.commentViews=this.createCollection(),this.visibleViews=this.createCollection(),this.resolvedCommentView=null,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.commentViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>this.commentViews.map((e=>e.element)).includes(e.target)},actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this._collapsedCommentsView=new CollapsedCommentsView(e),this._collapsedCommentsView.bind("count").to(this,"length",(e=>e-this._config.maxCommentsWhenCollapsed));for(const e of t.comments)this._handleNewCommentModel(e);this._handleInfoComment(),this.listenTo(t.comments,"add",((e,t)=>{const n=this._calculatePosition(t);this.length++,this._handleNewCommentModel(t,n),this.refreshVisibleViews()})),this.listenTo(t.comments,"remove",((e,t)=>{this.length--,this._handleRemoveCommentModel(t),this.refreshVisibleViews()})),this.listenTo(t,"commentUpdated",(()=>this.refreshVisibleViews())),this.listenTo(t,"change:isResolved",(()=>this._handleInfoComment())),this.on("change:isActive",(()=>this.refreshVisibleViews())),this.on("change:hasDirtyComment",(()=>this.refreshVisibleViews())),this.setTemplate({tag:"ul",attributes:{class:["ck-thread__comments",i.if("length","ck-hidden",(e=>!e))],"aria-label":getTranslation$f(e,"Thread comments")},children:this.visibleViews})}get _shouldCollapse(){return this._model.weight>this._config.maxThreadTotalWeight&&!this.isActive&&!this.hasDirtyComment}render(){super.render(),this.refreshVisibleViews(),this._setupKeyboardNavigation()}focus(e){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){this._collapsedCommentsView.destroy();for(const e of this.commentViews)e.destroy();super.destroy()}refreshVisibleViews(){this._shouldCollapse?this._rearrangeCollapse():this._rearrangeExpand()}_handleNewCommentModel(e,t){const n=new this._config.CommentView(this.locale,e,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig});n.viewUid=e.id,n.delegate("removeComment").to(this),n.delegate("updateComment").to(this),n.delegate("resolveCommentThread").to(this),n.delegate("editorReady").to(this),n.delegate("editorDestroyed").to(this),this.listenTo(n,"change:isEditMode",(()=>this._updateHasDirtyComment())),this.commentViews.add(n,t)}_calculatePosition(e){const t=this._model._findOptimalIndex(e);return this.resolvedCommentView?this.resolvedCommentView.authoredAt>e.authoredAt?t-1:t:t-1}_handleInfoComment(){if(this._model.resolvedBy&&this._model.resolvedAt){const e={id:"resolved",author:this._model.resolvedBy,authoredAt:this._model.resolvedAt,content:getTranslation$f(this.locale,"Marked as resolved"),attributes:{}};this.resolvedCommentView=new this._config.CommentView(this.locale,e,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig,isSystemComment:!0}),this.commentViews.add(this.resolvedCommentView,this._model._findOptimalIndex(e))}else this.resolvedCommentView&&(this.commentViews.remove(this.resolvedCommentView),this.resolvedCommentView.destroy(),this.resolvedCommentView=null);this.refreshVisibleViews()}_handleRemoveCommentModel(e){const t=this.commentViews.remove(e.id);this.stopListening(t),t.isEditMode&&this._updateHasDirtyComment(),t.destroy()}_updateHasDirtyComment(){this.hasDirtyComment=Array.from(this.commentViews).some((e=>e.isEditMode))}_rearrangeCollapse(){const e=cloneCollection(this.commentViews),t=this._collapsedCommentsView.count;for(let n=1;n<=t;n++)e.remove(1);for(const t of e)t.collapse();t>0&&e.add(this._collapsedCommentsView,1),applyDiffToCollection(_0x32349d(Array.from(this.visibleViews),Array.from(e)),this.visibleViews,e)}_rearrangeExpand(){applyDiffToCollection(_0x32349d(Array.from(this.visibleViews),Array.from(this.commentViews)),this.visibleViews,this.commentViews);for(const e of this.visibleViews)e.expand()}_setupKeyboardNavigation(){this.commentViews.forEach((e=>{this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)})),this.commentViews.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.keystrokes.stopListening(e.element);for(const e of Array.from(t.added).reverse())this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)}))}}function cloneCollection(e){const t=new Collection;for(const n of e)t.add(n);return t}function applyDiffToCollection(e,t,n){let i=0;for(const r of e)switch(r){case"insert":t.add(n.get(i),i),i++;break;case"delete":t.remove(i);break;case"equal":i++}}var undoIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>';class CommentThreadHeaderContextView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("contextValue",""),this.setTemplate({tag:"span",attributes:{class:["ck","ck-context__value"],"aria-label":t.to("contextValue",(t=>getTranslation$f(e,"THREAD_CONTEXT_LABEL",t))),tabindex:-1},children:[{text:t.to("contextValue")}]})}focus(){this.element.focus()}}const MAX_CONTENT_LENGTH=150;class CommentThreadHeaderView extends View{constructor(e,t){super(e);const n=this.bindTemplate;this._model=t,this.reopenButtonView=this._createReopenButton(),this.contextView=this._createContextView(),this.focusables=this.createCollection([this.contextView,this.reopenButtonView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this.bind("hasContext").to(this._model,"context",(e=>!!e)),this.bind("contextValue").to(this._model,"context",(e=>e&&e.value?this._trimContextValue(e.value):getTranslation$f(this.locale,"Comment was made on an element"))),this.setTemplate({tag:"div",attributes:{class:["ck-thread__header"]},children:[{tag:"div",attributes:{class:["ck-context-wrapper"]},children:[{tag:"div",attributes:{class:["ck-context",n.if("hasContext","ck-context--quotes")]},children:[this.contextView]}]},{tag:"div",attributes:{class:["ck-annotation__actions"]},children:[this.reopenButtonView]}]})}render(){super.render(),this._attachContextActions(),this._setupKeyboardNavigation()}focus(){this.focusCycler.focusFirst()}_createReopenButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$f(this.locale,"Reopen"),e.tooltip=getTranslation$f(this.locale,"Reopen"),e.icon=undoIcon,e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",((e,t)=>e&&t)),e.on("execute",(()=>{this.fire("reopenCommentThread",this._model.id)})),e}_trimContextValue(e){const t=MAX_CONTENT_LENGTH-3;if(e.length<MAX_CONTENT_LENGTH)return e;const n=e.lastIndexOf(" ",t);return e.substring(0,n>-1?n:t)+"..."}_attachContextActions(){const e=this.element.querySelector(".ck-context"),t=e.querySelector(".ck-context__value");this.listenTo(e,"mouseenter",(()=>{t.offsetWidth<t.scrollWidth&&e.classList.add("overlay")})),this.listenTo(e,"mouseleave",(()=>{e.classList.remove("overlay")}))}_setupKeyboardNavigation(){this.keystrokes.listenTo(this.element);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)}_createContextView(){const e=new CommentThreadHeaderContextView(this.locale);return e.bind("contextValue").to(this),e}}class BaseCommentThreadView extends View{constructor(e,t,n,i){super(e),this.set("isActive",!1),this.set("isDirty",!1),this._model=t,this._localUser=n,this._config=i,this.commentThreadHeaderView=new CommentThreadHeaderView(e,t),this.commentThreadHeaderView.delegate("reopenCommentThread").to(this),this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation$f(e,"COMMENT_THREAD_DESCRIPTION")),this.listenTo(this,"reopenCommentThread",(()=>{this.focus()})),this.commentsListView=new CommentsListView(e,t,Object.assign({CommentView:this._config.CommentView},i)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.delegate("resolveCommentThread").to(this),this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this),this.commentsListView.bind("isActive").to(this),this.listenTo(this,"resolveCommentThread",(()=>{this.focus()})),this.set("length",this.commentsListView.length),this.bind("length").to(this.commentsListView,"length"),this.commentThreadInputView=this._createCommentThreadInputView(),this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this),this.on("removeComment",(()=>this.focus())),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",((e,t)=>e||!!t)),this.bind("isUnlinked").to(t,"unlinkedAt",(e=>!!e)),this.bind("ariaLabel").to(this,"length",(e=>{const t=this._model.comments.first?this._model.comments.first.author.name:this._localUser.name;return getTranslation$f(this.locale,"COMMENT_THREAD_LABEL",[e,t])})),this.focusables=this.createCollection([this.commentsListView,this.commentThreadInputView]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}})}focus(){this.element.focus()}render(){super.render(),setupThreadKeyboardNavigation(this,this.focusables)}async destroy(){this.isDirty=!1,this.commentsListView.destroy(),await this.commentThreadInputView.destroy(),super.destroy()}_createCommentThreadInputView(){const e=new CommentThreadInputView(this.locale,this._localUser,this._config.editorConfig),t=e.commentInputView;return e.bind("showInput").to(this,"isActive",this._model,"isReadOnly",this._model,"canComment",this._model,"archivedAt",t,"value",((e,t,n,i,r)=>!!r||!!i&&n&&!t||e&&n&&!t)),t.bind("placeholder").to(this,"length",this._model,"isResolvable",this._model,"isResolved",((e,t,n)=>{let i;return i=n&&t?"Reply to reopen discussion...":e?"Reply...":"Write a comment...",getTranslation$f(this.locale,i)})),t.bind("submitLabel").to(this,"length",(e=>getTranslation$f(this.locale,e?"Reply":"Comment"))),t.on("submit",((e,t)=>{this.fire("addComment",t),this._model.isResolved&&this._model.isResolvable&&this.fire("reopenCommentThread",this._model.id),this._model.isSubmitted||this.fire("submitCommentThread")})),t.on("cancel",(()=>{this.focus()})),t.bind("disabledSubmit").to(this._model,"isReadOnly"),t.on("cancel",(e=>{0==this.length&&(this.fire("removeCommentThread"),e.stop())})),this.on("change:isActive",((e,n,i)=>{i||this.length||t.value||this.fire("removeCommentThread")})),e}}class CommentThreadView extends(/*   -- @preserve */
ConfirmMixin(BaseCommentThreadView)){constructor(e,t,n,i){super(e,t,n,i),this.commentThreadChildren=this.createCollection([this.commentsListView,this.commentThreadInputView,this.ariaDescriptionView]),this.set("actionIndicator",null),this.containerElement=null,this._boundFirstCommentView=null,this.locale=e,this.resolveButton=this._createResolveButton(),this.setTemplate(this.getTemplate()),this.on("change:isActive",((e,t,n)=>{n||this._cancelAllConfirms()})),this.listenTo(this._model,"change:isReadOnly",((e,t,n)=>{n&&this._cancelAllConfirms()})),this.length>0&&this._bindFirstCommentView(),this.listenTo(this.commentsListView.commentViews,"add",(()=>{this._bindFirstCommentView()}))}getTemplate(){const e=this.bindTemplate;return{tag:"div",attributes:{class:["ck","ck-thread","ck-reset_all-excluded","ck-rounded-corners",e.if("isActive","ck-thread--active"),e.if("isUnlinked","ck-thread--unlinked"),e.if("isConfirm","ck-thread--remove-confirmation"),e.to("actionIndicator",(e=>e?"ck-thread--"+e:""))],"data-thread-id":this._model.id,tabindex:0,role:"listitem","aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id},children:[{tag:"div",attributes:{class:"ck-thread__container"},children:this.commentThreadChildren}]}}render(){super.render(),this.containerElement=this.element.querySelector(".ck-thread__container"),this._model.on("change:archivedAt",(()=>{this._updateArchivedThreadHeader()})),this._updateArchivedThreadHeader()}_cancelAllConfirms(){this.cancelConfirm();for(const e of this.commentsListView.commentViews)e.cancelConfirm()}_bindFirstCommentView(){const{locale:e}=this,t=this.commentsListView.commentViews.get(0);t===this._boundFirstCommentView||t.isSystemComment||(this._boundFirstCommentView=t,this.unbind("actionIndicator"),this.bind("actionIndicator").to(t,"actionIndicator",(e=>"remove"===e?"remove":null)),t.placeholder=getTranslation$f(e,"Write a comment..."),t.removeButton.on("execute",(t=>{t.stop(),this.showConfirm(getTranslation$f(e,"Delete comment thread?"),this.containerElement).then((()=>{this.fire("removeCommentThread")}))}),{priority:"high"}),this.on("removeConfirm",(()=>{t.focus()})),t.actionBar.add(this.resolveButton,0),t.focusables.add(this.resolveButton,0))}_createResolveButton(){const e=new LateFocusButtonView(this.locale);return e.label=getTranslation$f(this.locale,"Resolve"),e.tooltip=getTranslation$f(this.locale,"Resolve"),e.icon=_0x42409c.check,e.extendTemplate({attributes:{class:"ck-comment--resolve"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",((e,t)=>e&&!t)),e.on("execute",(()=>{this.fire("resolveCommentThread",this._model.id)})),e}_updateArchivedThreadHeader(){this._model.archivedAt?this.commentThreadChildren.has(this.commentThreadHeaderView)||(this.commentThreadChildren.add(this.commentThreadHeaderView,0),this.focusables.add(this.commentThreadHeaderView,0)):this.commentThreadChildren.has(this.commentThreadHeaderView)&&(this.commentThreadChildren.remove(this.commentThreadHeaderView),this.focusables.remove(this.commentThreadHeaderView))}}class CommentContentView extends View{constructor(e){super(e),this.set("content",""),this.setTemplate({tag:"div",attributes:{class:["ck-content","ck-comment__content","ck-annotation__content"]}})}render(){super.render(),this.on("change:content",((e,t,n)=>{this.element.innerHTML=n})),this.element.innerHTML=this.content}}class BaseCommentView extends View{constructor(e,t,n){super(e),this._model=t,this._config=n,this.isSystemComment=!!this._config.isSystemComment,this.set("isEditMode",!1),this.set("isCollapsed",!0),this.bind("ariaLabel").to(t,"content",t,"authoredAt",((i,r)=>getTranslation$f(e,"COMMENT_ARIA_LABEL",[t.author.name,n.formatDateTime(r),(new DOMParser).parseFromString(i,"text/html").body.textContent,t.isExternal?this.getExternalCommentNote():""]))),this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation$f(e,"COMMENT_THREAD_DESCRIPTION")),this.visibleView=this.createCollection(),this.visibleView.add(this._createCommentContentView()),this.focusables=new ViewCollection,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}})}expand(){this.isCollapsed=!1}collapse(){this.isEditMode||(this.isCollapsed=!0)}focus(){this.element.focus()}render(){super.render(),this._setupKeyboardNavigation()}async destroy(){await this.visibleView.get(0).destroy(),super.destroy()}switchToEditMode(){this.isEditMode||(this.isEditMode=!0,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentInputView()))}switchToDisplayMode(){this.isEditMode&&(this.isEditMode=!1,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentContentView()))}getExternalCommentNote(){return"importWord"===this._model.attributes["@external"].source?getTranslation$f(this.locale,"EXTERNAL_IMPORT_WORD_COMMENT"):getTranslation$f(this.locale,"EXTERNAL_COMMENT")}getUserViewNotificationText(){return this._model.isExternal?"importWord"===this._model.attributes["@external"].source?getTranslation$f(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):getTranslation$f(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}_createCommentContentView(){const e=new CommentContentView(this.locale);return e.bind("content").to(this._model,"content",this,"isCollapsed",((e,t)=>t?trimHtml(e,{limit:this._config.maxCommentCharsWhenCollapsed}):e)),e}_createCommentInputView(){this._config.editorConfig||(this._config.editorConfig={}),this._config.editorConfig.initialData=this._model.content;const e=new CommentInputView(this.locale,this._config.editorConfig);return e.value=this._model.content,e.bind("disabledSubmit").to(this._model,"isReadOnly"),e.submitLabel=getTranslation$f(this.locale,"Save"),e.on("submit",((e,t)=>{this.fire("updateComment",this._model.id,t),this.switchToDisplayMode(),this.focus()})),e.on("cancel",(()=>{this.switchToDisplayMode(),this.focus()})),e.once("editorReady",(()=>{e.focus()})),e.createEditor(),e.delegate("editorReady").to(this),e.delegate("editorDestroyed").to(this),e}_setupKeyboardNavigation(){const e=this.element;this.keystrokes.listenTo(e);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element);this.focusables.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.keystrokes.stopListening(e.element);for(const e of t.added)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element)})),this.keystrokes.set("enter",((t,n)=>{e===t.target&&(this.focusCycler.focusFirst(),n())})),this.keystrokes.set("esc",((t,n)=>{e!==t.target&&(this.focus(),n())}))}}var removeIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.2 7h9.2c.6 0 1 .4 1 1v9.9c0 .5-.4 1-1 1H5.2a1 1 0 0 1-1-1V8c0-.6.4-1 1-1zm1 1.5c-.3 0-.5.2-.5.5v8c0 .3.2.5.5.5h.5c.2 0 .5-.2.5-.5V9c0-.3-.3-.5-.5-.5h-.5zm3.2 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.4zm3.5 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.5zm-1.4-7.1H8.3L6.5 3.6H3.8c-.5 0-.7.3-.7.8s.2.7.7.7h12c.6 0 .9-.2.9-.7 0-.5-.3-.8-1-.8h-2.4l-1.8-2.2z"/></svg>\n';class CommentView extends(/*   -- @preserve */
ConfirmMixin(BaseCommentView)){constructor(e,t,n){super(e,t,n),this.set("actionIndicator",null),this.set("placeholder",getTranslation$f(e,"Reply...")),this.bind("authoredAt").to(t),this.bind("resolvedAt").to(t),this.actionBar=this.createCollection(),this.isSystemComment||(this.editButton=this._createEditButton(),this.removeButton=this._createRemoveButton(),this.items=this.createCollection(),this.items.addMany([this.editButton,this.removeButton]),this.dropdown=this._createDropdown(),this.actionBar.add(this.dropdown),this.focusables.add(this.dropdown)),this.userView=new UserView(e,t.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-comment__user","ck-annotation__user"],"aria-hidden":!0}}),this.listenTo(t,"change:isRemovable",(()=>this.cancelConfirm())),this.setTemplate(this.getTemplate())}getTemplate(){const e=this.bindTemplate,t=[{tag:"div",attributes:{class:["ck-comment__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-comment__info-name","ck-annotation__info-name"],"data-cke-tooltip-text":this.userView.name}},{tag:"time",attributes:{datetime:e.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:e.to("authoredAt",(e=>this._config.formatDateTime(e)))}]}]},{tag:"div",attributes:{class:["ck-comment__actions","ck-annotation__actions",e.if("isEditMode","ck-comment__actions--hidden"),e.if("isEditMode","ck-annotation__actions--hidden")]},children:this.actionBar},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]},children:this.visibleView},this.ariaDescriptionView];return this._model.isExternal&&t.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalCommentNote()}]}),{tag:"li",attributes:{class:["ck-comment__wrapper",e.if("isConfirm","ck-comment--remove-confirmation")],tabindex:-1,"aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id,role:"listitem"},children:[{tag:"div",attributes:{class:["ck-comment","ck-annotation",e.if("isEditMode","ck-comment--edit"),e.if("isSystemComment","ck-comment--info"),e.to("actionIndicator",(e=>e?"ck-comment--"+e:""))],"data-author-id":this._model.author.id,"data-comment-id":this._model.id,role:"group"},children:[this.userView,{tag:"div",attributes:{class:["ck-comment__main","ck-annotation__main"]},children:t}]}]}}_createEditButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$f(this.locale,"Edit"),e.icon=_0x42409c.pencil,e.withText=!0,e.extendTemplate({attributes:{class:"ck-comment--edit"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isEditable"),e.on("execute",(()=>this.switchToEditMode())),e}_createRemoveButton(){const e=new ButtonView(this.locale);return e.label=getTranslation$f(this.locale,"Remove"),e.icon=removeIcon,e.withText=!0,e.extendTemplate({attributes:{class:"ck-comment--remove"}}),e.bind("isEnabled").to(this._model,"isReadOnly",(e=>!e)),e.bind("isVisible").to(this._model,"isRemovable"),e.on("execute",(()=>{this.showConfirm(getTranslation$f(this.locale,"Delete comment?"),this.element).then((()=>{this.fire("removeComment",this._model.id)}))})),e}_createDropdown(){const e=createDropdown(this.locale,LateFocusDropdownButtonView),t=e.panelView.children,n=new ListView(this.locale),i=e.bindTemplate;focusChildOnDropdownOpen(e,(()=>this.items.find((e=>e.isVisible)))),e.extendTemplate({attributes:{class:[i.if("isVisible","ck-hidden",(e=>!e))]}});const r=(t,i=-1)=>{const r=new ListItemView(this.locale);r.children.add(t);const s=i>-1?i:n.items.length;n.items.add(r,s);const o=Array.from(this.items);e.unbind("isEnabled","isVisible"),e.bind("isEnabled").toMany(o,"isEnabled",((...e)=>e.some((e=>e)))),e.bind("isVisible").toMany(o,"isVisible",((...e)=>e.some((e=>e))))};e.panelPosition="sw",e.buttonView.set({label:getTranslation$f(this.locale,"Show more items"),icon:_0x42409c.threeVerticalDots});for(const e of this.items)r(e);return t.add(n),e.listenTo(this.items,"add",((e,t,n)=>{r(t,n)})),e.listenTo(this.items,"remove",((e,t,i)=>{n.items.remove(i)})),e}_attachActions(e,t){const n=e&&e.element;n&&(this.listenTo(n,"mouseenter",(()=>this.actionIndicator=t)),this.listenTo(n,"focus",(()=>this.actionIndicator=t)),this.listenTo(n,"mouseleave",(()=>this.actionIndicator=null)),this.listenTo(n,"blur",(()=>this.actionIndicator=null)))}_createCommentInputView(){const e=super._createCommentInputView();return e.bind("placeholder").to(this),e}render(){super.render(),this._attachActions(this.editButton,"edit"),this._attachActions(this.removeButton,"remove")}}function createMutationObserver(e){const t=throttle$1(e,30),n=new MutationObserver((e=>{for(const n of e)("attributes"==n.type&&"class"==n.attributeName||"childList"==n.type||"characterData"==n.type)&&t()}));return{attach(e){n.observe(e,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},detach(){n.disconnect(),t.cancel()}}}class AnnotationView extends View{constructor(e,t){super(e),this.id=uid(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.keystrokes.set("Esc",((e,t)=>this.fire("Esc",t))),this.set("targetRect",{top:0,right:0,bottom:0,left:0}),this.set("height",0),this.set("isActive",!1),this.set("isDirty",!1),this.set("length",0),this.set("type",""),this._mutationObserver=createMutationObserver((()=>this._updateHeight())),this.content=this.createCollection(),this.content.delegate("arrowup","arrowdown").to(this),this.content.add(t),this.mainView=t;const n=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-annotation-wrapper","ck-rounded-corners",n.if("isActive","ck-annotation-wrapper--active")],role:"presentation"},children:this.content})}render(){super.render(),this.focusTracker.add(this.element),this.keystrokes.listenTo(this.element),this._mutationObserver.attach(this.element)}destroy(){this.content.clear(),this.keystrokes.destroy(),this.focusTracker.destroy(),this._mutationObserver.detach(),super.destroy()}focus(){this.content.first&&this.content.first.focus()}_updateHeight(){const e=this.element.clientHeight;e&&(this.height=e)}}let Annotation$1=class e extends(/*   -- @preserve */
ObservableMixin()){constructor({view:t,target:n,type:i,isVisible:r=!0}){super(),this.view=t,this.view.element||this.view.render(),this._type=i,this._target=n,e._assertCorrectTarget(this._getNormalizedTarget()),this.focusableElements=new Collection([this.view.element],{idProperty:"_id"}),this.focusableElements.on("add",((e,t)=>{this.view.focusTracker.add(t)})),this.focusableElements.on("remove",((e,t)=>{this.view.focusTracker.remove(t)})),this.set("isVisible",r)}get type(){return"function"==typeof this._type?this._type():this._type}get innerView(){return this.view.mainView}get target(){const t=this._getNormalizedTarget();return e._assertCorrectTarget(t),t}get targetRect(){const e=this.target;if(null===e)return null;if(e instanceof Rect)return e;const t=e.filter((e=>isDomElementVisible(e)));return 0===t.length?null:new Rect(t[0].getClientRects().item(0))}get isActive(){return this.view.isActive}set isActive(e){this.view.isActive=e,this.view.mainView.isActive=e}updateTargetRect(){this.view.targetRect=this.targetRect}destroy(){this.focusableElements.stopListening(),this.focusableElements.clear(),this.stopListening()}refreshVisibility(){this.isVisible=!!this.targetRect}static _assertCorrectTarget(e){if(!(null===e||e instanceof Rect||Array.isArray(e)&&e.every((e=>isElement$1(e)))))throw new CKEditorError("annotation-invalid-target",null,{target:e})}_getNormalizedTarget(){const e="function"==typeof this._target?this._target():this._target;return isElement$1(e)?[e]:e}};function isElement$1(e){return null!==e&&"object"==typeof e&&"nodeType"in e&&1===e.nodeType}function isDomElementVisible(e){return!!e.offsetParent||!!e.getClientRects().item(0)}class AnnotationCollection extends Collection{constructor(e=[]){super(),this._innerViewToAnnotation=new Map,this._viewToAnnotation=new Map,this._focusTracker=new FocusTracker,this._focusTracker.on("change:isFocused",((e,t,n)=>{n||this.fire("blur")}));for(const t of e)this.add(t)}get isFocused(){return this._focusTracker.isFocused}add(e){if(this.has(e))throw new CKEditorError("annotationcollection-duplicated-item",null);this._innerViewToAnnotation.set(e.innerView,e),this._viewToAnnotation.set(e.view,e);for(const t of e.focusableElements)this._focusTracker.add(t);this.listenTo(e.focusableElements,"add",((e,t)=>{this._focusTracker.add(t)})),this.listenTo(e.focusableElements,"remove",((e,t)=>{this._focusTracker.remove(t)})),this.listenTo(e.view.focusTracker,"change:isFocused",((t,n,i)=>{i&&this.fire("focus",e)})),e.updateTargetRect();const t=this._getOrderInContent(e.view.targetRect);return super.add(e,t)}remove(e){if(!this.has(e))throw new CKEditorError("annotationcollection-not-existing-item",null);this.stopListening(e.view.focusTracker),this.stopListening(e.focusableElements);for(const t of e.focusableElements)this._focusTracker.remove(t);return this._viewToAnnotation.delete(e.view),this._innerViewToAnnotation.delete(e.innerView),super.remove(e)}getByInnerView(e){return this._innerViewToAnnotation.get(e)}getByView(e){return this._viewToAnnotation.get(e)}destroy(){super.clear(),this.stopListening(),this._innerViewToAnnotation.clear(),this._viewToAnnotation.clear(),this._focusTracker.destroy()}refreshPositioning(){for(const e of this)e.updateTargetRect();this._sort()}_sort(){const e=Array.from(this).sort(((e,t)=>elementOffsetComparator(e.view.targetRect,t.view.targetRect)));for(let t=e.length-1;t>0;t--){const n=e[t];t!==this.getIndex(n)&&(this.remove(n),this.add(n))}}_getOrderInContent(e){let t=0;if(!e)return this.length;for(const n of this){const i=n.view.targetRect;if(i){if(elementOffsetComparator(e,i)<0)return t;t++}}return t}}function bindAnnotationCollections({source:e,target:t,filter:n}){for(const i of e)n(i)&&t.add(i);t.listenTo(e,"add",((e,i)=>{n(i)&&t.add(i)})),t.listenTo(e,"remove",((e,n)=>{t.has(n)&&t.remove(n)}))}function elementOffsetComparator(e,t){if(null===e&&null===t)return 0;if(null===e)return-1;if(null===t)return 1;const n=e.top-t.top;return 0==n?e.left-t.left:n}class Annotations extends ContextPlugin{static get pluginName(){return"Annotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){if(super(e),this.collection=new AnnotationCollection,this._visibleAnnotations=new AnnotationCollection,this.set("activeAnnotations",new Set),this._bindAnnotationsToVisibleAnnotations(),e instanceof Editor){const t=e.locale;e.accessibility.addKeystrokeInfoGroup({id:"annotations",label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_GROUP"),keystrokes:[{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_MOVE_TO"),keystroke:"Ctrl+Shift+E"},{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_EXIT"),keystroke:"Esc"},{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_ENTER"),keystroke:"Enter"},{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_BROWSE_GROUPS"),keystroke:[["Tab"],["Shift+Tab"]]},{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_SUBMIT_COMMENT"),keystroke:["Ctrl+Enter"]},{label:getTranslation$f(t,"ACCESSIBILITY_HELP_ANNOTATIONS_NAVIGATE_THREADS"),keystroke:[["Arrowup"],["Arrowdown"]]}]})}this._setupEnterAnnotationKeystroke(),this._setupEscapeAnnotationHandling()}add(e){this.collection.add(e)}remove(e){this.collection.remove(e),e.destroy()}refreshVisibility(){for(const e of this.collection)e.refreshVisibility()}refreshPositioning(){this._visibleAnnotations.refreshPositioning()}getByInnerView(e){return this.collection.getByInnerView(e)}deactivateAll(){this.fire("_deactivateAllAnnotations")}destroy(){for(const e of this.collection)e.destroy();this._visibleAnnotations.destroy(),this.collection.destroy(),super.destroy()}activate(e){this.fire("_activateAnnotation",e)}createAnnotation(e){return new Annotation$1(e)}createAnnotationView(e,t){return new AnnotationView(e,t)}_addActiveAnnotation(e){const t=new Set(this.activeAnnotations);t.add(e),this.activeAnnotations=t}_removeActiveAnnotation(e){const t=new Set(this.activeAnnotations);t.delete(e),this.activeAnnotations=t}_bindAnnotationsToVisibleAnnotations(){const e=this.collection,t=this._visibleAnnotations;function n(e){const n=e.source;n.isVisible&&!t.has(n)?t.add(n):!n.isVisible&&t.has(n)&&t.remove(n),n.view.focusTracker.remove(n.view.element),n.view.focusTracker.add(n.view.element)}this.listenTo(e,"add",((e,i)=>{i.isVisible&&t.add(i),this.listenTo(i,"change:isVisible",n)})),this.listenTo(e,"remove",((e,i)=>{t.has(i)&&t.remove(i),this.stopListening(i,"change:isVisible",n)}))}_setupEnterAnnotationKeystroke(){const e=e=>{e.on("ready",(()=>{e.keystrokes.set(FOCUS_ANNOTATION_KEYSTROKE,((e,t)=>{const n=first(this.activeAnnotations.values());n&&(n.view.focus(),t())}))}))};this.context instanceof Editor?e(this.context):this.context.editors&&this.context.editors.on("add",((t,n)=>{e(n)}))}_setupEscapeAnnotationHandling(){const e=e=>{const t=e.source,n=[];let i;if(Array.isArray(t.target)){i=t.target[0],this.context instanceof Editor?n.push(this.context):this.context.editors&&n.push(...this.context.editors);for(const e of n)for(const t of e.editing.view.domRoots.values())if(t.contains(i))return void e.editing.view.focus();i.focus()}};this.listenTo(this.collection,"add",((t,n)=>{this.listenTo(n,"escape",e,{priority:"low"})})),this.listenTo(this.collection,"remove",((t,n)=>{this.stopListening(n,"escape",e)}))}}const noChannel=Symbol("noChannel"),defaultPermissions={admin:!0,modifyAll:!1,write:!0,resolve:!0};class CommentsRepository extends ContextPlugin{static get requires(){return[Annotations,PendingActions,Users]}static get pluginName(){return"CommentsRepository"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._threads=new Map,this._threadToController=new Map,this._viewToController=new Map,this.set("_readOnlyChannels",new Set),this.set("_permissions",new Map);const t=this.context.config;t.define("comments.maxCommentsWhenCollapsed",2),t.define("comments.maxThreadTotalWeight",500),t.define("comments.maxCommentCharsWhenCollapsed",140),t.define("comments.CommentThreadView",CommentThreadView),t.define("comments.CommentView",CommentView),t.get("comments.editorConfig")||console.warn("Missing comments editor configuration (`comments.editorConfig`). Default configuration will be used instead.")}init(){const e=this.context.plugins.get(Annotations);this.set("activeCommentThread",null),this.on("addCommentThread",((e,t)=>this._addCommentThread(t))),this.on("submitCommentThread",((e,t)=>this._submitCommentThread(t))),this.on("resolveCommentThread",((e,t)=>this._resolveCommentThread(t))),this.on("resolveCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("reopenCommentThread",((e,t)=>this._reopenCommentThread(t))),this.on("reopenCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("removeCommentThread",((e,t)=>this._removeCommentThread(t))),this.on("updateCommentThread",((e,t)=>this._updateCommentThread(t))),this.on("updateCommentThread",((e,t)=>this._updateActiveAnnotation(t)),{priority:"lowest"}),this.on("addComment",((e,t)=>this._addComment(t))),this.on("updateComment",((e,t)=>this._updateComment(t))),this.on("removeComment",((e,t)=>this._removeComment(t))),this.on("addComment",((e,{threadId:t,isFromAdapter:n})=>{if(n)return;const i=this.getCommentThread(t),r=i&&this._threadToController.get(i);r&&r.view.commentsListView.focus(-1)}),{priority:"lowest"}),this.listenTo(e,"change:activeAnnotations",((e,t,n)=>{const i=Array.from(n).map((e=>this._viewToController.get(e.innerView))).filter(Boolean)[0];this.activeCommentThread=i?i.model:null}))}set adapter(e){if(this._adapter)throw new CKEditorError("commentsrepository-adapter-already-set");this._adapter=e}get adapter(){return this._adapter}addCommentThread({channelId:e=noChannel,threadId:t=uid(),comments:n=[],unlinkedAt:i=null,resolvedAt:r=null,resolvedBy:s=null,target:o=null,context:a=null,attributes:l={},isResolvable:c=!0,isSubmitted:d=!1,isFromAdapter:u=!1}={}){return this.fire(toEventName("addCommentThread",e),{channelId:e,threadId:t,comments:n,unlinkedAt:i,resolvedAt:r,resolvedBy:s,target:o,context:a,attributes:l,isFromAdapter:u,isResolvable:c,isSubmitted:d}),this.getCommentThread(t)}openNewCommentThread({channelId:e=noChannel,threadId:t=uid(),target:n,context:i=null,isResolvable:r=!0}){if(this._readOnlyChannels.has(e)||this._readOnlyChannels.has(void 0))return null;if(!n)throw new CKEditorError("commentsrepository-missing-target");const s=this.addCommentThread({channelId:e,threadId:t,target:n,context:i,isResolvable:r});if(!s)return null;const o=this._threadToController.get(s),a=o.view.commentThreadInputView.commentInputView,l=this.context.plugins.get(Annotations),c=l.getByInnerView(o.view);return l.activate(c),a.once("editorReady",(()=>a.focus())),s}hasCommentThread(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.has(e)}updateCommentThread({channelId:e=noChannel,threadId:t,context:n,unlinkedAt:i,attributes:r,isFromAdapter:s=!1}){return this.fire(toEventName("updateCommentThread",e),{channelId:e,threadId:t,context:n,unlinkedAt:i,attributes:r,isFromAdapter:s}),this.getCommentThread(t)}getCommentThread(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.get(e)}fetchCommentThread({channelId:e,threadId:t}={}){const n=this.getCommentThread(t);if(n)return Promise.resolve(n);if(!this.adapter)return Promise.resolve(void 0);if("function"!=typeof this.adapter.getCommentThread)throw new CKEditorError("commentsrepository-missing-thread-and-adapter-method",this.context);return this.adapter.getCommentThread({channelId:e,threadId:t}).then((n=>this.hasCommentThread(t)?this.getCommentThread(t):n?this.addCommentThread(Object.assign({isFromAdapter:!0,channelId:e},n)):void 0)).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-fetch-comment-thread",this.context)}))}getCommentThreads({channelId:e,skipNotAttached:t=!1,skipEmpty:n=!1,toJSON:i=!1}={}){const r=[];for(const i of this._threads.values())e&&i.channelId!==e||t&&!i.isAttached||n&&0===i.length||r.push(i);return i?r.map((e=>e.toJSON())):r}setActiveCommentThread(e){const t=this.context.plugins.get(Annotations);if(!e)return void(this.activeCommentThread&&t.deactivateAll());const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-active-missing-comment-thread",null,{threadId:e});if(!this._threadToController.has(n))throw new CKEditorError("commentsrepository-active-not-attached",null,{threadId:e});const i=t.getByInnerView(this._threadToController.get(n).view);t.activate(i)}switchReadOnly(e,t){e?this._readOnlyChannels.add(t):this._readOnlyChannels.delete(t),this.fire("change:_readOnlyChannels","_readOnlyChannels",this._readOnlyChannels,this._readOnlyChannels)}isReadOnly(e){return this._readOnlyChannels.has(e)||this._readOnlyChannels.has(void 0)}createCommentThreadController(e,t){return new CommentThreadController(e,t)}setPermissions(e,t=noChannel){this._permissions.set(t,e),this.fire("change:_permissions","_permissions",this._permissions,this._permissions)}getPermissions(e=noChannel){return this._permissions.has(e)?this._permissions.get(e):defaultPermissions}_addCommentThread({channelId:e,threadId:t,comments:n,unlinkedAt:i,resolvedAt:r,resolvedBy:s,target:o,context:a,attributes:l,isFromAdapter:c,isResolvable:d,isSubmitted:u}){if("string"!=typeof t)throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:t});if(this.hasCommentThread(t))throw new CKEditorError("commentsrepository-duplicated-comment-thread-id",null,{threadId:t});const h=new CommentThread(this,{channelId:e,id:t,context:a,attributes:l,unlinkedAt:i,resolvedAt:r,resolvedBy:s?this.context.plugins.get(Users).getUser(s):null,isResolvable:d,isSubmitted:u||c});this._threads.set(t,h);for(const e of n)h._add(this._createNewComment({threadId:t,...e}));return o&&h.attachTo(o),c||!h.length?Promise.resolve():this._submitCommentThread({channelId:e,threadId:t})}_submitCommentThread({channelId:e,threadId:t}){if(!this.hasCommentThread(t))throw new CKEditorError("commentsrepository-missing-comment-thread",this);const n=this.getCommentThread(t);if(n._isSubmitted=!0,!this.adapter||"function"!=typeof this.adapter.addCommentThread)return Promise.resolve();const{id:i,comments:r,resolvedAt:s,resolvedBy:o,context:a,attributes:l}=n,c=this.context.plugins.get("PendingActions"),d=c.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.addCommentThread({channelId:e,threadId:i,comments:r.map((e=>e.toJSON())),resolvedAt:s,resolvedBy:o?o.id:o,context:a,attributes:l}).then((({comments:n})=>{c.remove(d);for(const i of n)this._updateComment({channelId:e,threadId:t,commentId:i.commentId,createdAt:i.createdAt,isFromAdapter:!0})})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-add-comment-thread-internal-error",this)}))}_attachCommentThread({threadId:e,target:t}){const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-attach-missing-comment-thread",this);const i=this.context.plugins.get("PendingActions"),r=this.context.plugins.get(Annotations),s=this._createCommentThreadView(n),o=new CommentThreadController(n,s);let a=null;s.on("change:isDirty",((e,t,n)=>{n?a=i.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD")):a&&(i.remove(a),a=null)})),this._threadToController.set(n,o),this._viewToController.set(s,o);const l=new AnnotationView(this.context.locale,s);l.bind("length").to(s),l.bind("isDirty").to(s,"isDirty",s,"length",((e,t)=>e||!t)),l.bind("isActive").to(s),l.type="comment";const c=new Annotation$1({view:l,target:t,type:"comment",isVisible:!n.archivedAt});return s.on("escape",(()=>{c.fire("escape")})),this._bindAnnotationToEditors(s,c),r.add(c),c}_bindAnnotationToEditors(e,t){this.listenTo(e,"editorReady",((e,n)=>{const i=n.ui.view.body.bodyCollectionContainer;t.focusableElements.add(i),this.context instanceof Editor&&this.context.ui.focusTracker.add(i)}),{priority:"highest"}),this.listenTo(e,"editorDestroyed",((e,n)=>{const i=n.ui.view.body.bodyCollectionContainer;t.focusableElements.has(i)&&t.focusableElements.remove(i),this.context instanceof Editor&&this.context.ui.focusTracker.remove(i)}))}_unbindEditors(e){this.stopListening(e,"editorReady"),this.stopListening(e,"editorDestroyed")}_createCommentThreadView(e){const t=this.context.plugins.get(Users),{config:n,locale:i}=this.context,r=getDateTimeFormatter(n.get("locale"));return new(0,n.get("comments").CommentThreadView)(i,e,t.me,{editorConfig:{...n.get("comments.editorConfig"),licenseKey:this.context.config.get("licenseKey")},copyMarkers:n.get("comments.copyMarkers"),maxCommentsWhenCollapsed:n.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:n.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:n.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:r,CommentView:n.get("comments").CommentView})}_resolveCommentThread({threadId:e,channelId:t,resolvedAt:n,resolvedBy:i,isFromAdapter:r}){if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const s=this.getCommentThread(e);if(s.isResolved)throw new CKEditorError("commentsrepository-resolved-comment-thread",null,{threadId:e});const o=this.context.plugins.get(Users);if(s.resolvedBy=o.getUser(i),s.resolvedAt=n,r||!this.adapter||"function"!=typeof this.adapter.resolveCommentThread)return Promise.resolve();const a=this.context.plugins.get("PendingActions"),l=a.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.resolveCommentThread({channelId:t,threadId:e}).then((({resolvedAt:e,resolvedBy:t})=>{a.remove(l),s.resolvedBy.id!==t&&(s.resolvedBy=o.getUser(t)),s.resolvedAt=e})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-resolve-comment-thread-internal-error",this)}))}_reopenCommentThread({threadId:e,channelId:t,isFromAdapter:n}){if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const i=this.getCommentThread(e);if(!i.isResolved)throw new CKEditorError("commentsrepository-reopen-comment-thread",null,{threadId:e});if(i.resolvedBy=null,i.resolvedAt=null,n||!this.adapter||"function"!=typeof this.adapter.reopenCommentThread)return Promise.resolve();const r=this.context.plugins.get("PendingActions"),s=r.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.reopenCommentThread({channelId:t,threadId:e}).then((()=>r.remove(s))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-reopen-comment-thread-internal-error",this)}))}_removeCommentThread({threadId:e,isFromAdapter:t}){const n=this.getCommentThread(e);if(!n)throw new CKEditorError("commentsrepository-remove-missing-comment-thread",this);if(this._detachCommentThread(e),this._threads.delete(e),!n.isSubmitted||t||!this.adapter||"function"!=typeof this.adapter.removeCommentThread)return Promise.resolve();const i=this.context.plugins.get("PendingActions"),{channelId:r}=n,s=i.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeCommentThread({channelId:r,threadId:e}).then((()=>i.remove(s))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-remove-comment-thread-internal-error",this)}))}_updateCommentThread({threadId:e,unlinkedAt:t,context:n,attributes:i,isFromAdapter:r}){if("string"!=typeof e)throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:e});if(!this.hasCommentThread(e))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:e});const s=this.getCommentThread(e);let o=!1;if(void 0!==n&&s.context!==n&&(s.context=n,o=!0),void 0!==t&&s.unlinkedAt!==t&&(s.unlinkedAt=t,o=!0),i&&!isEqual(i,s.attributes)&&(s.attributes=i,o=!0),!o)return Promise.resolve();if(!s.isSubmitted||r||!this.adapter||"function"!=typeof this.adapter.updateCommentThread)return Promise.resolve();const a=this.context.plugins.get("PendingActions"),{channelId:l}=s,c=a.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateCommentThread({channelId:l,threadId:e,context:n,unlinkedAt:t,attributes:i}).then((()=>a.remove(c))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-update-comment-thread-internal-error",this)}))}_detachCommentThread(e){const t=this.context.plugins.get(Annotations),n=this.getCommentThread(e);if(n._isAttached=!1,this._threadToController.has(n)){const e=this._threadToController.get(n),i=e.view,r=t.getByInnerView(i);this._threadToController.delete(n),this._viewToController.delete(i),r&&t.remove(r),e.destroy(),i.destroy().then((()=>{this._unbindEditors(i)}))}}_updateActiveAnnotation({threadId:e,resolvedAt:t}){const n=!!t,i=this.context.plugins.get(Annotations),r=this.getCommentThread(e);if(this._threadToController.has(r)){const e=this._threadToController.get(r).view,t=i.getByInnerView(e);t&&(n&&i._removeActiveAnnotation(t),t.refreshVisibility())}}_getExternalAuthor(e){const t=this.context.plugins.get(Users),n=hashObject("external:"+e);return t.getUser(n)||t.addUser({id:n,name:e})}_createNewComment({threadId:e,commentId:t=uid(),content:n,authorId:i,createdAt:r,attributes:s}){if("string"!=typeof t)throw new CKEditorError("commentsrepository-invalid-commentid");if("string"!=typeof i)throw new CKEditorError("commentsrepository-invalid-comment-authorid");if("string"!=typeof n||!n.trim())throw new CKEditorError("commentsrepository-invalid-comment-content");const o=this.context.plugins.get(Users).getUser(i);if(!o)throw new CKEditorError("commentsrepository-add-comment-user-not-exists",null,{authorId:i});let a=null,l=r;return s&&s["@external"]&&(a=this._getExternalAuthor(s["@external"].authorName),l=new Date(s["@external"].createdAt)),new Comment(this,{threadId:e,id:t,author:a||o,creator:o,content:n,createdAt:r,authoredAt:l,attributes:s})}_addComment(e){let{threadId:t,content:n,attributes:i,isFromAdapter:r}=e;const s=this.getCommentThread(e.threadId);if(!s)throw new CKEditorError("commentsrepository-add-comment-to-missing-comment-thread",this);const o=this._createNewComment(e),{id:a}=o;if(s._add(o),r||!this.adapter||"function"!=typeof this.adapter.addComment||!s.isSubmitted)return Promise.resolve();const l=this.context.plugins.get("PendingActions"),{channelId:c}=s,d=l.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return i||(i={}),this.adapter.addComment({channelId:c,threadId:t,commentId:a,content:n,attributes:i}).then((e=>{l.remove(d),e&&this._updateComment({channelId:c,threadId:t,commentId:a,createdAt:e.createdAt,isFromAdapter:!0})})).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-add-comment-internal-error",this)}))}_updateComment({threadId:e,commentId:t,content:n,createdAt:i,attributes:r,isFromAdapter:s}){if(void 0!==n&&("string"!=typeof n||!n.trim().length))throw new CKEditorError("commentsrepository-update-comment-invalid-content");const o=this.getCommentThread(e),a=o.getComment(t);if(!a)throw new CKEditorError("commentsrepository-update-missing-comment",this);let l=!1;if(n&&n!==a.content&&(a.isEditable||s)&&(a.content=n,l=!0),i&&i!==a.createdAt&&(a.createdAt=i,a.attributes&&a.attributes["@external"]||(a.authoredAt=i),l=!0),r&&!isEqual(r,a.attributes)&&(a.attributes=r,l=!0),!l)return Promise.resolve();if(o.fire("commentUpdated"),s||!this.adapter||"function"!=typeof this.adapter.updateComment)return Promise.resolve();const c=this.context.plugins.get("PendingActions"),{channelId:d}=this.getCommentThread(a.threadId),u=c.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateComment({channelId:d,threadId:e,commentId:t,content:n,attributes:r}).then((()=>c.remove(u))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-update-comment-internal-error",this)}))}_removeComment({threadId:e,commentId:t,isFromAdapter:n}){const i=this.getCommentThread(e),r=i.getComment(t);if(!r)throw new CKEditorError("commentsrepository-remove-missing-comment",this);if(i._remove(r),n||!this.adapter||"function"!=typeof this.adapter.removeComment)return Promise.resolve();const s=this.context.plugins.get("PendingActions"),{channelId:o}=i,a=s.add(getTranslation$f(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeComment({channelId:o,threadId:e,commentId:t}).then((()=>s.remove(a))).catch((e=>{throw console.error(e),new CKEditorError("commentsrepository-remove-comment-internal-error",this)}))}}class CommentThread extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super();const n=t.isResolvable;this.channelId=t.channelId,this.id=t.id,this.comments=new Collection,this._repository=e,this._isAttached=!1,this._isSubmitted=t.isSubmitted,this.set("_hasTargetInContent",!0),this.bind("isReadOnly").to(e,"_permissions",e,"_readOnlyChannels",(()=>e.isReadOnly(this.channelId))),this.bind("isRemovable").to(e,"_permissions",(()=>e.getPermissions(this.channelId).admin)),this.bind("canComment").to(e,"_permissions",(()=>{const t=e.getPermissions(this.channelId);return t.write||t.admin})),this.bind("isResolvable").to(e,"_permissions",(()=>n&&e.getPermissions(this.channelId).resolve)),this.set("context",t.context),this.bind("archivedAt").to(this,"resolvedAt",this,"unlinkedAt",((e,t)=>e?t?e<t?e:t:e:t)),this.set("unlinkedAt",t.unlinkedAt||null),this.set("resolvedAt",t.resolvedAt||null),this.set("resolvedBy",t.resolvedBy||null),this.bind("isResolved").to(this,"resolvedAt",(e=>!!e)),this.set("attributes",t.attributes||{})}get weight(){return Array.from(this.comments).reduce(((e,t)=>e+t.weight),0)}get length(){return this.comments.length}get isAttached(){return this._isAttached}get isSubmitted(){return this._isSubmitted}submit(){const{channelId:e,id:t}=this;this._repository.fire(toEventName("submitCommentThread",e),{channelId:e,threadId:t})}setUnlinkedAt(e){this._update({unlinkedAt:e})}resolve({resolvedAt:e=new Date,resolvedBy:t=null,isFromAdapter:n=!1}={}){const i=this._repository.context.plugins.get(Users).me,{channelId:r,id:s}=this;this._repository.fire(toEventName("resolveCommentThread",r),{channelId:r,threadId:s,resolvedAt:e,resolvedBy:t||i.id,isFromAdapter:n})}reopen({isFromAdapter:e=!1}={}){const{channelId:t,id:n}=this;this._repository.fire(toEventName("reopenCommentThread",t),{channelId:t,threadId:n,isFromAdapter:e})}setContext(e){this.context||this._update({context:e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this._update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this._update({attributes:t})}remove({isFromAdapter:e=!1}={}){const{channelId:t,id:n}=this;this._repository.fire(toEventName("removeCommentThread",t),{channelId:t,threadId:n,isFromAdapter:e})}attachTo(e){return this._repository._attachCommentThread({threadId:this.id,target:e})}addComment(e){const{channelId:t,id:n}=this;this._repository.fire(toEventName("addComment",t,n),Object.assign({channelId:t,threadId:n},e))}getComment(e){if("string"!=typeof e)throw new CKEditorError("commentsrepository-get-comment-invalid-id",null,{commentId:e});return this.comments.get(e)}toJSON(){return{threadId:this.id,context:this.context,unlinkedAt:this.unlinkedAt,resolvedAt:this.resolvedAt,resolvedBy:this.resolvedBy?this.resolvedBy.id:null,archivedAt:this.archivedAt,comments:this.comments.map((e=>e.toJSON())),attributes:this.attributes}}_add(e){return this.listenTo(e,"change:authoredAt",(()=>{const t=this._findOptimalIndex(e),n=this.comments;t-1!=n.getIndex(e)&&t+1!=n.getIndex(e)&&(this._remove(e),this._add(e))})),this.comments.add(e,this._findOptimalIndex(e))}_update(e){const{channelId:t,id:n}=this;this._repository.fire(toEventName("updateCommentThread",t),{...e,channelId:t,threadId:n})}_remove(e){return this.stopListening(e),e.destroy(),this.comments.remove(e)}_findOptimalIndex(e){const t=this.comments.find((t=>new Date(t.authoredAt).getTime()>new Date(e.authoredAt).getTime()));return t?this.comments.getIndex(t):this.length}}const MIN_WEIGHT=200;function getContentLength(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent.length}class Comment extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super();const n=e.context.plugins.get(Users).me,i=e.getCommentThread(t.threadId),r=0===i.comments.length,s=n===t.author;this.id=t.id,this.threadId=t.threadId,this.author=t.author,this.creator=t.creator,this.isExternal=Boolean(t.attributes&&t.attributes["@external"]),this.set("content",t.content),this.createdAt=t.createdAt||new Date,this.set("authoredAt",t.authoredAt||new Date),this.bind("resolvedAt").to(i,"resolvedAt"),this.set("attributes",t.attributes||{}),this.bind("isEditable").to(e,"_permissions",(()=>{const t=e.getPermissions(i.channelId).write,n=e.getPermissions(i.channelId).modifyAll;return s&&t||!s&&n})),this.bind("isRemovable").to(i,"isRemovable",e,"_permissions",(t=>{const n=e.getPermissions(i.channelId).write,o=e.getPermissions(i.channelId).modifyAll;return s&&n||t&&r||!s&&o&&!r})),this.bind("isReadOnly").to(i,"isReadOnly"),this._repository=e}get weight(){return Math.max(getContentLength(this.content),MIN_WEIGHT)}update(e){const{threadId:t,id:n}=this;if(!this._repository.hasCommentThread(t))throw new CKEditorError("commentsrepository-update-comment-missing-comment-thread",this);const{channelId:i}=this._repository.getCommentThread(t);this._repository.fire(toEventName("updateComment",i,t),{channelId:i,threadId:t,commentId:n,...e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this.update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this.update({attributes:t})}remove(e={}){if(!e.isFromAdapter&&!this.isRemovable)return;const{threadId:t,id:n}=this;if(!this._repository.hasCommentThread(t))throw new CKEditorError("commentsrepository-remove-comment-missing-comment-thread",this);const{channelId:i}=this._repository.getCommentThread(t);this._repository.fire(toEventName("removeComment",i,t),{channelId:i,threadId:t,commentId:n,...e})}toJSON(){return{commentId:this.id,content:this.content,createdAt:this.createdAt,authorId:this.creator.id,attributes:this.attributes}}destroy(){this.stopListening()}}function toEventName(e,...t){for(const n of t)void 0!==n&&(e+=":"+String(n));return e}class AddCommentThreadCommand extends _0x338ed0{refresh(){const e=this.editor.model.document.selection;for(const t of e.getRanges())if(this._hasContent(t))return void(this.isEnabled=!0);this.isEnabled=!1}execute({threadId:e=uid()}={}){const t=this.editor.model,n=[];for(const e of t.document.selection.getRanges())this._hasContent(e)&&n.push(this._trimToContent(e));t.change((t=>{for(const i of n){const n=uid().substr(1,5),r="comment:"+e+":"+n;t.addMarker(r,{range:i,usingOperation:!1,affectsData:!1})}}))}_hasContent(e){for(const t of e.getItems())if(this._itemIsContent(t))return!0;return!1}_itemIsContent(e){return e.is("$textProxy")||this.editor.model.schema.isObject(e)&&!e.is("element","tableCell")}_trimToContent(e){const t=e=>!this._itemIsContent(e.item),n=e.start.getLastMatchingPosition(t),i=e.end.getLastMatchingPosition(t,{direction:"backward"});return this.editor.model.createRange(n,i)}}class EditorAnnotations extends Plugin{static get requires(){return[Annotations]}static get pluginName(){return"EditorAnnotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._dataCollectors=new Set,this._editorAnnotations=new Set}init(){const e=this.editor,t=e.model.document.selection,n=debounce$1((()=>this.refreshSelectedViews()),10);t.on("change:range",((e,t)=>{t.directChange&&(n.cancel(),this.refreshSelectedViews())})),this.listenTo(e.editing.view.document,"change:isFocused",((e,t,i)=>{i&&n()})),this.listenTo(e.ui.focusTracker,"change:isFocused",((t,n,i)=>{i||e.isReadOnly||this.fire("blur",{isAnnotationTracked:e=>this._editorAnnotationsData.has(e.innerView)})})),this.listenTo(this.editor.ui,"update",(()=>this.fire("uiUpdate")))}registerAnnotation(e){if(this._editorAnnotations.has(e.view))return;this._editorAnnotations.add(e.view),this.editor.ui.focusTracker.add(e.view.element);const t=this.editor.plugins.get(Annotations);this.listenTo(t.collection,"remove",((e,t)=>{this.editor.ui.focusTracker.remove(t.view.element),this._editorAnnotations.delete(t.view)}))}hasDomSelection(){return this.editor.editing.view.hasDomSelection}addSourceCollector(e){if("function"!=typeof e)throw new CKEditorError("editorannotations-invalid-source-callback");this._dataCollectors.add(e)}refreshSelectedViews(){this.fire("refresh")}getOrderedSelectedAnnotations({activeAnnotation:e,annotations:t}){const n=[],i=this.editor.model.document.selection,r=Array.from(i.getRanges());for(const[e,i]of this._editorAnnotationsData){const r=s(i),o=t.getByInnerView(e);r&&o&&n.push({annotation:o,range:r})}function s(e){for(const t of e)for(const e of r)if(t.containsRange(e,!i.isCollapsed))return t;return null}return n.sort(((t,n)=>{const i=t.range,r=n.range;if(!i.isEqual(r)){if(i.containsRange(r,!0))return 1;if(r.containsRange(i,!0))return-1}return t.annotation==e?-1:n.annotation==e?1:0})).map((e=>e.annotation))}get _editorAnnotationsData(){const e=new Map;for(const t of Array.from(this._dataCollectors))for(const[n,i]of t())e.set(n,i);return e}}class CommentsRestrictedEditingMode extends Plugin{afterInit(){const e=this.editor;e.plugins.has("RestrictedEditingModeEditing")&&e.plugins.get("RestrictedEditingModeEditing").enableCommand("addCommentThread")}}class CommentsImportWord extends Plugin{constructor(e){super(e),this.editor.config.define("importWord.formatting.comments","basic")}afterInit(){const e=this.editor,t=e.commands.get("importWord"),n=e.plugins.get(Users);t&&(t.on("execute",((e,[,t])=>{t.collaboration_features={comments:!0,user_id:n.me.id}}),{priority:priorities.high+10}),this.listenTo(t,"dataInsert",this._handleImportedData))}_handleImportedData(e,t){const{comment_threads:n}=t;n&&n.forEach((({thread_id:e,comments:t,is_resolved:n})=>{const i=new Date,r=t.map((({author:e,content:t,created_at:n})=>({content:t,authorId:this.editor.plugins.get(Users).me.id,createdAt:i,attributes:{"@external":{authorName:e,createdAt:n?new Date(n):new Date,source:"importWord"}}}))),s=this.editor.config.get("collaboration.channelId");this.editor.plugins.get(CommentsRepository).addCommentThread({channelId:s,threadId:e,comments:r,resolvedAt:n?i:null})}))}}class CommentsClipboard extends Plugin{constructor(e){super(e),this.editor.config.define("comments.copyMarkers","default")}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline]}afterInit(){const e=this.editor.plugins.get("ClipboardPipeline");this._registerMarkerInClipboardPipeline(),this.listenTo(e,"contentInsertion",((e,t)=>this._removeMarkersWithoutThreads(t.content.markers)),{priority:"highest"})}_removeMarkersWithoutThreads(e){if(!this.editor.plugins.has("CommentsRepository"))return e;const t=this.editor.plugins.get("CommentsRepository");for(const n of e.keys()){const[i,r]=n.split(":");"comment"!=i||t.hasCommentThread(r)||e.delete(n)}return e}_registerMarkerInClipboardPipeline(){const e=this.editor.plugins.get("ClipboardMarkersUtils"),t=this._mapCommentsCopyConfigToRegisterConfiguration(this.editor.config.get("comments.copyMarkers"));t&&e._registerMarkerToCopy("comment",t)}_mapCommentsCopyConfigToRegisterConfiguration(e){switch(e){case"always":return{allowedActions:"all",copyPartiallySelected:!1,duplicateOnPaste:!0};case"default":return{allowedActions:["cut","dragstart"],copyPartiallySelected:!1,duplicateOnPaste:!1};default:return null}}}class ShowCommentHighlights extends Plugin{init(){this.overrideMarkerConverters(),this.overrideHorizontalRuleConverter(),this.overrideImageInlineConverter(),this.overrideMediaEmbedConverter()}overrideMarkerConverters(){this.editor.conversion.for("dataDowncast").markerToHighlight({model:"comment",view:(e,t)=>{if(!t.options.showCommentHighlights)return null;if(t.options.ignoreResolvedComments){const{id:n}=splitMarkerName(e.markerName),i=this.editor.plugins.get(CommentsRepository).getCommentThread(n);if(i&&i.isResolved&&e.item)return t.consumable.consume(e.item,"addMarker:"+e.markerName),t.consumable.consume(e.item,"removeMarker:"+e.markerName),null}return{classes:["ck-comment-marker"]}}}),this.editor.conversion.for("dataDowncast").add((e=>{e.on("addMarker:comment",((e,t,n)=>{if(!n.options.showCommentHighlights)return;const i=t.item;if(!i)return;const r=n.mapper.toViewElement(i);this.editor.model.schema.isObject(i)&&r&&!r.getCustomProperty("widget")&&r.is("containerElement")&&toWidget(r,n.writer)}),{priority:"high"})}))}overrideHorizontalRuleConverter(){this.editor.conversion.for("dataDowncast").elementToStructure({model:"horizontalLine",view:(e,{writer:t,options:n})=>{if(!n.showCommentHighlights)return null;const i=t.createContainerElement("div"),r=t.createEmptyElement("hr");return t.addClass("ck-horizontal-line",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}overrideImageInlineConverter(){this.editor.conversion.for("dataDowncast").elementToStructure({model:"imageInline",view:(e,{writer:t,options:n})=>{if(!n.showCommentHighlights)return null;const i=t.createContainerElement("span"),r=t.createEmptyElement("img");return t.addClass("image-inline",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}overrideMediaEmbedConverter(){this.editor.conversion.for("dataDowncast").elementToElement({model:"media",view:(e,{writer:t,options:n})=>{if(n.showCommentHighlights)return t.createEmptyElement("div")},converterPriority:"high"}),this.editor.data.downcastDispatcher.on("attribute:url:media",((e,t,n)=>{n.options.showCommentHighlights&&e.stop()}),{priority:"high"})}}const MAX_CONTEXT_LENGTH=150;class CommentsEditing extends Plugin{static get requires(){return[CommentsRepository,EditorAnnotations,Users,CommentsRestrictedEditingMode,CommentsImportWord,CommentsClipboard,ShowCommentHighlights]}static get pluginName(){return"CommentsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("isThreadsLoadingPaused",!0),e.data.once("ready",(()=>this.isThreadsLoadingPaused=!1)),this.set("activeMarker",null),this.on("change:activeMarker",((t,n,i,r)=>{const s=e.plugins.get(CommentsRepository),o=i?splitMarkerName(i).id:null;e.model.change((()=>{if(o){const t=this.getAllMarkersForId(o);for(const n of t)e.editing.reconvertMarker(n)}if(r){const{id:t}=splitMarkerName(r),n=s.getCommentThread(t);if(n&&!n.isAttached)return;const i=this.getAllMarkersForId(t);for(const t of i)e.editing.reconvertMarker(t)}})),o&&this.scrollToThreadMarker(o)})),this._initAriaMarkerChangeAnnouncements()}init(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=e.config.get("collaboration.channelId"),i=t.getCommentThreads().filter((e=>e.channelId!==n));e.commands.add("addCommentThread",new AddCommentThreadCommand(e)),this.listenTo(e,"change:isReadOnly",((n,i,r)=>{t.switchReadOnly(r,e.config.get("collaboration.channelId"))})),this.listenTo(t,createChannelEvent("addCommentThread",n),((e,{threadId:t})=>{const n=this.editor.plugins.get(CommentsRepository).getCommentThread(t);n&&n.unlinkedAt&&this._attachArchivedThread(t)})),this.listenTo(t,createChannelEvent("removeCommentThread",n),((t,{threadId:n})=>{e.model.enqueueChange({isUndoable:!1},(e=>{const t=this.getAllMarkersForId(n);for(const n of t)e.removeMarker(n)}))})),this.listenTo(t,createChannelEvent("resolveCommentThread",n),((e,{threadId:t})=>{this._reconvertMarkers(t),this.editor.editing.view.hasDomSelection&&(this.editor.plugins.get(CommentsRepository).getCommentThread(t).unlinkedAt||this.editor.editing.view.focus())}),{priority:"low"}),this.listenTo(t,createChannelEvent("reopenCommentThread",n),((e,{threadId:t})=>{this._reconvertMarkers(t)}),{priority:"low"}),this.listenTo(t,createChannelEvent("addComment",n),((n,{threadId:i,isFromAdapter:r})=>{const s=this.getAllMarkersForId(i);!r&&0!=s.length&&t.hasCommentThread(i)&&1===t.getCommentThread(i).length&&e.model.enqueueChange({isUndoable:!1},(e=>{for(const t of s)e.updateMarker(t,{usingOperation:!0,affectsData:!0})}))}),{priority:"low"}),this._initializeMarkerConverters(),this._handleMarkerAddAndRemove(),this._handleInitialThreads(i)}afterInit(){checkLicense$d(this)}destroy(){const e=this.editor.plugins.get(CommentsRepository),t=this.editor.config.get("collaboration.channelId");for(const n of e.getCommentThreads({channelId:t}))e._detachCommentThread(n.id),e._threads.delete(n.id);super.destroy()}hasMarkerForId(e){return this.getAllMarkersForId(e).length>0}getAllMarkersForId(e){const t=[];for(const n of this.editor.model.markers)n.name.startsWith("comment:"+e)&&t.push(n);return t}scrollToThreadMarker(e){const t=this._getTargetForId(e);t&&setTimeout((()=>{this.activeMarker&&splitMarkerName(this.activeMarker).id===e&&scrollViewportToShowTarget({target:t[0],viewportOffset:100,alignToTop:!0})}),50)}_reconvertMarkers(e){this.editor.model.change((()=>{for(const t of this.getAllMarkersForId(e))this.editor.editing.reconvertMarker(t)}))}_attachArchivedThread(e){const t=this.editor.plugins.get(CommentsRepository),n=this.editor.plugins.get(EditorAnnotations),i=t.getCommentThread(e);if(!i.isAttached){const e=i.attachTo((()=>this._getTargetForId(i.id)));n.registerAnnotation(e),i._hasTargetInContent=!1}}_initializeMarkerConverters(){const e=this.editor,t=e.plugins.get(Users);e.conversion.for("editingDowncast").markerToHighlight({model:"comment",view:(n,i)=>{const{id:r}=splitMarkerName(n.markerName),s=e.plugins.get(CommentsRepository).getCommentThread(r),o=this.activeMarker&&splitMarkerName(this.activeMarker).id===r;let a;if(s&&s.isResolved&&!o&&n.item)return i.consumable.consume(n.item,"addMarker:"+n.markerName),i.consumable.consume(n.item,"removeMarker:"+n.markerName),null;const l=["ck-comment-marker"];return o&&l.push("ck-comment-marker--active"),a=s&&s.length?s.comments.first.author.id:t.me.id,{classes:l,attributes:{"data-comment":r,"data-author-id":a}}}}),e.conversion.for("dataDowncast").markerToData({model:"comment",view:(t,{options:n})=>{if(n.showCommentHighlights)return null;const i=e.plugins.get(CommentsRepository),r=e.model.markers.get(t),{id:s,part:o}=splitMarkerName(t);if(r&&!r.affectsData)return null;if(n.ignoreResolvedComments){const e=i.getCommentThread(s);if(e&&e.isResolved)return null}return{group:"comment",name:o?s+":"+o:s}}}),e.conversion.for("upcast").elementToElement({view:{name:"comment",attributes:{id:/^\w/}},model:(e,{writer:t})=>t.createElement("$marker",{"data-name":"comment:"+e.getAttribute("id")})}),e.conversion.for("upcast").dataToMarker({view:"comment"})}_handleMarkerAddAndRemove(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=new Set,i=new Set;e.model.document.registerPostFixer((t=>{let r=!1;for(const{name:s,data:o}of e.model.document.differ.getChangedMarkers()){const{group:a,id:l}=splitMarkerName(s);let c=o.newRange;if("comment"!==a||!c)continue;const d="$graveyard"===c.root.rootName;d||(c=fixMarkerRange(c,e.model),!c||c.isCollapsed||!o.newRange||c.isEqual(o.newRange))?e.model.hasContent(c)&&!d?this.isThreadsLoadingPaused?n.add(s):this._handleThreadMarker(s,l):(i.add(s),n.delete(s),t.removeMarker(s),r=!0):(t.updateMarker(s,{range:c}),r=!0)}return r})),this.on("change:isThreadsLoadingPaused",((t,i,r)=>{if(!r&&n.size)for(const t of n){const{id:i}=splitMarkerName(t);n.delete(t),e.model.markers.get(t)&&this._handleThreadMarker(t,i)}})),this.listenTo(e.model.document,"change",(()=>{for(const{name:r,data:{newRange:s}}of e.model.document.differ.getChangedMarkers()){const{group:o,id:a}=splitMarkerName(r);if("comment"!==o)continue;const l=t.getCommentThread(a),c=this.hasMarkerForId(a);l&&(!l._hasTargetInContent&&s&&e.editing.view.once("render",(()=>{const n=e.plugins.get(Annotations),i=t._threadToController.get(l).view;n.getByInnerView(i).refreshVisibility()}),{priority:"low"}),l._hasTargetInContent=c||!!s),s||(i.add(r),n.delete(r))}for(const e of i){const{id:i}=splitMarkerName(e),r=t.getCommentThread(i);if(n.delete(e),!r)continue;const s=this.hasMarkerForId(i);s||r.isSubmitted?s||r.unlinkedAt||r.setUnlinkedAt(new Date):r.remove()}i.clear()}))}_handleInitialThreads(e){e.forEach((e=>{e.unlinkedAt&&this._attachArchivedThread(e.id)}))}_getTargetForId(e){const t=this.editor,n=this.getAllMarkersForId(e);return getAllMarkersDomElementsSorted(t.editing,n)}_getTextContext(e){const t=this.getAllMarkersForId(e);let n="",i=!1;for(const e of t){const t=e.getRange();for(const e of Array.from(t.getItems()))e.is("$textProxy")?(n&&i&&(n+=" ",i=!1),n+=e.data):i=!0;i=!0}return n.substring(0,MAX_CONTEXT_LENGTH)}_attachMarkerToThread(e,t){const n=this.editor,i=n.plugins.get(CommentsRepository);let r=i.getCommentThread(t);const s=n.config.get("collaboration.channelId"),o=n.plugins.get(EditorAnnotations);return r&&(r.unlinkedAt&&r.setUnlinkedAt(null),r.isAttached)||(this.getAllMarkersForId(t)[0].managedUsingOperations?i.fetchCommentThread({channelId:s,threadId:t}).then((e=>{if("destroyed"!==n.state)if(r=e,r&&!r.isAttached){const e=r.attachTo((()=>this._getTargetForId(t)));o.registerAnnotation(e),r.isResolved&&this._reconvertMarkers(t)}else if(!r){const e=this.getAllMarkersForId(t);n.model.change((t=>{for(const n of e)t.removeMarker(n)}))}})):n.editing.view.once("render",(()=>{if(i.getCommentThread(t))return;const e=n.plugins.get(Annotations);r=i.openNewCommentThread({channelId:s,threadId:t,target:()=>this._getTargetForId(t),context:{type:"text",value:this._getTextContext(t)}});const a=i._threadToController.get(r).view,l=e.getByInnerView(a);l&&o.registerAnnotation(l)}),{priority:"low"})),r}_handleThreadMarker(e,t){const n=this._attachMarkerToThread(e,t);n&&!n.context&&n.setContext({type:"text",value:this._getTextContext(t)})}_initAriaMarkerChangeAnnouncements(){const e=this.editor;surroundingMarkersDetector(e.model,(({left:t,entered:n})=>{for(const n of t)if(isCommentMarker(n)){e.ui.ariaLiveAnnouncer.announce(getTranslation$f(e.locale,"LEAVE_COMMENT_ANNOUNCEMENT"));break}for(const t of n)if(isCommentMarker(t)){e.ui.ariaLiveAnnouncer.announce(getTranslation$f(e.locale,"ENTER_COMMENT_ANNOUNCEMENT",getEnvKeystrokeText(FOCUS_ANNOTATION_KEYSTROKE)));break}}))}}function createChannelEvent(e,t){return t?e+":"+t:e}function splitMarkerName(e){const t=e.split(":");return{group:t[0],id:t[1],part:t[2]}}function fixMarkerRange(e,t){const n=t.schema,i=t.createRange(e.start);for(const r of e.getWalker()){const{type:e,item:s,nextPosition:o}=r;if("text"===e||n.isObject(s)){const e=t.createPositionBefore(s);i.isCollapsed&&(i.start=e),i.end=o}}return i}function isCommentMarker(e){return"comment"===splitMarkerName(e.name).group}async function checkLicense$d(e){const t=p([105,120,66,72,78,57,104,109,97,52,98,86,53,90,110,56,116,50,84,117,48,118,115,112,83,73,111,103,122,55,49,54,70,108,113,81,69,89,121,99,100,75,76,67,119,101,74,114,102,87,107,77,82,51,106,80,88,79,85,71,68,65]),n=window[p([68,97,116,101])][p([110,111,119])](),i=e[p([101,100,105,116,111,114])],r=new(window[p([80,114,111,109,105,115,101])])((e=>{i[p([111,110,99,101])](p([114,101,97,100,121]),e)})),s={[p([107,116,121])]:p([69,67]),[p([117,115,101])]:p([115,105,103]),[p([99,114,118])]:p([80,45,50,53,54]),[p([120])]:p([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[p([121])]:p([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[p([97,108,103])]:p([69,83,50,53,54])},o=i[p([99,111,110,102,105,103])][p([103,101,116])](p([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[p([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[p([116,104,101,110])]((()=>new(window[p([80,114,111,109,105,115,101])])((e=>{let t=0;i[p([109,111,100,101,108])][p([111,110])](p([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][p([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[p([111,102,102])]())}))}))))];return window[p([80,114,111,109,105,115,101])][p([114,97,99,101])](t)[p([116,104,101,110])]((()=>e))}function l(e){return e[p([115,116,97,114,116,115,87,105,116,104])](p([101,121]))?JSON[p([112,97,114,115,101])](c(e)):null}function c(e){return window[p([97,116,111,98])](e[p([114,101,112,108,97,99,101])](/-/g,p([43]))[p([114,101,112,108,97,99,101])](/_/g,p([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[p([108,101,110,103,116,104])];n++){const i=e[p([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[p([105,115,65,114,114,97,121])](t)?t[p([102,111,114,69,97,99,104])](e):t&&typeof t==p([111,98,106,101,99,116])?Object[p([101,110,116,114,105,101,115])](t)[p([115,111,114,116])]()[p([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[p([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[p([116,111,83,116,114,105,110,103])](16)[p([112,97,100,83,116,97,114,116])](8,p([48]))}function h(e){return e[p([115,112,108,105,116])]("")[p([114,101,118,101,114,115,101])]()[p([106,111,105,110])]("")}function m(e){return i[p([112,108,117,103,105,110,115])][p([104,97,115])](e)}function g(){}function p(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[p([83,116,114,105,110,103])](window[p([112,101,114,102,111,114,109,97,110,99,101])][p([110,111,119])]())[p([114,101,112,108,97,99,101])](p([46]),"");let n=p([105]);for(let i=0;i<e[p([108,101,110,103,116,104])];i+=2){let r=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[p([108,101,110,103,116,104])]&&(r-=t[p([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=p([99,111,109,109,101,110,116,115,76,105,99,101,110,115,101,75,101,121])+e,e!=p([86,97,108,105,100])&&async function(){await r,i[p([109,111,100,101,108])][p([99,104,97,110,103,101])]=g,i[p([109,111,100,101,108])][p([101,110,113,117,101,117,101,67,104,97,110,103,101])]=g,i[p([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](p([109,111,100,101,108]))}()}(await async function(){let e,t=null,g=null;try{if(o==p([71,80,76]))return p([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[p([115,112,108,105,116])](p([46]));if(3!=e[p([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[p([106,116,105])],n=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](e[p([108,101,110,103,116,104])]-8),16),i={...t,[p([106,116,105])]:e[p([115,117,98,115,116,114,105,110,103])](0,e[p([108,101,110,103,116,104])]-8)};return delete i[p([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return p([73,110,118,97,108,105,100]);e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(f=e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[p([106,116,105])],g=new(window[p([80,114,111,109,105,115,101])])((e=>{if(i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==p([97,117,116,111]))return e(p([86,97,108,105,100]));i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=p([97,117,116,111]),i[p([100,101,99,111,114,97,116,101])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[p([80,114,111,109,105,115,101])])(((e,t)=>{i[p([116,104,101,110])](e,t),window[p([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[p([116,104,101,110])]((e=>e&&e[p([115,116,97,116,117,115])]==p([111,107])?u(d(s+y))!=e[p([118,101,114,105,102,105,99,97,116,105,111,110])]?p([85,115,97,103,101,76,105,109,105,116]):p([86,97,108,105,100]):p([85,115,97,103,101,76,105,109,105,116])))[p([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=p([108,108,99,116,45])+u(d(f)),t=window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([103,101,116,73,116,101,109])](e);return t?window[p([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),p([86,97,108,105,100])):p(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[p([116,104,101,110])](e)[p([99,97,116,99,104])]((()=>{e(p([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=p([108,108,99,116,45])+u(d(f)),t=h(u(window[p([77,97,116,104])][p([99,101,105,108])](n/r)));window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([115,101,116,73,116,101,109])](e,t)}}i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=f)return e(p([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[p([114,101,113,117,101,115,116,73,100])]:s}}),{[p([112,114,105,111,114,105,116,121])]:p([104,105,103,104])}),i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[p([114,101,116,117,114,110])])&&(typeof n===p([111,98,106,101,99,116])||typeof n===p([102,117,110,99,116,105,111,110]))&&typeof n[p([116,104,101,110])]===p([102,117,110,99,116,105,111,110])&&typeof n[p([99,97,116,99,104])]===p([102,117,110,99,116,105,111,110])&&(t=!0,o(e[p([114,101,116,117,114,110])]))}),{[p([112,114,105,111,114,105,116,121])]:p([108,111,119])}),r[p([116,104,101,110])]((()=>{t||e(p([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[p([115,112,108,105,116])](p([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[p([97,108,103])]==p([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[p([85,105,110,116,56,65,114,114,97,121])][p([102,114,111,109])](c(i),(e=>e[p([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[p([84,101,120,116,69,110,99,111,100,101,114])]))[p([101,110,99,111,100,101])](t+p([46])+n),a=window[p([99,114,121,112,116,111])][p([115,117,98,116,108,101])];if(!a)return;const l=await a[p([105,109,112,111,114,116,75,101,121])](p([106,119,107]),s,{[p([110,97,109,101])]:p([69,67,68,83,65]),[p([110,97,109,101,100,67,117,114,118,101])]:p([80,45,50,53,54])},!1,[p([118,101,114,105,102,121])]);await a[p([118,101,114,105,102,121])]({[p([110,97,109,101])]:p([69,67,68,83,65]),[p([104,97,115,104])]:{[p([110,97,109,101])]:p([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[p([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[p([105,110,99,108,117,100,101,115])](p([42])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([67,77,84])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([82,67,77,84]))){if(m(p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&(n=p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]),i[p([112,108,117,103,105,110,115])][p([103,101,116])](n))[p([115,116,97,116,101])]==p([99,111,110,110,101,99,116,101,100]))return!0;if(m(p([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||m(p([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}var n;return!1}()?function(){const t=[p([101,118,97,108,117,97,116,105,111,110]),p([116,114,105,97,108])][p([105,110,99,108,117,100,101,115])](e[p([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[p([101,120,112])]<t}()?p([69,120,112,105,114,101,100]):function(){const t=e[p([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[p([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[p([108,111,99,97,116,105,111,110])].href);if(t[p([105,110,99,108,117,100,101,115])](n))return!0;const i=n[p([115,112,108,105,116])](p([46]));return t[p([102,105,108,116,101,114])]((e=>e[p([105,110,99,108,117,100,101,115])](p([42]))))[p([109,97,112])]((e=>e[p([115,112,108,105,116])](p([46]))))[p([115,111,109,101])]((e=>i[p([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===p([42])))))}()?(e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([101,118,97,108,117,97,116,105,111,110])&&(t=a(p([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([116,114,105,97,108])&&(t=a(p([84,114,105,97,108,76,105,109,105,116]))),await(t&&g?new(window[p([80,114,111,109,105,115,101])])(((e,n)=>{t[p([116,104,101,110])](e,n),g[p([116,104,101,110])]((t=>{t!=p([86,97,108,105,100])&&e(t)}),n)})):t||g||p([86,97,108,105,100]))):p([68,111,109,97,105,110,76,105,109,105,116]):p([78,111,116,65,108,108,111,119,101,100]):p([73,110,118,97,108,105,100])}catch(e){return p([73,110,118,97,108,105,100])}var f,y}())}var commentIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5h12A3.5 3.5 0 0 1 19.5 5v8l-.005.192a3.5 3.5 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.371-.193-.38-.212a13.452 13.452 0 0 1-3.271-2.63l-.062-.07H4A3.5 3.5 0 0 1 .5 13V5A3.5 3.5 0 0 1 4 1.5ZM4 3a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6.924a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L14.962 15H16a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4Z"/><path d="M9.75 5a.75.75 0 0 0-.75.75v2.5H6.5a.75.75 0 0 0 0 1.5H9v2.5a.75.75 0 0 0 1.5 0v-2.5H13a.75.75 0 0 0 0-1.5h-2.5v-2.5A.75.75 0 0 0 9.75 5Z"/></svg>\n';class CommentsUI extends Plugin{static get pluginName(){return"CommentsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsRepository,CommentsEditing,EditorAnnotations,Annotations]}get CommentsListView(){return CommentsListView}get CommentThreadInputView(){return CommentThreadInputView}init(){const e=this.editor,t=e.plugins.get(CommentsRepository),n=e.plugins.get(CommentsEditing),i=e.plugins.get(Annotations),r=e.plugins.get(EditorAnnotations);e.ui.componentFactory.add("comment",(()=>{const e=this._createUIButton(ButtonView);return e.tooltip=!0,e})),e.ui.componentFactory.add("menuBar:comment",(()=>this._createUIButton(MenuBarMenuListItemButtonView))),r.addSourceCollector((()=>{const e=[];for(const[i,r]of t._threadToController){const t=n.getAllMarkersForId(i.id),s=t.map((e=>e.getRange()));t.length>0&&e.push([r.view,s])}return e})),this.listenTo(i,"change:activeAnnotations",((e,i,r)=>{const s=Array.from(r).map((e=>e.innerView)).find((e=>t._viewToController.has(e)));if(!s)return void(n.activeMarker=null);const o=t._viewToController.get(s).model.id,a="comment:"+o;o&&n.hasMarkerForId(o)?n.activeMarker=a:n.activeMarker&&(n.activeMarker=null)})),this.listenTo(t,"removeCommentThread",((t,{threadId:i,isFromAdapter:r})=>{!r&&e.ui.focusTracker.isFocused&&n.hasMarkerForId(i)&&e.editing.view.focus()}),{priority:"highest"}),this.listenTo(t,"addComment",((i,{threadId:r,isFromAdapter:s})=>{!s&&n.hasMarkerForId(r)&&t.hasCommentThread(r)&&1===t.getCommentThread(r).length&&(e.editing.view.focus(),i.stop())}),{priority:"low"}),this.licenseKey=this.editor.config.get("licenseKey");const s=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in s){const n=t,i=s[n];if("commentsLicenseKeyValid"==i||"commentsLicenseKeyInvalid"==i||"commentsLicenseKeyExpired"==i||"commentsLicenseKeyDomainLimit"==i||"commentsLicenseKeyNotAllowed"==i||"commentsLicenseKeyEvaluationLimit"==i||"commentsLicenseKeyTrialLimit"==i||"commentsLicenseKeyUsageLimit"==i){delete s[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"commentsLicenseKeyInvalid"==e&&s._showLicenseError("invalid"),"commentsLicenseKeyExpired"==e&&s._showLicenseError("expired"),"commentsLicenseKeyDomainLimit"==e&&s._showLicenseError("domainLimit"),"commentsLicenseKeyNotAllowed"==e&&s._showLicenseError("featureNotAllowed","Comments"),"commentsLicenseKeyEvaluationLimit"==e&&s._showLicenseError("evaluationLimit"),"commentsLicenseKeyTrialLimit"==e&&s._showLicenseError("trialLimit"),"commentsLicenseKeyUsageLimit"==e&&s._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_createUIButton(e){const t=this.editor,n=new e(t.locale),i=t.commands.get("addCommentThread");return n.set({label:getTranslation$f(t.locale,"Comment"),icon:commentIcon}),n.bind("isEnabled").to(i),this.listenTo(n,"execute",(()=>{t.editing.view.focus(),i.execute()})),n}}class CommentsOnly extends Plugin{static get pluginName(){return"CommentsOnly"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsEditing]}constructor(e){super(e),this.set("isEnabled",!1),this.on("change:isEnabled",((e,t,n)=>{n?this._enableCommentsOnlyMode():this._disableCommentsOnlyMode()}))}afterInit(){!this.isEnabled&&this.editor.config.get("commentsOnly")&&(this.isEnabled=!0)}_enableCommentsOnlyMode(){var e;for(const[e,t]of this.editor.commands)t.affectsData&&"addCommentThread"!==e&&t.forceDisabled("commentsOnlyMode");this.editor.plugins.has("DragDrop")&&this.editor.plugins.get("DragDrop").forceDisabled("commentsOnlyMode"),this.editor.plugins.has("SourceEditing")&&this.editor.plugins.get("SourceEditing").forceDisabled("commentsOnlyMode"),null===(e=this.editor.commands.get("editSource"))||void 0===e||e.forceDisabled("commentsOnlyMode");const t=this.editor.editing.view.document;this.listenTo(t,"cut",(e=>e.stop()),{priority:"highest"}),this.listenTo(t,"clipboardInput",(e=>e.stop()),{priority:"highest"}),this.listenTo(t,"delete",(e=>e.stop()),{priority:"highest"})}_disableCommentsOnlyMode(){var e;for(const[e,t]of this.editor.commands)t.affectsData&&"addCommentThread"!==e&&t.clearForceDisabled("commentsOnlyMode");this.editor.plugins.has("SourceEditing")&&this.editor.plugins.get("SourceEditing").clearForceDisabled("commentsOnlyMode"),null===(e=this.editor.commands.get("editSource"))||void 0===e||e.clearForceDisabled("commentsOnlyMode"),this.stopListening(this.editor.editing.view.document)}}class AnnotationsUIs extends ContextPlugin{static get requires(){return[Annotations]}static get pluginName(){return"AnnotationsUIs"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.activeUIs=new Set,this._uis=new Map,this._uisData=new Map}init(){const e=this.context.plugins.get(Annotations);this.listenTo(e,"_activateAnnotation",((e,t)=>{for(const e of this.activeUIs){const n=this._uis.get(e);(0,this._uisData.get(e).filter)(t)&&n.setActiveAnnotation(t)}})),this.listenTo(e,"_deactivateAllAnnotations",(()=>{for(const e of this.activeUIs)this._uis.get(e).setActiveAnnotation(null)})),this.listenTo(e._visibleAnnotations,"add",((e,t)=>{this._assertAnnotationDoesNotBelongToMultipleUIs(t)}))}hasActive(){return this.activeUIs.size>0}isActive(e){return this.activeUIs.has(e)}activate(e,t=()=>!0){const n=this.context.plugins.get(Annotations);if(!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});this.isActive(e)&&this.deactivate(e),this.activeUIs.add(e);const i=new AnnotationCollection;bindAnnotationCollections({source:n._visibleAnnotations,target:i,filter:t}),this._uisData.set(e,{collection:i,filter:t});const r=this._uis.get(e);r.attach(i),this.listenTo(r,"change:activeAnnotation",((e,t,i,r)=>{r&&n._removeActiveAnnotation(r),i&&n._addActiveAnnotation(i)}))}deactivate(e){if(this.activeUIs.delete(e),!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});const t=this._uis.get(e);t.detach(),this.stopListening(t),this._uisData.get(e).collection.destroy(),this._uisData.delete(e)}switchTo(e){if(!this._uis.has(e))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:e});const t=this.context.plugins.get(Annotations),n=Array.from(t.activeAnnotations)[0]||null;this.deactivateAll(),this.activate(e);const i=this._uis.get(e);i.setActiveAnnotation(n),i._setSelectedAnnotations&&n&&i._setSelectedAnnotations([n])}deactivateAll(){for(const e of this.activeUIs)this.deactivate(e)}register(e,t){if(this._uis.has(e))throw new CKEditorError("annotationsuis-register-already-registered");if("function"!=typeof t.attach||"function"!=typeof t.detach||"function"!=typeof t.setActiveAnnotation)throw new CKEditorError("annotationsuis-register-invalid-interface",null);this._uis.set(e,t)}refilterAnnotations(){const e=this.context.plugins.get(Annotations).collection,t=new Map,n=Array.from(this.activeUIs);for(const e of this.activeUIs){const n=this._uisData.get(e).collection;for(const i of n)t.set(i,e)}for(const i of e){const e=t.get(i);this._assertAnnotationDoesNotBelongToMultipleUIs(i);const r=n.find((e=>this._uisData.get(e).filter(i)));e!==r&&(e&&this._uisData.get(e).collection.remove(i),r&&this._uisData.get(r).collection.add(i))}}destroy(){this.deactivateAll(),super.destroy()}_assertAnnotationDoesNotBelongToMultipleUIs(e){const t=[];for(const n of this.activeUIs)(0,this._uisData.get(n).filter)(e)&&t.push(n);if(t.length>1)throw new CKEditorError("annotationsuis-annotation-mismatch",null,{matchedUIs:t,annotationType:e.type})}}const toPx$2=toUnit("px");class SidebarView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("minHeight",0),this.set("class",""),this.list=this.createCollection(),this.focusables=this.createCollection(),this.list.delegate("arrowup","arrowdown").to(this),this.focusTracker=new FocusTracker,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-sidebar","ck-reset",t.to("class")],style:{minHeight:t.to("minHeight",(e=>"number"==typeof e?toPx$2(e+10):null))},dir:e.uiLanguageDirection,role:"application","aria-label":getTranslation$f(e,"Annotations sidebar"),tabindex:0},children:[{tag:"div",attributes:{role:"list","aria-label":getTranslation$f(e,"Annotations list")},children:this.list}]})}render(){super.render(),this._setupKeyboardNavigation()}focus(){this.focusCycler.focusFirst()}_setupKeyboardNavigation(){this.list.delegate("change:top").to(this),this.on("change:top",(e=>{this._updateItemPositionInFocusables(e.source)})),this.list.forEach((e=>{this.focusTracker.add(e.element),this._updateItemPositionInFocusables(e)})),this.list.on("change",((e,t)=>{for(const e of t.removed)this.focusTracker.remove(e.element),this.focusables.remove(e);for(const e of t.added)this.focusTracker.add(e.element),this._updateItemPositionInFocusables(e)})),this.on("arrowup",(()=>{this.focusCycler.focusPrevious()})),this.on("arrowdown",(()=>{this.focusCycler.focusNext()})),this.listenTo(this.element,"focus",(()=>{this.focus()}))}_updateItemPositionInFocusables(e){const t=this.focusables.getIndex(e);let n,i;for(const t of this.focusables)if(e.top<t.top){n=t;break}if(i=n?this.focusables.getIndex(n):this.focusables.length,-1!==t){if(t===i-1)return;this.focusables.remove(e),i=n?this.focusables.getIndex(n):this.focusables.length}this.focusables.add(e,i)}}const toPx$1=toUnit("px");class SidebarItemView extends View{constructor(e){super(e),this.set("top",0),this.set("height",0),this.bind("bottom").to(this,"top",this,"height",((e,t)=>e+t)),this.set("isAnimationDisabled",!1),this._mutationObserver=createMutationObserver((()=>this.updateHeight())),this._targetTop=null,this.content=this.createCollection(),this.content.delegate("arrowup","arrowdown").to(this);const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck-sidebar-item",t.to("isAnimationDisabled",(e=>e?"ck-sidebar-item--no-animation":""))],style:{top:t.to("top",(e=>toPx$1(e)))},role:"presentation"},children:this.content})}render(){super.render(),this._mutationObserver.attach(this.element)}focus(){this.content.first&&this.content.first.focus()}updateHeight(){const e=this.element.clientHeight;e&&(this.height=e)}destroy(){this.content.clear(),this._mutationObserver.detach(),super.destroy()}}class Sidebar extends ContextPlugin{static get pluginName(){return"Sidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("_lastItem",void 0),this.view=this._createSidebarView(),this.set("container",null),this._spaceBetweenItems=25,this._sidebarItemViewToAnnotation=new Map,this._annotationToSidebarItemView=new Map,this.context.config.define("sidebar.preventScrollOutOfView",!1),this._annotations=null,this._activeAnnotation=null,this._recalculateBuffer=[]}init(){const e=this.context.config.get("sidebar.container");e&&this.setContainer(e)}setContainer(e){if(!isElement(e))throw new CKEditorError("sidebar-setcontainer-invalid-element");this.container=e}_attachToContainer({viewClass:e="",spaceBetweenItems:t=25}={}){if(!isElement(this.container))throw new CKEditorError("sidebar-attachtocontainer-missing-container",this);this.container.appendChild(this.view.element),this.view.class=e,this._spaceBetweenItems=t}rearrange({removedAnnotation:e,previousAnnotation:t,nextAnnotation:n}){const i=this.getSidebarItemView(e);this.view.list.remove(i),this._destroySidebarItemView(e),t&&this._alignToTargetRect(this.getSidebarItemView(t)),n&&this._alignToTargetRect(this.getSidebarItemView(n)),this._updateLastItem()}refresh({blurredAnnotation:e,activatedAnnotation:t,disableAnimationOnActivatedAnnotation:n}){if(this._activeAnnotation=t,e){e.isActive=!1;const t=this.getSidebarItemView(e);t&&n&&(t.isAnimationDisabled=!1)}if(t){const e=this.getSidebarItemView(t);e&&(t.isActive=!0,n&&(e.isAnimationDisabled=!0,e.top+=1),this._alignToTargetRect(e))}}_detachFromContainer(e){if(this.view.element.remove(),e)for(const t of e)this._destroySidebarItemView(t);this.view.list.clear(),this.view.class="",this._lastItem=null}addAnnotation(e,t){t||(t=e.view);const n=new SidebarItemView(this.context.locale);this._sidebarItemViewToAnnotation.set(n,e),this._annotationToSidebarItemView.set(e,n),n.content.add(t),this.listenTo(e.view,"change:targetRect",((t,i,r)=>{const s=this._getTargetTop(e,r);n._targetTop!=s&&(n._targetTop=s,this._setItemTop(n,s))})),this.listenTo(n,"change:top",(()=>{this._recalculate(n,"top")})),this.listenTo(n,"change:bottom",(()=>{this._recalculate(n,"bottom")})),this._alignToTargetRect(n);const i=this._getItemBefore(n);return i&&this._alignAfterItem(i,n)||this._alignToTargetRect(n),this._updateLastItem(),this.view.list.add(n),n}_alignForTopChange(e){if(!e.content.length)return;const t=this._getItemBefore(e);if(!t)return;const n=this._sidebarItemViewToAnnotation.get(t),i=this._activeAnnotation;i&&i===n?this._alignAfterItem(t,e):this._alignBeforeItem(e,t)}_alignForBottomChange(e){if(!e.content.length)return;const t=this._getItemAfter(e);if(!t)return;const n=this._sidebarItemViewToAnnotation.get(t),i=this.context.config.get("sidebar.preventScrollOutOfView"),r=this._activeAnnotation;r&&r===n&&i?(this._alignBeforeItem(t,e),this._alignAfterItem(e,t)):r&&r===n?this._alignBeforeItem(t,e):this._alignAfterItem(e,t)}_recalculate(e,t){0===this._recalculateBuffer.length&&setTimeout((()=>{for(const{sidebarItemView:e,changedProp:t}of this._recalculateBuffer)"top"===t?this._alignForTopChange(e):this._alignForBottomChange(e);this._recalculateBuffer=[]}),10),this._recalculateBuffer.push({sidebarItemView:e,changedProp:t})}getSidebarItemView(e){return this._annotationToSidebarItemView.get(e)}destroy(){this.stopListening(),this.view.destroy()}_destroySidebarItemView(e){const t=this.getSidebarItemView(e);this.stopListening(t),this.stopListening(e.view),t.destroy(),this._annotationToSidebarItemView.delete(e),this._sidebarItemViewToAnnotation.delete(t)}_createSidebarView(){const e=new SidebarView(this.context.locale);return e.render(),this.on("change:_lastItem",((t,n,i,r)=>{r&&e.unbind("minHeight"),i?e.bind("minHeight").to(i,"bottom"):e.minHeight=null})),e}_updateLastItem(){var e;this._lastItem=(null===(e=this._annotations)||void 0===e?void 0:e.last)?this.getSidebarItemView(this._annotations.last):null}_getItemBefore(e){var t;const n=this._sidebarItemViewToAnnotation.get(e),i=n&&(null===(t=this._annotations)||void 0===t?void 0:t.get(this._annotations.getIndex(n)-1));return i&&this.getSidebarItemView(i)||null}_getItemAfter(e){var t;const n=this._sidebarItemViewToAnnotation.get(e),i=n&&(null===(t=this._annotations)||void 0===t?void 0:t.get(this._annotations.getIndex(n)+1));return i&&this.getSidebarItemView(i)||null}_alignBeforeItem(e,t){e.updateHeight();const n=getOverlap(t.bottom+this._spaceBetweenItems,e.top);return!!n&&(this._setItemTop(t,t.top-n),!0)}_alignAfterItem(e,t){e.updateHeight();const n=getOverlap(e.bottom+this._spaceBetweenItems,t.top);return!!n&&(this._setItemTop(t,t.top+n,!1),!0)}_alignToTargetRect(e){const t=this._sidebarItemViewToAnnotation.get(e);if(!t||!t.target||!t.targetRect)return;const n=this._getTargetTop(t,t.targetRect);this._setItemTop(e,n)}_getTargetTop(e,t){if(null===t)return 0;if(e.target instanceof Rect)return t.top;{const e=new Rect(this.view.element).top;return t.top-e}}_setItemTop(e,t,n=this.context.config.get("sidebar.preventScrollOutOfView")){n&&(t=Math.max(t,this._getMaxAvailableTop(e))),e.top=t}_getMaxAvailableTop(e){let t=this._getItemBefore(e),n=0;for(;t;)t.updateHeight(),n+=this._spaceBetweenItems+t.height,t=this._getItemBefore(t);return n}}function getOverlap(e,t){return Math.max(e-t,0)}function isElement(e){return null!==e&&"object"==typeof e&&1===e.nodeType}class WideSidebar extends ContextPlugin{static get requires(){return[Sidebar,AnnotationsUIs]}static get pluginName(){return"WideSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce$1((()=>{this.annotations.refreshPositioning()}),250,{leading:!1})}init(){const e=this.context.plugins.get(AnnotationsUIs),t=this.context.plugins.get(Sidebar);e.register("wideSidebar",this),t.container&&e.switchTo("wideSidebar")}setActiveAnnotation(e){if(e===this.activeAnnotation)return;const t=this.context.plugins.get(Sidebar);t._activeAnnotation=e;const n=this.activeAnnotation;t.refresh({blurredAnnotation:n,activatedAnnotation:e}),this.activeAnnotation=e}attach(e){this.annotations=e;const t=this.context.plugins.get(Sidebar);if(t._annotations=e,this.isAttached)throw new CKEditorError("widesidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(t,"set:container",(()=>{this.detach(),this.listenTo(t,"change:container",(t=>{t.off(),this.attach(e)}))})),t._attachToContainer({viewClass:"ck-sidebar--wide"});const n=e=>{e.updateTargetRect(),t.addAnnotation(e)};for(const t of e)n(t);this.listenTo(e,"add",((e,t)=>{n(t)})),this.listenTo(e,"remove",((n,i,r)=>{t.rearrange({removedAnnotation:i,previousAnnotation:e.get(r-1),nextAnnotation:e.get(r+1)}),i===this.activeAnnotation&&this.setActiveAnnotation(null)}),{priority:"high"}),this.listenTo(e,"focus",((e,t)=>{this.setActiveAnnotation(t)})),this.listenTo(e,"blur",(()=>{this.setActiveAnnotation(null)}));const i=this.context instanceof Context$1?this.context.editors:new Collection([this.context]);for(const e of i)this._integrateWithEditorAnnotations(e);this.listenTo(i,"add",((e,t)=>{this.listenTo(t,"ready",(()=>{this._integrateWithEditorAnnotations(t)}))})),this.listenTo(i,"remove",((e,t)=>{t.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(t.plugins.get("EditorAnnotations"))})),window.addEventListener("resize",this._refreshPositioningDebounced),this.annotations.refreshPositioning()}detach(){if(!this.isAttached)throw new CKEditorError("widesidebar-detach-not-attached",this);this.setActiveAnnotation(null);const e=this.context.plugins.get(Sidebar);e._detachFromContainer(this.annotations),this.stopListening(e),this.stopListening(this.annotations),this.context instanceof Context$1&&this.stopListening(this.context.editors);for(const e of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(e);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this.activeAnnotation=null,this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_integrateWithEditorAnnotations(e){if(!e.plugins.has("EditorAnnotations"))return;const t=e.plugins.get("EditorAnnotations"),n=()=>{const e=t.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this.setActiveAnnotation(e[0]||null)};this.listenTo(t,"refresh",n),this.listenTo(t,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&this.setActiveAnnotation(null)})),this.listenTo(t,"uiUpdate",(()=>{this._refreshPositioningDebounced()})),this.listenTo(this.annotations,"blur",(e=>{t.hasDomSelection()&&(n(),e.stop())}),{priority:"high"}),this._editorAnnotations.add(t)}_destroyEditorAnnotationsIntegration(e){this.stopListening(e),this._editorAnnotations.remove(e)}}class AnnotationCounterButtonView extends ButtonView{constructor(e){super(e);const t=this.bindTemplate;this.set("isDirty",!1),this.set("number",0),this.bind("_badge").to(this,"isDirty",this,"number",((e,t)=>e?"...":t.toString())),this.set("annotationType",""),this.icon=commentIcon,this.extendTemplate({attributes:{class:["ck-annotation-counter"]}}),this.counterView=new View,this.counterView.setTemplate({tag:"span",attributes:{class:["ck-annotation-counter__badge",t.to("annotationType",(e=>"ck-annotation-counter__badge--"+e)),t.if("isDirty","ck-annotation-counter__badge--edit-mode")]},children:[{text:t.to("_badge")}]}),this.children.add(this.counterView)}}class NarrowSidebar extends ContextPlugin{static get requires(){return[Sidebar,AnnotationsUIs]}static get pluginName(){return"NarrowSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.isAttached=!1,this._manuallyClosedAnnotationViews=new Set,this._domEmitter=Object.create(DomEmitterMixin),this._annotationToNarrowView=new Map,this.set("activeAnnotation",null),this.annotations=null,this._selectedAnnotations=[],this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce$1((()=>{this._refreshPositioning()}),250,{leading:!1})}init(){this.context.plugins.get(AnnotationsUIs).register("narrowSidebar",this),this.bodyCollection=new BodyCollection(this.context.locale),this.balloonPanelView=new BalloonPanelView(this.context.locale),this.bodyCollection.attachToDom(),this.bodyCollection.add(this.balloonPanelView)}attach(e){this.annotations=e;const t=this.context.plugins.get(Sidebar),n=this.balloonPanelView;if(t._annotations=e,this.isAttached)throw new CKEditorError("narrowsidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(t,"set:container",(()=>{this.detach(),this.listenTo(t,"change:container",(t=>{t.off(),this.attach(e)}))})),t._attachToContainer({viewClass:"ck-sidebar--narrow",spaceBetweenItems:5});const i=e=>{const i=new AnnotationCounterButtonView(this.context.locale);t.addAnnotation(e,i),this._annotationToNarrowView.set(e,i),i.bind("isDirty","annotationType","number").to(e.view,"isDirty","type","length"),i.on("execute",(()=>{this._manuallyClosedAnnotationViews.clear(),n.content.first!==e.view?(this._showBalloon(e),e.view.element.focus(),this.setActiveAnnotation(e)):this.setActiveAnnotation(null)}))};for(const t of e)i(t);this.listenTo(e,"add",((e,t)=>{i(t)})),this.listenTo(e,"remove",((n,i,r)=>{this._annotationToNarrowView.get(i).destroy(),this._annotationToNarrowView.delete(i),t.rearrange({removedAnnotation:i,previousAnnotation:e.get(r-1),nextAnnotation:e.get(r+1)}),i===this.activeAnnotation&&this.setActiveAnnotation(null)}),{priority:"low"}),this.listenTo(e,"focus",((e,t)=>{this.setActiveAnnotation(t)})),this.listenTo(e,"blur",(()=>{this.setActiveAnnotation(null)})),this._domEmitter.listenTo(document,"keydown",((e,t)=>{t.keyCode===keyCodes.esc&&n.isVisible&&(this._manuallyClosedAnnotationViews.add(n.content.first),this._hideBalloon(),t.stopPropagation(),t.preventDefault())})),this._domEmitter.listenTo(document,"mousedown",((e,i)=>{const r=i.target;n.isVisible&&n.element.contains(r)||t.view.element.contains(r)||e.preventClosingBalloon||this.activeAnnotation&&this.activeAnnotation.focusableElements.find((e=>e.contains(r)))||(this._manuallyClosedAnnotationViews.clear(),this._hideBalloon(),this.setActiveAnnotation(null))}));const r=this.context instanceof Context$1?this.context.editors:new Collection([this.context]);for(const e of r)this._integrateWithEditorAnnotations(e);this.listenTo(r,"add",((e,t)=>{this.listenTo(t,"ready",(()=>{this._integrateWithEditorAnnotations(t)}))})),this.listenTo(r,"remove",((e,t)=>{t.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(t.plugins.get("EditorAnnotations"))})),window.addEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioning()}setActiveAnnotation(e){if(e===this.activeAnnotation)return;const t=this.context.plugins.get(Sidebar);t.refresh({blurredAnnotation:this.activeAnnotation,activatedAnnotation:e,disableAnimationOnActivatedAnnotation:!0}),e&&t.getSidebarItemView(e)?this._showBalloon(e):this._hideBalloon(),this.activeAnnotation=e}detach(){if(!this.isAttached)throw new CKEditorError("narrowsidebar-detach-not-attached",this);this.setActiveAnnotation(null);const e=this.context.plugins.get(Sidebar);this._hideBalloon(),Array.from(this._annotationToNarrowView.values(),(e=>e.destroy())),this._annotationToNarrowView.clear(),e._detachFromContainer(this.annotations),this.stopListening(),this._domEmitter.stopListening(),this.context instanceof Context$1&&this.stopListening(this.context.editors);for(const e of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(e);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this._selectedAnnotations=[],this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach(),this.bodyCollection.detachFromDom()}_integrateWithEditorAnnotations(e){if(!e.plugins.has("EditorAnnotations"))return;const t=e.plugins.get("EditorAnnotations"),n=this.context.plugins.get(Sidebar),i=this.annotations,r=this.balloonPanelView,s=()=>{const e=t.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this._setSelectedAnnotations(e),this.setActiveAnnotation(e[0]||null)};this.listenTo(t,"refresh",s),this.listenTo(t,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))})),this.listenTo(t,"uiUpdate",(()=>{this._refreshPositioningDebounced()})),this.listenTo(i,"blur",(e=>{t.hasDomSelection()&&e.stop()}),{priority:"high"}),this.listenTo(this._domEmitter,"mousedown",((e,i)=>{const o=i.target;r.isVisible&&r.element.contains(o)||n.view.element.contains(o)||this.activeAnnotation&&t.hasDomSelection()&&(s(),e.preventClosingBalloon=!0)}),{priority:"high"}),this._editorAnnotations.add(t)}_destroyEditorAnnotationsIntegration(e){e&&(this.stopListening(e),this._editorAnnotations.remove(e))}_setSelectedAnnotations(e){for(const t of this._selectedAnnotations)e.includes(t)||this._manuallyClosedAnnotationViews.delete(t.view);this._selectedAnnotations=e}_refreshPositioning(){const e=this.balloonPanelView;this.annotations.refreshPositioning(),e.isVisible&&this._updateBalloonPosition()}_showBalloon(e){if(this._manuallyClosedAnnotationViews.has(e.view))return;const t=this.balloonPanelView.content.first;t!==e.view?(t&&this._detachListeners(t),this._attachListeners(e.view),this.balloonPanelView.content.clear(),this.balloonPanelView.content.add(e.view),this._updateBalloonPosition()):this._updateBalloonPosition()}_updateBalloonPosition(){const e=this.balloonPanelView.content.first,t=e&&this.annotations.getByView(e);if(!t||!this._annotationToNarrowView.has(t))return;const n=this._annotationToNarrowView.get(t).element,i=getBalloonPositions();this.balloonPanelView.pin({target:n,positions:i})}_hideBalloon(){const e=this.balloonPanelView,t=e.content.first;t&&(this._detachListeners(t),e.unpin(),e.content.clear())}_attachListeners(e){this.listenTo(e,"change:height",(()=>this._updateBalloonPosition())),this.listenTo(e,"Esc",((t,n)=>{this._manuallyClosedAnnotationViews.add(e),this._hideBalloon(),n()}))}_detachListeners(e){this.stopListening(e)}}function getBalloonPositions(){const e=BalloonPanelView.defaultPositions;return[e.southArrowNorthEast,e.northArrowSouthEast,e.southArrowNorth,e.northArrowSouth,e.southArrowNorthWest,e.northArrowSouthWest]}class InlineAnnotations extends Plugin{static get requires(){return[EditorAnnotations,ContextualBalloon,AnnotationsUIs]}static get pluginName(){return"InlineAnnotations"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),e.editing.view.addObserver(MouseObserver),this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._manuallyClosed=new Set,this._balloon=e.plugins.get(ContextualBalloon),this._addedAnnotations=new Set,this._selectedAnnotations=[],this._forceRefresh=!1}init(){const e=this.editor.plugins.get(AnnotationsUIs);e.context===this.editor&&(e.register("inline",this),this.editor.keystrokes.set("Esc",((e,t)=>{const n=this._balloon;if(this.isAttached&&n.visibleView){const e=this.annotations.getByView(n.visibleView);e&&this._closeAnnotation(e),t()}})))}afterInit(){const e=this.editor.plugins.get(AnnotationsUIs);e.context===this.editor&&(e.hasActive()||e.switchTo("inline"))}setActiveAnnotation(e){e!==this.activeAnnotation&&(this.activeAnnotation&&(this.activeAnnotation.isActive=!1),e&&this.editor.ui.focusTracker.isFocused&&(this.annotations.has(e)&&this._addAnnotationToBalloon(e,!0),e.isActive=!0),e||this._setSelectedAnnotations([]),this.activeAnnotation=e)}attach(e){this.annotations=e;const t=this.editor.plugins.get(AnnotationsUIs),n=this._balloon;if(this.isAttached)throw new CKEditorError("inlineannotations-attach-already-attached",this);if(t.context!==this.editor)throw new CKEditorError("inlineannotations-not-allowed-with-context",this);const i=this.editor.plugins.get(EditorAnnotations);this.listenTo(i,"refresh",(()=>{const e=i.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});!this._forceRefresh&&arraysEqual(e,this._selectedAnnotations)||(this._forceRefresh=!1,this._setSelectedAnnotations(e),this.setActiveAnnotation(e[0]||null))})),this.listenTo(i,"blur",((e,{isAnnotationTracked:t})=>{this.activeAnnotation&&t(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))})),this.listenTo(this.editor.ui.focusTracker,"change:isFocused",((e,t,n)=>{n||this.setActiveAnnotation(null)})),this.listenTo(e,"remove",((e,t)=>{this._removeAnnotationFromBalloon(t),t===this.activeAnnotation&&this.setActiveAnnotation(null)})),this.listenTo(n,"change:visibleView",((t,i,r,s)=>{s&&this.stopListening(s);const o=e.getByView(r);r&&o&&(this.listenTo(r,"change:height",(()=>{n.updatePosition()})),this.listenTo(r,"Esc",(()=>{this._closeAnnotation(o),this.editor.editing.view.focus()})),this.activeAnnotation!==o&&this.setActiveAnnotation(o))})),this.listenTo(this.editor.ui,"update",(()=>{n.visibleView&&e.getByView(n.visibleView)&&n.updatePosition()})),this.listenTo(this.editor.editing.view.document,"mousedown",(()=>{this._forceRefresh=!0,this._manuallyClosed.clear()})),this.editor.editing.view.document.selection.editableElement&&this.editor.editing.view.focus(),this.isAttached=!0}detach(){if(!this.isAttached)throw new CKEditorError("inlineannotations-detach-not-attached",this);this.setActiveAnnotation(null);for(const e of this._addedAnnotations)this._removeAnnotationFromBalloon(e);this.stopListening(),this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_setSelectedAnnotations(e){for(const t of this._selectedAnnotations)e.includes(t)||this._manuallyClosed.delete(t);for(const t of this.annotations)e.includes(t)||this._removeAnnotationFromBalloon(t);if(this.editor.ui.focusTracker.isFocused)for(const t of e)this._addAnnotationToBalloon(t);this._selectedAnnotations=e}_addAnnotationToBalloon(e,t=!1){this._manuallyClosed.has(e)||(this._addedAnnotations.has(e)||this._balloon.hasView(e.view)||(this._addedAnnotations.add(e),this._balloon.add({stackId:e.view.id,view:e.view,position:{target:()=>this._getBalloonTargetForAnnotation(e)}})),t&&this._balloon.showStack(e.view.id))}_getBalloonTargetForAnnotation(e){const t=e.target,n=this.editor.editing.view,i=n.document.selection.getFirstRange(),r=n.domConverter.viewRangeToDom(i);if(r.collapse(!0),t){if(t instanceof Rect)return t;let e=[];for(const n of t)e.push(...cloneRects(n.getClientRects()));e=joinClientRects(e);const n=r.getBoundingClientRect();return e.find((e=>e.top<=n.top&&e.bottom>=n.bottom&&e.left<=n.left&&e.right>=n.right))||e[0]}return e.targetRect||r}_removeAnnotationFromBalloon(e){this._addedAnnotations.has(e)&&this._balloon.hasView(e.view)&&(this._addedAnnotations.delete(e),this._balloon.remove(e.view))}_closeAnnotation(e){this._manuallyClosed.add(e),this._removeAnnotationFromBalloon(e)}}function arraysEqual(e,t){return e.length===t.length&&e.every((e=>t.includes(e)))}function cloneRects(e){return Array.from(e).map(DOMRect.fromRect)}function joinClientRects(e){const t=[];let n=e[0];for(let i=1;i<e.length;i++)canJoinRects(n,e[i])?n.width+=e[i].width:(t.push(n),n=e[i]);return t.push(n),t}function canJoinRects(e,t){return e.top===t.top&&e.bottom===t.bottom&&e.right===t.left}var commentsArchiveIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M14 3.5A3.5 3.5 0 0 1 17.5 7v6l-.005.192a3.501 3.501 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.37-.193-.38-.212a13.452 13.452 0 0 1-3.272-2.63l-.062-.07-4.729-.046a3.5 3.5 0 0 1-3.5-3.5v-6a3.5 3.5 0 0 1 3.5-3.5L14 3.5ZM3.5 4.954a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2L8.924 15a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L12.962 15H14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2L3.5 4.954Z"/><path d="M16.5.5h-10a3.5 3.5 0 0 0-3.162 2h1.84A2 2 0 0 1 6.5 2h10a2 2 0 0 1 2 2v8.873a3.502 3.502 0 0 0 1.495-2.681L20 10V4A3.5 3.5 0 0 0 16.5.5Z"/><path clip-rule="evenodd" d="M12.013 7.453a.75.75 0 0 1 .034 1.06l-3.75 4a.75.75 0 0 1-1.045.048l-2.25-2a.75.75 0 0 1 .996-1.122l1.704 1.515 3.25-3.467a.75.75 0 0 1 1.061-.034Z"/></svg>\n';class CommentsArchiveView extends View{constructor(e,t){super(e),this.set("isEmpty",!t.length),this.focusTracker=new FocusTracker,this._annotationViews=t,this._annotationViews.delegate("arrowup","arrowdown").to(this),this.on("arrowup",(()=>{this.focusCycler.focusPrevious()})),this.on("arrowdown",(()=>{this.focusCycler.focusNext()})),this.focusCycler=new FocusCycler({focusables:t,focusTracker:this.focusTracker}),this.listenTo(t,"add",(()=>{this.isEmpty=!1})),this.listenTo(t,"remove",((e,n)=>{n.isActive&&this.focus(),t.length||(this.isEmpty=!0)}));const n=this.bindTemplate;this.setTemplate({tag:"div",attributes:{dir:"auto",class:["ck","ck-comments-archive"],tabindex:-1,role:"list","aria-label":getTranslation$f(e,"COMMENTS_ARCHIVE_LIST_LABEL")},children:[{tag:"div",attributes:{class:["ck-comments-archive__content"],role:"presentation"},children:[{tag:"div",attributes:{role:"presentation"},children:t},{tag:"p",attributes:{class:["ck-comments-archive__info",n.if("isEmpty","ck-hidden",(e=>!e))]},children:[{text:getTranslation$f(e,"EMPTY_COMMENTS_ARCHIVE")}]}]}]})}render(){super.render(),this._setupKeyboardNavigation()}destroy(){super.destroy(),this.focusTracker.destroy()}focus(){this.focusCycler.first?this.focusCycler.focusFirst():this.element.focus()}_setupKeyboardNavigation(){for(const e of this._annotationViews)this.focusTracker.add(e.element);this._annotationViews.on("change",((e,{added:t,removed:n})=>{for(const e of t)this.focusTracker.add(e.element);for(const e of n)this.focusTracker.remove(e.element)}))}}class CommentsArchive extends ContextPlugin{static get pluginName(){return"CommentsArchive"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsRepository,Annotations]}constructor(e){super(e),this.archivedThreads=new Collection}init(){const e=this.context,t=e.plugins.get(CommentsRepository),n=e.plugins.get(Annotations);this.listenTo(t,"addCommentThread",((e,{threadId:n})=>{const i=t.getCommentThread(n);i.archivedAt&&this.archivedThreads.add(i,this._calculatePosition(i.archivedAt)),this.listenTo(i,"change:archivedAt",((e,t,n)=>{n?this.archivedThreads.has(i)||this.archivedThreads.add(i,this._calculatePosition(i.archivedAt)):this.archivedThreads.has(i)&&this.archivedThreads.remove(i)}))})),this.listenTo(t,"removeCommentThread",((e,{threadId:n})=>{const i=t.getCommentThread(n);this.stopListening(i),this.archivedThreads.has(i)&&this.archivedThreads.remove(i)}),{priority:"highest"}),this.listenTo(n.collection,"focus",((e,t)=>{t.isVisible||(t.isActive=!0,n.activate(t))}))}_calculatePosition(e){const t=[...this.archivedThreads].findIndex((t=>t.archivedAt<e));return t>-1?t:this.archivedThreads.length}}class CommentsArchiveUI extends Plugin{static get pluginName(){return"CommentsArchiveUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[CommentsArchive,Dialog]}constructor(e){super(e),this._hideDialogOnAnnotationEscape=e=>{const t=e.source;if(!this.annotationViews.has(t.view))return;const n=this.editor.plugins.get("Dialog");n.isOpen&&"commentsArchive"===n.id&&(n.hide(),e.stop())},this.annotationViews=new ViewCollection,this._pendingThreads=[]}init(){const e=this.editor,t=this._hideDialogOnAnnotationEscape.bind(this);e.ui.componentFactory.add("commentsArchive",(()=>this._createCommentsArchiveButton(ButtonView,!0))),e.ui.componentFactory.add("menuBar:commentsArchive",(()=>{const e=this._createCommentsArchiveButton(MenuBarMenuListItemButtonView);return e.set({role:"menuitemcheckbox"}),e}));const n=e.plugins.get(CommentsArchive),i=e.plugins.get("Annotations"),r=e.plugins.get("CommentsRepository");n.archivedThreads.forEach((e=>{this._handleNewThread(e)})),this.listenTo(n.archivedThreads,"add",((e,t)=>{this._handleNewThread(t)})),this.listenTo(i.collection,"add",((e,t)=>{const n=this._pendingThreads.find((e=>{const n=r._threadToController.get(e);return n&&t.innerView===n.view}));if(n){const e=this._calculatePosition(n.archivedAt);this.annotationViews.add(t.view,e),this._pendingThreads.splice(this._pendingThreads.indexOf(n),1)}})),this.listenTo(n.archivedThreads,"remove",((t,n)=>{const s=e.config.get("collaboration.channelId");if(!s||n.channelId===s){const e=r._threadToController.get(n),t=i.getByInnerView(e.view);this.annotationViews.remove(t.view),this.stopListening(t.focusableElements)}})),this.listenTo(i.collection,"add",((e,n)=>{this.listenTo(n,"escape",t)})),this.listenTo(i.collection,"remove",((e,n)=>{this.stopListening(n,"escape",t)}))}_handleNewThread(e){const t=this.editor.plugins.get("CommentsRepository"),n=this.editor.plugins.get("Annotations"),i=this.editor.config.get("collaboration.channelId");if(!i||e.channelId===i){const i=t._threadToController.get(e);if(!i)return void this._pendingThreads.push(e);const r=this._calculatePosition(e.archivedAt),s=n.getByInnerView(i.view);s.isVisible&&n._visibleAnnotations.remove(s),this.annotationViews.add(s.view,r)}}_calculatePosition(e){const t=this.editor.config.get("collaboration.channelId"),n=[...this.editor.plugins.get(CommentsArchive).archivedThreads].filter((e=>e.channelId===t)).findIndex((t=>t.archivedAt<e));return n<0||n>this.annotationViews.length?this.annotationViews.length:n-1}_toggleDialog(){const e=this.editor,t=e.plugins.get("Dialog");this.commentsArchiveView||(this.commentsArchiveView=new CommentsArchiveView(e.locale,this.annotationViews)),"commentsArchive"===t.id?t.hide():t.show({id:"commentsArchive",title:getTranslation$f(e.locale,"COMMENTS_ARCHIVE"),icon:commentsArchiveIcon,hasCloseButton:!0,content:this.commentsArchiveView,position:DialogViewPosition.EDITOR_TOP_SIDE})}_createCommentsArchiveButton(e,t=!1){const n=this.editor.locale,i=this.editor.plugins.get("Dialog"),r=new e(n);return r.bind("isEnabled").to(this,"isEnabled"),r.bind("isOn").to(i,"id",(e=>"commentsArchive"===e)),r.set({label:getTranslation$f(n,"COMMENTS_ARCHIVE"),icon:commentsArchiveIcon,isToggleable:!0}),t&&(r.tooltip=!0),this.listenTo(r,"execute",(()=>this._toggleDialog())),r}}class Comments extends Plugin{static get requires(){return[CommentsRepository,CommentsEditing,CommentsUI,CommentsArchive,CommentsArchiveUI,CommentsOnly,WideSidebar,NarrowSidebar,InlineAnnotations]}static get pluginName(){return"Comments"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}function getElementText(e){let t="";for(const n of e.getChildren())n instanceof Text$1&&(t+=n.data);return t}function getDefaultFeatureHeadingNames(e){const t=e.config.get("heading.options");return t?t.reduce(((e,t)=>("paragraph"!==t.model&&e.push(t.model),e)),[]):e.plugins.has("GeneralHtmlSupport")?["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"]:[]}class DocumentOutlineUtils extends Plugin{constructor(){super(...arguments),this._headingNames=[]}static get pluginName(){return"DocumentOutlineUtils"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;this._headingNames=this._getHeadingNames();let t=[];e.model.document.on("change",debounce$1((()=>{const e=t;t=this._getOutlineDefinitions();const n=_0x32349d(e,t,((e,t)=>e.level===t.level&&e.text===t.text&&e.modelElement===t.modelElement)),i=diffToChanges(n,t),r=this._getActiveHeading(),s=t.findIndex((e=>e.modelElement===r));i.length&&this.fire("change",{outlineDefinitions:t,activeItemIndex:s,outlineChanges:i}),this.fire("activeItemIndex",{index:s})}),250,{leading:!0,trailing:!0}))}afterInit(){this._headingNames.length||this._deriveHeadingElementsFromConversion()}_getOutlineDefinitions(){const e=this.editor,t=[],n=this._headingNames;for(const t of e.model.document.getRootNames())i(e.model.document.getRoot(t));function i(e){for(const r of e.getChildren())r.is("element")&&(n.includes(r.name)&&t.push({level:n.indexOf(r.name)+1,text:getElementText(r),modelElement:r}),i(r))}return t}_getActiveHeading(){const e=this.editor.model.document.selection.getFirstPosition(),t=new TreeWalker({direction:"backward",startPosition:e});for(const e of t)if(e.item.is("element")&&this._headingNames.includes(e.item.name))return e.item}_getHeadingNames(){return this.editor.config.get("documentOutline.headings")||getDefaultFeatureHeadingNames(this.editor)}_deriveHeadingElementsFromConversion(){const e=this.editor,t=["h1","h2","h3","h4","h5","h6"],n=[];for(const i of t){const t=e.editing.view.domConverter.domToView(document.createElement(i)),r=e.data.toModel(t).getChild(0);(null==r?void 0:r.is("element"))&&n.push(r.name)}this._headingNames=n}}function getTranslation$e(e,t){const n=e.t;switch(t){case"Empty heading":return n("Empty heading");case"Editor headings will appear here as you type.":return n("Editor headings will appear here as you type.");case"No headings were found in the document.":return n("No headings were found in the document.");case"Table of contents":return n("Table of contents");default:return t}}class DocumentOutlineItemView extends View{constructor(e,t=!1){super(e);const n=this.bindTemplate,i=t?"["+getTranslation$e(e,"Empty heading")+"]":"";this.set("text",""),this.set("level",1),this.set("isActive",!1),this.bind("isEmpty").to(this,"text",(e=>!e)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline__item",n.to("level",(e=>"ck-document-outline__item_level-"+e)),n.if("isActive","ck-document-outline__item_active"),n.if("isEmpty","ck-document-outline__item_empty")],title:n.to("text")},children:[{text:n.to("text",(e=>e||i))}],on:{click:n.to("click")}})}}class DocumentOutlineView extends View{constructor(e,t=!1,n){super(e),this.showEmptyHeadingText=t,this.set("activeItemIndex",-1),this._documentOutlineContainer=n,this.items=this.createCollection(),this.items.delegate("click").to(this),this.on("click",this._handleItemClick.bind(this)),this.on("change:activeItemIndex",((e,t,n,i)=>{this._setActiveItem(i,n)})),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline"],dir:e.contentLanguageDirection,"data-document-outline-empty-placeholder":getTranslation$e(e,"Editor headings will appear here as you type."),tabindex:-1},children:this.items})}sync(e){e.forEach((e=>{"insert"==e.type?this._insertItem(e.index,...e.values):"delete"==e.type&&this._deleteItem(e.index,e.howMany)}))}_setActiveItem(e,t){if(-1!==e){const t=this.items.get(e);t&&(t.isActive=!1)}-1!==t&&(this.items.get(t).isActive=!0,this._scrollToItem(t))}_insertItem(e,...t){const n=t.map(((t,n)=>{const i=new DocumentOutlineItemView(this.locale,this.showEmptyHeadingText);return i.text=t.text,i.level=t.level,e+n===this.activeItemIndex&&(i.isActive=!0),i}));this.items.addMany(n,e)}_deleteItem(e,t){do{this.items.remove(e)}while(--t)}_handleItemClick(e){const t=this.items.getIndex(e.source);this.fire("itemSelected",t)}_scrollToItem(e){scrollAncestorsToShowTarget(this.items.get(e).element,20,this._documentOutlineContainer)}destroy(){super.destroy(),this.element.remove()}}class DocumentOutlineUI extends Plugin{static get pluginName(){return"DocumentOutlineUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.view=new DocumentOutlineView(e.locale,this.editor.config.get("documentOutline.showEmptyHeadings"),this.editor.config.get("documentOutline.container")),this._currentOutlineDefinitions=[],this._updateActiveDefinitionFromViewportThrottled=throttle$1(this._updateActiveDefinitionOnViewportChange.bind(this),100)}init(){const e=this.editor,t=e.plugins.get("DocumentOutlineUtils");let n=!1;if(this.view.render(),this.editor.ui.focusTracker.add(this.view.element),!e.config.get("documentOutline.container"))throw new CKEditorError("document-outline-container-not-provided",{editor:e});e.config.get("documentOutline.container").appendChild(this.view.element),t.on("change",this._handleOutlineChange.bind(this)),t.on("activeItemIndex",((e,{index:t})=>this._setActiveViewItem(t))),this.view.on("itemSelected",((e,t)=>{n=!0,this._handleItemSelected(t)})),this.view.listenTo(_0x49a38d.document,"scroll",(()=>{n?n=!1:this._updateActiveDefinitionFromViewportThrottled()}),{useCapture:!0}),this.view.listenTo(_0x49a38d.window,"resize",this._updateActiveDefinitionFromViewportThrottled,{useCapture:!0})}afterInit(){checkLicense$c(this)}destroy(){super.destroy(),this.view.destroy(),this._updateActiveDefinitionFromViewportThrottled.cancel()}_handleOutlineChange(e,{outlineDefinitions:t,outlineChanges:n}){this._currentOutlineDefinitions=t,this.view.sync(n)}_setActiveViewItem(e){this._currentOutlineDefinitions.length&&this._currentOutlineDefinitions[e]&&(this.view.activeItemIndex=e)}_handleItemSelected(e){const t=this._currentOutlineDefinitions[e].modelElement;this.editor.model.change((e=>{e.setSelection(t,0)})),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0}),this.editor.editing.view.focus(),this._setActiveViewItem(e)}_updateActiveDefinitionOnViewportChange(){const e=this.editor;let t;for(const n of e.model.document.getRootNames()){const i=e.editing.view.getDomRoot(n),r=i&&new Rect(i).getVisible();if(r){const e=new Rect(_0x49a38d.window).getIntersection(r);e&&(t=e.top+.25*e.height)}}if(void 0===t)return;const n=binaryActiveDefinitionSearch(e.editing,this._currentOutlineDefinitions,t);n?this._setActiveViewItem(this._currentOutlineDefinitions.indexOf(n)):this._setActiveViewItem(-1)}}function binaryActiveDefinitionSearch(e,t,n,i=0,r=t.length-1){const s=Math.floor(i+(r-i)/2);if(r>=i){const o=t[s],a=e.mapper.toViewElement(o.modelElement);if(!a)return null;const l=e.view.domConverter.mapViewToDom(a);return new Rect(l).bottom>n?binaryActiveDefinitionSearch(e,t,n,i,s-1):binaryActiveDefinitionSearch(e,t,n,s+1,r)}return s<0?null:t[s]}async function checkLicense$c(e){const t=g([113,99,110,66,48,100,71,87,84,114,103,83,90,97,52,69,85,105,79,68,54,80,65,119,104,57,111,82,77,112,70,88,81,53,122,89,101,56,49,117,121,72,76,75,120,98,74,51,50,67,106,73,108,102,107,109,55,86,118,115,116,78]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([113]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([68,79]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class DocumentOutline extends Plugin{static get requires(){return[DocumentOutlineUtils,DocumentOutlineUI]}static get pluginName(){return"DocumentOutline"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("documentOutlineLicenseKeyValid"==r||"documentOutlineLicenseKeyInvalid"==r||"documentOutlineLicenseKeyExpired"==r||"documentOutlineLicenseKeyDomainLimit"==r||"documentOutlineLicenseKeyNotAllowed"==r||"documentOutlineLicenseKeyEvaluationLimit"==r||"documentOutlineLicenseKeyTrialLimit"==r||"documentOutlineLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"documentOutlineLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"documentOutlineLicenseKeyExpired"==t&&e._showLicenseError("expired"),"documentOutlineLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"documentOutlineLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","DocumentOutline"),"documentOutlineLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"documentOutlineLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"documentOutlineLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TableOfContentsCommand extends _0x338ed0{execute(){this.editor.model.change((e=>{this.editor.model.insertObject(e.createElement("tableOfContents"))}))}refresh(){const e=this.editor.model,t=e.document.selection.getFirstPosition();this.isEnabled=null!==(t&&e.schema.findAllowedParent(t,"tableOfContents"))}}class HeadingId extends Plugin{static get pluginName(){return"HeadingId"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){const e=this.editor;e.config.get("headingId.modelAttributeName")||(getDefaultHeadingMapNames(this.editor.config.get("heading.options")).forEach(((t,n)=>{this._customUpcastHeadingsConversion(n),this._customDataDowncastHeadingsConversion(t),e.model.schema.isRegistered(t)&&e.model.schema.extend(t,{allowAttributes:"headingId"})})),this._registerHeadingIdAttributePostfixer())}_customUpcastHeadingsConversion(e){this.editor.conversion.for("upcast").add((t=>t.on("element:"+e,((e,t,n)=>{const{consumable:i,writer:r}=n,s=t.viewItem.getAttribute("id"),o=t.modelRange.getContainedElement();if(o)return s&&s.length||o.hasAttribute("headingId")?void(i.consume(t.viewItem,{attributes:["id"]})&&r.setAttribute("headingId",s,o)):(i.consume(t.viewItem,{attributes:["id"]}),void r.setAttribute("headingId",uid(),o))}),{priority:priorities.get("low")+.5})))}_customDataDowncastHeadingsConversion(e){this.editor.conversion.for("downcast").add((t=>t.on("attribute:headingId:"+e,((e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const i=t.item.getAttribute("headingId"),r=n.mapper.toViewElement(t.item);n.writer.setAttribute("id",i,r)}))))}_registerHeadingIdAttributePostfixer(){const e=this.editor,t=new Set,n=new Set;function i(e,t){const i=uid();return n.add(i),e.setAttribute("headingId",i,t),i}e.model.document.registerPostFixer((r=>{const s=e.model.document.differ.getChanges();let o=!1;for(const e of s)if("insert"==e.type&&e.name)if(isHeading$1(e.name)){const s=e.attributes.get("headingId");"string"==typeof s?t.has(s)?(i(r,e.position.nodeAfter),o=!0):n.add(s):(i(r,e.position.nodeAfter),o=!0)}else"string"==typeof e.attributes.get("headingId")&&(a=r,l=e.position.nodeAfter,a.removeAttribute("headingId",l),o=!0);else if("remove"==e.type){const n=e.attributes.get("headingId");"string"==typeof n&&t.delete(n)}var a,l;return o})),e.model.document.on("change",(()=>{n.forEach((e=>t.add(e))),n.clear()}))}}function isHeading$1(e){return!!e.match(/heading\d/)}function getDefaultHeadingMapNames(e){const t=new Map;return e?(e.forEach((e=>{"paragraph"!==e.model&&t.set(e.view,e.model)})),t.get("h1")||t.set("h1","heading1"),t):t}class TableOfContentsEditing extends Plugin{static get pluginName(){return"TableOfContentsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Widget,DocumentOutlineUtils,HeadingId]}constructor(e){super(e),this._currentOutlineDefinitions=[],this._tableOfContentsElements=new Set,this._headingIdModelAttributeName="headingId"}init(){const e=this.editor,t=e.editing.view.document;e.config.get("headingId.modelAttributeName")&&(this._headingIdModelAttributeName=e.config.get("headingId.modelAttributeName")),this.listenTo(t,"click",((e,t)=>{if(!t.target)return;const n=t.target.getCustomProperty("tableOfContentsHeadingIndex");Number.isInteger(n)&&(t.domEvent.preventDefault(),e.stop(),this._handleScrollToHeading(n))}),{priority:"high",context:"$capture"}),this._defineSchema(),this._defineConverters(),e.commands.add("insertTableOfContents",new TableOfContentsCommand(e)),e.plugins.get("DocumentOutlineUtils").on("change",((e,t)=>{this._currentOutlineDefinitions=t.outlineDefinitions,this._updateTableOfContentsElements()})),this.listenTo(e.model.document,"change",(()=>{this._trackNewToCElements()}))}afterInit(){checkLicense$b(this)}_updateTableOfContentsElements(){this._tableOfContentsElements.forEach((e=>{"$graveyard"!==e.rootName&&this.editor.editing.reconvertItem(e)}))}_trackNewToCElements(){for(const e of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if("insert"!==e.type||"tableOfContents"!==e.name)return;this._tableOfContentsElements.add(e.position.nodeAfter)}}_defineSchema(){this.editor.model.schema.register("tableOfContents",{inheritAllFrom:"$blockObject"})}_defineConverters(){const e=this.editor.conversion;e.for("upcast").elementToElement({model:"tableOfContents",view:{name:"div",classes:"table-of-contents"}}),e.for("dataDowncast").elementToStructure({model:"tableOfContents",view:(e,{writer:t})=>this._createTableOfContents(t,!0)}),e.for("editingDowncast").elementToStructure({model:"tableOfContents",view:(e,{writer:t})=>{this._tableOfContentsElements.add(e);const n=this._createTableOfContents(t);return toWidget(n,t,{label:getTranslation$e(this.editor.locale,"Table of contents")})}}),this.editor.data.registerRawContentMatcher({name:"div",classes:"table-of-contents"}),this.editor.editing.mapper.on("viewToModelPosition",this._redirectMapper(),{priority:"high"})}_createTableOfContents(e,t=!1){const{locale:n}=this.editor,i=e.createContainerElement("div",{class:"table-of-contents"+(0===this._currentOutlineDefinitions.length?" table-of-contents_empty":""),...!t&&{"data-table-of-contents-label":getTranslation$e(n,"Table of contents")}});0===this._currentOutlineDefinitions.length&&!1===t&&e.insert(e.createPositionAt(i,"end"),e.createContainerElement("p",{class:"table-of-contents__placeholder"},[e.createText(getTranslation$e(n,"No headings were found in the document."))]));const r=t?"":"["+getTranslation$e(n,"Empty heading")+"]";let s=i;return this._currentOutlineDefinitions.forEach(((n,i,o)=>{const a=this.editor.model.hasContent(n.modelElement,{ignoreWhitespaces:!0}),l=a?n.text:r,c=n.modelElement.getAttribute(this._headingIdModelAttributeName),d=e.createContainerElement("a",{href:"#"+c,...!t&&{tabindex:"-1"}},[e.createText(l)]),u=this.editor.config.get("documentOutline.showEmptyHeadings");e.setCustomProperty("tableOfContentsHeadingIndex",i,d);const h=e.createContainerElement("li",null,[a||!t&&u?d:e.createText("")]),m=i?o[i-1].level:0,g=Math.abs(n.level-m);if(n.level>m){const t=wrapInList(h,g,e);e.insert(e.createPositionAt(s,"end"),t)}else{const t=getOuterListByLevelDifference(s,g);e.insert(e.createPositionAt(t,"end"),h)}s=h})),i}_handleScrollToHeading(e){const t=this._currentOutlineDefinitions[e].modelElement;this.editor.model.change((e=>{e.setSelection(t,0)})),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0})}_redirectMapper(){return(e,t)=>{const n=t.mapper,i=n.findMappedViewAncestor(t.viewPosition),r=n.toModelElement(i);r.is("element","tableOfContents")&&(t.modelPosition=this.editor.model.createPositionAt(r,0),e.stop())}}}function wrapInList(e,t,n){return 1===t?n.createContainerElement("ol",null,[e]):n.createContainerElement("ol",null,[n.createContainerElement("li",null,[wrapInList(e,t-1,n)])])}function getOuterListByLevelDifference(e,t){return e.getAncestors({includeSelf:!0,parentFirst:!0}).filter((e=>e.is("element","ol")))[t]}async function checkLicense$b(e){const t=g([78,76,83,53,88,75,107,110,49,74,67,122,109,121,52,99,101,86,70,105,65,71,119,108,79,50,117,106,73,100,85,113,103,89,97,112,57,51,48,66,104,87,69,118,114,120,116,54,90,68,111,84,98,82,55,56,72,77,115,81,80,102]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([78]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([84,79,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class TableOfContentsUI extends Plugin{static get pluginName(){return"TableOfContentsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("tableOfContents",(()=>{const e=this._createButton(ButtonView);return e.tooltip=!0,e})),e.ui.componentFactory.add("menuBar:tableOfContents",(()=>this._createButton(MenuBarMenuListItemButtonView))),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("tableOfContentsLicenseKeyValid"==r||"tableOfContentsLicenseKeyInvalid"==r||"tableOfContentsLicenseKeyExpired"==r||"tableOfContentsLicenseKeyDomainLimit"==r||"tableOfContentsLicenseKeyNotAllowed"==r||"tableOfContentsLicenseKeyEvaluationLimit"==r||"tableOfContentsLicenseKeyTrialLimit"==r||"tableOfContentsLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"tableOfContentsLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"tableOfContentsLicenseKeyExpired"==e&&t._showLicenseError("expired"),"tableOfContentsLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"tableOfContentsLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","TableOfContents"),"tableOfContentsLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"tableOfContentsLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"tableOfContentsLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}_createButton(e){const t=this.editor,n=t.locale,i=t.commands.get("insertTableOfContents"),r=new e(n);return r.set({label:getTranslation$e(n,"Table of contents"),icon:icons.tableOfContents}),r.bind("isEnabled").to(i,"isEnabled"),this.listenTo(r,"execute",(()=>{t.execute("insertTableOfContents"),t.editing.view.focus()})),r}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TableOfContents extends Plugin{static get requires(){return[TableOfContentsEditing,TableOfContentsUI]}static get pluginName(){return"TableOfContents"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}function getTranslation$d(e,t){const n=e.t;switch(t){case"Export to PDF":return n("Export to PDF");case"An error occurred while generating the PDF.":return n("An error occurred while generating the PDF.");case"PDF export started":return n("PDF export started");case"PDF export failed":return n("PDF export failed");case"PDF export successful":return n("PDF export successful");case"Exporting PDF document":return n("Exporting PDF document");default:return t}}const PRODUCTION_URL$1="https://pdf-converter.cke-cs.com/v1/convert/";class ExportPdfCommand extends _0x338ed0{constructor(e){super(e),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(e={}){const t=this.editor,n=e.converterUrl||PRODUCTION_URL$1,i=e.dataCallback||(e=>e.data.get()),r=t.plugins.get("ExportPdf"),s=e.token||r._token;return this.isBusy=!0,this.refresh(),collectStylesheets(e.stylesheets||["EDITOR_STYLES"]).then((async r=>{if(t.ui.ariaLiveAnnouncer.announce(getTranslation$d(t.locale,"PDF export started")),t.plugins.has("MergeFields")){e.converterOptions||(e.converterOptions={});const n=t.plugins.get("MergeFieldsEditing"),i=n.previewMode,{prefix:r,suffix:s}=t.config.get("mergeFields"),o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP88B8AAuUB8e2ujYwAAAAASUVORK5CYII=",a={prefix:r,suffix:s,data:{}};if("$labels"===i)for(const e of n.getMergeFieldsIds())"image"===n.getMergeFieldType(e)?a.data[e]=o:a.data[e]=n.wrapInAffixes(n.getLabel(e)||e);else{const e="$defaultValues"===i?n.getDefaultValues():n.getDataSetValues(i,!0);for(const t of Object.entries(e)){const[e,i]=t;"image"===n.getMergeFieldType(e)?a.data[e]=null!==i?i:o:a.data[e]=null!==i?i:n.getLabel(e)||e}}e.converterOptions.merge_fields=a}const o={html:'<html>\n\t\t\t\t\t\t<head>\n\t\t\t\t\t\t\t<title>CKEditor 5 PDF document</title>\n\t\t\t\t\t\t\t<meta charset="utf-8">\n\t\t\t\t\t\t</head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">\n\t\t\t\t\t\t\t\t'+await i(t)+"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>",css:r,options:e.converterOptions},a={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf",...s?{Authorization:s.value}:null,"x-cs-app-id":e.appID||"cke5"},body:JSON.stringify(o)};return window.fetch(n,a).then((e=>{if(200!==e.status)throw e;return e.blob()})).then((n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$d(t.locale,"PDF export successful"));const i="function"==typeof e.fileName?e.fileName():e.fileName;this._downloadFile(n,i||"document.pdf")}))})).catch((e=>{const n=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(getTranslation$d(t.locale,"PDF export failed"),{politeness:"assertive"}),n.showWarning(getTranslation$d(t.locale,"An error occurred while generating the PDF.")),e})).finally((()=>{this.isBusy=!1,this.refresh()}))}_downloadFile(e,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.click(),n.remove()}}var exportPdfIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v6.5h1.5v-5h8v5h5V11H19V4.5ZM14 2l3.3 3H14V2Z"/><path d="m12.452 18.5 1.25 1.5H3v-3h1.5v1.5h7.952Z"/><path d="M19.826 16.843a.75.75 0 1 0-1.152-.96L17.5 17.29V13H16v4.29l-1.174-1.408a.75.75 0 1 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="M1.63 14.24V12.3h.88c.66 0 1.14-.15 1.46-.45.32-.3.48-.71.48-1.24 0-.52-.15-.91-.44-1.2C3.7 9.15 3.28 9 2.69 9H0v5.24h1.63Zm.4-3h-.4v-1.17h.46c.3 0 .5.05.62.17.1.11.16.25.16.42 0 .16-.06.3-.19.41-.13.11-.34.16-.66.16l.01.01Zm5.7 3c.28 0 .6-.05.96-.14.26-.07.5-.21.73-.42.22-.2.4-.47.53-.77.12-.31.19-.75.19-1.3 0-.37-.04-.7-.13-1.02a2.3 2.3 0 0 0-.42-.84c-.19-.24-.43-.43-.72-.56C8.57 9.06 8.2 9 7.72 9h-2.4v5.24H7.73Zm-.4-1.19h-.4v-2.86h.4c.43 0 .73.1.91.3.18.2.27.59.27 1.14 0 .42-.04.73-.12.91a.76.76 0 0 1-.34.4c-.14.07-.38.11-.72.11Zm5.3 1.2V12.1h2.02v-1.06h-2.03v-.91H15V9h-4v5.24h1.62l.01.01Z"/></svg>\n';class ExportPdfUI extends Plugin{static get pluginName(){return"ExportPdfUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("exportPdf",(()=>{const t=this._createButton(ButtonView),n=e.commands.get("exportPdf");return t.set({tooltip:!0}),t.bind("isOn").to(n,"isBusy"),t})),e.ui.componentFactory.add("menuBar:exportPdf",(()=>this._createButton(MenuBarMenuListItemButtonView)))}_createButton(e){const t=this.editor,n=t.config.get("exportPdf")||{},i=t.commands.get("exportPdf"),r=new e(t.locale),s=new SpinnerView;return r.children.add(s),s.bind("isVisible").to(i,"isBusy"),r.iconView.bind("isVisible").to(i,"isBusy",(e=>!e)),r.set({icon:exportPdfIcon}),r.bind("isEnabled").to(i,"isEnabled"),r.bind("label").to(i,"isBusy",(e=>getTranslation$d(t.locale,e?"Exporting PDF document":"Export to PDF"))),this.listenTo(r,"execute",(()=>{t.execute("exportPdf",n),t.editing.view.focus()})),r}}class ExportPdf extends Plugin{static get pluginName(){return"ExportPdf"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["CloudServices",Notification,ExportPdfUI]}init(){const e=this.editor,t=e.config.get("exportPdf")||{};e.commands.add("exportPdf",new ExportPdfCommand(e));const n=e.plugins.get("CloudServices");!1===t.tokenUrl?this._token=null:t.tokenUrl?n.registerTokenUrl(t.tokenUrl).then((e=>{this._token=e})):this._token=n.token}}function getConverterOptions(e,t={}){const n=e.plugins.has("Users"),i=e.plugins.has("CommentsRepository"),r=e.plugins.has("TrackChanges"),s=t;if(n&&i){const t=getComments(e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));Object.keys(t).length&&(s.comments=t)}if(n&&r){const t=e.plugins.get("TrackChanges"),n=e.plugins.get("Users"),i=getSuggestions(t.getSuggestions({toJSON:!0}),n.users);Object.keys(i).length&&(s.suggestions=i)}return(s.suggestions||s.comments)&&(s.timezone=(new Intl.DateTimeFormat).resolvedOptions().timeZone),s}function getComments(e){const t={};if(!e.length)return t;for(const n of e)n.comments.map((e=>{void 0===t[n.id]&&(t[n.id]=[]),t[n.id].push({author:e.author.name,content:e.content,created:e.createdAt,is_resolved:n.isResolved})}));return t}function getSuggestions(e,t){const n={};if(!e.length||!t.length)return n;for(const{id:i,createdAt:r,authorId:s,attributes:o}of e){const e=o&&o["@external"],a=e?e.authorName:t.get(s).name;n[i]={author:a,created:r}}return n}function getConverterOptionsV2(e,t={}){const n=e.plugins.has("Users"),i=e.plugins.has("CommentsRepository"),r=e.plugins.has("TrackChanges"),s=e.plugins.has("MergeFields"),o=e.locale.contentLanguage,a=t,l={};if(a.document=a.document||{},a.document.language=a.document.language||o,n&&i){const t=getCommentsV2(e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));t.length&&(l.comment_threads=t)}if(n&&r){const t=e.plugins.get("TrackChanges"),n=e.plugins.get("Users"),i=getSuggestionsV2(t.getSuggestions({toJSON:!0}),n.users);i.length&&(l.suggestions=i)}if(s){const t=e.plugins.get("MergeFieldsEditing"),n=t.previewMode,{prefix:i,suffix:r}=e.config.get("mergeFields");if(a.merge_fields={prefix:i,suffix:r},"$labels"!==n){a.merge_fields.data={};const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP88B8AAuUB8e2ujYwAAAAASUVORK5CYII=",i="$defaultValues"===n?t.getDefaultValues():t.getDataSetValues(n,!0);for(const n of Object.entries(i)){const[i,r]=n;"image"===t.getMergeFieldType(i)?a.merge_fields.data[i]=null!==r?r:e:a.merge_fields.data[i]=null!==r?r:t.getLabel(i)||i}}}return(l.comment_threads||l.suggestions)&&(a.timezone=(new Intl.DateTimeFormat).resolvedOptions().timeZone,a.collaboration_features=l),a}function getCommentsV2(e){const t=[];if(!e.length)return t;for(const n of e){const e=n.comments.map((e=>({author:e.author.name,content:e.content,created_at:e.createdAt})));t.push({thread_id:n.id,is_resolved:n.isResolved,comments:e})}return t}function getSuggestionsV2(e,t){return e.length&&t.length?e.map((({id:e,createdAt:n,authorId:i,attributes:r})=>{const s=r&&r["@external"];return{id:e,author:s?s.authorName:t.get(i).name,created_at:n}})):[]}function getTranslation$c(e,t){const n=e.t;switch(t){case"Export to Word":return n("Export to Word");case"An error occurred while generating the Word file.":return n("An error occurred while generating the Word file.");case"Word document export started":return n("Word document export started");case"Word document export failed":return n("Word document export failed");case"Word document export successful":return n("Word document export successful");case"Exporting Word document":return n("Exporting Word document");default:return t}}const PRODUCTION_URL="https://docx-converter.cke-cs.com/v1/convert",PRODUCTION_URL_V2="https://docx-converter.cke-cs.com/v2/convert/html-docx",firstVersionApiKeys=["orientation","margin_top","margin_right","margin_bottom","margin_left","format","header","footer","comments","suggestions"];class ExportWordCommand extends _0x338ed0{constructor(e){super(e),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(e={}){const t=this.editor,n=e.version||2,i=1===n,r=e.converterUrl||(i?PRODUCTION_URL:PRODUCTION_URL_V2),s=e.converterOptions||{},o=t.plugins.get("ExportWord"),a=e.token||o._token,l=!0===s.auto_pagination,c=e.dataCallback||(e=>e.data.get({pagination:l}));return 2===n&&isV1ApiUsed(s)&&logWarning("export-word-v1-api-is-deprecated"),this.isBusy=!0,this.refresh(),collectStylesheets(e.stylesheets||["EDITOR_STYLES"]).then((async n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$c(t.locale,"Word document export started"));const o=await c(t),l={html:'<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">'+o+"</div>",css:n,[i?"options":"config"]:{...s,...i?getConverterOptions(t,s):getConverterOptionsV2(t,s)}},d={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/docx",...a?{Authorization:a.value}:null},body:JSON.stringify(l)};return window.fetch(r,d).then((e=>{if(200!==e.status)throw e;return e.blob()})).then((n=>{t.ui.ariaLiveAnnouncer.announce(getTranslation$c(t.locale,"Word document export successful"));const i="function"==typeof e.fileName?e.fileName():e.fileName;this._downloadFile(n,i||"document.docx")}))})).catch((e=>{const n=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(getTranslation$c(t.locale,"Word document export failed"),{politeness:"assertive"}),n.showWarning(getTranslation$c(t.locale,"An error occurred while generating the Word file.")),e})).finally((()=>{this.isBusy=!1,this.refresh()}))}_downloadFile(e,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.click(),n.remove()}}function isV1ApiUsed(e){for(const t of firstVersionApiKeys)if(void 0!==e[t])return!0;return!1}var exportWordIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.826 16.843a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="m14 0 5 4.5v9.741a2.737 2.737 0 0 0-1.5-.617V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M3 17.5h6.746c.1.22.23.429.391.623l.731.877H3v-1.5Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.6.6 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001Z"/></svg>\n';class ExportWordUI extends Plugin{static get pluginName(){return"ExportWordUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("exportWord",(()=>{const t=e.commands.get("exportWord"),n=this._createButton(ButtonView);return n.set({tooltip:!0}),n.bind("isOn").to(t,"isBusy"),n})),e.ui.componentFactory.add("menuBar:exportWord",(()=>this._createButton(MenuBarMenuListItemButtonView)))}_createButton(e){const t=this.editor,n=t.config.get("exportWord")||{},i=t.commands.get("exportWord"),r=new e(t.locale),s=new SpinnerView;return r.children.add(s),s.bind("isVisible").to(i,"isBusy"),r.iconView.bind("isVisible").to(i,"isBusy",(e=>!e)),r.set({icon:exportWordIcon}),r.bind("isEnabled").to(i,"isEnabled"),r.bind("label").to(i,"isBusy",(e=>getTranslation$c(t.locale,e?"Exporting Word document":"Export to Word"))),this.listenTo(r,"execute",(()=>{t.execute("exportWord",n),t.editing.view.focus()})),r}}class ExportWord extends Plugin{static get pluginName(){return"ExportWord"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["CloudServices",Notification,ExportWordUI]}init(){const e=this.editor,t=e.config.get("exportWord")||{};e.commands.add("exportWord",new ExportWordCommand(e));const n=e.plugins.get("CloudServices");!1===t.tokenUrl?this._token=null:t.tokenUrl?n.registerTokenUrl(t.tokenUrl).then((e=>{this._token=e})):this._token=n.token}}const COPY_FORMAT_COMMAND_NAME="copyFormat",PASTE_FORMAT_COMMAND_NAME="pasteFormat",CURSOR_ACTIVE_CSS_CLASS="ck-format-painter-active";class CopyFormatCommand extends _0x338ed0{constructor(e){super(e),this.value=void 0,this.on("change:isEnabled",((e,t,n)=>{n||this.reset()})),this.on("change:value",(()=>e.commands.get(PASTE_FORMAT_COMMAND_NAME).refresh()))}execute(){this.value=this._getFormattingAttributes()}reset(){this.value=void 0}_getFormattingAttributes(){const e=this.editor.model,t=e.document.selection;return Object.fromEntries(Array.from(t.getAttributes()).filter((([t])=>e.schema.getAttributeProperties(t).isFormatting)))}}class PasteFormatCommand extends _0x338ed0{constructor(e){super(e),this._removeFormatCommand=new RemoveFormatCommandAlias(e)}execute(e={}){const t=this.editor.model,n=t.document.selection,i=Array.from(n.getRanges()),r=n.isCollapsed?[this._createRangeOnEntireWord(t,n)]:i;t.change((n=>{n.setSelection(r),this._removeFormatCommand.execute();for(const i in e)for(const s of t.schema.getValidRanges(r,i))n.setAttribute(i,e[i],s);n.setSelection(i)}))}_createRangeOnEntireWord(e,t){const n=e.createSelection(t);e.modifySelection(n,{unit:"word",direction:"backward"});const i=n.getFirstPosition();e.modifySelection(n,{unit:"word",direction:"forward"});const r=n.getLastPosition();return e.createRange(i,r)}}class RemoveFormatCommandAlias extends _0x338ed0{execute(){const e=this.editor.model,t=e.schema;e.change((n=>{for(const i of this._getFormattingItems(e.document.selection,t))if(i.is("selection"))for(const e of this._getFormattingAttributes(i,t))n.removeSelectionAttribute(e);else{const e=n.createRangeOn(i);for(const r of this._getFormattingAttributes(i,t))n.removeAttribute(r,e)}}))}*_getFormattingItems(e,t){const n=e=>!!first(this._getFormattingAttributes(e,t));for(const i of e.getRanges())for(const e of i.getItems())!t.isBlock(e)&&n(e)&&(yield e);for(const t of e.getSelectedBlocks())n(t)&&(yield t);n(e)&&(yield e)}*_getFormattingAttributes(e,t){for(const[n]of e.getAttributes()){const e=t.getAttributeProperties(n);e&&e.isFormatting&&(yield n)}}}class FormatPainterEditing extends Plugin{static get pluginName(){return"FormatPainterEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.commands.add(COPY_FORMAT_COMMAND_NAME,new CopyFormatCommand(e)),e.commands.add(PASTE_FORMAT_COMMAND_NAME,new PasteFormatCommand(e)),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("formatPainterLicenseKeyValid"==r||"formatPainterLicenseKeyInvalid"==r||"formatPainterLicenseKeyExpired"==r||"formatPainterLicenseKeyDomainLimit"==r||"formatPainterLicenseKeyNotAllowed"==r||"formatPainterLicenseKeyEvaluationLimit"==r||"formatPainterLicenseKeyTrialLimit"==r||"formatPainterLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"formatPainterLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"formatPainterLicenseKeyExpired"==e&&t._showLicenseError("expired"),"formatPainterLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"formatPainterLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","FormatPainter"),"formatPainterLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"formatPainterLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"formatPainterLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function getTranslation$b(e,t){const n=e.t;switch(t){case"Paint formatting":return n("Paint formatting");case"Copy text formatting":return n("Copy text formatting");case"Paste text formatting":return n("Paste text formatting");case"Continuous painting":return n("Continuous painting");case"Keeps the painter on after setting the formatting.":return n("Keeps the painter on after setting the formatting.");case"Formatting copied.":return n("Formatting copied.");case"Pasted formatting.":return n("Pasted formatting.");default:return t}}class FormatPainterUI extends(/*   -- @preserve */
DomEmitterMixin(Plugin)){static get pluginName(){return"FormatPainterUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.editing.view.addObserver(ClickObserver),e.accessibility.addKeystrokeInfos({keystrokes:[{label:getTranslation$b(e.locale,"Copy text formatting"),keystroke:"Ctrl+Alt+C"},{label:getTranslation$b(e.locale,"Paste text formatting"),keystroke:"Ctrl+Alt+V"}]}),e.ui.componentFactory.add("formatPainter",(t=>{const n=createDropdown(t,SplitButtonView),i=e.commands.get(COPY_FORMAT_COMMAND_NAME);n.buttonView.set({label:getTranslation$b(e.locale,"Paint formatting"),icon:icons.paintRoller,keystroke:"Ctrl+Alt+C",tooltip:!0}),n.class="ck-format-painter-dropdown",i&&(n.bind("isEnabled").to(i,"isEnabled"),this.listenTo(i,"change:isEnabled",((e,t,n)=>{n||this._finishPainting()})),n.buttonView.bind("isOn").to(i,"value",(e=>!!e)),this.listenTo(e,"destroy",(()=>this._toggleSpecialCursor(!1))),this.listenTo(i,"change:value",((e,t,n)=>{this._toggleSpecialCursor(!!n)})));const r=new ViewModel({withText:!0,label:getTranslation$b(e.locale,"Continuous painting"),tooltip:getTranslation$b(e.locale,"Keeps the painter on after setting the formatting."),isOn:!1,role:"menuitemcheckbox"});addListToDropdown(n,new Collection([{type:"switchbutton",model:r}]),{role:"menu"});const s=()=>{this._copyFormatting(),this.listenTo(_0x49a38d.window.document,"mouseup",(()=>{this._pasteFormatting(),r.isOn||this._finishPainting()}))};return this.listenTo(n,"execute",(()=>{r.isOn=!r.isOn})),this.listenTo(n.buttonView,"execute",(()=>{e.editing.view.focus(),n.buttonView.isOn?this._finishPainting():s()})),e.keystrokes.set("Ctrl+Alt+C",((e,t)=>{s(),r.isOn=!0,t()}),{priority:"high"}),e.keystrokes.set("Ctrl+Alt+V",((e,t)=>{n.buttonView.isOn&&(this._pasteFormatting(),r.isOn||this._finishPainting(),t())}),{priority:"high"}),e.keystrokes.set("Esc",((e,t)=>{n.buttonView.isOn&&(r.isOn=!1,this._finishPainting(),t())})),n}))}afterInit(){checkLicense$a(this)}_toggleSpecialCursor(e){this.editor.editing.view.change((t=>{for(const n of this.editor.editing.view.document.roots)e?t.addClass(CURSOR_ACTIVE_CSS_CLASS,n):t.removeClass(CURSOR_ACTIVE_CSS_CLASS,n)}))}_copyFormatting(){const{editor:e}=this;e.execute(COPY_FORMAT_COMMAND_NAME),e.ui.ariaLiveAnnouncer.announce(getTranslation$b(e.locale,"Formatting copied."))}_pasteFormatting(){const{editor:e}=this,t=e.commands.get(COPY_FORMAT_COMMAND_NAME).value;e.execute(PASTE_FORMAT_COMMAND_NAME,t),e.ui.ariaLiveAnnouncer.announce(getTranslation$b(e.locale,"Pasted formatting."))}_finishPainting(){this.editor.commands.get(COPY_FORMAT_COMMAND_NAME).reset(),this.stopListening(_0x49a38d.window.document,"mouseup")}}async function checkLicense$a(e){const t=g([112,57,65,102,119,74,84,100,70,48,83,116,86,79,121,81,78,82,103,117,71,51,72,77,68,105,113,54,66,85,69,99,97,55,104,109,53,90,50,111,89,101,106,88,87,114,118,75,108,80,49,122,67,110,120,56,73,76,52,107,98,115]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([112]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([70,80]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class FormatPainter extends Plugin{static get requires(){return[FormatPainterEditing,FormatPainterUI]}static get pluginName(){return"FormatPainter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}var importWordIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14 0 5 4.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M10.74 18a2.76 2.76 0 0 1-.469-.5H3V19h9.25v-.374A2.737 2.737 0 0 1 10.74 18Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.602.602 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001ZM11.674 15.407a.75.75 0 1 0 1.152.96L14 14.96V20h1.5v-5.04l1.174 1.408a.75.75 0 1 0 1.152-.96l-2.346-2.816a.95.95 0 0 0-1.46 0l-2.346 2.815Z"/></svg>\n';function getTranslation$a(e,t){const n=e.t;switch(t){case"Import from Word":return n("Import from Word");case"An error occurred while importing the Word file.":return n("An error occurred while importing the Word file.");case"Importing Word document":return n("Importing Word document");default:return t}}class ImportWordUI extends Plugin{static get pluginName(){return"ImportWordUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("importWord",(()=>{const t=this._createButton(FileDialogButtonView),n=e.commands.get("importWord");return t.bind("isOn").to(n,"isBusy"),t.tooltip=!0,t})),e.ui.componentFactory.add("menuBar:importWord",(()=>this._createButton(MenuBarMenuListItemFileDialogButtonView)))}_createButton(e){const t=this.editor,n=t.commands.get("importWord"),i=new e(t.locale),r=new SpinnerView;return i.set({acceptedType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template"}),i.set({icon:importWordIcon}),i.bind("isEnabled").to(n),i.bind("label").to(n,"isBusy",(e=>getTranslation$a(t.locale,e?"Importing Word document":"Import from Word"))),r.bind("isVisible").to(n,"isBusy"),i.iconView.bind("isVisible").to(n,"isBusy",(e=>!e)),i.children.add(r),i.on("done",((e,n)=>{t.execute("importWord",n[0],{}),t.editing.view.focus()})),i}}class ImportWordCommand extends _0x338ed0{constructor(e){super(e),this.set("isBusy",!1),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.on("dataInsert",((t,n)=>{const i=new DataTransfer;i.setData("text/html",n.html);const r=this._importMarker.getRange();this.editor.model.enqueueChange(this._undoStepBatch,(t=>{this._importMarker.stopListening(),t.setSelection(r),e.editing.view.document.fire("clipboardInput",{dataTransfer:i})}))}),{priority:"low"})}refresh(){this.isEnabled=this._checkEnabled()}execute(e,t={}){if(this.isBusy)return Promise.resolve();const n=this.editor.config.get("importWord");if(this.editor.plugins.has("MergeFields")){const{prefix:e,suffix:n}=this.editor.config.get("mergeFields");t.merge_fields={prefix:e,suffix:n}}const i={url:n.converterUrl,file:e,serviceConfig:{...t,formatting:n.formatting,timezone:(new Intl.DateTimeFormat).resolvedOptions().timeZone}};return this._prepareForImport(),this._sendImportRequest(i).then(this._handleImportResponse.bind(this)).catch(this._handleImportFailure.bind(this)).finally(this._cleanUpAfterImport.bind(this))}_checkEnabled(){if(this.isBusy)return!1;const e=this.editor.model,t=e.schema,n=e.document.selection,i=first(n.getSelectedBlocks());return!!i&&t.checkChild(i.parent,"paragraph")}_prepareForImport(){const e=this.editor,t=e.model,n=t.document.selection;this._abortController=new AbortController,this._undoStepBatch=e.model.createBatch({isUndoable:!0}),t.enqueueChange(this._undoStepBatch,(e=>{n.isCollapsed||t.deleteContent(n,{leaveUnmerged:!0});const i=n.getFirstPosition(),r=first(n.getSelectedBlocks());let s;s=r.is("element","paragraph")&&r.isEmpty?i:i.isAtStart?t.createPositionBefore(r):i.isAtEnd?t.createPositionAfter(r):e.split(i).position,this._importMarker=e.addMarker("importWord:"+uid(),{usingOperation:!1,affectsData:!1,range:new _0x571283(s)}),this._importMarker.on("change:range",(()=>{"$graveyard"===this._importMarker.getRange().root.rootName&&this._abortController.abort()}))})),this.isBusy=!0,this.refresh()}_cleanUpAfterImport(){const e=this.editor.model;e.markers.has(this._importMarker)&&e.enqueueChange(this._undoStepBatch,(e=>{e.removeMarker(this._importMarker)})),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.isBusy=!1,this.refresh()}_sendImportRequest({url:e,file:t,serviceConfig:n}){const i=this.editor.plugins.get("ImportWordEditing").getToken(),r=new FormData;r.set("config",JSON.stringify(n)),r.set("file",t);const s={method:"POST",headers:{},body:r,signal:this._abortController.signal};return i&&(s.headers.Authorization=i.value),fetch(e,s)}_handleImportResponse(e){return e.ok?e.json().then((e=>{this.editor.model.markers.has(this._importMarker)&&"$graveyard"!==this._importMarker.getRange().root.rootName&&this.fire("dataInsert",e)})):Promise.reject()}_handleImportFailure(){if(this._abortController.signal.aborted)return void logWarning("import-word-plugin-import-cancelled");const e=this.editor,t=getTranslation$a(e.locale,"An error occurred while importing the Word file.");e.plugins.get("Notification").showWarning(t),logError("import-word-plugin-conversion-failed")}}class ImportWordEditing extends Plugin{static get pluginName(){return"ImportWordEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Notification,ClipboardPipeline,"CloudServices"]}constructor(e){super(e),this._token=null}async init(){const e=this.editor;e.config.define("importWord",{converterUrl:"https://docx-converter.cke-cs.com/v2/convert/docx-html",tokenUrl:(e.config.get("cloudServices")||{}).tokenUrl,formatting:{resets:"none",defaults:"none",styles:"inline"}}),e.commands.add("importWord",new ImportWordCommand(e));const{tokenUrl:t}=e.config.get("importWord");if(t){const{tokenUrl:n}=e.config.get("cloudServices")||{};this._token=t===n?e.plugins.get("CloudServices").token:await e.plugins.get("CloudServices").registerTokenUrl(t)}}getToken(){return this._token}}class ImportWord extends Plugin{static get pluginName(){return"ImportWord"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[ImportWordEditing,ImportWordUI]}}class MultiLevelListCommand extends _0x338ed0{constructor(e,t,n){super(e),this.defaultListMarkerStyle=t,this._listDefinitions=n,this._listUtils=this.editor.plugins.get("ListUtils")}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=e.listMarkerStyle||this.defaultListMarkerStyle;t.change((()=>{const e=this._getListTypeFromListMarkerStyle(n);if(!e)return;const t=e+"List";this.editor.execute(t,{additionalAttributes:{listMarkerStyle:n}})}))}_getValue(){const e=first(this.editor.model.document.selection.getSelectedBlocks());return this._listUtils.isListItemBlock(e)?e.getAttribute("listMarkerStyle"):null}_checkEnabled(){const e=this.editor,t=e.commands.get("customNumberedList"),n=e.commands.get("customBulletedList");return t.isEnabled||n.isEnabled}_getListTypeFromListMarkerStyle(e){const t=this._listDefinitions.find((t=>t.listMarkerStyle==e));return t?t.listType:null}}class MultiLevelListEditing extends Plugin{static get pluginName(){return"MultiLevelListEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["ListEditing"]}constructor(e){super(e);const t=this.editor.config.get("listMultiLevel.listDefinitions")||[];this._listDefinitions=[{listType:"customNumbered",listMarkerStyle:"legal",className:"legal-list",listMarkers:[{marker:e=>e+"."}]},...t]}init(){const e=this.editor,t=e.model,n=e.editing.view,i=e.plugins.get("ListEditing");e.commands.add("multiLevelList",new MultiLevelListCommand(e,"legal",this._listDefinitions)),t.schema.extend("$listItem",{allowAttributes:["listMarkerStyle","listMarker"]}),t.schema.addAttributeCheck(((e,t)=>{const n=e.last;if("listMarker"==t||"listMarkerStyle"==t)return!(!n.getAttribute("listItemId")||!this._listDefinitions.find((e=>e.listType==n.getAttribute("listType"))))&&void 0}));for(const n of this._listDefinitions)e.conversion.for("upcast").add((e=>{e.on("element:"+("customNumbered"==n.listType?"ol":"ul"),multiLevelListUpcastConverter(n,t.schema),{priority:"low"})})),i.registerDowncastStrategy({scope:"list",attributeName:"listMarkerStyle",setAttributeOnDowncast(e,t,i){t==n.listMarkerStyle?(e.addClass(["multi-level-list",n.className],i),e.setStyle("list-style-type","none",i)):(e.removeClass(["multi-level-list",n.className],i),e.removeStyle("list-style-type",i))}}),i.registerDowncastStrategy({scope:"itemMarker",attributeName:"listMarker",createElement(e,t,{dataPipeline:i}){if(!t.hasAttribute("listMarker"))return null;if(t.getAttribute("listType")!=n.listType||t.getAttribute("listMarkerStyle")!=n.listMarkerStyle)return null;const r=t.getAttribute("listMarker")+" ";return e.createUIElement("span",{class:"multi-level-list__marker",...!i&&{contenteditable:"false","data-multi-level-list-marker":r}},(function(e){const t=this.toDomElement(e);return i&&t.appendChild(e.createTextNode(r)),t}))},canInjectMarkerIntoElement:e=>t.schema.checkChild(e,"$text")&&t.schema.checkChild(e,"$inlineObject")&&!t.schema.isLimit(e)&&e.getAttribute("listType")==n.listType&&e.getAttribute("listMarkerStyle")==n.listMarkerStyle});e.conversion.for("upcast").add((e=>{e.on("element:span",multiLevelListMarkerUpcastConverter(n))})),i.on("postFixer",((e,{listNodes:t,writer:n})=>{const i=[];for(const{node:r,previousNodeInList:s}of t){const t=r.getAttribute("listType"),o=r.getAttribute("listMarkerStyle")||("customNumbered"==t?"legal":void 0),a=this._listDefinitions.find((e=>e.listType==t&&e.listMarkerStyle==o));if("customNumbered"!=t&&"customBulleted"!=t&&(r.hasAttribute("listMarker")&&(n.removeAttribute("listMarker",r),e.return=!0),r.hasAttribute("listMarkerStyle")&&(n.removeAttribute("listMarkerStyle",r),e.return=!0)),!a){"customBulleted"!=t||o||(n.setAttribute("listType","bulleted",r),e.return=!0);continue}r.hasAttribute("listMarkerStyle")||(n.setAttribute("listMarkerStyle",o,r),e.return=!0);const l=r.getAttribute("listIndent");if(s&&s.getAttribute("listItemId")==r.getAttribute("listItemId"))continue;i.length=l+1,s||i[l]?s&&s.getAttribute("listType")!=a.listType?i[l]=1:i[l]++:i[l]=r.getAttribute("listStart")||1;const c=generateMarker(l,a,i);r.getAttribute("listMarker")!=c&&(n.setAttribute("listMarker",c,r),e.return=!0)}}));const r=e.editing.view.document;this.listenTo(r,"clipboardOutput",((e,t)=>{const n=new Matcher({name:"span",classes:"multi-level-list__marker"}),i=new Matcher({name:"ol",classes:"multi-level-list",styles:{"list-style-type":"none"}}),r=new UpcastWriter(t.content.document),s=[];for(const e of r.createRangeIn(t.content).getItems())e.is("element")&&n.match(e)&&s.push(e),e.is("element")&&i.match(e)&&r.removeStyle("list-style-type",e);for(const e of s)r.remove(e)}))}afterInit(){checkLicense$9(this)}}function generateMarker(e,t,n){let i=t.listMarkers[e%t.listMarkers.length];if(void 0===i.showMarkerPath||i.showMarkerPath)return n.slice(0,e+1).map(((e,n)=>(i=t.listMarkers[n%t.listMarkers.length],getMarkerString(i.marker,e)))).join("");{const e=n[n.length-1];return getMarkerString(i.marker,e)}}function getMarkerString(e,t){return"function"==typeof e?e(t):e}function multiLevelListUpcastConverter(e,t){return(n,i,r)=>{const s=i.viewItem;if(i.modelRange||Object.assign(i,r.convertChildren(i.viewItem,i.modelCursor)),!r.consumable.test(s,{classes:e.className}))return;const o=Array.from(i.modelRange.getItems({shallow:!0})).filter((e=>t.checkAttribute(e,"listItemId")));if(!o.length)return;r.consumable.consume(s,{classes:e.className}),r.consumable.consume(s,{classes:"multi-level-list"}),r.consumable.consume(s,{styles:"list-style-type"});const a=o[0].getAttribute("listIndent");for(const t of o)t.getAttribute("listIndent")==a&&(r.writer.setAttribute("listType",e.listType,t),r.writer.setAttribute("listMarkerStyle",e.listMarkerStyle,t))}}function multiLevelListMarkerUpcastConverter(e){return(t,n,{writer:i,consumable:r})=>{const s=n.modelCursor,o=s.parent,a=n.viewItem;if(r.consume(a,{name:!0,classes:"multi-level-list__marker"})&&s.isAtStart&&o.hasAttribute("listType")&&a.childCount>0){const t=e.createRangeIn(a);let n="";for(const e of t.getItems())e.is("$textProxy")&&(n+=e.data.trim(),r.consume(e.textNode));i.setAttribute("listMarker",n.trim(),o)}}}async function checkLicense$9(e){const t=g([76,83,108,71,77,66,100,98,115,101,120,106,86,49,90,114,116,68,48,79,80,67,55,50,73,104,56,113,119,103,107,52,75,105,70,112,110,69,53,84,97,72,74,87,109,85,118,102,51,99,65,121,57,117,88,54,82,81,89,111,122,78]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([76]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([77,76,76])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}function getTranslation$9(e,t){const n=e.t,i=e.t;switch(t){case"Start at":return n("Start at");case"Start index must be greater than 0.":return n("Start index must be greater than 0.");case"Invalid start index value.":return n("Invalid start index value.");case"List properties":return n("List properties");case"Multi-level List":return i("Multi-level List");case"Multi-level list styles toolbar":return i("Multi-level list styles toolbar");default:return t}}class MultiLevelListView extends View{constructor(e,{enabledProperties:t,styleButtonViews:n,styleGridAriaLabel:i}){super(e),this.stylesView=null,this.additionalPropertiesCollapsibleView=null,this.startIndexFieldView=null,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusables=new ViewCollection;const r=["ck","ck-multi-level-list-properties"];this.children=this.createCollection(),this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),t.styles?(this.stylesView=this._createStylesView(n,i),this.children.add(this.stylesView)):r.push("ck-multi-level-list-properties_without-styles"),t.startIndex&&(this._addListPropertyViews(t),r.push("ck-multi-level-list-properties_with-multi-level-properties")),this.setTemplate({tag:"div",attributes:{class:r},children:this.children})}render(){if(super.render(),this.stylesView){this.focusables.add(this.stylesView),this.focusTracker.add(this.stylesView.element),this.startIndexFieldView&&(this.focusables.add(this.children.last.buttonView),this.focusTracker.add(this.children.last.buttonView.element));for(const e of this.stylesView.children)this.stylesView.focusTracker.add(e.element);addKeyboardHandlingForGrid({keystrokeHandler:this.stylesView.keystrokes,focusTracker:this.stylesView.focusTracker,gridItems:this.stylesView.children,numberOfColumns:()=>_0x49a38d.window.getComputedStyle(this.stylesView.element).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}if(this.startIndexFieldView){this.focusables.add(this.startIndexFieldView),this.focusTracker.add(this.startIndexFieldView.element);const e=e=>e.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}this.keystrokes.listenTo(this.element)}focus(){this.focusCycler.focusFirst()}focusLast(){this.focusCycler.focusLast()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createStylesView(e,t){const n=new View(this.locale);return n.children=n.createCollection(),n.children.addMany(e),n.setTemplate({tag:"div",attributes:{"aria-label":t,class:["ck","ck-multi-level-list-styles"]},children:n.children}),n.children.delegate("execute").to(this),n.focus=function(){this.children.first.focus()},n.focusTracker=new FocusTracker,n.keystrokes=new KeystrokeHandler,n.render(),n.keystrokes.listenTo(n.element),n}_addListPropertyViews(e){const t=[];e.startIndex&&(this.startIndexFieldView=this._createStartIndexField(),t.push(this.startIndexFieldView)),e.styles?(this.additionalPropertiesCollapsibleView=new CollapsibleView(this.locale,t),this.additionalPropertiesCollapsibleView.set({label:getTranslation$9(this.locale,"List properties"),isCollapsed:!0}),this.additionalPropertiesCollapsibleView.buttonView.bind("isEnabled").toMany(t,"isEnabled",((...e)=>e.some((e=>e)))),this.additionalPropertiesCollapsibleView.buttonView.on("change:isEnabled",((e,t,n)=>{n||(this.additionalPropertiesCollapsibleView.isCollapsed=!0)})),this.children.add(this.additionalPropertiesCollapsibleView)):this.children.addMany(t)}_createStartIndexField(){const e=new LabeledFieldView(this.locale,createLabeledInputNumber);return e.set({label:getTranslation$9(this.locale,"Start at"),class:"ck-multi-level-list-properties__start-index"}),e.fieldView.set({min:0,step:1,value:1,inputMode:"numeric"}),e.fieldView.on("input",(()=>{const t=e.fieldView.element,n=t.valueAsNumber;Number.isNaN(n)?e.errorText=getTranslation$9(this.locale,"Invalid start index value."):t.checkValidity()?this.fire("listStart",{startIndex:n}):e.errorText=getTranslation$9(this.locale,"Start index must be greater than 0.")})),e}}var multiLevelListIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7.85 6.5a.75.75 0 0 1 0-1.5h9.5a.75.75 0 1 1 0 1.5h-9.5Z"/><path d="M3 8V2.7H.5v1h1V8H3Z"/><path d="M13.42 14.185a.75.75 0 0 0 .53 1.28h3.4a.75.75 0 1 0 0-1.5h-3.4a.75.75 0 0 0-.53.22Z"/><path d="M5.636 8.035V6.8H4.4v1.235h1.236Z"/><path d="M9 17.865v-5.3H6.5v1h1v4.3H9Z"/><path d="M11.636 17.9v-1.235H10.4V17.9h1.236Z"/><path d="M3.2 17.865v-5.3H.7v1h1v4.3h1.5Z"/><path d="M5.836 17.9v-1.235H4.6V17.9h1.236Z"/></svg>';class MultiLevelListUI extends Plugin{static get pluginName(){return"MultiLevelListUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("multiLevelList",getViewCreator({editor:e,parentCommandName:"multiLevelList",buttonLabel:getTranslation$9(e.locale,"Multi-level List"),buttonIcon:multiLevelListIcon,styleGridAriaLabel:getTranslation$9(e.locale,"Multi-level list styles toolbar"),styleDefinitions:[]})),e.ui.componentFactory.add("menuBar:multiLevelList",(()=>{const t=e.commands.get("multiLevelList"),n=new MenuBarMenuListItemButtonView(e.locale);return n.set({label:getTranslation$9(e.locale,"Multi-level List"),icon:multiLevelListIcon}),n.bind("isEnabled").to(t),n.bind("isOn").to(t,"value",(e=>!!e)),n.on("execute",(()=>{e.execute("multiLevelList"),e.editing.view.focus()})),n})),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("multiLevelListLicenseKeyValid"==r||"multiLevelListLicenseKeyInvalid"==r||"multiLevelListLicenseKeyExpired"==r||"multiLevelListLicenseKeyDomainLimit"==r||"multiLevelListLicenseKeyNotAllowed"==r||"multiLevelListLicenseKeyEvaluationLimit"==r||"multiLevelListLicenseKeyTrialLimit"==r||"multiLevelListLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"multiLevelListLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"multiLevelListLicenseKeyExpired"==e&&t._showLicenseError("expired"),"multiLevelListLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"multiLevelListLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","MultiLevelList"),"multiLevelListLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"multiLevelListLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"multiLevelListLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function getViewCreator({editor:e,parentCommandName:t,buttonLabel:n,buttonIcon:i,styleGridAriaLabel:r,styleDefinitions:s}){const o=e.commands.get(t),a=e.config.get("list.properties")||{},l=e.plugins.has("ListProperties"),c=a.startIndex;return l&&c?a=>{const l=createDropdown(a,SplitButtonView),c=l.buttonView;return l.bind("isEnabled").to(o),l.class="ck-list-styles-dropdown",c.on("execute",(()=>{e.execute(t),e.editing.view.focus()})),c.set({label:n,icon:i,tooltip:!0,isToggleable:!0}),c.bind("isOn").to(o,"value",(e=>!!e)),l.once("change:isOpen",(()=>{const t=createListPropertiesView({editor:e,dropdownView:l,styleGridAriaLabel:r,styleDefinitions:s});l.panelView.children.add(t)})),l.on("execute",(()=>{e.editing.view.focus()})),l}:r=>{const s=new ButtonView(r);return s.set({label:n,icon:i,tooltip:!0,isToggleable:!0}),s.bind("isOn").to(o,"value",(e=>!!e)),s.on("execute",(()=>{e.execute(t),e.editing.view.focus()})),s}}function createListPropertiesView({editor:e,dropdownView:t,styleDefinitions:n,styleGridAriaLabel:i}){const r=e.locale,s=e.config.get("list.properties");s.reversed=!1,n.length||(s.styles=!1);const o=new MultiLevelListView(r,{styleGridAriaLabel:i,enabledProperties:s,styleButtonViews:null});if(s.startIndex){const t=e.commands.get("listStart");o.startIndexFieldView.bind("isEnabled").to(t),o.startIndexFieldView.fieldView.bind("value").to(t),o.on("listStart",((t,n)=>e.execute("listStart",n)))}return o.delegate("execute").to(t),o}class MultiLevelList extends Plugin{static get pluginName(){return"MultiLevelList"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[MultiLevelListEditing,MultiLevelListUI]}}class InsertMergeFieldCommand extends _0x338ed0{refresh(){const e=this.editor.model,t=e.schema.checkChild(e.document.selection.focus,"mergeField");this.isEnabled=t}execute(e){if(!e||"string"!=typeof e)return;const t=this.editor.model;t.change((n=>{t.deleteContent(t.document.selection);const i=n.createElement("mergeField",{id:e});for(const[e,r]of t.document.selection.getAttributes())t.schema.checkAttribute(i,e)&&n.setAttribute(e,r,i);t.insertContent(i,t.document.selection,0,{setSelection:"after"})}))}}class InsertMergeFieldBlockCommand extends _0x338ed0{refresh(){const e=this.editor.model,t=e.document.selection;this.isEnabled=isAllowedInParent(t,e)}execute(e,t){if(!e||"string"!=typeof e)return;const n=this.editor.model;n.change((i=>{const r=i.createElement("mergeFieldBlock",{id:e});n.insertObject(r,n.document.selection,null,{setSelection:"on",findOptimalPosition:!1===t?void 0:"auto"})}))}}function isAllowedInParent(e,t){let n=findOptimalInsertionRange(e,t).start.parent;return n.isEmpty&&!t.schema.isLimit(n)&&(n=n.parent),t.schema.checkChild(n,"mergeFieldBlock")}class InsertMergeFieldImageCommand extends _0x338ed0{constructor(e){super(e),this.bind("isEnabled").to(this.editor.commands.get("insertImage"))}execute(e,t){if(!e||"string"!=typeof e)return;const n=this.editor.plugins.get("MergeFieldsEditing"),i=n.getMergeFieldWidth(e),r=n.getMergeFieldHeight(e);this.editor.execute("insertImage",{source:{src:n.wrapInAffixes(e),width:i,height:r},breakBlock:t&&t.breakBlock})}}class PreviewMergeFieldsCommand extends _0x338ed0{constructor(e){super(e);const t=this.editor.plugins.get("MergeFieldsEditing");this.bind("value").to(t,"previewMode"),this.affectsData=!1}refresh(){this.isEnabled=!0}execute(e){this.editor.plugins.get("MergeFieldsEditing").previewMode=e}}var warningIcon='<svg width="12" height="12" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12 6C12 9.31371 9.31371 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C9.31371 0 12 2.68629 12 6ZM5.27988 2.40003H6.71988V6.72003H5.27988V2.40003ZM6.72009 8.16003H5.28009V9.60003H6.72009V8.16003Z" fill="#DB3700"/>\n</svg>\n';const DEFAULT_MERGE_FIELD_BLOCK_HEIGHT=120,DEFAULT_MERGE_FIELD_IMAGE_HEIGHT=400,DEFAULT_MERGE_FIELD_IMAGE_WIDTH=400,ALLOWED_IN_IDS=/^[a-zA-Z0-9_.-]+$/;class MergeFieldsEditing extends Plugin{static get requires(){return["ImageUtils","ImageEditing"]}static get pluginName(){return"MergeFieldsEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.flattenedMergeFieldDefinitions=[],e.config.define("mergeFields.previewModes",["$labels","$defaultValues","$dataSets"]),e.config.define("mergeFields.dataSets",[]),e.config.define("mergeFields.definitions",[]),e.config.define("mergeFields.prefix","{{"),e.config.define("mergeFields.suffix","}}"),e.config.define("mergeFields.previewHtmlValues",!1),e.config.define("mergeFields.sanitizeHtml",(e=>(logWarning("merge-fields-provide-sanitize-function"),{html:e,hasChanged:!1}))),this._mergeFieldPrefix=e.config.get("mergeFields.prefix"),this._mergeFieldSuffix=e.config.get("mergeFields.suffix"),this._shouldPreviewHtmlValues=e.config.get("mergeFields.previewHtmlValues"),this.flattenedMergeFieldDefinitions=this._getFlattenedMergeFieldDefinitions(),this._validateConfig();const t="\\"+this._mergeFieldPrefix.split("").join("\\"),n="\\"+this._mergeFieldSuffix.split("").join("\\");this._mergeFieldRegExp=new RegExp("("+t+"[^"+(t+n)+" ]+"+n+")","g"),this.availablePreviewModes=this._getAvailablePreviewModes();const i=e.config.get("mergeFields.initialPreviewMode")||this.availablePreviewModes[0];this._validatePreviewMode(i),this.set("previewMode",i),this._mergeFieldElements=new Set}init(){const e=this.editor;e.commands.add("insertMergeField",new InsertMergeFieldCommand(e)),e.commands.add("insertMergeFieldBlock",new InsertMergeFieldBlockCommand(e)),e.commands.add("insertMergeFieldImage",new InsertMergeFieldImageCommand(e)),e.commands.add("previewMergeFields",new PreviewMergeFieldsCommand(e)),this._defineSchema(),this._defineConverters(),this._registerConversionPostFixer(),this.listenTo(this.editor.editing.view.document,"imageLoaded",this._setupTooltipsTogglingForImageMergeField),this.on("change:previewMode",((e,t,n)=>{this._validatePreviewMode(n),this.refreshMergeFields()})),this.listenTo(e.model.document,"change:data",(()=>{this._trackAddedMergeFields()})),e.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(e.model,(e=>e.hasClass("ck-merge-field")))),e.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(e.model,(e=>e.hasClass("ck-merge-field-block")))),e.editing.view.domConverter.registerInlineObjectMatcher({name:"span",classes:["ck-merge-field"]})}afterInit(){this._disableCommandOnMergeFields("ckboxImageEdit"),this._disableCommandOnMergeFields("uploadcareImageEdit"),checkLicense$8(this)}isMergeField(e){return"mergeField"===e.name||"mergeFieldBlock"===e.name||!!("imageBlock"===e.name||"imageInline"===e.name&&e.getAttribute("src"))&&!!e.getAttribute("src").match(this._mergeFieldRegExp)}getDefaultValues(){const e={},t=this.getMergeFieldsIds();for(const n of t)e[n]=this.getMergeFieldDefaultValue(n);return e}getDataSetValues(e,t=!1){const n={},i=this.getMergeFieldsIds();for(const r of i){let i=this.getMergeFieldValue(r,e);null===i&&t&&(i=this.getMergeFieldDefaultValue(r)),n[r]=i}return n}getLabel(e){const t=this.getDefinition(e);return t&&t.label?t.label:null}getMergeFieldDefaultValue(e){const t=this.getDefinition(e);if(!t||void 0===t.defaultValue)return null;const n="function"==typeof t.defaultValue?t.defaultValue(this.editor):t.defaultValue;return String(n)}getMergeFieldValue(e,t){const n=this.editor.config.get("mergeFields.dataSets").find((e=>e.id===t));if(!n)throw new CKEditorError("merge-fields-data-set-not-found",null);const i=n.values[e];if(void 0===i)return null;const r="function"==typeof i?i(this.editor):i;return String(r)}getMergeFieldType(e){if("string"!=typeof e){const t=e;return"mergeField"===t.name?"text":"mergeFieldBlock"===t.name?"block":("imageBlock"===t.name||"imageInline"===t.name&&t.getAttribute("src"))&&t.getAttribute("src").match(this._mergeFieldRegExp)?"image":null}const t=this.getDefinition(e);return t&&t.type?t.type:"text"}getMergeFieldHeight(e){const t=this.getDefinition(e);return t&&"block"===t.type?t.height||DEFAULT_MERGE_FIELD_BLOCK_HEIGHT:t&&"image"===t.type?t.height||DEFAULT_MERGE_FIELD_IMAGE_HEIGHT:null}getMergeFieldWidth(e){const t=this.getDefinition(e);return t&&"image"===t.type?t.width||DEFAULT_MERGE_FIELD_IMAGE_WIDTH:null}getDocumentMergeFieldsIds(){const e=new Set;for(const t of this._mergeFieldElements)"$graveyard"!==t.root.rootName&&("image"===this.getMergeFieldType(t)?e.add(this.unwrapAffixes(t.getAttribute("src"))):e.add(t.getAttribute("id")));return Array.from(e)}getMergeFieldsIds(){const e=this.flattenedMergeFieldDefinitions.map((e=>e.id)),t=this.getDocumentMergeFieldsIds();return Array.from(new Set([...e,...t]))}getDefinition(e){return this.flattenedMergeFieldDefinitions.find((t=>t.id===e))||null}refreshMergeFields(){this._mergeFieldElements.forEach((e=>{"$graveyard"!==e.root.rootName&&this.editor.editing.reconvertItem(e)}))}wrapInAffixes(e){return this._mergeFieldPrefix+e+this._mergeFieldSuffix}unwrapAffixes(e){return e.slice(this._mergeFieldPrefix.length,e.length-this._mergeFieldSuffix.length)}_getFlattenedMergeFieldDefinitions(){const e=new Set,t=this.editor;return t.config.get("mergeFields.definitions").reduce(((n,i)=>{if("groupId"in i){if(e.has(i.groupId))throw new CKEditorError("merge-fields-duplicate-group-id",t,{duplicateId:i.groupId});e.add(i.groupId)}return"groupId"in i?function(e,t){for(const n of t.definitions)e=e.concat(n);return e}.bind(t)(n,i):n.concat(i)}),new Array)}_validateConfig(){const e=/^['"`!#%:;=@{}~$()*+/?[\\\]^|]+$/;if(!e.test(this._mergeFieldPrefix)||!e.test(this._mergeFieldSuffix))throw new CKEditorError("merge-fields-invalid-prefix-or-suffix",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix});if(this._mergeFieldPrefix.length>8||this._mergeFieldSuffix.length>8)throw new CKEditorError("merge-fields-prefix-or-suffix-too-long",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix,limit:8});const t=new Set;if(this.flattenedMergeFieldDefinitions.map((e=>{if(!ALLOWED_IN_IDS.test(e.id))throw new CKEditorError("merge-fields-invalid-id",this,{incorrectId:e.id});if(t.has(e.id))throw new CKEditorError("merge-fields-duplicate-merge-field-id",this,{duplicateId:e.id});t.add(e.id)})),this._mergeFieldPrefix===this._mergeFieldSuffix)throw new CKEditorError("merge-fields-prefix-and-suffix-must-differ",this);const n=this.editor.config.get("mergeFields.previewModes"),i=["$labels","$defaultValues","$dataSets"];if(!n.length||!n.every((e=>i.includes(e))))throw new CKEditorError("merge-fields-invalid-preview-modes-configuration",this,{invalidConfig:n});const r=new Set,s=this.editor.config.get("mergeFields.dataSets");for(const e of s){if(r.has(e.id))throw new CKEditorError("merge-fields-duplicate-data-set-id",this,{duplicateId:e.id});r.add(e.id)}}_getAvailablePreviewModes(){const e=this.editor.config.get("mergeFields.previewModes"),t=[];if(e.includes("$labels")&&t.push("$labels"),e.includes("$defaultValues")&&t.push("$defaultValues"),e.includes("$dataSets")){const e=this.editor.config.get("mergeFields.dataSets");t.push(...e.map((e=>e.id)))}return t}_defineSchema(){const e=this.editor.model.schema;e.register("mergeField",{inheritAllFrom:"$inlineObject",allowAttributes:["id"],allowWhere:"$text"}),e.register("mergeFieldBlock",{inheritAllFrom:"$blockObject",allowAttributes:["id"]})}_defineConverters(){const e=this.editor.conversion;e.for("upcast").add((e=>{e.on("text",((e,t,n)=>{const{writer:i,safeInsert:r}=n,{viewItem:s}=t,o=s.data.split(this._mergeFieldRegExp).filter((e=>e));if(1===o.length&&!o[0].match(this._mergeFieldRegExp))return;if(!t.modelRange)return;const a=i.createElement("$cursor");i.insert(a,t.modelCursor);const l=[];for(const e of t.modelRange.getItems()){if(!e.is("$textProxy"))continue;const t=e.textNode.data.matchAll(this._mergeFieldRegExp),n=e.parent,r=e.textNode.startOffset;for(const e of[...t].reverse()){const t=e[0],s=i.createPositionAt(n,e.index+r),o=s.getShiftedBy(t.length),a=i.createRange(s,o),c=this.unwrapAffixes(t),d=this.getMergeFieldType(c),u="block"==d?"mergeFieldBlock":"mergeField",h=i.createElement(u,{id:c});i.remove(a),i.insert(h,s),"block"==d&&l.push(h)}}l.reverse();for(const e of l){const t=i.createPositionBefore(e);i.remove(e),r(e,t)}t.modelCursor=i.createPositionBefore(a),t.modelRange=i.createRange(t.modelRange.start,t.modelCursor),i.remove(a)}),{priority:priorities.get("lowest")-1})})),e.for("upcast").elementToElement({view:{name:"span",attributes:"data-ck-merge-field"},model:(e,{writer:t})=>t.createElement("mergeField",{id:e.getAttribute("data-ck-merge-field")})}),e.for("upcast").elementToElement({view:{name:"div",attributes:"data-ck-merge-field"},model:(e,{writer:t})=>t.createElement("mergeFieldBlock",{id:e.getAttribute("data-ck-merge-field")})}),e.for("upcast").add(this._upcastSrcAttributeFromClipboard()),e.for("editingDowncast").elementToElement({model:"mergeField",view:(e,{writer:t})=>this._createMergeFieldWidget(e,t,"text")}),e.for("dataDowncast").elementToElement({model:"mergeField",view:(e,{writer:t,options:n})=>this._createTextualMergeField(e,t,n)}),e.for("editingDowncast").elementToElement({model:"mergeFieldBlock",view:(e,{writer:t})=>this._createMergeFieldWidget(e,t,"block")}),e.for("dataDowncast").elementToElement({model:"mergeFieldBlock",view:(e,{writer:t,options:n})=>this._createTextualMergeField(e,t,n)}),e.for("editingDowncast").add(this._downcastSrcAttributeToEditing("imageBlock")).add(this._downcastSrcAttributeToEditing("imageInline")),e.for("dataDowncast").add(this._downcastSrcAttributeToData("imageBlock")).add(this._downcastSrcAttributeToData("imageInline"))}_upcastSrcAttributeFromClipboard(){return e=>{e.on("element:img",((e,t,n)=>{n.consumable.test(t.viewItem,{attributes:"data-ck-merge-field"})&&(n.writer.setAttribute("src",this.wrapInAffixes(t.viewItem.getAttribute("data-ck-merge-field")),t.modelCursor.nodeBefore),n.consumable.consume(t.viewItem,{attributes:"data-ck-merge-field"}))}),{priority:"low"})}}_downcastSrcAttributeToData(e){const t=this.editor.plugins.get("ImageUtils"),n=(e,n,i)=>{if(!1!==i.consumable.test(n.item,e.name))return;if(!String(n.attributeNewValue).match(this._mergeFieldRegExp))return;const r=i.writer,s=i.mapper.toViewElement(n.item),o=t.findViewImgElement(s),a=String(n.attributeNewValue),l=this.unwrapAffixes(a),c=i.options.mergeFieldsData;if(i.options.isClipboardPipeline&&"$labels"!==this.previewMode){let e;return e="$defaultValues"===this.previewMode?this.getMergeFieldDefaultValue(l)||this.getLabel(l)||this.wrapInAffixes(l):this.getMergeFieldValue(l,this.previewMode)||this.getMergeFieldDefaultValue(l)||this.getLabel(l)||this.wrapInAffixes(l),r.setAttribute("data-ck-merge-field",l,o),void r.setAttribute(n.attributeKey,e,o)}const d=c&&c[l]?c[l]:a;r.setAttribute(n.attributeKey,d,o)};return t=>{t.on("attribute:src:"+e,n,{priority:"low"})}}_downcastSrcAttributeToEditing(e){const t=this.editor.plugins.get("ImageUtils"),n=(n,i,r)=>{if(!1!==r.consumable.test(i.item,n.name))return;if(!String(i.attributeNewValue).match(this._mergeFieldRegExp))return;const s=r.writer,o=r.mapper.toViewElement(i.item),a=t.findViewImgElement(o),l=String(i.attributeNewValue),c=this.unwrapAffixes(l),d=this.getMergeFieldDefaultValue(c),u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC";let h,m="",g="";if("$labels"===this.previewMode)h=u;else if("$defaultValues"===this.previewMode)d?(h=d,g=" ck-merge-field-image_with-value"):(h=u,m="WARNING_MISSING_DEFAULT_VALUE",g=" ck-merge-field-image_with-warning ck-merge-field-image_with-warning_no-default");else{const e=this.getMergeFieldValue(c,this.previewMode);e?(h=e,g=" ck-merge-field-image_with-value"):d?(h=d,g=" ck-merge-field-image_with-warning ck-merge-field-image_with-warning_default-value-used",m="WARNING_MISSING_DATA_USED_DEFAULT_VALUE"):(h=u,g=" ck-merge-field-image_with-warning ck-merge-field-image_with-warning_missing-data",m="WARNING_MISSING_DATA")}if(s.addClass("ck-merge-field-image"+g,o),s.setAttribute(i.attributeKey,h,a),"$labels"===this.previewMode){const t="imageInline"===e?"span":"div",n=this._mergeFieldPrefix,i=this._mergeFieldSuffix,r=s.createContainerElement(t,{class:"ck-merge-field","data-cke-tooltip-instant":"true"},[s.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=n,t})),s.createContainerElement("span",{class:"ck-merge-field__content"},s.createText(this.getLabel(c)||c)),s.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=i,t}))]);s.insert(s.createPositionAt(o,"end"),r),s.setAttribute("data-cke-tooltip-text",this.getLabel(c)||c,r)}else if(m&&["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(m)){const t="imageInline"===e?"span":"div",n=g.replace(/ck-merge-field-image/g,"ck-merge-field"),i=s.createContainerElement(t,{class:"ck-merge-field"+n,"data-cke-tooltip-instant":"true"},[s.createContainerElement("span",{class:"ck-merge-field__content"},s.createText(this.getLabel(c)||c))]),r=s.createUIElement("span",{class:"ck-merge-field__icon"},(function(e){const t=this.toDomElement(e),n=new IconView;return n.set({content:warningIcon}),n.render(),t.appendChild(n.element),t}));s.insert(s.createPositionAt(i,"end"),r),s.insert(s.createPositionAt(o,"end"),i),s.setCustomProperty("mergeFieldStatus",m,i),s.setAttribute("data-cke-tooltip-text",this.getLabel(c)||c,i)}s.setAttribute("data-merge-field-name",c,o),m&&s.setCustomProperty("mergeFieldStatus",m,o)};return t=>{t.on("attribute:src:"+e,n,{priority:"low"})}}_setupTooltipsTogglingForImageMergeField(e,t){if(!t.target)return null;const n=t.target.parentElement;return n&&n.classList.contains("ck-merge-field-image")?new _0x3f4b48(n,(e=>{const t=e.target,n=t.querySelector(".ck-merge-field"),i=t.querySelector(".ck-merge-field__content");n&&i&&(i.scrollWidth>i.getBoundingClientRect().width?n.removeAttribute("data-cke-tooltip-disabled"):n.setAttribute("data-cke-tooltip-disabled","true"))})):null}_createMergeFieldWidget(e,t,n){const{label:i,classes:r,status:s,height:o}=this._prepareViewElementData(e),a=this._mergeFieldPrefix,l=this._mergeFieldSuffix,c=this.editor.config.get("mergeFields.sanitizeHtml"),d="text"===n?"span":"div";let u;if("$labels"===this.previewMode)u=t.createContainerElement(d,{class:r},[t.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=a,t})),t.createContainerElement("span",{class:"ck-merge-field__content"},t.createText(String(i))),t.createUIElement("span",{class:"ck-merge-field__affix"},(function(e){const t=this.toDomElement(e);return t.innerHTML=l,t}))]);else if(s){const e=this._shouldPreviewHtmlValues?t.createRawElement("span",{class:"ck-merge-field__content"},(function(e,t){t.setContentOf(e,c(i).html)})):t.createContainerElement("span",{class:"ck-merge-field__content"},t.createText(i));if(u=t.createContainerElement(d,{class:r},[e]),"text"===n||["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(s)){const e=t.createUIElement("span",{class:"ck-merge-field__icon"},(function(e){const t=this.toDomElement(e),n=new IconView;return n.set({content:warningIcon}),n.render(),t.appendChild(n.element),t}));t.insert(t.createPositionAt(u,"end"),e)}t.setCustomProperty("mergeFieldStatus",s,u)}else{const e=this._shouldPreviewHtmlValues?t.createRawElement(d,{},(function(e,t){t.setContentOf(e,c(i).html)})):t.createText(i);u=t.createContainerElement(d,{class:r},e)}if("block"===n){const n=t.createContainerElement("div",{class:"ck-merge-field-block"},[u]);if(("$labels"===this.previewMode||s&&["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(s))&&t.setAttribute("style","height: "+o+"px",n),u.hasClass("ck-merge-field_with-value"))t.addClass("ck-merge-field-block_with-value",n);else if(u.hasClass("ck-merge-field_with-warning")){for(const e of u.getClassNames())if("ck-merge-field"!==e){const i=e.replace("ck-merge-field","ck-merge-field-block");t.addClass(i,n)}t.setCustomProperty("mergeFieldStatus",s,n)}return t.setCustomProperty("mergeFieldBlock",!0,n),t.setAttribute("data-merge-field-name",e.getAttribute("id"),n),toWidget(n,t,{hasSelectionHandle:!0})}return t.setCustomProperty("mergeField",!0,u),t.setAttribute("data-merge-field-name",e.getAttribute("id"),u),toWidget(u,t)}_prepareViewElementData(e){const t=e.getAttribute("id"),n=this.getDefinition(t);if(!n)return"$labels"===this.previewMode?{label:t,classes:"ck-merge-field"}:{label:t,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-definition",status:"WARNING_MISSING_DATA"};const i=this.getLabel(t)||t,r=this.getMergeFieldDefaultValue(t),s=this.getMergeFieldHeight(t);if("$labels"===this.previewMode)return{label:i,height:s,classes:"ck-merge-field"};if("$defaultValues"===this.previewMode)return r?{label:r,height:s,classes:"ck-merge-field ck-merge-field_with-value"}:{label:i,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_no-default",status:"WARNING_MISSING_DEFAULT_VALUE"};const o=this.getMergeFieldValue(n.id,this.previewMode);return o?{label:o,height:s,classes:"ck-merge-field ck-merge-field_with-value"}:r?{label:r,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_default-value-used",status:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"}:{label:i,height:s,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-data",status:"WARNING_MISSING_DATA"}}_createTextualMergeField(e,t,n){const i=e.getAttribute("id");let r;if(n.isClipboardPipeline&&"$labels"!==this.previewMode)return this._downcastForClipboard(i,t);const s=n.mergeFieldsData,o=s&&s[i]?s[i]:this.wrapInAffixes(i);if(s)r=t.createRawElement("span",{},(function(e,t){t.setContentOf(e,String(o))}));else{r=t.createContainerElement("span");const e=t.createText(o);t.insert(t.createPositionAt(r,"end"),e)}return t.setCustomProperty("dataPipeline:transparentRendering",!0,r),r}_downcastForClipboard(e,t){const n="block"===this.getMergeFieldType(e)?"div":"span";let i,r;i="$defaultValues"===this.previewMode?this.getMergeFieldDefaultValue(e)||this.getLabel(e)||this.wrapInAffixes(e):this.getMergeFieldValue(e,this.previewMode)||this.getMergeFieldDefaultValue(e)||this.getLabel(e)||this.wrapInAffixes(e);const s=this.editor.config.get("mergeFields.sanitizeHtml");return r=this._shouldPreviewHtmlValues?t.createRawElement(n,{"data-ck-merge-field":e},(function(e,t){t.setContentOf(e,s(i).html)})):t.createContainerElement(n,{"data-ck-merge-field":e},t.createText(i)),r}_validatePreviewMode(e){if(!this.availablePreviewModes.includes(e))throw new CKEditorError("merge-fields-invalid-preview-mode-set",this,{availablePreviewModes:this.availablePreviewModes,previewMode:e})}_trackAddedMergeFields(){for(const e of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if("insert"!==e.type||"$text"===e.name)continue;if("mergeField"===e.name||"mergeFieldBlock"===e.name){this._mergeFieldElements.add(e.position.nodeAfter);continue}if("imageInline"===e.name||"imageBlock"===e.name&&e.attributes.get("src")&&String(e.attributes.get("src")).match(this._mergeFieldRegExp)){this._mergeFieldElements.add(e.position.nodeAfter);continue}const t=this.editor.model.createRangeIn(e.position.nodeAfter);for(const e of t.getItems())e.is("element")&&this.isMergeField(e)&&this._mergeFieldElements.add(e)}}_registerConversionPostFixer(){const e=this.editor;e.model.document.registerPostFixer((t=>{if(!t.batch.isLocal)return!1;const n=[],i=new Set,r=this._mergeFieldRegExp;let s=!1;for(const t of e.model.document.differ.getChanges())if("insert"===t.type||"remove"===t.type){let e="$text"==t.name?t.position.parent:t.position.nodeAfter;if(!e)continue;e.is("$text")&&(e=e.parent),o(e)}for(const i of n.reverse()){const{match:n,item:r}=i,o=t.createPositionAt(r,n.index),l=o.getShiftedBy(n[0].length),c=t.createRange(o,l),d=n[0],u=this.unwrapAffixes(d),h=a(c),m=this.getMergeFieldType(u);if(ALLOWED_IN_IDS.test(u)){if(h.set("id",u),"block"===m){const n=t.createElement("mergeFieldBlock",{id:u});t.remove(c),e.model.insertObject(n,null,null,{setSelection:"on",findOptimalPosition:void 0})}else if("image"===m){const n=t.createElement("imageBlock",{src:this.wrapInAffixes(u)});t.remove(c),e.model.insertObject(n,null,null,{setSelection:"on",findOptimalPosition:void 0})}else{const n=t.createElement("mergeField",h);e.model.schema.checkChild(c.start,"mergeField")?e.model.insertObject(n,c):t.remove(c)}s=!0}}return s;function o(e){let t="",s=0;if(!i.has(e))for(const a of e.getChildren()){const l=a.nextSibling;if(a.is("$text")&&(""===t&&a.startOffset&&(s=a.startOffset),t+=a.data),!l||l.is("element")){for(const i of t.matchAll(r))i.index=i.index+s,n.push({match:i,item:e});i.add(e),t=""}a.is("element")&&o(a)}}function a(e){const t=e.getItems(),n=t.next().value,i=new Map(n.getAttributes());for(const e of t)for(const[t,n]of i)e.getAttribute(t)!==n&&i.delete(t);return i}}))}_disableCommandOnMergeFields(e){const t=this.editor,n=t.commands.get(e);n&&n.on("set:isEnabled",((e,n,i)=>{if(1==i){const n=t.model.document.selection.getSelectedElement();n&&this.isMergeField(n)&&(e.return=!1,e.stop())}}))}}async function checkLicense$8(e){const t=g([51,52,121,67,119,105,80,68,72,87,100,110,99,112,83,49,82,85,55,115,118,116,73,65,113,53,120,79,78,98,57,104,48,86,70,122,117,103,69,81,109,108,50,88,84,76,56,77,74,114,101,102,89,90,97,107,71,111,75,66,106,54]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([121]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([77,70])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class MergeFieldsListView extends ListView{filter(e){return filterGroupAndItemNames(e,this.items)}}class MergeFieldsPanelView extends View{constructor(e){super(e),this.set("text","");const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-merge-fields-form"]},children:[{tag:"div",attributes:{class:["ck","ck-merge-fields-form__status"]},children:[{text:t.to("text")}]}]})}}function getTranslation$8(e,t){const n=e.t;switch(t){case"Search merge field":return n("Search merge field");case"No merge fields found":return n("No merge fields found");case"No merge fields available":return n("No merge fields available");case"Insert merge field":return n("Insert merge field");case"Merge field":return n("Merge field");case"Merge fields preview":return n("Merge fields preview");case"Labels":return n("Labels");case"Default values":return n("Default values");case"WARNING_MISSING_DATA_USED_DEFAULT_VALUE":return n({string:"Default value is used.",id:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"});case"WARNING_MISSING_DEFAULT_VALUE":return n({string:"Default value not available.",id:"WARNING_MISSING_DEFAULT_VALUE"});case"WARNING_MISSING_DATA":return n({string:"Value not available.",id:"WARNING_MISSING_DATA"});default:return t}}var insertMergeFieldIcon='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n<circle cx="10.0001" cy="9.79993" r="1.5"/>\n<path d="M13.2496 2.75005C13.2497 2.00005 13.2498 2.00005 13.2498 2.00005L13.2511 2.00005L13.2534 2.00006L13.2606 2.00009L13.2848 2.0003C13.3052 2.00053 13.3337 2.00098 13.3688 2.00185C13.4386 2.0036 13.536 2.00707 13.6475 2.01402C13.8589 2.02722 14.1651 2.05536 14.4328 2.12276C14.8296 2.22267 15.1705 2.40399 15.4402 2.67392C15.7077 2.94161 15.8688 3.26001 15.9644 3.5803C16.1459 4.18776 16.1145 4.89393 16.0724 5.49256C16.0626 5.6324 16.052 5.76849 16.0416 5.90131C16.0036 6.38849 15.969 6.83163 15.9895 7.25369C16.0151 7.78147 16.1252 8.13279 16.3222 8.3656C16.5447 8.6286 16.8158 8.79405 17.0411 8.89436C17.1523 8.94386 17.2471 8.97509 17.3103 8.99319C17.3417 9.00219 17.3647 9.00776 17.3773 9.01062L17.3868 9.01269L17.9996 9.12173V9.75005H15.5976C15.4541 9.63123 15.3117 9.49364 15.1771 9.33451C14.669 8.73405 14.5235 7.99036 14.4913 7.32643C14.4657 6.79933 14.5105 6.23163 14.5497 5.73429C14.5592 5.61404 14.5683 5.49785 14.5761 5.3874C14.6198 4.76596 14.62 4.32043 14.5272 4.00956C14.4857 3.87069 14.4332 3.78828 14.3791 3.73414C14.3272 3.68223 14.2386 3.6207 14.0665 3.57736C13.9372 3.5448 13.7433 3.52293 13.554 3.51111C13.4651 3.50556 13.3869 3.50277 13.3313 3.50139C13.3037 3.5007 13.282 3.50036 13.2678 3.5002L13.2524 3.50007L13.2493 3.50005L12.4996 3.5L12.4997 2L13.2498 2.00005L13.2496 2.75005Z"/>\n<path d="M13.2496 16.7501C13.2497 17.5001 13.2498 17.5001 13.2498 17.5001L13.2511 17.5001L13.2534 17.5001L13.2606 17.5L13.2848 17.4998C13.3052 17.4996 13.3337 17.4991 13.3688 17.4983C13.4386 17.4965 13.536 17.493 13.6475 17.4861C13.8589 17.4729 14.1651 17.4448 14.4328 17.3774C14.8296 17.2774 15.1705 17.0961 15.4402 16.8262C15.7077 16.5585 15.8688 16.2401 15.9644 15.9198C16.1459 15.3124 16.1145 14.6062 16.0724 14.0076C16.0626 13.8677 16.052 13.7316 16.0416 13.5988C16.0036 13.1116 15.969 12.6685 15.9895 12.2464C16.0151 11.7186 16.1252 11.3673 16.3222 11.1345C16.5447 10.8715 16.8158 10.7061 17.0411 10.6058C17.1523 10.5563 17.2471 10.525 17.3103 10.5069C17.3417 10.4979 17.3647 10.4924 17.3773 10.4895L17.3868 10.4874L17.9996 10.3784V9.75005H15.5976C15.4541 9.86887 15.3117 10.0065 15.1771 10.1656C14.669 10.7661 14.5235 11.5098 14.4913 12.1737C14.4657 12.7008 14.5105 13.2685 14.5497 13.7658C14.5592 13.8861 14.5683 14.0023 14.5761 14.1127C14.6198 14.7341 14.62 15.1797 14.5272 15.4906C14.4857 15.6294 14.4332 15.7118 14.3791 15.766C14.3272 15.8179 14.2386 15.8794 14.0665 15.9228C13.9372 15.9553 13.7433 15.9772 13.554 15.989C13.4651 15.9945 13.3869 15.9973 13.3313 15.9987C13.3037 15.9994 13.282 15.9998 13.2678 15.9999L13.2524 16L13.2493 16.0001L12.4996 16.0001L12.4997 17.5001L13.2498 17.5001L13.2496 16.7501Z"/>\n<path d="M6.75 2.75005C6.74995 2.00005 6.74982 2.00005 6.74982 2.00005L6.74853 2.00005L6.74622 2.00006L6.73903 2.00009L6.71478 2.0003C6.69446 2.00053 6.66594 2.00098 6.63087 2.00185C6.56099 2.0036 6.46364 2.00707 6.35217 2.01402C6.14071 2.02722 5.83458 2.05536 5.56688 2.12276C5.17006 2.22267 4.82913 2.40399 4.55943 2.67392C4.29196 2.94161 4.13085 3.26001 4.03519 3.5803C3.85377 4.18776 3.88516 4.89393 3.92723 5.49256C3.93706 5.6324 3.94768 5.76849 3.95804 5.90131C3.99605 6.38849 4.03062 6.83163 4.01013 7.25369C3.98451 7.78147 3.87445 8.13279 3.67746 8.3656C3.45492 8.6286 3.18386 8.79405 2.95851 8.89436C2.84732 8.94386 2.75258 8.97509 2.68931 8.99319C2.65789 9.00219 2.63488 9.00776 2.62229 9.01062L2.61279 9.01269L2 9.12173V9.75005H4.40205C4.54555 9.63123 4.6879 9.49364 4.82254 9.33451C5.33063 8.73405 5.47613 7.99036 5.50837 7.32643C5.53396 6.79933 5.48918 6.23163 5.44995 5.73429C5.44047 5.61404 5.4313 5.49785 5.42354 5.3874C5.37987 4.76596 5.37961 4.32043 5.47246 4.00956C5.51394 3.87069 5.56644 3.78828 5.62053 3.73414C5.6724 3.68223 5.76099 3.6207 5.93312 3.57736C6.06245 3.5448 6.25632 3.52293 6.4456 3.51111C6.5345 3.50556 6.61271 3.50277 6.6683 3.50139C6.69595 3.5007 6.71765 3.50036 6.73185 3.5002L6.74724 3.50007L6.75029 3.50005L7.50005 3.5L7.49995 2L6.74982 2.00005L6.75 2.75005Z"/>\n<path d="M6.75 16.7501C6.74995 17.5001 6.74982 17.5001 6.74982 17.5001L6.74853 17.5001L6.74622 17.5001L6.73903 17.5L6.71478 17.4998C6.69446 17.4996 6.66594 17.4991 6.63087 17.4983C6.56099 17.4965 6.46364 17.493 6.35217 17.4861C6.14071 17.4729 5.83458 17.4448 5.56688 17.3774C5.17006 17.2774 4.82913 17.0961 4.55943 16.8262C4.29196 16.5585 4.13085 16.2401 4.03519 15.9198C3.85377 15.3124 3.88516 14.6062 3.92723 14.0076C3.93706 13.8677 3.94768 13.7316 3.95804 13.5988C3.99605 13.1116 4.03062 12.6685 4.01013 12.2464C3.98451 11.7186 3.87445 11.3673 3.67746 11.1345C3.45492 10.8715 3.18386 10.7061 2.95851 10.6058C2.84732 10.5563 2.75258 10.525 2.68931 10.5069C2.65789 10.4979 2.63488 10.4924 2.62229 10.4895L2.61279 10.4874L2 10.3784V9.75005H4.40205C4.54555 9.86887 4.6879 10.0065 4.82254 10.1656C5.33063 10.7661 5.47613 11.5098 5.50837 12.1737C5.53396 12.7008 5.48918 13.2685 5.44995 13.7658C5.44047 13.8861 5.4313 14.0023 5.42354 14.1127C5.37987 14.7341 5.37961 15.1797 5.47246 15.4906C5.51394 15.6294 5.56644 15.7118 5.62053 15.766C5.6724 15.8179 5.76099 15.8794 5.93312 15.9228C6.06245 15.9553 6.25632 15.9772 6.4456 15.989C6.5345 15.9945 6.61271 15.9973 6.6683 15.9987C6.69595 15.9994 6.71765 15.9998 6.73185 15.9999L6.74724 16L6.75029 16.0001L7.50005 16.0001L7.49995 17.5001L6.74982 17.5001L6.75 16.7501Z"/>\n</svg>\n',previewMergeFieldsIcon='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n<circle cx="9.00037" cy="9.79993" r="1.5"/>\n<path d="M5.75024 2.75005C5.75019 2.00005 5.75006 2.00005 5.75006 2.00005L5.74877 2.00005L5.74647 2.00006L5.73927 2.00009L5.71503 2.0003C5.6947 2.00053 5.66619 2.00098 5.63111 2.00185C5.56123 2.0036 5.46388 2.00707 5.35241 2.01402C5.14095 2.02722 4.83482 2.05536 4.56712 2.12276C4.1703 2.22267 3.82938 2.40399 3.55967 2.67392C3.29221 2.94161 3.1311 3.26001 3.03544 3.5803C2.85401 4.18776 2.8854 4.89393 2.92747 5.49256C2.9373 5.6324 2.94792 5.76849 2.95828 5.90131C2.99629 6.38849 3.03087 6.83163 3.01038 7.25369C2.98475 7.78147 2.87469 8.13279 2.6777 8.3656C2.45517 8.6286 2.1841 8.79405 1.95875 8.89436C1.84756 8.94386 1.75282 8.97509 1.68956 8.99319C1.65813 9.00219 1.63513 9.00776 1.62253 9.01062L1.61304 9.01269L1.00024 9.12173V9.75005H3.4023C3.54579 9.63123 3.68814 9.49364 3.82278 9.33451C4.33087 8.73405 4.47638 7.99036 4.50861 7.32643C4.5342 6.79933 4.48942 6.23163 4.4502 5.73429C4.44071 5.61404 4.43155 5.49785 4.42378 5.3874C4.38011 4.76596 4.37986 4.32043 4.4727 4.00956C4.51418 3.87069 4.56668 3.78828 4.62078 3.73414C4.67264 3.68223 4.76124 3.6207 4.93336 3.57736C5.06269 3.5448 5.25656 3.52293 5.44585 3.51111C5.53475 3.50556 5.61296 3.50277 5.66854 3.50139C5.6962 3.5007 5.71789 3.50036 5.73209 3.5002L5.74748 3.50007L5.75054 3.50005L6.5003 3.5L6.50019 2L5.75006 2.00005L5.75024 2.75005Z"/>\n<path d="M5.75024 16.7501C5.75019 17.5001 5.75006 17.5001 5.75006 17.5001L5.74877 17.5001L5.74647 17.5001L5.73927 17.5L5.71503 17.4998C5.6947 17.4996 5.66619 17.4991 5.63111 17.4983C5.56123 17.4965 5.46388 17.493 5.35241 17.4861C5.14095 17.4729 4.83482 17.4448 4.56712 17.3774C4.1703 17.2774 3.82938 17.0961 3.55967 16.8262C3.29221 16.5585 3.1311 16.2401 3.03544 15.9198C2.85401 15.3124 2.8854 14.6062 2.92747 14.0076C2.9373 13.8677 2.94792 13.7316 2.95828 13.5988C2.99629 13.1116 3.03087 12.6685 3.01038 12.2464C2.98475 11.7186 2.87469 11.3673 2.6777 11.1345C2.45517 10.8715 2.1841 10.7061 1.95875 10.6058C1.84756 10.5563 1.75282 10.525 1.68956 10.5069C1.65813 10.4979 1.63513 10.4924 1.62253 10.4895L1.61304 10.4874L1.00024 10.3784V9.75005H3.4023C3.54579 9.86887 3.68814 10.0065 3.82278 10.1656C4.33087 10.7661 4.47638 11.5098 4.50861 12.1737C4.5342 12.7008 4.48942 13.2685 4.4502 13.7658C4.44071 13.8861 4.43155 14.0023 4.42378 14.1127C4.38011 14.7341 4.37986 15.1797 4.4727 15.4906C4.51418 15.6294 4.56668 15.7118 4.62078 15.766C4.67264 15.8179 4.76124 15.8794 4.93336 15.9228C5.06269 15.9553 5.25656 15.9772 5.44585 15.989C5.53475 15.9945 5.61296 15.9973 5.66854 15.9987C5.6962 15.9994 5.71789 15.9998 5.73209 15.9999L5.74748 16L5.75054 16.0001L6.5003 16.0001L6.50019 17.5001L5.75006 17.5001L5.75024 16.7501Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12.2514 2.00005L12.2501 2.00005L11.5 2L11.4999 3.5L12.2496 3.50005L12.2527 3.50007L12.2681 3.5002C12.2823 3.50036 12.304 3.5007 12.3316 3.50139C12.3872 3.50277 12.4654 3.50556 12.5543 3.51111C12.7436 3.52293 12.9375 3.5448 13.0668 3.57736C13.2389 3.6207 13.3275 3.68223 13.3794 3.73414C13.4335 3.78828 13.486 3.87069 13.5275 4.00956C13.6203 4.32043 13.6201 4.76596 13.5764 5.3874C13.5686 5.49785 13.5595 5.61404 13.55 5.73429C13.5108 6.23163 13.466 6.79933 13.4916 7.32643C13.5238 7.99036 13.6693 8.73405 14.1774 9.33451C14.312 9.49364 14.4544 9.63123 14.5979 9.75005C14.4544 9.86887 14.312 10.0065 14.1774 10.1656C13.7121 10.7154 13.5509 11.3854 13.5023 12.0042C13.6011 12.0012 13.7003 11.9997 13.7999 11.9997C14.208 11.9997 14.6093 12.0247 15.0018 12.0729C15.0416 11.6402 15.1479 11.3408 15.3225 11.1345C15.545 10.8715 15.8161 10.7061 16.0414 10.6058C16.1526 10.5563 16.2474 10.525 16.3106 10.5069C16.342 10.4979 16.365 10.4924 16.3776 10.4895L16.3871 10.4874L16.9999 10.3784V9.75005V9.12173L16.3871 9.01269L16.3776 9.01062C16.365 9.00776 16.342 9.00219 16.3106 8.99319C16.2474 8.97509 16.1526 8.94386 16.0414 8.89436C15.8161 8.79405 15.545 8.6286 15.3225 8.3656C15.1255 8.13279 15.0154 7.78147 14.9898 7.25369C14.9693 6.83163 15.0039 6.38849 15.0419 5.90131C15.0523 5.76849 15.0629 5.6324 15.0727 5.49256C15.1148 4.89393 15.1462 4.18776 14.9647 3.5803C14.8691 3.26001 14.708 2.94161 14.4405 2.67392C14.1708 2.40399 13.8299 2.22267 13.433 2.12276C13.1654 2.05536 12.8592 2.02722 12.6478 2.01402C12.5363 2.00707 12.4389 2.0036 12.3691 2.00185C12.334 2.00098 12.3055 2.00053 12.2851 2.0003L12.2609 2.00009L12.2537 2.00006L12.2514 2.00005Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M9.00335 17.2062L9.00308 17.2065C8.7234 17.5118 8.24919 17.5327 7.94372 17.2532C7.63816 16.9735 7.61716 16.4991 7.89681 16.1935L8.45008 16.6999C7.89681 16.1935 7.89697 16.1934 7.89713 16.1932L7.89751 16.1928L7.89844 16.1918L7.90098 16.189L7.90879 16.1806L7.93517 16.1526C7.95746 16.1292 7.98914 16.0963 8.02971 16.0555C8.11079 15.9738 8.22768 15.8597 8.37644 15.724C8.6732 15.4532 9.10079 15.0927 9.62744 14.7314C10.6647 14.0198 12.1659 13.2499 13.8501 13.2499C15.5343 13.2499 17.0355 14.0198 18.0727 14.7314C18.5994 15.0927 19.027 15.4532 19.3237 15.724C19.4725 15.8597 19.5894 15.9738 19.6705 16.0555C19.711 16.0963 19.7427 16.1292 19.765 16.1526L19.7914 16.1806L19.7992 16.189L19.8017 16.1918L19.8027 16.1928L19.803 16.1932C19.8032 16.1934 19.8034 16.1935 19.2501 16.6999L19.8034 16.1935C20.083 16.4991 20.062 16.9735 19.7565 17.2532C19.4511 17.5326 18.9772 17.5118 18.6975 17.207L18.6971 17.2065L18.6968 17.2062L18.6945 17.2037L18.6783 17.1865C18.6629 17.1704 18.6386 17.1452 18.6059 17.1123C18.5404 17.0463 18.4414 16.9494 18.3127 16.8321C18.0546 16.5966 17.6814 16.282 17.2242 15.9683C16.9805 15.8012 16.7185 15.6381 16.4421 15.4883C16.7016 15.9322 16.8502 16.4487 16.8502 16.9999C16.8502 18.6567 15.5071 19.9999 13.8502 19.9999C12.1934 19.9999 10.8502 18.6567 10.8502 16.9999C10.8502 16.4486 10.9989 15.932 11.2584 15.4881C10.9819 15.6379 10.7198 15.8011 10.476 15.9683C10.0188 16.282 9.64555 16.5966 9.38746 16.8321C9.25879 16.9494 9.15975 17.0463 9.09425 17.1123C9.06153 17.1452 9.03726 17.1704 9.02192 17.1865L9.00572 17.2037L9.00335 17.2062Z"/>\n<circle cx="14.8253" cy="16.1749" r="1.125" fill="white"/>\n</svg>\n';class MergeFieldsUI extends Plugin{static get requires(){return["Mention",MergeFieldsEditing,ContextualBalloon,Widget]}static get pluginName(){return"MergeFieldsUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._balloonPanelView=null,this._removeDefaultValuesPreviewIfUnnecessary(),this._removeMenuBarButtonIfUnnecessary(),this._setupMentionConfiguration()}init(){const e=this.editor;e.ui.componentFactory.add("insertMergeField",(t=>{const n=createInsertMergeFieldDropdown(t);return n.bind("isEnabled").toMany([e.commands.get("insertMergeField"),e.commands.get("insertMergeFieldBlock"),e.commands.get("insertMergeFieldImage")],"isEnabled",((...e)=>e.some((e=>e)))),n.once("change:isOpen",(()=>{const i={insertInline:e.commands.get("insertMergeField"),insertBlock:e.commands.get("insertMergeFieldBlock"),insertImage:e.commands.get("insertMergeFieldImage")},r=createMergeFieldsListView(t,e.config.get("mergeFields.definitions"),i);r.delegate("execute").to(n),n.on("execute",((t,n)=>{const i=e.plugins.get("MergeFieldsEditing").getMergeFieldType(n);"image"===i?e.execute("insertMergeFieldImage",n):"block"===i?e.execute("insertMergeFieldBlock",n):e.execute("insertMergeField",n),e.editing.view.focus()}));const s=createMergeFieldsSearchTextView(t,r);n.panelView.children.add(s),n.on("change:isOpen",((e,t,n)=>{n&&s.reset()}))})),n})),e.ui.componentFactory.add("menuBar:insertMergeField",(t=>{const n=new MenuBarMenuView(t),i={insertInline:e.commands.get("insertMergeField"),insertBlock:e.commands.get("insertMergeFieldBlock"),insertImage:e.commands.get("insertMergeFieldImage")};n.buttonView.set({label:getTranslation$8(t,"Merge field"),icon:insertMergeFieldIcon}),n.bind("isEnabled").toMany([...Object.values(i)],"isEnabled",((...e)=>e.some((e=>e))));const r=[],s=new MenuBarMenuListView(t);for(const o of e.config.get("mergeFields.definitions"))if("groupId"in o){const e=new MenuBarMenuListItemView(t,n),r=createMenuBarSubmenu(t,o,i);e.children.add(r),r.delegate("execute").to(n),s.items.add(e)}else r.push(o);if(r.length)if(0===s.items.length)for(const e of r){let r;r="block"===e.type?i.insertBlock:"image"===e.type?i.insertImage:i.insertInline;const o=createMenuBarListItem(t,e,n,r);s.items.add(o)}else{const e=new MenuBarMenuListItemView(t,n),o=createMenuBarSubmenu(t,{groupId:"Other",definitions:r},i);e.children.add(o),o.delegate("execute").to(n),s.items.add(e)}return n.panelView.children.add(s),n.on("execute",((t,n)=>{const i=e.plugins.get("MergeFieldsEditing").getMergeFieldType(n);"image"===i?e.execute("insertMergeFieldImage",n):"block"===i?e.execute("insertMergeFieldBlock",n):e.execute("insertMergeField",n),e.editing.view.focus()})),n}));const t=e.config.get("mergeFields.previewModes"),n=[];if(t.includes("$labels")&&n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:getTranslation$8(this.editor.locale,"Labels"),commandValue:"$labels"})}),t.includes("$defaultValues")&&n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:getTranslation$8(this.editor.locale,"Default values"),commandValue:"$defaultValues"})}),t.includes("$dataSets")){const t=e.config.get("mergeFields.dataSets");if(t.length)for(const e of t)n.push({type:"button",model:new ViewModel({withText:!0,isToggleable:!0,label:e.label||e.id,commandValue:e.id})})}e.ui.componentFactory.add("previewMergeFields",(t=>{const i=e.commands.get("previewMergeFields"),r=new Collection;for(const e of cloneDeep(n))e.model.bind("isOn").to(i,"value",(t=>t===e.model.commandValue)),r.add(e);const s=createDropdown(t),o=getTranslation$8(t,"Merge fields preview");return s.bind("isEnabled").to(i),addListToDropdown(s,r,{ariaLabel:o,role:"menu"}),s.set({class:"ck-merge-fields-preview-dropdown"}),s.buttonView.set({label:o,ariaLabel:o,ariaLabelledBy:void 0,isOn:!1,icon:previewMergeFieldsIcon,tooltip:!0}),this.listenTo(s,"execute",(t=>{const{commandValue:n}=t.source;e.execute("previewMergeFields",n),e.editing.view.focus()})),s})),e.ui.componentFactory.add("menuBar:previewMergeFields",(t=>{const i=new MenuBarMenuView(t),r=e.commands.get("previewMergeFields");i.buttonView.set({label:getTranslation$8(t,"Merge fields preview"),icon:previewMergeFieldsIcon}),i.bind("isEnabled").to(r);const s=new MenuBarMenuListView(t);s.set({ariaLabel:getTranslation$8(t,"Merge fields preview")});for(const o of cloneDeep(n)){const n=new MenuBarMenuListItemView(t,i),a=new MenuBarMenuListItemButtonView(t);o.model.bind("isOn").to(r,"value",(e=>e===o.model.commandValue)),a.isToggleable=!0,a.bind(...Object.keys(o.model)).to(o.model),a.delegate("execute").to(i),a.on("execute",(t=>{const{commandValue:n}=t.source;e.execute("previewMergeFields",n),e.editing.view.focus()})),n.children.add(a),s.items.add(n)}return i.panelView.children.add(s),i})),this._balloon=e.plugins.get(ContextualBalloon),this.listenTo(e.ui,"update",(()=>{this._updateBalloonVisibility()}),{priority:"low"}),this.listenTo(e.ui.focusTracker,"change:isFocused",((e,t,n)=>{this._balloon.visibleView&&this._balloon.visibleView===this._balloonPanelView&&(n?this._updateBalloonVisibility():this._hideBalloon())}),{priority:"low"}),this.editor.once("ready",this._overrideMentionExecuteListener.bind(this)),this.licenseKey=this.editor.config.get("licenseKey");const i=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in i){const n=t,r=i[n];if("mergeFieldsLicenseKeyValid"==r||"mergeFieldsLicenseKeyInvalid"==r||"mergeFieldsLicenseKeyExpired"==r||"mergeFieldsLicenseKeyDomainLimit"==r||"mergeFieldsLicenseKeyNotAllowed"==r||"mergeFieldsLicenseKeyEvaluationLimit"==r||"mergeFieldsLicenseKeyTrialLimit"==r||"mergeFieldsLicenseKeyUsageLimit"==r){delete i[n],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"mergeFieldsLicenseKeyInvalid"==e&&i._showLicenseError("invalid"),"mergeFieldsLicenseKeyExpired"==e&&i._showLicenseError("expired"),"mergeFieldsLicenseKeyDomainLimit"==e&&i._showLicenseError("domainLimit"),"mergeFieldsLicenseKeyNotAllowed"==e&&i._showLicenseError("featureNotAllowed","MergeFields"),"mergeFieldsLicenseKeyEvaluationLimit"==e&&i._showLicenseError("evaluationLimit"),"mergeFieldsLicenseKeyTrialLimit"==e&&i._showLicenseError("trialLimit"),"mergeFieldsLicenseKeyUsageLimit"==e&&i._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_updateBalloonVisibility(){const e=this.editor.editing.view.document.selection.getSelectedElement(),t=!(!e||!e.getCustomProperty("mergeFieldStatus"));if(this._balloon.hasView(this._balloonPanelView)&&this._balloon.visibleView===this._balloonPanelView)if(t){const t=e.getCustomProperty("mergeFieldStatus");this._balloonPanelView.text=getTranslation$8(this.editor.locale,t),this._balloon.updatePosition(this._getBalloonPositionData())}else this._hideBalloon();else if(t){const t=e.getCustomProperty("mergeFieldStatus");this._showBalloon(getTranslation$8(this.editor.locale,t))}}_showBalloon(e){this._balloonPanelView||(this._balloonPanelView=new MergeFieldsPanelView(this.editor.locale),this._balloonPanelView.text=e),this._balloon.hasView(this._balloonPanelView)||(this._balloon.add({stackId:"mergeFieldsStatus",view:this._balloonPanelView,position:this._getBalloonPositionData()}),this._balloon.showStack("mergeFieldsStatus"))}_getBalloonPositionData(){const e=this.editor.editing.view;return{target:()=>{const t=e.document.selection.getFirstRange(),n=e.domConverter.mapViewToDom(t.getContainedElement());return n?Array.from(n.getClientRects())[0]:e.domConverter.viewRangeToDom(t)}}}_hideBalloon(){this._balloon.remove(this._balloonPanelView)}_removeDefaultValuesPreviewIfUnnecessary(){if(Object.values(this.editor.plugins.get("MergeFieldsEditing").getDefaultValues()).some((e=>e)))return;const e=this.editor.config.get("mergeFields.previewModes");e.indexOf("$defaultValues")>-1&&e.length>1&&(e.splice(e.indexOf("$defaultValues"),1),this.editor.config.set("mergeFields.previewModes",e))}_removeMenuBarButtonIfUnnecessary(){const e=this.editor.config;if(e.get("mergeFields.previewModes")){const n=e.get("mergeFields.previewModes");1===n.length&&(n.includes("$dataSets")?1===e.get("mergeFields.dataSets").length&&t():t())}function t(){const t=e.get("menuBar.removeItems");t?(t.push("menuBar:previewMergeFields"),e.set("menuBar.removeItems",t)):e.set("menuBar.removeItems",["menuBar:previewMergeFields"])}}_setupMentionConfiguration(){const e=this.editor,t=e.config.get("mention.feeds"),n=e.config.get("mergeFields.prefix");t.push({marker:n,dropdownLimit:10,feed:t=>e.plugins.get("MergeFieldsEditing").flattenedMergeFieldDefinitions.filter((n=>{const i=e.commands.get("insertMergeField").isEnabled,r=e.commands.get("insertMergeFieldBlock").isEnabled,s=e.commands.get("insertMergeFieldImage").isEnabled,o=e.plugins.get("MergeFieldsEditing").getMergeFieldType(n.id);return!("text"===o&&!i)&&(!("block"===o&&!r)&&(!("image"===o&&!s)&&(e.plugins.get("MergeFieldsEditing").getLabel(n.id)||n.id).toLowerCase().includes(t.toLowerCase())))})),itemRenderer:e=>{const t=document.createElement("button");return t.innerHTML=""+(e.label||e.id),t}}),e.config.set("mention.feeds",t)}_overrideMentionExecuteListener(){const e=this.editor;e.commands.get("mention").on("execute",((t,n)=>{const i=n[0];i.marker===e.config.get("mergeFields.prefix")&&e.model.change((n=>{n.remove(i.range);const r=i.mention.id,s=e.plugins.get("MergeFieldsEditing").getMergeFieldType(r);"text"===s?e.execute("insertMergeField",r):"block"===s?e.execute("insertMergeFieldBlock",r,!1):e.execute("insertMergeFieldImage",r,{breakBlock:!0}),t.stop()}))}),{priority:"high"})}}function createInsertMergeFieldDropdown(e){const t=createDropdown(e);return t.set({class:"ck-insert-merge-field-dropdown",isEnabled:!0}),t.buttonView.set({label:getTranslation$8(e,"Insert merge field"),icon:insertMergeFieldIcon,tooltip:!0}),t}function createMergeFieldsListView(e,t,n){const i=new MergeFieldsListView(e),r=[],s=[];for(const o of t)if("groupId"in o){const t=createMergeFieldsGroupView(e,o.groupLabel||o.groupId,o.definitions,n);t.delegate("execute").to(i),s.push(t)}else r.push(o);if(r.length){const t=createMergeFieldsGroupView(e,"Other",r,n);t.delegate("execute").to(i),s.push(t)}return i.items.addMany(s),i}function createMergeFieldsGroupView(e,t,n,i){const r=new ListItemGroupView(e,new LabelWithHighlightView);r.label=t;for(const t of n){let n;n="block"===t.type?i.insertBlock:"image"===t.type?i.insertImage:i.insertInline;const s=createMergeFieldListItemView(e,t,n);s.delegate("execute").to(r),r.items.add(s)}return r}function createMergeFieldListItemView(e,t,n){const i=new ListItemView(e),r=new ButtonLabelWithHighlightView,s=new ButtonView(e,r);return i.children.add(s),s.set({label:t.label||t.id,withText:!0}),s.bind("isEnabled").to(n),s.on("execute",(()=>{i.fire("execute",t.id)})),i}function createMergeFieldsSearchTextView(e,t){return new SearchTextView(e,{filteredView:t,queryView:{label:getTranslation$8(e,"Search merge field")},class:"ck-merge-fields-search",infoView:{text:{notFound:{primary:getTranslation$8(e,"No merge fields found")},noSearchableItems:{primary:getTranslation$8(e,"No merge fields available")}}}})}function createMenuBarSubmenu(e,t,n){const i=new MenuBarMenuView(e),r=new MenuBarMenuListView(e);for(const s of t.definitions){let t;t="block"===s.type?n.insertBlock:"image"===s.type?n.insertImage:n.insertInline;const o=createMenuBarListItem(e,s,i,t);r.items.add(o)}return i.set({class:"ck-menu-bar__merge-fields-submenu"}),i.buttonView.set({label:t.groupLabel||t.groupId}),i.panelView.children.add(r),i}function createMenuBarListItem(e,t,n,i){const r=new MenuBarMenuListItemView(e,n),s=new MenuBarMenuListItemButtonView(e);return s.set({label:t.label||t.id}),r.delegate("execute").to(n),r.children.add(s),s.bind("isEnabled").to(i),s.on("execute",(()=>{r.fire("execute",t.id)})),r}class MergeFields extends Plugin{static get requires(){return[MergeFieldsEditing,MergeFieldsUI]}static get pluginName(){return"MergeFields"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}const COLUMN_GAP=100,EDITING_RENDER_TIMEOUT=200;class PaginationLookup extends Plugin{constructor(){super(...arguments),this._recalculatePageBreaksDebounced=debounce$1((()=>this._recalculatePageBreaks()),EDITING_RENDER_TIMEOUT),this._pagesContainer=null}static get pluginName(){return"PaginationLookup"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){if(this.set({pageBreaks:[]}),!this.editor.config.get("pagination"))return void logWarning("pagination-config-not-found",this.editor.config);const e=this.editor.plugins.get("PaginationEditing");this.bind("isEnabled").to(e),this.editor.ui.once("ready",(()=>this._onUiReady())),this.on("change:isEnabled",((e,t,n)=>{n&&this._recalculatePageBreaksDebounced()}))}afterInit(){checkLicense$7(this)}destroy(){super.destroy(),this._pagesContainer&&(this._recalculatePageBreaksDebounced.cancel(),this._pagesContainer.destroy(),this._pagesContainer.element.remove())}_onUiReady(){const e=this.editor,t=e.editing.view,n=this._getAttachedDomRoot();if(!n||0===n.childElementCount)return void e.ui.once("update",(()=>this._onUiReady()));const{pageWidth:i,pageHeight:r}=e.config.get("pagination"),{top:s,left:o,bottom:a,right:l}=this._configuredPaddings;this._pagesContainer=new View(e.locale);const c=this._pagesContainer;c.set("class",""),c.setTemplate({tag:"div",attributes:{contenteditable:!0,style:{columnWidth:i,width:i,height:"calc( "+r+" - "+s+" - "+a+" )",minWidth:"auto",minHeight:"auto",padding:"0 "+l+" 0 "+o,columnGap:COLUMN_GAP+"px",border:0,boxSizing:"border-box",columnCount:"auto",columnFill:"auto",overflow:"hidden",position:"absolute",top:"-99999px",left:"-99999px"},tabindex:"-1",class:c.bindTemplate.to("class")}}),c.render(),n.parentNode.insertBefore(c.element,n.nextSibling),this.listenTo(t,"render",(()=>this._recalculatePageBreaksDebounced()),{priority:"low"}),this._recalculatePageBreaksDebounced()}_getAttachedDomRoot(){for(const e of this.editor.editing.view.domRoots.values())if(e.ownerDocument.body.contains(e))return e;return null}_recalculatePageBreaks(){if(!this.isEnabled)return Promise.resolve();const e=this.editor.editing.view,t=this._pagesContainer,n=this._getAttachedDomRoot();if(!n)return Promise.resolve();for(t.class=["ck-reset","ck-pagination-view",...n.classList].join(" ");t.element.firstChild;)t.element.firstChild.remove();const i=Array.from(e.domRoots);i.sort((([,e],[,t])=>e.compareDocumentPosition(t)==Node.DOCUMENT_POSITION_PRECEDING?1:-1));for(const[e,n]of i){const i=n.cloneNode(!0);"attributeStyleMap"in i&&i.attributeStyleMap.clear(),i.className="",i.removeAttribute("id"),i.dataset.rootName=e,t.element.append(i)}return allImagesAreReady(Array.from(t.element.querySelectorAll("img"))).then((()=>this._updatePageBreaksData()))}_updatePageBreaksData(){const e=this._pagesContainer.element;if(!e.ownerDocument.body.contains(e))return;const t=new Rect(e).excludeScrollbarsAndBorders(),n=_0x49a38d.window.getComputedStyle(e),i=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),r=Math.floor(t.width+COLUMN_GAP-i),s=findPageStarterInfos(e,Math.floor(t.left-e.scrollLeft),r,t.height).map((e=>this._mapPageStarterInfoToPageBreakInfo(e)));s.every((e=>!!e))&&(this.pageBreaks=s)}_mapPageStarterInfoToPageBreakInfo(e){const t=this.editor.editing.view,n=this.editor.editing.mapper,i=t.domConverter,r=e.path.shift(),s=this._pagesContainer.element.childNodes[r].dataset.rootName,o=t.getDomRoot(s);if(!o)return null;const a=pageElementToViewElement(o,e);if(!a)return null;const l=i.domPositionToView(a,e.textOffset||0);return l?"manual"==e.type?this._mapManualPageStarterInfoToPageBreakInfo(l,a):"text"==e.type&&n.toModelPosition(l).offset?this._mapTextPageStarterInfoToPageBreakInfo(l,a,e.textOffset):this._mapElementPageStarterInfoToPageBreakInfo(l,a,e.offset):null}_mapManualPageStarterInfoToPageBreakInfo(e,t){const n=this.editor.model,i=this.editor.editing.mapper.toModelElement(e.parent),r=n.createRangeOn(i);return new PageBreakInfo({type:"manual",modelRange:r,domNode:t,offset:0})}_mapTextPageStarterInfoToPageBreakInfo(e,t,n){const i=this.editor.model,r=this.editor.editing.mapper,s=this.editor.editing.view.domConverter;if(n>=t.length)return null;const o=r.toModelPosition(e),a=i.createRange(o),l=r.findMappedViewAncestor(e),c=s.mapViewToDom(l);return new PageBreakInfo({type:"text",modelRange:a,domNode:t,offset:findOffsetTopForTextOffset(t,n,c)})}_mapElementPageStarterInfoToPageBreakInfo(e,t,n){const i=this.editor.model,r=this.editor.editing,s=r.mapper,o=r.view.domConverter,a=s.findMappedViewAncestor(e),l=s.toModelElement(a),c=getTopMostParentBlockTouchingPosition(i.createPositionBefore(l))||l;let d=s.toViewElement(c),u=i.createRangeOn(c);const h=i.createPositionBefore(c).nodeBefore;if(h&&h.is("element","imageBlock")){const e=s.toViewElement(h),t=o.mapViewToDom(e),n=_0x49a38d.window.getComputedStyle(t).float;"left"!=n&&"right"!=n||(u=i.createRangeOn(h))}for(;d.parent!==d.root&&0===d.index;)d=d.parent;const m=new Rect(isHTMLElement(t)?t:createDomRangeOn(t)),g=n?m.height-n:0,p=o.mapViewToDom(d),f=new Rect(p);return new PageBreakInfo({type:"element",modelRange:u,domNode:p,offset:Math.round(g)?g+m.top-f.top:0})}get _configuredPaddings(){const e=this.editor.config.get("pagination.pageMargins");return Object.assign({top:"10mm",bottom:"10mm",left:"10mm",right:"10mm"},e)}static _findPageStarterInfos(e,t,n,i,r){return findPageStarterInfos(e,t,n,i,r)}}class PageBreakInfo{constructor({type:e,modelRange:t,domNode:n,offset:i}){this.type=e,this.modelRange=t,this._domNode=n,this._offset=i}get offset(){if(!this._domNode.ownerDocument.body.contains(this._domNode))return 0;const e=new Rect(isHTMLElement(this._domNode)?this._domNode:createDomRangeOn(this._domNode));return"manual"==this.type?e.top+e.height/2:e.top+this._offset}}function isPageBreak(e){return!(!e||!isHTMLElement(e))&&Boolean(e.classList.contains("page-break")||e.closest(".page-break"))}function pageElementToViewElement(e,t){let n=e;for(const e of t.path){if(!n)return null;n=n.childNodes[e]}return n}function findOffsetTopForTextOffset(e,t,n){const i=createDomRangeOn(e),r=createDomRangeIn(n);let s;s=0==t?createDomRangeMultiNode(r.startContainer,r.startOffset,e.parentNode,Array.from(e.parentNode.childNodes).indexOf(e)):createDomRangeMultiNode(r.startContainer,r.startOffset,e,t);const o=createDomRangeMultiNode(e,t,r.endContainer,r.endOffset),a=new Rect(s).bottom;return(new Rect(o).top+a)/2-new Rect(i).top}function getTopMostParentBlockTouchingPosition(e){const t=e.parent,n=t.root.document.model,i=t.getAncestors({parentFirst:!0,includeSelf:!0});let r=null;for(const t of i){if(t.is("rootElement"))return r;if(!n.createPositionBefore(t).isTouching(e))return r;r=t}}function allImagesAreReady(e){return Promise.all(e.map((e=>Promise.race([imageReady(e),timeout(1e3)]))))}function imageReady(e){return e.hasAttribute("width")&&e.hasAttribute("height")?Promise.resolve():new Promise((t=>{function n(){e.removeEventListener("load",n),e.removeEventListener("error",n),t()}e.complete?t():(e.addEventListener("load",n),e.addEventListener("error",n))}))}function timeout(e){return new Promise((t=>setTimeout(t,e)))}function createDomRangeOn(e){const t=_0x49a38d.document.createRange();return t.selectNode(e),t}function createDomRangeIn(e){const t=_0x49a38d.document.createRange();return t.selectNodeContents(e),t}function createDomRange(e,t,n){const i=_0x49a38d.document.createRange();return i.setStart(e,t),i.setEnd(e,n),i}function createDomRangeMultiNode(e,t,n,i){const r=_0x49a38d.document.createRange();return r.setStart(e,t),r.setEnd(n,i),r}function findPageStarterInfos(e,t,n,i,r){const s=[];for(const[o,a]of e.childNodes.entries()){let e=[];isHTMLElement(a)&&a.offsetParent&&!a.style.position?e=findPageStartersInElementNode(a,o,t,n,i,r):isText(a)&&(e=findPageStartersInTextNode(a,o,t,n,r)),e.length&&(s.push(...e),t+=e.length*n,r=!1)}return s}function findPageStartersInElementNode(e,t,n,i,r,s){const o=[];if(isPageBreak(e.previousSibling)&&(o.push({type:"manual",offset:0,path:[t-1]}),s=!0),"table-row"==_0x49a38d.window.getComputedStyle(e).display){let i=0,s=!1;for(const t of e.getClientRects())i+=t.height,t.left>=n&&(s=!0);if(i<r&&s)return o.push({type:"element",offset:0,path:[t]}),o}const a=e.closest("figure.image");if(a&&shouldIgnoreFigure(a)){const e=_0x49a38d.window.getComputedStyle(a).float;if("left"==e||"right"==e)return o}const l=findPageStarterInfos(e,n,i,r,s);if(l.length){for(const e of l)o.push({type:e.type,offset:e.offset,textOffset:e.textOffset,path:[t,...e.path]}),n+=i,s=!1;return o}return o.push(...findPageStartersInLeafElementNode(e,t,n,i,s)),o}function findPageStartersInLeafElementNode(e,t,n,i,r){const s=[];if("table-cell"==_0x49a38d.window.getComputedStyle(e).display)return[];const o=[];for(const t of e.getClientRects())if(t.left>=n){for(const e of o)e.height+=t.height;o.push({height:t.height}),n+=i}for(const e of o)r||s.push({type:"element",offset:e.height,textOffset:0,path:[t]}),r=!1;return s}function findPageStartersInTextNode(e,t,n,i,r){const s=createDomRangeOn(e),o=[];let a=0;for(const l of s.getClientRects())if(l.left>=n){const s=findLastTextOffsetOnPage(e,a,n,i);r||o.push({type:"text",path:[t],textOffset:s}),a=s,n+=i,r=!1}return o}function findLastTextOffsetOnPage(e,t,n,i){let r=t,s=e.length;for(;s-r>1;){const t=Math.ceil((r+s)/2);domRangeContainsPageBreak(createDomRange(e,r,t),n,i)?s=t:r=t}return r}function domRangeContainsPageBreak(e,t,n){for(const i of e.getClientRects())if(i.left>=t&&i.left<t+n)return!0;return!1}function shouldIgnoreFigure(e){let t=!1;const n=e.parentElement.dataset.rootName,i=e.nextElementSibling,r=e.previousElementSibling,s=i&&_0x49a38d.window.getComputedStyle(i).float,o=i&&"ck-fake-selection-container"===i.className;return!n||i||r||(t=!0),n&&!r&&o&&(t=!0),n&&!r&&"none"!==s&&(t=!0),!t}function isHTMLElement(e){return e.nodeType==Node.ELEMENT_NODE}function isText(e){return e.nodeType==Node.TEXT_NODE}async function checkLicense$7(e){const t=g([101,109,90,82,51,112,67,66,53,120,65,83,115,52,54,74,89,98,113,100,48,119,105,68,114,75,97,50,103,108,85,102,106,78,122,70,84,49,99,57,77,116,86,72,117,87,110,88,79,69,107,104,76,118,56,71,81,80,73,111,121,55]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([101]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,65,71])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}const toPx=toUnit("px");let LineView$1=class extends View{constructor(){super();const e=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null,pageNumber:null}),this.setTemplate({tag:"div",attributes:{"data-page-number":e.to("pageNumber"),class:["ck","ck-pagination-view-line",e.if("isVisible","ck-hidden",(e=>!e))],style:{left:e.to("left",(e=>toPx(e))),top:e.to("top",(e=>toPx(e))),width:e.to("width",(e=>toPx(e)))}}})}};class LinesRepository{constructor(e){this._visibleLines=new Set,this._hiddenLines=new Set,this._viewCollection=e.ui.view.body}destroy(){for(const e of this._hiddenLines)e.destroy()}cleanLines(){for(const e of this._visibleLines)e.isVisible=!1,this._hiddenLines.add(e);this._visibleLines.clear()}showLine(e,t,n,i){let r;this._hiddenLines.size?(r=first(this._hiddenLines.values()),this._hiddenLines.delete(r)):r=new LineView$1,r.set({pageNumber:i,left:e,top:t,width:n}),r.isVisible=!0,this._viewCollection.has(r)||this._viewCollection.add(r),this._visibleLines.add(r)}}const PLUGIN_ENABLED_CLASS="ck-pagination_enabled";class PaginationRenderer extends Plugin{constructor(){super(...arguments),this._scrollableEditingRootDomAncestor=null,this._resizeObserver=null}static get pluginName(){return"PaginationRenderer"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){this.set({pageNumber:1}),this._linesRepository=new LinesRepository(this.editor),this._scrollableEditingRootDomAncestor=null,this._resizeObserver=null,this._paginationLookupPlugin=this.editor.plugins.get("PaginationLookup"),this.bind("isEnabled").to(this.editor.plugins.get("PaginationEditing")),this.editor.ui.once("ready",(()=>this._onUiReady())),this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS),this.on("change:isEnabled",((e,t,n)=>{n||this._linesRepository.cleanLines(),this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS,n)}))}destroy(){this._toggleEditingRootsClass(PLUGIN_ENABLED_CLASS,!1),this._linesRepository.destroy(),this._scrollableEditingRootDomAncestor=null,this._resizeObserver&&this._resizeObserver.destroy()}scrollToPage(e){if(!this.isEnabled)return;const t=e>1?this._getPageBreakLineOffset(e-1):0;this._scrollableEditingRootDomAncestor.scrollTo({top:t-10,left:this._scrollableEditingRootDomAncestor.scrollLeft,behavior:env.isMotionReduced?"instant":"smooth"})}_onUiReady(){const e=this.editor,t=this._getAttachedDomRoot();t?(this._scrollableEditingRootDomAncestor=findScrollableElement(t),e.ui.view.listenTo(this._scrollableEditingRootDomAncestor,"scroll",(()=>{this._updatePageBreakLines()}),{usePassive:!0}),e.ui.view.listenTo(_0x49a38d.window,"resize",(()=>this._updatePageBreakLines())),this._resizeObserver=new _0x3f4b48(this._scrollableEditingRootDomAncestor,(()=>{this._updatePageBreakLines()})),this.listenTo(this._paginationLookupPlugin,"change:pageBreaks",(()=>this._updatePageBreakLines()))):e.ui.once("update",(()=>this._onUiReady()))}_getAttachedDomRoot(){for(const e of this.editor.editing.view.domRoots.values())if(e.ownerDocument.body.contains(e))return e;return null}_updatePageBreakLines(){if(!this.isEnabled)return;const e=this._getAttachedDomRoot(),t=this._paginationLookupPlugin.pageBreaks;if(this._linesRepository.cleanLines(),!e||1==t.length)return void(this.pageNumber=1);const n=new Rect(e).excludeScrollbarsAndBorders(),i=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders(),r=i.top+i.height/3;let s=!1;const o=[];for(let e=1;e<t.length;e++){const t=this._getPageBreakLineOffset(e,i);if(!t)continue;const a=i.top+t-this._scrollableEditingRootDomAncestor.scrollTop;o.push({pageOffsetTop:a,domRootRect:n,domScrollableRect:i,pageNumber:e}),a>r&&!s&&(this.pageNumber=e,s=!0)}this._renderPageBreakLines(o),s||(this.pageNumber=t.length)}_renderPageBreakLines(e){const{scrollX:t,scrollY:n}=_0x49a38d.window;if(e.length)for(const{domScrollableRect:i,pageOffsetTop:r,domRootRect:s,pageNumber:o}of e)i.top<r&&r<i.bottom&&this._linesRepository.showLine(s.left+t,r+n,s.width,o+1)}_getPageBreakLineOffset(e,t=null){const n=this._paginationLookupPlugin.pageBreaks[e].offset;return n?(t||(t=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders()),n-t.top+this._scrollableEditingRootDomAncestor.scrollTop):0}_toggleEditingRootsClass(e,t=!0){const n=this.editor.editing.view;n.change((i=>{for(const r of n.document.roots)t?i.addClass(e,r):i.removeClass(e,r)}))}}function findScrollableElement(e){let t=e;do{t=t.parentElement;const e=_0x49a38d.window.getComputedStyle(t).overflowY;if("auto"==e||"scroll"==e)break}while("BODY"!=t.tagName);return t}function getTranslation$7(e,t,...n){const i=e.t;switch(t){case"Go to next page":return i("Go to next page");case"Go to previous page":return i("Go to previous page");case"Current page number (from 1 to %0)":return i("Current page number (from 1 to %0)",...n);case"Keystrokes for navigating through documents":return i("Keystrokes for navigating through documents");case"Go to the previous page (also move selection)":return i("Go to the previous page (also move selection)");case"Go to the next page (also move selection)":return i("Go to the next page (also move selection)");default:return t}}class PaginationEditing extends Plugin{static get pluginName(){return"PaginationEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[PaginationLookup,PaginationRenderer]}init(){this.set({pageNumber:1,totalPages:1});const e=this.editor.plugins.get("Pagination"),t=this.editor.plugins.get(PaginationLookup),n=this.editor.plugins.get(PaginationRenderer);this.bind("isEnabled").to(e),this._setUpDataDowncastConversion(),this.bind("pageNumber").to(n),this.listenTo(t,"change:pageBreaks",((e,t,n,i)=>{this.totalPages=n.length,this._updatePageBreakMarkers(n,i)})),this._setupKeystrokes(),this.licenseKey=this.editor.config.get("licenseKey");const i=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in i){const n=t,r=i[n];if("paginationLicenseKeyValid"==r||"paginationLicenseKeyInvalid"==r||"paginationLicenseKeyExpired"==r||"paginationLicenseKeyDomainLimit"==r||"paginationLicenseKeyNotAllowed"==r||"paginationLicenseKeyEvaluationLimit"==r||"paginationLicenseKeyTrialLimit"==r||"paginationLicenseKeyUsageLimit"==r){delete i[n],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"paginationLicenseKeyInvalid"==e&&i._showLicenseError("invalid"),"paginationLicenseKeyExpired"==e&&i._showLicenseError("expired"),"paginationLicenseKeyDomainLimit"==e&&i._showLicenseError("domainLimit"),"paginationLicenseKeyNotAllowed"==e&&i._showLicenseError("featureNotAllowed","Pagination"),"paginationLicenseKeyEvaluationLimit"==e&&i._showLicenseError("evaluationLimit"),"paginationLicenseKeyTrialLimit"==e&&i._showLicenseError("trialLimit"),"paginationLicenseKeyUsageLimit"==e&&i._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}scrollToPage(e){this.isEnabled&&this.editor.plugins.get(PaginationRenderer).scrollToPage(this._validatePageNumber(e))}moveSelectionToPage(e){if(!this.isEnabled)return;const t=this.editor,n=this.editor.plugins.get(PaginationLookup).pageBreaks[e-1];n&&t.model.change((e=>{switch(n.type){case"manual":{const i=t.model.schema.getNearestSelectionRange(n.modelRange.end,"forward");e.setSelection(i);break}case"element":{const i=t.model.schema.getNearestSelectionRange(n.modelRange.start,"forward");e.setSelection(i);break}case"text":{const t=n.modelRange.start;if(" "===t.textNode.data[t.offset]){const n=e.createPositionAt(t.parent,t.offset+1);e.setSelection(n)}else e.setSelection(n.modelRange)}}t.editing.view.focus()}))}goToNextPage(){const e=this._validatePageNumber(this.pageNumber+1);this.moveSelectionToPage(e),this.scrollToPage(e)}goToPreviousPage(){const e=this._validatePageNumber(this.pageNumber-1);this.moveSelectionToPage(e),this.scrollToPage(e)}_updatePageBreakMarkers(e,t){const n=this.editor.model;this.isEnabled&&n.change((i=>{for(let t=1;t<e.length;t++){const r=e[t].modelRange,s="pagination:"+(t+1);n.markers.has(s)?i.updateMarker(s,{range:r}):i.addMarker(s,{range:r,usingOperation:!1,affectsData:!0})}for(let r=e.length;r<t.length;r++){const e="pagination:"+(r+1);n.markers.has(e)&&i.removeMarker(e)}}))}_setUpDataDowncastConversion(){this.editor.conversion.for("dataDowncast").add((e=>{e.on("addMarker:pagination",((e,{markerRange:t,markerName:n},i)=>{if(!i.options.pagination)return;if(!i.consumable.consume(t,e.name))return;const r=t.getContainedElement();let s=r?i.mapper.toViewElement(r):null;if(!s){const e=t.start;if(i.schema.checkChild(e,"$text")){const t=i.mapper.toViewPosition(e);s=i.writer.createContainerElement("span"),s.getFillerOffset=()=>null,i.writer.insert(t,s)}else{const t=e.nodeAfter;s=i.mapper.toViewElement(t)}}for(;s.parent!==s.root&&0===s.index;)s=s.parent;const o=n.substring(11);s.hasClass("page-break")||(i.writer.setStyle("page-break-before","always",s),i.writer.setAttribute("data-pagination-page",o,s),i.mapper.bindElementToMarker(s,n)),e.stop()}))}))}_setupKeystrokes(){const e=this.editor;e.keystrokes.set("Shift+Pageup",((e,t)=>{this.goToPreviousPage(),t()})),e.keystrokes.set("Shift+Pagedown",((e,t)=>{this.goToNextPage(),t()})),e.accessibility.addKeystrokeInfoGroup({id:"pagination",label:getTranslation$7(e.locale,"Keystrokes for navigating through documents"),keystrokes:[{label:getTranslation$7(e.locale,"Go to the previous page (also move selection)"),keystroke:"Shift+Pageup",mayRequireFn:!0},{label:getTranslation$7(e.locale,"Go to the next page (also move selection)"),keystroke:"Shift+Pagedown",mayRequireFn:!0}]})}_validatePageNumber(e){return e<1&&(e=1),e>this.totalPages&&(e=this.totalPages),e}}class PageNavigatorView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set({pageNumber:1,totalPages:1,isEnabled:!0}),this.pageNumberView=new InputNumberView(e,{min:1,step:1}),this.pageNumberView.set({inputMode:"numeric",tabIndex:-1}),this.pageNumberView.bind("ariaLabel").to(this,"totalPages",(t=>getTranslation$7(e,"Current page number (from 1 to %0)",t))),this.pageNumberView.bind("max").to(this,"totalPages"),this.pageNumberView.bind("isReadOnly").to(this,"isEnabled",(e=>!e)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-page-navigator",t.if("isEnabled","ck-disabled",(e=>!e))]},children:[this.pageNumberView,{tag:"span",children:[{text:t.to("totalPages")}]}]})}render(){super.render();const e=this.pageNumberView.element,t=e=>{this.pageNumberView.element.value=String(e)};t(this.pageNumber),this.on("change:pageNumber",((e,n,i)=>{t(i)})),this.listenTo(e,"keydown",((t,n)=>{if("ArrowUp"===n.key||"ArrowDown"===n.key)return void n.stopPropagation();if(n.keyCode!==keyCodes.enter)return;n.preventDefault();const i=e.valueAsNumber;Number.isNaN(i)?e.value=String(this.pageNumber):(e.checkValidity()?this.pageNumber=i:i>this.totalPages?(this.pageNumber=this.totalPages,e.value=String(this.totalPages)):(this.pageNumber=1,e.value="1"),this.fire("navigation",this.pageNumber))})),this.listenTo(e,"blur",(()=>{e.value=String(this.pageNumber)})),this.listenTo(e,"focus",(()=>{this.pageNumberView.select()}))}focus(){this.element.firstChild.focus()}}var arrowDownIcon$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 .75a9.25 9.25 0 110 18.5 9.25 9.25 0 010-18.5zm0 1.5a7.75 7.75 0 100 15.5 7.75 7.75 0 000-15.5zm0 2.022a.75.75 0 01.743.649l.007.101v8.165l2.714-2.705a.75.75 0 01.977-.07l.084.072a.75.75 0 01.07.976l-.072.084-3.994 3.981a.75.75 0 01-.975.073l-.084-.073-3.99-3.98a.75.75 0 01.975-1.135l.085.072 2.71 2.706V5.022a.75.75 0 01.75-.75z"/></svg>\n',arrowUpIcon$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 19.25a9.25 9.25 0 100-18.5 9.25 9.25 0 000 18.5zm0-1.5a7.75 7.75 0 110-15.5 7.75 7.75 0 010 15.5zm0-2.022a.75.75 0 00.743-.649l.007-.101V6.813l2.714 2.705a.75.75 0 00.977.07l.084-.072a.75.75 0 00.07-.976l-.072-.084-3.994-3.981a.75.75 0 00-.975-.073l-.084.073-3.99 3.98a.75.75 0 00.975 1.135l.085-.072 2.71-2.706v8.166c0 .414.336.75.75.75z"/></svg>\n';class PaginationUI extends Plugin{static get pluginName(){return"PaginationUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.plugins.get("PaginationEditing");e.ui.componentFactory.add("pageNavigation",(e=>{const n=new PageNavigatorView(e);return n.bind("pageNumber").to(t),n.bind("totalPages").to(t),n.bind("isEnabled").to(t),n.on("navigation",((e,n)=>{t.moveSelectionToPage(n),t.scrollToPage(n)})),n})),e.ui.componentFactory.add("nextPage",(n=>{const i=new ButtonView(n);return i.isEnabled=!0,i.label=getTranslation$7(e.locale,"Go to next page"),i.icon=arrowDownIcon$1,i.tooltip=!0,i.keystroke="Shift+PageDown",i.bind("isEnabled").to(t),this.listenTo(i,"execute",(()=>{t.goToNextPage()})),i})),e.ui.componentFactory.add("previousPage",(n=>{const i=new ButtonView(n);return i.isEnabled=!0,i.label=getTranslation$7(e.locale,"Go to previous page"),i.icon=arrowUpIcon$1,i.tooltip=!0,i.keystroke="Shift+PageUp",i.bind("isEnabled").to(t),this.listenTo(i,"execute",(()=>{t.goToPreviousPage()})),i}))}}class Pagination extends Plugin{static get pluginName(){return"Pagination"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[PaginationEditing,PaginationUI]}constructor(e){super(e),this.isEnabled=!1}init(){this.set({pageNumber:1,totalPages:1});const e=this.editor.plugins.get(PaginationEditing);this.bind("pageNumber").to(e),this.bind("totalPages").to(e),env.isBlink||this.editor.config.get("pagination.enableOnUnsupportedBrowsers")?this.editor.on("ready",(()=>{this.isEnabled=!0})):this.forceDisabled("browserCheck")}scrollToPage(e){this.editor.plugins.get(PaginationEditing).scrollToPage(e)}}const MS_EXCEL_META_REGEX=/<meta\s*name="?generator"?\s*content="?microsoft\s*excel\s*\d+"?\/?>/i;function isMSExcelContent(e){return MS_EXCEL_META_REGEX.test(e)}const CSS_SELECTOR_REGEX=/^(?<tagName>(?!\.)[\w-]+)?(\.(?<className>[\w-]+))?$/i;function getMatchingStyles(e,t){const n=new Map;for(const[i,r]of t){if(!i.tagName&&!i.className)continue;const t=!i.tagName||e.name===i.tagName,s=!i.className||e.hasClass(i.className);t&&s&&n.set(i,r)}return n}function extractStyles(e){const t={};for(const n of e)for(const e of n.cssRules)if(e instanceof CSSStyleRule){const n=parseCSSStyleDeclaration(e.style);t[e.selectorText]=Object.assign({},t[e.selectorText]||{},n)}return t}function expandStyles(e){const t=new Map;for(const n in e){const i=parseCSSSelector(n),r=e[n];for(const e of i)t.set(e,r)}return t}function parseCSSStyleDeclaration(e){const t={};for(let n=0;n<e.length;n++){const i=e[n],r=e.getPropertyValue(i);"initial"!==r&&(t[i]=r)}return t}function parseCSSSelector(e){const t=e.split(",").map((e=>e.trim())),n=[];for(const e of t){const t=CSS_SELECTOR_REGEX.exec(e);t&&n.push(t.groups)}return n}function flattenStyleDefinitions(e){const t={};for(const n of e)Object.assign(t,n);return t}class MSOfficeStylesInliner extends MSWordNormalizer{execute(e){const{body:t,styles:n}=e._parsedData,i=new UpcastWriter(t.document),r=i.createRangeIn(t),s=expandStyles(extractStyles(n));for(const e of r){if("elementStart"!==e.type)continue;const t=getMatchingStyles(e.item,s);if(t.size){const n=flattenStyleDefinitions(Array.from(t.values()));for(const t in n){const r=e.item;r.hasStyle(t)||i.setStyle(t,n[t],r)}}}e.content=t}isActive(e){return super.isActive(e)||isMSExcelContent(e)}}class PasteFromOfficeEnhancedInliner extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedInliner"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice"]}init(){const e=this.editor,t=e.plugins.get("ClipboardPipeline"),n=e.editing.view.document,i=new MSOfficeStylesInliner(n);t.on("inputTransformation",((e,t)=>{const r=t.dataTransfer.getData("text/html");i.isActive(r)&&(t._parsedData||(t._parsedData=parseHtml(r,n.stylesProcessor)),i.execute(t))}),{priority:priorities.get("high")+11})}afterInit(){checkLicense$6(this)}}async function checkLicense$6(e){const t=g([110,78,54,105,67,49,103,56,57,76,71,121,74,101,85,69,102,114,82,51,83,80,55,117,108,112,113,116,90,70,107,118,100,53,115,68,86,73,77,122,65,72,98,52,50,79,87,119,66,104,109,99,84,48,75,89,81,97,106,120,111,88]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([110]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([80,79,69]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}const CSS_PROPERTIES_TO_PROPAGATE=["color","font-family","font-size","text-decoration","text-decoration-line","font-weight","font-style","vertical-align"],CSS_PROPERTIES_TO_BE_SPANS=["color","font-family","font-size"],CSS_PROPERTIES_TO_BE_HTML_ELEMENTS={"font-style":[["italic","i"]],"font-weight":[["medium","strong"],["bold","strong"],["bolder","strong"],[e=>Number(e)>=600,"strong"]],"text-decoration":[["underline","u"],["line-through","s"]],"text-decoration-line":[["underline","u"],["line-through","s"]],"vertical-align":[["sub","sub"],["super","sup"]]};function isPropertyToBePropagated(e){return CSS_PROPERTIES_TO_PROPAGATE.includes(e)}function isPropertyToBePropagatedAsSpan(e){return CSS_PROPERTIES_TO_BE_SPANS.includes(e)}function isPropertyToBePropagatedAsHTMLElement(e){return e in CSS_PROPERTIES_TO_BE_HTML_ELEMENTS}function getStylePropertyNamesToPropagate(e){return Array.from(e.getStyleNames()).filter(isPropertyToBePropagated)}function propagateStyleProperties(e,t,n){const{spanStyles:i,stylesToBeHtmlElements:r}=getStylesToPropagate(e,n);propagateStylesAsHTMLElements(e,t,r),propagateStylesAsSpan(e,t,i)}function propagateStylesAsHTMLElements(e,t,n){for(const i in n)n[i].forEach((([,n])=>{const i=t.createElement(n,[],e.getChildren());t.insertChild(0,i,e)})),t.removeStyle(i,e)}function propagateStylesAsSpan(e,t,n){if(!Object.keys(n).length)return;const i=t.createElement("span",[],e.getChildren());t.setStyle(n,i),t.insertChild(0,i,e),t.removeStyle(Object.keys(n),e)}function getStylesToPropagate(e,t){const n={},i={};return t.forEach((t=>{const r=e.getStyle(t);if(r)if(isPropertyToBePropagatedAsSpan(t))n[t]=r;else if(isPropertyToBePropagatedAsHTMLElement(t)){const e=r.split(" ");CSS_PROPERTIES_TO_BE_HTML_ELEMENTS[t].forEach((([n,r])=>{for(const s of e)("function"==typeof n&&n(s)||n===s)&&(i[t]=[...i[t]||[],[n,r]])}))}})),{spanStyles:n,stylesToBeHtmlElements:i}}class MSOfficeInlineStylePropagator extends MSWordNormalizer{execute(e){const{body:t}=e._parsedData,n=new UpcastWriter(t.document),i=n.createRangeIn(t),r=new ViewDocument(n.document.stylesProcessor),s=[...new DomConverter(r).blockElements,"font"],o=i.getItems();for(const e of o)e.is("element")&&s.includes(e.name)&&propagateStyleProperties(e,n,getStylePropertyNamesToPropagate(e));e.content=t}isActive(e){return super.isActive(e)||isMSExcelContent(e)}}class PasteFromOfficeEnhancedPropagator extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedPropagator"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice"]}init(){const e=this.editor,t=e.plugins.get("ClipboardPipeline"),n=e.editing.view.document,i=new MSOfficeInlineStylePropagator(n);t.on("inputTransformation",((e,t)=>{const r=t.dataTransfer.getData("text/html");i.isActive(r)&&(t._parsedData||(t._parsedData=parseHtml(r,n.stylesProcessor)),i.execute(t))}),{priority:priorities.get("high")+10}),this.licenseKey=this.editor.config.get("licenseKey");const r=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in r){const n=t,i=r[n];if("pasteFromOfficeEnhancedLicenseKeyValid"==i||"pasteFromOfficeEnhancedLicenseKeyInvalid"==i||"pasteFromOfficeEnhancedLicenseKeyExpired"==i||"pasteFromOfficeEnhancedLicenseKeyDomainLimit"==i||"pasteFromOfficeEnhancedLicenseKeyNotAllowed"==i||"pasteFromOfficeEnhancedLicenseKeyEvaluationLimit"==i||"pasteFromOfficeEnhancedLicenseKeyTrialLimit"==i||"pasteFromOfficeEnhancedLicenseKeyUsageLimit"==i){delete r[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"pasteFromOfficeEnhancedLicenseKeyInvalid"==e&&r._showLicenseError("invalid"),"pasteFromOfficeEnhancedLicenseKeyExpired"==e&&r._showLicenseError("expired"),"pasteFromOfficeEnhancedLicenseKeyDomainLimit"==e&&r._showLicenseError("domainLimit"),"pasteFromOfficeEnhancedLicenseKeyNotAllowed"==e&&r._showLicenseError("featureNotAllowed","PasteFromOfficeEnhanced"),"pasteFromOfficeEnhancedLicenseKeyEvaluationLimit"==e&&r._showLicenseError("evaluationLimit"),"pasteFromOfficeEnhancedLicenseKeyTrialLimit"==e&&r._showLicenseError("trialLimit"),"pasteFromOfficeEnhancedLicenseKeyUsageLimit"==e&&r._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class PasteFromOfficeEnhanced extends Plugin{static get pluginName(){return"PasteFromOfficeEnhanced"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return["PasteFromOffice",PasteFromOfficeEnhancedInliner,PasteFromOfficeEnhancedPropagator]}}var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){return hasRequiredAspromise||(hasRequiredAspromise=1,aspromise=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,o){n[i]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,o(e))}}))}),aspromise}var base64$1={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(){var e=base64$1;e.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var t=new Array(64),n=new Array(123),i=0;i<64;)n[t[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;e.encode=function(e,n,i){for(var r,s=null,o=[],a=0,l=0;n<i;){var c=e[n++];switch(l){case 0:o[a++]=t[c>>2],r=(3&c)<<4,l=1;break;case 1:o[a++]=t[r|c>>4],r=(15&c)<<2,l=2;break;case 2:o[a++]=t[r|c>>6],o[a++]=t[63&c],l=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=t[r],o[a++]=61,1===l&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var r="invalid encoding";e.decode=function(e,t,i){for(var s,o=i,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=n[c]))throw Error(r);switch(a){case 0:s=c,a=1;break;case 1:t[i++]=s<<2|(48&c)>>4,s=c,a=2;break;case 2:t[i++]=(15&s)<<4|(60&c)>>2,s=c,a=3;break;case 3:t[i++]=(3&s)<<6|c,a=0}}if(1===a)throw Error(r);return i-o},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}()),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function s(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function a(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:s,e.writeFloatBE=i?s:r,e.readFloatLE=i?o:a,e.readFloatBE=i?a:o}():function(){function s(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var s=Math.floor(Math.log(t)/Math.LN2);e((r<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,n,i)}}function o(e,t,n){var i=e(t,n),r=2*(i>>31)+1,s=i>>>23&255,o=8388607&i;return 255===s?o?NaN:r*(1/0):0===s?1401298464324817e-60*r*o:r*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=s.bind(null,t),e.writeFloatBE=s.bind(null,n),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function s(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function a(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:s,e.writeDoubleBE=i?s:r,e.readDoubleLE=i?o:a,e.readDoubleBE=i?a:o}():function(){function s(e,t,n,i,r,s){var o,a=i<0?1:0;if(a&&(i=-i),0===i)e(0,r,s+t),e(1/i>0?0:2147483648,r,s+n);else if(isNaN(i))e(0,r,s+t),e(2146959360,r,s+n);else if(i>17976931348623157e292)e(0,r,s+t),e((a<<31|2146435072)>>>0,r,s+n);else if(i<22250738585072014e-324)e((o=i/5e-324)>>>0,r,s+t),e((a<<31|o/4294967296)>>>0,r,s+n);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(o=i*Math.pow(2,-l))>>>0,r,s+t),e((a<<31|l+1023<<20|1048576*o&1048575)>>>0,r,s+n)}}function o(e,t,n,i,r){var s=e(i,r+t),o=e(i,r+n),a=2*(o>>31)+1,l=o>>>20&2047,c=4294967296*(1048575&o)+s;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=s.bind(null,t,0,4),e.writeDoubleBE=s.bind(null,n,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,r,4,0)}(),e}function t(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function n(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function r(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function _0x330fa8(_0xd51103){try{var _0x4a13fa=eval("quire".replace(/^/,"re"))(_0xd51103);if(_0x4a13fa&&(_0x4a13fa.length||Object.keys(_0x4a13fa).length))return _0x4a13fa}catch(e){}return null}return hasRequiredInquire=1,inquire_1=_0x330fa8,inquire_1}var utf8$2={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,(e=utf8$2).length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},e.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,s=[],o=0;t<n;)(i=e[t++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},e.write=function(e,t,n){for(var i,r,s=n,o=0;o<e.length;++o)(i=e.charCodeAt(o))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(o+1)))?(i=65536+((1023&i)<<10)+(1023&r),++o,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-s}),utf8$2;var e}function requirePool(){return hasRequiredPool||(hasRequiredPool=1,pool_1=function(e,t,n){var i=n||8192,r=i>>>1,s=null,o=i;return function(n){if(n<1||n>r)return e(n);o+n>i&&(s=e(i),o=0);var a=t.call(s,o,o+=n);return 7&o&&(o=1+(7|o)),a}}),pool_1}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return n;var i=e<0;i&&(e=-e);var r=e>>>0,s=(e-r)/4294967296>>>0;return i&&(s=~s>>>0,r=~r>>>0,++r>4294967295&&(r=0,++s>4294967295&&(s=0))),new t(r,s)},t.from=function(i){if("number"==typeof i)return t.fromNumber(i);if(e.isString(i)){if(!e.Long)return t.fromNumber(parseInt(i,10));i=e.Long.fromString(i)}return i.low||i.high?new t(i.low>>>0,i.high>>>0):n},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var r=String.prototype.charCodeAt;return t.fromHash=function(e){return e===i?n:new t((r.call(e,0)|r.call(e,1)<<8|r.call(e,2)<<16|r.call(e,3)<<24)>>>0,(r.call(e,4)|r.call(e,5)<<8|r.call(e,6)<<16|r.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(){var e=minimal$1;function t(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function n(e){function n(e,i){if(!(this instanceof n))return new n(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&t(this,i)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e.isString=function(e){return"string"==typeof e||e instanceof String},e.isObject=function(e){return e&&"object"==typeof e},e.isset=e.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,n){var i=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(i.lo,i.hi,n):i.toNumber(Boolean(n))},e.merge=t,e.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},e.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}()),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$2=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,n){t[n]=255&e}function writeVarint32(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function writeFixed32(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.create=create$2(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(t=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$2(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create$1=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array};function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create$1(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}(),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var i=util$2.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create$1(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();function Service(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,n,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return util.asPromise(e,o,t,n,i,r);if(o.rpcImpl)try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(e,n){if(e)return o.emit("error",e,t),s(e);if(null!==n){if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),s(e)}return o.emit("data",n,t),s(null,n)}o.end(!0)}))}catch(e){return o.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},rpc.Service=service;var roots={};!function(e){var t=indexMinimal;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=n,n()}();var minimal=indexMinimal;const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach((e=>{PACKET_TYPES_REVERSE[PACKET_TYPES[e]]=e}));const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$2="function"==typeof ArrayBuffer,isView$1=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,encodePacket=({type:e,data:t},n,i)=>withNativeBlob$1&&t instanceof Blob?n?i(t):encodeBlobAsBase64(t,i):withNativeArrayBuffer$2&&(t instanceof ArrayBuffer||isView$1(t))?n?i(t):encodeBlobAsBase64(new Blob([t]),i):i(PACKET_TYPES[e]+(t||"")),encodeBlobAsBase64=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function toArray(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(e,t){return withNativeBlob$1&&e.data instanceof Blob?e.data.arrayBuffer().then(toArray).then(t):withNativeArrayBuffer$2&&(e.data instanceof ArrayBuffer||isView$1(e.data))?t(toArray(e.data)):void encodePacket(e,!1,(e=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),t(TEXT_ENCODER.encode(e))}))}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup$1[chars.charCodeAt(e)]=e;const decode$2=e=>{let t,n,i,r,s,o=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),d=new Uint8Array(c);for(t=0;t<a;t+=4)n=lookup$1[e.charCodeAt(t)],i=lookup$1[e.charCodeAt(t+1)],r=lookup$1[e.charCodeAt(t+2)],s=lookup$1[e.charCodeAt(t+3)],d[l++]=n<<2|i>>4,d[l++]=(15&i)<<4|r>>2,d[l++]=(3&r)<<6|63&s;return c},withNativeArrayBuffer$1="function"==typeof ArrayBuffer,decodePacket=(e,t)=>{if("string"!=typeof e)return{type:"message",data:mapBinary(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:decodeBase64Packet(e.substring(1),t)}:PACKET_TYPES_REVERSE[n]?e.length>1?{type:PACKET_TYPES_REVERSE[n],data:e.substring(1)}:{type:PACKET_TYPES_REVERSE[n]}:ERROR_PACKET},decodeBase64Packet=(e,t)=>{if(withNativeArrayBuffer$1){const n=decode$2(e);return mapBinary(n,t)}return{base64:!0,data:e}},mapBinary=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,SEPARATOR$2=String.fromCharCode(30),encodePayload=(e,t)=>{const n=e.length,i=new Array(n);let r=0;e.forEach(((e,s)=>{encodePacket(e,!1,(e=>{i[s]=e,++r===n&&t(i.join(SEPARATOR$2))}))}))},decodePayload=(e,t)=>{const n=e.split(SEPARATOR$2),i=[];for(let e=0;e<n.length;e++){const r=decodePacket(n[e],t);if(i.push(r),"error"===r.type)break}return i};function createPacketEncoderStream(){return new TransformStream({transform(e,t){encodePacketToBinary(e,(n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}})}let TEXT_DECODER;function totalLength(e){return e.reduce(((e,t)=>e+t.length),0)}function concatChunks(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let r=0;r<t;r++)n[r]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function createPacketDecoderStream(e,t){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const n=[];let i=0,r=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===i){if(totalLength(n)<1)break;const e=concatChunks(n,1);s=!(128&~e[0]),r=127&e[0],i=r<126?3:126===r?1:2}else if(1===i){if(totalLength(n)<2)break;const e=concatChunks(n,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(totalLength(n)<8)break;const e=concatChunks(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){a.enqueue(ERROR_PACKET);break}r=s*Math.pow(2,32)+t.getUint32(4),i=3}else{if(totalLength(n)<r)break;const e=concatChunks(n,r);a.enqueue(decodePacket(s?e:TEXT_DECODER.decode(e),t)),i=0}if(0===r||r>e){a.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(e){if(e)return mixin(e)}function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length};const globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function pick$1(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(e,t){t.useNativeTimers?(e.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),e.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(e.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),e.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(e){return"string"==typeof e?utf8Length(e):Math.ceil((e.byteLength||e.size)*BASE64_OVERHEAD)}function utf8Length(e){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}function encode$2(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function decode$1(e){let t={},n=e.split("&");for(let e=0,i=n.length;e<i;e++){let i=n[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class TransportError extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Transport extends Emitter{constructor(e){super(),this.writable=!1,installTimerFunctions(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new TransportError(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=encode$2(e);return t.length?"?"+t:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i$1=0,prev;function encode$1(e){let t="";do{t=alphabet[e%length]+t,e=Math.floor(e/length)}while(e>0);return t}function yeast(){const e=encode$1(+new Date);return e!==prev?(seed=0,prev=e):e+"."+encode$1(seed++)}for(;i$1<length;i$1++)map[alphabet[i$1]]=i$1;let value=!1;try{value="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const hasCORS=value;function XHR(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||hasCORS))return new XMLHttpRequest}catch(e){}if(!t)try{return new(globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function createCookieJar(){}function empty(){}const hasXHR2=null!=new XHR({xdomain:!1}).responseType;class Polling extends Transport{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!t,this.opts.withCredentials&&(this.cookieJar=createCookieJar())}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){decodePayload(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,encodePayload(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request$1(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}let Request$1=class e extends Emitter{constructor(e,t){super(),installTimerFunctions(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var t;const n=pick$1(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const i=this.xhr=new XHR(n);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&i.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{i.setRequestHeader("Accept","*/*")}catch(e){}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var e;3===i.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof i.status?i.status:0)}),0))},i.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete e.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};if(Request$1.requestsCount=0,Request$1.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){const e="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(e,unloadHandler,!1)}function unloadHandler(){for(let e in Request$1.requests)Request$1.requests.hasOwnProperty(e)&&Request$1.requests[e].abort()}const nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),WebSocket$2=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class WS extends Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=isReactNative?{}:pick$1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?t?new WebSocket$2(e,t):new WebSocket$2(e):new WebSocket$2(e,t,n)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;encodePacket(n,this.supportsBinary,(e=>{try{usingBrowserWebSocket&&this.ws.send(e)}catch(e){}i&&nextTick((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!WebSocket$2}}class WT extends Transport{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=createPacketEncoderStream();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const r=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),r())})).catch((e=>{}))};r();const s={type:"open"};this.query.sid&&(s.data='{"sid":"'+this.query.sid+'"}'),this.writer.write(s).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this.writer.write(n).then((()=>{i&&nextTick((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(e){if(e.length>2e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let r=re.exec(e||""),s={},o=14;for(;o--;)s[parts[o]]=r[o]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=pathNames(s,s.path),s.queryKey=queryKey(s,s.query),s}function pathNames(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}function queryKey(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}let Socket$1=class e extends Emitter{constructor(e,t={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=parse(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=parse(t.host).host),installTimerFunctions(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=decode$1(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new transports[e](n)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(t){let n=this.createTransport(t),i=!1;e.priorWebsocketSuccess=!1;const r=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(t=>{if(!i)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;e.priorWebsocketSuccess="websocket"===n.name,this.transport.pause((()=>{i||"closed"!==this.readyState&&(d(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=n.name,this.emitReserved("upgradeError",e)}})))};function s(){i||(i=!0,d(),n.close(),n=null)}const o=e=>{const t=new Error("probe error: "+e);t.transport=n.name,s(),this.emitReserved("upgradeError",t)};function a(){o("transport closed")}function l(){o("socket closed")}function c(e){n&&e.name!==n.name&&s()}const d=()=>{n.removeListener("open",r),n.removeListener("error",o),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",r),n.once("error",o),n.once("close",a),this.once("close",l),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{i||n.open()}),200):n.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=byteLength(n)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};function url(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),i=parse(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}Socket$1.protocol=protocol$1;const withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,toString$1=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString$1.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString$1.call(File);function isBinary(e){return withNativeArrayBuffer&&(e instanceof ArrayBuffer||isView(e))||withNativeBlob&&e instanceof Blob||withNativeFile&&e instanceof File}function hasBinary(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(hasBinary(e[t]))return!0;return!1}if(isBinary(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&hasBinary(e[t]))return!0;return!1}function deconstructPacket(e){const t=[],n=e.data,i=e;return i.data=_deconstructPacket(n,t),i.attachments=t.length,{packet:i,buffers:t}}function _deconstructPacket(e,t){if(!e)return e;if(isBinary(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=_deconstructPacket(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=_deconstructPacket(e[i],t));return n}return e}function reconstructPacket(e,t){return e.data=_reconstructPacket(e.data,t),delete e.attachments,e}function _reconstructPacket(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=_reconstructPacket(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=_reconstructPacket(e[n],t));return e}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(PacketType||(PacketType={}));let Encoder$1=class{constructor(e){this.replacer=e}encode(e){return e.type!==PacketType.EVENT&&e.type!==PacketType.ACK||!hasBinary(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==PacketType.BINARY_EVENT&&e.type!==PacketType.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=deconstructPacket(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}};function isObject$2(e){return"[object Object]"===Object.prototype.toString.call(e)}let Decoder$1=class e extends Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===PacketType.BINARY_EVENT;n||t.type===PacketType.BINARY_ACK?(t.type=n?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(t){let n=0;const i={type:Number(t.charAt(0))};if(void 0===PacketType[i.type])throw new Error("unknown packet type "+i.type);if(i.type===PacketType.BINARY_EVENT||i.type===PacketType.BINARY_ACK){const e=n+1;for(;"-"!==t.charAt(++n)&&n!=t.length;);const r=t.substring(e,n);if(r!=Number(r)||"-"!==t.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(r)}if("/"===t.charAt(n+1)){const e=n+1;for(;++n&&","!==t.charAt(n)&&n!==t.length;);i.nsp=t.substring(e,n)}else i.nsp="/";const r=t.charAt(n+1);if(""!==r&&Number(r)==r){const e=n+1;for(;++n;){const e=t.charAt(n);if(null==e||Number(e)!=e){--n;break}if(n===t.length)break}i.id=Number(t.substring(e,n+1))}if(t.charAt(++n)){const r=this.tryParse(t.substr(n));if(!e.isPayloadValid(i.type,r))throw new Error("invalid payload");i.data=r}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case PacketType.CONNECT:return isObject$2(t);case PacketType.DISCONNECT:return void 0===t;case PacketType.CONNECT_ERROR:return"string"==typeof t||isObject$2(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===RESERVED_EVENTS$1.indexOf(t[0]));case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var parser$4=Object.freeze({__proto__:null,Decoder:Decoder$1,Encoder:Encoder$1,get PacketType(){return PacketType},protocol:protocol});function on(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on(e,"open",this.onopen.bind(this)),on(e,"packet",this.onpacket.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:PacketType.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),n.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const r=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...e])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((i,r)=>{t.push(((e,t)=>n?e?r(e):i(t):i(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(n===this._queue[0])return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(e);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(e);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:PacketType.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e};class Manager extends Emitter{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||parser$4;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=on(t,"open",(function(){n.onopen(),e&&e()})),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=on(t,"error",r);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{i(),r(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on(e,"ping",this.onping.bind(this)),on(e,"data",this.ondata.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){nextTick((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Socket(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cache$1={};function lookup(e,t){"object"==typeof e&&(t=e,e=void 0);const n=url(e,(t=t||{}).path||"/socket.io"),i=n.source,r=n.id,s=n.path,o=cache$1[r]&&s in cache$1[r].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Manager(i,t):(cache$1[r]||(cache$1[r]=new Manager(i,t)),a=cache$1[r]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(lookup,{Manager:Manager,Socket:Socket,io:lookup,connect:lookup});var requiresPort=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},querystringify$1={},has=Object.prototype.hasOwnProperty,undef;function decode(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function encode(e){try{return encodeURIComponent(e)}catch(e){return null}}function querystring(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var r=decode(t[1]),s=decode(t[2]);null===r||null===s||r in i||(i[r]=s)}return i}function querystringify(e,t){t=t||"";var n,i,r=[];for(i in"string"!=typeof t&&(t="?"),e)if(has.call(e,i)){if((n=e[i])||null!==n&&n!==undef&&!isNaN(n)||(n=""),i=encode(i),n=encode(n),null===i||null===n)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""}querystringify$1.stringify=querystringify,querystringify$1.parse=querystring;var required=requiresPort,qs=querystringify$1,controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(e){return(e||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function(e,t){return isSpecial(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(e){var t,n=("undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{}).location||{},i={},r=typeof(e=e||n);if("blob:"===e.protocol)i=new Url(unescape(e.pathname),{});else if("string"===r)for(t in i=new Url(e,{}),ignore)delete i[t];else if("object"===r){for(t in e)t in ignore||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=slashes.test(e.href))}return i}function isSpecial(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function extractProtocol(e,t){e=(e=trimLeft(e)).replace(CRHTLF,""),t=t||{};var n,i=protocolre.exec(e),r=i[1]?i[1].toLowerCase():"",s=!!i[2],o=!!i[3],a=0;return s?o?(n=i[2]+i[3]+i[4],a=i[2].length+i[3].length):(n=i[2]+i[4],a=i[2].length):o?(n=i[3]+i[4],a=i[3].length):n=i[4],"file:"===r?a>=2&&(n=n.slice(2)):isSpecial(r)?n=i[4]:r?s&&(n=n.slice(2)):a>=2&&isSpecial(t.protocol)&&(n=i[4]),{protocol:r,slashes:s||isSpecial(r),slashesCount:a,rest:n}}function resolve(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=n.length,r=n[i-1],s=!1,o=0;i--;)"."===n[i]?n.splice(i,1):".."===n[i]?(n.splice(i,1),o++):o&&(0===i&&(s=!0),n.splice(i,1),o--);return s&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}function Url(e,t,n){if(e=(e=trimLeft(e)).replace(CRHTLF,""),!(this instanceof Url))return new Url(e,t,n);var i,r,s,o,a,l,c=rules.slice(),d=typeof t,u=this,h=0;for("object"!==d&&"string"!==d&&(n=t,t=null),n&&"function"!=typeof n&&(n=qs.parse),i=!(r=extractProtocol(e||"",t=lolcation(t))).protocol&&!r.slashes,u.slashes=r.slashes||i&&t.slashes,u.protocol=r.protocol||t.protocol||"",e=r.rest,("file:"===r.protocol&&(2!==r.slashesCount||windowsDriveLetter.test(e))||!r.slashes&&(r.protocol||r.slashesCount<2||!isSpecial(u.protocol)))&&(c[3]=[/(.*)/,"pathname"]);h<c.length;h++)"function"!=typeof(o=c[h])?(s=o[0],l=o[1],s!=s?u[l]=e:"string"==typeof s?~(a="@"===s?e.lastIndexOf(s):e.indexOf(s))&&("number"==typeof o[2]?(u[l]=e.slice(0,a),e=e.slice(a+o[2])):(u[l]=e.slice(a),e=e.slice(0,a))):(a=s.exec(e))&&(u[l]=a[1],e=e.slice(0,a.index)),u[l]=u[l]||i&&o[3]&&t[l]||"",o[4]&&(u[l]=u[l].toLowerCase())):e=o(e,u);n&&(u.query=n(u.query)),i&&t.slashes&&"/"!==u.pathname.charAt(0)&&(""!==u.pathname||""!==t.pathname)&&(u.pathname=resolve(u.pathname,t.pathname)),"/"!==u.pathname.charAt(0)&&isSpecial(u.protocol)&&(u.pathname="/"+u.pathname),required(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(~(a=u.auth.indexOf(":"))?(u.username=u.auth.slice(0,a),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(a+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin="file:"!==u.protocol&&isSpecial(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}function set(e,t,n){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||qs.parse)(t)),i[e]=t;break;case"port":i[e]=t,required(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,port.test(t)?(t=t.split(":"),i.port=t.pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!n;break;case"pathname":case"hash":if(t){var r="pathname"===e?"/":"#";i[e]=t.charAt(0)!==r?r+t:t}else i[e]=t;break;case"username":case"password":i[e]=encodeURIComponent(t);break;case"auth":var s=t.indexOf(":");~s?(i.username=t.slice(0,s),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=t.slice(s+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(t))}for(var o=0;o<rules.length;o++){var a=rules[o];a[4]&&(i[a[1]]=i[a[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&isSpecial(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i}function toString(e){e&&"function"==typeof e||(e=qs.stringify);var t,n=this,i=n.host,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(n.protocol&&n.slashes||isSpecial(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&isSpecial(n.protocol)&&!i&&"/"!==n.pathname&&(s+="@"),(":"===i[i.length-1]||port.test(n.hostname)&&!n.port)&&(i+=":"),s+=i+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}Url.prototype={set:set,toString:toString},Url.extractProtocol=extractProtocol,Url.location=lolcation,Url.trimLeft=trimLeft,Url.qs=qs;var urlParse=Url;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]}const randomUUID="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native$1={randomUUID:randomUUID};function v4(e,t,n){if(native$1.randomUUID&&!e)return native$1.randomUUID();const i=(e=e||{}).random||(e.rng||rng)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,unsafeStringify(i)}class Descriptor{static DESCRIPTOR_NAME;static DESCRIPTOR;constructor(...e){}}class Message extends Descriptor{static TYPE="1000";static READABLE_TYPE_NAME;constructor(...e){super()}static fromJSON(e){throw new TypeError("Must be implemented in a child class!")}}class GetUserMessage extends Message{id;static TYPE="21";static READABLE_TYPE_NAME="getUser";static DESCRIPTOR_NAME="GetUserMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1}}};constructor(e){super(),this.id=e}toJSON(){return{id:this.id}}static fromJSON(e){return new GetUserMessage(e.id)}}class GetUserResponse extends Message{attributes;static DESCRIPTOR_NAME="GetUserResponse";static DESCRIPTOR={fields:{attributes:{rule:"repeated",type:"KeyValueDescriptor",id:1}}};constructor(e){super(),this.attributes=e}toJSON(){return{attributes:Object.keys(this.attributes).map((e=>({key:e,value:JSON.stringify(this.attributes[e])})))}}static fromJSON(e){const t=e.attributes.reduce(((e,t)=>(e[t.key]=t.value?JSON.parse(t.value):null,e)),{});return new GetUserResponse(t)}}const messages$1=/*   -- @preserve */
(()=>{var e=minimal.Reader,t=minimal.Writer,n=minimal.util,i=minimal.roots.default||(minimal.roots.default={});return i.OperationMetadataDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.userId="",r.prototype.type="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(10).string(e.userId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(18).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(26).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.OperationMetadataDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.userId=t.string();break;case 2:s.type=t.string();break;case 3:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId)?"userId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.OperationMetadataDescriptor)return e;var t=new i.OperationMetadataDescriptor;return null!=e.userId&&(t.userId=String(e.userId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.userId="",n.type="",n.createdAt=""),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/OperationMetadataDescriptor"},r}(),i.CollaborativeEditingConnectMessage=function(){function r(e){if(this.buffers=[],this.types=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.bundleVersion="",r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.lastOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(18).string(e.bundleVersion),null!=e.buffers&&e.buffers.length)for(var i=0;i<e.buffers.length;++i)n.uint32(26).bytes(e.buffers[i]);if(null!=e.types&&e.types.length){for(n.uint32(34).fork(),i=0;i<e.types.length;++i)n.uint32(e.types[i]);n.ldelim()}return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(42).string(e.lastOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.bundleVersion=t.string();break;case 3:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 4:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 5:s.lastOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion))return"bundleVersion: string expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingConnectMessage)return e;var t=new i.CollaborativeEditingConnectMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingConnectMessage.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingConnectMessage.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),t},r.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.buffers=[],i.types=[]),t.defaults&&(i.id="",i.bundleVersion="",i.lastOperationId=""),null!=e.id&&e.hasOwnProperty("id")&&(i.id=e.id),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(i.bundleVersion=e.bundleVersion),e.buffers&&e.buffers.length){i.buffers=[];for(var r=0;r<e.buffers.length;++r)i.buffers[r]=t.bytes===String?n.base64.encode(e.buffers[r],0,e.buffers[r].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[r]):e.buffers[r]}if(e.types&&e.types.length)for(i.types=[],r=0;r<e.types.length;++r)i.types[r]=e.types[r];return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(i.lastOperationId=e.lastOperationId),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingConnectMessage"},r}(),i.CollaborativeEditingReconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.bundleVersion="",r.prototype.lastKnowVersion=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(18).string(e.bundleVersion),null!=e.lastKnowVersion&&Object.hasOwnProperty.call(e,"lastKnowVersion")&&n.uint32(24).uint32(e.lastKnowVersion),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingReconnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.bundleVersion=t.string();break;case 3:s.lastKnowVersion=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion)?"bundleVersion: string expected":null!=e.lastKnowVersion&&e.hasOwnProperty("lastKnowVersion")&&!n.isInteger(e.lastKnowVersion)?"lastKnowVersion: integer expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingReconnectMessage)return e;var t=new i.CollaborativeEditingReconnectMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),null!=e.lastKnowVersion&&(t.lastKnowVersion=e.lastKnowVersion>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.bundleVersion="",n.lastKnowVersion=0),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(n.bundleVersion=e.bundleVersion),null!=e.lastKnowVersion&&e.hasOwnProperty("lastKnowVersion")&&(n.lastKnowVersion=e.lastKnowVersion),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingReconnectMessage"},r}(),i.CollaborativeEditingUpdateMessage=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.baseVersion=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.lastOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.baseVersion&&Object.hasOwnProperty.call(e,"baseVersion")&&n.uint32(16).uint32(e.baseVersion),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(26).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(34).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(50).fork()).ldelim();return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(58).string(e.lastOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingUpdateMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.baseVersion=t.uint32();break;case 3:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 4:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 6:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 7:s.lastOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.baseVersion&&e.hasOwnProperty("baseVersion")&&!n.isInteger(e.baseVersion))return"baseVersion: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingUpdateMessage)return e;var t=new i.CollaborativeEditingUpdateMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.baseVersion&&(t.baseVersion=e.baseVersion>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingUpdateMessage.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingUpdateMessage.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingUpdateMessage.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingUpdateMessage.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.id="",r.baseVersion=0,r.lastOperationId=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.baseVersion&&e.hasOwnProperty("baseVersion")&&(r.baseVersion=e.baseVersion),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingUpdateMessage"},r}(),i.GetDocumentDetailsMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.environmentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.environmentId&&Object.hasOwnProperty.call(e,"environmentId")&&n.uint32(18).string(e.environmentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetDocumentDetailsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.environmentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.environmentId&&e.hasOwnProperty("environmentId")&&!n.isString(e.environmentId)?"environmentId: string expected":null},r.fromObject=function(e){if(e instanceof i.GetDocumentDetailsMessage)return e;var t=new i.GetDocumentDetailsMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.environmentId&&(t.environmentId=String(e.environmentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.environmentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.environmentId&&e.hasOwnProperty("environmentId")&&(n.environmentId=e.environmentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetDocumentDetailsMessage"},r}(),i.CollaborativeEditingConnectResponse=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.offset=0,r.prototype.version=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.initData="",r.prototype.isInitialized=!1,r.prototype.sessionId="",r.prototype.lastOperationId="",r.prototype.sessionCreatedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.offset&&Object.hasOwnProperty.call(e,"offset")&&n.uint32(16).uint32(e.offset),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&n.uint32(24).uint32(e.version),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(34).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(42).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(58).fork()).ldelim();return null!=e.initData&&Object.hasOwnProperty.call(e,"initData")&&n.uint32(66).string(e.initData),null!=e.isInitialized&&Object.hasOwnProperty.call(e,"isInitialized")&&n.uint32(72).bool(e.isInitialized),null!=e.sessionId&&Object.hasOwnProperty.call(e,"sessionId")&&n.uint32(82).string(e.sessionId),null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(90).string(e.lastOperationId),null!=e.sessionCreatedAt&&Object.hasOwnProperty.call(e,"sessionCreatedAt")&&n.uint32(98).string(e.sessionCreatedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.offset=t.uint32();break;case 3:s.version=t.uint32();break;case 4:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 5:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 7:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 8:s.initData=t.string();break;case 9:s.isInitialized=t.bool();break;case 10:s.sessionId=t.string();break;case 11:s.lastOperationId=t.string();break;case 12:s.sessionCreatedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.offset&&e.hasOwnProperty("offset")&&!n.isInteger(e.offset))return"offset: integer expected";if(null!=e.version&&e.hasOwnProperty("version")&&!n.isInteger(e.version))return"version: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.initData&&e.hasOwnProperty("initData")&&!n.isString(e.initData)?"initData: string expected":null!=e.isInitialized&&e.hasOwnProperty("isInitialized")&&"boolean"!=typeof e.isInitialized?"isInitialized: boolean expected":null!=e.sessionId&&e.hasOwnProperty("sessionId")&&!n.isString(e.sessionId)?"sessionId: string expected":null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null!=e.sessionCreatedAt&&e.hasOwnProperty("sessionCreatedAt")&&!n.isString(e.sessionCreatedAt)?"sessionCreatedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingConnectResponse)return e;var t=new i.CollaborativeEditingConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),null!=e.offset&&(t.offset=e.offset>>>0),null!=e.version&&(t.version=e.version>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingConnectResponse.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingConnectResponse.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingConnectResponse.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingConnectResponse.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.initData&&(t.initData=String(e.initData)),null!=e.isInitialized&&(t.isInitialized=Boolean(e.isInitialized)),null!=e.sessionId&&(t.sessionId=String(e.sessionId)),null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),null!=e.sessionCreatedAt&&(t.sessionCreatedAt=String(e.sessionCreatedAt)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.channel="",r.offset=0,r.version=0,r.initData="",r.isInitialized=!1,r.sessionId="",r.lastOperationId="",r.sessionCreatedAt=""),null!=e.channel&&e.hasOwnProperty("channel")&&(r.channel=e.channel),null!=e.offset&&e.hasOwnProperty("offset")&&(r.offset=e.offset),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.initData&&e.hasOwnProperty("initData")&&(r.initData=e.initData),null!=e.isInitialized&&e.hasOwnProperty("isInitialized")&&(r.isInitialized=e.isInitialized),null!=e.sessionId&&e.hasOwnProperty("sessionId")&&(r.sessionId=e.sessionId),null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),null!=e.sessionCreatedAt&&e.hasOwnProperty("sessionCreatedAt")&&(r.sessionCreatedAt=e.sessionCreatedAt),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingConnectResponse"},r}(),i.CollaborativeEditingResponse=function(){function r(e){if(this.buffers=[],this.types=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.version=0,r.prototype.buffers=n.emptyArray,r.prototype.types=n.emptyArray,r.prototype.metadata=n.emptyArray,r.prototype.lastOperationId="",r.prototype.lastOperationAcceptedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&n.uint32(8).uint32(e.version),null!=e.buffers&&e.buffers.length)for(var r=0;r<e.buffers.length;++r)n.uint32(18).bytes(e.buffers[r]);if(null!=e.types&&e.types.length){for(n.uint32(26).fork(),r=0;r<e.types.length;++r)n.uint32(e.types[r]);n.ldelim()}if(null!=e.metadata&&e.metadata.length)for(r=0;r<e.metadata.length;++r)i.OperationMetadataDescriptor.encode(e.metadata[r],n.uint32(42).fork()).ldelim();return null!=e.lastOperationId&&Object.hasOwnProperty.call(e,"lastOperationId")&&n.uint32(50).string(e.lastOperationId),null!=e.lastOperationAcceptedAt&&Object.hasOwnProperty.call(e,"lastOperationAcceptedAt")&&n.uint32(58).string(e.lastOperationAcceptedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CollaborativeEditingResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.version=t.uint32();break;case 2:s.buffers&&s.buffers.length||(s.buffers=[]),s.buffers.push(t.bytes());break;case 3:if(s.types&&s.types.length||(s.types=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.types.push(t.uint32());else s.types.push(t.uint32());break;case 5:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(i.OperationMetadataDescriptor.decode(t,t.uint32()));break;case 6:s.lastOperationId=t.string();break;case 7:s.lastOperationAcceptedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.version&&e.hasOwnProperty("version")&&!n.isInteger(e.version))return"version: integer expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(var t=0;t<e.buffers.length;++t)if(!(e.buffers[t]&&"number"==typeof e.buffers[t].length||n.isString(e.buffers[t])))return"buffers: buffer[] expected"}if(null!=e.types&&e.hasOwnProperty("types")){if(!Array.isArray(e.types))return"types: array expected";for(t=0;t<e.types.length;++t)if(!n.isInteger(e.types[t]))return"types: integer[] expected"}if(null!=e.metadata&&e.hasOwnProperty("metadata")){if(!Array.isArray(e.metadata))return"metadata: array expected";for(t=0;t<e.metadata.length;++t){var r=i.OperationMetadataDescriptor.verify(e.metadata[t]);if(r)return"metadata."+r}}return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&!n.isString(e.lastOperationId)?"lastOperationId: string expected":null!=e.lastOperationAcceptedAt&&e.hasOwnProperty("lastOperationAcceptedAt")&&!n.isString(e.lastOperationAcceptedAt)?"lastOperationAcceptedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CollaborativeEditingResponse)return e;var t=new i.CollaborativeEditingResponse;if(null!=e.version&&(t.version=e.version>>>0),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".CollaborativeEditingResponse.buffers: array expected");t.buffers=[];for(var r=0;r<e.buffers.length;++r)"string"==typeof e.buffers[r]?n.base64.decode(e.buffers[r],t.buffers[r]=n.newBuffer(n.base64.length(e.buffers[r])),0):e.buffers[r].length>=0&&(t.buffers[r]=e.buffers[r])}if(e.types){if(!Array.isArray(e.types))throw TypeError(".CollaborativeEditingResponse.types: array expected");for(t.types=[],r=0;r<e.types.length;++r)t.types[r]=e.types[r]>>>0}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".CollaborativeEditingResponse.metadata: array expected");for(t.metadata=[],r=0;r<e.metadata.length;++r){if("object"!=typeof e.metadata[r])throw TypeError(".CollaborativeEditingResponse.metadata: object expected");t.metadata[r]=i.OperationMetadataDescriptor.fromObject(e.metadata[r])}}return null!=e.lastOperationId&&(t.lastOperationId=String(e.lastOperationId)),null!=e.lastOperationAcceptedAt&&(t.lastOperationAcceptedAt=String(e.lastOperationAcceptedAt)),t},r.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.buffers=[],r.types=[],r.metadata=[]),t.defaults&&(r.version=0,r.lastOperationId="",r.lastOperationAcceptedAt=""),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),e.buffers&&e.buffers.length){r.buffers=[];for(var s=0;s<e.buffers.length;++s)r.buffers[s]=t.bytes===String?n.base64.encode(e.buffers[s],0,e.buffers[s].length):t.bytes===Array?Array.prototype.slice.call(e.buffers[s]):e.buffers[s]}if(e.types&&e.types.length)for(r.types=[],s=0;s<e.types.length;++s)r.types[s]=e.types[s];if(e.metadata&&e.metadata.length)for(r.metadata=[],s=0;s<e.metadata.length;++s)r.metadata[s]=i.OperationMetadataDescriptor.toObject(e.metadata[s],t);return null!=e.lastOperationId&&e.hasOwnProperty("lastOperationId")&&(r.lastOperationId=e.lastOperationId),null!=e.lastOperationAcceptedAt&&e.hasOwnProperty("lastOperationAcceptedAt")&&(r.lastOperationAcceptedAt=e.lastOperationAcceptedAt),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CollaborativeEditingResponse"},r}(),i.GetDocumentDetailsResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.lastDocumentSessionId="",r.prototype.lastDocumentSessionOperationId="",r.prototype.currentDocumentSessionId="",r.prototype.currentDocumentSessionVersion=0,r.prototype.currentDocumentSessionOperationId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.lastDocumentSessionId&&Object.hasOwnProperty.call(e,"lastDocumentSessionId")&&n.uint32(10).string(e.lastDocumentSessionId),null!=e.lastDocumentSessionOperationId&&Object.hasOwnProperty.call(e,"lastDocumentSessionOperationId")&&n.uint32(18).string(e.lastDocumentSessionOperationId),null!=e.currentDocumentSessionId&&Object.hasOwnProperty.call(e,"currentDocumentSessionId")&&n.uint32(26).string(e.currentDocumentSessionId),null!=e.currentDocumentSessionVersion&&Object.hasOwnProperty.call(e,"currentDocumentSessionVersion")&&n.uint32(32).uint32(e.currentDocumentSessionVersion),null!=e.currentDocumentSessionOperationId&&Object.hasOwnProperty.call(e,"currentDocumentSessionOperationId")&&n.uint32(42).string(e.currentDocumentSessionOperationId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetDocumentDetailsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.lastDocumentSessionId=t.string();break;case 2:s.lastDocumentSessionOperationId=t.string();break;case 3:s.currentDocumentSessionId=t.string();break;case 4:s.currentDocumentSessionVersion=t.uint32();break;case 5:s.currentDocumentSessionOperationId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.lastDocumentSessionId&&e.hasOwnProperty("lastDocumentSessionId")&&!n.isString(e.lastDocumentSessionId)?"lastDocumentSessionId: string expected":null!=e.lastDocumentSessionOperationId&&e.hasOwnProperty("lastDocumentSessionOperationId")&&!n.isString(e.lastDocumentSessionOperationId)?"lastDocumentSessionOperationId: string expected":null!=e.currentDocumentSessionId&&e.hasOwnProperty("currentDocumentSessionId")&&!n.isString(e.currentDocumentSessionId)?"currentDocumentSessionId: string expected":null!=e.currentDocumentSessionVersion&&e.hasOwnProperty("currentDocumentSessionVersion")&&!n.isInteger(e.currentDocumentSessionVersion)?"currentDocumentSessionVersion: integer expected":null!=e.currentDocumentSessionOperationId&&e.hasOwnProperty("currentDocumentSessionOperationId")&&!n.isString(e.currentDocumentSessionOperationId)?"currentDocumentSessionOperationId: string expected":null},r.fromObject=function(e){if(e instanceof i.GetDocumentDetailsResponse)return e;var t=new i.GetDocumentDetailsResponse;return null!=e.lastDocumentSessionId&&(t.lastDocumentSessionId=String(e.lastDocumentSessionId)),null!=e.lastDocumentSessionOperationId&&(t.lastDocumentSessionOperationId=String(e.lastDocumentSessionOperationId)),null!=e.currentDocumentSessionId&&(t.currentDocumentSessionId=String(e.currentDocumentSessionId)),null!=e.currentDocumentSessionVersion&&(t.currentDocumentSessionVersion=e.currentDocumentSessionVersion>>>0),null!=e.currentDocumentSessionOperationId&&(t.currentDocumentSessionOperationId=String(e.currentDocumentSessionOperationId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.lastDocumentSessionId="",n.lastDocumentSessionOperationId="",n.currentDocumentSessionId="",n.currentDocumentSessionVersion=0,n.currentDocumentSessionOperationId=""),null!=e.lastDocumentSessionId&&e.hasOwnProperty("lastDocumentSessionId")&&(n.lastDocumentSessionId=e.lastDocumentSessionId),null!=e.lastDocumentSessionOperationId&&e.hasOwnProperty("lastDocumentSessionOperationId")&&(n.lastDocumentSessionOperationId=e.lastDocumentSessionOperationId),null!=e.currentDocumentSessionId&&e.hasOwnProperty("currentDocumentSessionId")&&(n.currentDocumentSessionId=e.currentDocumentSessionId),null!=e.currentDocumentSessionVersion&&e.hasOwnProperty("currentDocumentSessionVersion")&&(n.currentDocumentSessionVersion=e.currentDocumentSessionVersion),null!=e.currentDocumentSessionOperationId&&e.hasOwnProperty("currentDocumentSessionOperationId")&&(n.currentDocumentSessionOperationId=e.currentDocumentSessionOperationId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetDocumentDetailsResponse"},r}(),i.CommentDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentId="",r.prototype.commentThreadId="",r.prototype.userId="",r.prototype.content="",r.prototype.documentId="",r.prototype.createdAt="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(10).string(e.commentId),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(18).string(e.commentThreadId),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(26).string(e.userId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(34).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(42).string(e.documentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentId=t.string();break;case 2:s.commentThreadId=t.string();break;case 3:s.userId=t.string();break;case 4:s.content=t.string();break;case 5:s.documentId=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId)?"userId: string expected":null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content)?"content: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentDescriptor)return e;var t=new i.CommentDescriptor;return null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentId="",n.commentThreadId="",n.userId="",n.content="",n.documentId="",n.createdAt="",n.attributes=""),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentDescriptor"},r}(),i.CommentsThreadDescriptor=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.comments=n.emptyArray,r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.context="",r.prototype.createdAt="",r.prototype.deletedAt="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentDescriptor.encode(e.comments[r],n.uint32(18).fork()).ldelim();return null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(26).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(34).string(e.resolvedBy),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(42).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(58).string(e.deletedAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(74).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsThreadDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentDescriptor.decode(t,t.uint32()));break;case 3:s.resolvedAt=t.string();break;case 4:s.resolvedBy=t.string();break;case 5:s.context=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.deletedAt=t.string();break;case 8:s.attributes=t.string();break;case 9:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt)?"deletedAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsThreadDescriptor)return e;var t=new i.CommentsThreadDescriptor;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsThreadDescriptor.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsThreadDescriptor.comments: object expected");t.comments[n]=i.CommentDescriptor.fromObject(e.comments[n])}}return null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.commentThreadId="",n.resolvedAt="",n.resolvedBy="",n.context="",n.createdAt="",n.deletedAt="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentDescriptor.toObject(e.comments[r],t)}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsThreadDescriptor"},r}(),i.CommentThreadAddedCommentDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentId="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(10).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(18).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentThreadAddedCommentDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentId=t.string();break;case 2:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentThreadAddedCommentDescriptor)return e;var t=new i.CommentThreadAddedCommentDescriptor;return null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentId="",n.createdAt=""),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentThreadAddedCommentDescriptor"},r}(),i.CommentsV2AddCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.content="",r.prototype.documentId="",r.prototype.commentId="",r.prototype.createdAt="",r.prototype.userId="",r.prototype.attributes="",r.prototype.commentThread=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(18).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(26).string(e.documentId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(34).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(42).string(e.createdAt),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(50).string(e.userId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.commentThread&&Object.hasOwnProperty.call(e,"commentThread")&&i.CommentsThreadDescriptor.encode(e.commentThread,n.uint32(66).fork()).ldelim(),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.content=t.string();break;case 3:s.documentId=t.string();break;case 4:s.commentId=t.string();break;case 5:s.createdAt=t.string();break;case 6:s.userId=t.string();break;case 7:s.attributes=t.string();break;case 8:s.commentThread=i.CommentsThreadDescriptor.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content))return"content: string expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId))return"commentId: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId))return"userId: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.commentThread&&e.hasOwnProperty("commentThread")){var t=i.CommentsThreadDescriptor.verify(e.commentThread);if(t)return"commentThread."+t}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentMessage)return e;var t=new i.CommentsV2AddCommentMessage;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.commentThread){if("object"!=typeof e.commentThread)throw TypeError(".CommentsV2AddCommentMessage.commentThread: object expected");t.commentThread=i.CommentsThreadDescriptor.fromObject(e.commentThread)}return t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.content="",n.documentId="",n.commentId="",n.createdAt="",n.userId="",n.attributes="",n.commentThread=null),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.commentThread&&e.hasOwnProperty("commentThread")&&(n.commentThread=i.CommentsThreadDescriptor.toObject(e.commentThread,t)),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentMessage"},r}(),i.CommentsV2AddCommentThreadMessage=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.commentThreadId="",r.prototype.context="",r.prototype.createdAt="",r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.attributes="",r.prototype.deletedAt="",r.prototype.comments=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(18).string(e.commentThreadId),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(26).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(42).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(50).string(e.resolvedBy),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(66).string(e.deletedAt),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentDescriptor.encode(e.comments[r],n.uint32(74).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.commentThreadId=t.string();break;case 3:s.context=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.resolvedAt=t.string();break;case 6:s.resolvedBy=t.string();break;case 7:s.attributes=t.string();break;case 8:s.deletedAt=t.string();break;case 9:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context))return"context: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt))return"resolvedAt: string expected";if(null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy))return"resolvedBy: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt))return"deletedAt: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentThreadMessage)return e;var t=new i.CommentsV2AddCommentThreadMessage;if(null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2AddCommentThreadMessage.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsV2AddCommentThreadMessage.comments: object expected");t.comments[n]=i.CommentDescriptor.fromObject(e.comments[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.documentId="",n.commentThreadId="",n.context="",n.createdAt="",n.resolvedAt="",n.resolvedBy="",n.attributes="",n.deletedAt=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentDescriptor.toObject(e.comments[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentThreadMessage"},r}(),i.CommentsV2ReopenCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ReopenCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ReopenCommentThreadMessage)return e;var t=new i.CommentsV2ReopenCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ReopenCommentThreadMessage"},r}(),i.CommentsV2ResolveCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.resolvedBy="",r.prototype.resolvedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(26).string(e.resolvedBy),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(34).string(e.resolvedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ResolveCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.resolvedBy=t.string();break;case 4:s.resolvedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ResolveCommentThreadMessage)return e;var t=new i.CommentsV2ResolveCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.resolvedBy="",n.resolvedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ResolveCommentThreadMessage"},r}(),i.CommentsV2UpdateCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.context="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(26).string(e.context),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(34).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(42).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2UpdateCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.context=t.string();break;case 4:s.attributes=t.string();break;case 5:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2UpdateCommentThreadMessage)return e;var t=new i.CommentsV2UpdateCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.context&&(t.context=String(e.context)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.context="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2UpdateCommentThreadMessage"},r}(),i.CommentsV2ConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ConnectMessage)return e;var t=new i.CommentsV2ConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ConnectMessage"},r}(),i.CommentsV2GetCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetCommentThreadMessage)return e;var t=new i.CommentsV2GetCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetCommentThreadMessage"},r}(),i.CommentsV2GetDocumentThreadsMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetDocumentThreadsMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetDocumentThreadsMessage)return e;var t=new i.CommentsV2GetDocumentThreadsMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetDocumentThreadsMessage"},r}(),i.CommentsV2RemoveCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(26).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2RemoveCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2RemoveCommentMessage)return e;var t=new i.CommentsV2RemoveCommentMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2RemoveCommentMessage"},r}(),i.CommentsV2RemoveCommentThreadMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2RemoveCommentThreadMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2RemoveCommentThreadMessage)return e;var t=new i.CommentsV2RemoveCommentThreadMessage;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2RemoveCommentThreadMessage"},r}(),i.CommentsV2UpdateCommentMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.content="",r.prototype.documentId="",r.prototype.attributes="",r.prototype.isAttributesUpdated=!1,r.prototype.commentThread=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&n.uint32(26).string(e.content),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(34).string(e.documentId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(42).string(e.attributes),null!=e.isAttributesUpdated&&Object.hasOwnProperty.call(e,"isAttributesUpdated")&&n.uint32(48).bool(e.isAttributesUpdated),null!=e.commentThread&&Object.hasOwnProperty.call(e,"commentThread")&&i.CommentsThreadDescriptor.encode(e.commentThread,n.uint32(58).fork()).ldelim(),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2UpdateCommentMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.content=t.string();break;case 4:s.documentId=t.string();break;case 5:s.attributes=t.string();break;case 6:s.isAttributesUpdated=t.bool();break;case 7:s.commentThread=i.CommentsThreadDescriptor.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId))return"commentId: string expected";if(null!=e.content&&e.hasOwnProperty("content")&&!n.isString(e.content))return"content: string expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes))return"attributes: string expected";if(null!=e.isAttributesUpdated&&e.hasOwnProperty("isAttributesUpdated")&&"boolean"!=typeof e.isAttributesUpdated)return"isAttributesUpdated: boolean expected";if(null!=e.commentThread&&e.hasOwnProperty("commentThread")){var t=i.CommentsThreadDescriptor.verify(e.commentThread);if(t)return"commentThread."+t}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2UpdateCommentMessage)return e;var t=new i.CommentsV2UpdateCommentMessage;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.content&&(t.content=String(e.content)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.isAttributesUpdated&&(t.isAttributesUpdated=Boolean(e.isAttributesUpdated)),null!=e.commentThread){if("object"!=typeof e.commentThread)throw TypeError(".CommentsV2UpdateCommentMessage.commentThread: object expected");t.commentThread=i.CommentsThreadDescriptor.fromObject(e.commentThread)}return t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.content="",n.documentId="",n.attributes="",n.isAttributesUpdated=!1,n.commentThread=null),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.content&&e.hasOwnProperty("content")&&(n.content=e.content),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.isAttributesUpdated&&e.hasOwnProperty("isAttributesUpdated")&&(n.isAttributesUpdated=e.isAttributesUpdated),null!=e.commentThread&&e.hasOwnProperty("commentThread")&&(n.commentThread=i.CommentsThreadDescriptor.toObject(e.commentThread,t)),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2UpdateCommentMessage"},r}(),i.CommentsV2AddCommentResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.commentId="",r.prototype.createdAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.commentId&&Object.hasOwnProperty.call(e,"commentId")&&n.uint32(18).string(e.commentId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(26).string(e.createdAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.commentId=t.string();break;case 3:s.createdAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.commentId&&e.hasOwnProperty("commentId")&&!n.isString(e.commentId)?"commentId: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentResponse)return e;var t=new i.CommentsV2AddCommentResponse;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.commentId&&(t.commentId=String(e.commentId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.commentId="",n.createdAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.commentId&&e.hasOwnProperty("commentId")&&(n.commentId=e.commentId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentResponse"},r}(),i.CommentsV2AddCommentThreadResponse=function(){function r(e){if(this.comments=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.createdAt="",r.prototype.comments=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(18).string(e.createdAt),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)i.CommentThreadAddedCommentDescriptor.encode(e.comments[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2AddCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.createdAt=t.string();break;case 3:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(i.CommentThreadAddedCommentDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt))return"createdAt: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t){var r=i.CommentThreadAddedCommentDescriptor.verify(e.comments[t]);if(r)return"comments."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2AddCommentThreadResponse)return e;var t=new i.CommentsV2AddCommentThreadResponse;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2AddCommentThreadResponse.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n){if("object"!=typeof e.comments[n])throw TypeError(".CommentsV2AddCommentThreadResponse.comments: object expected");t.comments[n]=i.CommentThreadAddedCommentDescriptor.fromObject(e.comments[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[]),t.defaults&&(n.commentThreadId="",n.createdAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=i.CommentThreadAddedCommentDescriptor.toObject(e.comments[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2AddCommentThreadResponse"},r}(),i.CommentsV2ResolveCommentThreadResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.documentId="",r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(26).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(34).string(e.resolvedBy),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ResolveCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.documentId=t.string();break;case 3:s.resolvedAt=t.string();break;case 4:s.resolvedBy=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId)?"commentThreadId: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2ResolveCommentThreadResponse)return e;var t=new i.CommentsV2ResolveCommentThreadResponse;return null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.commentThreadId="",n.documentId="",n.resolvedAt="",n.resolvedBy=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ResolveCommentThreadResponse"},r}(),i.CommentsV2ConnectResponse=function(){function r(e){if(this.threads=[],this.threadsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.threads=n.emptyArray,r.prototype.threadsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.threads&&e.threads.length)for(var r=0;r<e.threads.length;++r)n.uint32(18).string(e.threads[r]);if(null!=e.threadsV2&&e.threadsV2.length)for(r=0;r<e.threadsV2.length;++r)i.CommentsThreadDescriptor.encode(e.threadsV2[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2ConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.threads&&s.threads.length||(s.threads=[]),s.threads.push(t.string());break;case 3:s.threadsV2&&s.threadsV2.length||(s.threadsV2=[]),s.threadsV2.push(i.CommentsThreadDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.threads&&e.hasOwnProperty("threads")){if(!Array.isArray(e.threads))return"threads: array expected";for(var t=0;t<e.threads.length;++t)if(!n.isString(e.threads[t]))return"threads: string[] expected"}if(null!=e.threadsV2&&e.hasOwnProperty("threadsV2")){if(!Array.isArray(e.threadsV2))return"threadsV2: array expected";for(t=0;t<e.threadsV2.length;++t){var r=i.CommentsThreadDescriptor.verify(e.threadsV2[t]);if(r)return"threadsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2ConnectResponse)return e;var t=new i.CommentsV2ConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.threads){if(!Array.isArray(e.threads))throw TypeError(".CommentsV2ConnectResponse.threads: array expected");t.threads=[];for(var n=0;n<e.threads.length;++n)t.threads[n]=String(e.threads[n])}if(e.threadsV2){if(!Array.isArray(e.threadsV2))throw TypeError(".CommentsV2ConnectResponse.threadsV2: array expected");for(t.threadsV2=[],n=0;n<e.threadsV2.length;++n){if("object"!=typeof e.threadsV2[n])throw TypeError(".CommentsV2ConnectResponse.threadsV2: object expected");t.threadsV2[n]=i.CommentsThreadDescriptor.fromObject(e.threadsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.threads=[],n.threadsV2=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.threads&&e.threads.length){n.threads=[];for(var r=0;r<e.threads.length;++r)n.threads[r]=e.threads[r]}if(e.threadsV2&&e.threadsV2.length)for(n.threadsV2=[],r=0;r<e.threadsV2.length;++r)n.threadsV2[r]=i.CommentsThreadDescriptor.toObject(e.threadsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2ConnectResponse"},r}(),i.CommentsV2GetCommentThreadResponse=function(){function r(e){if(this.comments=[],this.commentsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.commentThreadId="",r.prototype.comments=n.emptyArray,r.prototype.commentsV2=n.emptyArray,r.prototype.resolvedAt="",r.prototype.resolvedBy="",r.prototype.context="",r.prototype.createdAt="",r.prototype.deletedAt="",r.prototype.attributes="",r.prototype.unlinkedAt="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.commentThreadId&&Object.hasOwnProperty.call(e,"commentThreadId")&&n.uint32(10).string(e.commentThreadId),null!=e.comments&&e.comments.length)for(var r=0;r<e.comments.length;++r)n.uint32(18).string(e.comments[r]);if(null!=e.commentsV2&&e.commentsV2.length)for(r=0;r<e.commentsV2.length;++r)i.CommentDescriptor.encode(e.commentsV2[r],n.uint32(26).fork()).ldelim();return null!=e.resolvedAt&&Object.hasOwnProperty.call(e,"resolvedAt")&&n.uint32(34).string(e.resolvedAt),null!=e.resolvedBy&&Object.hasOwnProperty.call(e,"resolvedBy")&&n.uint32(42).string(e.resolvedBy),null!=e.context&&Object.hasOwnProperty.call(e,"context")&&n.uint32(50).string(e.context),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(58).string(e.createdAt),null!=e.deletedAt&&Object.hasOwnProperty.call(e,"deletedAt")&&n.uint32(66).string(e.deletedAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(74).string(e.attributes),null!=e.unlinkedAt&&Object.hasOwnProperty.call(e,"unlinkedAt")&&n.uint32(82).string(e.unlinkedAt),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetCommentThreadResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.commentThreadId=t.string();break;case 2:s.comments&&s.comments.length||(s.comments=[]),s.comments.push(t.string());break;case 3:s.commentsV2&&s.commentsV2.length||(s.commentsV2=[]),s.commentsV2.push(i.CommentDescriptor.decode(t,t.uint32()));break;case 4:s.resolvedAt=t.string();break;case 5:s.resolvedBy=t.string();break;case 6:s.context=t.string();break;case 7:s.createdAt=t.string();break;case 8:s.deletedAt=t.string();break;case 9:s.attributes=t.string();break;case 10:s.unlinkedAt=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&!n.isString(e.commentThreadId))return"commentThreadId: string expected";if(null!=e.comments&&e.hasOwnProperty("comments")){if(!Array.isArray(e.comments))return"comments: array expected";for(var t=0;t<e.comments.length;++t)if(!n.isString(e.comments[t]))return"comments: string[] expected"}if(null!=e.commentsV2&&e.hasOwnProperty("commentsV2")){if(!Array.isArray(e.commentsV2))return"commentsV2: array expected";for(t=0;t<e.commentsV2.length;++t){var r=i.CommentDescriptor.verify(e.commentsV2[t]);if(r)return"commentsV2."+r}}return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&!n.isString(e.resolvedAt)?"resolvedAt: string expected":null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&!n.isString(e.resolvedBy)?"resolvedBy: string expected":null!=e.context&&e.hasOwnProperty("context")&&!n.isString(e.context)?"context: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&!n.isString(e.deletedAt)?"deletedAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&!n.isString(e.unlinkedAt)?"unlinkedAt: string expected":null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetCommentThreadResponse)return e;var t=new i.CommentsV2GetCommentThreadResponse;if(null!=e.commentThreadId&&(t.commentThreadId=String(e.commentThreadId)),e.comments){if(!Array.isArray(e.comments))throw TypeError(".CommentsV2GetCommentThreadResponse.comments: array expected");t.comments=[];for(var n=0;n<e.comments.length;++n)t.comments[n]=String(e.comments[n])}if(e.commentsV2){if(!Array.isArray(e.commentsV2))throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: array expected");for(t.commentsV2=[],n=0;n<e.commentsV2.length;++n){if("object"!=typeof e.commentsV2[n])throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: object expected");t.commentsV2[n]=i.CommentDescriptor.fromObject(e.commentsV2[n])}}return null!=e.resolvedAt&&(t.resolvedAt=String(e.resolvedAt)),null!=e.resolvedBy&&(t.resolvedBy=String(e.resolvedBy)),null!=e.context&&(t.context=String(e.context)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.deletedAt&&(t.deletedAt=String(e.deletedAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.unlinkedAt&&(t.unlinkedAt=String(e.unlinkedAt)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.comments=[],n.commentsV2=[]),t.defaults&&(n.commentThreadId="",n.resolvedAt="",n.resolvedBy="",n.context="",n.createdAt="",n.deletedAt="",n.attributes="",n.unlinkedAt=""),null!=e.commentThreadId&&e.hasOwnProperty("commentThreadId")&&(n.commentThreadId=e.commentThreadId),e.comments&&e.comments.length){n.comments=[];for(var r=0;r<e.comments.length;++r)n.comments[r]=e.comments[r]}if(e.commentsV2&&e.commentsV2.length)for(n.commentsV2=[],r=0;r<e.commentsV2.length;++r)n.commentsV2[r]=i.CommentDescriptor.toObject(e.commentsV2[r],t);return null!=e.resolvedAt&&e.hasOwnProperty("resolvedAt")&&(n.resolvedAt=e.resolvedAt),null!=e.resolvedBy&&e.hasOwnProperty("resolvedBy")&&(n.resolvedBy=e.resolvedBy),null!=e.context&&e.hasOwnProperty("context")&&(n.context=e.context),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.deletedAt&&e.hasOwnProperty("deletedAt")&&(n.deletedAt=e.deletedAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.unlinkedAt&&e.hasOwnProperty("unlinkedAt")&&(n.unlinkedAt=e.unlinkedAt),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetCommentThreadResponse"},r}(),i.CommentsV2GetDocumentThreadsResponse=function(){function r(e){if(this.threads=[],this.threadsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.threads=n.emptyArray,r.prototype.threadsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.threads&&e.threads.length)for(var r=0;r<e.threads.length;++r)n.uint32(10).string(e.threads[r]);if(null!=e.threadsV2&&e.threadsV2.length)for(r=0;r<e.threadsV2.length;++r)i.CommentsThreadDescriptor.encode(e.threadsV2[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.CommentsV2GetDocumentThreadsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.threads&&s.threads.length||(s.threads=[]),s.threads.push(t.string());break;case 2:s.threadsV2&&s.threadsV2.length||(s.threadsV2=[]),s.threadsV2.push(i.CommentsThreadDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.threads&&e.hasOwnProperty("threads")){if(!Array.isArray(e.threads))return"threads: array expected";for(var t=0;t<e.threads.length;++t)if(!n.isString(e.threads[t]))return"threads: string[] expected"}if(null!=e.threadsV2&&e.hasOwnProperty("threadsV2")){if(!Array.isArray(e.threadsV2))return"threadsV2: array expected";for(t=0;t<e.threadsV2.length;++t){var r=i.CommentsThreadDescriptor.verify(e.threadsV2[t]);if(r)return"threadsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.CommentsV2GetDocumentThreadsResponse)return e;var t=new i.CommentsV2GetDocumentThreadsResponse;if(e.threads){if(!Array.isArray(e.threads))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threads: array expected");t.threads=[];for(var n=0;n<e.threads.length;++n)t.threads[n]=String(e.threads[n])}if(e.threadsV2){if(!Array.isArray(e.threadsV2))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: array expected");for(t.threadsV2=[],n=0;n<e.threadsV2.length;++n){if("object"!=typeof e.threadsV2[n])throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: object expected");t.threadsV2[n]=i.CommentsThreadDescriptor.fromObject(e.threadsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.threads=[],n.threadsV2=[]),e.threads&&e.threads.length){n.threads=[];for(var r=0;r<e.threads.length;++r)n.threads[r]=e.threads[r]}if(e.threadsV2&&e.threadsV2.length)for(n.threadsV2=[],r=0;r<e.threadsV2.length;++r)n.threadsV2[r]=i.CommentsThreadDescriptor.toObject(e.threadsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/CommentsV2GetDocumentThreadsResponse"},r}(),i.KeyValueDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&n.uint32(18).string(e.value),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.KeyValueDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.key=t.string();break;case 2:s.value=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!n.isString(e.value)?"value: string expected":null},r.fromObject=function(e){if(e instanceof i.KeyValueDescriptor)return e;var t=new i.KeyValueDescriptor;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.key="",n.value=""),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(n.value=e.value),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/KeyValueDescriptor"},r}(),i.IsEditorBundleUploadedMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.bundleVersion="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.bundleVersion&&Object.hasOwnProperty.call(e,"bundleVersion")&&n.uint32(10).string(e.bundleVersion),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.IsEditorBundleUploadedMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.bundleVersion=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&!n.isString(e.bundleVersion)?"bundleVersion: string expected":null},r.fromObject=function(e){if(e instanceof i.IsEditorBundleUploadedMessage)return e;var t=new i.IsEditorBundleUploadedMessage;return null!=e.bundleVersion&&(t.bundleVersion=String(e.bundleVersion)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.bundleVersion=""),null!=e.bundleVersion&&e.hasOwnProperty("bundleVersion")&&(n.bundleVersion=e.bundleVersion),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/IsEditorBundleUploadedMessage"},r}(),i.IsEditorBundleUploadedResponse=function(){function n(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return n.prototype.isUploaded=!1,n.create=function(e){return new n(e)},n.encode=function(e,n){return n||(n=t.create()),null!=e.isUploaded&&Object.hasOwnProperty.call(e,"isUploaded")&&n.uint32(8).bool(e.isUploaded),n},n.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},n.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.IsEditorBundleUploadedResponse;t.pos<r;){var o=t.uint32();o>>>3==1?s.isUploaded=t.bool():t.skipType(7&o)}return s},n.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},n.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.isUploaded&&e.hasOwnProperty("isUploaded")&&"boolean"!=typeof e.isUploaded?"isUploaded: boolean expected":null},n.fromObject=function(e){if(e instanceof i.IsEditorBundleUploadedResponse)return e;var t=new i.IsEditorBundleUploadedResponse;return null!=e.isUploaded&&(t.isUploaded=Boolean(e.isUploaded)),t},n.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.isUploaded=!1),null!=e.isUploaded&&e.hasOwnProperty("isUploaded")&&(n.isUploaded=e.isUploaded),n},n.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},n.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/IsEditorBundleUploadedResponse"},n}(),i.RevisionDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.revisionId="",r.prototype.name="",r.prototype.creatorId="",r.prototype.authorsIds="",r.prototype.diffData="",r.prototype.createdAt="",r.prototype.attributes="",r.prototype.toVersion=0,r.prototype.fromVersion=0,r.prototype.isEmptyCurrent=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(10).string(e.revisionId),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(18).string(e.name),null!=e.creatorId&&Object.hasOwnProperty.call(e,"creatorId")&&n.uint32(26).string(e.creatorId),null!=e.authorsIds&&Object.hasOwnProperty.call(e,"authorsIds")&&n.uint32(34).string(e.authorsIds),null!=e.diffData&&Object.hasOwnProperty.call(e,"diffData")&&n.uint32(42).string(e.diffData),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.toVersion&&Object.hasOwnProperty.call(e,"toVersion")&&n.uint32(64).uint32(e.toVersion),null!=e.fromVersion&&Object.hasOwnProperty.call(e,"fromVersion")&&n.uint32(72).uint32(e.fromVersion),null!=e.isEmptyCurrent&&Object.hasOwnProperty.call(e,"isEmptyCurrent")&&n.uint32(80).bool(e.isEmptyCurrent),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.revisionId=t.string();break;case 2:s.name=t.string();break;case 3:s.creatorId=t.string();break;case 4:s.authorsIds=t.string();break;case 5:s.diffData=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;case 8:s.toVersion=t.uint32();break;case 9:s.fromVersion=t.uint32();break;case 10:s.isEmptyCurrent=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.creatorId&&e.hasOwnProperty("creatorId")&&!n.isString(e.creatorId)?"creatorId: string expected":null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&!n.isString(e.authorsIds)?"authorsIds: string expected":null!=e.diffData&&e.hasOwnProperty("diffData")&&!n.isString(e.diffData)?"diffData: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.toVersion&&e.hasOwnProperty("toVersion")&&!n.isInteger(e.toVersion)?"toVersion: integer expected":null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&!n.isInteger(e.fromVersion)?"fromVersion: integer expected":null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&"boolean"!=typeof e.isEmptyCurrent?"isEmptyCurrent: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RevisionDescriptor)return e;var t=new i.RevisionDescriptor;return null!=e.revisionId&&(t.revisionId=String(e.revisionId)),null!=e.name&&(t.name=String(e.name)),null!=e.creatorId&&(t.creatorId=String(e.creatorId)),null!=e.authorsIds&&(t.authorsIds=String(e.authorsIds)),null!=e.diffData&&(t.diffData=String(e.diffData)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.toVersion&&(t.toVersion=e.toVersion>>>0),null!=e.fromVersion&&(t.fromVersion=e.fromVersion>>>0),null!=e.isEmptyCurrent&&(t.isEmptyCurrent=Boolean(e.isEmptyCurrent)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.revisionId="",n.name="",n.creatorId="",n.authorsIds="",n.diffData="",n.createdAt="",n.attributes="",n.toVersion=0,n.fromVersion=0,n.isEmptyCurrent=!1),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.creatorId&&e.hasOwnProperty("creatorId")&&(n.creatorId=e.creatorId),null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&(n.authorsIds=e.authorsIds),null!=e.diffData&&e.hasOwnProperty("diffData")&&(n.diffData=e.diffData),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.toVersion&&e.hasOwnProperty("toVersion")&&(n.toVersion=e.toVersion),null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&(n.fromVersion=e.fromVersion),null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&(n.isEmptyCurrent=e.isEmptyCurrent),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionDescriptor"},r}(),i.RevisionHistoryConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryConnectMessage)return e;var t=new i.RevisionHistoryConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryConnectMessage"},r}(),i.RevisionHistoryGetRevisionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.revisionId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(18).string(e.revisionId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryGetRevisionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.revisionId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryGetRevisionMessage)return e;var t=new i.RevisionHistoryGetRevisionMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.revisionId&&(t.revisionId=String(e.revisionId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.revisionId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryGetRevisionMessage"},r}(),i.RevisionHistoryReconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.requestId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryReconnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.requestId=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId)?"requestId: integer expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryReconnectMessage)return e;var t=new i.RevisionHistoryReconnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.requestId&&(t.requestId=e.requestId>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId="",n.requestId=0),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryReconnectMessage"},r}(),i.RevisionHistoryUpdateRevisionsMessage=function(){function r(e){if(this.revisions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.prototype.requestId=0,r.prototype.revisions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),null!=e.revisions&&e.revisions.length)for(var r=0;r<e.revisions.length;++r)i.RevisionDescriptor.encode(e.revisions[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryUpdateRevisionsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.documentId=t.string();break;case 2:s.requestId=t.uint32();break;case 3:s.revisions&&s.revisions.length||(s.revisions=[]),s.revisions.push(i.RevisionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId))return"documentId: string expected";if(null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId))return"requestId: integer expected";if(null!=e.revisions&&e.hasOwnProperty("revisions")){if(!Array.isArray(e.revisions))return"revisions: array expected";for(var t=0;t<e.revisions.length;++t){var r=i.RevisionDescriptor.verify(e.revisions[t]);if(r)return"revisions."+r}}return null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryUpdateRevisionsMessage)return e;var t=new i.RevisionHistoryUpdateRevisionsMessage;if(null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.requestId&&(t.requestId=e.requestId>>>0),e.revisions){if(!Array.isArray(e.revisions))throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: array expected");t.revisions=[];for(var n=0;n<e.revisions.length;++n){if("object"!=typeof e.revisions[n])throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: object expected");t.revisions[n]=i.RevisionDescriptor.fromObject(e.revisions[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.revisions=[]),t.defaults&&(n.documentId="",n.requestId=0),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),e.revisions&&e.revisions.length){n.revisions=[];for(var r=0;r<e.revisions.length;++r)n.revisions[r]=i.RevisionDescriptor.toObject(e.revisions[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryUpdateRevisionsMessage"},r}(),i.RevisionHistoryConnectResponse=function(){function r(e){if(this.revisions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.requestId=0,r.prototype.revisions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(16).uint32(e.requestId),null!=e.revisions&&e.revisions.length)for(var r=0;r<e.revisions.length;++r)i.RevisionDescriptor.encode(e.revisions[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.requestId=t.uint32();break;case 3:s.revisions&&s.revisions.length||(s.revisions=[]),s.revisions.push(i.RevisionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId))return"requestId: integer expected";if(null!=e.revisions&&e.hasOwnProperty("revisions")){if(!Array.isArray(e.revisions))return"revisions: array expected";for(var t=0;t<e.revisions.length;++t){var r=i.RevisionDescriptor.verify(e.revisions[t]);if(r)return"revisions."+r}}return null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryConnectResponse)return e;var t=new i.RevisionHistoryConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),null!=e.requestId&&(t.requestId=e.requestId>>>0),e.revisions){if(!Array.isArray(e.revisions))throw TypeError(".RevisionHistoryConnectResponse.revisions: array expected");t.revisions=[];for(var n=0;n<e.revisions.length;++n){if("object"!=typeof e.revisions[n])throw TypeError(".RevisionHistoryConnectResponse.revisions: object expected");t.revisions[n]=i.RevisionDescriptor.fromObject(e.revisions[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.revisions=[]),t.defaults&&(n.channel="",n.requestId=0),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),e.revisions&&e.revisions.length){n.revisions=[];for(var r=0;r<e.revisions.length;++r)n.revisions[r]=i.RevisionDescriptor.toObject(e.revisions[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryConnectResponse"},r}(),i.RevisionHistoryGetRevisionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.revisionId="",r.prototype.name="",r.prototype.creatorId="",r.prototype.authorsIds="",r.prototype.diffData="",r.prototype.createdAt="",r.prototype.attributes="",r.prototype.toVersion=0,r.prototype.fromVersion=0,r.prototype.isEmptyCurrent=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.revisionId&&Object.hasOwnProperty.call(e,"revisionId")&&n.uint32(10).string(e.revisionId),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(18).string(e.name),null!=e.creatorId&&Object.hasOwnProperty.call(e,"creatorId")&&n.uint32(26).string(e.creatorId),null!=e.authorsIds&&Object.hasOwnProperty.call(e,"authorsIds")&&n.uint32(34).string(e.authorsIds),null!=e.diffData&&Object.hasOwnProperty.call(e,"diffData")&&n.uint32(42).string(e.diffData),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(50).string(e.createdAt),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(58).string(e.attributes),null!=e.toVersion&&Object.hasOwnProperty.call(e,"toVersion")&&n.uint32(64).uint32(e.toVersion),null!=e.fromVersion&&Object.hasOwnProperty.call(e,"fromVersion")&&n.uint32(72).uint32(e.fromVersion),null!=e.isEmptyCurrent&&Object.hasOwnProperty.call(e,"isEmptyCurrent")&&n.uint32(80).bool(e.isEmptyCurrent),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryGetRevisionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.revisionId=t.string();break;case 2:s.name=t.string();break;case 3:s.creatorId=t.string();break;case 4:s.authorsIds=t.string();break;case 5:s.diffData=t.string();break;case 6:s.createdAt=t.string();break;case 7:s.attributes=t.string();break;case 8:s.toVersion=t.uint32();break;case 9:s.fromVersion=t.uint32();break;case 10:s.isEmptyCurrent=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.revisionId&&e.hasOwnProperty("revisionId")&&!n.isString(e.revisionId)?"revisionId: string expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.creatorId&&e.hasOwnProperty("creatorId")&&!n.isString(e.creatorId)?"creatorId: string expected":null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&!n.isString(e.authorsIds)?"authorsIds: string expected":null!=e.diffData&&e.hasOwnProperty("diffData")&&!n.isString(e.diffData)?"diffData: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null!=e.toVersion&&e.hasOwnProperty("toVersion")&&!n.isInteger(e.toVersion)?"toVersion: integer expected":null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&!n.isInteger(e.fromVersion)?"fromVersion: integer expected":null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&"boolean"!=typeof e.isEmptyCurrent?"isEmptyCurrent: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryGetRevisionResponse)return e;var t=new i.RevisionHistoryGetRevisionResponse;return null!=e.revisionId&&(t.revisionId=String(e.revisionId)),null!=e.name&&(t.name=String(e.name)),null!=e.creatorId&&(t.creatorId=String(e.creatorId)),null!=e.authorsIds&&(t.authorsIds=String(e.authorsIds)),null!=e.diffData&&(t.diffData=String(e.diffData)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.attributes&&(t.attributes=String(e.attributes)),null!=e.toVersion&&(t.toVersion=e.toVersion>>>0),null!=e.fromVersion&&(t.fromVersion=e.fromVersion>>>0),null!=e.isEmptyCurrent&&(t.isEmptyCurrent=Boolean(e.isEmptyCurrent)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.revisionId="",n.name="",n.creatorId="",n.authorsIds="",n.diffData="",n.createdAt="",n.attributes="",n.toVersion=0,n.fromVersion=0,n.isEmptyCurrent=!1),null!=e.revisionId&&e.hasOwnProperty("revisionId")&&(n.revisionId=e.revisionId),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.creatorId&&e.hasOwnProperty("creatorId")&&(n.creatorId=e.creatorId),null!=e.authorsIds&&e.hasOwnProperty("authorsIds")&&(n.authorsIds=e.authorsIds),null!=e.diffData&&e.hasOwnProperty("diffData")&&(n.diffData=e.diffData),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),null!=e.toVersion&&e.hasOwnProperty("toVersion")&&(n.toVersion=e.toVersion),null!=e.fromVersion&&e.hasOwnProperty("fromVersion")&&(n.fromVersion=e.fromVersion),null!=e.isEmptyCurrent&&e.hasOwnProperty("isEmptyCurrent")&&(n.isEmptyCurrent=e.isEmptyCurrent),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryGetRevisionResponse"},r}(),i.RevisionHistoryUpdateRevisionsResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.requestId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&n.uint32(8).uint32(e.requestId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RevisionHistoryUpdateRevisionsResponse;t.pos<r;){var o=t.uint32();o>>>3==1?s.requestId=t.uint32():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.requestId&&e.hasOwnProperty("requestId")&&!n.isInteger(e.requestId)?"requestId: integer expected":null},r.fromObject=function(e){if(e instanceof i.RevisionHistoryUpdateRevisionsResponse)return e;var t=new i.RevisionHistoryUpdateRevisionsResponse;return null!=e.requestId&&(t.requestId=e.requestId>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.requestId=0),null!=e.requestId&&e.hasOwnProperty("requestId")&&(n.requestId=e.requestId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RevisionHistoryUpdateRevisionsResponse"},r}(),i.SessionsSocketDescriptor=function(){function r(e){if(this.permissions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.session="",r.prototype.user="",r.prototype.role="",r.prototype.permissions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&n.uint32(10).string(e.session),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&n.uint32(18).string(e.user),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&n.uint32(26).string(e.role),null!=e.permissions&&e.permissions.length)for(var i=0;i<e.permissions.length;++i)n.uint32(34).string(e.permissions[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsSocketDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.session=t.string();break;case 2:s.user=t.string();break;case 3:s.role=t.string();break;case 4:s.permissions&&s.permissions.length||(s.permissions=[]),s.permissions.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.session&&e.hasOwnProperty("session")&&!n.isString(e.session))return"session: string expected";if(null!=e.user&&e.hasOwnProperty("user")&&!n.isString(e.user))return"user: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!n.isString(e.role))return"role: string expected";if(null!=e.permissions&&e.hasOwnProperty("permissions")){if(!Array.isArray(e.permissions))return"permissions: array expected";for(var t=0;t<e.permissions.length;++t)if(!n.isString(e.permissions[t]))return"permissions: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.SessionsSocketDescriptor)return e;var t=new i.SessionsSocketDescriptor;if(null!=e.session&&(t.session=String(e.session)),null!=e.user&&(t.user=String(e.user)),null!=e.role&&(t.role=String(e.role)),e.permissions){if(!Array.isArray(e.permissions))throw TypeError(".SessionsSocketDescriptor.permissions: array expected");t.permissions=[];for(var n=0;n<e.permissions.length;++n)t.permissions[n]=String(e.permissions[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.permissions=[]),t.defaults&&(n.session="",n.user="",n.role=""),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.user&&e.hasOwnProperty("user")&&(n.user=e.user),null!=e.role&&e.hasOwnProperty("role")&&(n.role=e.role),e.permissions&&e.permissions.length){n.permissions=[];for(var i=0;i<e.permissions.length;++i)n.permissions[i]=e.permissions[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsSocketDescriptor"},r}(),i.SessionsConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.sessionType=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.sessionType&&Object.hasOwnProperty.call(e,"sessionType")&&n.uint32(16).uint32(e.sessionType),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.sessionType=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.sessionType&&e.hasOwnProperty("sessionType")&&!n.isInteger(e.sessionType)?"sessionType: integer expected":null},r.fromObject=function(e){if(e instanceof i.SessionsConnectMessage)return e;var t=new i.SessionsConnectMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.sessionType&&(t.sessionType=e.sessionType>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.sessionType=0),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.sessionType&&e.hasOwnProperty("sessionType")&&(n.sessionType=e.sessionType),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsConnectMessage"},r}(),i.SocketConnectMessage=function(){function r(e){if(this.permissions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.userId="",r.prototype.role="",r.prototype.permissions=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&n.uint32(18).string(e.userId),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&n.uint32(26).string(e.role),null!=e.permissions&&e.permissions.length)for(var i=0;i<e.permissions.length;++i)n.uint32(34).string(e.permissions[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SocketConnectMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.userId=t.string();break;case 3:s.role=t.string();break;case 4:s.permissions&&s.permissions.length||(s.permissions=[]),s.permissions.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id))return"id: string expected";if(null!=e.userId&&e.hasOwnProperty("userId")&&!n.isString(e.userId))return"userId: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!n.isString(e.role))return"role: string expected";if(null!=e.permissions&&e.hasOwnProperty("permissions")){if(!Array.isArray(e.permissions))return"permissions: array expected";for(var t=0;t<e.permissions.length;++t)if(!n.isString(e.permissions[t]))return"permissions: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.SocketConnectMessage)return e;var t=new i.SocketConnectMessage;if(null!=e.id&&(t.id=String(e.id)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.role&&(t.role=String(e.role)),e.permissions){if(!Array.isArray(e.permissions))throw TypeError(".SocketConnectMessage.permissions: array expected");t.permissions=[];for(var n=0;n<e.permissions.length;++n)t.permissions[n]=String(e.permissions[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.permissions=[]),t.defaults&&(n.id="",n.userId="",n.role=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.role&&e.hasOwnProperty("role")&&(n.role=e.role),e.permissions&&e.permissions.length){n.permissions=[];for(var i=0;i<e.permissions.length;++i)n.permissions[i]=e.permissions[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SocketConnectMessage"},r}(),i.SocketDisconnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SocketDisconnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.id=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null},r.fromObject=function(e){if(e instanceof i.SocketDisconnectMessage)return e;var t=new i.SocketDisconnectMessage;return null!=e.id&&(t.id=String(e.id)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SocketDisconnectMessage"},r}(),i.SessionsConnectResponse=function(){function r(e){if(this.sockets=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.sockets=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.sockets&&e.sockets.length)for(var r=0;r<e.sockets.length;++r)i.SessionsSocketDescriptor.encode(e.sockets[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SessionsConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.sockets&&s.sockets.length||(s.sockets=[]),s.sockets.push(i.SessionsSocketDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.sockets&&e.hasOwnProperty("sockets")){if(!Array.isArray(e.sockets))return"sockets: array expected";for(var t=0;t<e.sockets.length;++t){var r=i.SessionsSocketDescriptor.verify(e.sockets[t]);if(r)return"sockets."+r}}return null},r.fromObject=function(e){if(e instanceof i.SessionsConnectResponse)return e;var t=new i.SessionsConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.sockets){if(!Array.isArray(e.sockets))throw TypeError(".SessionsConnectResponse.sockets: array expected");t.sockets=[];for(var n=0;n<e.sockets.length;++n){if("object"!=typeof e.sockets[n])throw TypeError(".SessionsConnectResponse.sockets: object expected");t.sockets[n]=i.SessionsSocketDescriptor.fromObject(e.sockets[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sockets=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.sockets&&e.sockets.length){n.sockets=[];for(var r=0;r<e.sockets.length;++r)n.sockets[r]=i.SessionsSocketDescriptor.toObject(e.sockets[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionsConnectResponse"},r}(),i.SuggestionDescriptor=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SuggestionDescriptor;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.SuggestionDescriptor)return e;var t=new i.SuggestionDescriptor;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SuggestionDescriptor"},r}(),i.TrackChangesAddSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.prototype.type="",r.prototype.data="",r.prototype.originalSuggestionId="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(34).string(e.data),null!=e.originalSuggestionId&&Object.hasOwnProperty.call(e,"originalSuggestionId")&&n.uint32(42).string(e.originalSuggestionId),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(50).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesAddSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;case 3:s.type=t.string();break;case 4:s.data=t.string();break;case 5:s.originalSuggestionId=t.string();break;case 6:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.originalSuggestionId&&e.hasOwnProperty("originalSuggestionId")&&!n.isString(e.originalSuggestionId)?"originalSuggestionId: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesAddSuggestionMessage)return e;var t=new i.TrackChangesAddSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.type&&(t.type=String(e.type)),null!=e.data&&(t.data=String(e.data)),null!=e.originalSuggestionId&&(t.originalSuggestionId=String(e.originalSuggestionId)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId="",n.type="",n.data="",n.originalSuggestionId="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.originalSuggestionId&&e.hasOwnProperty("originalSuggestionId")&&(n.originalSuggestionId=e.originalSuggestionId),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesAddSuggestionMessage"},r}(),i.TrackChangesBatchUpdateSuggestionsStateMessage=function(){function r(e){if(this.ids=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.ids=n.emptyArray,r.prototype.documentId="",r.prototype.state="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.ids&&e.ids.length)for(var i=0;i<e.ids.length;++i)n.uint32(10).string(e.ids[i]);return null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(26).string(e.state),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesBatchUpdateSuggestionsStateMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.ids&&s.ids.length||(s.ids=[]),s.ids.push(t.string());break;case 2:s.documentId=t.string();break;case 3:s.state=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.ids&&e.hasOwnProperty("ids")){if(!Array.isArray(e.ids))return"ids: array expected";for(var t=0;t<e.ids.length;++t)if(!n.isString(e.ids[t]))return"ids: string[] expected"}return null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesBatchUpdateSuggestionsStateMessage)return e;var t=new i.TrackChangesBatchUpdateSuggestionsStateMessage;if(e.ids){if(!Array.isArray(e.ids))throw TypeError(".TrackChangesBatchUpdateSuggestionsStateMessage.ids: array expected");t.ids=[];for(var n=0;n<e.ids.length;++n)t.ids[n]=String(e.ids[n])}return null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.state&&(t.state=String(e.state)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ids=[]),t.defaults&&(n.documentId="",n.state=""),e.ids&&e.ids.length){n.ids=[];for(var i=0;i<e.ids.length;++i)n.ids[i]=e.ids[i]}return null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesBatchUpdateSuggestionsStateMessage"},r}(),i.TrackChangesConnectMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesConnectMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesConnectMessage)return e;var t=new i.TrackChangesConnectMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesConnectMessage"},r}(),i.TrackChangesGetAllSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(10).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetAllSuggestionMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.documentId=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetAllSuggestionMessage)return e;var t=new i.TrackChangesGetAllSuggestionMessage;return null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.documentId=""),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetAllSuggestionMessage"},r}(),i.TrackChangesGetSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetSuggestionMessage)return e;var t=new i.TrackChangesGetSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetSuggestionMessage"},r}(),i.TrackChangesUpdateSuggestionMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.documentId="",r.prototype.hasComments=!1,r.prototype.isHasCommentsModified=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.documentId&&Object.hasOwnProperty.call(e,"documentId")&&n.uint32(18).string(e.documentId),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(24).bool(e.hasComments),null!=e.isHasCommentsModified&&Object.hasOwnProperty.call(e,"isHasCommentsModified")&&n.uint32(32).bool(e.isHasCommentsModified),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(42).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(50).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesUpdateSuggestionMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.documentId=t.string();break;case 3:s.hasComments=t.bool();break;case 4:s.isHasCommentsModified=t.bool();break;case 5:s.state=t.string();break;case 6:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.documentId&&e.hasOwnProperty("documentId")&&!n.isString(e.documentId)?"documentId: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.isHasCommentsModified&&e.hasOwnProperty("isHasCommentsModified")&&"boolean"!=typeof e.isHasCommentsModified?"isHasCommentsModified: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesUpdateSuggestionMessage)return e;var t=new i.TrackChangesUpdateSuggestionMessage;return null!=e.id&&(t.id=String(e.id)),null!=e.documentId&&(t.documentId=String(e.documentId)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.isHasCommentsModified&&(t.isHasCommentsModified=Boolean(e.isHasCommentsModified)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.documentId="",n.hasComments=!1,n.isHasCommentsModified=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.documentId&&e.hasOwnProperty("documentId")&&(n.documentId=e.documentId),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.isHasCommentsModified&&e.hasOwnProperty("isHasCommentsModified")&&(n.isHasCommentsModified=e.isHasCommentsModified),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesUpdateSuggestionMessage"},r}(),i.TrackChangesAddSuggestionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesAddSuggestionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesAddSuggestionResponse)return e;var t=new i.TrackChangesAddSuggestionResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesAddSuggestionResponse"},r}(),i.TrackChangesConnectResponse=function(){function r(e){if(this.suggestions=[],this.suggestionsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.channel="",r.prototype.suggestions=n.emptyArray,r.prototype.suggestionsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.channel&&Object.hasOwnProperty.call(e,"channel")&&n.uint32(10).string(e.channel),null!=e.suggestions&&e.suggestions.length)for(var r=0;r<e.suggestions.length;++r)n.uint32(18).string(e.suggestions[r]);if(null!=e.suggestionsV2&&e.suggestionsV2.length)for(r=0;r<e.suggestionsV2.length;++r)i.SuggestionDescriptor.encode(e.suggestionsV2[r],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesConnectResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.channel=t.string();break;case 2:s.suggestions&&s.suggestions.length||(s.suggestions=[]),s.suggestions.push(t.string());break;case 3:s.suggestionsV2&&s.suggestionsV2.length||(s.suggestionsV2=[]),s.suggestionsV2.push(i.SuggestionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.channel&&e.hasOwnProperty("channel")&&!n.isString(e.channel))return"channel: string expected";if(null!=e.suggestions&&e.hasOwnProperty("suggestions")){if(!Array.isArray(e.suggestions))return"suggestions: array expected";for(var t=0;t<e.suggestions.length;++t)if(!n.isString(e.suggestions[t]))return"suggestions: string[] expected"}if(null!=e.suggestionsV2&&e.hasOwnProperty("suggestionsV2")){if(!Array.isArray(e.suggestionsV2))return"suggestionsV2: array expected";for(t=0;t<e.suggestionsV2.length;++t){var r=i.SuggestionDescriptor.verify(e.suggestionsV2[t]);if(r)return"suggestionsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.TrackChangesConnectResponse)return e;var t=new i.TrackChangesConnectResponse;if(null!=e.channel&&(t.channel=String(e.channel)),e.suggestions){if(!Array.isArray(e.suggestions))throw TypeError(".TrackChangesConnectResponse.suggestions: array expected");t.suggestions=[];for(var n=0;n<e.suggestions.length;++n)t.suggestions[n]=String(e.suggestions[n])}if(e.suggestionsV2){if(!Array.isArray(e.suggestionsV2))throw TypeError(".TrackChangesConnectResponse.suggestionsV2: array expected");for(t.suggestionsV2=[],n=0;n<e.suggestionsV2.length;++n){if("object"!=typeof e.suggestionsV2[n])throw TypeError(".TrackChangesConnectResponse.suggestionsV2: object expected");t.suggestionsV2[n]=i.SuggestionDescriptor.fromObject(e.suggestionsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.suggestions=[],n.suggestionsV2=[]),t.defaults&&(n.channel=""),null!=e.channel&&e.hasOwnProperty("channel")&&(n.channel=e.channel),e.suggestions&&e.suggestions.length){n.suggestions=[];for(var r=0;r<e.suggestions.length;++r)n.suggestions[r]=e.suggestions[r]}if(e.suggestionsV2&&e.suggestionsV2.length)for(n.suggestionsV2=[],r=0;r<e.suggestionsV2.length;++r)n.suggestionsV2[r]=i.SuggestionDescriptor.toObject(e.suggestionsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesConnectResponse"},r}(),i.TrackChangesGetAllSuggestionsResponse=function(){function r(e){if(this.suggestions=[],this.suggestionsV2=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.suggestions=n.emptyArray,r.prototype.suggestionsV2=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.suggestions&&e.suggestions.length)for(var r=0;r<e.suggestions.length;++r)n.uint32(10).string(e.suggestions[r]);if(null!=e.suggestionsV2&&e.suggestionsV2.length)for(r=0;r<e.suggestionsV2.length;++r)i.SuggestionDescriptor.encode(e.suggestionsV2[r],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetAllSuggestionsResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.suggestions&&s.suggestions.length||(s.suggestions=[]),s.suggestions.push(t.string());break;case 2:s.suggestionsV2&&s.suggestionsV2.length||(s.suggestionsV2=[]),s.suggestionsV2.push(i.SuggestionDescriptor.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.suggestions&&e.hasOwnProperty("suggestions")){if(!Array.isArray(e.suggestions))return"suggestions: array expected";for(var t=0;t<e.suggestions.length;++t)if(!n.isString(e.suggestions[t]))return"suggestions: string[] expected"}if(null!=e.suggestionsV2&&e.hasOwnProperty("suggestionsV2")){if(!Array.isArray(e.suggestionsV2))return"suggestionsV2: array expected";for(t=0;t<e.suggestionsV2.length;++t){var r=i.SuggestionDescriptor.verify(e.suggestionsV2[t]);if(r)return"suggestionsV2."+r}}return null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetAllSuggestionsResponse)return e;var t=new i.TrackChangesGetAllSuggestionsResponse;if(e.suggestions){if(!Array.isArray(e.suggestions))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestions: array expected");t.suggestions=[];for(var n=0;n<e.suggestions.length;++n)t.suggestions[n]=String(e.suggestions[n])}if(e.suggestionsV2){if(!Array.isArray(e.suggestionsV2))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: array expected");for(t.suggestionsV2=[],n=0;n<e.suggestionsV2.length;++n){if("object"!=typeof e.suggestionsV2[n])throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: object expected");t.suggestionsV2[n]=i.SuggestionDescriptor.fromObject(e.suggestionsV2[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.suggestions=[],n.suggestionsV2=[]),e.suggestions&&e.suggestions.length){n.suggestions=[];for(var r=0;r<e.suggestions.length;++r)n.suggestions[r]=e.suggestions[r]}if(e.suggestionsV2&&e.suggestionsV2.length)for(n.suggestionsV2=[],r=0;r<e.suggestionsV2.length;++r)n.suggestionsV2[r]=i.SuggestionDescriptor.toObject(e.suggestionsV2[r],t);return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetAllSuggestionsResponse"},r}(),i.TrackChangesGetSuggestionResponse=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.prototype.authorId="",r.prototype.type="",r.prototype.createdAt="",r.prototype.data="",r.prototype.hasComments=!1,r.prototype.state="",r.prototype.attributes="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),null!=e.authorId&&Object.hasOwnProperty.call(e,"authorId")&&n.uint32(18).string(e.authorId),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(26).string(e.type),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&n.uint32(34).string(e.createdAt),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(42).string(e.data),null!=e.hasComments&&Object.hasOwnProperty.call(e,"hasComments")&&n.uint32(48).bool(e.hasComments),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&n.uint32(58).string(e.state),null!=e.attributes&&Object.hasOwnProperty.call(e,"attributes")&&n.uint32(66).string(e.attributes),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.TrackChangesGetSuggestionResponse;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.id=t.string();break;case 2:s.authorId=t.string();break;case 3:s.type=t.string();break;case 4:s.createdAt=t.string();break;case 5:s.data=t.string();break;case 6:s.hasComments=t.bool();break;case 7:s.state=t.string();break;case 8:s.attributes=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null!=e.authorId&&e.hasOwnProperty("authorId")&&!n.isString(e.authorId)?"authorId: string expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isString(e.type)?"type: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!n.isString(e.createdAt)?"createdAt: string expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.hasComments&&e.hasOwnProperty("hasComments")&&"boolean"!=typeof e.hasComments?"hasComments: boolean expected":null!=e.state&&e.hasOwnProperty("state")&&!n.isString(e.state)?"state: string expected":null!=e.attributes&&e.hasOwnProperty("attributes")&&!n.isString(e.attributes)?"attributes: string expected":null},r.fromObject=function(e){if(e instanceof i.TrackChangesGetSuggestionResponse)return e;var t=new i.TrackChangesGetSuggestionResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.authorId&&(t.authorId=String(e.authorId)),null!=e.type&&(t.type=String(e.type)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.data&&(t.data=String(e.data)),null!=e.hasComments&&(t.hasComments=Boolean(e.hasComments)),null!=e.state&&(t.state=String(e.state)),null!=e.attributes&&(t.attributes=String(e.attributes)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id="",n.authorId="",n.type="",n.createdAt="",n.data="",n.hasComments=!1,n.state="",n.attributes=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.authorId&&e.hasOwnProperty("authorId")&&(n.authorId=e.authorId),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.hasComments&&e.hasOwnProperty("hasComments")&&(n.hasComments=e.hasComments),null!=e.state&&e.hasOwnProperty("state")&&(n.state=e.state),null!=e.attributes&&e.hasOwnProperty("attributes")&&(n.attributes=e.attributes),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/TrackChangesGetSuggestionResponse"},r}(),i.UserDescriptor=function(){function r(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.attributes=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.attributes&&e.attributes.length)for(var r=0;r<e.attributes.length;++r)i.KeyValueDescriptor.encode(e.attributes[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.UserDescriptor;t.pos<r;){var o=t.uint32();o>>>3==1?(s.attributes&&s.attributes.length||(s.attributes=[]),s.attributes.push(i.KeyValueDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")){if(!Array.isArray(e.attributes))return"attributes: array expected";for(var t=0;t<e.attributes.length;++t){var n=i.KeyValueDescriptor.verify(e.attributes[t]);if(n)return"attributes."+n}}return null},r.fromObject=function(e){if(e instanceof i.UserDescriptor)return e;var t=new i.UserDescriptor;if(e.attributes){if(!Array.isArray(e.attributes))throw TypeError(".UserDescriptor.attributes: array expected");t.attributes=[];for(var n=0;n<e.attributes.length;++n){if("object"!=typeof e.attributes[n])throw TypeError(".UserDescriptor.attributes: object expected");t.attributes[n]=i.KeyValueDescriptor.fromObject(e.attributes[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.attributes=[]),e.attributes&&e.attributes.length){n.attributes=[];for(var r=0;r<e.attributes.length;++r)n.attributes[r]=i.KeyValueDescriptor.toObject(e.attributes[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/UserDescriptor"},r}(),i.GetManyUsersMessage=function(){function r(e){if(this.ids=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.ids=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.ids&&e.ids.length)for(var i=0;i<e.ids.length;++i)n.uint32(10).string(e.ids[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetManyUsersMessage;t.pos<r;){var o=t.uint32();o>>>3==1?(s.ids&&s.ids.length||(s.ids=[]),s.ids.push(t.string())):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.ids&&e.hasOwnProperty("ids")){if(!Array.isArray(e.ids))return"ids: array expected";for(var t=0;t<e.ids.length;++t)if(!n.isString(e.ids[t]))return"ids: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.GetManyUsersMessage)return e;var t=new i.GetManyUsersMessage;if(e.ids){if(!Array.isArray(e.ids))throw TypeError(".GetManyUsersMessage.ids: array expected");t.ids=[];for(var n=0;n<e.ids.length;++n)t.ids[n]=String(e.ids[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ids=[]),e.ids&&e.ids.length){n.ids=[];for(var i=0;i<e.ids.length;++i)n.ids[i]=e.ids[i]}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetManyUsersMessage"},r}(),i.GetUserMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.id="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(10).string(e.id),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetUserMessage;t.pos<r;){var o=t.uint32();o>>>3==1?s.id=t.string():t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isString(e.id)?"id: string expected":null},r.fromObject=function(e){if(e instanceof i.GetUserMessage)return e;var t=new i.GetUserMessage;return null!=e.id&&(t.id=String(e.id)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.id=""),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetUserMessage"},r}(),i.GetManyUsersResponse=function(){function r(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.users=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.users&&e.users.length)for(var r=0;r<e.users.length;++r)i.UserDescriptor.encode(e.users[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetManyUsersResponse;t.pos<r;){var o=t.uint32();o>>>3==1?(s.users&&s.users.length||(s.users=[]),s.users.push(i.UserDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.users&&e.hasOwnProperty("users")){if(!Array.isArray(e.users))return"users: array expected";for(var t=0;t<e.users.length;++t){var n=i.UserDescriptor.verify(e.users[t]);if(n)return"users."+n}}return null},r.fromObject=function(e){if(e instanceof i.GetManyUsersResponse)return e;var t=new i.GetManyUsersResponse;if(e.users){if(!Array.isArray(e.users))throw TypeError(".GetManyUsersResponse.users: array expected");t.users=[];for(var n=0;n<e.users.length;++n){if("object"!=typeof e.users[n])throw TypeError(".GetManyUsersResponse.users: object expected");t.users[n]=i.UserDescriptor.fromObject(e.users[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.users=[]),e.users&&e.users.length){n.users=[];for(var r=0;r<e.users.length;++r)n.users[r]=i.UserDescriptor.toObject(e.users[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetManyUsersResponse"},r}(),i.GetUserResponse=function(){function r(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.attributes=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.attributes&&e.attributes.length)for(var r=0;r<e.attributes.length;++r)i.KeyValueDescriptor.encode(e.attributes[r],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.GetUserResponse;t.pos<r;){var o=t.uint32();o>>>3==1?(s.attributes&&s.attributes.length||(s.attributes=[]),s.attributes.push(i.KeyValueDescriptor.decode(t,t.uint32()))):t.skipType(7&o)}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.attributes&&e.hasOwnProperty("attributes")){if(!Array.isArray(e.attributes))return"attributes: array expected";for(var t=0;t<e.attributes.length;++t){var n=i.KeyValueDescriptor.verify(e.attributes[t]);if(n)return"attributes."+n}}return null},r.fromObject=function(e){if(e instanceof i.GetUserResponse)return e;var t=new i.GetUserResponse;if(e.attributes){if(!Array.isArray(e.attributes))throw TypeError(".GetUserResponse.attributes: array expected");t.attributes=[];for(var n=0;n<e.attributes.length;++n){if("object"!=typeof e.attributes[n])throw TypeError(".GetUserResponse.attributes: object expected");t.attributes[n]=i.KeyValueDescriptor.fromObject(e.attributes[n])}}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.attributes=[]),e.attributes&&e.attributes.length){n.attributes=[];for(var r=0;r<e.attributes.length;++r)n.attributes[r]=i.KeyValueDescriptor.toObject(e.attributes[r],t)}return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/GetUserResponse"},r}(),i.ChannelMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.type=0,r.prototype.socketId="",r.prototype.data=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).uint32(e.type),null!=e.socketId&&Object.hasOwnProperty.call(e,"socketId")&&n.uint32(18).string(e.socketId),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(26).bytes(e.data),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ChannelMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.type=t.uint32();break;case 2:s.socketId=t.string();break;case 3:s.data=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isInteger(e.type)?"type: integer expected":null!=e.socketId&&e.hasOwnProperty("socketId")&&!n.isString(e.socketId)?"socketId: string expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null},r.fromObject=function(e){if(e instanceof i.ChannelMessage)return e;var t=new i.ChannelMessage;return null!=e.type&&(t.type=e.type>>>0),null!=e.socketId&&(t.socketId=String(e.socketId)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=0,i.socketId="",t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data)))),null!=e.type&&e.hasOwnProperty("type")&&(i.type=e.type),null!=e.socketId&&e.hasOwnProperty("socketId")&&(i.socketId=e.socketId),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ChannelMessage"},r}(),i.BytesBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=n.newBuffer([]),r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).bytes(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.BytesBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.bytes();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.BytesBytesPacketDataMessage)return e;var t=new i.BytesBytesPacketDataMessage;return null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data))),t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/BytesBytesPacketDataMessage"},r}(),i.NumberBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.NumberBytesPacketDataMessage)return e;var t=new i.NumberBytesPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data=0,t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberBytesPacketDataMessage"},r}(),i.NumberNumberPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(16).uint32(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberNumberPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isInteger(e.data1)?"data1: integer expected":null},r.fromObject=function(e){if(e instanceof i.NumberNumberPacketDataMessage)return e;var t=new i.NumberNumberPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=e.data1>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=0),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberNumberPacketDataMessage"},r}(),i.NumberObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.NumberObjectPacketDataMessage)return e;var t=new i.NumberObjectPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberObjectPacketDataMessage"},r}(),i.NumberStringPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data=0,r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(8).uint32(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.NumberStringPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.uint32();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isInteger(e.data)?"data: integer expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.NumberStringPacketDataMessage)return e;var t=new i.NumberStringPacketDataMessage;return null!=e.data&&(t.data=e.data>>>0),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data=0,n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/NumberStringPacketDataMessage"},r}(),i.ObjectBufferPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ObjectBufferPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.ObjectBufferPacketDataMessage)return e;var t=new i.ObjectBufferPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data="",t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ObjectBufferPacketDataMessage"},r}(),i.ObjectObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.ObjectObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.ObjectObjectPacketDataMessage)return e;var t=new i.ObjectObjectPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/ObjectObjectPacketDataMessage"},r}(),i.PacketMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.type=0,r.prototype.id=0,r.prototype.nsp="",r.prototype.data=n.newBuffer([]),r.prototype.options=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).uint32(e.type),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&n.uint32(16).uint32(e.id),null!=e.nsp&&Object.hasOwnProperty.call(e,"nsp")&&n.uint32(26).string(e.nsp),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(34).bytes(e.data),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&n.uint32(42).bytes(e.options),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.PacketMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.type=t.uint32();break;case 2:s.id=t.uint32();break;case 3:s.nsp=t.string();break;case 4:s.data=t.bytes();break;case 5:s.options=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.type&&e.hasOwnProperty("type")&&!n.isInteger(e.type)?"type: integer expected":null!=e.id&&e.hasOwnProperty("id")&&!n.isInteger(e.id)?"id: integer expected":null!=e.nsp&&e.hasOwnProperty("nsp")&&!n.isString(e.nsp)?"nsp: string expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||n.isString(e.data))?"data: buffer expected":null!=e.options&&e.hasOwnProperty("options")&&!(e.options&&"number"==typeof e.options.length||n.isString(e.options))?"options: buffer expected":null},r.fromObject=function(e){if(e instanceof i.PacketMessage)return e;var t=new i.PacketMessage;return null!=e.type&&(t.type=e.type>>>0),null!=e.id&&(t.id=e.id>>>0),null!=e.nsp&&(t.nsp=String(e.nsp)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),null!=e.options&&("string"==typeof e.options?n.base64.decode(e.options,t.options=n.newBuffer(n.base64.length(e.options)),0):e.options.length>=0&&(t.options=e.options)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.type=0,i.id=0,i.nsp="",t.bytes===String?i.data="":(i.data=[],t.bytes!==Array&&(i.data=n.newBuffer(i.data))),t.bytes===String?i.options="":(i.options=[],t.bytes!==Array&&(i.options=n.newBuffer(i.options)))),null!=e.type&&e.hasOwnProperty("type")&&(i.type=e.type),null!=e.id&&e.hasOwnProperty("id")&&(i.id=e.id),null!=e.nsp&&e.hasOwnProperty("nsp")&&(i.nsp=e.nsp),null!=e.data&&e.hasOwnProperty("data")&&(i.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.options&&e.hasOwnProperty("options")&&(i.options=t.bytes===String?n.base64.encode(e.options,0,e.options.length):t.bytes===Array?Array.prototype.slice.call(e.options):e.options),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/PacketMessage"},r}(),i.PacketOptionsMessage=function(){function r(e){if(this.rooms=[],this.except=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.flags="",r.prototype.rooms=n.emptyArray,r.prototype.except=n.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.flags&&Object.hasOwnProperty.call(e,"flags")&&n.uint32(10).string(e.flags),null!=e.rooms&&e.rooms.length)for(var i=0;i<e.rooms.length;++i)n.uint32(18).string(e.rooms[i]);if(null!=e.except&&e.except.length)for(i=0;i<e.except.length;++i)n.uint32(26).string(e.except[i]);return n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.PacketOptionsMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.flags=t.string();break;case 2:s.rooms&&s.rooms.length||(s.rooms=[]),s.rooms.push(t.string());break;case 3:s.except&&s.except.length||(s.except=[]),s.except.push(t.string());break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.flags&&e.hasOwnProperty("flags")&&!n.isString(e.flags))return"flags: string expected";if(null!=e.rooms&&e.hasOwnProperty("rooms")){if(!Array.isArray(e.rooms))return"rooms: array expected";for(var t=0;t<e.rooms.length;++t)if(!n.isString(e.rooms[t]))return"rooms: string[] expected"}if(null!=e.except&&e.hasOwnProperty("except")){if(!Array.isArray(e.except))return"except: array expected";for(t=0;t<e.except.length;++t)if(!n.isString(e.except[t]))return"except: string[] expected"}return null},r.fromObject=function(e){if(e instanceof i.PacketOptionsMessage)return e;var t=new i.PacketOptionsMessage;if(null!=e.flags&&(t.flags=String(e.flags)),e.rooms){if(!Array.isArray(e.rooms))throw TypeError(".PacketOptionsMessage.rooms: array expected");t.rooms=[];for(var n=0;n<e.rooms.length;++n)t.rooms[n]=String(e.rooms[n])}if(e.except){if(!Array.isArray(e.except))throw TypeError(".PacketOptionsMessage.except: array expected");for(t.except=[],n=0;n<e.except.length;++n)t.except[n]=String(e.except[n])}return t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.rooms=[],n.except=[]),t.defaults&&(n.flags=""),null!=e.flags&&e.hasOwnProperty("flags")&&(n.flags=e.flags),e.rooms&&e.rooms.length){n.rooms=[];for(var i=0;i<e.rooms.length;++i)n.rooms[i]=e.rooms[i]}if(e.except&&e.except.length)for(n.except=[],i=0;i<e.except.length;++i)n.except[i]=e.except[i];return n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/PacketOptionsMessage"},r}(),i.StringBytesPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=n.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).bytes(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringBytesPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.bytes();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!(e.data1&&"number"==typeof e.data1.length||n.isString(e.data1))?"data1: buffer expected":null},r.fromObject=function(e){if(e instanceof i.StringBytesPacketDataMessage)return e;var t=new i.StringBytesPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&("string"==typeof e.data1?n.base64.decode(e.data1,t.data1=n.newBuffer(n.base64.length(e.data1)),0):e.data1.length>=0&&(t.data1=e.data1)),t},r.toObject=function(e,t){t||(t={});var i={};return t.defaults&&(i.data="",t.bytes===String?i.data1="":(i.data1=[],t.bytes!==Array&&(i.data1=n.newBuffer(i.data1)))),null!=e.data&&e.hasOwnProperty("data")&&(i.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(i.data1=t.bytes===String?n.base64.encode(e.data1,0,e.data1.length):t.bytes===Array?Array.prototype.slice.call(e.data1):e.data1),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringBytesPacketDataMessage"},r}(),i.StringNumberPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(16).uint32(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringNumberPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.uint32();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isInteger(e.data1)?"data1: integer expected":null},r.fromObject=function(e){if(e instanceof i.StringNumberPacketDataMessage)return e;var t=new i.StringNumberPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=e.data1>>>0),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=0),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringNumberPacketDataMessage"},r}(),i.StringObjectPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringObjectPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.StringObjectPacketDataMessage)return e;var t=new i.StringObjectPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringObjectPacketDataMessage"},r}(),i.StringStringPacketDataMessage=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.data="",r.prototype.data1="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(10).string(e.data),null!=e.data1&&Object.hasOwnProperty.call(e,"data1")&&n.uint32(18).string(e.data1),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.StringStringPacketDataMessage;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.data=t.string();break;case 2:s.data1=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data)?"data: string expected":null!=e.data1&&e.hasOwnProperty("data1")&&!n.isString(e.data1)?"data1: string expected":null},r.fromObject=function(e){if(e instanceof i.StringStringPacketDataMessage)return e;var t=new i.StringStringPacketDataMessage;return null!=e.data&&(t.data=String(e.data)),null!=e.data1&&(t.data1=String(e.data1)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.data="",n.data1=""),null!=e.data&&e.hasOwnProperty("data")&&(n.data=e.data),null!=e.data1&&e.hasOwnProperty("data1")&&(n.data1=e.data1),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/StringStringPacketDataMessage"},r}(),i})();class MessagesCompressor{static decode(e,t){const n=_getType(t).decode("undefined"==typeof window?e:new Uint8Array(e));return t.fromJSON({...n})}static encode(e){const t=_getType(e.constructor),n=e.toJSON(),i=t.verify(n);if(i)throw Error(i);return t.encode(t.create(n)).finish()}}function _getType(e){return messages$1[e.DESCRIPTOR_NAME]}class GetManyUsersMessage extends Message{ids;static TYPE="22";static READABLE_TYPE_NAME="getManyUsers";static DESCRIPTOR_NAME="GetManyUsersMessage";static DESCRIPTOR={fields:{ids:{id:1,type:"string",rule:"repeated"}}};constructor(e){super(),this.ids=e}toJSON(){return{ids:this.ids}}static fromJSON(e){return new GetManyUsersMessage(e.ids)}}class GetManyUsersResponse extends Message{users;static DESCRIPTOR_NAME="GetManyUsersResponse";static DESCRIPTOR={fields:{users:{rule:"repeated",type:"UserDescriptor",id:1}}};constructor(e){super(),this.users=e}toJSON(){return{users:this.users.map(_userToJson)}}static fromJSON(e){return new GetManyUsersResponse(e.users.map(_userFromJson))}}function _userToJson(e){return{attributes:Object.keys(e).map((t=>({key:t,value:JSON.stringify(e[t])})))}}function _userFromJson(e){return e.attributes.reduce(((e,t)=>(e[t.key]=t.value?JSON.parse(t.value):null,e)),{})}class User{static _SERVICE=2;id;_attributes;constructor(e={}){this._attributes=new Map;for(const t of Object.keys(e))"id"!==t?(this._attributes.set(t,e[t]),Object.defineProperty(this,t,{enumerable:!0,configurable:!1,get:()=>this._attributes.get(t)})):this.id=e.id}static fromData(e){return new User(e)}static async get(e,t){const n=new GetUserMessage(t);try{const t=await e._sendRequest(User._SERVICE,GetUserMessage.TYPE,MessagesCompressor.encode(n)),i=MessagesCompressor.decode(t,GetUserResponse);return new User(i.attributes)}catch(e){return new User({id:t})}}static async getMany(e,t){const n=new GetManyUsersMessage(t);try{const t=await e._sendRequest(User._SERVICE,GetManyUsersMessage.TYPE,MessagesCompressor.encode(n));return MessagesCompressor.decode(t,GetManyUsersResponse).users.map((e=>new User(e)))}catch(e){return t.map((e=>new User({id:e})))}}}class ChannelMessage extends Message{type;socketId;data;static DESCRIPTOR_NAME="ChannelMessage";static DESCRIPTOR={fields:{type:{type:"uint32",id:1},socketId:{type:"string",id:2},data:{type:"bytes",id:3}}};constructor(e,t,n){super(),this.type=e,this.socketId=t,this.data=n}toJSON(){return{type:this.type,socketId:this.socketId,data:this.data}}static fromJSON(e){return new ChannelMessage(e.type,e.socketId,e.data)}}class Channel extends(/*   -- @preserve */
EmitterMixin()){_channelName;_wsGateway;_socket;constructor(e,t,n){super(),this._channelName=e,this._wsGateway=t,this._socket=n,this._subscribeToChannel()}remove(){this._socket.off(this._channelName)}getEventName(e,t=!1){let n="";return t&&(n+="all:"),n+="event",e&&(n+=":"+e),n}_subscribeToChannel(){this._socket.on(this._channelName,(e=>{const t=MessagesCompressor.decode(e,ChannelMessage);this.fire(this.getEventName(t.type,!0),t.data,t.socketId),t.socketId!==this._wsGateway.socketId&&this.fire(this.getEventName(t.type),t.data,t.socketId)}))}}class CKEditorCloudServicesError extends Error{context;code;data;constructor(e,t,n=null,i={}){super("cloud-services-internal-error: "+e),this.context=t,this.code=n,this.data=i,this.name="CKEditorError"}static fromPublicError(e){return new CKEditorCloudServicesError(function(e){let t="cloud-services-error: "+e.message;return e.data&&(t+="\nError data: "+JSON.stringify(e.data)),e.explanation&&(t+="\nExplanation: "+e.explanation),e.action&&(t+="\nAction: "+e.action),e.traceId&&(t+="\nTraceId: "+e.traceId),e.code&&(t+="\nCode: "+e.code),t}(e),e)}}class CKEditorCloudServicesServerError extends Error{code;traceId;data;constructor(e,t){super(),this.name="CKEditorCloudServicesServerError",this.stack=void 0,this.message=e,this.code=t.code,this.traceId=t.traceId,this.data=t.data}static fromPublicError(e){return new CKEditorCloudServicesServerError(function(e){let t="cloud-services-server-error: "+e.message;return e.explanation&&(t+="\nExplanation: "+e.explanation),e.action&&(t+="\nAction: "+e.action),e.traceId&&(t+="\nTraceId: "+e.traceId),e.code&&(t+="\nCode: "+e.code),t}(e),e)}}class PacketOptionsMessage extends Message{flags;rooms;except;static TYPE=11;static DESCRIPTOR_NAME="PacketOptionsMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{flags:{type:"string",id:1},rooms:{type:"string",id:2,rule:"repeated"},except:{type:"string",id:3,rule:"repeated"}}}))();constructor(e,t=[],n=[]){super(),this.flags=e,this.rooms=t,this.except=n}toJSON(){return{flags:this.flags?JSON.stringify(this.flags):void 0,rooms:this.rooms?.length?this.rooms:void 0,except:this.except?.length?this.except:void 0}}static fromJSON(e){return new PacketOptionsMessage(e.flags&&JSON.parse(e.flags),e.rooms,e.except)}}const IS_NODE=/*   -- @preserve */
(()=>!("undefined"==typeof process||!process.versions||!process.versions.node))(),MessageDataTypes_BUFFER=1,MessageDataTypes_STRING=2,MessageDataTypes_NUMBER=3,MessageDataTypes_OBJECT=4;class ParserUtils{static getPacketType(...e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*Math.pow(10,e.length-n-1);return t}static getType(e){if(ParserUtils.isBuffer(e))return MessageDataTypes_BUFFER;const t=typeof e;return"string"===t?MessageDataTypes_STRING:"number"===t?MessageDataTypes_NUMBER:MessageDataTypes_OBJECT}static isBuffer(e){return IS_NODE&&Buffer.isBuffer(e)||e instanceof ArrayBuffer||e instanceof Uint8Array||this._isBufferView(e)}static _isBufferView(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}}class PackageDataMessage extends Message{data;data1;static create(e,t){throw new TypeError("Must be implemented in a child class!")}}class NumberBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="NumberBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberBytesPacketDataMessage(e,t)}}class StringBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="StringBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringBytesPacketDataMessage(e,t)}}class BytesBytesPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_BUFFER,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="BytesBytesPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"bytes",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new BytesBytesPacketDataMessage(e.data,e.data1)}static create(e,t){return new BytesBytesPacketDataMessage(e,t)}}class StringObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="StringObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new StringObjectPacketDataMessage(e.data,e.data1&&JSON.parse(e.data1))}static create(e,t){return new StringObjectPacketDataMessage(e,t)}}class NumberObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="NumberObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new NumberObjectPacketDataMessage(e.data,e.data1&&JSON.parse(e.data1))}static create(e,t){return new NumberObjectPacketDataMessage(e,t)}}class ObjectObjectPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_OBJECT))();static DESCRIPTOR_NAME="ObjectObjectPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(e){return new ObjectObjectPacketDataMessage(e.data&&JSON.parse(e.data),e.data1&&JSON.parse(e.data1))}static create(e,t){return new ObjectObjectPacketDataMessage(e,t)}}class ObjectBufferPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_BUFFER))();static DESCRIPTOR_NAME="ObjectBufferPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1}}static fromJSON(e){return new ObjectBufferPacketDataMessage(e.data&&JSON.parse(e.data),e.data1)}static create(e,t){return new ObjectBufferPacketDataMessage(e,t)}}class StringStringPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_STRING))();static DESCRIPTOR_NAME="StringStringPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringStringPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringStringPacketDataMessage(e,t)}}class StringNumberPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_NUMBER))();static DESCRIPTOR_NAME="StringNumberPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"string",id:1},data1:{type:"uint32",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new StringNumberPacketDataMessage(e.data,e.data1)}static create(e,t){return new StringNumberPacketDataMessage(e,t)}}class NumberNumberPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_NUMBER))();static DESCRIPTOR_NAME="NumberNumberPacketDataMessage";static DESCRIPTOR={fields:{data:{type:"uint32",id:1},data1:{type:"uint32",id:2}}};constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberNumberPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberNumberPacketDataMessage(e,t)}}class NumberStringPacketDataMessage extends PackageDataMessage{data;data1;static TYPE=/*   -- @preserve */
(()=>ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_STRING))();static DESCRIPTOR_NAME="NumberStringPacketDataMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}}))();constructor(e,t){super(),this.data=e,this.data1=t}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(e){return new NumberStringPacketDataMessage(e.data,e.data1)}static create(e,t){return new NumberStringPacketDataMessage(e,t)}}const PACKET_DATA_MESSAGES=/*   -- @preserve */
(()=>[NumberBytesPacketDataMessage,StringBytesPacketDataMessage,BytesBytesPacketDataMessage,StringObjectPacketDataMessage,NumberObjectPacketDataMessage,ObjectObjectPacketDataMessage,ObjectBufferPacketDataMessage,StringStringPacketDataMessage,StringNumberPacketDataMessage,NumberNumberPacketDataMessage,NumberStringPacketDataMessage].reduce(((e,t)=>(e[t.TYPE]=t,e)),{}))();class PacketMessage extends Message{type;data;id;nsp;options;static TYPE=10;static DESCRIPTOR_NAME="PacketMessage";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{type:{type:"uint32",id:1},id:{type:"uint32",id:2},nsp:{type:"string",id:3},data:{type:"bytes",id:4},options:{type:"bytes",id:5}}}))();constructor(e,t,n,i="/",r){super(),this.type=e,this.data=t,this.id=n,this.nsp=i,this.options=r??new PacketOptionsMessage}get packetData(){return void 0===this.data.data&&void 0===this.data.data1?[]:this.data.data&&void 0===this.data.data1?[this.data.data]:[this.data.data,this.data.data1]}toJSON(){const e=MessagesCompressor.encode(this.options),t=MessagesCompressor.encode(this.data);return{type:this.type+10*this.data.constructor.TYPE,id:this.id,nsp:"/"===this.nsp?void 0:this.nsp,data:t,options:e}}static fromJSON(e){const t=Math.floor(e.type/10);return new PacketMessage(e.type-10*t,MessagesCompressor.decode(e.data,PACKET_DATA_MESSAGES[t]),e.id,e.nsp,e.options?MessagesCompressor.decode(e.options,PacketOptionsMessage):new PacketOptionsMessage)}static create(e,t={}){const n=ParserUtils.getPacketType(ParserUtils.getType(e.data[0]),ParserUtils.getType(e.data[1]??e.data[0]));return new PacketMessage(e.type,PACKET_DATA_MESSAGES[n].create(e.data[0],e.data[1]),e.id,e.nsp,new PacketOptionsMessage(t.flags,t.rooms,t.except))}}class PacketParser{encode(e,t,n,i="/",r={}){if(t.length>2)throw new Error("PacketParser supports only 2 elements in data");const s={type:e,data:t,id:n,nsp:i};return MessagesCompressor.encode(PacketMessage.create(s,r))}decode(e){const t=MessagesCompressor.decode(e,PacketMessage);return{packet:{id:t.id,type:t.type,data:t.packetData,nsp:t.nsp},options:{flags:t.options.flags,rooms:t.options.rooms,except:t.options.except}}}}const ENCODED_TYPES=/*   -- @preserve */
(()=>[PacketType.EVENT,PacketType.ACK,PacketType.BINARY_ACK,PacketType.BINARY_EVENT])();class Encoder extends Encoder$1{_packetParser;constructor(e){super(),this._packetParser=e??new PacketParser}encode(e){if(ENCODED_TYPES.includes(e.type))try{return[this._packetParser.encode(e.type,e.data,e.id,e.nsp)]}catch(e){console.error("Can not properly serialize or deserialize messages. Check the original error.",{originalError:{message:e.message}})}return super.encode(e)}}class Decoder extends Decoder$1{_packetParser;constructor(e){super(),this._packetParser=e??new PacketParser}add(e){if(!ParserUtils.isBuffer(e))return super.add(e);let t;try{t=this._packetParser.decode(e).packet}catch(t){return super.add(e)}super.emitReserved("decoded",t)}}class WebSocketRequest{_context;_deferredPromise;timeout;constructor(e,t){this._context=e,this._deferredPromise=/*   -- @preserve */
_deferPromise(),this.timeout=setTimeout((()=>this.error(new CKEditorCloudServicesError("Request timeout.",this._context))),t)}get promise(){return this._deferredPromise.promise}response(e){this._deferredPromise.resolve(e)}error(e){this._deferredPromise.reject(e)}}class WebSocketGatewayRequestsManager{_context;_requests;constructor(e){this._context=e,this._requests=new Set}async send(e,t=45e3){const n=this._createRequest(t);try{return e(n),await n.promise}finally{this._finishRequest(n)}}errorAll(e){for(const t of this._requests)t.error(e)}waitForAllRequests(e=45e3){return this._waitForRequests(e)}_createRequest(e){const t=new WebSocketRequest(this._context,e);return this._requests.add(t),t}_finishRequest(e){this._requests.delete(e),clearTimeout(e.timeout)}async _waitForRequests(e=5e3,t=0){return!this._requests.size||t>=e/500?Promise.resolve():(await new Promise((e=>{setTimeout(e,500)})),this._waitForRequests(e,t++))}}function _deferPromise(){let e,t;const n=new Promise(((n,i)=>{e=n,t=i}));return{resolve:e,reject:t,promise:n}}const WEB_SOCKET_GATEWAY_STATES={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"};let WebSocketGateway$1=class e extends(/*   -- @preserve */
_0x45ca07()){_requestsManager;_url;_socket;_socketAuth;_channels;_connectionAttempt=0;_token;_options;_connectionProvider;_userFactory;static STATE_DISCONNECTED=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.DISCONNECTED)();static STATE_CONNECTING=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.CONNECTING)();static STATE_CONNECTED=/*   -- @preserve */
(()=>WEB_SOCKET_GATEWAY_STATES.CONNECTED)();static _CHANGE_STATE_EVENT_PRIORITY=/*   -- @preserve */
(()=>priorities$1.get("highest")+999999)();constructor(t,n,i,r,s){if(super(),this._token=n,this._options=i??{},this._connectionProvider=r??lookup,this._userFactory=s??User.get,this._requestsManager=new WebSocketGatewayRequestsManager(this),this._channels=new Map,!t)throw new TypeError("Api address must be provided.");if(!this._token)throw new TypeError("Token must be provided.");this._options.requestTimeout||(this._options.requestTimeout=2e4),this._url=urlParse(t.replace(/^(?!(?:\w+:)?\/\/)/,"https://")),this.set("state",WEB_SOCKET_GATEWAY_STATES.DISCONNECTED),this.set("socketId",void 0),this.set("me",void 0),this.on("change:state",(async(t,n,i)=>{if(this._debugEvent("ws-gw:change:state",i),i!==e.STATE_CONNECTED){if(i===e.STATE_DISCONNECTED)return this._requestsManager.errorAll(new CKEditorCloudServicesError("Not connected.",this))}else try{this.me=await this._userFactory.call(User,this,this._socketAuth?.userId)}catch(e){}}),{priority:e._CHANGE_STATE_EVENT_PRIORITY}),this.on("error",((e,t)=>{this._options.onError?this._options.onError(t):console.error(t)}))}get sessionId(){return this.socketId}waitForAllRequests(e){return this._requestsManager.waitForAllRequests(e)}disconnect(){this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&(this._socket?.disconnect(),this._socket=void 0,this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED)}async reconnect(){this._socket||this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED||(await this._token.refreshToken(),await this._connect())}static async connect(t,n="local.cs.dev:443/ws-v2",i={},r=lookup,s=User.get){const o=new e(n,t,i,r,s);return await o._connect(),o}_sendRequest(t,n,i){if(!t)throw new CKEditorCloudServicesError("`serviceName` must be provided.",this);if(this.state!==e.STATE_CONNECTED)throw new CKEditorCloudServicesError("Not connected.",this);if(!this._socketAuth||!this._socketAuth.isAuthenticated)throw new CKEditorCloudServicesError("Not authenticated.",this);const r=new ArrayBuffer(i.length+2),s=new Uint8Array(r);return s[0]=t,s[1]=parseInt(n),s.set(i,2),this._emit(1,s)}_getChannel(e,t){const n=""+e+t;return!this._channels.has(n)&&this._socket&&this._channels.set(n,new Channel(n,this,this._socket)),this._channels.get(n)}_connect(){return new Promise(((e,t)=>{const n=this._setupSocket();!this.socketId&&n.io.on("reconnect_error",(()=>{this._debugEvent("reconnect_error"),this._reconnectionAttemptError(t)})),n.once("connect",(async()=>{this._debugEvent("once-connect");try{await this._onConnect(),e()}catch(e){t(e)}})),n.connect()}))}_getPortByProtocol(e){return["http:","ws:"].includes(e)?80:443}_setupSocket(){if(this._socket)return this._socket;const e=this._url.port||this._getPortByProtocol(this._url.protocol),t=(this._url.protocol||"https:")+"//"+this._url.hostname+":"+e,n=this._url.pathname.match(/^\/.*\/ws/)?this._url.pathname.split("/ws")[0]:"",i=this._connectionProvider(t,{parser:{Encoder:Encoder,Decoder:Decoder},path:n+"/ws-v2/ws",transports:["websocket"],timeout:void 0!==this._options.timeout?this._options.timeout:5e3,reconnection:void 0===this._options.autoReconnect||this._options.autoReconnect,reconnectionDelay:1e3,reconnectionDelayMax:5e3,rejectUnauthorized:void 0===this._options.rejectUnauthorized||this._options.rejectUnauthorized,query:{version:"52.6.11"},agent:this._options.agent??!1,closeOnBeforeunload:!1});return this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,i.on("connect",(()=>{this._debugEvent("connect"),this.socketId=i.id})),i.on("connect_error",(e=>{this._debugEvent("connect_error",e)})),i.on("disconnect",(()=>{this._debugEvent("disconnect"),this._onDisconnect()})),i.io.on("reconnect",(async()=>{this._debugEvent("reconnect"),await this._onReconnect()})),i.io.on("reconnect_attempt",(e=>{this._debugEvent("reconnect_attempt",e),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,this._connectionAttempt=e})),i.on("unauthorized",(e=>{this._debugEvent("unauthorized"),this._onUnauthorized(e)})),i.on("authenticationRequest",(async e=>{this._debugEvent("authenticationRequest",e.attempt),await this._onReconnect()})),this._socket=i,i}_emit(e,t){const n=this._socket;return this._requestsManager.send((i=>{n.emit(e,t,((e,t)=>{if(e)return i.error(CKEditorCloudServicesServerError.fromPublicError(e));i.response(t)}))}),this._options.requestTimeout)}_addAuthData(e,t){this._socketAuth={environmentId:e,userId:t,isAuthenticated:!0}}_removeAuthData(){this._socketAuth=void 0}async _onConnect(){await this._authenticate(this._token.value),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED;const e=async(e,t,n)=>{this._debugEvent("token:value:change");try{await this._authenticate(n)}catch(e){}};this._token.on("change:value",e),this._socket.io.off("reconnect_error"),this.on("disconnect",(()=>{this._token.off("change:value",e)}))}async _onReconnect(){await this._token.refreshToken(),await this._onConnect()}_onDisconnect(){this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._connectionAttempt=0,this.fire("disconnect");for(const e of this._channels.values())e.remove();this._channels.clear(),void 0===this._options.autoReconnect||this._options.autoReconnect||(this._socket=void 0)}_debugEvent(e,t){if(!this._isDebugModeEnabled())return;const n=void 0!==t?", data: "+t:"";console.info((new Date).toLocaleString()+" "+e+n)}_reconnectionAttemptError(e){this._connectionAttempt>=2&&(this.disconnect(),e(CKEditorCloudServicesError.fromPublicError({message:"The number of initial connection attempts exceeded.",explanation:"Three initial connection attempts failed. It can be caused by a slow, unstable, missing or blocked Internet connection.",action:"Please verify the stability of your Internet connection and ensure that no antivirus or firewall software blocks the Web Socket protocol connections."})))}_onUnauthorized({error:e}){this._removeAuthData(),this.fire("error",CKEditorCloudServicesServerError.fromPublicError(e))}async _authenticate(e){try{this._debugEvent("authenticate:start");const t=await this._emit(2,{token:e});this._debugEvent("authenticate:success","envId: "+t.environmentId+", userId: "+t.userId),this._addAuthData(t.environmentId,t.userId)}catch(e){throw this._debugEvent("authenticate:error",e.message),this._removeAuthData(),e}}_isDebugModeEnabled(){return!!_0x41fffa.window.localStorage&&"true"===(_0x41fffa.window.localStorage.getItem("csClientDebugMode")??"false").toLowerCase()}};class IsEditorBundleUploadedMessage extends Message{bundleVersion;static TYPE="131";static READABLE_TYPE_NAME="isEditorBundleUploaded";static DESCRIPTOR_NAME="IsEditorBundleUploadedMessage";static DESCRIPTOR={fields:{bundleVersion:{type:"string",id:1}}};constructor(e){super(),this.bundleVersion=e}toJSON(){return{bundleVersion:this.bundleVersion}}static fromJSON(e){return new IsEditorBundleUploadedMessage(e.bundleVersion)}}class IsEditorBundleUploadedResponse extends Message{isUploaded;static DESCRIPTOR_NAME="IsEditorBundleUploadedResponse";static DESCRIPTOR={fields:{isUploaded:{type:"bool",id:1}}};constructor(e){super(),this.isUploaded=e}toJSON(){return{isUploaded:this.isUploaded}}static fromJSON(e){return new IsEditorBundleUploadedResponse(e.isUploaded)}}class EditorService extends(/*   -- @preserve */
EmitterMixin()){static _SERVICE=13;static async isBundleUploaded(e,t){const n=new IsEditorBundleUploadedMessage(t);if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const i=await e._sendRequest(EditorService._SERVICE,IsEditorBundleUploadedMessage.TYPE,MessagesCompressor.encode(n));return MessagesCompressor.decode(i,IsEditorBundleUploadedResponse).isUploaded}}class RevisionHistoryGetRevisionMessage extends Message{documentId;revisionId;static TYPE="123";static READABLE_TYPE_NAME="getRevision";static DESCRIPTOR_NAME="RevisionHistoryGetRevisionMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},revisionId:{type:"string",id:2}}};constructor(e,t){super(),this.documentId=e,this.revisionId=t}toJSON(){return{documentId:this.documentId,revisionId:this.revisionId}}static fromJSON(e){return new RevisionHistoryGetRevisionMessage(e.documentId,e.revisionId)}}class RevisionDescriptor extends Descriptor{static DESCRIPTOR_NAME="RevisionDescriptor";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{revisionId:{type:"string",id:1},name:{type:"string",id:2},creatorId:{type:"string",id:3},authorsIds:{type:"string",id:4},diffData:{type:"string",id:5},createdAt:{type:"string",id:6},attributes:{type:"string",id:7},toVersion:{type:"uint32",id:8},fromVersion:{type:"uint32",id:9},isEmptyCurrent:{type:"bool",id:10}}}))();static create(e){return{revisionId:e.id,name:e.name,creatorId:e.creatorId,createdAt:e.createdAt,fromVersion:e.fromVersion,toVersion:e.toVersion,isEmptyCurrent:e.isEmptyCurrent,diffData:e.diffData?JSON.stringify(e.diffData):void 0,attributes:e.attributes,authorsIds:e.authorsIds}}static toJSON(e){return{revisionId:e.revisionId,name:e.name,creatorId:e.creatorId,authorsIds:e.authorsIds?JSON.stringify(e.authorsIds):void 0,diffData:e.diffData,createdAt:e.createdAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):void 0,toVersion:e.toVersion,fromVersion:e.fromVersion,isEmptyCurrent:e.isEmptyCurrent}}static fromJSON(e){return{revisionId:(e={...e}).revisionId,name:e.name,creatorId:e.creatorId,authorsIds:e.authorsIds?JSON.parse(e.authorsIds):void 0,diffData:e.diffData,createdAt:e.createdAt?new Date(e.createdAt):void 0,attributes:e.attributes?JSON.parse(e.attributes):void 0,toVersion:e.toVersion,fromVersion:e.fromVersion,isEmptyCurrent:e.isEmptyCurrent}}static toObject(e){return function(e){for(const[t,n]of Object.entries(e))void 0===n&&delete e[t];return e}({id:e.revisionId,name:e.name,creatorId:e.creatorId,createdAt:e.createdAt,fromVersion:e.fromVersion,toVersion:e.toVersion,isEmptyCurrent:e.isEmptyCurrent,diffData:e.diffData?JSON.parse(e.diffData):void 0,attributes:e.attributes,authorsIds:e.authorsIds})}}class RevisionHistoryGetRevisionResponse extends Message{revisionId;name;creatorId;authorsIds;createdAt;diffData;attributes;fromVersion;toVersion;isEmptyCurrent;static DESCRIPTOR_NAME="RevisionHistoryGetRevisionResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>RevisionDescriptor.DESCRIPTOR)();constructor(e,t,n,i,r,s,o,a,l,c){super(),this.revisionId=e,this.name=t,this.creatorId=n,this.authorsIds=i,this.createdAt=r,this.diffData=s,this.attributes=o,this.fromVersion=a,this.toVersion=l,this.isEmptyCurrent=c}toJSON(){return RevisionDescriptor.toJSON(this)}toObject(){return RevisionDescriptor.toObject(this)}static create(e){return new RevisionHistoryGetRevisionResponse(e.revisionId,e.name,e.creatorId,e.authorsIds,e.createdAt,e.diffData,e.attributes,e.fromVersion,e.toVersion,e.isEmptyCurrent)}static fromJSON(e){return new RevisionHistoryGetRevisionResponse(e.revisionId,e.name,e.creatorId,e.authorsIds?JSON.parse(e.authorsIds):void 0,e.createdAt?new Date(e.createdAt):void 0,e.diffData,e.attributes?JSON.parse(e.attributes):void 0,e.fromVersion,e.toVersion,e.isEmptyCurrent)}}class RevisionHistoryUpdateRevisionsMessage extends Message{documentId;requestId;revisions;static TYPE="124";static READABLE_TYPE_NAME="updateRevisions";static DESCRIPTOR_NAME="RevisionHistoryUpdateRevisionsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}};constructor(e,t,n){super(),this.documentId=e,this.requestId=t,this.revisions=n}toJSON(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static create(e){return new RevisionHistoryUpdateRevisionsMessage(e.documentId,e.requestId,e.revisions.map(RevisionDescriptor.create))}static fromJSON(e){return new RevisionHistoryUpdateRevisionsMessage(e.documentId,e.requestId,e.revisions.map(RevisionDescriptor.fromJSON))}}class RevisionHistoryUpdateRevisionsResponse extends Message{requestId;static DESCRIPTOR_NAME="RevisionHistoryUpdateRevisionsResponse";static DESCRIPTOR={fields:{requestId:{type:"uint32",id:1}}};constructor(e){super(),this.requestId=e}toJSON(){return{requestId:this.requestId}}static fromJSON(e){return new RevisionHistoryUpdateRevisionsResponse(e.requestId)}}class RevisionHistoryConnectMessage extends Message{documentId;static TYPE="121";static READABLE_TYPE_NAME="connectToRevisionHistory";static DESCRIPTOR_NAME="RevisionHistoryConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new RevisionHistoryConnectMessage(e.documentId)}}class RevisionHistoryConnectResponse extends Message{channel;requestId;revisions;static DESCRIPTOR_NAME="RevisionHistoryConnectResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{channel:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}}))();constructor(e,t,n){super(),this.channel=e,this.requestId=t,this.revisions=n}toJSON(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static fromJSON(e){return new RevisionHistoryConnectResponse(e.channel,e.requestId,e.revisions.map(RevisionDescriptor.fromJSON))}}class RevisionHistoryReconnectMessage extends Message{documentId;requestId;static TYPE="122";static READABLE_TYPE_NAME="reconnectToRevisionHistory";static DESCRIPTOR_NAME="RevisionHistoryReconnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2}}};constructor(e,t){super(),this.documentId=e,this.requestId=t}toJSON(){return{documentId:this.documentId,requestId:this.requestId}}static fromJSON(e){return new RevisionHistoryReconnectMessage(e.documentId,e.requestId)}}class ServiceNotConnectedError extends CKEditorCloudServicesError{constructor(e,t){super(e+" Service is not connected.",t)}}class RevisionHistoryService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;static _SERVICE=12;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}connect(e){return this._isConnected?Promise.resolve():this._connect(e,new RevisionHistoryConnectMessage(this._documentId))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}reconnect(e,t){if(this.isConnected)throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",e);return this._connect(e,new RevisionHistoryReconnectMessage(this._documentId,t))}async updateRevisions(e,t){const n=RevisionHistoryUpdateRevisionsMessage.create({documentId:this._documentId,requestId:t,revisions:e}),i=await this._sendRequest(RevisionHistoryUpdateRevisionsMessage.TYPE,n),{requestId:r}=MessagesCompressor.decode(i,RevisionHistoryUpdateRevisionsResponse);return r}async getRevision(e){const t=new RevisionHistoryGetRevisionMessage(this._documentId,e),n=await this._sendRequest(RevisionHistoryGetRevisionMessage.TYPE,t);return MessagesCompressor.decode(n,RevisionHistoryGetRevisionResponse).toObject()}async _connect(e,t){if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(12,t.constructor.TYPE,MessagesCompressor.encode(t)),{channel:i,requestId:r,revisions:s}=MessagesCompressor.decode(n,RevisionHistoryConnectResponse).toObject();return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i),this._isConnected=!0,this.fire("connected"),{revisions:s,requestId:r}}_connectToChannel(e,t){this._channel=e._getChannel(RevisionHistoryService._SERVICE,t),this._channel&&this.listenTo(this._channel,this._channel.getEventName(RevisionHistoryUpdateRevisionsMessage.TYPE),((e,t)=>{const{documentId:n,requestId:i,revisions:r}=MessagesCompressor.decode(t,RevisionHistoryUpdateRevisionsMessage).toObject();this.fire("revisionsUpdated",{documentId:n,requestId:i,revisionsData:r})}))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Revision History",this);return this._wsGateway._sendRequest(12,e,MessagesCompressor.encode(t))}}class AddSuggestionMessage extends Message{id;documentId;type;data;originalSuggestionId;attributes;static TYPE="101";static READABLE_TYPE_NAME="addSuggestion";static DESCRIPTOR_NAME="TrackChangesAddSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},type:{type:"string",id:3},data:{type:"string",id:4},originalSuggestionId:{type:"string",id:5},attributes:{type:"string",id:6}}};constructor(e,t,n,i={},r=null,s=null){super(),this.id=e,this.documentId=t,this.type=n,this.data=i,this.originalSuggestionId=r,this.attributes=s}toJSON(){return{id:this.id,documentId:this.documentId,type:this.type,data:JSON.stringify(this.data),originalSuggestionId:this.originalSuggestionId,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new AddSuggestionMessage(e.id,e.documentId,e.type,JSON.parse(e.data),e.originalSuggestionId??null,e.attributes?JSON.parse(e.attributes):null)}}class AddSuggestionResponse extends Message{id;authorId;type;hasComments;state;data;attributes;createdAt;static DESCRIPTOR_NAME="TrackChangesAddSuggestionResponse";static DESCRIPTOR={fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}};constructor(e,t,n,i,r,s,o={},a=null){super(),this.id=e,this.authorId=t,this.type=n,this.hasComments=r,this.state=s,this.data=o,this.attributes=a,this.createdAt=i?new Date(i):void 0}toJSON(){return{id:this.id,authorId:this.authorId,type:this.type,createdAt:this.createdAt?.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new AddSuggestionResponse(e.id,e.authorId,e.type,e.createdAt,e.hasComments,e.state,JSON.parse(e.data),e.attributes?JSON.parse(e.attributes):null)}}class GetSuggestionMessage extends Message{id;documentId;static TYPE="103";static READABLE_TYPE_NAME="getSuggestion";static DESCRIPTOR_NAME="TrackChangesGetSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.id=e,this.documentId=t}toJSON(){return{id:this.id,documentId:this.documentId}}static fromJSON(e){return new GetSuggestionMessage(e.id,e.documentId)}}class GetSuggestionResponse extends Message{id;authorId;type;hasComments;state;data;attributes;createdAt;static DESCRIPTOR_NAME="TrackChangesGetSuggestionResponse";static DESCRIPTOR={fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}};constructor(e,t,n,i,r,s,o={},a=null){super(),this.id=e,this.authorId=t,this.type=n,this.hasComments=r,this.state=s,this.data=o,this.attributes=a,this.createdAt=new Date(i)}toJSON(){return{id:this.id,authorId:this.authorId,type:this.type,createdAt:this.createdAt.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new GetSuggestionResponse(e.id,e.authorId,e.type,e.createdAt,e.hasComments,e.state,JSON.parse(e.data),e.attributes?JSON.parse(e.attributes):null)}}class GetAllSuggestionsMessage extends Message{documentId;static TYPE="102";static READABLE_TYPE_NAME="getAllSuggestions";static DESCRIPTOR_NAME="TrackChangesGetAllSuggestionMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetAllSuggestionsMessage(e.documentId)}}class SuggestionDescriptor extends Descriptor{static DESCRIPTOR_NAME="SuggestionDescriptor";static DESCRIPTOR={fields:{id:{id:1,type:"string"},authorId:{id:2,type:"string"},type:{id:3,type:"string"},createdAt:{id:4,type:"string"},data:{id:5,type:"string"},hasComments:{id:6,type:"bool"},state:{id:7,type:"string"},attributes:{id:8,type:"string"}}};static toJSON(e){return{...e,data:e.data?JSON.stringify(e.data):e.data,attributes:e.attributes?JSON.stringify(e.attributes):e.attributes,createdAt:e.createdAt?.toISOString()}}static fromJSON(e){return{...e,data:e.data?JSON.parse(e.data):e.data,attributes:e.attributes?JSON.parse(e.attributes):e.attributes,createdAt:e.createdAt?new Date(e.createdAt):void 0}}}class GetAllSuggestionResponse extends Message{_suggestions;_suggestionsV2;suggestions;static DESCRIPTOR_NAME="TrackChangesGetAllSuggestionsResponse";static DESCRIPTOR={fields:{suggestions:{type:"string",rule:"repeated",id:1},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:2}}};constructor(e,t){super(),this._suggestions=e,this._suggestionsV2=t,this.suggestions=t?.length?t:e}toJSON(){return{suggestions:this._suggestions?.map((e=>JSON.stringify(e))),suggestionsV2:this._suggestionsV2?.map(SuggestionDescriptor.toJSON)}}static fromJSON(e){return new GetAllSuggestionResponse(e.suggestions?.map(_suggestionFromString),e.suggestionsV2?.map(SuggestionDescriptor.fromJSON))}}function _suggestionFromString(e){const t=JSON.parse(e);return t.createdAt=t.createdAt?new Date(t.createdAt):void 0,t}class UpdateSuggestionMessage extends Message{id;documentId;hasComments;isHasCommentsModified;state;attributes;static TYPE="104";static READABLE_TYPE_NAME="updateSuggestion";static DESCRIPTOR_NAME="TrackChangesUpdateSuggestionMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},hasComments:{type:"bool",id:3},isHasCommentsModified:{type:"bool",id:4},state:{type:"string",id:5},attributes:{type:"string",id:6}}};constructor(e,t,n,i,r,s=null){super(),this.id=e,this.documentId=t,this.hasComments=n,this.isHasCommentsModified=i,this.state=r,this.attributes=s}toJSON(){return{id:this.id,documentId:this.documentId,hasComments:this.hasComments,isHasCommentsModified:this.isHasCommentsModified,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(e){return new UpdateSuggestionMessage(e.id,e.documentId,e.hasComments,e.isHasCommentsModified,e.state,e.attributes?JSON.parse(e.attributes):null)}}let ConnectMessage$1=class e extends Message{documentId;static TYPE="105";static READABLE_TYPE_NAME="connectToSuggestions";static DESCRIPTOR_NAME="TrackChangesConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new e(t.documentId)}},ConnectResponse$1=class e extends Message{channel;_suggestions;_suggestionsV2;suggestions;static DESCRIPTOR_NAME="TrackChangesConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},suggestions:{type:"string",rule:"repeated",id:2},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:3}}};constructor(e,t,n){super(),this.channel=e,this._suggestions=t,this._suggestionsV2=n,this.suggestions=n?.length?n:t}toJSON(){return{channel:this.channel,suggestions:this._suggestions?.map((e=>JSON.stringify(e))),suggestionsV2:this._suggestionsV2?.map(SuggestionDescriptor.toJSON)}}static fromJSON(t){return new e(t.channel,t.suggestions?.map((e=>JSON.parse(e))),t.suggestionsV2?.map(SuggestionDescriptor.fromJSON))}};class BatchUpdateSuggestionsStateMessage extends Message{ids;documentId;state;static TYPE="106";static READABLE_TYPE_NAME="batchUpdateSuggestionsState";static DESCRIPTOR_NAME="TrackChangesBatchUpdateSuggestionsStateMessage";static DESCRIPTOR={fields:{ids:{type:"string",rule:"repeated",id:1},documentId:{type:"string",id:2},state:{type:"string",id:3}}};constructor(e,t,n){super(),this.ids=e,this.documentId=t,this.state=n}toJSON(){return{ids:this.ids,documentId:this.documentId,state:this.state}}static fromJSON(e){return new BatchUpdateSuggestionsStateMessage(e.ids,e.documentId,e.state)}}class TrackChangesService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;static _SERVICE=10;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(e){if(this._isConnected)return;if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const t=new ConnectMessage$1(this._documentId);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(10,ConnectMessage$1.TYPE,MessagesCompressor.encode(t)),i=MessagesCompressor.decode(n,ConnectResponse$1);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i.channel),this._isConnected=!0,this.fire("connected"),i.suggestions}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}async add(e,t,n,i=null,r){const s=new AddSuggestionMessage(e,this._documentId,t,n,i,r),o=await this._sendRequest(AddSuggestionMessage.TYPE,s);return MessagesCompressor.decode(o,AddSuggestionResponse)}async get(e,t=1){const n=new GetSuggestionMessage(e,this._documentId);try{const e=await this._sendRequest(GetSuggestionMessage.TYPE,n);return MessagesCompressor.decode(e,GetSuggestionResponse)}catch(n){if("CKEditorCloudServicesServerError"===n.name&&"404"===n.code&&t<5)return await(i=100*t,new Promise((e=>{setTimeout(e,i)}))),this.get(e,t+1);if("CKEditorCloudServicesServerError"===n.name)throw n;throw CKEditorCloudServicesServerError.fromPublicError(n)}var i}async getAll(){const e=new GetAllSuggestionsMessage(this._documentId),t=await this._sendRequest(GetAllSuggestionsMessage.TYPE,e),{suggestions:n}=MessagesCompressor.decode(t,GetAllSuggestionResponse);return n}async update(e,t={}){const{hasComments:n,state:i,attributes:r}=t,s=void 0!==n,o=new UpdateSuggestionMessage(e,this._documentId,n,s,i,r);await this._sendRequest(UpdateSuggestionMessage.TYPE,o)}async batchUpdateState(e){const t=new BatchUpdateSuggestionsStateMessage(e.ids,this._documentId,e.state);await this._sendRequest(BatchUpdateSuggestionsStateMessage.TYPE,t)}_connectToChannel(e,t){this._channel=e._getChannel(TrackChangesService._SERVICE,t),this._channel&&this.listenTo(this._channel,this._channel.getEventName(UpdateSuggestionMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateSuggestionMessage);this.fire("suggestionUpdated",n)}))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Track Changes",this);return this._wsGateway._sendRequest(10,e,MessagesCompressor.encode(t))}}class SessionsConnectResponse extends Message{channel;sockets;static DESCRIPTOR_NAME="SessionsConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},sockets:{rule:"repeated",type:"SessionsSocketDescriptor",id:2}}};constructor(e,t=[]){super(),this.channel=e,this.sockets=t}toJSON(){return{channel:this.channel,sockets:this.sockets.map((e=>({user:e.userId,session:e.id,role:e.role,permissions:e.permissions})))}}static fromJSON(e){return new SessionsConnectResponse(e.channel,e.sockets.map((e=>({id:e.session,userId:e.user,role:e.role,permissions:e.permissions}))))}}class SessionsConnectMessage extends Message{id;sessionType;static TYPE="31";static READABLE_TYPE_NAME="getConnectedSockets";static DESCRIPTOR_NAME="SessionsConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},sessionType:{type:"uint32",id:2}}};constructor(e,t){super(),this.id=e,this.sessionType=t}toJSON(){return{id:this.id,sessionType:this.sessionType}}static fromJSON(e){return new SessionsConnectMessage(e.id,e.sessionType)}}class SocketConnectMessage extends Message{id;userId;role;permissions;static TYPE="32";static READABLE_TYPE_NAME="connectSocket";static DESCRIPTOR_NAME="SocketConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},userId:{type:"string",id:2},role:{type:"string",id:3},permissions:{rule:"repeated",type:"string",id:4}}};constructor(e,t,n,i){super(),this.id=e,this.userId=t,this.role=n,this.permissions=i}toJSON(){return{id:this.id,userId:this.userId??void 0,role:this.role??void 0,permissions:this.permissions??void 0}}static fromJSON(e){return new SocketConnectMessage(e.id,e.userId,e.role,e.permissions)}}class SocketDisconnectMessage extends Message{id;static TYPE="33";static READABLE_TYPE_NAME="disconnectSocket";static DESCRIPTOR_NAME="SocketDisconnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1}}};constructor(e){super(),this.id=e}toJSON(){return{id:this.id}}static fromJSON(e){return new SocketDisconnectMessage(e.id)}}class SessionCollection extends Collection$1{_id;_sessionType;_handlers;_channel;_wsGateway;_connected;_eventsQueue;_isRunning;constructor(e,t){super({idProperty:"id"}),this._id=e,this._sessionType=t,this._handlers=new Map,this._eventsQueue=[],this._isRunning=!1}async connect(e){this._wsGateway=e,this.stopListening(e,"change:state");const t=new SessionsConnectMessage(this._id,this._sessionType);let n;try{const e=await this._wsGateway._sendRequest(3,SessionsConnectMessage.TYPE,MessagesCompressor.encode(t));n=MessagesCompressor.decode(e,SessionsConnectResponse)}catch(e){n=new SessionsConnectResponse(this._id,[])}this._connectToChannel(this._wsGateway,n.channel,this._sessionType);const i=await async function(e,t){const n=t.map((e=>e.userId)),i=n.length?await User.getMany(e,n):[];return t.map((e=>{const t={id:e.id,role:e.role,permissions:e.permissions};return t.user=e.userId&&i.find((t=>t.id===e.userId))||new User,t}))}(this._wsGateway,n.sockets);for(const e of i)super.add(e);this._connected=!0,this.fire("connected"),this.listenTo(this._wsGateway,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),await this._runQueue()}disconnect(e=!0){if(this._connected){for(this._connected=!1,this._eventsQueue=[];this.length;)super.remove(0);this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._wsGateway&&e&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this.fire("disconnected"),e&&this.stopListening()}}add(e,t){throw new TypeError("The collection is read-only.")}remove(e){throw new TypeError("The collection is read-only.")}_connectToChannel(e,t,n){this._channel=e._getChannel(n,t),this._channel&&(this._addHandler(this._channel,SocketConnectMessage.TYPE,(async t=>{const n=MessagesCompressor.decode(t,SocketConnectMessage);if(-1===this.getIndex(n.id)){const t={id:n.id,role:n.role,permissions:n.permissions};n.userId&&(t.user=await User.get(e,n.userId)),super.add(t)}})),this._addHandler(this._channel,SocketDisconnectMessage.TYPE,(e=>{const t=MessagesCompressor.decode(e,SocketDisconnectMessage);-1!==this.getIndex(t.id)&&super.remove(t.id)})))}async _onWsGatewayStateChange(e){e===WebSocketGateway$1.STATE_DISCONNECTED&&this.disconnect(!1),e===WebSocketGateway$1.STATE_CONNECTED&&await this.connect(this._wsGateway)}async _runQueue(){if(this._isRunning||!this._connected)return;let e;for(this._isRunning=!0;e=this._eventsQueue.shift();){const t=this._handlers.get(e.eventName);t&&await t(e.data)}this._isRunning=!1}_addHandler(e,t,n){const i=e.getEventName(t,!0);this.listenTo(e,i,(async(e,t)=>{const n=e.name;this._eventsQueue.push({eventName:n,data:t}),await this._runQueue()})),this._handlers.set(i,n)}}let Sessions$1=class{static async getConnectedSessions(e,t,n){const i=new SessionCollection(t,n);return await i.connect(e),i}};class CollaborativeEditingConnectMessage extends Message{id;buffers;types;bundleVersion;lastOperationId;static TYPE="11";static READABLE_TYPE_NAME="connectToDocument";static DESCRIPTOR_NAME="CollaborativeEditingConnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},lastOperationId:{type:"string",id:5}}};constructor(e,t,n,i,r=""){super(),this.id=e,this.buffers=t,this.types=n,this.bundleVersion=i,this.lastOperationId=r}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,bundleVersion:this.bundleVersion,lastOperationId:this.lastOperationId}}static fromJSON(e){return new CollaborativeEditingConnectMessage(e.id,e.buffers,e.types,e.bundleVersion,e.lastOperationId)}}class OperationMetadataHelpers{static prepareMetadataForOperations(e,t){if(!(e&&e.length&&t&&t.length))return[];const n=[];let i=0;for(const r of e)if(0!==r){if(!t[i])throw new Error("Missing metadata for a operation");n.push(t[i]),i++}else n.push(n[n.length-1]);return n}static removeUnnecessaryMetadata(e,t){if(!(e&&e.length&&t&&t.length))return[];const n=[];for(let i=0;i<e.length;i++)if(0!==e[i]){if(!t[i])throw new Error("Missing metadata for a operation");n.push(t[i])}return n}}class OperationMetadataDescriptor extends Descriptor{static DESCRIPTOR_NAME="OperationMetadataDescriptor";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{userId:{type:"string",id:1},type:{type:"string",id:2},createdAt:{type:"string",id:3}}}))();static toJSON({createdAt:e,...t}){const n={...t};return e?.toISOString&&(n.createdAt=e.toISOString()),n}static fromJSON({createdAt:e,...t}){const n={...t};return e&&(n.createdAt=new Date(e)),n}}class CollaborativeEditingUpdateMessage extends Message{id;buffers;types;baseVersion;metadata;lastOperationId;static TYPE="13";static READABLE_TYPE_NAME="updateDocument";static DESCRIPTOR_NAME="CollaborativeEditingUpdateMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},baseVersion:{type:"uint32",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:6},lastOperationId:{type:"string",id:7}}};constructor(e,t,n,i,r=[],s=""){super(),this.id=e,this.buffers=t,this.types=n,this.baseVersion=i,this.metadata=r,this.lastOperationId=s}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,lastOperationId:this.lastOperationId}}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId}}static fromJSON(e){return new CollaborativeEditingUpdateMessage(e.id,e.buffers,e.types,e.baseVersion,OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),e.lastOperationId)}}class CollaborativeEditingReconnectMessage extends Message{id;lastKnowVersion;bundleVersion;static TYPE="12";static READABLE_TYPE_NAME="reconnectToDocument";static DESCRIPTOR_NAME="CollaborativeEditingReconnectMessage";static DESCRIPTOR={fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},lastKnowVersion:{type:"uint32",id:3}}};constructor(e,t,n){super(),this.id=e,this.lastKnowVersion=t,this.bundleVersion=n}toJSON(){return{id:this.id,bundleVersion:this.bundleVersion,lastKnowVersion:this.lastKnowVersion}}static fromJSON(e){return new CollaborativeEditingReconnectMessage(e.id,e.lastKnowVersion,e.bundleVersion)}}class CollaborativeEditingResponse extends Message{version;buffers;types;metadata;lastOperationId;lastOperationAcceptedAt;static DESCRIPTOR_NAME="CollaborativeEditingResponse";static DESCRIPTOR={fields:{version:{type:"uint32",id:1},buffers:{rule:"repeated",type:"bytes",id:2},types:{rule:"repeated",type:"uint32",id:3},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:5},lastOperationId:{type:"string",id:6},lastOperationAcceptedAt:{type:"string",id:7}}};constructor(e,t=[],n=[],i=[],r="",s=null){super(),this.version=e,this.buffers=t,this.types=n,this.metadata=i,this.lastOperationId=r,this.lastOperationAcceptedAt=s}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt}}get wereChangesApplied(){return!this.types?.length}toJSON(){return{version:this.version,buffers:this.buffers,types:this.types,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt instanceof Date?this.lastOperationAcceptedAt.toISOString():this.lastOperationAcceptedAt}}static fromJSON(e){return new CollaborativeEditingResponse(e.version,e.buffers,e.types,OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),e.lastOperationId,e.lastOperationAcceptedAt?new Date(e.lastOperationAcceptedAt):null)}static create(e){return new CollaborativeEditingResponse(e.version,e.buffers,e.types,e.metadata,e.lastOperationId,e.lastOperationAcceptedAt?new Date(e.lastOperationAcceptedAt):null)}}class CollaborativeEditingConnectResponse extends Message{channel;version;buffers;types;offset;metadata;initData;sessionId;lastOperationId;sessionCreatedAt;static DESCRIPTOR_NAME="CollaborativeEditingConnectResponse";static DESCRIPTOR=/*   -- @preserve */
(()=>({fields:{channel:{type:"string",id:1},offset:{type:"uint32",id:2},version:{type:"uint32",id:3},buffers:{rule:"repeated",type:"bytes",id:4},types:{rule:"repeated",type:"uint32",id:5},metadata:{rule:"repeated",type:OperationMetadataDescriptor.DESCRIPTOR_NAME,id:7},initData:{type:"string",id:8},isInitialized:{type:"bool",id:9},sessionId:{type:"string",id:10},lastOperationId:{type:"string",id:11},sessionCreatedAt:{type:"string",id:12}}}))();constructor(e,t,n=[],i=[],r=0,s=[],o=null,a="",l="",c=null){super(),this.channel=e,this.version=t,this.buffers=n,this.types=i,this.offset=r,this.metadata=s,this.initData=o,this.sessionId=a,this.lastOperationId=l,this.sessionCreatedAt=c}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt}}get wereChangesApplied(){return!this.types?.length&&null===this.initData}toJSON(){return{channel:this.channel,version:this.version,sessionId:this.sessionId,buffers:this.buffers,types:this.types,offset:this.offset,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),initData:this.initData??"",isInitialized:"string"==typeof this.initData,lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt?this.sessionCreatedAt.toISOString():null}}static create(e){return new CollaborativeEditingConnectResponse(e.channel,e.version,e.buffers,e.types,e.offset,e.metadata,e.initData,e.sessionId,e.lastOperationId,e.sessionCreatedAt)}static fromJSON(e){let t=null;return!0===e.isInitialized?t=e.initData??"":"boolean"!=typeof e.isInitialized&&e.initData&&(t=e.initData),CollaborativeEditingConnectResponse.create({channel:e.channel,version:e.version,buffers:e.buffers,types:e.types,offset:e.offset,metadata:OperationMetadataHelpers.prepareMetadataForOperations(e.types,e.metadata).map(OperationMetadataDescriptor.fromJSON),initData:t,sessionId:e.sessionId,lastOperationId:e.lastOperationId,sessionCreatedAt:e.sessionCreatedAt?new Date(e.sessionCreatedAt):null})}}class GetDocumentDetailsResponse extends Message{lastDocumentSession;currentDocumentSession;static DESCRIPTOR_NAME="GetDocumentDetailsResponse";static DESCRIPTOR={fields:{lastDocumentSessionId:{type:"string",id:1},lastDocumentSessionOperationId:{type:"string",id:2},currentDocumentSessionId:{type:"string",id:3},currentDocumentSessionVersion:{type:"uint32",id:4},currentDocumentSessionOperationId:{type:"string",id:5}}};constructor(e,t){super(),this.lastDocumentSession=e,this.currentDocumentSession=t}get data(){return{lastDocumentSessionId:this.lastDocumentSession?.id,lastDocumentSessionOperationId:this.lastDocumentSession?.lastOperationId,currentDocumentSessionId:this.currentDocumentSession?.id,currentDocumentSessionVersion:this.currentDocumentSession?.version,currentDocumentSessionOperationId:this.currentDocumentSession?.lastOperationId}}toJSON(){return{lastDocumentSessionId:this.lastDocumentSession?.id,lastDocumentSessionOperationId:this.lastDocumentSession?.lastOperationId,currentDocumentSessionId:this.currentDocumentSession?.id,currentDocumentSessionVersion:this.currentDocumentSession?.version,currentDocumentSessionOperationId:this.currentDocumentSession?.lastOperationId}}static fromJSON(e){const t=e.lastDocumentSessionId?{id:e.lastDocumentSessionId,lastOperationId:e.lastDocumentSessionOperationId}:void 0,n=e.currentDocumentSessionId?{lastOperationId:e.currentDocumentSessionOperationId,version:e.currentDocumentSessionVersion,id:e.currentDocumentSessionId}:void 0;return new GetDocumentDetailsResponse(t,n)}}class GetDocumentDetailsMessage extends Message{documentId;static TYPE="14";static READABLE_TYPE_NAME="getDocumentDetails";static DESCRIPTOR_NAME="GetDocumentDetailsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},environmentId:{type:"string",id:2}}};constructor(e){super(),this.documentId=e}get data(){return{documentId:this.documentId}}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetDocumentDetailsMessage(e.documentId)}}class CollaborativeEditingService extends(/*   -- @preserve */
EmitterMixin()){static _SERVICE=1;_bundleVersion;_id;_isConnected;_wsGateway;_channel;_connectedSessions;constructor(e,t){if(super(),!e)throw new TypeError('Param "bundleVersion" must be provided.');this._id=t??v4(),this._isConnected=!1,this._bundleVersion=e}getId(){return this._id}isConnected(){return this._isConnected}connect(e,t={buffers:[],types:[]},n){const i=new CollaborativeEditingConnectMessage(this.getId(),t.buffers,t.types,this._bundleVersion,n);return this._connect(e,i)}reconnect(e,t){if(this.isConnected())throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",e);return this._connect(e,new CollaborativeEditingReconnectMessage(this.getId(),t,this._bundleVersion))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async getDocumentDetails(){const e=new GetDocumentDetailsMessage(this.getId());if(!this._wsGateway)throw new ServiceNotConnectedError("Collaborative Editing",this);const t=await this._wsGateway._sendRequest(1,GetDocumentDetailsMessage.TYPE,MessagesCompressor.encode(e));return MessagesCompressor.decode(t,GetDocumentDetailsResponse)}async sendOperations(e,t,n){if(!e||!e.types||!e.types.length)throw new CKEditorCloudServicesError("Cannot send empty update.",this._wsGateway);const i="number"==typeof t?t:parseInt(t);if(!Number.isInteger(i)||i<0)throw new CKEditorCloudServicesError("Base version not provided.",this._wsGateway);const r=new CollaborativeEditingUpdateMessage(this.getId(),e.buffers,e.types,i,[],n);if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);const s=await this._wsGateway._sendRequest(1,CollaborativeEditingUpdateMessage.TYPE,MessagesCompressor.encode(r));return MessagesCompressor.decode(s,CollaborativeEditingResponse)}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);return this._connectedSessions||(this._connectedSessions=await Sessions$1.getConnectedSessions(this._wsGateway,this._id,1)),this._connectedSessions}static getConnectedSessions(e,t){return Sessions$1.getConnectedSessions(e,t,1)}async _connect(e,t){if(this.isConnected())return;if(e.state!==WebSocketGateway$1.STATE_CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(1,t.constructor.TYPE,MessagesCompressor.encode(t)),i=MessagesCompressor.decode(n,CollaborativeEditingConnectResponse);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i.channel),this._isConnected=!0,this.fire("connected"),i}_connectToChannel(e,t){this._channel=e._getChannel(1,t),this.listenTo(this._channel,this._channel.getEventName(CollaborativeEditingUpdateMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,CollaborativeEditingUpdateMessage);this.fire("operationsReceived",n.baseVersion,n.data,n.metadata)}))}_onWsGatewayStateChange(e){e===WebSocketGateway$1.STATE_DISCONNECTED&&this.disconnect()}}class CommentDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentDescriptor";static DESCRIPTOR={fields:{commentId:{id:1,type:"string"},commentThreadId:{id:2,type:"string"},userId:{id:3,type:"string"},content:{id:4,type:"string"},documentId:{id:5,type:"string"},createdAt:{id:6,type:"string"},attributes:{id:7,type:"string"}}};static toJSON(e){return{...e,createdAt:e.createdAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):null}}static fromJSON(e){return{...e,createdAt:new Date(e.createdAt),attributes:e.attributes?JSON.parse(e.attributes):null}}}class CommentsThreadDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentsThreadDescriptor";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},comments:{type:"CommentDescriptor",rule:"repeated",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4},context:{type:"string",id:5},createdAt:{type:"string",id:6},deletedAt:{type:"string",id:7},attributes:{type:"string",id:8},unlinkedAt:{type:"string",id:9}}};static toJSON(e){return{...e,createdAt:e.createdAt?.toISOString(),deletedAt:e.deletedAt?.toISOString(),resolvedAt:e.resolvedAt?.toISOString(),attributes:e.attributes?JSON.stringify(e.attributes):null,context:e.context?JSON.stringify(e.context):e.context,comments:e.comments?.map(CommentDescriptor.toJSON),unlinkedAt:e.unlinkedAt?.toISOString()}}static fromJSON(e){return{...e,createdAt:e.createdAt?new Date(e.createdAt):void 0,deletedAt:e.deletedAt?new Date(e.deletedAt):void 0,resolvedAt:e.resolvedAt?new Date(e.resolvedAt):void 0,attributes:e.attributes?JSON.parse(e.attributes):null,context:e.context?JSON.parse(e.context):void 0,comments:e.comments?.map(CommentDescriptor.fromJSON),unlinkedAt:e.unlinkedAt?new Date(e.unlinkedAt):void 0}}}class AddCommentMessage extends Message{documentId;commentThreadId;content;commentId;userId;attributes;commentThread;createdAt;static TYPE="91";static READABLE_TYPE_NAME="addComment";static DESCRIPTOR_NAME="CommentsV2AddCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},content:{type:"string",id:2},documentId:{type:"string",id:3},commentId:{type:"string",id:4},createdAt:{type:"string",id:5},userId:{type:"string",id:6},attributes:{type:"string",id:7},commentThread:{type:"CommentsThreadDescriptor",id:8}}};constructor(e,t,n,i="",r,s="",o=null,a){super(),this.documentId=e,this.commentThreadId=t,this.content=n,this.commentId=i,this.userId=s,this.attributes=o,this.commentThread=a,this.createdAt=r?new Date(r):""}toJSON(){return{commentThreadId:this.commentThreadId,content:this.content,documentId:this.documentId,commentId:this.commentId,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,userId:this.userId,attributes:JSON.stringify(this.attributes),commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(e){return new AddCommentMessage(e.documentId,e.commentThreadId,e.content,e.commentId?e.commentId:void 0,e.createdAt?new Date(e.createdAt):void 0,e.userId?e.userId:void 0,e.attributes?JSON.parse(e.attributes):{},e.commentThread?CommentsThreadDescriptor.fromJSON(e.commentThread):void 0)}}class AddCommentResponse extends Message{commentThreadId;commentId;createdAt;static DESCRIPTOR_NAME="CommentsV2AddCommentResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},createdAt:{type:"string",id:3}}};constructor(e,t,n){super(),this.commentThreadId=e,this.commentId=t,this.createdAt=new Date(n)}toJSON(){return{commentThreadId:this.commentThreadId,commentId:this.commentId,createdAt:this.createdAt.toISOString()}}static fromJSON(e){return new AddCommentResponse(e.commentThreadId,e.commentId,e.createdAt)}}class ConnectMessage extends Message{documentId;static TYPE="92";static READABLE_TYPE_NAME="connectToComment";static DESCRIPTOR_NAME="CommentsV2ConnectMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new ConnectMessage(e.documentId)}}class ConnectResponse extends Message{channel;_threads;_threadsV2;threads;static DESCRIPTOR_NAME="CommentsV2ConnectResponse";static DESCRIPTOR={fields:{channel:{type:"string",id:1},threads:{type:"string",rule:"repeated",id:2},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:3}}};constructor(e,t,n){super(),this.channel=e,this._threads=t,this._threadsV2=n,this.threads=n?.length?n:t}toJSON(){return{channel:this.channel,threads:this._threads?.map((e=>JSON.stringify(e))),threadsV2:this._threadsV2?.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(e){return new ConnectResponse(e.channel,e.threads?.map((e=>JSON.parse(e))),e.threadsV2?.map(CommentsThreadDescriptor.fromJSON))}}class RemoveCommentMessage extends Message{documentId;commentThreadId;commentId;static TYPE="95";static READABLE_TYPE_NAME="removeComment";static DESCRIPTOR_NAME="CommentsV2RemoveCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},documentId:{type:"string",id:3}}};constructor(e,t,n){super(),this.documentId=e,this.commentThreadId=t,this.commentId=n}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId}}static fromJSON(e){return new RemoveCommentMessage(e.documentId,e.commentThreadId,e.commentId)}}class RemoveCommentThreadMessage extends Message{documentId;commentThreadId;static TYPE="97";static READABLE_TYPE_NAME="removeCommentThread";static DESCRIPTOR_NAME="CommentsV2RemoveCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.documentId=e,this.commentThreadId=t}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(e){return new RemoveCommentThreadMessage(e.documentId,e.commentThreadId)}}class UpdateCommentMessage extends Message{documentId;commentThreadId;commentId;content;attributes;isAttributesUpdated;commentThread;static TYPE="96";static READABLE_TYPE_NAME="updateComment";static DESCRIPTOR_NAME="CommentsV2UpdateCommentMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},content:{type:"string",id:3},documentId:{type:"string",id:4},attributes:{type:"string",id:5},isAttributesUpdated:{type:"bool",id:6},commentThread:{type:"CommentsThreadDescriptor",id:7}}};constructor(e,t,n,i,r=null,s=!1,o){super(),this.documentId=e,this.commentThreadId=t,this.commentId=n,this.content=i,this.attributes=r,this.isAttributesUpdated=s,this.commentThread=o}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId,content:this.content,attributes:this.attributes?JSON.stringify(this.attributes):null,isAttributesUpdated:this.isAttributesUpdated,commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(e){return new UpdateCommentMessage(e.documentId,e.commentThreadId,e.commentId,e.content,e.attributes?JSON.parse(e.attributes):null,e.isAttributesUpdated,e.commentThread?CommentsThreadDescriptor.fromJSON(e.commentThread):void 0)}}class GetCommentThreadMessage extends Message{commentThreadId;documentId;static TYPE="93";static READABLE_TYPE_NAME="getComment";static DESCRIPTOR_NAME="CommentsV2GetCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.commentThreadId=e,this.documentId=t}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId}}static fromJSON(e){return new GetCommentThreadMessage(e.commentThreadId,e.documentId)}}class GetCommentThreadResponse extends Message{commentThreadId;_comments;_commentsV2;resolvedBy;comments;createdAt;deletedAt;resolvedAt;attributes;context;unlinkedAt;static DESCRIPTOR_NAME="CommentsV2GetCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},comments:{type:"string",rule:"repeated",id:2},commentsV2:{type:"CommentDescriptor",rule:"repeated",id:3},resolvedAt:{type:"string",id:4},resolvedBy:{type:"string",id:5},context:{type:"string",id:6},createdAt:{type:"string",id:7},deletedAt:{type:"string",id:8},attributes:{type:"string",id:9},unlinkedAt:{type:"string",id:10}}};constructor(e,t,n,i,r,s,o,a,l,c){super(),this.commentThreadId=e,this._comments=t,this._commentsV2=n,this.resolvedBy=r,this.comments=n?.length?n:t,this.createdAt=o?new Date(o):void 0,this.deletedAt="string"==typeof a?new Date(a):a,this.resolvedAt="string"==typeof l?new Date(l):l,this.unlinkedAt="string"==typeof c?new Date(c):c,this.attributes="string"==typeof i?JSON.parse(i):i,this.context="string"==typeof s?JSON.parse(s):s}toJSON(){return{commentThreadId:this.commentThreadId,comments:this._comments?.map((e=>JSON.stringify(e))),commentsV2:this._commentsV2?.map(CommentDescriptor.toJSON),attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,context:this.context?JSON.stringify(this.context):this.context,resolvedBy:this.resolvedBy,createdAt:this.createdAt?.toISOString(),deletedAt:this.deletedAt?.toISOString(),resolvedAt:this.resolvedAt?.toISOString(),unlinkedAt:this.unlinkedAt?.toISOString()}}static fromJSON(e){return new GetCommentThreadResponse(e.commentThreadId,e.comments?.map((e=>function(e){const t=JSON.parse(e);return{...t,createdAt:new Date(t.createdAt)}}(e))),e.commentsV2?.map(CommentDescriptor.fromJSON),e.attributes?JSON.parse(e.attributes):e.attributes,e.resolvedBy,e.context?JSON.parse(e.context):e.context,e.createdAt,e.deletedAt,e.resolvedAt,e.unlinkedAt)}}class GetDocumentThreadsMessage extends Message{documentId;static TYPE="94";static READABLE_TYPE_NAME="getDocumentThreads";static DESCRIPTOR_NAME="CommentsV2GetDocumentThreadsMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1}}};constructor(e){super(),this.documentId=e}toJSON(){return{documentId:this.documentId}}static fromJSON(e){return new GetDocumentThreadsMessage(e.documentId)}}class GetDocumentThreadsResponse extends Message{_threads;_threadsV2;threads;static DESCRIPTOR_NAME="CommentsV2GetDocumentThreadsResponse";static DESCRIPTOR={fields:{threads:{type:"string",rule:"repeated",id:1},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:2}}};constructor(e,t){super(),this._threads=e,this._threadsV2=t,this.threads=t?.length?t:e}toJSON(){return{threads:this._threads?.map((e=>JSON.stringify(e))),threadsV2:this._threadsV2?.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(e){return new GetDocumentThreadsResponse(e.threads?.map((e=>function(e){const t=JSON.parse(e),n={...t};return t.comments&&(n.comments=t.comments?.map((e=>({...e,createdAt:new Date(e.createdAt)})))),n}(e))),e.threadsV2?.map(CommentsThreadDescriptor.fromJSON))}}class CommentThreadAddedCommentDescriptor extends Descriptor{static DESCRIPTOR_NAME="CommentThreadAddedCommentDescriptor";static DESCRIPTOR={fields:{commentId:{id:1,type:"string"},createdAt:{id:2,type:"string"}}};static toJSON(e){return{commentId:e.commentId,createdAt:e.createdAt?.toISOString()}}static fromJSON(e){return{commentId:e.commentId,createdAt:new Date(e.createdAt)}}}class AddCommentThreadResponse extends Message{commentThreadId;comments;createdAt;static DESCRIPTOR_NAME="CommentsV2AddCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},createdAt:{type:"string",id:2},comments:{type:"CommentThreadAddedCommentDescriptor",rule:"repeated",id:3}}};constructor(e,t,n=[]){super(),this.commentThreadId=e,this.comments=n,this.createdAt=new Date(t)}toJSON(){return{commentThreadId:this.commentThreadId,createdAt:this.createdAt.toISOString(),comments:this.comments.map((e=>CommentThreadAddedCommentDescriptor.toJSON(e)))}}static fromJSON(e){return new AddCommentThreadResponse(e.commentThreadId,e.createdAt,e.comments.map((e=>CommentThreadAddedCommentDescriptor.fromJSON(e))))}}class AddCommentThreadMessage extends Message{documentId;commentThreadId;comments;context;resolvedBy;attributes;createdAt;resolvedAt;deletedAt;static TYPE="140";static READABLE_TYPE_NAME="addCommentThread";static DESCRIPTOR_NAME="CommentsV2AddCommentThreadMessage";static DESCRIPTOR={fields:{documentId:{type:"string",id:1},commentThreadId:{type:"string",id:2},context:{type:"string",id:3},createdAt:{type:"string",id:4},resolvedAt:{type:"string",id:5},resolvedBy:{type:"string",id:6},attributes:{type:"string",id:7},deletedAt:{type:"string",id:8},comments:{type:"CommentDescriptor",rule:"repeated",id:9}}};constructor(e,t,n=[],i,r=null,s=null,o=null,a=null,l=null){super(),this.documentId=e,this.commentThreadId=t,this.comments=n,this.context=i,this.resolvedBy=r,this.attributes=l,this.createdAt=s?new Date(s):"",this.resolvedAt=o?new Date(o):"",this.deletedAt=a?new Date(a):""}toJSON(){return{commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt instanceof Date?this.resolvedAt.toISOString():this.resolvedAt,deletedAt:this.deletedAt instanceof Date?this.deletedAt.toISOString():this.deletedAt,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,comments:this.comments?.map((e=>CommentDescriptor.toJSON(e)))}}static fromJSON(e){return new AddCommentThreadMessage(e.documentId,e.commentThreadId,e.comments?.map((t=>CommentDescriptor.fromJSON({...t,documentId:e.documentId,commentThreadId:e.commentThreadId}))),e.context?JSON.parse(e.context):e.context,e.resolvedBy,e.createdAt?new Date(e.createdAt):void 0,e.resolvedAt?new Date(e.resolvedAt):void 0,e.deletedAt?new Date(e.deletedAt):void 0,e.attributes?JSON.parse(e.attributes):e.attributes)}}class ResolveCommentThreadMessage extends Message{commentThreadId;documentId;resolvedBy;resolvedAt;static TYPE="142";static READABLE_TYPE_NAME="resolveCommentThread";static DESCRIPTOR_NAME="CommentsV2ResolveCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedBy:{type:"string",id:3},resolvedAt:{type:"string",id:4}}};constructor(e,t,n,i){super(),this.commentThreadId=e,this.documentId=t,this.resolvedBy=n,this.resolvedAt=i?new Date(i):void 0}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt?.toISOString()}}static fromJSON(e){return new ResolveCommentThreadMessage(e.commentThreadId,e.documentId,e.resolvedBy,e.resolvedAt)}}class ReopenCommentThreadMessage extends Message{commentThreadId;documentId;static TYPE="141";static READABLE_TYPE_NAME="reopenCommentThread";static DESCRIPTOR_NAME="CommentsV2ReopenCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}};constructor(e,t){super(),this.commentThreadId=e,this.documentId=t}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(e){return new ReopenCommentThreadMessage(e.commentThreadId,e.documentId)}}class UpdateCommentThreadMessage extends Message{commentThreadId;documentId;context;attributes;unlinkedAt;static TYPE="143";static READABLE_TYPE_NAME="updateCommentThread";static DESCRIPTOR_NAME="CommentsV2UpdateCommentThreadMessage";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},context:{type:"string",id:3},attributes:{type:"string",id:4},unlinkedAt:{type:"string",id:5}}};constructor(e,t,n,i=null,r=null){super(),this.commentThreadId=e,this.documentId=t,this.context=n,this.attributes=i,this.unlinkedAt=r?new Date(r):""}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,attributes:this.attributes?JSON.stringify(this.attributes):null,unlinkedAt:this.unlinkedAt instanceof Date?this.unlinkedAt.toISOString():this.unlinkedAt}}static fromJSON(e){return new UpdateCommentThreadMessage(e.commentThreadId,e.documentId,e.context?JSON.parse(e.context):e.context,e.attributes?JSON.parse(e.attributes):null,e.unlinkedAt?new Date(e.unlinkedAt):null)}}class ResolveCommentThreadResponse extends Message{commentThreadId;documentId;resolvedBy;resolvedAt;static DESCRIPTOR_NAME="CommentsV2ResolveCommentThreadResponse";static DESCRIPTOR={fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4}}};constructor(e,t,n,i){super(),this.commentThreadId=e,this.documentId=t,this.resolvedBy=n,this.resolvedAt=new Date(i)}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt.toISOString()}}static fromJSON(e){return new ResolveCommentThreadResponse(e.commentThreadId,e.documentId,e.resolvedBy,e.resolvedAt)}}class CommentsService extends(/*   -- @preserve */
EmitterMixin()){_documentId;_isConnected;_wsGateway;_channel;_connectedSessions;static _SERVICE=9;constructor(e){super(),this._documentId=e,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(e){if(this._isConnected)return;if(e.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",e);const t=new ConnectMessage(this._documentId);this._wsGateway=e,this.stopListening(e,"change:state");const n=await e._sendRequest(9,ConnectMessage.TYPE,MessagesCompressor.encode(t)),{channel:i,threads:r}=MessagesCompressor.decode(n,ConnectResponse);return this.listenTo(e,"change:state",((e,t,n)=>this._onWsGatewayStateChange(n)),{priority:WebSocketGateway$1._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(e,i),this._isConnected=!0,this.fire("connected"),r}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async addComment(e,t,n,i){const r=new AddCommentMessage(this._documentId,e,n,t,void 0,void 0,i),s=await this._sendRequest(AddCommentMessage.TYPE,r);return MessagesCompressor.decode(s,AddCommentResponse)}async updateComment(e,t,n,i){const r=void 0!==i,s=new UpdateCommentMessage(this._documentId,e,t,n,i,r);await this._sendRequest(UpdateCommentMessage.TYPE,s)}async removeComment(e,t){const n=new RemoveCommentMessage(this._documentId,e,t);await this._sendRequest(RemoveCommentMessage.TYPE,n)}async removeCommentThread(e){const t=new RemoveCommentThreadMessage(this._documentId,e);await this._sendRequest(RemoveCommentThreadMessage.TYPE,t)}async addCommentThread(e){const t=new AddCommentThreadMessage(this._documentId,e.commentThreadId,e.comments?.map((t=>({...t,documentId:this._documentId,commentThreadId:e.commentThreadId}))),e.context,e.resolvedBy,e.createdAt,e.resolvedAt,e.deletedAt,e.attributes),n=await this._sendRequest(AddCommentThreadMessage.TYPE,t);return MessagesCompressor.decode(n,AddCommentThreadResponse)}async resolveCommentThread(e){const t=new ResolveCommentThreadMessage(e,this._documentId),n=await this._sendRequest(ResolveCommentThreadMessage.TYPE,t);return MessagesCompressor.decode(n,ResolveCommentThreadResponse)}async reopenCommentThread(e){const t=new ReopenCommentThreadMessage(e,this._documentId);await this._sendRequest(ReopenCommentThreadMessage.TYPE,t)}async updateCommentThread(e){const t=new UpdateCommentThreadMessage(e.commentThreadId,this._documentId,e.context,e.attributes,e.unlinkedAt);await this._sendRequest(UpdateCommentThreadMessage.TYPE,t)}async getCommentThread(e,t=1){const n=new GetCommentThreadMessage(e,this._documentId);try{const e=await this._sendRequest(GetCommentThreadMessage.TYPE,n),t=MessagesCompressor.decode(e,GetCommentThreadResponse);return{commentThreadId:t.commentThreadId,comments:t.comments,attributes:t.attributes,context:t.context,resolvedAt:t.resolvedAt,resolvedBy:t.resolvedBy,deletedAt:t.deletedAt,unlinkedAt:t.unlinkedAt}}catch(n){if("CKEditorCloudServicesServerError"===n.name&&"404"===n.code&&t<5)return await(i=100*t,new Promise((e=>{setTimeout(e,i)}))),this.getCommentThread(e,t+1);if("CKEditorCloudServicesServerError"===n.name)throw n;throw CKEditorCloudServicesServerError.fromPublicError(n)}var i}async getDocumentThreads(){const e=new GetDocumentThreadsMessage(this._documentId),t=await this._sendRequest(GetDocumentThreadsMessage.TYPE,e),{threads:n}=MessagesCompressor.decode(t,GetDocumentThreadsResponse);return{threads:n}}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._connectedSessions||(this._connectedSessions=await Sessions$1.getConnectedSessions(this._wsGateway,this._documentId,9)),this._connectedSessions}_connectToChannel(e,t){this._channel=e._getChannel(CommentsService._SERVICE,t),this._channel&&(this.listenTo(this._channel,this._channel.getEventName(AddCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,AddCommentMessage);this.fire("commentAdded",n)})),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,RemoveCommentMessage);this.fire("commentRemoved",n)})),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateCommentMessage);this.fire("commentUpdated",n)})),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,RemoveCommentThreadMessage);this.fire("commentThreadRemoved",n)})),this.listenTo(this._channel,this._channel.getEventName(AddCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,AddCommentThreadMessage);this.fire("commentThreadAdded",n)})),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,UpdateCommentThreadMessage);this.fire("commentThreadUpdated",n)})),this.listenTo(this._channel,this._channel.getEventName(ResolveCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,ResolveCommentThreadMessage);this.fire("commentThreadResolved",n)})),this.listenTo(this._channel,this._channel.getEventName(ReopenCommentThreadMessage.TYPE),((e,t)=>{const n=MessagesCompressor.decode(t,ReopenCommentThreadMessage);this.fire("commentThreadReopened",n)})))}_onWsGatewayStateChange(e){e===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(e,t){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._wsGateway._sendRequest(9,e,MessagesCompressor.encode(t))}}class WebSocketGateway extends ContextPlugin{static get requires(){return["CloudServices",Notification]}static get pluginName(){return"WebSocketGateway"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this.set("state",WEB_SOCKET_GATEWAY_STATES.CONNECTED),this.set("_isBrowserOffline",!1),this._reconnectionStack=new Set,this._shouldPluginsReconnect=!1,this._domEmitter=Object.create(DomEmitterMixin)}init(){const e=this.context,t=e.plugins.get("CloudServices"),n=e.plugins.get(Notification);if(!t.token)throw new CKEditorError("websocketgateway-missing-token",this);if(!t.webSocketUrl)throw new CKEditorError("websocketgateway-missing-websocket-url",this);return this._domEmitter.listenTo(window,"offline",(()=>this._isBrowserOffline=!0)),this._domEmitter.listenTo(window,"online",(()=>this._isBrowserOffline=!1)),this.context.config.define("cloudServices.connectionTimeout",10),this.context.config.define("cloudServices.requestTimeout",20),WebSocketGateway.WebSocketGateway.connect(t.token,t.webSocketUrl,{timeout:1e3*this.context.config.get("cloudServices.connectionTimeout"),requestTimeout:1e3*this.context.config.get("cloudServices.requestTimeout")}).then((e=>{if(this.connection=e,this.bind("state").to(e,"state",this,"_isBrowserOffline",((e,t)=>("connected"!==e&&(this._shouldPluginsReconnect=!0),t||e!==WEB_SOCKET_GATEWAY_STATES.CONNECTED?WEB_SOCKET_GATEWAY_STATES.DISCONNECTED:this.state==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this._shouldPluginsReconnect?(this._shouldPluginsReconnect=!1,this._reconnect(),WEB_SOCKET_GATEWAY_STATES.CONNECTING):WEB_SOCKET_GATEWAY_STATES.CONNECTED))),this.connection.on("error",((e,t)=>{if("limitExceeded"!==t.code)throw console.error(t),new CKEditorError("cloudservices-init",null,{originalError:t});n.showWarning("The limit of maximum concurrent connections that the collaboration server can handle has been reached. Try opening the document again in a few minutes. Please contact your system administrator if the problem persists.",{title:"Connected users limit exceeded",namespace:"real-time-collaboration"})})),!e.me)return new Promise((t=>e.on("change:me",t)))})).catch((e=>{throw console.error(e),new CKEditorError("cloudservices-init",null,{originalError:e})}))}addToReconnectionStack(e){if("function"!=typeof e.reconnect)throw new CKEditorError("websocketgateway-invalid-plugin-interface",this);if(this.isInReconnectionStack(e))throw new CKEditorError("websocketgateway-plugin-already-registered",this,{name:e.constructor.pluginName});this._reconnectionStack.add(e)}removeFromReconnectionStack(e){this._reconnectionStack.delete(e)}isInReconnectionStack(e){return this._reconnectionStack.has(e)}_reconnect(){return this.connection.reconnect().then((()=>Promise.all(Array.from(this._reconnectionStack,(e=>e.reconnect()))))).then((()=>this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED)).catch((e=>{throw console.error(e),new CKEditorError("cloudservices-reconnection-error",this.context)}))}disconnect(){this.connection&&this.connection.disconnect(),this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._domEmitter.stopListening()}destroy(){this.disconnect(),super.destroy()}}WebSocketGateway.WebSocketGateway=WebSocketGateway$1,WebSocketGateway.initialReconnectionInterval=1e3;class Sessions extends ContextPlugin{static get pluginName(){return"Sessions"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[WebSocketGateway,Users]}constructor(e){super(e),this.channelSessions=new Map,this.channelConnectedUsers=new Map,this.allConnectedUsers=new Collection,this._registeredSessions=new Map,this._uniqueUsersCount=0,this._users=this.context.plugins.get(Users)}init(){const e=this.context.plugins.get(WebSocketGateway);this.listenTo(e,"change:state",((e,t,n)=>{if("connected"!==n)this.channelSessions.forEach((e=>e.clear())),this.channelConnectedUsers.forEach((e=>e.clear())),this.allConnectedUsers.clear();else for(const[e,t]of this._registeredSessions)for(const n of t)this._handleSessionAdd(e,n)})),this._createUser(e.connection.me,!0)}register(e,t){if(this._registeredSessions.has(e))throw new CKEditorError("sessions-register-already-registered",null,{channelId:e});this._registeredSessions.set(e,t),this.channelSessions.set(e,new Collection),this.channelConnectedUsers.set(e,new Collection),this.listenTo(t,"add",((t,n)=>this._handleSessionAdd(e,n))),this.listenTo(t,"remove",((t,n)=>this._handleSessionRemove(e,n)));for(const n of t)this._handleSessionAdd(e,n)}unregister(e){if(!this._registeredSessions.has(e))throw new CKEditorError("sessions-unregister-not-exist",null,{channelId:e});const t=this._registeredSessions.get(e);this.stopListening(t);for(const n of t)"connected"===this.context.plugins.get(WebSocketGateway).state&&this._handleSessionRemove(e,n);this._registeredSessions.delete(e),this.channelSessions.delete(e),this.channelConnectedUsers.delete(e)}get mySessionId(){return this.context.plugins.get(WebSocketGateway).connection.sessionId}getUserBySessionId(e){for(const t of this.channelSessions.values())for(const n of t)if(n.id===e)return n.user}getUserSessions(e,t){const n=t?[this.channelSessions.get(t)]:this.channelSessions.values(),i=new Set;for(const t of n)for(const n of t)n.user.id===e.id&&i.add(n.id);return i}getUserRole(e){for(const t of this.channelSessions.values())for(const n of t)if(n.user===e)return n.role}_handleSessionAdd(e,t){if("connected"!==this.context.plugins.get(WebSocketGateway).state)return;const n=t.user,i=this._users.getUser(n.id)||this._createUser(n),r=Object.assign({},t,{user:i});this.channelSessions.get(e).add(r);const s=this.channelConnectedUsers.get(e);s.has(i.id)||s.add(i),this.allConnectedUsers.has(i.id)||this.allConnectedUsers.add(i,i.isMe?0:void 0),this.fire("sessionAdd:"+e,{channelId:e,session:r})}_handleSessionRemove(e,t){if("connected"!==this.context.plugins.get(WebSocketGateway).state)return;const n=this.channelConnectedUsers.get(e),i=t.user;i.id&&(this.channelSessions.get(e).remove(t.id),n.has(i.id)&&!this.getUserSessions(i,e).size&&n.remove(i.id),this.allConnectedUsers.get(i.id)&&!this.getUserSessions(i).size&&this.allConnectedUsers.remove(i.id))}_createUser(e,t){const n=this._users.addUser(e);return t&&this._users.defineMe(e.id),n.orderNumber=this._uniqueUsersCount++,n}}class UserMarkers extends Plugin{constructor(){super(...arguments),this._domEmitter=new(DomEmitterMixin())}static get requires(){return[Sessions]}static get pluginName(){return"UserMarkers"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.plugins.get(Sessions);e.conversion.for("editingDowncast").markerToElement({model:"user:position",view:(n,{writer:i})=>createUserPositionViewElement(n,i,t,e)}),e.conversion.for("editingDowncast").markerToHighlight({model:"user:range",view:e=>createUserRangeViewElement(e,t)}),createUserMarkerPostFixer(e),this._domEmitter.listenTo(_0x49a38d.document,"keydown",((t,{key:n})=>{"Escape"===n&&hideHoveredUserPositionMarkersTooltips(e)}),{useCapture:!0})}afterInit(){const e=this.editor,t=e.commands.get("undo");t&&e.model.on("applyOperation",((n,i)=>{const r=i[0];if(!r.isDocumentOperation)return;if("marker"!=r.type||!r.name.startsWith("user:"))return;const s=r.batch;t._createdBatches.has(s)&&(r.newRange=r.oldRange?e.model.createRange(r.oldRange.start,r.oldRange.end):null)}),{priority:"highest"})}destroy(){return this._domEmitter.stopListening(),super.destroy()}createUserMarkerOperations(){const e=this.editor,t=e.model.document,n=e.plugins.get(Sessions);e.model.enqueueChange({isUndoable:!1},(i=>{const r="user:range:"+n.mySessionId,s="user:position:"+n.mySessionId,o=e.model.markers.has(r);e.editing.view.hasDomSelection?updateUserMarkers(n.mySessionId,t.selection.getFirstRange(),e.model,i):o&&(i.removeMarker(r),i.removeMarker(s))}))}}function updateUserMarkers(e,t,n,i){const r="user:range:"+e,s="user:position:"+e,o=t.getContainedElement();let a=t.start;o&&o.is("element","tableCell")&&(a=getPositionForText(t,n),t=i.createRange(a));const l=i.createRange(a);n.markers.has(r)?(i.updateMarker(r,{range:t}),i.updateMarker(s,{range:l})):(i.addMarker(r,{range:t,usingOperation:!0}),i.addMarker(s,{range:l,usingOperation:!0}))}function getPositionForText(e,t){for(const n of e.getPositions())if(t.schema.checkChild(n,"$text"))return n}function createUserPositionViewElement(e,t,n,i){const r=e.markerName.split(":")[2],s=n.getUserBySessionId(r);if(!s||r===n.mySessionId)return;if(!i.model.schema.checkChild(e.markerRange.start,"$text"))return;const o={class:"ck-user__marker "+s.color.getMarkerClass(),"data-name":s.name,"data-session-id":r},a=i.model.markers.get(e.markerName).getStart(),l=a.nodeAfter,c=i.model.schema;if(l&&c.isObject(l)&&c.isInline(l)&&!i.model.markers.get("user:range:"+r).getRange().isCollapsed)return;const d=a.parent;return i.model.schema.isLimit(d)&&!i.model.hasContent(d)&&(o.contenteditable=!1),createUserPositionMarkerElement(t,o,s)}function createUserRangeViewElement(e,t){const n=e.markerName.split(":")[2];if(n===t.mySessionId)return null;const i=t.getUserBySessionId(n);return i?{id:n,classes:["ck-user__selection",i.color.getSelectionClass()],attributes:{"data-session-id":n},priority:2e3+i.orderNumber}:{id:n,classes:[]}}function createUserPositionMarkerElement(e,t,n){const i=e.createUIElement("span",t);return e.setCustomProperty("userPositionMarker",!0,i),i.render=function(e){const t=this.toDomElement(e);return t.innerHTML='⁠<span class="ck-user__marker-line" contenteditable="false"><span class="ck-user__marker-dot"></span></span><span class="ck-user__marker-tooltip" contenteditable="false" spellcheck="false">'+n.name+"</span>⁠",t.addEventListener("mouseenter",(()=>{t.classList.add("ck-user__marker_hovered")})),t.addEventListener("mouseleave",(()=>{t.classList.remove("ck-user__marker_hovered")})),t},i.isSimilar=function(e){return!(!this.getCustomProperty("userPositionMarker")||!e.getCustomProperty("userPositionMarker")||this.getAttribute("data-session-id")!=e.getAttribute("data-session-id"))},i}function hideHoveredUserPositionMarkersTooltips(e){e.editing.view.change((t=>{for(const n of e.model.markers){if(!n.name.startsWith("user:position"))continue;const i=e.editing.mapper.markerNameToElements(n.name);if(i)for(const e of i)t.removeClass("ck-user__marker_hovered",e)}}))}function createUserMarkerPostFixer(e){const t=e.model,n=new Map,i=e.plugins.get(Sessions);t.markers.on("update:user:range",((r,s,o,a)=>{if(!a&&n.get(s.name))return n.get(s.name).detach(),void n.delete(s.name);const l=s.name.split(":")[2];if(l===i.mySessionId)return;const c="user:position:"+l;t.markers.has(c)&&e.editing.reconvertMarker(c),s.on("change:range",((e,i,r)=>{if("$graveyard"!=i.root.rootName&&"$graveyard"==s.getRange().root.rootName&&!n.has(s.name)){const e=t.schema.getNearestSelectionRange(r.deletionPosition);if(e){const i=LiveRange.fromRange(e);n.set(s.name,i),i.on("change:range",((e,r,o)=>{if("$graveyard"==i.root.rootName){const e=t.schema.getNearestSelectionRange(o.deletionPosition);e?(i.start=e.start,i.end=e.end):(n.delete(s.name),i.detach())}}))}}}))})),t.document.on("change",(()=>{n.size>0&&t.enqueueChange({isUndoable:!1},(e=>{for(const[i,r]of n)"$graveyard"==t.markers.get(i).getRange().root.rootName&&(updateUserMarkers(i.split(":")[2],r.toRange(),t,e),r.detach());n.clear()}))}))}function getTranslation$6(e,t,n){const i=e.t,r=e.t;switch(t){case"PENDING_ACTION_SENDING_DATA":return r({string:"Sending data to the server.",id:"PENDING_ACTION_SENDING_DATA"});case"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.":return r("The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.");case"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.":return r("The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");case"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.":return r("The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");case"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.":return r("The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");case"Synchronization issue":return r("Synchronization issue");case"Connected users list dropdown menu":return r("Connected users list dropdown menu");case"Collapsed connected users list (press ENTER to open it)":return r("Collapsed connected users list (press ENTER to open it)");case"Connected users list":return r("Connected users list");case"PENDING_ACTION_REVISION_HISTORY":return i({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"CONNECTED_USERS":return r({string:"1 connected user (me)",plural:"%0 connected users",id:"CONNECTED_USERS"},n);default:return""}}const messages=/*   -- @preserve */
(()=>{var e=minimal.Reader,t=minimal.Writer,n=minimal.util,i=minimal.roots.default||(minimal.roots.default={});return i.AttributeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.range=null,r.prototype.key="",r.prototype.oldValueBoolean=!1,r.prototype.oldValueJson="",r.prototype.newValueBoolean=!1,r.prototype.newValueJson="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.range&&Object.hasOwnProperty.call(e,"range")&&i.Range.encode(e.range,n.uint32(10).fork()).ldelim(),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(18).string(e.key),null!=e.oldValueBoolean&&Object.hasOwnProperty.call(e,"oldValueBoolean")&&n.uint32(24).bool(e.oldValueBoolean),null!=e.oldValueJson&&Object.hasOwnProperty.call(e,"oldValueJson")&&n.uint32(34).string(e.oldValueJson),null!=e.newValueBoolean&&Object.hasOwnProperty.call(e,"newValueBoolean")&&n.uint32(40).bool(e.newValueBoolean),null!=e.newValueJson&&Object.hasOwnProperty.call(e,"newValueJson")&&n.uint32(50).string(e.newValueJson),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(56).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.AttributeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.range=i.Range.decode(t,t.uint32());break;case 2:s.key=t.string();break;case 3:s.oldValueBoolean=t.bool();break;case 4:s.oldValueJson=t.string();break;case 5:s.newValueBoolean=t.bool();break;case 6:s.newValueJson=t.string();break;case 7:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.range&&e.hasOwnProperty("range")){var t=i.Range.verify(e.range);if(t)return"range."+t}return null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&"boolean"!=typeof e.oldValueBoolean?"oldValueBoolean: boolean expected":null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&!n.isString(e.oldValueJson)?"oldValueJson: string expected":null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&"boolean"!=typeof e.newValueBoolean?"newValueBoolean: boolean expected":null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&!n.isString(e.newValueJson)?"newValueJson: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.AttributeOperation)return e;var t=new i.AttributeOperation;if(null!=e.range){if("object"!=typeof e.range)throw TypeError(".AttributeOperation.range: object expected");t.range=i.Range.fromObject(e.range)}return null!=e.key&&(t.key=String(e.key)),null!=e.oldValueBoolean&&(t.oldValueBoolean=Boolean(e.oldValueBoolean)),null!=e.oldValueJson&&(t.oldValueJson=String(e.oldValueJson)),null!=e.newValueBoolean&&(t.newValueBoolean=Boolean(e.newValueBoolean)),null!=e.newValueJson&&(t.newValueJson=String(e.newValueJson)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.range=null,n.key="",n.oldValueBoolean=!1,n.oldValueJson="",n.newValueBoolean=!1,n.newValueJson="",n.wasUndone=!1),null!=e.range&&e.hasOwnProperty("range")&&(n.range=i.Range.toObject(e.range,t)),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&(n.oldValueBoolean=e.oldValueBoolean),null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&(n.oldValueJson=e.oldValueJson),null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&(n.newValueBoolean=e.newValueBoolean),null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&(n.newValueJson=e.newValueJson),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/AttributeOperation"},r}(),i.InsertOperation=function(){function r(e){if(this.nodes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.position=null,r.prototype.nodes=n.emptyArray,r.prototype.shouldReceiveAttributes=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.position&&Object.hasOwnProperty.call(e,"position")&&i.Position.encode(e.position,n.uint32(10).fork()).ldelim(),null!=e.nodes&&e.nodes.length)for(var r=0;r<e.nodes.length;++r)i.Element.encode(e.nodes[r],n.uint32(18).fork()).ldelim();return null!=e.shouldReceiveAttributes&&Object.hasOwnProperty.call(e,"shouldReceiveAttributes")&&n.uint32(24).bool(e.shouldReceiveAttributes),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.InsertOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.position=i.Position.decode(t,t.uint32());break;case 2:s.nodes&&s.nodes.length||(s.nodes=[]),s.nodes.push(i.Element.decode(t,t.uint32()));break;case 3:s.shouldReceiveAttributes=t.bool();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.position&&e.hasOwnProperty("position")&&(n=i.Position.verify(e.position)))return"position."+n;if(null!=e.nodes&&e.hasOwnProperty("nodes")){if(!Array.isArray(e.nodes))return"nodes: array expected";for(var t=0;t<e.nodes.length;++t){var n;if(n=i.Element.verify(e.nodes[t]))return"nodes."+n}}return null!=e.shouldReceiveAttributes&&e.hasOwnProperty("shouldReceiveAttributes")&&"boolean"!=typeof e.shouldReceiveAttributes?"shouldReceiveAttributes: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.InsertOperation)return e;var t=new i.InsertOperation;if(null!=e.position){if("object"!=typeof e.position)throw TypeError(".InsertOperation.position: object expected");t.position=i.Position.fromObject(e.position)}if(e.nodes){if(!Array.isArray(e.nodes))throw TypeError(".InsertOperation.nodes: array expected");t.nodes=[];for(var n=0;n<e.nodes.length;++n){if("object"!=typeof e.nodes[n])throw TypeError(".InsertOperation.nodes: object expected");t.nodes[n]=i.Element.fromObject(e.nodes[n])}}return null!=e.shouldReceiveAttributes&&(t.shouldReceiveAttributes=Boolean(e.shouldReceiveAttributes)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.nodes=[]),t.defaults&&(n.position=null,n.shouldReceiveAttributes=!1,n.wasUndone=!1),null!=e.position&&e.hasOwnProperty("position")&&(n.position=i.Position.toObject(e.position,t)),e.nodes&&e.nodes.length){n.nodes=[];for(var r=0;r<e.nodes.length;++r)n.nodes[r]=i.Element.toObject(e.nodes[r],t)}return null!=e.shouldReceiveAttributes&&e.hasOwnProperty("shouldReceiveAttributes")&&(n.shouldReceiveAttributes=e.shouldReceiveAttributes),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/InsertOperation"},r}(),i.MarkerOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.name="",r.prototype.oldRange=null,r.prototype.newRange=null,r.prototype.affectsData=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(10).string(e.name),null!=e.oldRange&&Object.hasOwnProperty.call(e,"oldRange")&&i.Range.encode(e.oldRange,n.uint32(18).fork()).ldelim(),null!=e.newRange&&Object.hasOwnProperty.call(e,"newRange")&&i.Range.encode(e.newRange,n.uint32(26).fork()).ldelim(),null!=e.affectsData&&Object.hasOwnProperty.call(e,"affectsData")&&n.uint32(32).bool(e.affectsData),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MarkerOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.name=t.string();break;case 2:s.oldRange=i.Range.decode(t,t.uint32());break;case 3:s.newRange=i.Range.decode(t,t.uint32());break;case 4:s.affectsData=t.bool();break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name)?"name: string expected":null!=e.oldRange&&e.hasOwnProperty("oldRange")&&(t=i.Range.verify(e.oldRange))?"oldRange."+t:null!=e.newRange&&e.hasOwnProperty("newRange")&&(t=i.Range.verify(e.newRange))?"newRange."+t:null!=e.affectsData&&e.hasOwnProperty("affectsData")&&"boolean"!=typeof e.affectsData?"affectsData: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MarkerOperation)return e;var t=new i.MarkerOperation;if(null!=e.name&&(t.name=String(e.name)),null!=e.oldRange){if("object"!=typeof e.oldRange)throw TypeError(".MarkerOperation.oldRange: object expected");t.oldRange=i.Range.fromObject(e.oldRange)}if(null!=e.newRange){if("object"!=typeof e.newRange)throw TypeError(".MarkerOperation.newRange: object expected");t.newRange=i.Range.fromObject(e.newRange)}return null!=e.affectsData&&(t.affectsData=Boolean(e.affectsData)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.name="",n.oldRange=null,n.newRange=null,n.affectsData=!1,n.wasUndone=!1),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.oldRange&&e.hasOwnProperty("oldRange")&&(n.oldRange=i.Range.toObject(e.oldRange,t)),null!=e.newRange&&e.hasOwnProperty("newRange")&&(n.newRange=i.Range.toObject(e.newRange,t)),null!=e.affectsData&&e.hasOwnProperty("affectsData")&&(n.affectsData=e.affectsData),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MarkerOperation"},r}(),i.MergeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.sourcePosition=null,r.prototype.targetPosition=null,r.prototype.graveyardPosition=null,r.prototype.howMany=0,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.sourcePosition&&Object.hasOwnProperty.call(e,"sourcePosition")&&i.Position.encode(e.sourcePosition,n.uint32(10).fork()).ldelim(),null!=e.targetPosition&&Object.hasOwnProperty.call(e,"targetPosition")&&i.Position.encode(e.targetPosition,n.uint32(18).fork()).ldelim(),null!=e.graveyardPosition&&Object.hasOwnProperty.call(e,"graveyardPosition")&&i.Position.encode(e.graveyardPosition,n.uint32(26).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(32).uint32(e.howMany),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MergeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.sourcePosition=i.Position.decode(t,t.uint32());break;case 2:s.targetPosition=i.Position.decode(t,t.uint32());break;case 3:s.graveyardPosition=i.Position.decode(t,t.uint32());break;case 4:s.howMany=t.uint32();break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(t=i.Position.verify(e.sourcePosition))?"sourcePosition."+t:null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(t=i.Position.verify(e.targetPosition))?"targetPosition."+t:null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(t=i.Position.verify(e.graveyardPosition))?"graveyardPosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MergeOperation)return e;var t=new i.MergeOperation;if(null!=e.sourcePosition){if("object"!=typeof e.sourcePosition)throw TypeError(".MergeOperation.sourcePosition: object expected");t.sourcePosition=i.Position.fromObject(e.sourcePosition)}if(null!=e.targetPosition){if("object"!=typeof e.targetPosition)throw TypeError(".MergeOperation.targetPosition: object expected");t.targetPosition=i.Position.fromObject(e.targetPosition)}if(null!=e.graveyardPosition){if("object"!=typeof e.graveyardPosition)throw TypeError(".MergeOperation.graveyardPosition: object expected");t.graveyardPosition=i.Position.fromObject(e.graveyardPosition)}return null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourcePosition=null,n.targetPosition=null,n.graveyardPosition=null,n.howMany=0,n.wasUndone=!1),null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(n.sourcePosition=i.Position.toObject(e.sourcePosition,t)),null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(n.targetPosition=i.Position.toObject(e.targetPosition,t)),null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(n.graveyardPosition=i.Position.toObject(e.graveyardPosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MergeOperation"},r}(),i.MoveOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.sourcePosition=null,r.prototype.howMany=0,r.prototype.targetPosition=null,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.sourcePosition&&Object.hasOwnProperty.call(e,"sourcePosition")&&i.Position.encode(e.sourcePosition,n.uint32(10).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(16).uint32(e.howMany),null!=e.targetPosition&&Object.hasOwnProperty.call(e,"targetPosition")&&i.Position.encode(e.targetPosition,n.uint32(26).fork()).ldelim(),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.MoveOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.sourcePosition=i.Position.decode(t,t.uint32());break;case 2:s.howMany=t.uint32();break;case 3:s.targetPosition=i.Position.decode(t,t.uint32());break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(t=i.Position.verify(e.sourcePosition))?"sourcePosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(t=i.Position.verify(e.targetPosition))?"targetPosition."+t:null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.MoveOperation)return e;var t=new i.MoveOperation;if(null!=e.sourcePosition){if("object"!=typeof e.sourcePosition)throw TypeError(".MoveOperation.sourcePosition: object expected");t.sourcePosition=i.Position.fromObject(e.sourcePosition)}if(null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.targetPosition){if("object"!=typeof e.targetPosition)throw TypeError(".MoveOperation.targetPosition: object expected");t.targetPosition=i.Position.fromObject(e.targetPosition)}return null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourcePosition=null,n.howMany=0,n.targetPosition=null,n.wasUndone=!1),null!=e.sourcePosition&&e.hasOwnProperty("sourcePosition")&&(n.sourcePosition=i.Position.toObject(e.sourcePosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.targetPosition&&e.hasOwnProperty("targetPosition")&&(n.targetPosition=i.Position.toObject(e.targetPosition,t)),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/MoveOperation"},r}(),i.RenameOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.position=null,r.prototype.oldName="",r.prototype.newName="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.position&&Object.hasOwnProperty.call(e,"position")&&i.Position.encode(e.position,n.uint32(10).fork()).ldelim(),null!=e.oldName&&Object.hasOwnProperty.call(e,"oldName")&&n.uint32(18).string(e.oldName),null!=e.newName&&Object.hasOwnProperty.call(e,"newName")&&n.uint32(26).string(e.newName),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RenameOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.position=i.Position.decode(t,t.uint32());break;case 2:s.oldName=t.string();break;case 3:s.newName=t.string();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.position&&e.hasOwnProperty("position")){var t=i.Position.verify(e.position);if(t)return"position."+t}return null!=e.oldName&&e.hasOwnProperty("oldName")&&!n.isString(e.oldName)?"oldName: string expected":null!=e.newName&&e.hasOwnProperty("newName")&&!n.isString(e.newName)?"newName: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RenameOperation)return e;var t=new i.RenameOperation;if(null!=e.position){if("object"!=typeof e.position)throw TypeError(".RenameOperation.position: object expected");t.position=i.Position.fromObject(e.position)}return null!=e.oldName&&(t.oldName=String(e.oldName)),null!=e.newName&&(t.newName=String(e.newName)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.position=null,n.oldName="",n.newName="",n.wasUndone=!1),null!=e.position&&e.hasOwnProperty("position")&&(n.position=i.Position.toObject(e.position,t)),null!=e.oldName&&e.hasOwnProperty("oldName")&&(n.oldName=e.oldName),null!=e.newName&&e.hasOwnProperty("newName")&&(n.newName=e.newName),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RenameOperation"},r}(),i.RootAttributeOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.root="",r.prototype.key="",r.prototype.oldValueBoolean=!1,r.prototype.oldValueJson="",r.prototype.newValueBoolean=!1,r.prototype.newValueJson="",r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.root&&Object.hasOwnProperty.call(e,"root")&&n.uint32(10).string(e.root),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&n.uint32(18).string(e.key),null!=e.oldValueBoolean&&Object.hasOwnProperty.call(e,"oldValueBoolean")&&n.uint32(24).bool(e.oldValueBoolean),null!=e.oldValueJson&&Object.hasOwnProperty.call(e,"oldValueJson")&&n.uint32(34).string(e.oldValueJson),null!=e.newValueBoolean&&Object.hasOwnProperty.call(e,"newValueBoolean")&&n.uint32(40).bool(e.newValueBoolean),null!=e.newValueJson&&Object.hasOwnProperty.call(e,"newValueJson")&&n.uint32(50).string(e.newValueJson),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(56).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RootAttributeOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.root=t.string();break;case 2:s.key=t.string();break;case 3:s.oldValueBoolean=t.bool();break;case 4:s.oldValueJson=t.string();break;case 5:s.newValueBoolean=t.bool();break;case 6:s.newValueJson=t.string();break;case 7:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.root&&e.hasOwnProperty("root")&&!n.isString(e.root)?"root: string expected":null!=e.key&&e.hasOwnProperty("key")&&!n.isString(e.key)?"key: string expected":null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&"boolean"!=typeof e.oldValueBoolean?"oldValueBoolean: boolean expected":null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&!n.isString(e.oldValueJson)?"oldValueJson: string expected":null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&"boolean"!=typeof e.newValueBoolean?"newValueBoolean: boolean expected":null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&!n.isString(e.newValueJson)?"newValueJson: string expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RootAttributeOperation)return e;var t=new i.RootAttributeOperation;return null!=e.root&&(t.root=String(e.root)),null!=e.key&&(t.key=String(e.key)),null!=e.oldValueBoolean&&(t.oldValueBoolean=Boolean(e.oldValueBoolean)),null!=e.oldValueJson&&(t.oldValueJson=String(e.oldValueJson)),null!=e.newValueBoolean&&(t.newValueBoolean=Boolean(e.newValueBoolean)),null!=e.newValueJson&&(t.newValueJson=String(e.newValueJson)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.root="",n.key="",n.oldValueBoolean=!1,n.oldValueJson="",n.newValueBoolean=!1,n.newValueJson="",n.wasUndone=!1),null!=e.root&&e.hasOwnProperty("root")&&(n.root=e.root),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.oldValueBoolean&&e.hasOwnProperty("oldValueBoolean")&&(n.oldValueBoolean=e.oldValueBoolean),null!=e.oldValueJson&&e.hasOwnProperty("oldValueJson")&&(n.oldValueJson=e.oldValueJson),null!=e.newValueBoolean&&e.hasOwnProperty("newValueBoolean")&&(n.newValueBoolean=e.newValueBoolean),null!=e.newValueJson&&e.hasOwnProperty("newValueJson")&&(n.newValueJson=e.newValueJson),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RootAttributeOperation"},r}(),i.RootOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.rootName="",r.prototype.elementName="",r.prototype.isAdd=!1,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.rootName&&Object.hasOwnProperty.call(e,"rootName")&&n.uint32(10).string(e.rootName),null!=e.elementName&&Object.hasOwnProperty.call(e,"elementName")&&n.uint32(18).string(e.elementName),null!=e.isAdd&&Object.hasOwnProperty.call(e,"isAdd")&&n.uint32(24).bool(e.isAdd),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(32).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.RootOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.rootName=t.string();break;case 2:s.elementName=t.string();break;case 3:s.isAdd=t.bool();break;case 4:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.rootName&&e.hasOwnProperty("rootName")&&!n.isString(e.rootName)?"rootName: string expected":null!=e.elementName&&e.hasOwnProperty("elementName")&&!n.isString(e.elementName)?"elementName: string expected":null!=e.isAdd&&e.hasOwnProperty("isAdd")&&"boolean"!=typeof e.isAdd?"isAdd: boolean expected":null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null},r.fromObject=function(e){if(e instanceof i.RootOperation)return e;var t=new i.RootOperation;return null!=e.rootName&&(t.rootName=String(e.rootName)),null!=e.elementName&&(t.elementName=String(e.elementName)),null!=e.isAdd&&(t.isAdd=Boolean(e.isAdd)),null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.rootName="",n.elementName="",n.isAdd=!1,n.wasUndone=!1),null!=e.rootName&&e.hasOwnProperty("rootName")&&(n.rootName=e.rootName),null!=e.elementName&&e.hasOwnProperty("elementName")&&(n.elementName=e.elementName),null!=e.isAdd&&e.hasOwnProperty("isAdd")&&(n.isAdd=e.isAdd),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/RootOperation"},r}(),i.SplitOperation=function(){function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.splitPosition=null,r.prototype.graveyardPosition=null,r.prototype.howMany=0,r.prototype.insertionPosition=null,r.prototype.wasUndone=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=t.create()),null!=e.splitPosition&&Object.hasOwnProperty.call(e,"splitPosition")&&i.Position.encode(e.splitPosition,n.uint32(10).fork()).ldelim(),null!=e.graveyardPosition&&Object.hasOwnProperty.call(e,"graveyardPosition")&&i.Position.encode(e.graveyardPosition,n.uint32(18).fork()).ldelim(),null!=e.howMany&&Object.hasOwnProperty.call(e,"howMany")&&n.uint32(24).uint32(e.howMany),null!=e.insertionPosition&&Object.hasOwnProperty.call(e,"insertionPosition")&&i.Position.encode(e.insertionPosition,n.uint32(34).fork()).ldelim(),null!=e.wasUndone&&Object.hasOwnProperty.call(e,"wasUndone")&&n.uint32(40).bool(e.wasUndone),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.SplitOperation;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.splitPosition=i.Position.decode(t,t.uint32());break;case 2:s.graveyardPosition=i.Position.decode(t,t.uint32());break;case 3:s.howMany=t.uint32();break;case 4:s.insertionPosition=i.Position.decode(t,t.uint32());break;case 5:s.wasUndone=t.bool();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.splitPosition&&e.hasOwnProperty("splitPosition")&&(t=i.Position.verify(e.splitPosition))?"splitPosition."+t:null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(t=i.Position.verify(e.graveyardPosition))?"graveyardPosition."+t:null!=e.howMany&&e.hasOwnProperty("howMany")&&!n.isInteger(e.howMany)?"howMany: integer expected":null!=e.insertionPosition&&e.hasOwnProperty("insertionPosition")&&(t=i.Position.verify(e.insertionPosition))?"insertionPosition."+t:null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&"boolean"!=typeof e.wasUndone?"wasUndone: boolean expected":null;var t},r.fromObject=function(e){if(e instanceof i.SplitOperation)return e;var t=new i.SplitOperation;if(null!=e.splitPosition){if("object"!=typeof e.splitPosition)throw TypeError(".SplitOperation.splitPosition: object expected");t.splitPosition=i.Position.fromObject(e.splitPosition)}if(null!=e.graveyardPosition){if("object"!=typeof e.graveyardPosition)throw TypeError(".SplitOperation.graveyardPosition: object expected");t.graveyardPosition=i.Position.fromObject(e.graveyardPosition)}if(null!=e.howMany&&(t.howMany=e.howMany>>>0),null!=e.insertionPosition){if("object"!=typeof e.insertionPosition)throw TypeError(".SplitOperation.insertionPosition: object expected");t.insertionPosition=i.Position.fromObject(e.insertionPosition)}return null!=e.wasUndone&&(t.wasUndone=Boolean(e.wasUndone)),t},r.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.splitPosition=null,n.graveyardPosition=null,n.howMany=0,n.insertionPosition=null,n.wasUndone=!1),null!=e.splitPosition&&e.hasOwnProperty("splitPosition")&&(n.splitPosition=i.Position.toObject(e.splitPosition,t)),null!=e.graveyardPosition&&e.hasOwnProperty("graveyardPosition")&&(n.graveyardPosition=i.Position.toObject(e.graveyardPosition,t)),null!=e.howMany&&e.hasOwnProperty("howMany")&&(n.howMany=e.howMany),null!=e.insertionPosition&&e.hasOwnProperty("insertionPosition")&&(n.insertionPosition=i.Position.toObject(e.insertionPosition,t)),null!=e.wasUndone&&e.hasOwnProperty("wasUndone")&&(n.wasUndone=e.wasUndone),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SplitOperation"},r}(),i.Position=function(){function r(e){if(this.path=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.root="",r.prototype.rootMain=!1,r.prototype.rootGraveyard=!1,r.prototype.path=n.emptyArray,r.prototype.stickiness="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.root&&Object.hasOwnProperty.call(e,"root")&&n.uint32(10).string(e.root),null!=e.rootMain&&Object.hasOwnProperty.call(e,"rootMain")&&n.uint32(16).bool(e.rootMain),null!=e.rootGraveyard&&Object.hasOwnProperty.call(e,"rootGraveyard")&&n.uint32(24).bool(e.rootGraveyard),null!=e.path&&e.path.length){n.uint32(34).fork();for(var i=0;i<e.path.length;++i)n.uint32(e.path[i]);n.ldelim()}return null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&n.uint32(42).string(e.stickiness),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.Position;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.root=t.string();break;case 2:s.rootMain=t.bool();break;case 3:s.rootGraveyard=t.bool();break;case 4:if(s.path&&s.path.length||(s.path=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)s.path.push(t.uint32());else s.path.push(t.uint32());break;case 5:s.stickiness=t.string();break;default:t.skipType(7&o)}}return s},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.root&&e.hasOwnProperty("root")&&!n.isString(e.root))return"root: string expected";if(null!=e.rootMain&&e.hasOwnProperty("rootMain")&&"boolean"!=typeof e.rootMain)return"rootMain: boolean expected";if(null!=e.rootGraveyard&&e.hasOwnProperty("rootGraveyard")&&"boolean"!=typeof e.rootGraveyard)return"rootGraveyard: boolean expected";if(null!=e.path&&e.hasOwnProperty("path")){if(!Array.isArray(e.path))return"path: array expected";for(var t=0;t<e.path.length;++t)if(!n.isInteger(e.path[t]))return"path: integer[] expected"}return null!=e.stickiness&&e.hasOwnProperty("stickiness")&&!n.isString(e.stickiness)?"stickiness: string expected":null},r.fromObject=function(e){if(e instanceof i.Position)return e;var t=new i.Position;if(null!=e.root&&(t.root=String(e.root)),null!=e.rootMain&&(t.rootMain=Boolean(e.rootMain)),null!=e.rootGraveyard&&(t.rootGraveyard=Boolean(e.rootGraveyard)),e.path){if(!Array.isArray(e.path))throw TypeError(".Position.path: array expected");t.path=[];for(var n=0;n<e.path.length;++n)t.path[n]=e.path[n]>>>0}return null!=e.stickiness&&(t.stickiness=String(e.stickiness)),t},r.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.path=[]),t.defaults&&(n.root="",n.rootMain=!1,n.rootGraveyard=!1,n.stickiness=""),null!=e.root&&e.hasOwnProperty("root")&&(n.root=e.root),null!=e.rootMain&&e.hasOwnProperty("rootMain")&&(n.rootMain=e.rootMain),null!=e.rootGraveyard&&e.hasOwnProperty("rootGraveyard")&&(n.rootGraveyard=e.rootGraveyard),e.path&&e.path.length){n.path=[];for(var i=0;i<e.path.length;++i)n.path[i]=e.path[i]}return null!=e.stickiness&&e.hasOwnProperty("stickiness")&&(n.stickiness=e.stickiness),n},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Position"},r}(),i.Range=function(){function n(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return n.prototype.start=null,n.prototype.end=null,n.create=function(e){return new n(e)},n.encode=function(e,n){return n||(n=t.create()),null!=e.start&&Object.hasOwnProperty.call(e,"start")&&i.Position.encode(e.start,n.uint32(10).fork()).ldelim(),null!=e.end&&Object.hasOwnProperty.call(e,"end")&&i.Position.encode(e.end,n.uint32(18).fork()).ldelim(),n},n.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},n.decode=function(t,n){t instanceof e||(t=e.create(t));for(var r=void 0===n?t.len:t.pos+n,s=new i.Range;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:s.start=i.Position.decode(t,t.uint32());break;case 2:s.end=i.Position.decode(t,t.uint32());break;default:t.skipType(7&o)}}return s},n.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},n.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.start&&e.hasOwnProperty("start")&&(t=i.Position.verify(e.start))?"start."+t:null!=e.end&&e.hasOwnProperty("end")&&(t=i.Position.verify(e.end))?"end."+t:null;var t},n.fromObject=function(e){if(e instanceof i.Range)return e;var t=new i.Range;if(null!=e.start){if("object"!=typeof e.start)throw TypeError(".Range.start: object expected");t.start=i.Position.fromObject(e.start)}if(null!=e.end){if("object"!=typeof e.end)throw TypeError(".Range.end: object expected");t.end=i.Position.fromObject(e.end)}return t},n.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.start=null,n.end=null),null!=e.start&&e.hasOwnProperty("start")&&(n.start=i.Position.toObject(e.start,t)),null!=e.end&&e.hasOwnProperty("end")&&(n.end=i.Position.toObject(e.end,t)),n},n.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},n.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Range"},n}(),i.Element=function(){function r(e){if(this.children=[],this.attributesBoolean={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return r.prototype.name="",r.prototype.children=n.emptyArray,r.prototype.data="",r.prototype.attributesBoolean=n.emptyObject,r.prototype.attributesJson="",r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=t.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&n.uint32(10).string(e.name),null!=e.children&&e.children.length)for(var r=0;r<e.children.length;++r)i.Element.encode(e.children[r],n.uint32(18).fork()).ldelim();if(null!=e.data&&Object.hasOwnProperty.call(e,"data")&&n.uint32(26).string(e.data),null!=e.attributesBoolean&&Object.hasOwnProperty.call(e,"attributesBoolean")){var s=Object.keys(e.attributesBoolean);for(r=0;r<s.length;++r)n.uint32(34).fork().uint32(10).string(s[r]).uint32(16).bool(e.attributesBoolean[s[r]]).ldelim()}return null!=e.attributesJson&&Object.hasOwnProperty.call(e,"attributesJson")&&n.uint32(42).string(e.attributesJson),n},r.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},r.decode=function(t,r){t instanceof e||(t=e.create(t));for(var s,o,a=void 0===r?t.len:t.pos+r,l=new i.Element;t.pos<a;){var c=t.uint32();switch(c>>>3){case 1:l.name=t.string();break;case 2:l.children&&l.children.length||(l.children=[]),l.children.push(i.Element.decode(t,t.uint32()));break;case 3:l.data=t.string();break;case 4:l.attributesBoolean===n.emptyObject&&(l.attributesBoolean={});var d=t.uint32()+t.pos;for(s="",o=!1;t.pos<d;){var u=t.uint32();switch(u>>>3){case 1:s=t.string();break;case 2:o=t.bool();break;default:t.skipType(7&u)}}l.attributesBoolean[s]=o;break;case 5:l.attributesJson=t.string();break;default:t.skipType(7&c)}}return l},r.decodeDelimited=function(t){return t instanceof e||(t=new e(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.name&&e.hasOwnProperty("name")&&!n.isString(e.name))return"name: string expected";if(null!=e.children&&e.hasOwnProperty("children")){if(!Array.isArray(e.children))return"children: array expected";for(var t=0;t<e.children.length;++t){var r=i.Element.verify(e.children[t]);if(r)return"children."+r}}if(null!=e.data&&e.hasOwnProperty("data")&&!n.isString(e.data))return"data: string expected";if(null!=e.attributesBoolean&&e.hasOwnProperty("attributesBoolean")){if(!n.isObject(e.attributesBoolean))return"attributesBoolean: object expected";var s=Object.keys(e.attributesBoolean);for(t=0;t<s.length;++t)if("boolean"!=typeof e.attributesBoolean[s[t]])return"attributesBoolean: boolean{k:string} expected"}return null!=e.attributesJson&&e.hasOwnProperty("attributesJson")&&!n.isString(e.attributesJson)?"attributesJson: string expected":null},r.fromObject=function(e){if(e instanceof i.Element)return e;var t=new i.Element;if(null!=e.name&&(t.name=String(e.name)),e.children){if(!Array.isArray(e.children))throw TypeError(".Element.children: array expected");t.children=[];for(var n=0;n<e.children.length;++n){if("object"!=typeof e.children[n])throw TypeError(".Element.children: object expected");t.children[n]=i.Element.fromObject(e.children[n])}}if(null!=e.data&&(t.data=String(e.data)),e.attributesBoolean){if("object"!=typeof e.attributesBoolean)throw TypeError(".Element.attributesBoolean: object expected");t.attributesBoolean={};var r=Object.keys(e.attributesBoolean);for(n=0;n<r.length;++n)t.attributesBoolean[r[n]]=Boolean(e.attributesBoolean[r[n]])}return null!=e.attributesJson&&(t.attributesJson=String(e.attributesJson)),t},r.toObject=function(e,t){t||(t={});var n,r={};if((t.arrays||t.defaults)&&(r.children=[]),(t.objects||t.defaults)&&(r.attributesBoolean={}),t.defaults&&(r.name="",r.data="",r.attributesJson=""),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),e.children&&e.children.length){r.children=[];for(var s=0;s<e.children.length;++s)r.children[s]=i.Element.toObject(e.children[s],t)}if(null!=e.data&&e.hasOwnProperty("data")&&(r.data=e.data),e.attributesBoolean&&(n=Object.keys(e.attributesBoolean)).length)for(r.attributesBoolean={},s=0;s<n.length;++s)r.attributesBoolean[n[s]]=e.attributesBoolean[n[s]];return null!=e.attributesJson&&e.hasOwnProperty("attributesJson")&&(r.attributesJson=e.attributesJson),r},r.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},r.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Element"},r}(),i})();class ProtobufFactory{constructor(){this._protobufRoot=messages}getDescriptor(e){return new ProtobufDescriptor(this._protobufRoot[e])}}class ProtobufDescriptor{constructor(e){this._protobuf=e}compress(e){const t=this._protobuf.verify(e);if(t)throw Error(t);return this._protobuf.encode(this._protobuf.create(e)).finish()}decompress(e){return this._protobuf.toObject(this._protobuf.decode(e),{oneofs:!0})}}function getPositionShiftedBy(e,t){const n=cloneDeep(e);return n.path[n.path.length-1]+=t,n}function arePositionsEqual(e,t){return e.root===t.root&&isEqual(e.path,t.path)}function parsePositionBeforeCompression(e){_mapPositions(e,(e=>("main"==e.root?(e.rootMain=!0,delete e.root):"$graveyard"==e.root&&(e.rootGraveyard=!0,delete e.root),e)))}function parsePositionAfterCompression(e){_mapPositions(e,(e=>(e.rootMain?(e.root="main",delete e.rootMain):e.rootGraveyard&&(e.root="$graveyard",delete e.rootGraveyard),e)))}function _mapPositions(e,t){for(const n in e){const i=e[n];"nodes"!==n&&isObject$3(i)&&(i.path&&(i.root||i.rootMain||i.rootGraveyard)?e[n]=t(i):_mapPositions(i,t))}return e}class OperationCompressor{constructor(e,t,n){this._id=e,this._operationName=t,this._protobufDescriptor=n}compress(e,t){const n=t.shift();return parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){t.types.shift();const n=this._protobufDescriptor.decompress(t.buffers.shift());parsePositionAfterCompression(n),n.__className=this._operationName,e.push(n)}}class AttributeOperationCompressor extends OperationCompressor{compress(e,t){const n=t.shift();return this._serializeOneOf("oldValue",n),this._serializeOneOf("newValue",n),parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){const{types:n,buffers:i}=t,r=this._protobufDescriptor.decompress(i.shift());n.shift(),this._deserializeOneOf("oldValue",r),this._deserializeOneOf("newValue",r),parsePositionAfterCompression(r),r.__className=this._operationName,e.push(r)}_serializeOneOf(e,t){const n=t[e];"boolean"==typeof n?t[e+"Boolean"]=n:t[e+"Json"]=JSON.stringify(n)}_deserializeOneOf(e,t){const n=e+"Json";t[n]?(t[e]=JSON.parse(t[n]),delete t[n]):(t[e]=t[e+"Boolean"],delete t[e+"Boolean"])}}class InsertOperationCompressor extends OperationCompressor{compress(e,t){const n=t.shift();return this._serializeNodesAttributes(n.nodes),parsePositionBeforeCompression(n),e.buffers.push(this._protobufDescriptor.compress(n)),e.types.push(this._id),!0}decompress(e,t){const{types:n,buffers:i}=t,r=this._protobufDescriptor.decompress(i.shift());n.shift(),r.nodes||(r.nodes=[]),this._deserializeNodesAttributes(r.nodes),parsePositionAfterCompression(r),r.__className=this._operationName,e.push(r)}_serializeNodesAttributes(e){for(const t of e){if(t.attributes){const e=t.attributes;this._areValuesBoolean(e)?t.attributesBoolean=e:t.attributesJson=JSON.stringify(e)}t.children&&this._serializeNodesAttributes(t.children)}}_deserializeNodesAttributes(e){for(const t of e)(t.attributesBoolean||t.attributesJson)&&(t.attributesBoolean?(t.attributes=t.attributesBoolean,delete t.attributesBoolean):(t.attributes=JSON.parse(t.attributesJson),delete t.attributesJson)),t.children&&this._deserializeNodesAttributes(t.children)}_areValuesBoolean(e){return Object.keys(e).every((t=>"boolean"==typeof e[t]))}}class MarkerOperationCompressor extends OperationCompressor{decompress(e,t){super.decompress(e,t);const n=e[e.length-1];n.oldRange||(n.oldRange=null),n.newRange||(n.newRange=null)}}class NoOperationCompressor extends OperationCompressor{compress(e,t){return t.shift(),e.types.push(this._id),!0}decompress(e,t){t.types.shift(),e.push({__className:this._operationName})}}class AnnotationMarkerOperationCompressor extends MarkerOperationCompressor{constructor(e,t,n,i){super(e,t,n),this._omittedNamespace=i+":"}compress(e,t){return!("MarkerOperation"!=t[0].__className||!t[0].name.startsWith(this._omittedNamespace)||(t[0].name=t[0].name.replace(new RegExp("^"+this._omittedNamespace),""),super.compress(e,t),0))}decompress(e,t){super.decompress(e,t);const n=e[e.length-1];n.name=this._omittedNamespace+n.name}}class ActionCompressor{constructor(e,t){this._id=e,this._context=t}compress(e,t){let n;for(;t.length>1&&this._compareOperations(t[0],t[1]);)n?(n=this._combineNext(t.shift(),n),e.types.push(0)):(n=cloneDeep(t.shift()),e.types.push(this._id));return!!n&&(n=this._combineNext(t.shift(),n),e.types.push(0),e.buffers.push(this._compressSingleOperation(n)),!0)}decompress(e,t){const n=this._decompressSingleOperation(t);for(;0==t.types[0];)t.types.shift(),e.push(this._splitCurrent(n));e.push(n)}}class TypingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.nodes[0].data+=e.nodes[0].data,t}_splitCurrent(e){const t=cloneDeep(e),n=t.nodes[0],i=e.nodes[0],r=i.data[Symbol.iterator]().next().value,s=r.length;return n.data=r,i.data=i.data.substr(s),e.position=getPositionShiftedBy(e.position,s),t}_compareOperations(e,t){if(this._checkOperation(e)&&this._checkOperation(t)){const n=e.nodes[0].data.length,i=arePositionsEqual(getPositionShiftedBy(e.position,n),t.position),r=e.nodes[0],s=t.nodes[0];return i&&this._compareAttributes(r,s)}return!1}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("InsertOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("InsertOperation").decompress(t,e),t[0]}_checkOperation(e){return"InsertOperation"==e.__className&&1==e.nodes.length&&e.nodes[0].data&&!e.wasUndone&&1==Array.from(e.nodes[0].data).length}_compareAttributes(e,t){const n=Object.keys(e.attributes||{}),i=Object.keys(t.attributes||{});return n.length===i.length&&n.every((n=>t.attributes[n]&&t.attributes[n]===e.attributes[n]))}}class DeletingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.howMany++,t.sourcePosition=cloneDeep(e.sourcePosition),t}_splitCurrent(e){const t=cloneDeep(e);return e.howMany--,t.howMany=1,t.sourcePosition=getPositionShiftedBy(t.sourcePosition,e.howMany),t}_compareOperations(e,t){return!(!this._checkOperation(e)||!this._checkOperation(t))&&arePositionsEqual(getPositionShiftedBy(e.sourcePosition,-1),t.sourcePosition)&&arePositionsEqual(e.targetPosition,t.targetPosition)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,e),t[0]}_checkOperation(e){return"MoveOperation"==e.__className&&"$graveyard"==e.targetPosition.root&&1==e.howMany&&!e.wasUndone}}class ForwardDeletingActionCompressor extends ActionCompressor{_combineNext(e,t){return t.howMany++,t}_splitCurrent(e){const t=cloneDeep(e);return t.howMany=1,e.howMany--,t}_compareOperations(e,t){return!(!this._checkOperation(e)||!this._checkOperation(t))&&arePositionsEqual(e.sourcePosition,t.sourcePosition)&&arePositionsEqual(e.targetPosition,t.targetPosition)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,e),t[0]}_checkOperation(e){return"MoveOperation"==e.__className&&"$graveyard"==e.targetPosition.root&&1==e.howMany&&!e.wasUndone}}class UserSelectionActionCompressor extends ActionCompressor{compress(e,t){if(!this._compareOperations(t[0],t[1]))return!1;const n=t.shift();return n.oldRange=null,n.newRange&&arePositionsEqual(n.newRange.start,n.newRange.end)&&(n.newRange.end=null),t.shift(),e.types.push(this._id),e.types.push(0),e.buffers.push(this._compressSingleOperation(n)),!0}decompress(e,t){const n=this._decompressSingleOperation(t);n.newRange&&!n.newRange.end&&(n.newRange.end=cloneDeep(n.newRange.start));const i=cloneDeep(n);i.newRange&&(i.newRange.start.stickiness="toNone",i.newRange.end=cloneDeep(i.newRange.start)),i.name="user:position:"+i.name.split(":")[2],t.types.shift(),e.push(n),e.push(i)}_compressSingleOperation(e){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MarkerOperation").compress(t,[e]),t.buffers[0]}_decompressSingleOperation(e){const t=[];return this._context._getCompressorByName("MarkerOperation").decompress(t,e),t[0]}_compareOperations(e,t){return!!(e&&t&&"MarkerOperation"==e.__className&&"MarkerOperation"==t.__className&&e.name.startsWith("user:")&&t.name.startsWith("user:")&&e.name!=t.name)}}class Compressor{constructor(){this._compressorById=new Map,this._compressorByName=new Map,this._protobufFactory=new ProtobufFactory;const e=this._protobufFactory.getDescriptor("MarkerOperation");this._registerCompressor(1,"NoOperation",new NoOperationCompressor(1,"NoOperation",void 0)),this._registerOperationCompressor(10,"AttributeOperation",AttributeOperationCompressor),this._registerOperationCompressor(11,"InsertOperation",InsertOperationCompressor),this._registerOperationCompressor(12,"MarkerOperation",MarkerOperationCompressor),this._registerOperationCompressor(13,"MergeOperation",OperationCompressor),this._registerOperationCompressor(14,"MoveOperation",OperationCompressor),this._registerOperationCompressor(15,"RenameOperation",OperationCompressor),this._registerOperationCompressor(16,"RootAttributeOperation",AttributeOperationCompressor),this._registerOperationCompressor(17,"SplitOperation",OperationCompressor),this._registerCompressor(18,"CommentMarkerOperation",new AnnotationMarkerOperationCompressor(18,"MarkerOperation",e,"comment")),this._registerCompressor(19,"SuggestionMarkerOperation",new AnnotationMarkerOperationCompressor(19,"MarkerOperation",e,"suggestion")),this._registerOperationCompressor(20,"RootOperation",OperationCompressor),this._registerActionCompressor(100,"TypingAction",TypingActionCompressor),this._registerActionCompressor(101,"DeletingAction",DeletingActionCompressor),this._registerActionCompressor(102,"ForwardDeletingAction",ForwardDeletingActionCompressor),this._registerActionCompressor(103,"UserSelectionAction",UserSelectionActionCompressor)}compress(e){if(!e||!e[0])throw new CKEditorError("no-operations-provided",this);const t={types:[],buffers:[],baseVersion:e[0].baseVersion};for(;e.length;)this._getCompressorByName("UserSelectionAction").compress(t,e)||this._getCompressorByName("TypingAction").compress(t,e)||this._getCompressorByName("DeletingAction").compress(t,e)||this._getCompressorByName("ForwardDeletingAction").compress(t,e)||this._getCompressorByName("CommentMarkerOperation").compress(t,e)||this._getCompressorByName("SuggestionMarkerOperation").compress(t,e)||this._getCompressorByName(e[0].__className).compress(t,e);return t}decompress(e){const t=[];for(;e.types.length;)this._compressorById.get(e.types[0]).decompress(t,e);return t.forEach(((t,n)=>t.baseVersion=e.baseVersion+n)),t}_getCompressorByName(e){return this._compressorByName.get(e)}_registerOperationCompressor(e,t,n){const i=new n(e,t,this._protobufFactory.getDescriptor(t));this._registerCompressor(e,t,i)}_registerActionCompressor(e,t,n){const i=new n(e,this);this._registerCompressor(e,t,i)}_registerCompressor(e,t,n){this._compressorById.set(e,n),this._compressorByName.set(t,n)}}let requestCount=1;class RealTimeCollaborationClient extends Plugin{static get requires(){return[WebSocketGateway,Sessions,UserMarkers,PendingActions,Users,Notification]}static get pluginName(){return"RealTimeCollaborationClient"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get cloudDocumentVersion(){return this._lastServerVersion+this._offset}get _lastServerVersion(){return this.serverHistory.version-this._offset}get lastSyncVersion(){const e=this.serverHistory.getOperations();for(let t=e.length-1;t>=0;t--){const n=e[t];if(!this._disconnectionOperations.has(n))return n.baseVersion+1-this._offset}return 0}constructor(e){if(super(e),this._offset=0,this.sessionId=null,this.serverHistory=new History,this.editor.config.define("collaboration",{}),this._channelId=this.editor.config.get("collaboration.channelId"),!this._channelId)throw new CKEditorError("collaboration-missing-channelid",this);const t=e.config.get("cloudServices.bundleVersion")||_0xdafafb;this._service=new RealTimeCollaborationClient.CollaborativeEditingService(t,this._channelId),this._document=this.editor.model.document,this._compressor=new Compressor,this._bufferedOperations=[],this._knownOperations=new WeakSet,this._knownRootNames=new Set,this.set("_isPendingUpdate",!1),this.set("_hasSynchronizationProblem",!1),this._pendingAction=null,this._hasSelectionChanged=!1,this._sendBufferedOperationsDelayId=null,this._baseBufferDelay=300,this._currentBufferDelay=this._baseBufferDelay,this._lastSyncedOperationId=null,this._disconnectionOperations=new WeakSet,this._operationIdentifier=new OperationIdentifier(this._disconnectionOperations)}init(){const e=this.editor,t=e.plugins.get(Users),n=e.plugins.get(WebSocketGateway);this.listenTo(t,"getOperationAuthor",((e,n)=>{const i=n[0];i._authorId&&(e.return=t.getUser(i._authorId),e.stop()),null===i._authorId&&(e.return=null,e.stop())}),{priority:"high"}),this.listenTo(e.model.document.selection,"change:range",((e,t)=>{t.directChange&&this._refreshUserSelectionMarkers()})),this.listenTo(e.editing.view,"change:hasDomSelection",(()=>{this._refreshUserSelectionMarkers()})),this._initThrowingOnDataSet(),e.model.on("applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&(this._saveOperationInBuffer(n),this._shouldSendUpdate()&&this._sendBufferedOperationsDelayed())})),this._setUpDataInit(),this.bind("_isEditingAllowed").to(n,"state",this,"_hasSynchronizationProblem",((e,t)=>"connected"===e&&!t)),this.on("change:_isEditingAllowed",(()=>{this._isEditingAllowed?e.disableReadOnlyMode("rtc-offline"):e.enableReadOnlyMode("rtc-offline")})),this._isEditingAllowed?e.disableReadOnlyMode("rtc-offline"):e.enableReadOnlyMode("rtc-offline"),this.set("_isConnected",!1)}async reconnect(){const e=this.editor.plugins.get(Sessions),t=this.editor.plugins.get(WebSocketGateway);try{this._isPendingUpdate=!0,e.unregister(this._channelId);const n=await this._service.reconnect(t.connection,this.lastSyncVersion);await this._handleReconnectionResponse(n)&&(this._isPendingUpdate=!1,this._clearPendingAction());const i=await this._service.getConnectedSessions();e.register(this._channelId,i),this._handleSendingSelectionMarkers(),this._isConnected=!0}catch(e){if(isSessionNotExistingError(e)&&this.sessionId)await this._connectAfterSessionHasBeenFlushed();else if(isBaseVersionMismatchError(e)){const e=getTranslation$6(this.editor.locale,"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(e)}else{if(!(e instanceof ReconnectionError))throw e;this._handleReconnectionError()}}}destroy(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get(Sessions);this.editor.enableReadOnlyMode("rtc-destroyed"),t.channelSessions.has(this._channelId)&&t.unregister(this._channelId),e.removeFromReconnectionStack(this),this._disconnectService(),super.destroy()}async _handleReconnectionResponse(e){if(this.sessionId!==e.sessionId&&this._lastSyncedOperationId!==e.lastOperationId)throw new ReconnectionError;return this.sessionId=e.sessionId,this._handleServerResponse([],{...e,wereChangesApplied:!1,data:e.data},"reconnect")}async _connectService(e,t=!1){const{connection:n}=this.editor.plugins.get(WebSocketGateway);RealTimeCollaborationClient.CollaborativeEditingService.getConnectedSessions(n,this._channelId).then((e=>this._initSessionsHandling(e))).catch((e=>{this._crash("realtimecollaborationclient-init-session-connection-error",e)})),this.listenTo(this._service,"operationsReceived",this._handleReceivedOperations.bind(this)),this.listenTo(this._service,"error",((e,t)=>{this._crash("realtimecollaborationclient-init-service-internal-error",t)})),this.listenTo(this._service,"disconnected",(()=>{this._isConnected=!1}));const i=this._operationIdentifier.getIdOfTheLastOperation(e);this._isPendingUpdate=!0;const r=await this._service.connect(n,this._compressOperations(e),i);if(this.sessionId=r.sessionId,t){if(!r.wereChangesApplied)return void this._handleReconnectionError();this._isPendingUpdate=!1,this._clearPendingAction(),this.serverHistory.reset(),this._offset=r.offset,this.serverHistory.version=this._offset,await this._handleServerResponse(e,r,"reconnection: flushed session")}else await this._handleInitialConnectionData(r,e);this._handleSendingSelectionMarkers(),this._isConnected=!0}_handleSendingSelectionMarkers(){const e=this.editor.plugins.get(Sessions),t=this.editor.plugins.get(UserMarkers),n=e.channelSessions.get(this._channelId);n&&n.length>1?t.createUserMarkerOperations():this.listenTo(e,"sessionAdd:"+this._channelId,(()=>{2===e.channelSessions.get(this._channelId).length&&t.createUserMarkerOperations()}))}async _handleReceivedOperations(e,t,n,i){if(!this._isPendingUpdate&&this._document.version==t){const e=this._decompressOperations(n,i);await this._fetchMissingUsers(e),this._handleExternalOperations(e,t,n.lastOperationId)||this._crash("realtimecollaborationclient-init-service-incorrect-server-operation")}}async _connectAfterSessionHasBeenFlushed(){this._disconnectService();const{locale:e}=this.editor;let t;try{t=await this._service.getDocumentDetails()}catch(t){const n=getTranslation$6(e,"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");return void this._handleReconnectionError(n)}const n=t.currentDocumentSession||t.lastDocumentSession;if(this._lastSyncedOperationId===n.lastOperationId)await this._connectService(this.editor.model.document.history.getOperations(),!0);else{const t=getTranslation$6(e,"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(t)}}_disconnectService(){this._service.disconnect(),this._bufferedOperations=[],clearTimeout(this._sendBufferedOperationsDelayId),this.stopListening(this._service)}_initSessionsHandling(e){const t=this.editor.plugins.get(Sessions);this.listenTo(t,"sessionAdd:"+this._channelId,((e,{session:n})=>{if(n.id===t.mySessionId){e.off();const t=this.editor.plugins.has("CommentsOnly")&&this.editor.plugins.get("CommentsOnly");let i=n.permissions;t&&t.isEnabled&&(i=i.filter((e=>"document:write"!==e))),this.editor.plugins.get("Permissions").setPermissions(i,this._channelId)}})),t.register(this._channelId,e)}_initThrowingOnDataSet(){const e=this.editor.data.set;this.editor.data.set=(...t)=>{if(!t[t.length-1].suppressErrorInCollaboration)throw new CKEditorError("realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration",this);e.apply(this.editor.data,t)}}_setUpDataInit(){this.editor.data.on("init",((e,[t])=>{if(this._document.version)throw new CKEditorError("realtimecollaborationclient-init-document-already-initialized",this);e.stop(),this._setPendingAction();const n=this.editor.config.get("rootsAttributes"),i=this._getOperationsFromInitData(t,n);0==i.length&&i.push(new NoOperation(0)),e.return=this._connectService(i).then((()=>{this.editor.plugins.get(WebSocketGateway).addToReconnectionStack(this),this.editor.data.fire("ready")})).catch((e=>this._crash("realtimecollaborationclient-init-connection-failed",e))).finally((()=>this._clearPendingAction()))}),{priority:"high"}),this.editor.on("loadRoot",(async(e,[t,n])=>{e.stop();const i=this.editor.model.document.getRoot(t);if(!this._knownRootNames.has(t)){const e=n&&n.data?n.data:"",i=n&&n.attributes?n.attributes:{};await this._loadRoot(t,e,i)}this.editor.model.enqueueChange({isUndoable:!1},(()=>{i._isLoaded=!0,this.editor.model.document.differ._bufferRootLoad(i)}))}),{priority:"high"})}async _fetchMissingUsers(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const n of e){const e=n._authorId;e&&!t.getUser(e)&&i.add(e)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}_getOperationsFromInitData(e,t={}){const n=this.editor.model,i=[];let r=0;const s="string"==typeof e?{main:e}:e;for(const e of Object.keys(s)){if(!this._document.roots.has(e))throw new CKEditorError("realtimecollaborationclient-init-non-existent-root",this);const t=this.editor.data.parse(s[e]),o=this._document.getRoot(e),a=new InsertOperation(n.createPositionAt(o,0),t,r++);i.push(a);for(const[e,s]of t.markers){const t=n.createRange(n.createPositionFromPath(o,s.start.path.slice()),n.createPositionFromPath(o,s.end.path.slice())),a=new MarkerOperation(e,null,t,n.markers,!0,r++);i.push(a)}}if(t)for(const[e,s]of Object.entries(t)){const t=n.document.getRoot(e);if(!t)throw new CKEditorError("multi-root-editor-root-attributes-no-root",null);for(const[e,n]of Object.entries(s))if(null!==n){const s=new RootAttributeOperation(t,e,null,n,r++);i.push(s)}}return i}async _loadRoot(e,t,n){this._getOperationsFromInitData({[e]:t},{[e]:n}).forEach(((e,t)=>{e.baseVersion=this._document.version+t,e._isInit=!0,this._saveOperationInBuffer(e)})),this._sendBufferedOperationsDelayed(),await this._waitUntilSynced()}async _handleInitialConnectionData(e,t){let n;this._offset=e.offset;const i=e.wereChangesApplied&&!e.initData,r=i?0:e.data.baseVersion;if(t.forEach((t=>{t._isInit=!0,t.createdAt=e.sessionCreatedAt,t._authorId=null})),i)n=t,this._applyOperationsSet(n,i);else{if(e.initData){const t=this._getOperationsFromInitData(e.initData);this._document.history.version=-t.length,t.forEach((n=>{n.baseVersion-=t.length,n.createdAt=e.sessionCreatedAt,n._isInit=!0,n._authorId=null})),this._applyOperationsSet(t,!0),this.serverHistory.version=-t.length+this._offset,this._updateServerHistory(t)}this._document.history.version=r,n=this._decompressOperations(e.data,e.metadata),await this._fetchMissingUsers(n),this._applyOperationsSet(n,i)}e.lastOperationId&&(this._operationIdentifier.setIdForTheLastOperation(n,e.lastOperationId),this._lastSyncedOperationId=e.lastOperationId),this.serverHistory.version=r+this._offset,this._updateServerHistory(n),t.filter((e=>{const t=this._getAffectedRoot(e);return t&&!this._knownRootNames.has(t)})).forEach(((e,t)=>{e.baseVersion=this._document.version+t,this._saveOperationInBuffer(e)})),this._shouldSendUpdate()?(this._currentBufferDelay=0,this._sendBufferedOperationsDelayed(!0),await this._waitUntilSynced()):(this._isPendingUpdate=!1,this._clearPendingAction())}_crash(e,t){const n=t&&t.message;if(n&&n.startsWith("realtimecollaborationclient"))throw t;const i=this.editor.plugins.get(WebSocketGateway);throw this._isPendingUpdate=!0,i.disconnect(),this.editor.enableReadOnlyMode("realtimecollaborationclient-error"),new CKEditorError(e,this.editor,n?{originalError:n}:void 0)}_saveOperationInBuffer(e){this._knownOperations.has(e)||(this._knownOperations.add(e),this._bufferedOperations.push(e),this._pendingAction||"marker"==e.type&&!e.affectsData||this._setPendingAction())}_sendBufferedOperationsDelayed(e=!1){!e&&this._isPendingUpdate||(this._isPendingUpdate=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._sendBufferedOperationsDelayId=setTimeout((()=>{this._sendBufferedOperations().then((e=>{e&&(this._clearPendingAction(),this._isPendingUpdate=!1)})).catch((e=>{this._clearPendingAction(),this._isPendingUpdate=!1,isDisconnectionError$3(e)||this._crash(e.message,e)}))}),this._currentBufferDelay))}_waitUntilSynced(){return new Promise((e=>{this.on("change:_isPendingUpdate",(()=>{e()}))}))}async _sendBufferedOperations(){const e=this.editor.plugins.get(UserMarkers);if(this._shouldSendSelectionUpdate()&&(e.createUserMarkerOperations(),this._hasSelectionChanged=!1),!this._shouldSendUpdate())return!0;const t=[...this._bufferedOperations];for(const e of t)e.wasUndone=this._document.history.isUndoneOperation(e);const n=this._operationIdentifier.getIdOfTheLastOperation(t),i=requestCount++,r=this._compressOperations(t),s=await this._service.sendOperations(r,r.baseVersion,n);try{return await this._handleServerResponse(t,s,i)}catch(e){return this._crash("realtimecollaborationclient-sendbufferedoperations",e)}}async _handleServerResponse(e,t,n){if("error"in t)throw t.error;let i=!1;if(t.wereChangesApplied){t.lastOperationId&&(this._lastSyncedOperationId=t.lastOperationId),this._bufferedOperations=this._bufferedOperations.filter((t=>!e.includes(t)));for(const n of e)n.createdAt="lastOperationAcceptedAt"in t&&t.lastOperationAcceptedAt||void 0;updateBaseVersions(e,t.version-e.length),this._updateServerHistory(e);const n=e.filter((e=>{if(!e._isInit)return!1;const t=this._getAffectedRoot(e);return t&&!this._knownRootNames.has(t)}));updateBaseVersions(n,this._document.version),this._applyOperationsSet(n),i=!0,this._currentBufferDelay=this._baseBufferDelay}else{const e=this._decompressOperations(t.data,t.metadata).filter((e=>e.baseVersion>=this._lastServerVersion));e.forEach((e=>this._addKnownRoot(e))),this._bufferedOperations=this._bufferedOperations.filter((e=>!e._isInit||!this._knownRootNames.has(this._getAffectedRoot(e)))),this._bufferedOperations.length&&updateBaseVersions(this._bufferedOperations,this._bufferedOperations[0].baseVersion),await this._fetchMissingUsers(e),i=this._handleExternalOperations(e,t.version,t.lastOperationId),this._currentBufferDelay=Math.round(this._currentBufferDelay/2)}return i?!this._shouldSendUpdate()||(this._sendBufferedOperationsDelayed(!0),!1):this._crash("realtimecollaborationclient-handleserverresponse")}_handleExternalOperations(e,t,n){try{const i={document:this._document,useRelations:!1,padWithNoOps:!0},{operationsA:r,operationsB:s,originalOperations:o}=transformSets(e,this._bufferedOperations,i);updateBaseVersions(r,this._document.version),updateBaseVersions(s,t);for(const e of r){const t=o.get(e);e._authorId=t?t._authorId:null}n&&(this._operationIdentifier.setIdForTheLastOperation(e,n),this._lastSyncedOperationId=n),this._bufferedOperations=[...s],this._applyOperationsSet(r),this._updateServerHistory(e)}catch(e){return console.error(e),!1}return!0}_applyOperationsSet(e,t=!1){this.editor.model.enqueueChange({isUndoable:!1,isLocal:!1},(t=>{for(const n of e)this._knownOperations.add(n),this._addKnownRoot(n),t.batch.addOperation(n),this.editor.model.applyOperation(n)}))}_addKnownRoot(e){const t=this._getAffectedRoot(e);t&&this._knownRootNames.add(t)}_getAffectedRoot(e){let t,n;switch(e.type){case"insert":t=e.position.root;break;case"marker":if(n=e.newRange,!n)return null;t=n.root;break;case"addRootAttribute":t=e.root;break;case"addRoot":t=e.affectedSelectable;break;case"move":t=e.targetPosition.root;break;default:return null}return t.rootName}_updateServerHistory(e){e.forEach((e=>{const t=e.clone();t._authorId=e._authorId,t._isInit=!!e._isInit,t.createdAt=e.createdAt,t.baseVersion+=this._offset,e._isDisconnection&&this._disconnectionOperations.add(t),this.serverHistory.addOperation(t)}))}_handleReconnectionError(e){const t=this.editor.plugins.get("Notification"),n=this.editor.locale;e||(e=getTranslation$6(n,"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.")),t.showWarning(e,{title:getTranslation$6(n,"Synchronization issue"),namespace:"real-time-collaboration"}),this._hasSynchronizationProblem=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._bufferedOperations=[],this.editor.plugins.get(WebSocketGateway).disconnect()}_setPendingAction(){this._pendingAction||(this._pendingAction=this.editor.plugins.get(PendingActions).add(getTranslation$6(this.editor.locale,"PENDING_ACTION_SENDING_DATA")))}_clearPendingAction(){this._pendingAction&&(this.editor.plugins.get(PendingActions).remove(this._pendingAction),this._pendingAction=null)}_compressOperations(e){const t=e.map((e=>e.toJSON()));return this._compressor.compress(t)}_decompressOperations(e,t){return this._compressor.decompress(e).map(((e,n)=>{const i="init"==t[n].type;if("InsertOperation"==e.__className){const t=e.position.root;!this._document.getRoot(t)&&(this._document.createRoot("$root",t)._isAttached=!1)}const r=OperationFactory.fromJSON(e,this._document);return r.wasUndone=e.wasUndone,r._isInit=i,r._authorId=i?null:t[n].userId,r._isDisconnection="cs:removeUser"===t[n].type,r.createdAt=t[n].createdAt,r}))}_refreshUserSelectionMarkers(){this._hasSelectionChanged=!0,this._shouldSendSelectionUpdate()?this._sendBufferedOperationsDelayed():this._hasSelectionChanged=!1}_shouldSendSelectionUpdate(){const e=this.editor.plugins.get(Sessions).channelSessions.get(this._channelId);return!this.editor.isReadOnly&&!!e&&e.length>1&&this._hasSelectionChanged}_shouldSendUpdate(){return this._bufferedOperations.length>0||this._shouldSendSelectionUpdate()}}RealTimeCollaborationClient.CollaborativeEditingService=CollaborativeEditingService;class ReconnectionError extends Error{}function updateBaseVersions(e,t){for(const n of e)n.baseVersion=t++}function isSessionNotExistingError(e){return"404"===e.code}function isBaseVersionMismatchError(e){return"409"===e.code}function isDisconnectionError$3(e){return e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Collaborative Editing Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}class OperationIdentifier{constructor(e){this._ignoredOperations=e,this._operationToId=new WeakMap}getIdOfTheLastOperation(e){let t=e.length;for(;t--;){const n=e[t];if(!this._ignoredOperations.has(n)){if(!this._operationToId.has(n)){const e=uid().slice(1,18);this._operationToId.set(n,e)}return this._operationToId.get(n)}}}setIdForTheLastOperation(e,t){if(!t)return;let n=e.length;for(;n--;){const i=e[n];this._ignoredOperations.has(i)||this._operationToId.set(i,t)}}}class RealTimeCollaborativeEditing extends Plugin{static get requires(){return[RealTimeCollaborationClient]}static get pluginName(){return"RealTimeCollaborativeEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CloudServicesCommentsAdapter extends ContextPlugin{static get requires(){return[WebSocketGateway,"CommentsRepository",Sessions,Users]}static get pluginName(){return"CloudServicesCommentsAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._services=new Map}async init(){const e=this.context,t=e.plugins.get("CommentsRepository");if(e.plugins.get(WebSocketGateway).addToReconnectionStack(this),t.adapter={addCommentThread:async({channelId:e,threadId:t,comments:n,resolvedAt:i,resolvedBy:r,context:s,attributes:o})=>{const a=await this._getService(e).addCommentThread({commentThreadId:t,comments:n.map((n=>parseLocalCommentToRemote(n,e,t))),resolvedAt:i,resolvedBy:r,context:s,attributes:o}).catch(handleDisconnectionError$1);return{threadId:a.commentThreadId,comments:a.comments}},getCommentThread:async({channelId:e,threadId:t})=>{const n=await this._getService(e).getCommentThread(t).catch(handleDisconnectionError$1);return n.deletedAt?null:(await this._fetchMissingUsersForThreads([n]),{threadId:n.commentThreadId,comments:n.comments.map(parseRemoteCommentToLocal),context:n.context,resolvedAt:n.resolvedAt,resolvedBy:n.resolvedBy,attributes:n.attributes||{}})},updateCommentThread:async({channelId:e,threadId:t,context:n,unlinkedAt:i,attributes:r})=>this._getService(e).updateCommentThread({commentThreadId:t,context:n,attributes:r,unlinkedAt:i}).catch(handleServerError).catch(handleDisconnectionError$1),resolveCommentThread:async({channelId:e,threadId:t})=>{const n=await this._getService(e).resolveCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1);return{threadId:n.commentThreadId,resolvedAt:n.resolvedAt,resolvedBy:n.resolvedBy}},reopenCommentThread:async({channelId:e,threadId:t})=>this._getService(e).reopenCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1),removeCommentThread:({channelId:e,threadId:t})=>this._getService(e).removeCommentThread(t).catch(handleServerError).catch(handleDisconnectionError$1),addComment:({channelId:e,threadId:t,commentId:n,content:i,attributes:r})=>this._getService(e).addComment(t,n,i,r).catch(handleDisconnectionError$1),updateComment:({channelId:e,threadId:t,commentId:n,content:i,attributes:r})=>this._getService(e).updateComment(t,n,i,r).catch(handleServerError).catch(handleDisconnectionError$1),removeComment:({channelId:e,threadId:t,commentId:n})=>this._getService(e).removeComment(t,n).catch(handleServerError).catch(handleDisconnectionError$1)},e instanceof Context$1){const t=e.config.get("collaboration.channelId"),n=e.plugins.get(Sessions);await this._setUpService(t);const i=await this._services.get(t).getConnectedSessions();this.listenTo(n,"sessionAdd:"+t,((e,{session:i})=>{i.id===n.mySessionId&&(e.off(),this.context.plugins.get("Permissions").setPermissions(i.permissions,t))})),n.register(t,i)}}async _setUpService(e){if(this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-connect-already-connected",null,{channelId:e});const t=this.context.plugins.get("CommentsRepository"),n=new CloudServicesCommentsAdapter.CommentsService(e);this._services.set(e,n),this.listenTo(n,"commentThreadAdded",((e,n)=>{const{commentThreadId:i,documentId:r,context:s,attributes:o,resolvedAt:a,resolvedBy:l,comments:c}=n;t.getCommentThread(i)||t.addCommentThread({threadId:i,channelId:r,comments:c?c.map(parseRemoteCommentToLocal):[],context:s,attributes:o,resolvedAt:a,resolvedBy:l,isFromAdapter:!0})})),this.listenTo(n,"commentThreadUpdated",((e,{commentThreadId:n,documentId:i,context:r,unlinkedAt:s,attributes:o})=>{t.getCommentThread(n)&&t.updateCommentThread({threadId:n,channelId:i,context:r,unlinkedAt:s,attributes:o,isFromAdapter:!0})})),this.listenTo(n,"commentThreadResolved",((e,{commentThreadId:n,resolvedBy:i,resolvedAt:r})=>{const s=t.getCommentThread(n);s&&s.resolve({resolvedBy:i,resolvedAt:r,isFromAdapter:!0})})),this.listenTo(n,"commentThreadReopened",((e,{commentThreadId:n})=>{const i=t.getCommentThread(n);i&&i.reopen({isFromAdapter:!0})})),this.listenTo(n,"commentThreadRemoved",((e,{commentThreadId:n})=>{const i=t.getCommentThread(n);i&&i.remove({isFromAdapter:!0})})),this.listenTo(n,"commentAdded",((e,n)=>{const i=n.commentThreadId,r=t.getCommentThread(i);r&&r.addComment({...parseRemoteCommentToLocal(n),isFromAdapter:!0})})),this.listenTo(n,"commentUpdated",((e,{commentThreadId:n,commentId:i,content:r,attributes:s})=>{const o=t.getCommentThread(n);if(o){const e=o.getComment(i);e&&e.update({content:r,attributes:s,isFromAdapter:!0})}})),this.listenTo(n,"commentRemoved",((e,{commentThreadId:n,commentId:i})=>{const r=t.getCommentThread(n);if(r){const e=r.getComment(i);e&&e.remove({isFromAdapter:!0})}})),await this._connectService(e)}destroy(){if(this.context instanceof Context$1){const e=this.context.config.get("collaboration.channelId");this._terminateService(e)}}_terminateService(e){if(!this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-disconnect-not-exist",null,{channelId:e});this._getService(e).disconnect(),this._services.delete(e)}async reconnect(){for(const e of this._services.keys())await this._connectService(e);if(this.context instanceof Context$1){const e=this.context.config.get("collaboration.channelId"),t=this.context.plugins.get(Sessions);t.unregister(e);const n=await this._services.get(e).getConnectedSessions();t.register(e,n)}}async _connectService(e){const{connection:t}=this.context.plugins.get(WebSocketGateway),n=this.context.plugins.get("CommentsRepository"),i=this._services.get(e),r=await i.connect(t);await this._fetchMissingUsersForThreads(r);const s=new Set(Array.from(n.getCommentThreads({channelId:e}),(e=>e.id)));for(const e of r)e.deletedAt||s.delete(e.commentThreadId);for(const e of s)n.getCommentThread(e).remove({isFromAdapter:!0});for(const t of r){let i=n.getCommentThread(t.commentThreadId);const{commentThreadId:r,context:s,attributes:o,resolvedBy:a,resolvedAt:l,unlinkedAt:c,deletedAt:d}=t;if(d)continue;i||(i=n.addCommentThread({channelId:e,threadId:r,context:s,attributes:o||{},resolvedBy:a,resolvedAt:l,unlinkedAt:c,isFromAdapter:!0}));const u=new Set(Array.from(i.comments,(e=>e.id)));for(const e of t.comments)u.delete(e.commentId);for(const e of u)i.getComment(e).remove({isFromAdapter:!0});for(const e of t.comments){const t=i.getComment(e.commentId);t?t.content!==e.content&&t.update({content:e.content,isFromAdapter:!0}):i.addComment(Object.assign(parseRemoteCommentToLocal(e),{isFromAdapter:!0}))}}}_getService(e){if(!this._services.has(e))throw new CKEditorError("cloudservicescommentsadapter-service-not-exist",null,{channelId:e});return this._services.get(e)}async _fetchMissingUsersForThreads(e){const t=this.context.plugins.get(Users),{connection:n}=this.context.plugins.get(WebSocketGateway),i=new Set;for(const{resolvedBy:n,comments:r}of e){n&&!t.getUser(n)&&i.add(n);for(const{userId:e}of r)t.getUser(e)||i.add(e)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}}async function handleServerError(e){if("404"!==e.code)throw e}function handleDisconnectionError$1(e){if(isDisconnectionError$2(e))return new Promise((()=>{}));throw e}function isDisconnectionError$2(e){return e.message.startsWith("cloud-services-internal-error: Comments Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}function parseRemoteCommentToLocal(e){return{threadId:e.commentThreadId,commentId:e.commentId,content:e.content,createdAt:e.createdAt,authorId:e.userId,attributes:e.attributes||{}}}function parseLocalCommentToRemote(e,t,n){return{commentThreadId:n,commentId:e.commentId,userId:e.authorId,content:e.content,documentId:t,createdAt:e.createdAt,attributes:e.attributes||{}}}CloudServicesCommentsAdapter.CommentsService=CommentsService;class CloudServicesTrackChangesAdapter extends Plugin{static get requires(){return[CloudServicesCommentsAdapter,"TrackChangesEditing",WebSocketGateway]}static get pluginName(){return"CloudServicesTrackChangesAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=this.editor.config.get("collaboration.channelId");this._bufferedRequests=new Map,this._trackChangesService=new CloudServicesTrackChangesAdapter.TrackChangesService(t)}init(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get("TrackChangesEditing");return t.adapter={getSuggestion:async e=>{await this._waitForServiceReady();const t=await this._trackChangesService.get(e).catch(handleDisconnectionError);return await this._fetchMissingUsersForThreads([t]),t},addSuggestion:async({id:e,type:t,data:n,originalSuggestionId:i,attributes:r})=>{await this._waitForServiceReady();const s={id:e,type:t,data:n,originalSuggestionId:i,attributes:r},o=await this._trackChangesService.add(e,t,n,i,r).catch((t=>{if(isDisconnectionError$1(t))return new Promise((t=>{this._bufferedRequests.set(e,{resolve:t,suggestionData:s})}));throw t}));return this._bufferedRequests.delete(e),o},updateSuggestion:async(e,t)=>{if(await this._waitForServiceReady(),"open"!==t.state)return this._trackChangesService.update(e,t).catch(handleDisconnectionError)}},this.listenTo(this._trackChangesService,"suggestionUpdated",((e,n)=>{t.hasSuggestion(n.id)&&(t.getSuggestion(n.id).attributes=n.attributes)})),this._trackChangesService.connect(e.connection).then((n=>(e.addToReconnectionStack(this),this._fetchMissingUsersForThreads(n).then((()=>{for(const e of n)t.addSuggestionData(e)._saved=!0})))))}async reconnect(){const e=this.editor.plugins.get("TrackChangesEditing"),{connection:t}=this.editor.plugins.get(WebSocketGateway),n=await this._trackChangesService.connect(t);await this._fetchMissingUsersForThreads(n);for(const{suggestionData:e,resolve:t}of this._bufferedRequests.values()){let i=n.find((t=>t.id===e.id));i||(i=await this._trackChangesService.add(e.id,e.type,e.data,e.originalSuggestionId)),t(i)}for(const t of n)e.hasSuggestion(t.id)||e.addSuggestionData(t)}async _waitForServiceReady(){this._trackChangesService.isConnected||await new Promise((e=>{this.listenTo(this._trackChangesService,"connected",(t=>{t.off(),e()}))}))}async _fetchMissingUsersForThreads(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const{authorId:n}of e)t.getUser(n)||i.add(n);if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e)}}function handleDisconnectionError(e){if(isDisconnectionError$1(e))return new Promise((()=>{}));throw e}function isDisconnectionError$1(e){return e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}CloudServicesTrackChangesAdapter.TrackChangesService=TrackChangesService;class RealTimeCollaborativeComments extends Plugin{static get requires(){return["Comments",CloudServicesCommentsAdapter,RealTimeCollaborativeEditing,WebSocketGateway]}static get pluginName(){return"RealTimeCollaborativeComments"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get("CommentsEditing"),n=this.editor.plugins.get(CloudServicesCommentsAdapter);return this.editor.data.once("ready",(()=>{this.listenTo(e,"change:state",((e,n,i)=>{t.isThreadsLoadingPaused="connected"!==i}))})),this.listenTo(e,"change:state",((e,t,n)=>{this.editor.plugins.get("CommentsRepository").switchReadOnly("connected"!==n)})),n._setUpService(this.editor.config.get("collaboration.channelId"))}destroy(){this.editor.plugins.get(CloudServicesCommentsAdapter)._terminateService(this.editor.config.get("collaboration.channelId")),super.destroy()}}class RealTimeCollaborativeTrackChanges extends Plugin{static get requires(){return[RealTimeCollaborativeComments,CloudServicesTrackChangesAdapter,"TrackChanges"]}static get pluginName(){return"RealTimeCollaborativeTrackChanges"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class CloudServicesRevisionHistoryAdapter extends Plugin{static get requires(){return[WebSocketGateway,RealTimeCollaborationClient,"RevisionTracker",Sessions,Users]}static get pluginName(){return"CloudServicesRevisionHistoryAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e);const t=this.editor.config.get("collaboration.channelId");this._lastRequestId=null,this._revisionTracker=this.editor.plugins.get("RevisionTracker"),this._revisionHistoryService=new CloudServicesRevisionHistoryAdapter.RevisionHistoryService(t)}async init(){const e=this.editor.plugins.get(RealTimeCollaborationClient),t=e.serverHistory,n=this.editor.plugins.get(WebSocketGateway);this._revisionTracker.setSource({history:t,getLatestVersion:()=>this._getLatestVersion(),getCurrentRevisionId:()=>e.sessionId});const i=this.editor.config.get("cloudServices.bundleVersion")||_0xdafafb,r=await EditorService.isBundleUploaded(n.connection,i);this._revisionTracker.adapter={getRevision:async({revisionId:e})=>(await this._waitForServiceReady(),await this._revisionHistoryService.getRevision(e)),updateRevisions:async e=>{await this._waitForServiceReady();const t=this._revisionTracker.currentRevision;if(r&&1===e.length&&e[0].id===t.id)return e;for(const n of e)n.id===t.id&&(n.isEmptyCurrent=n.fromVersion===n.toVersion);return this._revisionHistoryService.updateRevisions(e,this._lastRequestId).then((t=>(this._lastRequestId=t,e))).catch((t=>{if(isDisconnectionError(t)||"400"===t.code&&void 0!==t.data.wrongRequestId){for(const t of e)!this._revisionTracker.repository.getRevision(t.id)||this._revisionTracker._bufferUpdate(t.id,t,!1);if(isDisconnectionError(t))throw t;return e}throw t}))}},this.listenTo(this._revisionHistoryService,"revisionsUpdated",((e,{revisionsData:t,requestId:n})=>{Math.max(...t.map((e=>e.toVersion)))>this._getLatestVersionFromServerOperations()-1?this._getLatestVersion().then((()=>{this._handleRevisionsUpdate(t,n)})):this._handleRevisionsUpdate(t,n)}));const{revisions:s,requestId:o}=await this._revisionHistoryService.connect(n.connection);n.addToReconnectionStack(this),this._lastRequestId=o,await this._fetchMissingUsers(s);for(const e of s)this._revisionTracker.addRevisionData(e);this.listenTo(e,"change:_isConnected",((t,n,i)=>{i&&(this._oldOffset=e._offset,t.off())})),this._revisionTracker.bind("isEnabled").to(n,"state",(e=>e===WEB_SOCKET_GATEWAY_STATES.CONNECTED))}async reconnect(){const e=this.editor.plugins.get(WebSocketGateway),t=this.editor.plugins.get(RealTimeCollaborationClient),n=async()=>{const n=this._revisionTracker.currentRevision,i=n.id,r=i!==t.sessionId;if(r){const e=t._offset-this._oldOffset,r=this._getLatestVersionFromServerOperations();if(this._revisionTracker._revisionDataBuilder.reInit(),n.toVersion+e!==r){const t=n.fromVersion+e,i=this.editor.plugins.get(Users),s=this._revisionTracker.buildRevisionData({revision:n,from:t,to:r});s.id=n.id;const o=s.authorsIds.map((e=>i.getUser(e)));n._update({...s,authors:o},!0),this._revisionTracker._bufferUpdate(n.id,s,!0)}this._revisionTracker._startingVersion=r,n.toVersion===n.fromVersion&&!this._revisionTracker._bufferedUpdates.has(i)&&this._revisionTracker.repository._revisions.remove(i),this._revisionTracker._createCurrentRevision(r)}const{revisions:s,requestId:o}=await this._revisionHistoryService.reconnect(e.connection,this._lastRequestId);r&&s.length>0?t._handleReconnectionError():(await this._fetchMissingUsers(s),this._handleRevisionsUpdate(s,o),this._revisionTracker.sendBufferedUpdates())};return t._isConnected?n():new Promise(((e,i)=>{t.once("change:_isConnected",(()=>{n().then(e).catch(i)}))}))}destroy(){super.destroy()}async _waitForServiceReady(){this._revisionHistoryService.isConnected||await new Promise((e=>{this.listenTo(this._revisionHistoryService,"connected",(t=>{t.off(),e()}))}))}_getLatestVersionFromServerOperations(){const e=this.editor.plugins.get(RealTimeCollaborationClient).serverHistory.getOperations().reverse();for(const t of e)if("marker"!==t.type||t.affectsData)return t.baseVersion+1}_getLatestVersion(){const e=this.editor.plugins.get(RealTimeCollaborationClient);return new Promise((t=>{e._isPendingUpdate?e.once("change:_isPendingUpdate",(()=>{t(this._getLatestVersionFromServerOperations())})):t(this._getLatestVersionFromServerOperations())}))}_handleRevisionsUpdate(e,t){const n=this._revisionTracker.repository;this._lastRequestId=t;for(const t of e){const e=n.getRevision(t.id);if(e){if((t.fromVersion||t.toVersion)&&(t.diffData=null),e===this._revisionTracker.currentRevision){const n=Math.max(e.toVersion,t.toVersion),i=Math.max(e.fromVersion,t.fromVersion);let r;e.toVersion===t.toVersion&&e.fromVersion===t.fromVersion?(r=!0,this._preventResendingRevisionData(t)):t.toVersion===n&&t.fromVersion===i?r=!1:(e.toVersion===n&&e.fromVersion===i||this._fixRevision({revision:e,from:i,to:n}),r=!0),r&&(delete t.fromVersion,delete t.toVersion,delete t.diffData,delete t.createdAt,delete t.authorsIds)}this._revisionTracker.setRevisionData(t),this._preventResendingRevisionData(t)}else this._revisionTracker.addRevisionData(t)}const i=n.getRevisions();i.reverse();for(let e=0;e<i.length-1;e++){const t=i[e],n=i[e+1];if(t.fromVersion<n.toVersion){const e=n.toVersion,i=Math.max(e,t.toVersion);this._fixRevision({revision:t,from:e,to:i})}}}_fixRevision({revision:e,from:t,to:n}={}){const i=this.editor.plugins.get(Users),r=this._revisionTracker.buildRevisionData({revision:e,from:t,to:n});r.authors=r.authorsIds.map((e=>i.getUser(e))),e._update(r)}_preventResendingRevisionData(e){const t={};t.id=e.id;for(const n of Object.keys(e))"id"!==n&&(t[n]=void 0);this._revisionTracker._bufferUpdate(t.id,t,!0)}async _fetchMissingUsers(e){const t=this.editor.plugins.get(Users),{connection:n}=this.editor.plugins.get(WebSocketGateway),i=new Set;for(const t of e){for(const e of t.authorsIds)s(e);t.creatorId&&s(t.creatorId)}if(0===i.size)return;const r=await User.getMany(n,Array.from(i));for(const e of r)t.getUser(e.id)||t.addUser(e);function s(e){t.getUser(e)||i.add(e)}}}function isDisconnectionError(e){return e.message.startsWith("cloud-services-internal-error: Revision History Service is not connected.")||e.message.startsWith("cloud-services-internal-error: Not connected.")||e.message.startsWith("cloud-services-internal-error: Request timeout.")}CloudServicesRevisionHistoryAdapter.RevisionHistoryService=RevisionHistoryService;class RealTimeCollaborativeRevisionHistory extends Plugin{static get requires(){return["RevisionHistory",CloudServicesRevisionHistoryAdapter,RealTimeCollaborativeEditing]}static get pluginName(){return"RealTimeCollaborativeRevisionHistory"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class PresenceCounterView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("usersCount",0),this.set("isHidden",!0),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list__counter",t.if("isHidden","ck-presence-list__counter--hidden")]},children:[{text:t.to("usersCount",(t=>getTranslation$6(e,"CONNECTED_USERS",t)))}]})}}class PresenceInlineListView extends View{constructor(e){super(e);const t=this.bindTemplate;this.items=this.createCollection(),this.keystrokes=new KeystrokeHandler,this.set({hasPopup:!1,isExpanded:!1}),this.setTemplate({tag:"div",attributes:{"aria-haspopup":t.if("hasPopup"),"aria-expanded":t.to("isExpanded",(e=>this.hasPopup&&String(e))),"aria-label":t.to("hasPopup",(t=>getTranslation$6(e,t?"Collapsed connected users list (press ENTER to open it)":"Connected users list"))),role:"list",tabindex:t.to("hasPopup",(e=>!!e&&0)),class:["ck","ck-presence-list__list"]},children:this.items,on:{click:t.to((()=>this.fire("execute")))}}),this.on("change:hasPopup",((e,t,n)=>{this.element&&(n?this.element.setAttribute("aria-expanded",String(this.isExpanded)):this.element.removeAttribute("aria-expanded"))}))}focus(){this.element.focus()}render(){super.render(),this.keystrokes.listenTo(this.element)}}class PresenceListView extends View{constructor(e){super(e);const t=this.bindTemplate;this.set("isCollapsed",!0),this.counterView=new PresenceCounterView(this.locale),this.inlineListView=new PresenceInlineListView(e),this.inlineListView.bind("hasPopup").to(this,"isCollapsed"),this.listenTo(this.inlineListView.items,"change",(()=>{for(const e of this.inlineListView.items)e.tooltipPosition="s";this.inlineListView.items.first&&(this.inlineListView.items.first.tooltipPosition="se")})),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list","ck-reset","ck-rounded-corners",t.if("isCollapsed","ck-presence-list--collapsed")]},children:[this.counterView,this.inlineListView]})}}class PresenceDropdownListView extends View{constructor(e,t){super(e),this.listWrapperView=new PresenceDropdownListWrapperView(e,t),this.setTemplate({tag:"div",attributes:{tabindex:-1,role:"application",class:["ck","ck-presence-list__dropdown-list"],"aria-label":getTranslation$6(e,"Connected users list dropdown menu")},children:[this.listWrapperView]})}}class PresenceDropdownListWrapperView extends ListView{constructor(e,t){super(e);const n=this.bindTemplate;this.set("_isScrollable",!1),this.setTemplate({tag:t?"div":"ul",attributes:{class:["ck","ck-reset","ck-list","ck-presence-list__dropdown-list-wrapper",n.if("_isScrollable","ck-presence-list__dropdown-list-wrapper_scrollable")],role:n.to("role"),"aria-label":n.to("ariaLabel"),"aria-labelledby":n.to("ariaLabelledBy")},children:this.items}),this.listenTo(_0x49a38d.window,"resize",(()=>this.checkIfScrollable())),this.items.on("change",(()=>this.checkIfScrollable()))}render(){super.render(),this.checkIfScrollable()}checkIfScrollable(){const e=this.element;e&&(this._isScrollable=Math.max(e.scrollHeight,e.clientHeight)>.8*window.innerHeight)}}class PresenceDropdownListItemView extends ListItemView{constructor(e,t,n){super(e);const i=this.bindTemplate;this.userView=new UserView(e,t);const r={tag:"li",attributes:{class:["ck","ck-presence-list__dropdown-list-item"],tabindex:-1,role:"presentation","aria-label":t.name},children:[this.userView,{tag:"span",attributes:{class:["ck","ck-user__full-name"]},children:[{text:t.name}]},{tag:"span",attributes:{class:["ck","ck-presence-list__marker",t.color.getBackgroundColorClass()],"aria-hidden":"true"}}]};n&&(r.tag="button",r.on={click:i.to((()=>this.fire("execute")))}),this.setTemplate(r)}focus(){this.element.focus()}}class PresenceInlineListItemView extends View{constructor(e,t,n){super(e);const i=this.bindTemplate;this.set("isFocusable",!1),this.set("hasTooltip",!0),this.set("tooltipPosition",""),this.userView=new UserView(e,t),this.markerView=new MarkerView(e,t);const r=new LabelView(e);r.template.tag="span",r.text=t.name;const s={tag:"div",attributes:{class:["ck","ck-presence-list__list-item"],role:"listitem",tabindex:i.to("isFocusable",(e=>!!e&&0)),"aria-labelledby":r.id,"data-cke-tooltip-text":this.userView.name,"data-cke-tooltip-position":i.to("tooltipPosition"),"data-cke-tooltip-disabled":i.to("hasTooltip",(e=>!e)),"data-cke-tooltip-class":"ck-presence-list__list-item__tooltip"},children:[this.userView,this.markerView,r]};n&&(s.tag="button",s.on={click:i.to((()=>this.fire("execute")))}),this.setTemplate(s)}}class MarkerView extends View{constructor(e,t){super(e),this.setTemplate({tag:"span",attributes:{class:["ck","ck-presence-list__marker",t.color.getBackgroundColorClass()],"aria-hidden":"true"}})}}const defaultPresenceListConfig={collapseAt:6,displayMe:!0};class PresenceListUI extends ContextPlugin{constructor(e){super(e),this._bodyCollection=null,this.context.config.define("presenceList",defaultPresenceListConfig);const t=e.config.get("presenceList.collapseAt");if("number"!=typeof t)throw new CKEditorError("presencelist-collapseat-invalid-format",this);if(t<1)throw new CKEditorError("presencelist-collapseat-invalid-format",this);this._allConnectedUsers=this.context.plugins.get(Sessions).allConnectedUsers,this.set("usersCount",0),this.currentDisplayedUsers=new Collection,this.balloonPanelView=new BalloonPanelView,this.balloonPanelView.class="ck ck-presence-list__balloon",this.view=this._createView(),this.presenceDropdownView=void 0}static get requires(){return[Sessions]}init(){for(const e of this._allConnectedUsers)this._handleUserAdd(e);this.listenTo(this._allConnectedUsers,"add",((e,t)=>{this._handleUserAdd(t)})),this.listenTo(this._allConnectedUsers,"remove",((e,t)=>{this._handleUserRemove(t)}))}_createView(){const e=this.context,t=new PresenceListView(this.context.locale),n=this.balloonPanelView;if(!isElement$2(e.config.get("presenceList.container")))throw new CKEditorError("presencelist-missing-container",this);return t.counterView.bind("usersCount").to(this),t.bind("isCollapsed").to(this,"usersCount",(n=>{const{collapseAt:i,displayMe:r}=e.config.get("presenceList"),s=n>=i;return t.counterView.isHidden=!(1==n&&r||s),s||this.hideDropdown(),s})),t.inlineListView.items.bindTo(this.currentDisplayedUsers).using((n=>{const i=e.config.get("presenceList"),r=new PresenceInlineListItemView(e.locale,n,!!i.onClick);return r.bind("hasTooltip").to(t,"isCollapsed",(e=>!e)),r.bind("isFocusable").to(t,"isCollapsed",(e=>!e)),i.onClick&&this.listenTo(r,"execute",(()=>{this.view.isCollapsed||i.onClick(n,r.element)})),r})),this.listenTo(t.inlineListView,"execute",(()=>{this.presenceDropdownView?this.hideDropdown():this.view.isCollapsed&&this.showDropdown()})),t.inlineListView.keystrokes.set("Enter",((e,t)=>{this.view.isCollapsed&&(this.showDropdown(),t())})),t.render(),n.render(),clickOutsideHandler({emitter:t,activator:()=>n.isVisible,contextElements:[n.element,t.inlineListView.element],callback:()=>this.hideDropdown()}),e.config.get("presenceList.container").appendChild(t.element),this._bodyCollection=new BodyCollection(this.context.locale),this._bodyCollection.attachToDom(),this._bodyCollection.add(this.balloonPanelView),t}_handleUserAdd(e){if(!this.context.config.get("presenceList.displayMe")&&e.isMe)return;const t=this.context.config.get("presenceList.collapseAt")-1;this.usersCount++,this.currentDisplayedUsers.length==t&&this.currentDisplayedUsers.length>1&&this.currentDisplayedUsers.remove(1);const n=e.isMe?0:this.currentDisplayedUsers.length;this.currentDisplayedUsers.add(e,n)}_handleUserRemove(e){if(this.usersCount--,this.currentDisplayedUsers.get(e.id)&&(this.currentDisplayedUsers.remove(e.id),this.currentDisplayedUsers.length<this.usersCount))for(const e of Array.from(this._allConnectedUsers).reverse())if(!this.currentDisplayedUsers.get(e.id))return void this.currentDisplayedUsers.add(e,Math.min(this.currentDisplayedUsers.length,1))}showDropdown(){if(this.presenceDropdownView)return;const e=this.context.config.get("presenceList");this.presenceDropdownView=new PresenceDropdownListView(this.context.locale,!!e.onClick),this.view.inlineListView.isExpanded=!0;const{listWrapperView:t}=this.presenceDropdownView;t.items.bindTo(this._allConnectedUsers).using((t=>{if(!e.displayMe&&t.isMe)return null;const n=new PresenceDropdownListItemView(this.context.locale,t,!!e.onClick);return e.onClick&&this.listenTo(n,"execute",(()=>{e.onClick(t,n.element)})),n})),this.balloonPanelView.content.add(this.presenceDropdownView),this.balloonPanelView.pin({target:this.view.inlineListView.element}),t.focus(),t.checkIfScrollable();const n=(e,t)=>{this.hideDropdown(),this.view.inlineListView.focus(),t()};t.keystrokes.set("Esc",n),t.keystrokes.set("Shift+Tab",n),t.keystrokes.set("Tab",((e,t)=>{focusNextElement(this.view.element),this.hideDropdown(),t()})),t.focusTracker.add(this.view.element),t.focusTracker.on("change:isFocused",((e,t,n)=>{n||this.hideDropdown()}))}hideDropdown(){this.presenceDropdownView&&(this.view.inlineListView.isExpanded=!1,this.balloonPanelView.unpin(),this.balloonPanelView.content.remove(this.presenceDropdownView),this.presenceDropdownView.destroy(),this.presenceDropdownView=void 0)}destroy(){super.destroy(),this.view&&this.view.isRendered&&this.view.destroy(),this._bodyCollection&&(this._bodyCollection.detachFromDom(),this._bodyCollection.destroy(),this._bodyCollection=null)}}function focusNextElement(e){const t=["a","button","input","select","textarea","[tabindex]","[contenteditable]"].map((e=>e+':not([disabled]):not([tabindex="-1"])')).join(","),n=[...document.body.querySelectorAll(t)].filter((e=>e===document.activeElement||e.offsetWidth+e.offsetHeight>0)).sort(((e,t)=>(e.tabIndex||0)-(t.tabIndex||0))),i=n.indexOf(e),r=n[(i+1)%n.length];r&&r.focus()}class PresenceList extends ContextPlugin{static get requires(){return[Sessions,PresenceListUI]}static get pluginName(){return"PresenceList"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class Revision extends(/*   -- @preserve */
ObservableMixin()){constructor(e){super(),this.id=e.id||uid(),this.creator=e.creator||null,this.authors=e.authors||[],this.diffData=e.diffData||null,this.toVersion=e.toVersion||0,this.fromVersion=e.fromVersion||0,this.set("name",e.name||""),this.set("createdAt",e.createdAt||new Date),this.set("attributes",e.attributes||{})}setName(e){this._update({name:e})}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),this._update({attributes:n})}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),this._update({attributes:t})}_update(e,t=!1){let n=!1;const i={id:this.id},r=["name","createdAt","diffData","authors","attributes","toVersion","fromVersion","creatorId"];for(const t of r){const r=e[t];void 0!==r&&r!==this[t]&&(this[t]=r,i[t]=r,n=!0)}n&&(i.authors&&(i.authorsIds=i.authors.map((e=>e.id)),delete i.authors),this.fire("_update",i,t))}toJSON(){return{id:this.id,name:this.name,creatorId:this.creator?this.creator.id:null,authorsIds:this.authors.map((e=>e.id)),diffData:this.diffData,createdAt:this.createdAt,attributes:this.attributes,fromVersion:this.fromVersion,toVersion:this.toVersion}}}class RevisionsRepository extends Plugin{static get requires(){return[Users]}static get pluginName(){return"RevisionsRepository"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get length(){return this._revisions.length}constructor(e){super(e),this._revisions=new Collection}afterInit(){checkLicense$5(this)}createRevision(e){const t=this.editor.plugins.get("Users");return new Revision({id:e.id,name:e.name,creator:e.creatorId?t.getUser(e.creatorId):null,diffData:e.diffData||e.data,authors:e.authorsIds.map((e=>t.getUser(e))),createdAt:new Date(e.createdAt),attributes:e.attributes,fromVersion:e.fromVersion,toVersion:e.toVersion})}addRevision(e,t=0){this._revisions.add(e,t)}getRevision(e){return this._revisions.get(e)}getRevisions(e={toJSON:!1}){const t=Array.from(this._revisions);return t.reverse(),e.toJSON?t.map((e=>e.toJSON())):t}getIndex(e){return this._revisions.getIndex(e)}getEarlierVisibleRevision(e){const[,t]=this.getRevisionsIterator(e,{direction:"earlier"});return t}getLaterVisibleRevision(e){const[,t]=this.getRevisionsIterator(e,{direction:"later"});return t}getRevisionsInDiff(e){const t=[];for(const n of this.getRevisionsIterator(e.newRevisionId))if(t.push(n),n.id===e.oldRevisionId)break;return t}*getRevisionsIterator(e,{direction:t="earlier",filter:n=()=>!0}={}){const i="earlier"===t?1:-1;let r=this._revisions.get(e),s=this.getIndex(r);for(yield r;r;){if(s+=i,r=this.getRevision(s),!r)return;n(r)&&(yield r)}}}async function checkLicense$5(e){const t=b([81,109,89,53,120,78,113,111,103,122,57,49,48,118,71,85,72,101,112,82,84,70,69,52,80,73,97,90,75,86,108,51,76,107,102,106,100,104,74,83,110,119,54,105,65,55,88,66,115,121,67,79,50,98,56,116,114,99,77,117,87,68]),n=964649,i=window[b([68,97,116,101])][b([110,111,119])](),r=e[b([101,100,105,116,111,114])],s=new(window[b([80,114,111,109,105,115,101])])((e=>{r[b([111,110,99,101])](b([114,101,97,100,121]),e)})),o={[b([107,116,121])]:b([69,67]),[b([117,115,101])]:b([115,105,103]),[b([99,114,118])]:b([80,45,50,53,54]),[b([120])]:b([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[b([121])]:b([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[b([97,108,103])]:b([69,83,50,53,54])},a=r[b([99,111,110,102,105,103])][b([103,101,116])](b([108,105,99,101,110,115,101,75,101,121]));function l(t){const i=[new(window[b([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),s[b([116,104,101,110])]((()=>new(window[b([80,114,111,109,105,115,101])])((t=>{const n=e[b([95,114,101,118,105,115,105,111,110,115])];function i(){n[b([108,101,110,103,116,104])]>=7&&t()}i(),n[b([111,110])](b([97,100,100]),i)})))),new(window[b([80,114,111,109,105,115,101])])((e=>{p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&function t(){for(const t in window)if(window[b([78,117,109,98,101,114])].isNaN(window[b([78,117,109,98,101,114])](t))&&window[t]==n)return e();r[b([115,116,97,116,101])]!=b([100,101,115,116,114,111,121,101,100])&&window[b([115,101,116,84,105,109,101,111,117,116])](t,5e3)}()}))];return window[b([80,114,111,109,105,115,101])][b([114,97,99,101])](i)[b([116,104,101,110])]((()=>t))}function c(){const e=window[b([83,116,114,105,110,103])](window[b([112,101,114,102,111,114,109,97,110,99,101])][b([110,111,119])]())[b([114,101,112,108,97,99,101])](b([46]),"");let n=b([81]);for(let i=0;i<e[b([108,101,110,103,116,104])];i+=2){let r=window[b([112,97,114,115,101,73,110,116])](e[b([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[b([108,101,110,103,116,104])]&&(r-=t[b([108,101,110,103,116,104])]),n+=t[r]}return n}function d(e){return e[b([115,116,97,114,116,115,87,105,116,104])](b([101,121]))?JSON[b([112,97,114,115,101])](u(e)):null}function u(e){return window[b([97,116,111,98])](e[b([114,101,112,108,97,99,101])](/-/g,b([43]))[b([114,101,112,108,97,99,101])](/_/g,b([47])))}function h(e){let t=5381;function n(e){for(let n=0;n<e[b([108,101,110,103,116,104])];n++){const i=e[b([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[b([105,115,65,114,114,97,121])](t)?t[b([102,111,114,69,97,99,104])](e):t&&typeof t==b([111,98,106,101,99,116])?Object[b([101,110,116,114,105,101,115])](t)[b([115,111,114,116])]()[b([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[b([83,116,114,105,110,103])](t))}(e),t>>>0}function m(e){return e[b([116,111,83,116,114,105,110,103])](16)[b([112,97,100,83,116,97,114,116])](8,b([48]))}function g(e){return e[b([115,112,108,105,116])]("")[b([114,101,118,101,114,115,101])]()[b([106,111,105,110])]("")}function p(e){return r[b([112,108,117,103,105,110,115])][b([104,97,115])](e)}function f(e){return r[b([112,108,117,103,105,110,115])][b([103,101,116])](e)}function y(){}function b(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(t){const i=c();r[i]=b([114,101,118,105,115,105,111,110,72,105,115,116,111,114,121,76,105,99,101,110,115,101,75,101,121])+t,t[b([101,110,100,115,87,105,116,104])](b([76,105,109,105,116]))&&(window[c()]=n),t!=b([86,97,108,105,100])&&async function(){if(await s,p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const t=e[b([103,101,116,82,101,118,105,115,105,111,110])](0),n=e[b([103,101,116,69,97,114,108,105,101,114,86,105,115,105,98,108,101,82,101,118,105,115,105,111,110])](t[b([105,100])]),i=f(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114]));return await i[b([99,111,109,112,97,114,101])](t.id,n?n.id:null,!0),i[b([117,110,98,105,110,100])](b([105,115,69,110,97,98,108,101,100])),i[b([105,115,69,110,97,98,108,101,100])]=!1,i[b([99,111,109,112,97,114,101])]=y,void(i[b([95,103,101,116,68,105,102,102])]=y)}if(p(b([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))){const e=f(b([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]));e[b([117,110,98,105,110,100])](b([105,115,69,110,97,98,108,101,100])),e[b([105,115,69,110,97,98,108,101,100])]=!1,e[b([117,112,100,97,116,101])]=y,e[b([115,97,118,101,82,101,118,105,115,105,111,110])]=y}r[b([109,111,100,101,108])][b([99,104,97,110,103,101])]=y,r[b([109,111,100,101,108])][b([101,110,113,117,101,117,101,67,104,97,110,103,101])]=y,r[b([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](b([109,111,100,101,108]))}()}(await async function(){let e,t=null,n=null;try{if(a==b([71,80,76]))return b([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=a[b([115,112,108,105,116])](b([46]));if(3!=e[b([108,101,110,103,116,104])])return null;return function(e){const t=d(e);return t&&function(){const e=t[b([106,116,105])],n=window[b([112,97,114,115,101,73,110,116])](e[b([115,117,98,115,116,114,105,110,103])](e[b([108,101,110,103,116,104])]-8),16),i={...t,[b([106,116,105])]:e[b([115,117,98,115,116,114,105,110,103])](0,e[b([108,101,110,103,116,104])]-8)};return delete i[b([118,99])],h(i)==n}()?t:null}(e[1])}(),!e)return b([73,110,118,97,108,105,100]);e[b([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(c=e[b([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[b([106,116,105])],n=new(window[b([80,114,111,109,105,115,101])])((e=>{if(r[b([101,100,105,116,105,110,103])][b([118,105,101,119])][b([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==b([97,117,116,111]))return e(b([86,97,108,105,100]));r[b([101,100,105,116,105,110,103])][b([118,105,101,119])][b([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=b([97,117,116,111]),r[b([100,101,99,111,114,97,116,101])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const n=uid();function o(t){var r;(r=t,new(window[b([80,114,111,109,105,115,101])])(((e,t)=>{r[b([116,104,101,110])](e,t),window[b([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[b([116,104,101,110])]((e=>e&&e[b([115,116,97,116,117,115])]==b([111,107])?m(h(n+y))!=e[b([118,101,114,105,102,105,99,97,116,105,111,110])]?b([85,115,97,103,101,76,105,109,105,116]):b([86,97,108,105,100]):b([85,115,97,103,101,76,105,109,105,116])))[b([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=b([108,108,99,116,45])+m(h(c)),t=window[b([108,111,99,97,108,83,116,111,114,97,103,101])][b([103,101,116,73,116,101,109])](e);return t?window[b([112,97,114,115,101,73,110,116])](g(t),16)*s:null}();return null==e?(o(),b([86,97,108,105,100])):b(i-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[b([116,104,101,110])](e)[b([99,97,116,99,104])]((()=>{e(b([85,115,97,103,101,76,105,109,105,116]))}));const s=36e5;function o(){const e=b([108,108,99,116,45])+m(h(c)),t=g(m(window[b([77,97,116,104])][b([99,101,105,108])](i/s)));window[b([108,111,99,97,108,83,116,111,114,97,103,101])][b([115,101,116,73,116,101,109])](e,t)}}r[b([111,110])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,i)=>{if(i[0]!=c)return e(b([85,115,97,103,101,76,105,109,105,116]));i[1]={...i[1],[b([114,101,113,117,101,115,116,73,100])]:n}}),{[b([112,114,105,111,114,105,116,121])]:b([104,105,103,104])}),r[b([111,110])](b([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[b([114,101,116,117,114,110])])&&(typeof n===b([111,98,106,101,99,116])||typeof n===b([102,117,110,99,116,105,111,110]))&&typeof n[b([116,104,101,110])]===b([102,117,110,99,116,105,111,110])&&typeof n[b([99,97,116,99,104])]===b([102,117,110,99,116,105,111,110])&&(t=!0,o(e[b([114,101,116,117,114,110])]))}),{[b([112,114,105,111,114,105,116,121])]:b([108,111,119])}),s[b([116,104,101,110])]((()=>{t||e(b([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=a[b([115,112,108,105,116])](b([46])),[n,i,r]=t;return function(t){const n=d(t);n&&n[b([97,108,103])]==b([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[b([85,105,110,116,56,65,114,114,97,121])][b([102,114,111,109])](u(i),(e=>e[b([99,104,97,114,67,111,100,101,65,116])](0))),s=(new(window[b([84,101,120,116,69,110,99,111,100,101,114])]))[b([101,110,99,111,100,101])](t+b([46])+n),a=window[b([99,114,121,112,116,111])][b([115,117,98,116,108,101])];if(!a)return;const l=await a[b([105,109,112,111,114,116,75,101,121])](b([106,119,107]),o,{[b([110,97,109,101])]:b([69,67,68,83,65]),[b([110,97,109,101,100,67,117,114,118,101])]:b([80,45,50,53,54])},!1,[b([118,101,114,105,102,121])]);await a[b([118,101,114,105,102,121])]({[b([110,97,109,101])]:b([69,67,68,83,65]),[b([104,97,115,104])]:{[b([110,97,109,101])]:b([83,72,65,45,50,53,54])}},l,r,s)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[b([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[b([105,110,99,108,117,100,101,115])](b([42])))return!0;if(t[b([105,110,99,108,117,100,101,115])](b([82,72])))return!0;if(t[b([105,110,99,108,117,100,101,115])](b([82,82,72]))){if(p(b([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&f(b([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[b([115,116,97,116,101])]==b([99,111,110,110,101,99,116,101,100]))return!0;if(p(b([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||p(b([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}return!1}()?function(){const t=[b([101,118,97,108,117,97,116,105,111,110]),b([116,114,105,97,108])][b([105,110,99,108,117,100,101,115])](e[b([108,105,99,101,110,115,101,84,121,112,101])])?i/1e3:1739318400;return e[b([101,120,112])]<t}()?b([69,120,112,105,114,101,100]):function(){const t=e[b([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[b([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[b([108,111,99,97,116,105,111,110])].href);if(t[b([105,110,99,108,117,100,101,115])](n))return!0;const i=n[b([115,112,108,105,116])](b([46]));return t[b([102,105,108,116,101,114])]((e=>e[b([105,110,99,108,117,100,101,115])](b([42]))))[b([109,97,112])]((e=>e[b([115,112,108,105,116])](b([46]))))[b([115,111,109,101])]((e=>i[b([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===b([42])))))}()?(e[b([108,105,99,101,110,115,101,84,121,112,101])]==b([101,118,97,108,117,97,116,105,111,110])&&(t=l(b([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[b([108,105,99,101,110,115,101,84,121,112,101])]==b([116,114,105,97,108])&&(t=l(b([84,114,105,97,108,76,105,109,105,116]))),await(t&&n?new(window[b([80,114,111,109,105,115,101])])(((e,i)=>{t[b([116,104,101,110])](e,i),n[b([116,104,101,110])]((t=>{t!=b([86,97,108,105,100])&&e(t)}),i)})):t||n||b([86,97,108,105,100]))):b([68,111,109,97,105,110,76,105,109,105,116]):b([78,111,116,65,108,108,111,119,101,100]):b([73,110,118,97,108,105,100])}catch(e){return b([73,110,118,97,108,105,100])}var c,y}())}function getTranslation$5(e,t,n){const i=e.t;switch(t){case"Revision history":return i("Revision history");case"Open revision history":return i("Open revision history");case"Restored":return i("Restored");case"Empty document":return i("Empty document");case"Initial revision":return i("Initial revision");case"Suggested by":return i("Suggested by");case"Added by":return i("Added by");case"Removed by":return i("Removed by");case"Show more items":return i("Show more items");case"Compare against selected":return i("Compare against selected");case"Name this revision":return i("Name this revision");case"Restore this revision":return i("Restore this revision");case"Back to editing":return i("Back to editing");case"Loading...":return i("Loading...");case"No changes":return i("No changes");case"NUMBER_OF_CHANGES":return i({string:"%0 change",plural:"%0 changes",id:"NUMBER_OF_CHANGES"},n);case"X_OF_Y_CHANGES":return i({string:"%0 of %1",id:"X_OF_Y_CHANGES"},n);case"Show previous change":return i("Show previous change");case"Show next change":return i("Show next change");case"EDIT_X_OF_Y_REVISIONS":return i({string:"Edit",id:"EDIT_X_OF_Y_REVISIONS"});case"Total":return i("Total");case"Revision creator":return i("Revision creator");case"Revision author":return i("Revision author");case"Revision name":return i("Revision name");case"Save current revision":return i("Save current revision");case"Accept":return i("Accept");case"Save":return i("Save");case"Cancel":return i("Cancel");case"Name of the revision":return i("Name of the revision");case"optional":return i("optional");case"PENDING_ACTION_REVISION_HISTORY":return i({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"The revision name cannot be empty.":return i("The revision name cannot be empty.");case"Enter the revision name":return i("Enter the revision name");default:return""}}const charToViewElementClass={c:ViewContainerElement,a:ViewAttributeElement,e:ViewEmptyElement,r:ViewRawElement,u:ViewUIElement};class RevisionTracker extends Plugin{static get pluginName(){return"RevisionTracker"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Users,RevisionsRepository,PendingActions]}constructor(e){super(e),this.adapter=null,this.currentRevision=null,this._revisionDataBuilder=new RevisionDataBuilder(this.editor),this._initialRevisionId=this.editor.config.get("collaboration.channelId")||"initial",this._bufferedUpdates=new Map,this._loadedStateData=null;const t=uid();this._source={history:this.editor.model.document.history,getLatestVersion:()=>Promise.resolve(this.editor.model.document.version),getCurrentRevisionId:()=>t},this.set("isReady",!1),this.set("isEnabled",!0),this.set("_isPendingUpdate",!1),this.editor.config.define("revisionHistory.resumeUnsavedRevision",!0),this.editor.conversion.for("upcast").dataToMarker({view:"revision"})}init(){this.repository=this.editor.plugins.get("RevisionsRepository"),this._setConversion(),this.editor.data.on("ready",(()=>{const e=this.repository.getRevision(0),t=e&&null===e.creator?e:null;if(this._continueCurrentRevision=!!t&&this.editor.config.get("revisionHistory.resumeUnsavedRevision"),this.editor.plugins.has("RealTimeCollaborationClient")){const n=this._source.getCurrentRevisionId(),i=this.repository.getRevision(n);if(i)this._startingVersion=i.fromVersion,this._continueCurrentRevision=!1;else{const n=this._source.history._operations.find((e=>!e._isInit)),i=n?n.baseVersion:this._source.history.version;e?(e.toVersion<i&&e._update({toVersion:i}),this._continueCurrentRevision?(this._source.getCurrentRevisionId=()=>t.id,this._startingVersion=t.fromVersion):(this._startingVersion=e.toVersion,this._continueCurrentRevision=!1)):(this._startingVersion=i,this._continueCurrentRevision=!1)}}else t&&(this.editor.model.document.history.version=Math.max(t.toVersion,this.editor.model.document.history.version),t.fromVersion===t.toVersion?(0!==t.fromVersion&&(this._source.getCurrentRevisionId=()=>t.id),this._continueCurrentRevision=!1):this._continueCurrentRevision&&(this._source.getCurrentRevisionId=()=>t.id,this._startingVersion=t.fromVersion)),this._continueCurrentRevision||(this._startingVersion=this.editor.model.document.version);this._revisionDataBuilder.init(this._source.history),this._createInitialRevision(this._startingVersion),this._createCurrentRevision(this._startingVersion),this.adapter&&this.sendBufferedUpdates()})),this.bind("isReady").to(this,"_isPendingUpdate",(e=>!e)),this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("revisionHistoryLicenseKeyValid"==r||"revisionHistoryLicenseKeyInvalid"==r||"revisionHistoryLicenseKeyExpired"==r||"revisionHistoryLicenseKeyDomainLimit"==r||"revisionHistoryLicenseKeyNotAllowed"==r||"revisionHistoryLicenseKeyEvaluationLimit"==r||"revisionHistoryLicenseKeyTrialLimit"==r||"revisionHistoryLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"revisionHistoryLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"revisionHistoryLicenseKeyExpired"==t&&e._showLicenseError("expired"),"revisionHistoryLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"revisionHistoryLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","RevisionHistory"),"revisionHistoryLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"revisionHistoryLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"revisionHistoryLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}async afterInit(){if(this.repository.length>0){const e=this.repository.getRevision(0),t=await this.getRevisionDocumentData(e),n=await this.getRevisionRootsAttributes(e);this._replaceEditorDataWithRevisionData(t,n)}}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}setSource(e){this._source=e}async update(){const e=await this._source.getLatestVersion();if(e>this.currentRevision.toVersion){await this._loadState();const t=this.buildRevisionData({revision:this.currentRevision,to:e});t.authors=t.authorsIds.map((e=>this.editor.plugins.get("Users").getUser(e))),this.currentRevision._update(t)}}async _loadState(){this._continueCurrentRevision&&!this._loadedStateData&&(await this._loadRevisionData(this.currentRevision),this._revisionDataBuilder.loadState(this.currentRevision),this._loadedStateData={fromVersion:this.currentRevision.fromVersion,authors:this.currentRevision.authors.slice()})}async saveRevision(e={},t=null){const n=[];await this._loadState(),this._continueCurrentRevision=!1,t>this.currentRevision.toVersion&&(t=null),null===t&&(t=await this._source.getLatestVersion());const i=this._getFromVersion(t),r=this.buildRevisionData({from:i,to:t});if(this.currentRevision.toVersion<t){const e=this.buildRevisionData({revision:this.currentRevision,from:t,to:t});e.authors=[],e.authorsIds=[],e.id=this.currentRevision.id,this.currentRevision._update(e,!0),delete e.authors,n.push(e)}e.creatorId=this.editor.plugins.get("Users").me.id,e.name=e.name||null,e.id=e.id||uid(),e={...e,...r};const s=this.addRevisionData(e);n.push(e);const o=this.repository.getIndex(s);if(0!==o){const i=this.repository.getRevision(o-1);if(i.fromVersion!==t){const r=this._revisionDataBuilder.getData(t,i.toVersion),s={id:i.id,diffData:r.diffData,authorsIds:r.authorsIds,authors:r.authorsIds.map((e=>this.editor.plugins.get("Users").getUser(e))),fromVersion:t};i===this.currentRevision&&(s.createdAt=new Date(e.createdAt.getTime()+10)),i._update(s,!0),delete s.authors,n.push(s)}}if(this.adapter){for(const e of n)this._bufferUpdate(e.id,e,!0);this.sendBufferedUpdates()}return s}addRevisionData(e){const t=this.repository.createRevision(e);return this.adapter&&t.on("_update",((e,t,n)=>{n||(this._bufferUpdate(t.id,t,!0),this.sendBufferedUpdates())})),this.repository.addRevision(t,this._findInsertionIndex(t)),t}async getRevisionDocumentData(e){await this._loadRevisionData(e);const t={};for(const n in e.diffData){if(e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached)continue;const i=this._removeRevisionMarkers(JSON.parse(e.diffData[n].insertions)),r=this.editor.editing.view.document,s=new ViewDocumentFragment(r,i.map((e=>getViewObj(e,this.editor))));this.editor.data.processor.useFillerType("marked"),t[n]=this.editor.data.processor.toData(s),this.editor.data.processor.useFillerType("default")}return t}async getRevisionRootsAttributes(e){await this._loadRevisionData(e);const t={};for(const n in e.diffData)e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached||(t[n]=e.diffData[n].attributesAfter||{});return t}sendBufferedUpdates(){if(0===this._bufferedUpdates.size)return;if(this._isPendingUpdate)return;let e=Array.from(this._bufferedUpdates.values());this._bufferedUpdates.clear();for(let t=0;t<e.length;t++){const n=e[t];let i=!1;for(const e of Object.keys(n))void 0===n[e]?delete n[e]:"id"!==e&&(i=!0);i||(e[t]=null)}if(e=e.filter((e=>null!==e)),!e.length)return;for(let t=0;t<e.length;t++){const n=e[t];void 0!==n.fromVersion&&void 0===n.toVersion&&(n.toVersion=this.repository.getRevision(n.id).toVersion),void 0!==n.toVersion&&void 0===n.fromVersion&&(n.fromVersion=this.repository.getRevision(n.id).fromVersion)}const t=this.editor.config.get("collaboration.channelId");this._isPendingUpdate=!0,this._addPendingAction(),this.adapter.updateRevisions(e,t).finally((()=>{this._isPendingUpdate=!1})).then((e=>{if(e)for(const t of e)this.setRevisionData({id:t.id,createdAt:t.createdAt});this._removePendingAction(),this.sendBufferedUpdates()}))}_replaceEditorDataWithRevisionData(e,t){let n=this.editor.config.get("initialData"),i=this.editor.config.get("rootsAttributes");if(void 0===n){n={};for(const e of this.editor.model.document.getRootNames())n[e]=""}if("string"==typeof n&&(n={main:n}),void 0===i){i={};for(const e of this.editor.model.document.getRootNames())i[e]={}}let r=!1;const s=Object.keys(n),o=Object.keys(e);for(const o of s){if(n[o]!==e[o]&&""!==n[o].trim()){r=!0;break}if(!isEqual(i[o],t[o])&&Object.keys(i[o]).length>0){r=!0;break}}r||(r=o.some((e=>!this.editor.model.document.getRoot(e)))),r&&logWarning("editor-initial-data-replaced-with-revision-data",{editorData:n,editorRootsAttributes:i,revisionData:e,revisionRootsAttributes:t}),this.editor.config.set("initialData",e),this.editor.config.set("rootsAttributes",t)}_addPendingAction(){if(!this._pendingAction){const e=this.editor.plugins.get("PendingActions");this._pendingAction=e.add(getTranslation$5(this.editor.locale,"PENDING_ACTION_REVISION_HISTORY"))}}_removePendingAction(){this._pendingAction&&(this.editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null)}_findInsertionIndex(e){const t=this.repository.getRevisions();t.reverse();let n=0;for(;n<t.length;){const i=t[n];if(i===this.currentRevision){n++;continue}if(i.id===this._initialRevisionId)break;const r=e.toVersion-i.toVersion||e.fromVersion-i.fromVersion;if(r>0)break;if(r<0)n++;else{if(!e.creator&&i.creator)break;if(i.creator||!e.creator){if(e.createdAt>i.createdAt)break;n++}else n++}}return n}setRevisionData(e){const t=this.repository.getRevision(e.id);if(e.createdAt&&(e.createdAt=new Date(e.createdAt)),e.authorsIds){const t=this.editor.plugins.get("Users");e.authors=e.authorsIds.map((e=>t.getUser(e)))}t._update(e,!0)}buildRevisionData({revision:e=null,from:t=null,to:n=null}){t=null!==t?t:e.fromVersion,n=null!==n?n:e.toVersion;const i=this._revisionDataBuilder.getData(t,n),r={diffData:i.diffData,authorsIds:i.authorsIds,fromVersion:t,toVersion:n};if(!e||n!==e.toVersion){const e=n-1,t=this._source.history.getOperation(e);r.createdAt=t&&t.createdAt||new Date}if(this._loadedStateData&&t===this._loadedStateData.fromVersion)for(const e of this._loadedStateData.authors)r.authorsIds.includes(e.id)||r.authorsIds.push(e.id);return r}_loadRevisionData(e){if(!e||e.diffData)return Promise.resolve();{const t=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:t,revisionId:e.id}).then((t=>{e.diffData=t.diffData}))}}_bufferUpdate(e,t,n){if(this._bufferedUpdates.has(e)){const i=this._bufferedUpdates.get(e);t=n?{...i,...t}:{...t,...i}}this._bufferedUpdates.set(e,t)}_getFromVersion(e){const t=this.repository.getRevisions();t.reverse(),t.shift();const n=t.find((t=>t.toVersion<=e)).toVersion;return n<this._startingVersion?this._startingVersion:n}_createInitialRevision(e){const t=this.repository.getRevision(this.repository.length-1);if(t)this._initialRevisionId=t.id;else{const t=!this.editor.model.document.roots.find((e=>this.editor.model.hasContent(e))),n=this.editor.plugins.get("Users").me.id,i=getTranslation$5(this.editor.locale,t?"Empty document":"Initial revision");this._makeRevision({from:e,to:e,id:this._initialRevisionId,name:i,creatorId:n})}}_createCurrentRevision(e){const t=this._source.getCurrentRevisionId();this.currentRevision=this.repository.getRevision(t),this.currentRevision||(this.currentRevision=this._makeRevision({from:e,to:e,id:t,name:"",creatorId:null}))}_makeRevision({name:e,from:t,to:n,creatorId:i,id:r}){const s=this.buildRevisionData({from:t,to:n});s.name=e,s.creatorId=i,s.id=r;const o=this.addRevisionData(s);return this.adapter&&this._bufferUpdate(s.id,s,!0),o}_setConversion(){this.editor.conversion.for("dataDowncast").markerToData({model:"revision"})}_removeRevisionMarkers(e){return(e=e.filter((e=>!e.name||"revision-start"!==e.name&&"revision-end"!==e.name))).forEach((e=>{"string"!=typeof e&&(e.children=this._removeRevisionMarkers(e.children),e.attributes=e.attributes.filter((e=>!e[0].startsWith("data-revision-"))))})),e}}function getViewObj(e,t){const n=t.editing.view.document;if("string"==typeof e)return new ViewText(n,e);{const i=e.children.map((e=>getViewObj(e,t)));return new(charToViewElementClass[e.type]||ViewElement)(n,e.name,e.attributes,i)}}class RevisionDataBuilder{constructor(e){this.editor=e,this._savedMetaData=new Map,this._lastFrom=-1,this._lastTo=-1,this._markers=new Map,this._diffRoots=new Map,this._diffRootsAttributes=new Map,this._baseRoots=new Map,this._baseRootsAttributes=new Map,this._idsRoots=new Map,this._baseIdsRoots=new Map,this._touched=new Map,this._touchedMarkers=new Map,this._touchedRoots=new Map,this._revisionId=1}init(e){this.source=e;const t=new Map,n=new Map,i=this.editor.model.document.roots.map((e=>e.rootName));for(const e of i){const i=this.editor.model.document.getRoot(e),r=_cloneRoot(i);t.set(e,r),n.set(e,Object.fromEntries(i.getAttributes()))}const r=Array.from(this.editor.model.markers).map((e=>[e.name,e.getRange()])),s=this.source.version;this._saveMetaData(s,t,r,n),this._startingRevisionId=this._revisionId;const o=new Map,a=new Map;for(const e of i){const t=_emptyRoot(e);o.set(e,t),a.set(e,{})}this._saveMetaData(Number.NEGATIVE_INFINITY,o,[],a)}getData(e,t){if(this._lastFrom===e&&this._lastTo<=t)this._savedMetaData.size>1&&this._removeMetaData(this._lastTo),this._applyOperations(this._lastTo,t,!0);else{if(!this._savedMetaData.has(e)){const t=this._getPreviousFrom(e);this._calculateMetaData(t,e,!1)}this._calculateMetaData(e,t,!0)}return this._lastFrom=e,this._lastTo=t,this._getState()}loadState(e){this._reset(),this._lastFrom=e.fromVersion,this._lastTo=e.toVersion;for(const t in e.diffData){const n=e.diffData[t].attachChange,i=cloneDeep(e.diffData[t].attributesBefore)||{},r=this._makeModelFromViewString(e.diffData[t].deletions);r.rootName=t,r._isAttached=!n||!n.isAttached,r.isAttached=()=>r._isAttached,this._baseRoots.set(t,r),this._baseRootsAttributes.set(t,i),n&&this._touchedRoots.set(t,n);const s=this._makeIdsRoot(r);this._baseIdsRoots.set(t,s);for(const[e,t]of r.markers){if(!e.startsWith("revision:"))continue;const n=e.split(":")[2];for(const e of t.getWalker({singleCharacters:!0})){const t=this._getVidAttributeName(e),i="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path,r=s.getNodeByPath(i).getAttribute(t);this._touched.set(r,{userId:n})}}}this._startingRevisionId=this._revisionId;const t=[...Array(this._revisionId).keys()].slice(1).filter((e=>!this._touched.has(e)));let n=0;const i=new Map;for(const r in e.diffData){const s=e.diffData[r].attachChange,o=cloneDeep(e.diffData[r].attributesAfter)||{},a=this._makeModelFromViewString(e.diffData[r].insertions);a.rootName=r,a._isAttached=!s||s.isAttached,a.isAttached=()=>a._isAttached,this._diffRoots.set(r,a),this._diffRootsAttributes.set(r,o);const l=this._makeIdsRoot(a,Number.NEGATIVE_INFINITY);this._idsRoots.set(r,l),i.set(r,a.isAttached()?o:{});for(const[e,t]of a.markers){if(!e.startsWith("revision:"))continue;const n=e.split(":")[2];for(const e of t.getWalker({singleCharacters:!0})){const t=this._getVidAttributeName(e),i=this._revisionId++,r="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path;l.getNodeByPath(r)._setAttribute(t,i),this._touched.set(i,{userId:n})}}for(const e of this.editor.model.createRangeIn(a).getWalker({singleCharacters:!0})){const i=this._getVidAttributeName(e),r="elementEnd"==e.type?e.previousPosition.path.slice(0,-1):e.previousPosition.path,s=l.getNodeByPath(r);s.getAttribute(i)>0||s._setAttribute(i,t[n++])}for(const[e,t]of a.markers)e.startsWith("revision:")||this._markers.set(e,t)}const r=_emptyRoot("$graveyard");this._baseRoots.set("$graveyard",r),this._baseIdsRoots.set("$graveyard",this._makeIdsRoot(r,1));const s=_emptyRoot("$graveyard");this._diffRoots.set("$graveyard",s),this._idsRoots.set("$graveyard",this._makeIdsRoot(s,1));const o=Array.from(this._diffRoots).map((([e,t])=>[e,_cloneRoot(t)]));this._saveMetaData(this._lastTo,o,this._markers,i)}_makeModelFromViewString(e){const t=JSON.parse(e),n=this.editor.editing.view.document,i=new ViewDocumentFragment(n,t.map((e=>getViewObj(e,this.editor))));return this.editor.data.toModel(i)}_saveMetaData(e,t,n,i){const r=new Map(t),s=new Map(cloneDeep(i)),o=new Map;for(const[e,t]of n)o.set(e,{start:t.start.clone(),end:t.end.clone(),rootName:t.root.rootName});this._savedMetaData.set(e,{roots:r,markers:o,rootsAttributes:s})}_removeMetaData(e){this._savedMetaData.delete(e)}reInit(){this._reset(),this._lastFrom=-1,this._lastTo=-1,this._savedMetaData.clear(),this.init(this.source)}_reset(){this._touched.clear(),this._touchedMarkers.clear(),this._touchedRoots.clear(),this._diffRoots.clear(),this._diffRootsAttributes.clear(),this._baseRoots.clear(),this._baseRootsAttributes.clear(),this._idsRoots.clear(),this._baseIdsRoots.clear(),this._markers.clear(),this._revisionId=1,this._startingRevisionId=this._revisionId}_makeIdsRoot(e,t=null){let n=null;e.is("documentFragment")||(n=new Element$3(e.name,{vid_start:null===t?this._revisionId++:t++}));const i=[];for(const n of e.getChildren())if(n.is("element")){i.push(this._makeIdsRoot(n,t));const e=i[i.length-1];null!==t&&(t=e.is("element","$text")?e.getAttribute("vid")+1:e.getAttribute("vid_end")+1)}else for(let e=0;e<n.offsetSize;e++)i.push(new Element$3("$text",{vid:null===t?this._revisionId++:t++}));if(e.is("documentFragment")){const t=_emptyRoot(e.rootName);return t._insertChild(0,i),t}return n._setAttribute("vid_end",null===t?this._revisionId++:t++),n._insertChild(0,i),n}_calculateMetaData(e,t,n){this._reset();const{roots:i,markers:r,rootsAttributes:s}=this._savedMetaData.get(e);this._baseRoots=new Map(i),this._baseRootsAttributes=new Map(cloneDeep(s));for(const[e,t]of this._baseRoots)if("$graveyard"!==e&&(this._diffRoots.set(e,_cloneRoot(t)),this._diffRootsAttributes=new Map(cloneDeep(s)),n)){const n=this._revisionId;this._idsRoots.set(e,this._makeIdsRoot(t)),this._baseIdsRoots.set(e,this._makeIdsRoot(t,n))}this._startingRevisionId=this._revisionId,this._diffRoots.set("$graveyard",_cloneRoot(this._baseRoots.get("$graveyard"))),n&&this._idsRoots.set("$graveyard",this._makeIdsRoot(this._baseRoots.get("$graveyard")));for(const[e,t]of r){const n=this._baseRoots.get(t.rootName),i=this._diffRoots.get(t.rootName),r=new _0x571283(this._fixPosition(t.start,n),this._fixPosition(t.end,n)),s=this._fixRange(r,i);n.markers.set(e,r),this._markers.set(e,s)}this._applyOperations(e,t,n)}_applyOperations(e,t,n){for(const i of this.source.getOperations(e,t))this._handleOperation(i,n);for(const e of this._diffRoots.values())e.markers.clear();for(const[e,t]of this._markers)this._diffRoots.get(t.root.rootName).markers.set(e,t.clone());const i=new Map,r=new Map;for(const[e,t]of this._diffRoots)i.set(e,_cloneRoot(t)),r.set(e,this._diffRootsAttributes.get(e));this._saveMetaData(t,i,this._markers,r)}_getPreviousFrom(e){const t=Array.from(this._savedMetaData.keys());t.sort(((e,t)=>e-t)),t.reverse();for(const n of t)if(n<e)return n;return Number.NEGATIVE_INFINITY}_copyMarkers(e,t){const n=Array.from(t.markers).map((([t,n])=>[t,this._fixRange(n,e)]));e.markers=new Map(n)}_transformMarkers(e){for(const t of this._markers.values()){const n=t.getTransformedByOperation(e),i=_0x571283._createFromRanges(n);t.start=i.start,t.end=i.end}}_handleOperation(e,t){if("addRoot"!=e.type&&"detachRoot"!=e.type){if("insert"==e.type){const n=e.position.root.rootName;this._diffRoots.has(n)||(this._diffRoots.set(n,_emptyRoot(n,!0)),this._diffRootsAttributes.set(n,{}),t&&this._idsRoots.set(n,_emptyRoot(n,!0)))}else{if("addRootAttribute"==e.type||"removeRootAttribute"==e.type||"changeRootAttribute"==e.type)return void this._handleRootAttributeOperation(e);"marker"==e.type&&this._handleMarkerOperation(e)}if("marker"!==e.type){const t=this._cloneOperation(e,this._diffRoots);t._execute(),this._transformMarkers(t)}if(t)switch(e.type){case"insert":this._handleInsertOperation(e);break;case"move":case"remove":case"reinsert":this._handleMoveOperation(e);break;case"merge":this._handleMergeOperation(e);break;case"split":this._handleSplitOperation(e)}}else this._handleRootOperation(e,t)}_cloneOperation(e,t){const n=e.clone();return n._authorId=e._authorId,this._fixOperation(n,t),n}_getBaseVids(e){return e.map((e=>{const t=this._getVidAttributeName(e);return Number(e.item.getAttribute(t))}))}_generateTape(e,t){if(e.is("element","$text"))t.push({item:e,type:"text"});else{e.is("element")&&t.push({item:e,type:"elementStart"});for(const n of e.getChildren())this._generateTape(n,t);e.is("element")&&t.push({item:e,type:"elementEnd"})}return t}_getState(){const e=new Map(this._touched),t=new Map(e),n=new Map,i={insertions:{},deletions:{}},r={insertions:{},deletions:{}},s=new Map,o=new Set([...this._baseRoots.keys(),...this._diffRoots.keys()]);o.delete("$graveyard");for(const e of o){const t=this._diffRoots.get(e)||_emptyRoot(e,!1),n=this._baseRoots.get(e)||_emptyRoot(e,!1);t.isAttached()||n.isAttached()?(i.insertions[e]=_cloneRoot(t),i.deletions[e]=_cloneRoot(n),this._copyMarkers(i.deletions[e],n),this._copyMarkers(i.insertions[e],t),r.insertions[e]=this._generateTape(this._idsRoots.get(e),[]),r.deletions[e]=this._generateTape(this._baseIdsRoots.get(e)||_emptyRoot(e,!1),[])):o.delete(e)}for(const i of o){const s=r.insertions[i];for(const i of s){const r=this._getVidAttributeName(i),s=i.item.getAttribute(r);t.delete(s),s>=this._startingRevisionId&&n.set(s,e.get(s))}}for(const i of o){const o=r.insertions[i],a=this._getBaseVids(r.deletions[i]);let l=0;for(const i of o){const r=this._getVidAttributeName(i),o=i.item.getAttribute(r);if(!n.has(o)&&!s.has(o))if(t.has(o))l++;else{if(o!=a[l]){const n=e.get(o)||e.get(a[l]);for(;o!=a[l];)t.has(a[l])||(s.set(a[l],n),e.set(a[l],n)),l++}l++}}}for(const e of o){const i=r.insertions[e];for(const e of i){const i=this._getVidAttributeName(e),r=e.item.getAttribute(i);if(s.has(r)){const e=s.get(r);t.has(r)||t.set(r,{...e}),n.set(r,{...e})}}}for(const e of t.keys())e>=this._startingRevisionId&&t.delete(e);const a=new Map;for(const e of o){let i=r.insertions[e];for(const e of i)if(e.item.is("element","tableCell")){const t=this._getVidAttributeName(e),i=e.item.getAttribute(t);if(n.has(i)){const t=e.item.parent.parent.getAttribute("vid_start"),r=a.get(t)||new Set;r.add(n.get(i).userId),a.set(t,r)}}i=r.deletions[e];for(const e of i)if(e.item.is("element","tableCell")){const n=this._getVidAttributeName(e),i=e.item.getAttribute(n);if(t.has(i)){const n=e.item.parent.parent.getAttribute("vid_start"),r=a.get(n)||new Set;r.add(t.get(i).userId),a.set(n,r)}}for(const e of a.keys())(n.has(e)||t.has(e))&&a.delete(e)}for(const e of o){const i=r.insertions[e];let s=null,o=null;for(const e of i){const i=this._getVidAttributeName(e),r=e.item.getAttribute(i),l=a.get(r);l&&"elementStart"==e.type&&(s=Array.from(l)[0],o=e.item.getAttribute("vid_end")),s&&(t.set(r,{userId:s}),n.set(r,{userId:s})),r==o&&(s=null,o=null)}}const l={},c=new Set;for(const e of o){const s=i.deletions[e],o=i.insertions[e];for(const{userId:e}of this._touchedMarkers.values())null!==e&&c.add(e);for(const{userId:e}of this._touchedRoots.values())null!==e&&c.add(e);this._markChanges(o,r.insertions[e],n,"insertion",c),this._markChanges(s,r.deletions[e],t,"deletion",c),l[e]={insertions:this._prepareViewToSave(o),deletions:this._prepareViewToSave(s),attachChange:this._touchedRoots.get(e)||null,attributesBefore:cloneDeep(this._baseRootsAttributes.get(e))||{},attributesAfter:cloneDeep(this._diffRootsAttributes.get(e))}}return{diffData:l,authorsIds:Array.from(c)}}_processRootBeforeSave(e){for(const[,t]of e.markers){const e=t.start.getAncestors().filter((e=>"tableCell"==e.name));for(const t of e)1==t.childCount&&t.getChild(0).is("element","paragraph")&&t.getChild(0)._setAttribute("keepParagraph",!0)}}_prepareViewToSave(e){this._processRootBeforeSave(e);const t=this.editor.data.toView(e,{}),n=Array.from(t.getChildren()).map((e=>this._getViewJson(e)));return JSON.stringify(n)}_getViewJson(e){if(e.is("$text"))return e.data;{const t=e;return{type:Object.keys(charToViewElementClass).find((t=>e instanceof charToViewElementClass[t])),name:t.name,attributes:Array.from(t.getAttributes()),children:Array.from(t.getChildren()).map((e=>this._getViewJson(e)))}}}_markChanges(e,t,n,i,r){let s=null,o=null,a=0;const l=this.editor.model;for(let i=0;i<t.length;i++){const r=this._getVidAttributeName(t[i]),a=t[i].item.getAttribute(r),d=n.get(a),u=i==t.length-1;!s&&d&&(s=d,o=t[i]),s&&(!d||d.userId!=s.userId)&&(c(d,_getPosBefore(o,e,l),_getPosBefore(t[i],e,l)),s=d||null,o=d?t[i]:null),s&&u&&c(d,_getPosBefore(o,e,l),_getPosAfter(t[i],e,l))}function c(t,n,o){const c=s.userId,d="revision:"+i+":"+c+":"+a++,u=l.createRange(n,o);e.markers.set(d,u),null!==c&&r.add(c)}}_getVidAttributeName(e){switch(e.type){case"elementStart":return"vid_start";case"elementEnd":return"vid_end";default:return"vid"}}_fixOperation(e,t){e.baseVersion=null;for(const n in e){const i=e[n];if(i instanceof Position){const r=t.get(i.root.rootName);e[n]=this._fixPosition(i,r)}if(i instanceof _0x571283){const r=t.get(i.root.rootName);e[n]=this._fixRange(i,r)}"root"===n&&(e.root=t.get(e.root.rootName))}}_fixRange(e,t){return this.editor.model.createRange(this._fixPosition(e.start,t),this._fixPosition(e.end,t))}_fixPosition(e,t){return this.editor.model.createPositionFromPath(t,e.path,e.stickiness)}_handleInsertOperation(e){const t=this._idsRoots.get(e.position.root.rootName),n=this._fixPosition(e.position,t),i=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,r=n.parent,s=this._revisionId,o=[];for(const t of e.nodes)if(t.is("element"))o.push(this._makeIdsRoot(t));else for(let e=0;e<t.offsetSize;e++)o.push(new Element$3("$text",{vid:this._revisionId++}));const a=this._revisionId;for(let e=s;e<a;e++)this._touched.set(e,{userId:i});r._insertChild(n.offset,o)}_handleMoveOperation(e){(e=this._cloneOperation(e,this._idsRoots))._execute();const t=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.getMovedRangeStart(),i=n.parent,r=n.offset;!function e(n,i,r,s){for(let o=r;o<s;o++){const r=i.getChild(o);r.is("element","$text")?n.set(r.getAttribute("vid"),{userId:t}):(n.set(r.getAttribute("vid_start"),{userId:t}),e(n,r,0,r.childCount),n.set(r.getAttribute("vid_end"),{userId:t}))}}(this._touched,i,r,r+e.howMany)}_handleMergeOperation(e){const t=null===(e=this._cloneOperation(e,this._idsRoots))._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.targetPosition.parent,i=e.sourcePosition.parent,r=n.getAttribute("vid_end"),s=i.getAttribute("vid_start");n._setAttribute("vid_end",i.getAttribute("vid_end")),i._setAttribute("vid_end",r),this._touched.set(s,{userId:t}),this._touched.set(r,{userId:t}),e._execute()}_handleSplitOperation(e){const t=null===(e=this._cloneOperation(e,this._idsRoots))._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,n=e.graveyardPosition,i=e.splitPosition.parent;e._execute();const r=i.getAttribute("vid_end"),s=e.insertionPosition.nodeAfter;if(n){const e=s.getAttribute("vid_end"),n=i.getAttribute("vid_end");i._setAttribute("vid_end",e),s._setAttribute("vid_end",n),this._touched.set(i.getAttribute("vid_end"),{userId:t}),this._touched.set(s.getAttribute("vid_start"),{userId:t})}else{const e=this._revisionId++,n=this._revisionId++;i._setAttribute("vid_end",e),s._setAttribute("vid_start",n),s._setAttribute("vid_end",r),this._touched.set(e,{userId:t}),this._touched.set(n,{userId:t})}}_handleMarkerOperation(e){if(!e.affectsData)return;const t=(e=this._cloneOperation(e,this._diffRoots)).oldRange?e.oldRange.root:null,n=e.newRange?e.newRange.root:null;t&&this._markers.delete(e.name),n&&this._markers.set(e.name,e.newRange.clone());const i=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,r=e.name;if(!this._touchedMarkers.has(r))return void this._touchedMarkers.set(r,{range:e.oldRange,userId:i});const s=this._touchedMarkers.get(r),o=s.range,a=e.newRange;null==o&&null==a||o&&a&&o.isEqual(a)?this._touchedMarkers.delete(e.name):s.userId=i}_handleRootOperation(e,t){this._diffRoots.has(e.rootName)?this._diffRoots.get(e.rootName)._isAttached=e.isAdd:(this._diffRoots.set(e.rootName,_emptyRoot(e.rootName,!0)),this._diffRootsAttributes.set(e.rootName,{}),t&&this._idsRoots.set(e.rootName,_emptyRoot(e.rootName,!0)));const n=null===e._authorId?null:e._authorId||this.editor.plugins.get("Users").me.id,i=this._touchedRoots.get(e.rootName);i&&i.userId===n?this._touchedRoots.delete(e.rootName):this._touchedRoots.set(e.rootName,{userId:n,isAttached:e.isAdd})}_handleRootAttributeOperation(e){const t=this._diffRootsAttributes.get(e.root.rootName);null===e.newValue?delete t[e.key]:t[e.key]=e.newValue}}function _cloneRoot(e){const t=_emptyRoot(e.rootName,e.isAttached());for(const n of e.getChildren()){const e=n._clone(!0);t._appendChild(e)}return t}function _emptyRoot(e,t=!0){const n=new DocumentFragment$1;return n.rootName=e,n._isAttached=t,n.isAttached=()=>n._isAttached,n}function _getPosBefore(e,t,n){const i="elementEnd"==e.type?n.createPositionAt(e.item,"end"):n.createPositionBefore(e.item);return n.createPositionFromPath(t,i.path,i.stickiness)}function _getPosAfter(e,t,n){const i="elementStart"==e.type?n.createPositionAt(e.item,0):n.createPositionAfter(e.item);return n.createPositionFromPath(t,i.path,i.stickiness)}class RevisionHistorySaveRevisionFormView extends View{constructor(e,t){super(e),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.set("revisionNameInputValue",""),this.revisionNameInputView=this._createRevisionNameInput(t),this.setTemplate({tag:"form",attributes:{class:["ck","ck-revision-history-save-revision-form","ck-responsive-form"],tabindex:"-1"},children:[this.revisionNameInputView]}),injectCssTransitionDisabler(this)}render(){super.render(),submitHandler({view:this}),this.focusTracker.add(this.revisionNameInputView.element),this.keystrokes.listenTo(this.element);const e=e=>e.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}focus(){this.revisionNameInputView.focus()}get revisionName(){return this.revisionNameInputView.fieldView.element.value.trim()}set revisionName(e){this.revisionNameInputView.fieldView.element.value=e.trim()}reset(){this.revisionNameInputView.fieldView.element.value="",this.revisionNameInputView.errorText=null}_createRevisionNameInput(e){const t=new LabeledFieldView(this.locale,createLabeledInputText),n=t.fieldView;n.extendTemplate({attributes:{maxlength:"220"}});let i=getTranslation$5(this.locale,"Name of the revision");return!e&&(i+=" ("+getTranslation$5(this.locale,"optional")+")"),t.label=i,n.on("input",(()=>{this.revisionNameInputValue=n.element.value.trim()})),t}}class RevisionHistoryUI extends Plugin{static get pluginName(){return"RevisionHistoryUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionTracker]}init(){const e=this.editor,t=e.plugins.get("RevisionTracker");e.ui.componentFactory.add("revisionHistory",(n=>{const i=createDropdown(n),r=i.panelView.children,s=new ListView(n),o=new ListItemView(n),a=new ButtonView(n),l=new ListItemView(n),c=new ButtonView(n);return i.bind("isEnabled").to(t,"isReady",t,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n)),i.buttonView.set({icon:_0x42409c.history,label:getTranslation$5(n,"Revision history"),tooltip:!0}),a.set({label:getTranslation$5(n,"Save current revision"),withText:!0,role:"menuitem"}),a.bind("isEnabled").to(t,"isReady",t,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n)),a.on("execute",(()=>this._showDialog())),c.set({label:getTranslation$5(n,"Open revision history"),withText:!0,role:"menuitem"}),c.bind("isEnabled").to(t,"isReady",e,"isReadOnly",((e,t)=>e&&!t)),c.on("execute",(()=>{e.config.get("revisionHistory").showRevisionViewerCallback(),i.isOpen=!1,e.editing.view.focus()})),o.children.add(a),l.children.add(c),s.role="menu",s.items.addMany([o,l]),r.add(s),i})),e.ui.componentFactory.add("menuBar:revisionHistory",(()=>this._registerMenuComponent()))}_registerMenuComponent(){const e=this.editor,t=e.locale,n=new MenuBarMenuView(t),i=new MenuBarMenuListView(t);n.buttonView.set({icon:_0x42409c.history,label:getTranslation$5(t,"Revision history")});const r=new MenuBarMenuListItemView(t,n),s=new MenuBarMenuListItemButtonView(t);s.set({label:getTranslation$5(t,"Save current revision")}),s.delegate("execute").to(n),s.on("execute",(()=>{this._showDialog()})),r.children.add(s),i.items.add(r);const o=new MenuBarMenuListItemView(t,n),a=new MenuBarMenuListItemButtonView(t);return a.set({label:getTranslation$5(t,"Open revision history")}),a.delegate("execute").to(n),a.on("execute",(()=>{e.config.get("revisionHistory").showRevisionViewerCallback()})),o.children.add(a),i.items.add(o),n.panelView.children.add(i),n}_showDialog(){const e=this.editor,t=e.locale,n=e.plugins.get("Dialog"),i=e.plugins.get("RevisionTracker");function r(i){e.config.get("revisionHistory.requireRevisionName")&&""===i.revisionName?i.revisionNameInputView.errorText=getTranslation$5(t,"The revision name cannot be empty."):(e.plugins.get(RevisionTracker).saveRevision({name:i.revisionName}),n.hide())}this._saveRevisionFormView||(this._createSaveRevisionFormView(),this._saveRevisionFormView.on("submit",(()=>r(this._saveRevisionFormView)))),this._saveRevisionFormView.reset(),n.show({id:"revisionSave",title:getTranslation$5(t,"Save current revision"),isModal:!0,content:this._saveRevisionFormView,actionButtons:[{label:getTranslation$5(e.locale,"Cancel"),withText:!0,onExecute:()=>n.hide()},{label:getTranslation$5(e.locale,"Accept"),class:"ck-button-action",withText:!0,onCreate(t){t.bind("isEnabled").to(i,"isReady",i,"isEnabled",e,"isReadOnly",((e,t,n)=>e&&t&&!n))},onExecute:()=>r(this._saveRevisionFormView)}]})}_createSaveRevisionFormView(){const e=this.editor,t=e.locale;this._saveRevisionFormView=new RevisionHistorySaveRevisionFormView(t,e.config.get("revisionHistory.requireRevisionName")),this._saveRevisionFormView.render()}}class ChangeDetailsView extends View{constructor(e,t){super(e),this._model=t,this.changeId=t.id;const n=this.bindTemplate,i=getTranslation$5(e,t.data.isSuggestion?"Suggested by":"add"==t.type?"Added by":"Removed by");this.set("type",t.type),this.setTemplate({tag:"div",attributes:{class:["ck-annotation","ck-revision-change",n.to("type",(e=>"ck-revision-change__"+e))],tabindex:-1},children:[{tag:"span",children:[{tag:"span",attributes:{class:["ck-revision-change__label"]},children:[{text:i}]},{text:" "+t.author.name}]}]})}focus(){this.element.focus()}}class ChangeItem extends(/*   -- @preserve */
ObservableMixin()){constructor(e){super(),this.id=e.id||uid(),this.author=e.author,this.type=e.type,this.data=e.data||{},this.rootName=e.rootName,this.set("createdAt",e.createdAt)}toJSON(){return{id:this.id,authorId:this.author.id,type:this.type,data:this.data,createdAt:this.createdAt}}}class RevisionDiff{constructor(e,t){this.newRevisionId=e,this.oldRevisionId=t,this.changes=new Collection}_setChanges(e){for(const t of e)this.changes.add(t)}}const typeToClass={c:ViewContainerElement,a:ViewAttributeElement,e:ViewEmptyElement,r:ViewRawElement,u:ViewUIElement};class RevisionViewer extends Plugin{static get pluginName(){return"RevisionViewer"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[Users,ContextualBalloon,RevisionsRepository]}constructor(e){super(e),this.repository=this.editor.plugins.get("RevisionsRepository"),this.set("activeChange",null),this.set("activeView",null),this._activeViewTarget=null,this.set("diff",null),this.set("isReady",!1),this.set("isEnabled",!0),this.on("change:isEnabled",((e,t,n)=>{this.activeChange=null,this.activeView=null,this.editor.editing.view.change((e=>{for(const t of this.editor.editing.view.document.roots)n?e.removeClass("ck-editor__editable__overlay",t):e.addClass("ck-editor__editable__overlay",t)}))})),this.bind("isNavigationMode").to(this,"activeChange",(e=>null!==e)),this.bind("currentChangeNumber").to(this,"isReady",this,"diff",this,"activeChange",((e,t,n)=>e&&n?t.changes.getIndex(n):0)),this.bind("numberOfChanges").to(this,"isReady",this,"diff",((e,t)=>e?t.changes.length:0)),this._changeView=null,this._changeIdToChange=new Map,this.adapter=null,this._balloon=this.editor.plugins.get(ContextualBalloon)}init(){const e=this.editor,t=new ShowChangeCommand(e,{direction:"backward"}),n=new ShowChangeCommand(e,{direction:"forward"});e.commands.add("showPreviousChange",t),e.commands.add("showNextChange",n),e.commands.add("restoreRevision",new RestoreRevisionCommand(e)),this.on("change:numberOfChanges",(()=>{t.refresh(),n.refresh()})),this._setConversion(),this._initInteractions(),e.enableReadOnlyMode("revision-viewer"),e.plugins.has("WidgetToolbarRepository")&&e.plugins.get("WidgetToolbarRepository").forceDisabled("revision-viewer")}async getRevisionData(e){await this.loadRevisionData(e);const t={};for(const n in e.diffData){if(e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached)continue;const i=this._removeRevisionMarkers(JSON.parse(e.diffData[n].insertions)),r=this.editor.editing.view.document,s=new ViewDocumentFragment(r,i.map((e=>this._getViewObj(e))));this.editor.data.processor.useFillerType("marked"),t[n]=this.editor.data.processor.toData(s),this.editor.data.processor.useFillerType("default")}return t}async getRevisionRootsAttributes(e){await this.loadRevisionData(e);const t={};for(const n in e.diffData)e.diffData[n].attachChange&&!e.diffData[n].attachChange.isAttached||(t[n]=e.diffData[n].attributesAfter||{});return t}_removeRevisionMarkers(e){return(e=e.filter((e=>!e.name||"revision-start"!==e.name&&"revision-end"!==e.name))).forEach((e=>{"string"!=typeof e&&(e.children=this._removeRevisionMarkers(e.children),e.attributes=e.attributes.filter((e=>!e[0].startsWith("data-revision-"))))})),e}async compare(e,t,n=!1){if(!this.isEnabled)return;const i=this.diff,r=this.repository,s="string"==typeof e?r.getRevision(e):e,o="string"==typeof t?r.getRevision(t):t,a=s.id,l=o?o.id:null;if(!n&&this.diff&&this.diff.newRevisionId===a&&this.diff.oldRevisionId===l)return Promise.resolve();this.isReady=!1,this.activeView=null,this.activeChange=null,this.diff=new RevisionDiff(a,l);const c=this._getRevisionsRange(s,o,!0).map((e=>this.loadRevisionData(e)));return c.push(new Promise((e=>{setTimeout(e,20)}))),Promise.all(c).then((()=>{if(!this.isEnabled)return;this._cleanUp();const e=this._getDiff(a,l);for(const t of e.changes)this._changeIdToChange.set(t.id,t);this.editor.model.enqueueChange({isUndoable:!1},(t=>{for(const e of this.editor.model.document.getRootNames())t.detachRoot(e);for(const n of Object.keys(e.model)){const i=t.addRoot(n);for(const r of Object.keys(e.attributes[n]))t.setAttribute(r,e.attributes[n][r],i);t.insert(e.model[n],i,0)}})),this.diff._setChanges(this._sortAndFilterDiffChanges(e.changes)),this.isReady=!0})).catch((e=>{console.error(e),this._cleanUp(),i&&(this.diff=i),this.isReady=!0}))}addRevisionData(e,t){const n=this.repository.createRevision(e);return n.on("_update",((e,i,r)=>t(i,r,n))),this.repository.addRevision(n),n}loadRevisionData(e){if(!e||e.diffData)return Promise.resolve();{const t=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:t,revisionId:e.id}).then((t=>{e._update({diffData:t.diffData},!0)}))}}_cleanUp(){this.activeChange=null,this._cleanMarkers(),this._changeView&&this._changeView.destroy(),this._changeView=null,this._changeIdToChange.clear(),this.editor.model.enqueueChange({isUndoable:!1},(e=>{for(const t of this.editor.model.document.getRootNames())e.detachRoot(t)}))}_sortAndFilterDiffChanges(e){const t=[],n=new Map;for(const e of this.editor.model.document.getRootNames()){const i=this.editor.editing.view.getDomRoot(e);if(!i)continue;const r=i.getClientRects().item(0);r&&(t.push(e),n.set(e,r))}return t.sort(((e,t)=>{const i=n.get(e),r=n.get(t);return i.y-r.y||i.x-r.x})),(e=e.filter((e=>t.includes(e.rootName)))).sort(((e,n)=>t.indexOf(e.rootName)-t.indexOf(n.rootName))),e}_makeTape(e){const t=Array.from(e.markers).filter((([e,t])=>e.startsWith("revision:")&&!t.isCollapsed)),n=Array.from(this.editor.model.createRangeIn(e).getWalker({singleCharacters:!0}));if(0!=t.length)for(const e of n){const[n,i]=t[0],[,r,s]=n.split(":");if(i.end.isEqual(e.nextPosition)&&t.shift(),(e.previousPosition.isEqual(i.start)||e.previousPosition.isAfter(i.start))&&("insertion"==r?e.isAdded={userId:s}:"deletion"==r&&(e.isRemoved={userId:s})),0==t.length)break}return n}_refreshStartEndIndex(e){const t=new Map;for(let n=0;n<e.length;n++)"text"===e[n].type?(e[n].item.startIndex=n,e[n].item.endIndex=n):("elementStart"===e[n].type?e[n].item.startIndex=n:"elementEnd"===e[n].type&&(e[n].item.endIndex=n),t.set(e[n].id,n));for(const n of t.values())"elementStart"===e[n].type?e[n].item.endIndex=t.get(e[n].pairId):"elementEnd"===e[n].type&&(e[n].item.startIndex=t.get(e[n].pairId))}_processTape(e){for(let t=0;t<e.length;t++){if("elementStart"===e[t].type)e[t].item.startIndex=t;else if("elementEnd"===e[t].type){e[t].item.endIndex=t;const n=e[t].item.startIndex;e[n].pairId=e[t].id,e[t].pairId=e[n].id}else e[t].item.startIndex=t,e[t].item.endIndex=t,e[t].pairId=null;e[t].markersStart||(e[t].markersStart=[],e[t].markersEnd=[])}}_markInsertions(e,t){const n=e.filter((e=>!e.isAdded));for(let e=0;e<t.length;e++)t[e].isAdded&&(n[e].isAdded=t[e].isAdded)}_makeModelFromViewString(e){const t=JSON.parse(e),n=this.editor.editing.view.document,i=new ViewDocumentFragment(n,t.map((e=>this._getViewObj(e))));return this.editor.data.toModel(i)}_getViewObj(e){const t=this.editor.editing.view.document;if("string"==typeof e)return new ViewText(t,e);{const n=e.children.map((e=>this._getViewObj(e)));return new(typeToClass[e.type]||ViewElement)(t,e.name,e.attributes,n)}}_getDiff(e,t=null){const n=this.repository.getRevision(e),i=t?this.repository.getRevision(t):null,r=this._getRevisionsRange(n,i),s=r[r.length-1],o=new Map,a={model:{},attributes:{},changes:[]},l=new Set,c=new Map;for(let e=r.length-1;e>=0;e--){const t=r[e];for(const e of Object.keys(t.diffData))if(t.diffData[e].attachChange){const n=t.diffData[e].attachChange;n.isAttached?(l.add(e),c.has(e)&&c.get(e).userId==n.userId?c.delete(e):c.set(e,n)):c.has(e)?(l.delete(e),c.delete(e)):(l.add(e),c.set(e,n))}else l.add(e)}for(const e of l){const t=c.has(e)&&!c.get(e).isAttached;let n=t?r.length-1:0;const i=t?-1:1;for(;r[n];){const s=r[n];if(s.diffData[e]){const n=t?s.diffData[e].attributesBefore:s.diffData[e].attributesAfter;a.attributes[e]=n?cloneDeep(n):{};break}n+=i}}for(const e of r){e.model={};for(const t of e.authors)o.set(t.id,t);for(const t of l){const n=e.diffData[t]?e.diffData[t].insertions:"[]",i=e.diffData[t]?e.diffData[t].deletions:"[]";e.model[t]={insertions:this._makeModelFromViewString(n),deletions:this._makeModelFromViewString(i)}}}for(const e of l){let t=null,i=0;const l=new Map(Array.from(n.model[e].insertions.markers).filter((([e])=>!e.startsWith("revision:"))));let d=0;for(const s of r){const r=this._makeTape(s.model[e].insertions);s==n?(t=r,i=t.length,t.forEach((e=>{e.id=d++})),this._processTape(t)):this._markInsertions(t,r);const o=t.filter((e=>!e.isAdded)).map((e=>e.id));let a=0;const c=this._makeTape(s.model[e].deletions);c.forEach((e=>{e.isRemoved?e.id=i++:e.id=o[a++]})),this._processTape(c),this._setDistance(t,"isAdded"),this._setDistance(c,"isRemoved"),s==n&&this._markMarkers(t,l),t=this._joinTapes(t,c),this._refreshStartEndIndex(t),this._setDistance(t,"isRemoved")}t=t.filter((e=>!(e.isAdded&&e.isRemoved)));const u=new Map(s.model[e].deletions.markers),h=new Set(l.keys());for(const e of u.keys())h.delete(e);this._markSuggestions(t,h),this._fixObsoleteTags(t),t=this._removeMissingPairs(t),t=this._markMismatchedRemovedTags(t),t=this._removeUnsupportedChanges(t);const{root:m,changes:g}=this._makeModelFromTape(t,o,e);a.model[e]=m;const p=c.get(e);if(p){const t=o.get(p.userId),n=new ChangeItem({author:t,type:p.isAttached?"add":"remove",data:{isOnRoot:!0},createdAt:new Date,rootName:e});g.unshift(n),a.attributes[e].revisionHistoryAttachChange=n.id}a.changes=a.changes.concat(g)}return a}_markMarkers(e,t){for(let n=0;n<e.length;n++)for(const[i,r]of t)r.start.isEqual(e[n].previousPosition)&&e[n].markersStart.push(i),r.end.isEqual(e[n].nextPosition)&&e[n].markersEnd.push(i)}_joinTapes(e,t){let n=[],i=0,r=0;for(;i<e.length||r<t.length;){const s=e[i]||{},o=t[r]||{};if(s.id==o.id)i++,r++,n.push(s);else if(o.isRemoved&&s.isAdded){const{commonTape:s,iEnd:o,jEnd:a}=this._threeWayMerge(e,i,t,r);n=n.concat(s),i=o,r=a}else o.isRemoved?(r++,n.push(o)):(i++,n.push(s))}return n}_markSuggestions(e,t){const n=[];for(let s=0;s<e.length;s++){for(let r=0;r<e[s].markersStart.length;r++){const o=e[s].markersStart[r];if(!t.has(o))continue;const{group:a,type:l,authorId:c}=i(o);"revision-suggestion"!=a||"insertion"!=l&&"deletion"!=l||(n.unshift({type:l,name:o,userId:c}),e[s].markersStart.splice(r,1),r--)}r(e[s]);for(let r=0;r<e[s].markersEnd.length;r++){const o=e[s].markersEnd[r];if(!t.has(o))continue;const{group:a,type:l}=i(o);if("revision-suggestion"!=a||"insertion"!=l&&"deletion"!=l)continue;e[s].markersEnd.splice(r,1),r--;const c=n.findIndex((e=>e.name==o));c>-1&&n.splice(c,1)}}function i(e){const t=e.split(":");return{group:t[0],type:t[1],subType:t.length>=5?t[2]:null,id:t.length<5?t[2]:t[3],authorId:t.length<5?t[3]:t[4],markerCount:6==t.length?t[5]:null}}function r(e){for(let t=0;t<n.length;t++){if(e.isAdded&&"insertion"==n[t].type)return e.isAddSuggestion=n[t],void delete e.isAdded;if(!e.isAdded&&!e.isRemoved&&"deletion"==n[t].type)return void(e.isRemoveSuggestion=n[t])}}}_setDistance(e,t){let n=0,i=!1;const r=new Map;for(const s of e)s[t]?i&&(n++,i=!1):(n++,i=!0),r.set(s.id,n);for(let n=0;n<e.length;n++){if("isRemoved"==t&&e[n].isAdded||"isAdded"==t&&e[n].isRemoved)continue;if("text"==e[n].type){e[n].distance=0;continue}const i=r.get(e[n].pairId),s=r.get(e[n].id);e[n].distance=i-s}}_getRevisionsRange(e,t,n=!1){const i=[];let r=this.repository.getIndex(e),s=this.repository.getIndex(t);for(-1==s&&(s=this.repository._revisions.length,n=!1);r<s;)i.push(this.repository.getRevision(r)),r++;return n&&i.push(this.repository.getRevision(r)),i}_threeWayMerge(e,t,n,i){const r=this.editor.model.schema;let s=t;for(;e[s]&&e[s].isAdded;)s++;let o=i;for(;n[o]&&n[o].isRemoved;)o++;l(e,t,s),l(n,i,o);const a=n.slice(i,o).concat(e.slice(t,s));return a.sort(((e,t)=>e.side!=t.side?e.side-t.side:e.level!=t.level?e.level-t.level:e.distance!=t.distance?t.distance-e.distance:!!e.isAdded!=!!t.isAdded?-1==e.side||0==e.side?e.isAdded?-1:1:e.isAdded?1:-1:e.index-t.index)),{commonTape:a,iEnd:s,jEnd:o};function l(e,t,n){let i=-1,s=Number.POSITIVE_INFINITY,o=!0;for(let a=t;a<n;a++)if(r.isInline(e[a].item)||(o=!1),e[a].item.startIndex<t&&(i=a),e[a].item.endIndex>=n){s=a;break}o&&(i=n-1);for(let r=t;r<n;r++)e[r].side=r<=i?-1:r<s?0:1,e[r].index=r;let a=0;for(let n=t;n<=i;n++)0==e[n].distance?e[n].level=a:(a++,e[n].level=a,a++);for(let i=t;i<n;i++)0==e[i].side&&(e[i].level=a);a=0;for(let t=n-1;t>=s;t--)0==e[t].distance?e[t].level=a:(a--,e[t].level=a,a--)}}_fixObsoleteTags(e){const t=new Map,n=this.editor.model.schema;for(let i=1;i<e.length;i++){let r,s,o;const a=e[i],l=e[i-1];if("text"==a.type)continue;if(a.type!=l.type)continue;if(!n.isBlock(l.item)||n.isLimit(l.item))continue;if(!n.isBlock(a.item)||n.isLimit(a.item))continue;if((e[i].isAdded||e[i].isAddSuggestion)&&e[i-1].isRemoved)r=e[i],s=e[i-1],o=i-1;else{if(!e[i].isRemoved||!e[i-1].isAdded&&!e[i-1].isAddSuggestion)continue;r=e[i-1],s=e[i],o=i}const c=r.level==s.level,d=Math.abs(r.level)<Math.abs(s.level)&&0==s.distance;(c||d)&&(t.set(s.id,r.id),e.splice(o,1),i--,r.isAdded=!1)}for(let n=0;n<e.length;n++)t.has(e[n].pairId)&&(e[n].pairId=t.get(e[n].pairId))}_removeMissingPairs(e){const t=new Set(e.map((e=>e.id)));for(let n=0;n<e.length;n++)t.has(e[n].pairId)||0==e[n].distance||(e[n].isIncorrect=!0);return e.filter((e=>!e.isIncorrect))}_markMismatchedRemovedTags(e){const t=new Set;for(let n=0;n<e.length;n++){if(t.has(e[n].id)&&e[n].isRemoved&&(e[n].isIncorrect=!0),e[n].isIncorrect)continue;if(0==e[n].distance)continue;if("elementStart"!=e[n].type)continue;if(null==e[n].pairId)continue;let i=n+1,r=0;for(;e[i].id!=e[n].pairId;)"elementStart"==e[i].type?r++:"elementEnd"==e[i].type&&r--,i++;if(0!=r)if(e[n].isRemoved)e[n].isIncorrect=!0;else for(;i!=n;)e[i].isRemoved&&0!=e[i].distance&&(e[i].isIncorrect=!0,t.add(e[i].pairId)),i--}return e.filter((e=>!e.isIncorrect))}_removeUnsupportedChanges(e){const t=this.editor.model.schema;for(let n=0;n<e.length;n++){if(!(e[n].isAdded||e[n].isAddSuggestion||e[n].isRemoved||e[n].isRemoveSuggestion))continue;if(0==e[n].distance)continue;const i=e[n].item;t.isBlock(i)||t.isLimit(i)||(e[n].isAdded&&delete e[n].isAdded,e[n].isAddSuggestion&&delete e[n].isAddSuggestion,e[n].isRemoveSuggestion&&delete e[n].isRemoveSuggestion,e[n].isRemoved&&(e[n].isIncorrect=!0))}return e.filter((e=>!e.isIncorrect))}_makeModelFromTape(e,t,n){const i=new DocumentFragment$1,r=[],s=new Map,o=this.editor.model,a=o.schema,l=[i],c={},d={isAdded:[],isRemoved:[],isAddSuggestion:[],isRemoveSuggestion:[]};let u=null;const h=[0];for(let t=0;t<e.length;t++)if("elementStart"===e[t].type){e[t].previousPosition=o.createPositionFromPath(i,h);const n=new Element$3(e[t].item.name,e[t].item.getAttributes());l[0]._appendChild(n),h.push(0),l.unshift(n),e[t].nextPosition=o.createPositionFromPath(i,h)}else"elementEnd"===e[t].type?(l.shift(),e[t].previousPosition=o.createPositionFromPath(i,h),h.pop(),h[h.length-1]++,e[t].nextPosition=o.createPositionFromPath(i,h)):(e[t].previousPosition=o.createPositionFromPath(i,h),u?u._data+=e[t].item.data:u=new Text$1(e[t].item.data,e[t].item.getAttributes()),e[t+1]&&"text"===e[t+1].type&&p(u,e[t+1].item)||(l[0]._appendChild(u),u=null),h[h.length-1]+=e[t].item.offsetSize,e[t].nextPosition=o.createPositionFromPath(i,h));for(let t=0;t<e.length;t++){const n=e[t].previousPosition,i=e[t].nextPosition;for(const i of e[t].markersStart)s.set(i,{start:n,end:null});m("isRemoveSuggestion",t,n,i),m("isAddSuggestion",t,n,i),m("isRemoved",t,n,i),m("isAdded",t,n,i);for(const n of e[t].markersEnd)s.get(n).end=i}for(const[e,t]of s){const n=this.editor.model.createRange(t.start,t.end);i.markers.set(e,n)}return r.sort(((e,t)=>{const n=i.markers.get("revision:"+e.id),r=i.markers.get("revision:"+t.id);return n.start.isBefore(r.start)?-1:n.start.isAfter(r.start)?1:n.end.isBefore(r.end)?-1:n.end.isAfter(r.end)?1:"add"===e.type?-1:1})),{root:i,changes:r};function m(t,n,i,r){const s=!!e[n][t],o=s?e[n][t].userId:null,l=n===e.length-1,u=d[t][0],h=a.isObject(e[n].item);!c[t]&&s?c[t]={start:i,tapeItem:e[n],userId:o,type:t}:c[t]&&!s?(c[t].end=i,g(c[t]),c[t]=null):c[t]&&s&&c[t].userId!==o&&(c[t].end=i,u&&u.userId===c[t].userId||g(c[t]),c[t]={start:i,tapeItem:e[n],userId:o,type:t}),c[t]&&h&&("elementStart"!==e[n].type||u&&u.userId===o||d[t].unshift({userId:o,object:e[n].item,change:c[t]}),"elementEnd"===e[n].type&&u&&u.object===e[n].item&&(d[t].shift(),c[t]=u.change)),c[t]&&l&&(c[t].end=r,g(c[t]),c[t]=null)}function g({start:e,end:s,tapeItem:a,userId:l,type:c}){const d=a.item,u=o.schema.isBlock(d)&&!o.schema.isLimit(d),h=e.nodeAfter==s.parent&&s.isAtStart;if(u&&h)return;const m=o.createRange(e,s),g=t.get(l),p=new ChangeItem({author:g,type:"isAdded"==c||"isAddSuggestion"==c?"add":"remove",data:{isSuggestion:"isAddSuggestion"==c||"isRemoveSuggestion"==c},createdAt:new Date,rootName:n});r.push(p),i.markers.set("revision:"+p.id,m)}function p(e,t){const n=e.getAttributes(),i=t.getAttributes();for(const e of n){if(e[1]!==t.getAttribute(e[0]))return!1;i.next()}return i.next().done}}_setConversion(){this.editor.conversion.for("upcast").dataToMarker({view:"revision"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision",view:e=>{const t=e.markerName.split(":")[1],n=this._getChangeFromId(t);if(!n)return null;const i="add"==n.type?"insertion":"deletion",r=["ck-suggestion-marker","ck-suggestion-marker-"+i];return n.data.isSuggestion&&r.push("ck-suggestion-marker-"+i+"-new"),this.activeChange==n&&r.push("ck-suggestion-marker--active"),{classes:r,attributes:{"data-change-id":t}}}}),this.editor.conversion.for("upcast").add((e=>{e.on("element:pre",((e,t,n)=>{const i=t.viewItem.getChild(0);if(!i||!i.is("element","code"))return;if(!n.consumable.consume(i,{attributes:["vid_start","vid_end"]}))return;const r=t.modelRange.start.nodeAfter;n.writer.setAttribute("vid_start",i.getAttribute("vid_start"),r),n.writer.setAttribute("vid_end",i.getAttribute("vid_end"),r)}),{priority:"low"})})),this.editor.conversion.for("upcast").add((e=>{e.on("element",((e,t,n)=>{if(!n.consumable.consume(t.viewItem,{attributes:["vid_start","vid_end"]}))return;if(t.modelRange.isCollapsed)return;const i=t.modelRange.start.nodeAfter;i.hasAttribute("vid_start")||i.hasAttribute("vid")||(n.writer.setAttribute("vid_start",t.viewItem.getAttribute("vid_start"),i),n.writer.setAttribute("vid_end",t.viewItem.getAttribute("vid_end"),i))}),{priority:"low"})})),this.editor.conversion.for("upcast").elementToAttribute({view:{name:"span",attributes:{vid:!0}},model:{key:"vid",value:e=>e.getAttribute("vid")}}),this.editor.model.schema.on("checkAttribute",((e,[,t])=>{["vid_start","vid_end","vid"].includes(t)&&(e.return=!0,e.stop())}),{priority:"highest"}),this.editor.conversion.for("dataDowncast").add((e=>{e.on("attribute:vid",((e,t,n)=>{if(" "!=t.item.data||t.item.parent.maxOffset>1)return;if(!n.consumable.consume(t.item,e.name))return;const i=n.writer,r=n.mapper.toViewRange(t.range);i.wrap(r,i.createAttributeElement("span"))}))})),this.editor.conversion.for("dataDowncast").markerToData({model:"revision"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",downcastSplitMergeMarker$2(this.editor),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)(e.hasClass("ck-suggestion-marker-split")||e.hasClass("ck-suggestion-marker-merge"))&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",((e,t,n)=>{const i=t.markerName.split(":")[1],r=this._getChangeFromId(i);if(!r)return null;const s="add"==r.type?"split":"merge";if(n.consumable.test(t.markerRange,e.name))for(const e of t.markerRange.getItems()){if(!e.is("element","softBreak"))continue;const i=n.writer.createUIElement("span",{class:"ck-suggestion-marker-"+s}),o=n.mapper.toViewPosition(this.editor.model.createPositionBefore(e));r.data.isSuggestion&&n.writer.addClass("ck-suggestion-marker-"+s+"-new",i),this.activeChange==r&&n.writer.addClass("ck-suggestion-marker--active",i),n.writer.insert(o,i),n.mapper.bindElementToMarker(i,t.markerName)}}),{priority:"high"}),this.editor.model.document.on("change",(()=>{this.editor.editing.view.change((e=>{for(const t of this.editor.model.document.getRootNames()){const n=this.editor.model.document.getRoot(t),i=this.editor.editing.view.document.getRoot(t);if(i){const t=n.getAttribute("revisionHistoryAttachChange");if(e.removeAttribute("data-change-id",i),e.removeClass("ck-revision-history-root-add",i),e.removeClass("ck-revision-history-root-remove",i),e.removeClass("ck-revision-history-root--active",i),t){const n=this._getChangeFromId(t);if(!n)return null;e.setAttribute("data-change-id",t,i),e.addClass("ck-revision-history-root-"+n.type,i),this.activeChange==n&&e.addClass("ck-revision-history-root--active",i)}}}}))})),this.editor.conversion.for("upcast").dataToMarker({view:"comment",model:e=>"revision-comment:"+e,converterPriority:"highest"}),this.editor.conversion.for("upcast").dataToMarker({view:"suggestion",model:e=>"revision-suggestion:"+e,converterPriority:"highest"}),this.editor.conversion.for("dataDowncast").markerToData({model:"revision-suggestion",view:e=>({name:"suggestion:"+e,group:"revision-suggestion"}),converterPriority:"highest"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision-suggestion",view:e=>{const t=e.markerName.split(":")[1];return"insertion"!=t&&"deletion"!=t?null:{classes:["ck-suggestion-preview-marker","ck-suggestion-preview-marker-"+t]}}}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:deletion",downcastSplitMergeMarkerSuggestion(this.editor,"merge"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:insertion",downcastSplitMergeMarkerSuggestion(this.editor,"split"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision-suggestion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.is("uiElement")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"})}_getChangeFromId(e){return this._changeIdToChange.get(e)}_getViewForChange(e){return this._changeView&&this._changeView.destroy(),this._changeView=new ChangeDetailsView(this.editor.locale,e),this._changeView}_initInteractions(){this.editor.model.document.selection.observeMarkers("revision"),this.on("change:activeView",((e,t,n,i)=>{i&&this._balloon.remove(i),n&&(this._balloon.add({view:n,stackId:"revisionHistoryLabel",position:{target:()=>{const e=this.editor.editing,t=this._getChangeFromId(n.changeId);let i;if(t.data.isOnRoot){const n=e.view.getDomRoot(t.rootName);i=Array.from(n.getClientRects())}else{const t=this.editor.model.markers.get("revision:"+n.changeId);i=Array.from(e.mapper.markerNameToElements(t.name)).map((t=>e.view.domConverter.mapViewToDom(t))).map((e=>Array.from(e.getClientRects()))).flat()}return this._activeViewTarget&&i.find((e=>e.top-3<=this._activeViewTarget.y&&e.bottom+3>=this._activeViewTarget.y&&e.left-3<=this._activeViewTarget.x&&e.right+3>=this._activeViewTarget.x))||i[0]}}}),this._balloon.showStack("revisionHistoryLabel"))})),this.on("change:activeChange",((e,t,n,i)=>{this.activeView=n?this._getViewForChange(n):null,this.editor.model.change((()=>{const e=this.editor.editing;i&&(i.data.isOnRoot?e.view.change((t=>{t.removeClass("ck-revision-history-root--active",e.view.document.getRoot(i.rootName))})):e.reconvertMarker("revision:"+i.id)),n&&(n.data.isOnRoot?e.view.change((t=>{t.addClass("ck-revision-history-root--active",e.view.document.getRoot(n.rootName))})):e.reconvertMarker("revision:"+n.id))}))})),this.listenTo(this.editor.editing.view.document,"mouseover",((e,t)=>{if(this.activeChange)return;const n=this._findChangeIdFromDomTarget(t.target),i=this._changeIdToChange.get(n);i?(this._activeViewTarget={x:t.domEvent.x,y:t.domEvent.y},this.activeView=this._getViewForChange(i)):(this._activeViewTarget=null,this.activeView=null)})),this.listenTo(this.editor.editing.view.document,"mousedown",((e,t)=>{const n=this._findChangeIdFromDomTarget(t.target),i=this._changeIdToChange.get(n);i?(this._activeViewTarget={x:t.domEvent.x,y:t.domEvent.y},i===this.activeChange?this._balloon.updatePosition():this.activeChange=i):(this._activeViewTarget=null,this.activeChange=null)}))}_findChangeIdFromDomTarget(e){do{const t=e.getAttribute("data-change-id");if(t)return t;e=e.parent}while(e);return null}_cleanMarkers(){this.editor.model.change((e=>{for(const t of this.editor.model.markers)e.removeMarker(t)}))}}function downcastSplitMergeMarker$2(e){const t=e.plugins.get("RevisionViewer");return(n,i,r)=>{const s=i.markerName.split(":")[1],o=t._getChangeFromId(s);if(!o)return null;const a="add"==o.type?"split":"merge";if(!r.consumable.test(i.markerRange,n.name))return;const l=i.markerRange.getWalker(),c=i.markerRange.start,d=e.model.schema;let u=null,h=null,m=!1,g=!1;for(const e of l){const t=e.item;m=m||d.isContent(t);const n=r.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&d.isBlock(t)&&!d.isLimit(t)&&(t.nextSibling||c.isAtEnd?u&&u.parent==t||(u=t,p(e.previousPosition),g=!0):h=h||e.previousPosition)}function p(e){const n=r.writer.createUIElement("span",{class:"ck-suggestion-marker-"+a}),s=r.mapper.toViewPosition(e);o.data.isSuggestion&&r.writer.addClass("ck-suggestion-marker-"+a+"-new",n),t.activeChange==o&&r.writer.addClass("ck-suggestion-marker--active",n),r.writer.insert(s,n),r.mapper.bindElementToMarker(n,i.markerName)}m||g||!h||p(h)}}function downcastSplitMergeMarkerSuggestion(e,t){return(n,i,r)=>{if(!r.consumable.test(i.markerRange,n.name))return;const s=i.markerRange.getWalker(),o=i.markerRange.start,a=e.model.schema;let l=null,c=null,d=!1,u=!1;for(const e of s){const t=e.item;d=d||a.isContent(t);const n=r.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&a.isBlock(t)&&!a.isLimit(t)&&(t.nextSibling||o.isAtEnd?l&&l.parent==t||(l=t,h(e.previousPosition),u=!0):c=c||e.previousPosition)}function h(e){const n=r.mapper.toViewPosition(e),s=r.writer.createUIElement("span",{class:"ck-suggestion-preview-marker-"+t});r.writer.insert(n,s),r.mapper.bindElementToMarker(s,i.markerName)}d||u||!c||h(c)}}class RestoreRevisionCommand extends _0x338ed0{constructor(e){super(e);const t=e.plugins.get(RevisionViewer);this.affectsData=!1,this.listenTo(t,"change:isReady",(()=>this.refresh())),this.listenTo(t,"change:isEnabled",(()=>this.refresh()))}execute(){const e=this.editor,t=e.plugins.get(RevisionViewer),n=t.isReady?t.diff.newRevisionId:null;e.config.get("revisionHistory").restoreRevisionCallback(n)}refresh(){const{isReady:e,isEnabled:t,repository:n,diff:i}=this.editor.plugins.get(RevisionViewer),r=i&&n.getLaterVisibleRevision(i.newRevisionId);this.isEnabled=e&&t&&Boolean(r)}}class ShowChangeCommand extends _0x338ed0{constructor(e,{direction:t}){super(e);const n=e.plugins.get(RevisionViewer);this.affectsData=!1,this._step="forward"===t?1:-1,this.listenTo(n,"change:isReady",(()=>this.refresh())),this.listenTo(n,"change:isEnabled",(()=>this.refresh())),this.listenTo(n,"change:activeChange",(()=>this.refresh()))}execute(){const e=this.editor,t=e.plugins.get(RevisionViewer),{isNavigationMode:n,currentChangeNumber:i}=t;let r;if(t.activeChange=n?t.diff.changes.get(i+this._step):t.diff.changes.first,t.activeChange.data.isOnRoot)r=e.editing.view.getDomRoot(t.activeChange.rootName);else{const n=e.model.markers.get("revision:"+t.activeChange.id);r=getMarkerDomElement(e.editing,n)}scrollViewportToShowTarget({target:r,viewportOffset:40})}refresh(){const{isNavigationMode:e,currentChangeNumber:t,numberOfChanges:n,isReady:i,isEnabled:r}=this.editor.plugins.get(RevisionViewer);this.isEnabled=!!(r&&i&&n)&&(!e||(1===this._step?t<n-1:t>0))}}var arrowUpIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 14.494a.75.75 0 0 0 1.197-.899l-.067-.089-6.992-8a.75.75 0 0 0-1.05-.078l-.079.078-7.008 8a.75.75 0 0 0 1.049 1.066l.08-.078 6.442-7.354 6.428 7.354z"/></svg>\n',arrowDownIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 5.506a.75.75 0 0 1 1.197.899l-.067.089-6.992 8a.75.75 0 0 1-1.05.078l-.079-.078-7.008-8a.75.75 0 0 1 1.049-1.066l.08.078 6.442 7.354 6.428-7.354z"/></svg>\n';class ChangesNavigationView extends View{constructor(e){super(e);const t=this.bindTemplate,n=new ButtonView(e),i=new ButtonView(e);this.set("isNavigationMode",!1),this.set("isReady",!1),this.set("currentChangeNumber",0),this.set("numberOfChanges",0),this.set("isForwardNavigationEnabled",!1),this.set("isBackwardNavigationEnabled",!1),this.bind("_isStatusLabelVisible").to(this,"isReady",this,"numberOfChanges",((e,t)=>e&&t>0)),this.bind("_statusText").to(this,"isReady",this,"currentChangeNumber",this,"numberOfChanges",this,"isNavigationMode",((t,n,i,r)=>{if(!t)return getTranslation$5(e,"Loading...");if(!i)return getTranslation$5(e,"No changes");const s=getTranslation$5(e,"NUMBER_OF_CHANGES",i);return r?getTranslation$5(e,"X_OF_Y_CHANGES",[n+1,i]):s})),n.set({label:getTranslation$5(e,"Show previous change"),tooltip:!0,icon:arrowUpIcon}),i.set({label:getTranslation$5(e,"Show next change"),tooltip:!0,icon:arrowDownIcon}),n.bind("isEnabled").to(this,"isBackwardNavigationEnabled"),i.bind("isEnabled").to(this,"isForwardNavigationEnabled"),n.on("execute",(()=>this.fire("execute","backward"))),i.on("execute",(()=>this.fire("execute","forward"))),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-ui","ck-revision-history-ui__changes-navigation"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__wrapper"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__label",t.if("_isStatusLabelVisible","ck-hidden",(e=>!e))]},children:[{text:t.to("isNavigationMode",(t=>t?getTranslation$5(e,"EDIT_X_OF_Y_REVISIONS")+": ":getTranslation$5(e,"Total")+": "))}]},{text:t.to("_statusText")}]},new ToolbarSeparatorView,{tag:"div",attributes:{class:["ck-revision-history-ui__changes-navigation__navigation"]},children:[n,i]}]})}}const OVERLAY_CSS_CLASS="ck-editor__editable__loading-overlay";class RevisionViewerLoadingOverlay extends Plugin{static get pluginName(){return"RevisionViewerLoadingOverlay"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}show(){const e=this.editor.editing.view;e.change((t=>{for(const n of e.document.roots)t.addClass(OVERLAY_CSS_CLASS,n)}))}hide(){const e=this.editor.editing.view;e.change((t=>{for(const n of e.document.roots)t.removeClass(OVERLAY_CSS_CLASS,n)}))}}class RevisionViewerUI extends Plugin{static get pluginName(){return"RevisionViewerUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionViewer,RevisionViewerLoadingOverlay]}init(){const e=this.editor,t=e.plugins.get(RevisionViewer),n=e.plugins.get(RevisionViewerLoadingOverlay);e.ui.componentFactory.add("exitToEditing",(t=>{const n=new ButtonView(t);return n.set({label:getTranslation$5(t,"Back to editing"),icon:_0x42409c.undo,withText:!0,tooltip:!0,class:"ck-revision-history-ui__back-to-editing"}),this.listenTo(n,"execute",(()=>{e.config.get("revisionHistory").closeRevisionViewerCallback()})),n})),e.ui.componentFactory.add("restoreRevision",(t=>{const n=new ButtonView(t);return n.set({label:getTranslation$5(t,"Restore this revision"),withText:!0,tooltip:!0}),n.bind("isEnabled").to(e.commands.get("restoreRevision")),this.listenTo(n,"execute",(()=>e.execute("restoreRevision"))),n})),e.ui.componentFactory.add("changesNavigation",(n=>{const i=new ChangesNavigationView(n),r=e.commands.get("showPreviousChange"),s=e.commands.get("showNextChange");return i.bind("isBackwardNavigationEnabled").to(r,"isEnabled"),i.bind("isForwardNavigationEnabled").to(s,"isEnabled"),i.bind("isReady","currentChangeNumber","numberOfChanges","isNavigationMode").to(t),this.listenTo(i,"execute",((t,n)=>{e.execute("forward"===n?"showNextChange":"showPreviousChange")})),i})),n.show(),t.on("change:isReady",((e,t,i)=>{i?n.hide():n.show()}))}}class RevisionNameView extends LabeledFieldView{constructor(e,t){super(e,t),this._resizeObserver=null;const n=this.bindTemplate;this.set({label:getTranslation$5(e,"Revision name"),_tooltipString:""}),this.fieldView.placeholder=getTranslation$5(e,"Enter the revision name"),this.extendTemplate({tag:"span",attributes:{class:["ck-revision-history-sidebar__revision-name"],"data-cke-tooltip-text":n.to("_tooltipString"),"data-cke-tooltip-position":"s","data-cke-tooltip-class":"ck-tooltip_multi-line"}})}render(){super.render(),this._resizeObserver=new _0x3f4b48(this.fieldView.element,(()=>this._updateTooltipText())),this.listenTo(this.fieldView,"input",(()=>this._updateTooltipText()))}destroy(){super.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_updateTooltipText(){const e=this.fieldView.element;this._tooltipString=e.scrollWidth>e.clientWidth&&e.value||""}}var userIcon='<svg viewBox="0 0 11 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M5.5 5C8.538 5 11 7.015 11 9.5c0 .17-.011.336-.034.5H.034A3.732 3.732 0 0 1 0 9.5C0 7.015 2.462 5 5.5 5zm0-5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5z" /></svg>\n';class RevisionAuthorView extends View{constructor(e,t,n){super(e);const i=new IconView;i.set({content:userIcon,viewBox:"0 0 11 10"});const r=["ck","ck-revision-history-sidebar__revision-author"];n&&r.push("ck-revision-history-sidebar__revision-author_creator");const s=[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision-author__name"],title:getTranslation$5(e,n?"Revision creator":"Revision author")},children:[i,t.name]}];this.setTemplate({tag:"li",attributes:{class:r},children:s})}}function dateToPrettyFormat(e,t){return t.toLocaleDateString(e,{month:"long",day:"numeric"})+", "+t.toLocaleTimeString(e,{hour:"numeric",minute:"numeric"})}function createActionsDropdownView(e,t){const n=e.bindTemplate,i=e.locale,r=createDropdown(i);r.panelPosition="sw";const s=_createDropdownOptions(e,t);return e.bind("isActionsDropdownOpen").to(r,"isOpen"),r.buttonView.set({label:getTranslation$5(i,"Show more items"),tooltip:!0,tooltipPosition:"sw",icon:_0x42409c.threeVerticalDots}),r.extendTemplate({attributes:{class:["ck-revision-history-sidebar__revision__actions",n.if("isActionsDropdownOpen","ck-on")]},on:{click:n.to((e=>e.stopPropagation()))}}),r.on("execute",(t=>{e.isReady&&"function"==typeof t.source._action&&t.source._action(e)})),addListToDropdown(r,s,{role:"menu"}),r.listenTo(e,"change:isActionsDropdownOpen",((n,i,s)=>{if(s)for(const n of r.listView.items){const i=n.children.first,r=t.find((e=>e.action===i._action)).isVisible;n.isVisible=void 0===r||r(e)}})),r}function _createDropdownOptions(e,t){const n=_getLocalizedOptions(e,t),i=new Collection;for(const t of n){const n={type:"button",model:new ViewModel({label:t.name,class:t.class,withText:!0,role:"menuitem",_action:t.action})};n.model.bind("isEnabled").to(e,"isActionsDropdownOpen",(n=>"function"!=typeof t.isEnabled||!n||t.isEnabled(e))),i.add(n)}return i}function _getLocalizedOptions(e,t){const n=e.locale,i={"Compare against selected":getTranslation$5(n,"Compare against selected"),"Name this revision":getTranslation$5(n,"Name this revision"),"Restore this revision":getTranslation$5(n,"Restore this revision")};return t.map((e=>{const t=i[e.name];return t&&t!==e.name&&(e.name=t),e}))}class RevisionView extends(/*   -- @preserve */
ConfirmMixin(View)){constructor(e,t,n,i){super(e);const r=this.bindTemplate,s=getAuthorViews(e,t);this.id=t.id,this._revision=t,this._requireRevisionName=i,this.bind("name","createdAt").to(t),this.bind("_createdAtFormatted").to(this,"createdAt",(t=>dateToPrettyFormat(e.uiLanguage,t))),this.set("isSelected",!1),this.set("isHighlighted",!1),this.set("isActionsDropdownOpen",!1),this.set("isReady",!1),this.set("isEnabled",!1),this.revisionNameView=new RevisionNameView(e,createLabeledInputText),this.revisionNameView.fieldView.extendTemplate({attributes:{maxlength:"220"}}),this.revisionNameView.fieldView.bind("value").to(this,"name",(e=>e||this._createdAtFormatted)),this.revisionNameView.bind("isEnabled").to(this,"isSelected",this,"isEnabled",((e,t)=>e&&t)),this.revisionActionsView=n&&n.length?createActionsDropdownView(this,n):"",this.revisionActionsView&&this.revisionActionsView.bind("isEnabled").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision-wrapper",r.if("isConfirm","ck-revision-history-sidebar__revision-wrapper_confirmation_visible")]},children:[{tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision",r.if("isEnabled","ck-disabled",(e=>!e)),r.if("isSelected","ck-revision-history-sidebar__revision_selected"),r.if("isHighlighted","ck-revision-history-sidebar__revision_highlighted"),r.if("isActionsDropdownOpen","ck-revision-history-sidebar__actions_dropdown_open")]},children:[this.revisionNameView,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision__date"]},children:[{text:r.to("_createdAtFormatted")}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__revision__controls-wrapper"]},children:[{tag:"ul",attributes:{class:["ck","ck-revision-history-sidebar__revision-authors"]},children:s}]},this.revisionActionsView],on:{click:r.to((e=>{e.srcElement.closest(".ck-thread__remove-confirm")||this.isReady&&this.isEnabled&&this.fire("select",{id:this.id})}))}}]})}render(){super.render();const e=this.revisionNameView.fieldView.element;this.listenTo(e,"change",(()=>{this._requireRevisionName&&!e.value||this.fire("setName",{id:this.id,name:e.value}),e.value||(e.value=this.name?this.name:this._createdAtFormatted)}))}select(){this.isSelected=!0}deselect(){this.isSelected=!1}highlight(){this.isHighlighted=!0}unhighlight(){this.isHighlighted=!1}}function getAuthorViews(e,t){const n=Array.from(t.authors).filter((e=>e!=t.creator));return t.creator&&n.unshift(t.creator),n.map((n=>new RevisionAuthorView(e,n,n==t.creator)))}function getDateTimePeriodInfo(e,t){const n=DateTime.fromJSDate(e).setLocale(t),i=DateTime.local(),r=i.minus({days:1}).startOf("day");let s,o;return n.hasSame(i,"day")?(s=n.startOf("day").toJSDate(),o=n.toRelativeCalendar()):n.hasSame(r,"day")?(s=r.toJSDate(),o=n.toRelativeCalendar()):n.hasSame(i,"week")?(s=n.startOf("week").toJSDate(),o=n.weekdayLong||""):n.hasSame(i,"year")?(s=n.startOf("month").toJSDate(),o=n.monthLong||""):(s=n.startOf("year").toJSDate(),o=String(n.year)),{startDate:s,localizedPeriodName:o}}class RevisionsSidebarTimePeriodView extends View{constructor(e,t,n,i){super(e);const r=getDateTimePeriodInfo(t,this.locale.uiLanguage).localizedPeriodName;this.startDate=t,this.revisionViews=this.createCollection(),this._revisionActions=n,this._requireRevisionName=i,this.revisionViews.delegate("select").to(this),this.revisionViews.delegate("setName").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period"]},children:[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__time-period__label"]},children:[{text:r}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period__revisions"]},children:this.revisionViews}]})}addRevision(e){const t=new RevisionView(this.locale,e,this._revisionActions,this._requireRevisionName);this.revisionViews.add(t)}removeRevision(e){const t=this.revisionViews.find((t=>t.id===e.id));this.revisionViews.remove(t)}}class RevisionsSidebarHeaderView extends View{constructor(e){super(e);const t=new IconView;t.content=_0x42409c.history,this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all","ck-revision-history-sidebar__header"]},children:[t,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__header__label"]},children:[getTranslation$5(e,"Revision history")]}]})}}class RevisionsSidebarView extends View{constructor(e,t,n,i){super(e);const r=this.bindTemplate;this.timePeriodViews=this.createCollection(),this.timePeriodViews.delegate("select").to(this),this.timePeriodViews.delegate("setName").to(this),this._revisions=t,this._revisionActions=n,this._requireRevisionName=i,this.on("select",((e,t)=>{this.fire("revisionSelected",t)})),this.on("setName",((e,t)=>{this.fire("revisionSetName",t)})),this.set("isEnabled",!1),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-rounded-corners","ck-revision-history-sidebar"]},children:[new RevisionsSidebarHeaderView(e),{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__timeline",r.if("isEnabled","ck-disabled",(e=>!e))]},children:this.timePeriodViews}]})}render(){super.render();for(const e of this._revisions)this._addRevision(e);this._revisions.on("add",((e,t)=>{this._addRevision(t)})),this._revisions.on("remove",((e,t)=>{this._removeRevision(t)}))}get revisionViews(){return this.timePeriodViews.map((e=>e.revisionViews.map((e=>e)))).flat()}selectRevision(e){for(const t of this.revisionViews)e&&e.id===t.id?t.select():t.deselect()}highlightRevisions(e){for(const t of this.revisionViews)e.some((({id:e})=>e===t.id))?t.highlight():t.unhighlight()}_addRevision(e){const t=getDateTimePeriodInfo(e.createdAt,this.locale.uiLanguage).startDate;let n=this.timePeriodViews.get(0);n&&n.startDate.getTime()===t.getTime()||(n=new RevisionsSidebarTimePeriodView(this.locale,t,this._revisionActions,this._requireRevisionName),this.timePeriodViews.add(n)),n.addRevision(e)}_removeRevision(e){const t=getDateTimePeriodInfo(e.createdAt,this.locale.uiLanguage).startDate;this._getTimePeriodViewByStartDate(t).removeRevision(e)}_getTimePeriodViewByStartDate(e){return this.timePeriodViews.find((t=>t.startDate.getTime()===e.getTime()))}}class RevisionsSidebar extends Plugin{static get pluginName(){return"RevisionsSidebar"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionViewer]}constructor(e){super(e),this._revisionViewer=e.plugins.get(RevisionViewer),this._revisionsRepository=this._revisionViewer.repository,this._sidebarView=null}init(){const e=this._revisionsRepository._revisions,t=this._createRevisionActions(),n=this.editor.config.get("revisionHistory.viewerSidebarContainer");this._sidebarView=new RevisionsSidebarView(this.editor.locale,e,t,this.editor.config.get("revisionHistory.requireRevisionName")),this._sidebarView.on("revisionSelected",this._handleRevisionSelected.bind(this)),this._sidebarView.on("revisionSetName",this._handleRevisionSetName.bind(this)),this._sidebarView.bind("isEnabled").to(this._revisionViewer),this._sidebarView.timePeriodViews.on("add",((e,t)=>{t.revisionViews.on("add",((e,t)=>{t.bind("isEnabled","isReady").to(this._revisionViewer)}))})),this._sidebarView.render(),this.listenTo(this.editor.data,"ready",this._handleEditorDataReady.bind(this)),this.listenTo(this._revisionViewer,"change:diff",this._handleDiffChange.bind(this)),n.appendChild(this._sidebarView.element)}destroy(){this._sidebarView.element.remove(),this._sidebarView.destroy()}_handleEditorDataReady(){const e=this._revisionsRepository.getRevision(0);if(e){const t=this._revisionsRepository.getEarlierVisibleRevision(e.id);this._revisionViewer.compare(e,t)}}_handleRevisionSelected(e,t){const n=this._revisionsRepository.getRevision(t.id),i=this._revisionsRepository.getEarlierVisibleRevision(n.id);this._revisionViewer.compare(n,i)}_handleRevisionSetName(e,t){this._revisionsRepository.getRevision(t.id).setName(t.name)}_handleDiffChange(e,t,n){const i=this._revisionsRepository.getRevisionsInDiff(n);i.length>2?(this._sidebarView.highlightRevisions(i),this._sidebarView.selectRevision(null)):(this._sidebarView.highlightRevisions([]),this._sidebarView.selectRevision(i[0]))}_createRevisionActions(){const e=this.editor,t=RevisionsSidebar.availableRevisionActions,n=e.config.get("revisionHistory.revisionActions")||RevisionsSidebar.defaultRevisionActions;if(n.length)return n.map((n=>{const i="string"==typeof n?Object.assign({},t[n]):n;return i.action=i.action.bind(this,e),i.isVisible&&(i.isVisible=i.isVisible.bind(this,e)),i}))}}function availableRevisionActions(){return{compareAgainstSelected:{name:"Compare against selected",action:({plugins:e},t)=>{const n=e.get(RevisionViewer),i=n.repository;let r=n.diff.newRevisionId,s=t.id;i.getIndex(r)>i.getIndex(s)&&([r,s]=[s,r]),n.compare(r,s)},isVisible:({plugins:e},t)=>{const n=e.get(RevisionViewer);return!(n.repository.getRevisionsInDiff(n.diff).length>2||t.isSelected)}},restoreRevision:{name:"Restore this revision",action:(e,{id:t})=>{e.config.get("revisionHistory").restoreRevisionCallback(t)},isVisible:({plugins:e},t)=>!!e.get(RevisionViewer).repository.getLaterVisibleRevision(t.id)},nameRevision:{name:"Name this revision",action:({plugins:e},{id:t,revisionNameView:n})=>{const i=e.get(RevisionViewer),r=i.repository.getEarlierVisibleRevision(t);i.compare(t,r),n.focus(),n.fieldView.select()}}}}RevisionsSidebar.defaultRevisionActions=["compareAgainstSelected","restoreRevision","nameRevision"],RevisionsSidebar.availableRevisionActions=availableRevisionActions();class RevisionViewerEditorUI extends EditorUI{get view(){return this._view}constructor(e,t){super(e),this._view=t,this._toolbarConfig=normalizeToolbarConfig(e.config.get("toolbar")),this._elementReplacer=new ElementReplacer}get element(){return this.view.element}init(e){const t=this.editor,n=this.view,i=t.editing.view,r=n.editable,s=i.document.getRoot();r.name=s.rootName,n.render();const o=r.element;this.setEditableElement(r.name,o),n.editable.bind("isFocused").to(this.focusTracker),i.attachDomRoot(o),this._elementReplacer.replace(e,this.element),this._initToolbar(),this.fire("ready")}destroy(){super.destroy();const e=this.view,t=this.editor.editing.view;this._elementReplacer.restore(),t.detachDomRoot(e.editable.name),e.destroy()}_initToolbar(){const e=this.view;e.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),e.stickyPanel.limiterElement=e.element,e.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",(({top:e})=>e)),e.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(e.toolbar)}}class RevisionViewerEditorUIView extends BoxedEditorUIView{get editable(){return this._editable}constructor(e,t,n={}){super(e),this.stickyPanel=new StickyPanelView(e),this.toolbar=new ToolbarView(e,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull}),this._editable=new InlineEditableUIView(e,t)}render(){super.render(),this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}class RevisionViewerEditor extends(/*   -- @preserve */
ElementApiMixin(Editor)){get ui(){return this._ui}constructor(e,t){super(t),this.sourceElement=e,this.model.document.createRoot();const n=new RevisionViewerEditorUIView(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:!0});this._ui=new RevisionViewerEditorUI(this,n)}destroy(){return this.updateSourceElement(),this.ui.destroy(),super.destroy()}static async create(e,t){const n=new this(e,t);return await n.initPlugins(),await n.ui.init(e),await n.data.init(n.config.get("initialData")||""),n.fire("ready"),n}}const blackListedPlugins$1=["RevisionHistoryUI","RestrictedEditingMode"];class RevisionViewerIntegration extends Plugin{static get pluginName(){return"RevisionViewerIntegration"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}super(e),this.result="end",e[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),e[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}}class RevisionHistory extends Plugin{static get pluginName(){return"RevisionHistory"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[RevisionTracker,RevisionHistoryUI]}constructor(e){if(super(e),!this.editor.config.get("revisionHistory"))throw new CKEditorError("revision-history-missing-configuration",this);this._viewerEditor=null,this.editor.config.define("revisionHistory.showRevisionViewerCallback",(e=>this._showRevisionViewer({...e,translations:this.editor.locale.translations}))),this.editor.config.define("revisionHistory.closeRevisionViewerCallback",(e=>this._closeRevisionViewer(e))),this.editor.config.define("revisionHistory.restoreRevisionCallback",(e=>this._restoreRevision(e))),this.editor.config.define("revisionHistory.requireRevisionName",!1),this._enhanceShowRevisionViewerCallback(),this._enhanceCloseRevisionViewerCallback()}set adapter(e){this.editor.plugins.get("RevisionTracker").adapter=e}get adapter(){return this.editor.plugins.get("RevisionTracker").adapter}addRevisionData(e){return this.editor.plugins.get("RevisionTracker").addRevisionData(e)}getRevision(e){return this.editor.plugins.get("RevisionsRepository").getRevision(e)}getRevisions(e){return this.editor.plugins.get("RevisionsRepository").getRevisions(e||{toJSON:!1})}_getRevisionViewerEditorConfig(){const e=this.editor,t=sanitizeEditorConfig(e,blackListedPlugins$1),n=e.plugins.get("RevisionTracker"),i=e.plugins.get("Users").users;return t.toolbar=["exitToEditing","restoreRevision","changesNavigation"],delete t.lazyRoots,t.plugins.push(RevisionViewerIntegration,RevisionViewer,RevisionViewerUI,class extends Plugin{static get requires(){return[RevisionViewer,"Users"]}init(){const t=this.editor.plugins.get("Users");for(const e of i)e.isAnonymous||t.getUser(e.id)||t.addUser(e);const r=n.repository.getRevisions();let s=null;const o=this.editor.plugins.get("RevisionViewer");o.adapter=n.adapter,o.bind("isEnabled").to(n),this.editor.commands.get("restoreRevision").bind("isEnabled").to(e,"isReadOnly",(e=>!e));for(const e of r){const t=null===e.creator;if(t&&e.toVersion===e.fromVersion)continue;const i=e.toJSON();o.addRevisionData(i,((i,r,o)=>{if(t){if(s)s._update(i,r);else if(!r){const e=o.toJSON();e.id=uid(),n.saveRevision(e,o.toVersion).then((e=>{s=e}))}}else e._update(i,r)}))}}},RevisionsSidebar),t}_enhanceShowRevisionViewerCallback(){const e=this.editor.config.get("revisionHistory").showRevisionViewerCallback;this.editor.config.set("revisionHistory.showRevisionViewerCallback",(async()=>{this.editor.enableReadOnlyMode("revision-history-viewer-opened");const t=this.editor.plugins.get("RevisionTracker");if(this.editor.plugins.has("Autosave")){const e=this.editor.plugins.get("Autosave");await e.save()}else await t.update();if(this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this.editor.plugins.has("Dialog")){const e=this.editor.plugins.get("Dialog");e.isOpen&&e.hide()}const n=this._getRevisionViewerEditorConfig();return e(n).then((e=>(this._viewerEditor=e,this.editor.plugins.has("Annotations")&&this.editor.plugins.get("Annotations").refreshVisibility(),e))).catch((e=>(console.error(e),this.editor.disableReadOnlyMode("revision-history-viewer-opened"),null)))}))}_enhanceCloseRevisionViewerCallback(){const e=this.editor.config.get("revisionHistory").closeRevisionViewerCallback;this.editor.config.set("revisionHistory.closeRevisionViewerCallback",(()=>(this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this._viewerEditor.plugins.get("RevisionViewer")._cleanUp(),e(this._viewerEditor).then((()=>{if(this.editor.disableReadOnlyMode("revision-history-viewer-opened"),this._viewerEditor=null,this.editor.plugins.has("Annotations")){const e=this.editor.plugins.get("Annotations");e.refreshVisibility(),e.refreshPositioning()}})))))}_showRevisionViewer(e){const t=this.editor.config.get("revisionHistory.editorContainer"),n=this.editor.config.get("revisionHistory.viewerContainer"),i=this.editor.config.get("revisionHistory.viewerEditorElement");return RevisionViewerEditor.create(i,e).then((e=>(n.style.display="block",t.style.display="none",e)))}_closeRevisionViewer(e){const t=this.editor.config.get("revisionHistory.editorContainer");return this.editor.config.get("revisionHistory.viewerContainer").style.display="none",t.style.display="",e.destroy()}async _restoreRevision(e){const t=this.editor,n=this._viewerEditor.plugins.get("RevisionViewer"),i=t.plugins.get("RevisionTracker"),r=n.repository.getRevision(e);let s,o,a;try{s=await n.getRevisionData(r),o=await n.getRevisionRootsAttributes(r)}catch(e){return void console.error(e)}t.model.change((e=>{for(const n of Array.from(t.model.markers.getMarkersGroup("restrictedEditingException")))e.removeMarker(n)})),n.isReady=!1,t.model.enqueueChange((e=>{e.setSelection(null),e.removeSelectionAttribute(t.model.document.selection.getAttributeKeys());const n=Object.keys(s);for(const i of t.model.document.roots)"$graveyard"!=i.rootName&&i.isAttached()&&!n.includes(i.rootName)&&e.detachRoot(i);for(const i of n){let n=t.model.document.getRoot(i);n&&n.isAttached()||(n=e.addRoot(i));const r=o[i],a=Object.keys(r),l=s[i];for(const t of n.getAttributeKeys())a.includes(t)||e.removeAttribute(t,n);for(const t of a)e.setAttribute(t,o[i][t],n);e.remove(e.createRangeIn(n)),e.insert(t.data.parse(l,n),n,0)}}));const l=getTranslation$5(t.locale,"Restored");return a=r.name?-1==r.name.indexOf(l)?l+": "+r.name:r.name:l+": "+r.createdAt.toLocaleDateString(t.locale.uiLanguage,{month:"long",day:"numeric"})+", "+r.createdAt.toLocaleTimeString(t.locale.uiLanguage,{hour:"numeric",minute:"numeric"}),await i.saveRevision({name:a}),n.isReady=!0,t.config.get("revisionHistory").closeRevisionViewerCallback()}}function getTranslation$4(e,t){const n=e.t,i=e.t;switch(t){case"AI Assistant":return i("AI Assistant");case"Block quote":return i("Block quote");case"Bulleted list":return i("Bulleted list");case"Insert code block":return i("Insert code block");case"Open file manager":return i("Open file manager");case"Insert image":return i("Insert image");case"Heading 1":return i("Heading 1");case"Heading 2":return i("Heading 2");case"Heading 3":return i("Heading 3");case"Heading 4":return i("Heading 4");case"Heading 5":return i("Heading 5");case"Heading 6":return i("Heading 6");case"Horizontal line":return i("Horizontal line");case"Insert HTML":return i("Insert HTML");case"Increase indent":return i("Increase indent");case"Insert table":return i("Insert table");case"Table of contents":return i("Table of contents");case"Numbered list":return i("Numbered list");case"Decrease indent":return i("Decrease indent");case"Paragraph":return i("Paragraph");case"To-do list":return i("To-do list");case"Create a block quote":return n("Create a block quote");case"Create a bulleted list":return n("Create a bulleted list");case"Create a code block":return n("Create a code block");case"Open file manager to insert an image or a file":return n("Open file manager to insert an image or a file");case"Open file browser to insert an image or a file":return n("Open file browser to insert an image or a file");case"Create a heading level 1":return n("Create a heading level 1");case"Create a heading level 2":return n("Create a heading level 2");case"Create a heading level 3":return n("Create a heading level 3");case"Create a heading level 4":return n("Create a heading level 4");case"Create a heading level 5":return n("Create a heading level 5");case"Create a heading level 6":return n("Create a heading level 6");case"Insert a horizontal line":return n("Insert a horizontal line");case"Insert an HTML snippet":return n("Insert an HTML snippet");case"Increase the indentation":return n("Increase the indentation");case"Insert Mermaid diagram":return n("Insert Mermaid diagram");case"Insert the Mermaid diagram":return n("Insert the Mermaid diagram");case"Create a table":return n("Create a table");case"Insert table of contents":return n("Insert table of contents");case"Create a numbered list":return n("Create a numbered list");case"Decrease the indentation":return n("Decrease the indentation");case"Insert a paragraph":return n("Insert a paragraph");case"Create a to-do list":return n("Create a to-do list");case"Open the AI Assistant to generate content":return n("Open the AI Assistant to generate content");case"Insert an emoji":return n("Insert an emoji");default:return t}}class SlashCommandConfig extends Plugin{static get pluginName(){return"SlashCommandConfig"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._allowedCommands=null}afterInit(){const e=this.editor.config.get("slashCommand.removeCommands")||[],t=getExcludedHeadings(this.editor.config.get("heading.options"));let n=this.getDefaultCommands().filter((e=>!t.includes(e.id))).filter((t=>!e.includes(t.commandName)));const i=this.editor.config.get("slashCommand.extraCommands");i&&i.length&&(n=n.concat(i));const r=this.editor.config.get("template.definitions");r&&r.length&&(n=n.concat(mapTemplates(r)));const s=this.editor.config.get("style.definitions");s&&s.length&&(n=n.concat(mapStyles(s)));const o=n.filter((e=>!e.commandName||void 0!==this.editor.commands.get(e.commandName))),a=[];for(const e of o)a.push({id:e.id,commandName:e.commandName,title:"function"==typeof e.title?e.title(this.editor):e.title,description:e.description,icon:e.icon,isIconColorInherited:e.isIconColorInherited,aliases:e.aliases,isEnabled:()=>this._proxyIsEnabled(e),execute:()=>this._proxyExecute(e)});this._allowedCommands=a.sort(compareCommands),checkLicense$4(this)}getAllowedCommands(){return this._allowedCommands}getDefaultCommands(){const e=e=>getTranslation$4(this.editor.locale,e);return[{id:"aiAssistant",commandName:"showAIAssistant",icon:icons.robotPencil,title:e("AI Assistant"),description:e("Open the AI Assistant to generate content"),execute:e=>{setTimeout((()=>e.execute("showAIAssistant")))}},{id:"blockQuote",commandName:"blockQuote",icon:_0x42409c.quote,title:e("Block quote"),description:e("Create a block quote")},{id:"bulletedList",commandName:"bulletedList",icon:_0x42409c.bulletedList,title:e("Bulleted list"),description:e("Create a bulleted list")},{id:"codeBlock",commandName:"codeBlock",icon:_0x42409c.codeBlock,title:e("Insert code block"),description:e("Create a code block")},{id:"ckbox",commandName:"ckbox",icon:_0x42409c.browseFiles,title:e("Open file manager"),description:e("Open file manager to insert an image or a file"),aliases:["ckfinder","filemanager","upload"]},{id:"ckfinder",commandName:"ckfinder",icon:_0x42409c.browseFiles,title:e("Insert image"),description:e("Open file browser to insert an image or a file"),aliases:["ckbox","filemanager","upload"]},{id:"emoji",commandName:"emoji",icon:_0x42409c.emoji,title:e("Emoji"),description:e("Insert an emoji"),execute:e=>{setTimeout((()=>e.execute("emoji")))}},{id:"heading1",commandName:"heading",icon:_0x42409c.heading1,title:e("Heading 1"),description:e("Create a heading level 1"),execute:e=>{e.execute("heading",{value:"heading1"})}},{id:"heading2",commandName:"heading",icon:_0x42409c.heading2,title:e("Heading 2"),description:e("Create a heading level 2"),execute:e=>{e.execute("heading",{value:"heading2"})}},{id:"heading3",commandName:"heading",icon:_0x42409c.heading3,title:e("Heading 3"),description:e("Create a heading level 3"),execute:e=>{e.execute("heading",{value:"heading3"})}},{id:"heading4",commandName:"heading",icon:_0x42409c.heading4,title:e("Heading 4"),description:e("Create a heading level 4"),execute:e=>{e.execute("heading",{value:"heading4"})}},{id:"heading5",commandName:"heading",icon:_0x42409c.heading5,title:e("Heading 5"),description:e("Create a heading level 5"),execute:e=>{e.execute("heading",{value:"heading5"})}},{id:"heading6",commandName:"heading",icon:_0x42409c.heading6,title:e("Heading 6"),description:e("Create a heading level 6"),execute:e=>{e.execute("heading",{value:"heading6"})}},{id:"horizontalLine",commandName:"horizontalLine",icon:_0x42409c.horizontalLine,title:e("Horizontal line"),description:e("Insert a horizontal line")},{id:"htmlEmbed",commandName:"htmlEmbed",icon:_0x42409c.html,title:e("Insert HTML"),description:e("Insert an HTML snippet")},{id:"indent",commandName:"indent",icon:_0x42409c.indent,title:e("Increase indent"),description:e("Increase the indentation")},{id:"insertMermaidCommand",commandName:"insertMermaidCommand",title:e("Insert Mermaid diagram"),description:e("Insert the Mermaid diagram")},{id:"insertTable",commandName:"insertTable",icon:_0x42409c.table,title:e("Insert table"),description:e("Create a table")},{id:"insertTableOfContents",commandName:"insertTableOfContents",icon:icons.tableOfContents,title:e("Table of contents"),description:e("Insert table of contents"),aliases:["toc"]},{id:"numberedList",commandName:"numberedList",icon:_0x42409c.numberedList,title:e("Numbered list"),description:e("Create a numbered list")},{id:"outdent",commandName:"outdent",icon:_0x42409c.outdent,title:e("Decrease indent"),description:e("Decrease the indentation")},{id:"paragraph",commandName:"paragraph",icon:_0x42409c.paragraph,title:e("Paragraph"),description:e("Insert a paragraph")},{id:"todoList",commandName:"todoList",icon:_0x42409c.todoList,title:e("To-do list"),description:e("Create a to-do list")}]}_proxyIsEnabled(e){return e.isEnabled?e.isEnabled(this.editor):!e.commandName||this.editor.commands.get(e.commandName).isEnabled}_proxyExecute(e){if(e.execute)e.execute(this.editor);else{if(!e.commandName)throw new CKEditorError("slash-command-execute-missing",this.editor,{commandDefinition:e});this.editor.execute(e.commandName)}}}function compareCommands(e,t){return e.title<t.title?-1:e.title>t.title?1:0}function convertTitleToId(e,t){return t+"-"+e.toLowerCase().split(" ").join("-")}function mapTemplates(e){return e.map((e=>{const{title:t,icon:n,description:i,data:r}=e,s={id:convertTitleToId(t,"template"),commandName:"insertTemplate",execute:e=>{e.execute("insertTemplate",r)},description:i,icon:n,title:t};return n&&(s.isIconColorInherited=!1),s}))}function mapStyles(e){return e.map((e=>({id:convertTitleToId(e.name,"style"),commandName:"style",execute:t=>{t.execute("style",{styleName:e.name})},isEnabled:t=>{const n=t.commands.get("style");return n.isEnabled&&n.enabledStyles.includes(e.name)},title:e.name})))}function getExcludedHeadings(e){let t=["heading4","heading5","heading6"];if(e){const n=e.map((e=>e.model));t=["heading1","heading2","heading3","heading4","heading5","heading6"].filter((e=>!n.includes(e)))}return t}async function checkLicense$4(e){const t=g([67,109,114,69,49,71,103,52,112,102,51,77,90,89,113,106,72,65,80,48,104,74,87,57,119,116,111,56,55,115,120,122,53,100,66,110,75,54,73,85,108,50,76,105,88,70,84,86,118,83,82,81,121,79,98,107,97,68,78,117,99,101]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([67]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([83,67]))||!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class SlashCommandEditing extends Plugin{static get pluginName(){return"SlashCommandEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[SlashCommandConfig]}getMatchingCommands(e){const t=e&&e.toLowerCase();let n=this.editor.plugins.get("SlashCommandConfig").getAllowedCommands();if(n=n.filter((e=>e.isEnabled())),t){const e=[],i=[],r=[],s=[];for(const o of n)o.id.toLowerCase().includes(t)?e.push(o):o.title.toLowerCase().includes(t)?i.push(o):o.aliases&&o.aliases.some((e=>e.toLowerCase().includes(t)))?r.push(o):o.description&&o.description.toLowerCase().includes(t)&&s.push(o);n=e.concat(i,r,s)}return n}}var defaultIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M10 19a9 9 0 1 0 0-18 9 9 0 0 0 0 18Zm3.45-9.872a1 1 0 0 1 0 1.744l-4.96 2.79A1 1 0 0 1 7 12.79V7.21a1 1 0 0 1 1.49-.872l4.96 2.79Z"/></svg>';class SlashCommandButtonView extends ButtonView{constructor(e,t){super(e),this.textPartView=this._createTextPartView(e,t),void 0!==t.isIconColorInherited&&(this.iconView.isColorInherited=t.isIconColorInherited),this.set({icon:t.icon||defaultIcon,withText:!0,label:t.title,class:"ck-slash-command-button"})}render(){super.render(),this.children.add(this.textPartView)}_createTextPartView(e,t){const n=new View(e);return n.setTemplate({tag:"div",attributes:{class:["ck","ck-slash-command-button__text-part"]},children:t.description?[this.labelView,{tag:"span",attributes:{class:["ck","ck-slash-command-button__description"]},children:[{text:t.description}]}]:[this.labelView]}),n}}class SlashCommandUI extends Plugin{static get pluginName(){return"SlashCommandUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._setupMentionConfiguration()}init(){this.editor.once("ready",this._overrideMentionExecuteListener.bind(this)),this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("slashCommandLicenseKeyValid"==r||"slashCommandLicenseKeyInvalid"==r||"slashCommandLicenseKeyExpired"==r||"slashCommandLicenseKeyDomainLimit"==r||"slashCommandLicenseKeyNotAllowed"==r||"slashCommandLicenseKeyEvaluationLimit"==r||"slashCommandLicenseKeyTrialLimit"==r||"slashCommandLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"slashCommandLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"slashCommandLicenseKeyExpired"==t&&e._showLicenseError("expired"),"slashCommandLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"slashCommandLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","SlashCommand"),"slashCommandLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"slashCommandLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"slashCommandLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_setupMentionConfiguration(){const e=this.editor,t=this.editor.plugins.get("SlashCommandEditing"),n=e.config.get("mention.feeds");n.push({marker:"/",feed:e=>t.getMatchingCommands(e),itemRenderer:this._customItemRenderer.bind(this),dropdownLimit:e.config.get("slashCommand.dropdownLimit")||1/0}),e.config.set("mention.feeds",n)}_overrideMentionExecuteListener(){const e=this.editor;e.commands.get("mention").on("execute",((t,n)=>{const i=n[0],r=e.model;"/"===i.marker&&r.change((e=>{e.remove(i.range),i.mention.execute(),t.stop()}))}),{priority:"high"})}_customItemRenderer(e){const t=this.editor.locale,n=new SlashCommandButtonView(t,e);return n.render(),n.element}}class SlashCommand extends Plugin{static get requires(){return["Mention",SlashCommandEditing,SlashCommandUI]}static get pluginName(){return"SlashCommand"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}function getTranslation$3(e,t){const n=e.t;switch(t){case"Edit source modal label":return n({string:"Edit source",id:"Edit source modal label"});case"Source":return n("Source");case"Source Editing Enhanced":return n("Source Editing Enhanced");case"Copy line down":return n("Copy line down");case"Copy line up":return n("Copy line up");case"Delete line":return n("Delete line");case"Indent less":return n("Indent less");case"Indent more":return n("Indent more");case"Fold all":return n("Fold all");case"Fold code (current level)":return n("Fold code (current level)");case"Move line down":return n("Move line down");case"Move line up":return n("Move line up");case"Redo (keystroke)":return n({id:"Redo (keystroke)",string:"Redo"});case"Select line":return n("Select line");case'Switch between "focus with tab" and "indent with tab" mode':return n('Switch between "focus with tab" and "indent with tab" mode');case"Toggle block comment":return n("Toggle block comment");case"Toggle comment":return n("Toggle comment");case"Undo (keystroke)":return n({id:"Undo (keystroke)",string:"Undo"});case"Unfold all":return n("Unfold all");case"Unfold code (current level)":return n("Unfold code (current level)");case"Are you sure you want to discard your changes? This action cannot be undone.":return n("Are you sure you want to discard your changes? This action cannot be undone.");case"Cancel":return n("Cancel");case"Save":return n("Save");default:return t}}function getActiveRootName(e){const t=e.editing.view.document.roots,n=t.length;if(0===n)throw new CKEditorError("source-editing-enhanced-editor-no-root",e);return 1===n?t.first.rootName:Array.from(e.editing.view.document.selection.getRanges())[0].root.rootName}function formatSource(e){return isHtml(e)?formatHtml(e):e}function unformatSource(e){return isHtml(e.replace(/^[\n\s]*/g,""))?e.replace(/\s+/g,""):e}function formatHtml(e){const t=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],n=t.map((e=>e.name)).join("|"),i=e.replace(new RegExp("</?("+n+")( .*?)?>","g"),"\n$&\n").replace(/<br[^>]*>/g,"$&\n").split("\n");let r=0,s=!1;return i.filter((e=>e.length)).map((e=>(s=isPreformattedBlockLine(e,s),isNonVoidOpeningTag(e,t)?indentLine(e,r++):isClosingTag(e,t)?indentLine(e,--r):"middle"===s||"last"===s?e:indentLine(e,r)))).join("\n")}function isHtml(e){return e.startsWith("<")}function isNonVoidOpeningTag(e,t){return t.some((t=>!t.isVoid&&!!new RegExp("<"+t.name+"( .*?)?>").test(e)))}function isClosingTag(e,t){return t.some((t=>new RegExp("</"+t.name+">").test(e)))}function indentLine(e,t,n="    "){return""+n.repeat(Math.max(0,t))+e}function isPreformattedBlockLine(e,t){return new RegExp("<pre( .*?)?>").test(e)?"first":new RegExp("</pre>").test(e)?"last":("first"===t||"middle"===t)&&"middle"}let rangeFrom=[],rangeTo=[];function isExtendingChar(e){if(e<768)return!1;for(let t=0,n=rangeFrom.length;;){let i=t+n>>1;if(e<rangeFrom[i])n=i;else{if(!(e>=rangeTo[i]))return!0;t=i+1}if(t==n)return!1}}function isRegionalIndicator(e){return e>=127462&&e<=127487}(()=>{let e="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((e=>e?parseInt(e,36):1));for(let t=0,n=0;t<e.length;t++)(t%2?rangeTo:rangeFrom).push(n+=e[t])})();const ZWJ=8205;function findClusterBreak$1(e,t,n=!0,i=!0){return(n?nextClusterBreak:prevClusterBreak)(e,t,i)}function nextClusterBreak(e,t,n){if(t==e.length)return t;t&&surrogateLow$1(e.charCodeAt(t))&&surrogateHigh$1(e.charCodeAt(t-1))&&t--;let i=codePointAt$1(e,t);for(t+=codePointSize$1(i);t<e.length;){let r=codePointAt$1(e,t);if(i==ZWJ||r==ZWJ||n&&isExtendingChar(r))t+=codePointSize$1(r),i=r;else{if(!isRegionalIndicator(r))break;{let n=0,i=t-2;for(;i>=0&&isRegionalIndicator(codePointAt$1(e,i));)n++,i-=2;if(n%2==0)break;t+=2}}}return t}function prevClusterBreak(e,t,n){for(;t>0;){let i=nextClusterBreak(e,t-2,n);if(i<t)return i;t--}return 0}function codePointAt$1(e,t){let n=e.charCodeAt(t);if(!surrogateHigh$1(n)||t+1==e.length)return n;let i=e.charCodeAt(t+1);return surrogateLow$1(i)?i-56320+(n-55296<<10)+65536:n}function surrogateLow$1(e){return e>=56320&&e<57344}function surrogateHigh$1(e){return e>=55296&&e<56320}function codePointSize$1(e){return e<65536?1:2}class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError("Invalid position "+e+" in document of length "+this.length);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError("Invalid line number "+e+" in "+this.lines+"-line document");return this.lineInner(e,!0,1,0)}replace(e,t,n){[e,t]=clip(this,e,t);let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,3),this.decompose(t,this.length,i,1),TextNode.from(i,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=clip(this,e,t);let n=[];return this.decompose(e,t,n,0),TextNode.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new RawTextCursor(this),r=new RawTextCursor(e);for(let e=t,s=t;;){if(i.next(e),r.next(e),e=0,i.lineBreak!=r.lineBreak||i.done!=r.done||i.value!=r.value)return!1;if(s+=i.value.length,i.done||s>=n)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,t=this.length){return new PartialTextCursor(this,e,t)}iterLines(e,t){let n;if(null==e)n=this.iter();else{null==t&&(t=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new LineCursor(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[])):Text.empty}}class TextLeaf extends Text{constructor(e,t=textLength(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,i){for(let r=0;;r++){let s=this.text[r],o=i+s.length;if((t?n:o)>=e)return new Line$1(i,o,n,s);i=o+1,n++}}decompose(e,t,n,i){let r=e<=0&&t>=this.length?this:new TextLeaf(sliceText(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&i){let e=n.pop(),t=appendText(r.text,e.text.slice(),0,r.length);if(t.length<=32)n.push(new TextLeaf(t,e.length+r.length));else{let e=t.length>>1;n.push(new TextLeaf(t.slice(0,e)),new TextLeaf(t.slice(e)))}}else n.push(r)}replace(e,t,n){if(!(n instanceof TextLeaf))return super.replace(e,t,n);[e,t]=clip(this,e,t);let i=appendText(this.text,appendText(n.text,sliceText(this.text,0,e)),t),r=this.length+n.length-(t-e);return i.length<=32?new TextLeaf(i,r):TextNode.from(TextLeaf.split(i,[]),r)}sliceString(e,t=this.length,n="\n"){[e,t]=clip(this,e,t);let i="";for(let r=0,s=0;r<=t&&s<this.text.length;s++){let o=this.text[s],a=r+o.length;r>e&&s&&(i+=n),e<a&&t>r&&(i+=o.slice(Math.max(0,e-r),t-r)),r=a+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],i=-1;for(let r of e)n.push(r),i+=r.length+1,32==n.length&&(t.push(new TextLeaf(n,i)),n=[],i=-1);return i>-1&&t.push(new TextLeaf(n,i)),t}}class TextNode extends Text{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let t of e)this.lines+=t.lines}lineInner(e,t,n,i){for(let r=0;;r++){let s=this.children[r],o=i+s.length,a=n+s.lines-1;if((t?a:o)>=e)return s.lineInner(e,t,n,i);i=o+1,n=a+1}}decompose(e,t,n,i){for(let r=0,s=0;s<=t&&r<this.children.length;r++){let o=this.children[r],a=s+o.length;if(e<=a&&t>=s){let r=i&((s<=e?1:0)|(a>=t?2:0));s>=e&&a<=t&&!r?n.push(o):o.decompose(e-s,t-s,n,r)}s=a+1}}replace(e,t,n){if([e,t]=clip(this,e,t),n.lines<this.lines)for(let i=0,r=0;i<this.children.length;i++){let s=this.children[i],o=r+s.length;if(e>=r&&t<=o){let a=s.replace(e-r,t-r,n),l=this.lines-s.lines+a.lines;if(a.lines<l>>4&&a.lines>l>>6){let r=this.children.slice();return r[i]=a,new TextNode(r,this.length-(t-e)+n.length)}return super.replace(r,o,a)}r=o+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n="\n"){[e,t]=clip(this,e,t);let i="";for(let r=0,s=0;r<this.children.length&&s<=t;r++){let o=this.children[r],a=s+o.length;s>e&&r&&(i+=n),e<a&&t>s&&(i+=o.sliceString(e-s,t-s,n)),s=a+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof TextNode))return 0;let n=0,[i,r,s,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,r+=t){if(i==s||r==o)return n;let a=this.children[i],l=e.children[r];if(a!=l)return n+a.scanIdentical(l,t);n+=a.length+1}}static from(e,t=e.reduce(((e,t)=>e+t.length+1),-1)){let n=0;for(let t of e)n+=t.lines;if(n<32){let n=[];for(let t of e)t.flatten(n);return new TextLeaf(n,t)}let i=Math.max(32,n>>5),r=i<<1,s=i>>1,o=[],a=0,l=-1,c=[];function d(e){let t;if(e.lines>r&&e instanceof TextNode)for(let t of e.children)d(t);else e.lines>s&&(a>s||!a)?(u(),o.push(e)):e instanceof TextLeaf&&a&&(t=c[c.length-1])instanceof TextLeaf&&e.lines+t.lines<=32?(a+=e.lines,l+=e.length+1,c[c.length-1]=new TextLeaf(t.text.concat(e.text),t.length+1+e.length)):(a+e.lines>i&&u(),a+=e.lines,l+=e.length+1,c.push(e))}function u(){0!=a&&(o.push(1==c.length?c[0]:TextNode.from(c,l)),l=-1,a=c.length=0)}for(let t of e)d(t);return u(),1==o.length?o[0]:new TextNode(o,t)}}function textLength(e){let t=-1;for(let n of e)t+=n.length+1;return t}function appendText(e,t,n=0,i=1e9){for(let r=0,s=0,o=!0;s<e.length&&r<=i;s++){let a=e[s],l=r+a.length;l>=n&&(l>i&&(a=a.slice(0,i-r)),r<n&&(a=a.slice(n-r)),o?(t[t.length-1]+=a,o=!1):t.push(a)),r=l+1}return t}function sliceText(e,t,n){return appendText(e,[""],t,n)}Text.empty=new TextLeaf([""],0);class RawTextCursor{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],r=this.offsets[n],s=r>>1,o=i instanceof TextLeaf?i.text.length:i.children.length;if(s==(t>0?o:0)){if(0==n)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&r)==(t>0?0:1)){if(this.offsets[n]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(i instanceof TextLeaf){let r=i.text[s+(t<0?-1:0)];if(this.offsets[n]+=t,r.length>Math.max(0,e))return this.value=0==e?r:t>0?r.slice(e):r.slice(0,r.length-e),this;e-=r.length}else{let r=i.children[s+(t<0?-1:0)];e>r.length?(e-=r.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(r),this.offsets.push(t>0?1:(r instanceof TextLeaf?r.text.length:r.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=n?i:t<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:i}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});let Line$1=class{constructor(e,t,n,i){this.from=e,this.to=t,this.number=n,this.text=i}get length(){return this.to-this.from}};function clip(e,t,n){return[t=Math.max(0,Math.min(e.length,t)),Math.max(t,Math.min(e.length,n))]}function findClusterBreak(e,t,n=!0,i=!0){return findClusterBreak$1(e,t,n,i)}function surrogateLow(e){return e>=56320&&e<57344}function surrogateHigh(e){return e>=55296&&e<56320}function codePointAt(e,t){let n=e.charCodeAt(t);if(!surrogateHigh(n)||t+1==e.length)return n;let i=e.charCodeAt(t+1);return surrogateLow(i)?i-56320+(n-55296<<10)+65536:n}function fromCodePoint(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function codePointSize(e){return e<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,n=0,i=0;t<this.sections.length;){let r=this.sections[t++],s=this.sections[t++];s<0?(e(n,i,r),i+=r):i+=s,n+=r}}iterChangedRanges(e,t=!1){iterChanges(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let n=this.sections[t++],i=this.sections[t++];i<0?e.push(n,i):e.push(i,n)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,t=!1){return e.empty?this:mapSet(this,e,t)}mapPos(e,t=-1,n=MapMode.Simple){let i=0,r=0;for(let s=0;s<this.sections.length;){let o=this.sections[s++],a=this.sections[s++],l=i+o;if(a<0){if(l>e)return r+(e-i);r+=o}else{if(n!=MapMode.Simple&&l>=e&&(n==MapMode.TrackDel&&i<e&&l>e||n==MapMode.TrackBefore&&i<e||n==MapMode.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!o)return e==i||t<0?r:r+a;r+=a}i=l}if(e>i)throw new RangeError("Position "+e+" is out of range for changeset of length "+i);return r}touchesRange(e,t=e){for(let n=0,i=0;n<this.sections.length&&i<=t;){let r=i+this.sections[n++];if(this.sections[n++]>=0&&i<=t&&r>=e)return!(i<e&&r>t)||"cover";i=r}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let n=this.sections[t++],i=this.sections[t++];e+=(e?" ":"")+n+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some((e=>"number"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,((t,n,i,r,s)=>e=e.replace(i,i+(n-t),s)),!1),e}mapDesc(e,t=!1){return mapSet(this,e,t,!0)}invert(e){let t=this.sections.slice(),n=[];for(let i=0,r=0;i<t.length;i+=2){let s=t[i],o=t[i+1];if(o>=0){t[i]=o,t[i+1]=s;let a=i>>1;for(;n.length<a;)n.push(Text.empty);n.push(s?e.slice(r,r+s):Text.empty)}r+=s}return new ChangeSet(t,n)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,t=!1){return e.empty?this:mapSet(this,e,t,!0)}iterChanges(e,t=!1){iterChanges(this,e,t)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let t=[],n=[],i=[],r=new SectionIter(this);e:for(let s=0,o=0;;){let a=s==e.length?1e9:e[s++];for(;o<a||o==a&&0==r.len;){if(r.done)break e;let e=Math.min(r.len,a-o);addSection(i,e,-1);let s=-1==r.ins?-1:0==r.off?r.ins:0;addSection(t,e,s),s>0&&addInsert(n,t,r.text),r.forward(e),o+=e}let l=e[s++];for(;o<l;){if(r.done)break e;let e=Math.min(r.len,l-o);addSection(t,e,-1),addSection(i,e,-1==r.ins?-1:0==r.off?r.ins:0),r.forward(e),o+=e}}return{changes:new ChangeSet(t,n),filtered:ChangeDesc.create(i)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t],i=this.sections[t+1];i<0?e.push(n):0==i?e.push([n]):e.push([n].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,n){let i=[],r=[],s=0,o=null;function a(e=!1){if(!e&&!i.length)return;s<t&&addSection(i,t-s,-1);let n=new ChangeSet(i,r);o=o?o.compose(n.map(o)):n,i=[],r=[],s=0}return function e(l){if(Array.isArray(l))for(let t of l)e(t);else if(l instanceof ChangeSet){if(l.length!=t)throw new RangeError("Mismatched change set length (got "+l.length+", expected "+t+")");a(),o=o?o.compose(l.map(o)):l}else{let{from:e,to:o=e,insert:c}=l;if(e>o||e<0||o>t)throw new RangeError("Invalid change range "+e+" to "+o+" (in doc of length "+t+")");let d=c?"string"==typeof c?Text.of(c.split(n||DefaultSplit)):c:Text.empty,u=d.length;if(e==o&&0==u)return;e<s&&a(),e>s&&addSection(i,e-s,-1),addSection(i,o-e,u),addInsert(r,i,d),s=o}}(e),a(!o),o}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],n=[];for(let i=0;i<e.length;i++){let r=e[i];if("number"==typeof r)t.push(r,-1);else{if(!Array.isArray(r)||"number"!=typeof r[0]||r.some(((e,t)=>t&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==r.length)t.push(r[0],0);else{for(;n.length<i;)n.push(Text.empty);n[i]=Text.of(r.slice(1)),t.push(r[0],n[i].length)}}}return new ChangeSet(t,n)}static createSet(e,t){return new ChangeSet(e,t)}}function addSection(e,t,n,i=!1){if(0==t&&n<=0)return;let r=e.length-2;r>=0&&n<=0&&n==e[r+1]?e[r]+=t:r>=0&&0==t&&0==e[r]?e[r+1]+=n:i?(e[r]+=t,e[r+1]+=n):e.push(t,n)}function addInsert(e,t,n){if(0==n.length)return;let i=t.length-2>>1;if(i<e.length)e[e.length-1]=e[e.length-1].append(n);else{for(;e.length<i;)e.push(Text.empty);e.push(n)}}function iterChanges(e,t,n){let i=e.inserted;for(let r=0,s=0,o=0;o<e.sections.length;){let a=e.sections[o++],l=e.sections[o++];if(l<0)r+=a,s+=a;else{let c=r,d=s,u=Text.empty;for(;c+=a,d+=l,l&&i&&(u=u.append(i[o-2>>1])),!(n||o==e.sections.length||e.sections[o+1]<0);)a=e.sections[o++],l=e.sections[o++];t(r,c,s,d,u),r=c,s=d}}}function mapSet(e,t,n,i=!1){let r=[],s=i?[]:null,o=new SectionIter(e),a=new SectionIter(t);for(let e=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(-1==o.ins&&-1==a.ins){let e=Math.min(o.len,a.len);addSection(r,e,-1),o.forward(e),a.forward(e)}else if(a.ins>=0&&(o.ins<0||e==o.i||0==o.off&&(a.len<o.len||a.len==o.len&&!n))){let t=a.len;for(addSection(r,a.ins,-1);t;){let n=Math.min(o.len,t);o.ins>=0&&e<o.i&&o.len<=n&&(addSection(r,0,o.ins),s&&addInsert(s,r,o.text),e=o.i),o.forward(n),t-=n}a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return s?ChangeSet.createSet(r,s):ChangeDesc.create(r);throw new Error("Mismatched change set lengths")}{let t=0,n=o.len;for(;n;)if(-1==a.ins){let e=Math.min(n,a.len);t+=e,n-=e,a.forward(e)}else{if(!(0==a.ins&&a.len<n))break;n-=a.len,a.next()}addSection(r,t,e<o.i?o.ins:0),s&&e<o.i&&addInsert(s,r,o.text),e=o.i,o.forward(o.len-n)}}}}function composeSets(e,t,n=!1){let i=[],r=n?[]:null,s=new SectionIter(e),o=new SectionIter(t);for(let e=!1;;){if(s.done&&o.done)return r?ChangeSet.createSet(i,r):ChangeDesc.create(i);if(0==s.ins)addSection(i,s.len,0,e),s.next();else if(0!=o.len||o.done){if(s.done||o.done)throw new Error("Mismatched change set lengths");{let t=Math.min(s.len2,o.len),n=i.length;if(-1==s.ins){let n=-1==o.ins?-1:o.off?0:o.ins;addSection(i,t,n,e),r&&n&&addInsert(r,i,o.text)}else-1==o.ins?(addSection(i,s.off?0:s.len,t,e),r&&addInsert(r,i,s.textBit(t))):(addSection(i,s.off?0:s.len,o.off?0:o.ins,e),r&&!o.off&&addInsert(r,i,o.text));e=(s.ins>t||o.ins>=0&&o.len>t)&&(e||i.length>n),s.forward2(t),o.forward(t)}}else addSection(i,0,o.ins,e),r&&addInsert(r,i,o.text),o.next()}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Text.empty:e[t]}textBit(e){let{inserted:t}=this.set,n=this.i-2>>1;return n>=t.length&&!e?Text.empty:t[n].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,t,n){this.from=e,this.to=t,this.flags=n}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let e=7&this.flags;return 7==e?null:e}get goalColumn(){let e=this.flags>>6;return 16777215==e?void 0:e}map(e,t=-1){let n,i;return this.empty?n=i=e.mapPos(this.from,t):(n=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),n==this.from&&i==this.to?this:new SelectionRange(n,i,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return EditorSelection.range(e,t);let n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return EditorSelection.range(this.anchor,n)}eq(e,t=!1){return!(this.anchor!=e.anchor||this.head!=e.head||t&&this.empty&&this.assoc!=e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,t,n){return new SelectionRange(e,t,n)}}class EditorSelection{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:EditorSelection.create(this.ranges.map((n=>n.map(e,t))),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(e.ranges[n],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new EditorSelection([this.main],0)}addRange(e,t=!0){return EditorSelection.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let n=this.ranges.slice();return n[t]=e,EditorSelection.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((e=>e.toJSON())),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map((e=>SelectionRange.fromJSON(e))),e.main)}static single(e,t=e){return new EditorSelection([EditorSelection.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let n=0,i=0;i<e.length;i++){let r=e[i];if(r.empty?r.from<=n:r.from<n)return EditorSelection.normalized(e.slice(),t);n=r.to}return new EditorSelection(e,t)}static cursor(e,t=0,n,i){return SelectionRange.create(e,e,(0==t?0:t<0?8:16)|(null==n?7:Math.min(6,n))|(null!=i?i:16777215)<<6)}static range(e,t,n,i){let r=(null!=n?n:16777215)<<6|(null==i?7:Math.min(6,i));return t<e?SelectionRange.create(t,e,48|r):SelectionRange.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let n=e[t];e.sort(((e,t)=>e.from-t.from)),t=e.indexOf(n);for(let n=1;n<e.length;n++){let i=e[n],r=e[n-1];if(i.empty?i.from<=r.to:i.from<r.to){let s=r.from,o=Math.max(i.to,r.to);n<=t&&t--,e.splice(--n,2,i.anchor>i.head?EditorSelection.range(o,s):EditorSelection.range(s,o))}}return new EditorSelection(e,t)}}function checkSelection(e,t){for(let n of e.ranges)if(n.to>t)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,t,n,i,r){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=i,this.id=nextID++,this.default=e([]),this.extensions="function"==typeof r?r(this):r}get reader(){return this}static define(e={}){return new Facet(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],(n=>t(n.field(e))))}}function sameArray$1(e,t){return e==t||e.length==t.length&&e.every(((e,n)=>e===t[n]))}class FacetProvider{constructor(e,t,n,i){this.dependencies=e,this.facet=t,this.type=n,this.value=i,this.id=nextID++}dynamicSlot(e){var t;let n=this.value,i=this.facet.compareInput,r=this.id,s=e[r]>>1,o=2==this.type,a=!1,l=!1,c=[];for(let n of this.dependencies)"doc"==n?a=!0:"selection"==n?l=!0:1&(null!==(t=e[n.id])&&void 0!==t?t:1)||c.push(e[n.id]);return{create:e=>(e.values[s]=n(e),1),update(e,t){if(a&&t.docChanged||l&&(t.docChanged||t.selection)||ensureAll(e,c)){let t=n(e);if(o?!compareArray(t,e.values[s],i):!i(t,e.values[s]))return e.values[s]=t,1}return 0},reconfigure:(e,t)=>{let a,l=t.config.address[r];if(null!=l){let r=getAddr(t,l);if(this.dependencies.every((n=>n instanceof Facet?t.facet(n)===e.facet(n):!(n instanceof StateField)||t.field(n,!1)==e.field(n,!1)))||(o?compareArray(a=n(e),r,i):i(a=n(e),r)))return e.values[s]=r,0}else a=n(e);return e.values[s]=a,1}}}}function compareArray(e,t,n){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function ensureAll(e,t){let n=!1;for(let i of t)1&ensureAddr(e,i)&&(n=!0);return n}function dynamicFacetSlot(e,t,n){let i=n.map((t=>e[t.id])),r=n.map((e=>e.type)),s=i.filter((e=>!(1&e))),o=e[t.id]>>1;function a(e){let n=[];for(let t=0;t<i.length;t++){let s=getAddr(e,i[t]);if(2==r[t])for(let e of s)n.push(e);else n.push(s)}return t.combine(n)}return{create(e){for(let t of i)ensureAddr(e,t);return e.values[o]=a(e),1},update(e,n){if(!ensureAll(e,s))return 0;let i=a(e);return t.compare(i,e.values[o])?0:(e.values[o]=i,1)},reconfigure(e,r){let s=ensureAll(e,i),l=r.config.facets[t.id],c=r.facet(t);if(l&&!s&&sameArray$1(n,l))return e.values[o]=c,0;let d=a(e);return t.compare(d,c)?(e.values[o]=c,0):(e.values[o]=d,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,t,n,i,r){this.id=e,this.createF=t,this.updateF=n,this.compareF=i,this.spec=r,this.provides=void 0}static define(e){let t=new StateField(nextID++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(initField).find((e=>e.field==this));return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,n)=>{let i=e.values[t],r=this.updateF(i,n);return this.compareF(i,r)?0:(e.values[t]=r,1)},reconfigure:(e,n)=>{let i,r=e.facet(initField),s=n.facet(initField);return(i=r.find((e=>e.field==this)))&&i!=s.find((e=>e.field==this))?(e.values[t]=i.create(e),1):null!=n.config.address[this.id]?(e.values[t]=n.field(this),0):(e.values[t]=this.create(e),1)}}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(e){return t=>new PrecExtension(t,e)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,t){this.inner=e,this.prec=t}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,t){this.compartment=e,this.inner=t}}class Configuration{constructor(e,t,n,i,r,s){for(this.base=e,this.compartments=t,this.dynamicSlots=n,this.address=i,this.staticValues=r,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,n){let i=[],r=Object.create(null),s=new Map;for(let n of flatten(e,t,s))n instanceof StateField?i.push(n):(r[n.facet.id]||(r[n.facet.id]=[])).push(n);let o=Object.create(null),a=[],l=[];for(let e of i)o[e.id]=l.length<<1,l.push((t=>e.slot(t)));let c=null==n?void 0:n.config.facets;for(let e in r){let t=r[e],i=t[0].facet,s=c&&c[e]||[];if(t.every((e=>0==e.type)))if(o[i.id]=a.length<<1|1,sameArray$1(s,t))a.push(n.facet(i));else{let e=i.combine(t.map((e=>e.value)));a.push(n&&i.compare(e,n.facet(i))?n.facet(i):e)}else{for(let e of t)0==e.type?(o[e.id]=a.length<<1|1,a.push(e.value)):(o[e.id]=l.length<<1,l.push((t=>e.dynamicSlot(t))));o[i.id]=l.length<<1,l.push((e=>dynamicFacetSlot(e,i,t)))}}let d=l.map((e=>e(o)));return new Configuration(e,s,d,o,a,r)}}function flatten(e,t,n){let i=[[],[],[],[],[]],r=new Map;return function e(s,o){let a=r.get(s);if(null!=a){if(a<=o)return;let e=i[a].indexOf(s);e>-1&&i[a].splice(e,1),s instanceof CompartmentInstance&&n.delete(s.compartment)}if(r.set(s,o),Array.isArray(s))for(let t of s)e(t,o);else if(s instanceof CompartmentInstance){if(n.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let i=t.get(s.compartment)||s.inner;n.set(s.compartment,i),e(i,o)}else if(s instanceof PrecExtension)e(s.inner,s.prec);else if(s instanceof StateField)i[o].push(s),s.provides&&e(s.provides,o);else if(s instanceof FacetProvider)i[o].push(s),s.facet.extensions&&e(s.facet.extensions,Prec_.default);else{let t=s.extension;if(!t)throw new Error("Unrecognized extension value in extension set ("+s+"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.");e(t,o)}}(e,Prec_.default),i.reduce(((e,t)=>e.concat(t)))}function ensureAddr(e,t){if(1&t)return 2;let n=t>>1,i=e.status[n];if(4==i)throw new Error("Cyclic dependency between fields and/or facets");if(2&i)return i;e.status[n]=4;let r=e.computeSlot(e,e.config.dynamicSlots[n]);return e.status[n]=2|r}function getAddr(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:e=>e.some((e=>e)),static:!0}),lineSeparator=Facet.define({combine:e=>e.length?e[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:e=>!!e.length&&e[0]});class Annotation{constructor(e,t){this.type=e,this.value=t}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new StateEffect(this.type,t)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let i of e){let e=i.map(t);e&&n.push(e)}return n}}StateEffect.reconfigure=StateEffect.define(),StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,t,n,i,r,s){this.startState=e,this.changes=t,this.selection=n,this.effects=i,this.annotations=r,this.scrollIntoView=s,this._doc=null,this._state=null,n&&checkSelection(n,t.newLength),r.some((e=>e.type==Transaction.time))||(this.annotations=r.concat(Transaction.time.of(Date.now())))}static create(e,t,n,i,r,s){return new Transaction(e,t,n,i,r,s)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Transaction.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function joinRanges(e,t){let n=[];for(let i=0,r=0;;){let s,o;if(i<e.length&&(r==t.length||t[r]>=e[i]))s=e[i++],o=e[i++];else{if(!(r<t.length))return n;s=t[r++],o=t[r++]}!n.length||n[n.length-1]<s?n.push(s,o):n[n.length-1]<o&&(n[n.length-1]=o)}}function mergeTransaction(e,t,n){var i;let r,s,o;return n?(r=t.changes,s=ChangeSet.empty(t.changes.length),o=e.changes.compose(t.changes)):(r=t.changes.map(e.changes),s=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(r)),{changes:o,selection:t.selection?t.selection.map(s):null===(i=e.selection)||void 0===i?void 0:i.map(r),effects:StateEffect.mapEffects(e.effects,r).concat(StateEffect.mapEffects(t.effects,s)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function resolveTransactionInner(e,t,n){let i=t.selection,r=asArray$2(t.annotations);return t.userEvent&&(r=r.concat(Transaction.userEvent.of(t.userEvent))),{changes:t.changes instanceof ChangeSet?t.changes:ChangeSet.of(t.changes||[],n,e.facet(lineSeparator)),selection:i&&(i instanceof EditorSelection?i:EditorSelection.single(i.anchor,i.head)),effects:asArray$2(t.effects),annotations:r,scrollIntoView:!!t.scrollIntoView}}function resolveTransaction(e,t,n){let i=resolveTransactionInner(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(n=!1);for(let r=1;r<t.length;r++){!1===t[r].filter&&(n=!1);let s=!!t[r].sequential;i=mergeTransaction(i,resolveTransactionInner(e,t[r],s?i.changes.newLength:e.doc.length),s)}let r=Transaction.create(e,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return extendTransaction(n?filterTransaction(r):r)}function filterTransaction(e){let t=e.startState,n=!0;for(let i of t.facet(changeFilter)){let t=i(e);if(!1===t){n=!1;break}Array.isArray(t)&&(n=!0===n?t:joinRanges(n,t))}if(!0!==n){let i,r;if(!1===n)r=e.changes.invertedDesc,i=ChangeSet.empty(t.doc.length);else{let t=e.changes.filter(n);i=t.changes,r=t.filtered.mapDesc(t.changes).invertedDesc}e=Transaction.create(t,i,e.selection&&e.selection.map(r),StateEffect.mapEffects(e.effects,r),e.annotations,e.scrollIntoView)}let i=t.facet(transactionFilter);for(let n=i.length-1;n>=0;n--){let r=i[n](e);e=r instanceof Transaction?r:Array.isArray(r)&&1==r.length&&r[0]instanceof Transaction?r[0]:resolveTransaction(t,asArray$2(r),!1)}return e}function extendTransaction(e){let t=e.startState,n=t.facet(transactionExtender),i=e;for(let r=n.length-1;r>=0;r--){let s=n[r](e);s&&Object.keys(s).length&&(i=mergeTransaction(i,resolveTransactionInner(t,s,e.changes.newLength),!0))}return i==e?e:Transaction.create(t,e.changes,e.selection,i.effects,i.annotations,i.scrollIntoView)}Transaction.time=Annotation.define(),Transaction.userEvent=Annotation.define(),Transaction.addToHistory=Annotation.define(),Transaction.remote=Annotation.define();const none$3=[];function asArray$2(e){return null==e?none$3:Array.isArray(e)?e:[e]}var CharCategory=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(e){}function hasWordChar(e){if(wordChar)return wordChar.test(e);for(let t=0;t<e.length;t++){let n=e[t];if(/\w/.test(n)||n>""&&(n.toUpperCase()!=n.toLowerCase()||nonASCIISingleCaseWordChar.test(n)))return!0}return!1}function makeCategorizer(e){return t=>{if(!/\S/.test(t))return CharCategory.Space;if(hasWordChar(t))return CharCategory.Word;for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,t,n,i,r,s){this.config=e,this.doc=t,this.selection=n,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=r,s&&(s._state=this);for(let e=0;e<this.config.dynamicSlots.length;e++)ensureAddr(this,e<<1);this.computeSlot=null}field(e,t=!0){let n=this.config.address[e.id];if(null!=n)return ensureAddr(this,n),getAddr(this,n);if(t)throw new RangeError("Field is not present in this state")}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let t,n=this.config,{base:i,compartments:r}=n;for(let t of e.effects)t.is(Compartment.reconfigure)?(n&&(r=new Map,n.compartments.forEach(((e,t)=>r.set(t,e))),n=null),r.set(t.value.compartment,t.value.extension)):t.is(StateEffect.reconfigure)?(n=null,i=t.value):t.is(StateEffect.appendConfig)&&(n=null,i=asArray$2(i).concat(t.value));n?t=e.startState.values.slice():(n=Configuration.resolve(i,r,this),t=new EditorState(n,this.doc,this.selection,n.dynamicSlots.map((()=>null)),((e,t)=>t.reconfigure(e,this)),null).values);let s=e.startState.facet(allowMultipleSelections)?e.newSelection:e.newSelection.asSingle();new EditorState(n,e.newDoc,s,t,((t,n)=>n.update(t,e)),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:e},range:EditorSelection.cursor(t.from+e.length)})))}changeByRange(e){let t=this.selection,n=e(t.ranges[0]),i=this.changes(n.changes),r=[n.range],s=asArray$2(n.effects);for(let n=1;n<t.ranges.length;n++){let o=e(t.ranges[n]),a=this.changes(o.changes),l=a.map(i);for(let e=0;e<n;e++)r[e]=r[e].map(l);let c=i.mapDesc(a,!0);r.push(o.range.map(c)),i=i.compose(l),s=StateEffect.mapEffects(s,l).concat(StateEffect.mapEffects(asArray$2(o.effects),c))}return{changes:i,selection:EditorSelection.create(r,t.mainIndex),effects:s}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(ensureAddr(this,t),getAddr(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let i=e[n];i instanceof StateField&&null!=this.config.address[i.id]&&(t[n]=i.spec.toJSON(this.field(e[n]),this))}return t}static fromJSON(e,t={},n){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(n)for(let t in n)if(Object.prototype.hasOwnProperty.call(e,t)){let r=n[t],s=e[t];i.push(r.init((e=>r.spec.fromJSON(s,e))))}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:t.extensions?i.concat([t.extensions]):i})}static create(e={}){let t=Configuration.resolve(e.extensions||[],new Map),n=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(t.staticFacet(EditorState.lineSeparator)||DefaultSplit)),i=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(i,n.length),t.staticFacet(allowMultipleSelections)||(i=i.asSingle()),new EditorState(t,n,i,t.dynamicSlots.map((()=>null)),((e,t)=>t.create(e)),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||"\n"}get readOnly(){return this.facet(readOnly)}phrase(e,...t){for(let t of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(t,e)){e=t[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,((e,n)=>{if("$"==n)return"$";let i=+(n||1);return!i||i>t.length?e:t[i-1]}))),e}languageDataAt(e,t,n=-1){let i=[];for(let r of this.facet(languageData))for(let s of r(this,t,n))Object.prototype.hasOwnProperty.call(s,e)&&i.push(s[e]);return i}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:n,length:i}=this.doc.lineAt(e),r=this.charCategorizer(e),s=e-n,o=e-n;for(;s>0;){let e=findClusterBreak(t,s,!1);if(r(t.slice(e,s))!=CharCategory.Word)break;s=e}for(;o<i;){let e=findClusterBreak(t,o);if(r(t.slice(o,e))!=CharCategory.Word)break;o=e}return s==o?null:EditorSelection.range(s+n,o+n)}}function combineConfig(e,t,n={}){let i={};for(let t of e)for(let e of Object.keys(t)){let r=t[e],s=i[e];if(void 0===s)i[e]=r;else if(s===r||void 0===r);else{if(!Object.hasOwnProperty.call(n,e))throw new Error("Config merge conflict for field "+e);i[e]=n[e](s,r)}}for(let e in t)void 0===i[e]&&(i[e]=t[e]);return i}EditorState.allowMultipleSelections=allowMultipleSelections,EditorState.tabSize=Facet.define({combine:e=>e.length?e[0]:4}),EditorState.lineSeparator=lineSeparator,EditorState.readOnly=readOnly,EditorState.phrases=Facet.define({compare(e,t){let n=Object.keys(e),i=Object.keys(t);return n.length==i.length&&n.every((n=>e[n]==t[n]))}}),EditorState.languageData=languageData,EditorState.changeFilter=changeFilter,EditorState.transactionFilter=transactionFilter,EditorState.transactionExtender=transactionExtender,Compartment.reconfigure=StateEffect.define();class RangeValue{eq(e){return this==e}range(e,t=e){return Range$1.create(e,t,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0,RangeValue.prototype.point=!1,RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class e{constructor(e,t,n){this.from=e,this.to=t,this.value=n}static create(t,n,i){return new e(t,n,i)}};function cmpRange(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Chunk{constructor(e,t,n,i){this.from=e,this.to=t,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,i=0){let r=n?this.to:this.from;for(let s=i,o=r.length;;){if(s==o)return s;let i=s+o>>1,a=r[i]-e||(n?this.value[i].endSide:this.value[i].startSide)-t;if(i==s)return a>=0?s:o;a>=0?o=i:s=i+1}}between(e,t,n,i){for(let r=this.findIndex(t,-1e9,!0),s=this.findIndex(n,1e9,!1,r);r<s;r++)if(!1===i(this.from[r]+e,this.to[r]+e,this.value[r]))return!1}map(e,t){let n=[],i=[],r=[],s=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,c,d=this.value[a],u=this.from[a]+e,h=this.to[a]+e;if(u==h){let e=t.mapPos(u,d.startSide,d.mapMode);if(null==e)continue;if(l=c=e,d.startSide!=d.endSide&&(c=t.mapPos(u,d.endSide),c<l))continue}else if(l=t.mapPos(u,d.startSide),c=t.mapPos(h,d.endSide),l>c||l==c&&d.startSide>0&&d.endSide<=0)continue;(c-l||d.endSide-d.startSide)<0||(s<0&&(s=l),d.point&&(o=Math.max(o,c-l)),n.push(d),i.push(l-s),r.push(c-s))}return{mapped:n.length?new Chunk(i,r,n,o):null,pos:s}}}class RangeSet{constructor(e,t,n,i){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=i}static create(e,t,n,i){return new RangeSet(e,t,n,i)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:i=0,filterTo:r=this.length}=e,s=e.filter;if(0==t.length&&!s)return this;if(n&&(t=t.slice().sort(cmpRange)),this.isEmpty)return t.length?RangeSet.of(t):this;let o=new LayerCursor(this,null,-1).goto(0),a=0,l=[],c=new RangeSetBuilder;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let e=t[a++];c.addInner(e.from,e.to,e.value)||l.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!s||i>this.chunkEnd(o.chunkIndex)||r<this.chunkPos[o.chunkIndex])&&c.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!s||i>o.to||r<o.from||s(o.from,o.to,o.value))&&(c.addInner(o.from,o.to,o.value)||l.push(Range$1.create(o.from,o.to,o.value))),o.next());return c.finishInner(this.nextLayer.isEmpty&&!l.length?RangeSet.empty:this.nextLayer.update({add:l,filter:s,filterFrom:i,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],i=-1;for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r],a=e.touchesRange(s,s+o.length);if(!1===a)i=Math.max(i,o.maxPoint),t.push(o),n.push(e.mapPos(s));else if(!0===a){let{mapped:r,pos:a}=o.map(s,e);r&&(i=Math.max(i,r.maxPoint),t.push(r),n.push(a))}}let r=this.nextLayer.map(e);return 0==t.length?r:new RangeSet(n,t,r||RangeSet.empty,i)}between(e,t,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let r=this.chunkPos[i],s=this.chunk[i];if(t>=r&&e<=r+s.length&&!1===s.between(r,e-r,t-r,n))return}this.nextLayer.between(e,t,n)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return HeapCursor.from(e).goto(t)}static compare(e,t,n,i,r=-1){let s=e.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r)),o=t.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r)),a=findSharedChunks(s,o,n),l=new SpanCursor(s,a,r),c=new SpanCursor(o,a,r);n.iterGaps(((e,t,n)=>compare(l,e,c,t,n,i))),n.empty&&0==n.length&&compare(l,0,c,0,0,i)}static eq(e,t,n=0,i){null==i&&(i=999999999);let r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0)),s=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0));if(r.length!=s.length)return!1;if(!r.length)return!0;let o=findSharedChunks(r,s),a=new SpanCursor(r,o,0).goto(n),l=new SpanCursor(s,o,0).goto(n);for(;;){if(a.to!=l.to||!sameValues(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>i)return!0;a.next(),l.next()}}static spans(e,t,n,i,r=-1){let s=new SpanCursor(e,null,r).goto(t),o=t,a=s.openStart;for(;;){let e=Math.min(s.to,n);if(s.point){let n=s.activeForPoint(s.to),r=s.pointFrom<t?n.length+1:s.point.startSide<0?n.length:Math.min(n.length,a);i.point(o,e,s.point,n,r,s.pointRank),a=Math.min(s.openEnd(e),n.length)}else e>o&&(i.span(o,e,s.active,a),a=s.openEnd(e));if(s.to>n)return a+(s.point&&s.to>n?1:0);o=s.to,s.next()}}static of(e,t=!1){let n=new RangeSetBuilder;for(let i of e instanceof Range$1?[e]:t?lazySort(e):e)n.add(i.from,i.to,i.value);return n.finish()}static join(e){if(!e.length)return RangeSet.empty;let t=e[e.length-1];for(let n=e.length-2;n>=0;n--)for(let i=e[n];i!=RangeSet.empty;i=i.nextLayer)t=new RangeSet(i.chunkPos,i.chunk,t,Math.max(i.maxPoint,t.maxPoint));return t}}function lazySort(e){if(e.length>1)for(let t=e[0],n=1;n<e.length;n++){let i=e[n];if(cmpRange(t,i)>0)return e.slice().sort(cmpRange);t=i}return e}RangeSet.empty=new RangeSet([],[],null,-1),RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,t,n)}addInner(e,t,n){let i=e-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(i<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),0))}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function findSharedChunks(e,t,n){let i=new Map;for(let t of e)for(let e=0;e<t.chunk.length;e++)t.chunk[e].maxPoint<=0&&i.set(t.chunk[e],t.chunkPos[e]);let r=new Set;for(let e of t)for(let t=0;t<e.chunk.length;t++){let s=i.get(e.chunk[t]);null==s||(n?n.mapPos(s):s)!=e.chunkPos[t]||(null==n?void 0:n.touchesRange(s,s+e.chunk[t].length))||r.add(e.chunk[t])}return r}class LayerCursor{constructor(e,t,n,i=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,t=null,n=-1){let i=[];for(let r=0;r<e.length;r++)for(let s=e[r];!s.isEmpty;s=s.nextLayer)s.maxPoint>=n&&i.push(new LayerCursor(s,t,n,r));return 1==i.length?i[0]:new HeapCursor(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let e=this.heap.length>>1;e>=0;e--)heapBubble(this.heap,e);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let e=this.heap.length>>1;e>=0;e--)heapBubble(this.heap,e);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(e,t){for(let n=e[t];;){let i=1+(t<<1);if(i>=e.length)break;let r=e[i];if(i+1<e.length&&r.compare(e[i+1])>=0&&(r=e[i+1],i++),n.compare(r)<0)break;e[i]=n,e[t]=r,t=i}}class SpanCursor{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:i,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||i-this.activeTo[t])>0;)t++;insert(this.active,t,n),insert(this.activeTo,t,i),insert(this.activeRank,t,r),e&&insert(e,t,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),n&&remove(n,i)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let e=this.cursor.value;if(e.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=e,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=e.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(n),this.cursor.next()}}}if(n){this.openStart=0;for(let t=n.length-1;t>=0&&n[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}}function compare(e,t,n,i,r,s){e.goto(t),n.goto(i);let o=i+r,a=i,l=i-t;for(;;){let t=e.to+l-n.to,i=t||e.endSide-n.endSide,r=i<0?e.to+l:n.to,c=Math.min(r,o);if(e.point||n.point?e.point&&n.point&&(e.point==n.point||e.point.eq(n.point))&&sameValues(e.activeForPoint(e.to),n.activeForPoint(n.to))||s.comparePoint(a,c,e.point,n.point):c>a&&!sameValues(e.active,n.active)&&s.compareRange(a,c,e.active,n.active),r>o)break;(t||e.openEnd!=n.openEnd)&&s.boundChange&&s.boundChange(r),a=r,i<=0&&e.next(),i>=0&&n.next()}}function sameValues(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n]&&!e[n].eq(t[n]))return!1;return!0}function remove(e,t){for(let n=t,i=e.length-1;n<i;n++)e[n]=e[n+1];e.pop()}function insert(e,t,n){for(let n=e.length-1;n>=t;n--)e[n+1]=e[n];e[t]=n}function findMinIndex(e,t){let n=-1,i=1e9;for(let r=0;r<t.length;r++)(t[r]-i||e[r].endSide-e[n].endSide)<0&&(n=r,i=t[r]);return n}function countColumn(e,t,n=e.length){let i=0;for(let r=0;r<n&&r<e.length;)9==e.charCodeAt(r)?(i+=t-i%t,r++):(i++,r=findClusterBreak(e,r));return i}function findColumn(e,t,n,i){for(let i=0,r=0;;){if(r>=t)return i;if(i==e.length)break;r+=9==e.charCodeAt(i)?n-r%n:1,i=findClusterBreak(e,i)}return!0===i?-1:e.length}const C="ͼ",COUNT="undefined"==typeof Symbol?"__"+C:Symbol.for(C),SET="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),top="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class StyleModule{constructor(e,t){this.rules=[];let{finish:n}=t||{};function i(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function r(e,t,s,o){let a=[],l=/^@(\w+)\b/.exec(e[0]),c=l&&"keyframes"==l[1];if(l&&null==t)return s.push(e[0]+";");for(let n in t){let o=t[n];if(/&/.test(n))r(n.split(/,\s*/).map((t=>e.map((e=>t.replace(/&/,e))))).reduce(((e,t)=>e.concat(t))),o,s);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+n+") should be a primitive value.");r(i(n),o,a,c)}else null!=o&&a.push(n.replace(/_.*/,"").replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))+": "+o+";")}(a.length||c)&&s.push((!n||l||o?e:e.map(n)).join(", ")+" {"+a.join(" ")+"}")}for(let t in e)r(i(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,t,n){let i=e[SET],r=n&&n.nonce;i?r&&i.setNonce(r):i=new StyleSet(e,r),i.mount(Array.isArray(t)?t:[t],e)}}let adoptedSet=new Map;class StyleSet{constructor(e,t){let n=e.ownerDocument||e,i=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let t=adoptedSet.get(n);if(t)return e[SET]=t;this.sheet=new i.CSSStyleSheet,adoptedSet.set(n,this)}else this.styleTag=n.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[SET]=this}mount(e,t){let n=this.sheet,i=0,r=0;for(let t=0;t<e.length;t++){let s=e[t],o=this.modules.indexOf(s);if(o<r&&o>-1&&(this.modules.splice(o,1),r--,o=-1),-1==o){if(this.modules.splice(r++,0,s),n)for(let e=0;e<s.rules.length;e++)n.insertRule(s.rules[e],i++)}else{for(;r<o;)i+=this.modules[r++].rules.length;i+=s.rules.length,r++}}if(n)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let n=t.head||t;this.styleTag.parentNode!=n&&n.insertBefore(this.styleTag,n.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var base$2={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ie$1="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i=0;i<10;i++)base$2[48+i]=base$2[96+i]=String(i);for(var i=1;i<=24;i++)base$2[i+111]="F"+i;for(var i=65;i<=90;i++)base$2[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base$2)shift.hasOwnProperty(code)||(shift[code]=base$2[code]);function keyName(e){var t=!(mac&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||ie$1&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?shift:base$2)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}function getSelection(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function contains(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function hasSelection(e,t){if(!t.anchorNode)return!1;try{return contains(e,t.anchorNode)}catch(e){return!1}}function clientRectsFor(e){return 3==e.nodeType?textRange(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function isEquivalentPosition(e,t,n,i){return!!n&&(scanFor(e,t,n,i,-1)||scanFor(e,t,n,i,1))}function domIndex(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function isBlockElement(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}function scanFor(e,t,n,i,r){for(;;){if(e==n&&t==i)return!0;if(t==(r<0?0:maxOffset(e))){if("DIV"==e.nodeName)return!1;let n=e.parentNode;if(!n||1!=n.nodeType)return!1;t=domIndex(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(r<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=r<0?maxOffset(e):0}}}function maxOffset(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function flattenRect(e,t){let n=t?e.left:e.right;return{left:n,right:n,top:e.top,bottom:e.bottom}}function windowRect(e){let t=e.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function getScale(e,t){let n=t.width/e.offsetWidth,i=t.height/e.offsetHeight;return(n>.995&&n<1.005||!isFinite(n)||Math.abs(t.width-e.offsetWidth)<1)&&(n=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.height-e.offsetHeight)<1)&&(i=1),{scaleX:n,scaleY:i}}function scrollRectIntoView(e,t,n,i,r,s,o,a){let l=e.ownerDocument,c=l.defaultView||window;for(let d=e,u=!1;d&&!u;)if(1==d.nodeType){let e,h=d==l.body,m=1,g=1;if(h)e=windowRect(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(d).position)&&(u=!0),d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth){d=d.assignedSlot||d.parentNode;continue}let t=d.getBoundingClientRect();({scaleX:m,scaleY:g}=getScale(d,t)),e={left:t.left,right:t.left+d.clientWidth*m,top:t.top,bottom:t.top+d.clientHeight*g}}let p=0,f=0;if("nearest"==r)t.top<e.top?(f=-(e.top-t.top+o),n>0&&t.bottom>e.bottom+f&&(f=t.bottom-e.bottom+f+o)):t.bottom>e.bottom&&(f=t.bottom-e.bottom+o,n<0&&t.top-f<e.top&&(f=-(e.top+f-t.top+o)));else{let i=t.bottom-t.top,s=e.bottom-e.top;f=("center"==r&&i<=s?t.top+i/2-s/2:"start"==r||"center"==r&&n<0?t.top-o:t.bottom-s+o)-e.top}if("nearest"==i?t.left<e.left?(p=-(e.left-t.left+s),n>0&&t.right>e.right+p&&(p=t.right-e.right+p+s)):t.right>e.right&&(p=t.right-e.right+s,n<0&&t.left<e.left+p&&(p=-(e.left+p-t.left+s))):p=("center"==i?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==i==a?t.left-s:t.right-(e.right-e.left)+s)-e.left,p||f)if(h)c.scrollBy(p,f);else{let e=0,n=0;if(f){let e=d.scrollTop;d.scrollTop+=f/g,n=(d.scrollTop-e)*g}if(p){let t=d.scrollLeft;d.scrollLeft+=p/m,e=(d.scrollLeft-t)*m}t={left:t.left-e,top:t.top-n,right:t.right-e,bottom:t.bottom-n},e&&Math.abs(e-p)<1&&(i="nearest"),n&&Math.abs(n-f)<1&&(r="nearest")}if(h)break;d=d.assignedSlot||d.parentNode}else{if(11!=d.nodeType)break;d=d.host}}function scrollableParents(e){let t,n,i=e.ownerDocument;for(let r=e.parentNode;r&&!(r==i.body||t&&n);)if(1==r.nodeType)!n&&r.scrollHeight>r.clientHeight&&(n=r),!t&&r.scrollWidth>r.clientWidth&&(t=r),r=r.assignedSlot||r.parentNode;else{if(11!=r.nodeType)break;r=r.host}return{x:t,y:n}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:n}=e;this.set(t,Math.min(e.anchorOffset,t?maxOffset(t):0),n,Math.min(e.focusOffset,n?maxOffset(n):0))}set(e,t,n,i){this.anchorNode=e,this.anchorOffset=t,this.focusNode=n,this.focusOffset=i}}let preventScrollSupported=null,scratchRange;function focusPreventScroll(e){if(e.setActive)return e.setActive();if(preventScrollSupported)return e.focus(preventScrollSupported);let t=[];for(let n=e;n&&(t.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(e.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let e=0;e<t.length;){let n=t[e++],i=t[e++],r=t[e++];n.scrollTop!=i&&(n.scrollTop=i),n.scrollLeft!=r&&(n.scrollLeft=r)}}}function textRange(e,t,n=t){let i=scratchRange||(scratchRange=document.createRange());return i.setEnd(e,n),i.setStart(e,t),i}function dispatchKey(e,t,n,i){let r={key:t,code:t,keyCode:n,which:n,cancelable:!0};i&&({altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey}=i);let s=new KeyboardEvent("keydown",r);s.synthetic=!0,e.dispatchEvent(s);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,e.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function getRoot(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}function clearAttributes(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}function atElementStart(e,t){let n=t.focusNode,i=t.focusOffset;if(!n||t.anchorNode!=n||t.anchorOffset!=i)return!1;for(i=Math.min(i,maxOffset(n));;)if(i){if(1!=n.nodeType)return!1;let e=n.childNodes[i-1];"false"==e.contentEditable?i--:(n=e,i=maxOffset(n))}else{if(n==e)return!0;i=domIndex(n),n=n.parentNode}}function isScrolledToBottom(e){return e.scrollTop>Math.max(1,e.scrollHeight-e.clientHeight-4)}function textNodeBefore(e,t){for(let n=e,i=t;;){if(3==n.nodeType&&i>0)return{node:n,offset:i};if(1==n.nodeType&&i>0){if("false"==n.contentEditable)return null;n=n.childNodes[i-1],i=maxOffset(n)}else{if(!n.parentNode||isBlockElement(n))return null;i=domIndex(n),n=n.parentNode}}}function textNodeAfter(e,t){for(let n=e,i=t;;){if(3==n.nodeType&&i<n.nodeValue.length)return{node:n,offset:i};if(1==n.nodeType&&i<n.childNodes.length){if("false"==n.contentEditable)return null;n=n.childNodes[i],i=0}else{if(!n.parentNode||isBlockElement(n))return null;i=domIndex(n)+1,n=n.parentNode}}}class DOMPos{constructor(e,t,n=!0){this.node=e,this.offset=t,this.precise=n}static before(e,t){return new DOMPos(e.parentNode,domIndex(e),t)}static after(e,t){return new DOMPos(e.parentNode,domIndex(e)+1,t)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(2&this.flags){let n,i=this.dom,r=null;for(let s of this.children){if(7&s.flags){if(!s.dom&&(n=r?r.nextSibling:i.firstChild)){let e=ContentView.get(n);(!e||!e.parent&&e.canReuseDOM(s))&&s.reuseDOM(n)}s.sync(e,t),s.flags&=-8}if(n=r?r.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&n!=s.dom&&(t.written=!0),s.dom.parentNode==i)for(;n&&n!=s.dom;)n=rm$1(n);else i.insertBefore(s.dom,n);r=s.dom}for(n=r?r.nextSibling:i.firstChild,n&&t&&t.node==i&&(t.written=!0);n;)n=rm$1(n)}else if(1&this.flags)for(let n of this.children)7&n.flags&&(n.sync(e,t),n.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let i=0==maxOffset(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==i&&t.firstChild!=t.lastChild&&(i=e==t.firstChild?-1:1),e=t}n=i<0?e:e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!ContentView.get(n);)n=n.nextSibling;if(!n)return this.length;for(let e=0,t=0;;e++){let i=this.children[e];if(i.dom==n)return t;t+=i.length+i.breakAfter}}domBoundsAround(e,t,n=0){let i=-1,r=-1,s=-1,o=-1;for(let a=0,l=n,c=n;a<this.children.length;a++){let n=this.children[a],d=l+n.length;if(l<e&&d>t)return n.domBoundsAround(e,t,l);if(d>=e&&-1==i&&(i=a,r=l),l>t&&n.dom.parentNode==this.dom){s=a,o=c;break}c=d,l=d+n.breakAfter}return{from:r,to:o<0?n+this.length:o,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),1&t.flags)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,7&this.flags&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=noChildren){this.markDirty();for(let i=e;i<t;i++){let e=this.children[i];e.parent==this&&n.indexOf(e)<0&&e.destroy()}n.length<250?this.children.splice(e,t-e,...n):this.children=[].concat(this.children.slice(0,e),n,this.children.slice(t));for(let e=0;e<n.length;e++)n[e].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,n,i,r,s){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!(8&(this.flags|e.flags))}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}function rm$1(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}ContentView.prototype.breakAfter=0;class ChildCursor{constructor(e,t,n){this.children=e,this.pos=t,this.i=n,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function replaceRange(e,t,n,i,r,s,o,a,l){let{children:c}=e,d=c.length?c[t]:null,u=s.length?s[s.length-1]:null,h=u?u.breakAfter:o;if(!(t==i&&d&&!o&&!h&&s.length<2&&d.merge(n,r,s.length?u:null,0==n,a,l))){if(i<c.length){let e=c[i];e&&(r<e.length||e.breakAfter&&(null==u?void 0:u.breakAfter))?(t==i&&(e=e.split(r),r=0),!h&&u&&e.merge(0,r,u,!0,0,l)?s[s.length-1]=e:((r||e.children.length&&!e.children[0].length)&&e.merge(0,r,null,!1,0,l),s.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),i++}for(d&&(d.breakAfter=o,n>0&&(!o&&s.length&&d.merge(n,d.length,s[0],!1,a,0)?d.breakAfter=s.shift().breakAfter:(n<d.length||d.children.length&&0==d.children[d.children.length-1].length)&&d.merge(n,d.length,null,!1,a,0),t++));t<i&&s.length;)if(c[i-1].become(s[s.length-1]))i--,s.pop(),l=s.length?0:a;else{if(!c[t].become(s[0]))break;t++,s.shift(),a=s.length?0:l}!s.length&&t&&i<c.length&&!c[t-1].breakAfter&&c[i].merge(0,0,c[t-1],!1,a,l)&&t--,(t<i||s.length)&&e.replaceChildren(t,i,s)}}function mergeChildrenInto(e,t,n,i,r,s){let o=e.childCursor(),{i:a,off:l}=o.findPos(n,1),{i:c,off:d}=o.findPos(t,-1),u=t-n;for(let e of i)u+=e.length;e.length+=u,replaceRange(e,c,d,a,l,i,0,r,s)}let nav="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},doc="undefined"!=typeof document?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:ios,android:/Android\b/.test(nav.userAgent),webkit:webkit,safari:safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:null!=doc.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,n){return!(8&this.flags||n&&(!(n instanceof TextView)||this.length-(t-e)+n.length>MaxJoinLen||8&n.flags)||(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),0))}split(e){let t=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=8&this.flags,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return textCoords(this.dom,e,t)}}class MarkView extends ContentView{constructor(e,t=[],n=0){super(),this.mark=e,this.children=t,this.length=n;for(let e of t)e.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!(8&(this.flags|e.flags))}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,n,i,r,s){return!(n&&(!(n instanceof MarkView&&n.mark.eq(this.mark))||e&&r<=0||t<this.length&&s<=0)||(mergeChildrenInto(this,e,t,n?n.children.slice():[],r-1,s-1),this.markDirty(),0))}split(e){let t=[],n=0,i=-1,r=0;for(let s of this.children){let o=n+s.length;o>e&&t.push(n<e?s.split(e-n):s),i<0&&n>=e&&(i=r),n=o,r++}let s=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new MarkView(this.mark,t,s)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,t){return coordsInChildren(this,e,t)}}function textCoords(e,t,n){let i=e.nodeValue.length;t>i&&(t=i);let r=t,s=t,o=0;0==t&&n<0||t==i&&n>=0?browser.chrome||browser.gecko||(t?(r--,o=1):s<i&&(s++,o=-1)):n<0?r--:s<i&&s++;let a=textRange(e,r,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:n>=0)?0:a.length-1];return browser.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,(e=>e.width))||l),o?flattenRect(l,o<0):l||null}class WidgetView extends ContentView{static create(e,t,n){return new WidgetView(e,t,n)}constructor(e,t,n){super(),this.widget=e,this.length=t,this.side=n,this.prevWidget=null}split(e){let t=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,n,i,r,s){return!(n&&(!(n instanceof WidgetView&&this.widget.compare(n.widget))||e>0&&r<=0||t<this.length&&s<=0)||(this.length=e+(n?n.length:0)+(this.length-t),0))}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,n=t&&t.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):Text.empty}domAtPos(e){return(this.length?0==e:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;let i=this.dom.getClientRects(),r=null;if(!i.length)return null;let s=this.side?this.side<0:e>0;for(let t=s?i.length-1:0;r=i[t],!(e>0?0==t:t==i.length-1||r.top<r.bottom);t+=s?-1:1);return flattenRect(r,!s)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}function inlineDOMAtPos(e,t){let n=e.dom,{children:i}=e,r=0;for(let e=0;r<i.length;r++){let s=i[r],o=e+s.length;if(!(o==e&&s.getSide()<=0)){if(t>e&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-e);if(t<=e)break;e=o}}for(let e=r;e>0;e--){let t=i[e-1];if(t.dom.parentNode==n)return t.domAtPos(t.length)}for(let e=r;e<i.length;e++){let t=i[e];if(t.dom.parentNode==n)return t.domAtPos(0)}return new DOMPos(n,0)}function joinInlineInto(e,t,n){let i,{children:r}=e;n>0&&t instanceof MarkView&&r.length&&(i=r[r.length-1])instanceof MarkView&&i.mark.eq(t.mark)?joinInlineInto(i,t.children[0],n-1):(r.push(t),t.setParent(e)),e.length+=t.length}function coordsInChildren(e,t,n){let i=null,r=-1,s=null,o=-1;!function e(t,a){for(let l=0,c=0;l<t.children.length&&c<=a;l++){let d=t.children[l],u=c+d.length;u>=a&&(d.children.length?e(d,a-c):(!s||s.isHidden&&n>0)&&(u>a||c==u&&d.getSide()>0)?(s=d,o=a-c):(c<a||c==u&&d.getSide()<0&&!d.isHidden)&&(i=d,r=a-c)),c=u}}(e,t);let a=(n<0?i:s)||i||s;return a?a.coordsAt(Math.max(0,a==i?r:o),n):fallbackRect(e)}function fallbackRect(e){let t=e.dom.lastChild;if(!t)return e.dom.getBoundingClientRect();let n=clientRectsFor(t);return n[n.length-1]||null}function combineAttrs(e,t){for(let n in e)"class"==n&&t.class?t.class+=" "+e.class:"style"==n&&t.style?t.style+=";"+e.style:t[n]=e[n];return t}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;const noAttrs$1=Object.create(null);function attrsEq(e,t,n){if(e==t)return!0;e||(e=noAttrs$1),t||(t=noAttrs$1);let i=Object.keys(e),r=Object.keys(t);if(i.length-(n&&i.indexOf(n)>-1?1:0)!=r.length-(n&&r.indexOf(n)>-1?1:0))return!1;for(let s of i)if(s!=n&&(-1==r.indexOf(s)||e[s]!==t[s]))return!1;return!0}function updateAttrs(e,t,n){let i=!1;if(t)for(let r in t)n&&r in n||(i=!0,"style"==r?e.style.cssText="":e.removeAttribute(r));if(n)for(let r in n)t&&t[r]==n[r]||(i=!0,"style"==r?e.style.cssText=n[r]:e.setAttribute(r,n[r]));return i}function getAttrs$1(e){let t=Object.create(null);for(let n=0;n<e.attributes.length;n++){let i=e.attributes[n];t[i.name]=i.value}return t}class WidgetType{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var BlockType=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,t,n,i){super(),this.startSide=e,this.endSide=t,this.widget=n,this.spec=i}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),n=!!e.block;return t+=n&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new PointDecoration(e,t,t,n,e.widget||null,!1)}static replace(e){let t,n,i=!!e.block;if(e.isBlockGap)t=-5e8,n=4e8;else{let{start:r,end:s}=getInclusive(e,i);t=(r?i?-3e8:-1:5e8)-1,n=1+(s?i?2e8:1:-6e8)}return new PointDecoration(e,t,n,i,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,t=!1){return RangeSet.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:t,end:n}=getInclusive(e);super(t?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,n;return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&(this.class||(null===(t=this.attrs)||void 0===t?void 0:t.class))==(e.class||(null===(n=e.attrs)||void 0===n?void 0:n.class))&&attrsEq(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore,LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,t,n,i,r,s){super(t,n,r,e),this.block=i,this.isReplace=s,this.mapMode=i?t<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function getInclusive(e,t=!1){let{inclusiveStart:n,inclusiveEnd:i}=e;return null==n&&(n=e.inclusive),null==i&&(i=e.inclusive),{start:null!=n?n:t,end:null!=i?i:t}}function widgetsEq(e,t){return e==t||!!(e&&t&&e.compare(t))}function addRange(e,t,n,i=0){let r=n.length-1;r>=0&&n[r]+i>=e?n[r]=Math.max(n[r],t):n.push(e,t)}PointDecoration.prototype.point=!0;class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,n,i,r,s){if(n){if(!(n instanceof LineView))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),mergeChildrenInto(this,e,t,n?n.children.slice():[],r,s),!0}split(e){let t=new LineView;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i:n,off:i}=this.childPos(e);i&&(t.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let e=n;e<this.children.length;e++)t.append(this.children[e],0);for(;n>0&&0==this.children[n-1].length;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){joinInlineInto(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=combineAttrs(t,this.attrs||{})),n&&(this.attrs=combineAttrs({class:n},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.flags|=6)}sync(e,t){var n;this.dom?4&this.flags&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let i=this.dom.lastChild;for(;i&&ContentView.get(i)instanceof MarkView;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(n=ContentView.get(i))||void 0===n?void 0:n.isEditable)||browser.ios&&this.children.some((e=>e instanceof TextView))))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e,t=0;for(let n of this.children){if(!(n instanceof TextView)||/[^ -~]/.test(n.text))return null;let i=clientRectsFor(n.dom);if(1!=i.length)return null;t+=i[0].width,e=i[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(e,t){let n=coordsInChildren(this,e,t);if(!this.children.length&&n&&this.parent){let{heightOracle:e}=this.parent.view.viewState,t=n.bottom-n.top;if(Math.abs(t-e.lineHeight)<2&&e.textHeight<t){let i=(t-e.textHeight)/2;return{top:n.top+i,bottom:n.bottom-i,left:n.left,right:n.left}}}return n}become(e){return e instanceof LineView&&0==this.children.length&&0==e.children.length&&attrsEq(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let n=0,i=0;n<e.children.length;n++){let r=e.children[n],s=i+r.length;if(s>=t){if(r instanceof LineView)return r;if(s>t)break}i=s+r.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,t,n){super(),this.widget=e,this.length=t,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(e,t,n,i,r,s){return!(n&&(!(n instanceof BlockWidgetView&&this.widget.compare(n.widget))||e>0&&r<=0||t<this.length&&s<=0)||(this.length=e+(n?n.length:0)+(this.length-t),0))}domAtPos(e){return 0==e?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let n=new BlockWidgetView(this.widget,t,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return noChildren}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor&&(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)||(this.widget instanceof BlockGapWidget?null:flattenRect(this.dom.getBoundingClientRect(),this.length?0==e:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:n}=this.deco;return t!=n&&(e<0?t<0:n>0)}}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class ContentBuilder{constructor(e,t,n,i){this.doc=e,this.pos=t,this.end=n,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof BlockWidgetView&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||e&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView||this.getLine()}buildText(e,t,n){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:n,done:i}=this.cursor.next(this.skip);if(this.skip=0,i)throw new Error("Ran out of text content when drawing inline views");if(n){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}this.text=t,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-n)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+i)),t),n),this.atCursorPos=!0,this.textOff+=i,e-=i,n=0}}span(e,t,n,i){this.buildText(t-e,n,i),this.pos=t,this.openStart<0&&(this.openStart=i)}point(e,t,n,i,r,s){if(this.disallowBlockEffectsFor[s]&&n instanceof PointDecoration){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(n instanceof PointDecoration)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(n.widget||NullWidget.block,o,n));else{let s=WidgetView.create(n.widget||NullWidget.inline,o,o?0:n.startSide),a=this.atCursorPos&&!s.isEditable&&r<=i.length&&(e<t||n.startSide>0),l=!s.isEditable&&(e<t||r>i.length||n.startSide<=0),c=this.getLine();2!=this.pendingBuffer||a||s.isEditable||(this.pendingBuffer=0),this.flushBuffer(i),a&&(c.append(wrapMarks(new WidgetBufferView(1),i),r),r=i.length+Math.max(0,r-i.length)),c.append(wrapMarks(s,i),r),this.atCursorPos=l,this.pendingBuffer=l?e<t||r>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,n,i,r){let s=new ContentBuilder(e,t,n,r);return s.openEnd=RangeSet.spans(i,t,n,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}}function wrapMarks(e,t){for(let n of t)e=new MarkView(n,[e],e.length);return e}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span"),NullWidget.block=new NullWidget("div");var Direction=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(e){let t=[];for(let n=0;n<e.length;n++)t.push(1<<+e[n]);return t}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),n=e.charCodeAt(1);Brackets[t]=n,Brackets[n]=-t}function charType(e){return e<=247?LowTypes[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?ArabicTypes[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8204?256:64336<=e&&e<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,t,n){this.from=e,this.to=t,this.level=n}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,n,i){let r=-1;for(let s=0;s<e.length;s++){let o=e[s];if(o.from<=t&&o.to>=t){if(o.level==n)return s;(r<0||(0!=i?i<0?o.from<t:o.to>t:e[r].level>o.level))&&(r=s)}}if(r<0)throw new RangeError("Index out of range");return r}}function isolatesEq(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let i=e[n],r=t[n];if(i.from!=r.from||i.to!=r.to||i.direction!=r.direction||!isolatesEq(i.inner,r.inner))return!1}return!0}const types=[];function computeCharTypes(e,t,n,i,r){for(let s=0;s<=i.length;s++){let o=s?i[s-1].to:t,a=s<i.length?i[s].from:n,l=s?256:r;for(let t=o,n=l,i=l;t<a;t++){let r=charType(e.charCodeAt(t));512==r?r=n:8==r&&4==i&&(r=16),types[t]=4==r?2:r,7&r&&(i=r),n=r}for(let e=o,t=l,i=l;e<a;e++){let r=types[e];if(128==r)e<a-1&&t==types[e+1]&&24&t?r=types[e]=t:types[e]=256;else if(64==r){let r=e+1;for(;r<a&&64==types[r];)r++;let s=e&&8==t||r<n&&8==types[r]?1==i?1:8:256;for(let t=e;t<r;t++)types[t]=s;e=r-1}else 8==r&&1==i&&(types[e]=1);t=r,7&r&&(i=r)}}}function processBracketPairs(e,t,n,i,r){let s=1==r?2:1;for(let o=0,a=0,l=0;o<=i.length;o++){let c=o?i[o-1].to:t,d=o<i.length?i[o].from:n;for(let t,n,i,o=c;o<d;o++)if(n=Brackets[t=e.charCodeAt(o)])if(n<0){for(let e=a-3;e>=0;e-=3)if(BracketStack[e+1]==-n){let t=BracketStack[e+2],n=2&t?r:4&t?1&t?s:r:0;n&&(types[o]=types[BracketStack[e]]=n),a=e;break}}else{if(189==BracketStack.length)break;BracketStack[a++]=o,BracketStack[a++]=t,BracketStack[a++]=l}else if(2==(i=types[o])||1==i){let e=i==r;l=e?0:1;for(let t=a-3;t>=0;t-=3){let n=BracketStack[t+2];if(2&n)break;if(e)BracketStack[t+2]|=2;else{if(4&n)break;BracketStack[t+2]|=4}}}}}function processNeutrals(e,t,n,i){for(let r=0,s=i;r<=n.length;r++){let o=r?n[r-1].to:e,a=r<n.length?n[r].from:t;for(let l=o;l<a;){let o=types[l];if(256==o){let o=l+1;for(;;)if(o==a){if(r==n.length)break;o=n[r++].to,a=r<n.length?n[r].from:t}else{if(256!=types[o])break;o++}let c=1==s,d=c==(1==(o<t?types[o]:i))?c?1:2:i;for(let t=o,i=r,s=i?n[i-1].to:e;t>l;)t==s&&(t=n[--i].from,s=i?n[i-1].to:e),types[--t]=d;l=o}else s=o,l++}}}function emitSpans(e,t,n,i,r,s,o){let a=i%2?2:1;if(i%2==r%2)for(let l=t,c=0;l<n;){let t=!0,d=!1;if(c==s.length||l<s[c].from){let e=types[l];e!=a&&(t=!1,d=16==e)}let u=t||1!=a?null:[],h=t?i:i+1,m=l;e:for(;;)if(c<s.length&&m==s[c].from){if(d)break e;let g=s[c];if(!t)for(let e=g.to,t=c+1;;){if(e==n)break e;if(!(t<s.length&&s[t].from==e)){if(types[e]==a)break e;break}e=s[t++].to}c++,u?u.push(g):(g.from>l&&o.push(new BidiSpan(l,g.from,h)),computeSectionOrder(e,g.direction==LTR!=!(h%2)?i+1:i,r,g.inner,g.from,g.to,o),l=g.to),m=g.to}else{if(m==n||(t?types[m]!=a:types[m]==a))break;m++}u?emitSpans(e,l,m,i+1,r,u,o):l<m&&o.push(new BidiSpan(l,m,h)),l=m}else for(let l=n,c=s.length;l>t;){let n=!0,d=!1;if(!c||l>s[c-1].to){let e=types[l-1];e!=a&&(n=!1,d=16==e)}let u=n||1!=a?null:[],h=n?i:i+1,m=l;e:for(;;)if(c&&m==s[c-1].to){if(d)break e;let g=s[--c];if(!n)for(let e=g.from,n=c;;){if(e==t)break e;if(!n||s[n-1].to!=e){if(types[e-1]==a)break e;break}e=s[--n].from}u?u.push(g):(g.to<l&&o.push(new BidiSpan(g.to,l,h)),computeSectionOrder(e,g.direction==LTR!=!(h%2)?i+1:i,r,g.inner,g.from,g.to,o),l=g.from),m=g.from}else{if(m==t||(n?types[m-1]!=a:types[m-1]==a))break;m--}u?emitSpans(e,m,l,i+1,r,u,o):m<l&&o.push(new BidiSpan(m,l,h)),l=m}}function computeSectionOrder(e,t,n,i,r,s,o){let a=t%2?2:1;computeCharTypes(e,r,s,i,a),processBracketPairs(e,r,s,i,a),processNeutrals(r,s,i,a),emitSpans(e,r,s,t,n,i,o)}function computeOrder(e,t,n){if(!e)return[new BidiSpan(0,0,t==RTL?1:0)];if(t==LTR&&!n.length&&!BidiRE.test(e))return trivialOrder(e.length);if(n.length)for(;e.length>types.length;)types[types.length]=256;let i=[],r=t==LTR?0:1;return computeSectionOrder(e,r,r,n,0,e.length,i),i}function trivialOrder(e){return[new BidiSpan(0,e,0)]}let movedOver="";function moveVisually(e,t,n,i,r){var s;let o=i.head-e.from,a=BidiSpan.find(t,o,null!==(s=i.bidiLevel)&&void 0!==s?s:-1,i.assoc),l=t[a],c=l.side(r,n);if(o==c){let e=a+=r?1:-1;if(e<0||e>=t.length)return null;l=t[a=e],o=l.side(!r,n),c=l.side(r,n)}let d=findClusterBreak(e.text,o,l.forward(r,n));(d<l.from||d>l.to)&&(d=c),movedOver=e.text.slice(Math.min(o,d),Math.max(o,d));let u=a==(r?t.length-1:0)?null:t[a+(r?1:-1)];return u&&d==c&&u.level+(r?0:1)<l.level?EditorSelection.cursor(u.side(!r,n)+e.from,u.forward(r,n)?1:-1,u.level):EditorSelection.cursor(d+e.from,l.forward(r,n)?-1:1,l.level)}function autoDirection(e,t,n){for(let i=t;i<n;i++){let t=charType(e.charCodeAt(i));if(1==t)return LTR;if(2==t||4==t)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),clipboardInputFilter=Facet.define(),clipboardOutputFilter=Facet.define(),perLineTextDirection=Facet.define({combine:e=>e.some((e=>e))}),nativeSelectionHidden=Facet.define({combine:e=>e.some((e=>e))}),scrollHandler=Facet.define();class ScrollTarget{constructor(e,t="nearest",n="nearest",i=5,r=5,s=!1){this.range=e,this.y=t,this.x=n,this.yMargin=i,this.xMargin=r,this.isSnapshot=s}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ScrollTarget(EditorSelection.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView$1=StateEffect.define({map:(e,t)=>e.map(t)}),setEditContextFormatting=StateEffect.define();function logException(e,t,n){let i=e.facet(exceptionSink);i.length?i[0](t):window.onerror?window.onerror(String(t),n,void 0,void 0,t):n?console.error(n+":",t):console.error(t)}const editable=Facet.define({combine:e=>!e.length||e[0]});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,t,n,i,r){this.id=e,this.create=t,this.domEventHandlers=n,this.domEventObservers=i,this.extension=r(this)}static define(e,t){const{eventHandlers:n,eventObservers:i,provide:r,decorations:s}=t||{};return new ViewPlugin(nextPluginID++,e,n,i,(e=>{let t=[viewPlugin.of(e)];return s&&t.push(decorations.of((t=>{let n=t.plugin(e);return n?s(n):Decoration.none}))),r&&t.push(r(e)),t}))}static fromClass(e,t){return ViewPlugin.define((t=>new e(t)),t)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(logException(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(e){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){logException(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(t){logException(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(e,t){let n=e.state.facet(bidiIsolatedRanges);if(!n.length)return n;let i=n.map((t=>t instanceof Function?t(e):t)),r=[];return RangeSet.spans(i,t.from,t.to,{point(){},span(e,n,i,s){let o=e-t.from,a=n-t.from,l=r;for(let e=i.length-1;e>=0;e--,s--){let n,r=i[e].spec.bidiIsolate;if(null==r&&(r=autoDirection(t.text,o,a)),s>0&&l.length&&(n=l[l.length-1]).to==o&&n.direction==r)n.to=a,l=n.inner;else{let e={from:o,to:a,direction:r,inner:[]};l.push(e),l=e.inner}}}}),r}const scrollMargins=Facet.define();function getScrollMargins(e){let t=0,n=0,i=0,r=0;for(let s of e.state.facet(scrollMargins)){let o=s(e);o&&(null!=o.left&&(t=Math.max(t,o.left)),null!=o.right&&(n=Math.max(n,o.right)),null!=o.top&&(i=Math.max(i,o.top)),null!=o.bottom&&(r=Math.max(r,o.bottom)))}return{left:t,right:n,top:i,bottom:r}}const styleModule=Facet.define();class ChangedRange{constructor(e,t,n,i){this.fromA=e,this.toA=t,this.fromB=n,this.toB=i}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,n=this;for(;t>0;t--){let i=e[t-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),e.splice(t-1,1)}}return e.splice(t,0,n),e}static extendWithRanges(e,t){if(0==t.length)return e;let n=[];for(let i=0,r=0,s=0,o=0;;i++){let a=i==e.length?null:e[i],l=s-o,c=a?a.fromB:1e9;for(;r<t.length&&t[r]<c;){let e=t[r],i=t[r+1],s=Math.max(o,e),a=Math.min(c,i);if(s<=a&&new ChangedRange(s+l,a+l,s,a).addToSet(n),i>c)break;r+=2}if(!a)return n;new ChangedRange(a.fromA,a.toA,a.fromB,a.toB).addToSet(n),s=a.toA,o=a.toB}}}class ViewUpdate{constructor(e,t,n){this.view=e,this.state=t,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let e of n)this.changes=this.changes.compose(e.changes);let i=[];this.changes.iterChangedRanges(((e,t,n,r)=>i.push(new ChangedRange(e,t,n,r)))),this.changedRanges=i}static create(e,t,n){return new ViewUpdate(e,t,n)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((e=>e.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every((({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo))?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let i=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(t=this.domChanged)||void 0===t?void 0:t.newSel)?i=this.domChanged.newSel.head:touchesComposition(e.changes,this.hasComposition)||e.selectionSet||(i=e.state.selection.main.head));let r=i>-1?findCompositionRange(this.view,e.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:t,to:i}=this.hasComposition;n=new ChangedRange(t,i,e.changes.mapPos(t,-1),e.changes.mapPos(i,1)).addToSet(n.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(browser.ie||browser.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=findChangedDeco(this.decorations,this.updateDeco(),e.changes);return n=ChangedRange.extendWithRanges(n,s),!!(7&this.flags||0!=n.length)&&(this.updateInner(n,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,n);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=browser.chrome||browser.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,e),this.flags&=-8,e&&(e.written||i.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""})),this.markedForComposition.forEach((e=>e.flags&=-9));let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let e of this.children)e instanceof BlockWidgetView&&e.widget instanceof BlockGapWidget&&r.push(e.dom);i.updateGaps(r)}updateChildren(e,t,n){let i=n?n.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let e=i.length-1;;e--){let t=e>=0?i[e]:null;if(!t)break;let s,o,a,l,{fromA:c,toA:d,fromB:u,toB:h}=t;if(n&&n.range.fromB<h&&n.range.toB>u){let e=ContentBuilder.build(this.view.state.doc,u,n.range.fromB,this.decorations,this.dynamicDecorationMap),t=ContentBuilder.build(this.view.state.doc,n.range.toB,h,this.decorations,this.dynamicDecorationMap);o=e.breakAtStart,a=e.openStart,l=t.openEnd;let i=this.compositionView(n);t.breakAtStart?i.breakAfter=1:t.content.length&&i.merge(i.length,i.length,t.content[0],!1,t.openStart,0)&&(i.breakAfter=t.content[0].breakAfter,t.content.shift()),e.content.length&&i.merge(0,0,e.content[e.content.length-1],!0,0,e.openEnd)&&e.content.pop(),s=e.content.concat(i).concat(t.content)}else({content:s,breakAtStart:o,openStart:a,openEnd:l}=ContentBuilder.build(this.view.state.doc,u,h,this.decorations,this.dynamicDecorationMap));let{i:m,off:g}=r.findPos(d,1),{i:p,off:f}=r.findPos(c,-1);replaceRange(this,p,f,m,g,s,o,a,l)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let e of t.effects)e.is(setEditContextFormatting)&&(this.editContextFormatting=e.value)}compositionView(e){let t=new TextView(e.text.nodeValue);t.flags|=8;for(let{deco:n}of e.marks)t=new MarkView(n,[t],t.length);let n=new LineView;return n.append(t,0),n}fixCompositionDOM(e){let t=(e,t)=>{t.flags|=8|(t.children.some((e=>7&e.flags))?1:0),this.markedForComposition.add(t);let n=ContentView.get(e);n&&n!=t&&(n.dom=null),t.setDOM(e)},n=this.childPos(e.range.fromB,1),i=this.children[n.i];t(e.line,i);for(let r=e.marks.length-1;r>=-1;r--)n=i.childPos(n.off,1),i=i.children[n.i],t(r>=0?e.marks[r].node:e.text,i)}updateSelection(e=!1,t=!1){!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let n=this.view.root.activeElement,i=n==this.dom,r=!i&&!(this.view.state.facet(editable)||this.dom.tabIndex>-1)&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(i||t||r))return;let s=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(o.anchor)),l=o.empty?a:this.moveToLine(this.domAtPos(o.head));if(browser.gecko&&o.empty&&!this.hasComposition&&betweenUneditable(a)){let e=document.createTextNode("");this.view.observer.ignore((()=>a.node.insertBefore(e,a.node.childNodes[a.offset]||null))),a=l=new DOMPos(e,0),s=!0}let c=this.view.observer.selectionRange;!s&&c.focusNode&&(isEquivalentPosition(a.node,a.offset,c.anchorNode,c.anchorOffset)&&isEquivalentPosition(l.node,l.offset,c.focusNode,c.focusOffset)||this.suppressWidgetCursorChange(c,o))||(this.view.observer.ignore((()=>{browser.android&&browser.chrome&&this.dom.contains(c.focusNode)&&inUneditable(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=getSelection(this.view.root);if(e)if(o.empty){if(browser.gecko){let e=nextToUneditable(a.node,a.offset);if(e&&3!=e){let t=(1==e?textNodeBefore:textNodeAfter)(a.node,a.offset);t&&(a=new DOMPos(t.node,t.offset))}}e.collapse(a.node,a.offset),null!=o.bidiLevel&&void 0!==e.caretBidiLevel&&(e.caretBidiLevel=o.bidiLevel)}else if(e.extend){e.collapse(a.node,a.offset);try{e.extend(l.node,l.offset)}catch(e){}}else{let t=document.createRange();o.anchor>o.head&&([a,l]=[l,a]),t.setEnd(l.node,l.offset),t.setStart(a.node,a.offset),e.removeAllRanges(),e.addRange(t)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())})),this.view.observer.setSelectionRange(a,l)),this.impreciseAnchor=a.precise?null:new DOMPos(c.anchorNode,c.anchorOffset),this.impreciseHead=l.precise?null:new DOMPos(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&isEquivalentPosition(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,n=getSelection(e.root),{anchorNode:i,anchorOffset:r}=e.observer.selectionRange;if(!(n&&t.empty&&t.assoc&&n.modify))return;let s=LineView.find(this,t.head);if(!s)return;let o=s.posAtStart;if(t.head==o||t.head==o+s.length)return;let a=this.coordsAt(t.head,-1),l=this.coordsAt(t.head,1);if(!a||!l||a.bottom>l.top)return;let c=this.domAtPos(t.head+t.assoc);n.collapse(c.node,c.offset),n.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=t.from&&n.collapse(i,r)}moveToLine(e){let t,n=this.dom;if(e.node!=n)return e;for(let i=e.offset;!t&&i<n.childNodes.length;i++){let e=ContentView.get(n.childNodes[i]);e instanceof LineView&&(t=e.domAtPos(0))}for(let i=e.offset-1;!t&&i>=0;i--){let e=ContentView.get(n.childNodes[i]);e instanceof LineView&&(t=e.domAtPos(e.length))}return t?new DOMPos(t.node,t.offset,!0):e}nearest(e){for(let t=e;t;){let e=ContentView.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart}domAtPos(e){let{i:t,off:n}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(n<e.length||e instanceof LineView)break;t++,n=0}return this.children[t].domAtPos(n)}coordsAt(e,t){let n=null,i=0;for(let r=this.length,s=this.children.length-1;s>=0;s--){let o=this.children[s],a=r-o.breakAfter,l=a-o.length;if(a<e)break;if(l<=e&&(l<e||o.covers(-1))&&(a>e||o.covers(1))&&(!n||o instanceof LineView&&!(n instanceof LineView&&t>=0)))n=o,i=l;else if(n&&l==e&&a==e&&o instanceof BlockWidgetView&&Math.abs(t)<2){if(o.deco.startSide<0)break;s&&(n=null)}r=l}return n?n.coordsAt(e-i,t):null}coordsForChar(e){let{i:t,off:n}=this.childPos(e,1),i=this.children[t];if(!(i instanceof LineView))return null;for(;i.children.length;){let{i:e,off:t}=i.childPos(n,1);for(;;e++){if(e==i.children.length)return null;if((i=i.children[e]).length)break}n=t}if(!(i instanceof TextView))return null;let r=findClusterBreak(i.text,n);if(r==n)return null;let s=textRange(i.dom,n,r).getClientRects();for(let e=0;e<s.length;e++){let t=s[e];if(e==s.length-1||t.top<t.bottom&&t.left<t.right)return t}return null}measureVisibleLineHeights(e){let t=[],{from:n,to:i}=e,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Direction.LTR;for(let e=0,l=0;l<this.children.length;l++){let c=this.children[l],d=e+c.length;if(d>i)break;if(e>=n){let n=c.dom.getBoundingClientRect();if(t.push(n.height),s){let t=c.dom.lastChild,i=t?clientRectsFor(t):[];if(i.length){let t=i[i.length-1],s=a?t.right-n.left:n.right-t.left;s>o&&(o=s,this.minWidth=r,this.minWidthFrom=e,this.minWidthTo=d)}}}e=d+c.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?Direction.RTL:Direction.LTR}measureTextSize(){for(let e of this.children)if(e instanceof LineView){let t=e.measureTextSize();if(t)return t}let e,t,n,i=document.createElement("div");return i.className="cm-line",i.style.width="99999px",i.style.position="absolute",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let r=clientRectsFor(i.firstChild)[0];e=i.getBoundingClientRect().height,t=r?r.width/27:7,n=r?r.height:e,i.remove()})),{lineHeight:e,charWidth:t,textHeight:n}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ChildCursor(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let n=0,i=0;;i++){let r=i==t.viewports.length?null:t.viewports[i],s=r?r.from-1:this.length;if(s>n){let i=(t.lineBlockAt(s).bottom-t.lineBlockAt(n).top)/this.view.scaleY;e.push(Decoration.replace({widget:new BlockGapWidget(i),block:!0,inclusive:!0,isBlockGap:!0}).range(n,s))}if(!r)break;n=r.to+1}return Decoration.set(e)}updateDeco(){let e=1,t=this.view.state.facet(decorations).map((t=>(this.dynamicDecorationMap[e++]="function"==typeof t)?t(this.view):t)),n=!1,i=this.view.state.facet(outerDecorations).map(((e,t)=>{let i="function"==typeof e;return i&&(n=!0),i?e(this.view):e}));for(i.length&&(this.dynamicDecorationMap[e++]=n,t.push(RangeSet.join(i))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let t=this.view.viewState.lineBlockAt(e.range.head);return this.view.scrollDOM.scrollTop=t.top-e.yMargin,void(this.view.scrollDOM.scrollLeft=e.xMargin)}for(let t of this.view.state.facet(scrollHandler))try{if(t(this.view,e.range,e))return!0}catch(e){logException(this.view.state,e,"scroll handler")}let t,{range:n}=e,i=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1);if(!i)return;!n.empty&&(t=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(i={left:Math.min(i.left,t.left),top:Math.min(i.top,t.top),right:Math.max(i.right,t.right),bottom:Math.max(i.bottom,t.bottom)});let r=getScrollMargins(this.view),s={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:o,offsetHeight:a}=this.view.scrollDOM;scrollRectIntoView(this.view.scrollDOM,s,n.head<n.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==Direction.LTR)}}function betweenUneditable(e){return 1==e.node.nodeType&&e.node.firstChild&&(0==e.offset||"false"==e.node.childNodes[e.offset-1].contentEditable)&&(e.offset==e.node.childNodes.length||"false"==e.node.childNodes[e.offset].contentEditable)}function findCompositionNode(e,t){let n=e.observer.selectionRange;if(!n.focusNode)return null;let i=textNodeBefore(n.focusNode,n.focusOffset),r=textNodeAfter(n.focusNode,n.focusOffset),s=i||r;if(r&&i&&r.node!=i.node){let t=ContentView.get(r.node);if(!t||t instanceof TextView&&t.text!=r.node.nodeValue)s=r;else if(e.docView.lastCompositionAfterCursor){let e=ContentView.get(i.node);!e||e instanceof TextView&&e.text!=i.node.nodeValue||(s=r)}}if(e.docView.lastCompositionAfterCursor=s!=i,!s)return null;let o=t-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function findCompositionRange(e,t,n){let i=findCompositionNode(e,n);if(!i)return null;let{node:r,from:s,to:o}=i,a=r.nodeValue;if(/[\n\r]/.test(a))return null;if(e.state.doc.sliceString(i.from,i.to)!=a)return null;let l=t.invertedDesc,c=new ChangedRange(l.mapPos(s),l.mapPos(o),s,o),d=[];for(let t=r.parentNode;;t=t.parentNode){let n=ContentView.get(t);if(n instanceof MarkView)d.push({node:t,deco:n.mark});else{if(n instanceof LineView||"DIV"==t.nodeName&&t.parentNode==e.contentDOM)return{range:c,text:r,marks:d,line:t};if(t==e.contentDOM)return null;d.push({node:t,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs$1(t),tagName:t.tagName.toLowerCase()})})}}}function nextToUneditable(e,t){return 1!=e.nodeType?0:(t&&"false"==e.childNodes[t-1].contentEditable?1:0)|(t<e.childNodes.length&&"false"==e.childNodes[t].contentEditable?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(e,t){addRange(e,t,this.changes)}comparePoint(e,t){addRange(e,t,this.changes)}boundChange(e){addRange(e,e,this.changes)}};function findChangedDeco(e,t,n){let i=new DecorationComparator$1;return RangeSet.compare(e,t,n,i),i.changes}function inUneditable(e,t){for(let n=e;n&&n!=t;n=n.assignedSlot||n.parentNode)if(1==n.nodeType&&"false"==n.contentEditable)return!0;return!1}function touchesComposition(e,t){let n=!1;return t&&e.iterChangedRanges(((e,i)=>{e<t.to&&i>t.from&&(n=!0)})),n}function groupAt(e,t,n=1){let i=e.charCategorizer(t),r=e.doc.lineAt(t),s=t-r.from;if(0==r.length)return EditorSelection.cursor(t);0==s?n=1:s==r.length&&(n=-1);let o=s,a=s;n<0?o=findClusterBreak(r.text,s,!1):a=findClusterBreak(r.text,s);let l=i(r.text.slice(o,a));for(;o>0;){let e=findClusterBreak(r.text,o,!1);if(i(r.text.slice(e,o))!=l)break;o=e}for(;a<r.length;){let e=findClusterBreak(r.text,a);if(i(r.text.slice(a,e))!=l)break;a=e}return EditorSelection.range(o+r.from,a+r.from)}function getdx(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function getdy(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function yOverlap(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function upTop(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function upBot(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function domPosAtCoords(e,t,n){let i,r,s,o,a,l,c,d,u=!1;for(let h=e.firstChild;h;h=h.nextSibling){let e=clientRectsFor(h);for(let m=0;m<e.length;m++){let g=e[m];r&&yOverlap(r,g)&&(g=upTop(upBot(g,r.bottom),r.top));let p=getdx(t,g),f=getdy(n,g);if(0==p&&0==f)return 3==h.nodeType?domPosInText(h,t,n):domPosAtCoords(h,t,n);if(!i||o>f||o==f&&s>p){i=h,r=g,s=p,o=f;let a=f?n<g.top?-1:1:p?t<g.left?-1:1:0;u=!a||(a>0?m<e.length-1:m>0)}0==p?n>g.bottom&&(!c||c.bottom<g.bottom)?(a=h,c=g):n<g.top&&(!d||d.top>g.top)&&(l=h,d=g):c&&yOverlap(c,g)?c=upBot(c,g.bottom):d&&yOverlap(d,g)&&(d=upTop(d,g.top))}}if(c&&c.bottom>=n?(i=a,r=c):d&&d.top<=n&&(i=l,r=d),!i)return{node:e,offset:0};let h=Math.max(r.left,Math.min(r.right,t));return 3==i.nodeType?domPosInText(i,h,n):u&&"false"!=i.contentEditable?domPosAtCoords(i,h,n):{node:e,offset:Array.prototype.indexOf.call(e.childNodes,i)+(t>=(r.left+r.right)/2?1:0)}}function domPosInText(e,t,n){let i=e.nodeValue.length,r=-1,s=1e9,o=0;for(let a=0;a<i;a++){let i=textRange(e,a,a+1).getClientRects();for(let l=0;l<i.length;l++){let c=i[l];if(c.top==c.bottom)continue;o||(o=t-c.left);let d=(c.top>n?c.top-n:n-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&d<s){let n=t>=(c.left+c.right)/2,i=n;if((browser.chrome||browser.gecko)&&textRange(e,a).getBoundingClientRect().left==c.right&&(i=!n),d<=0)return{node:e,offset:a+(i?1:0)};r=a+(i?1:0),s=d}}}return{node:e,offset:r>-1?r:o>0?e.nodeValue.length:0}}function posAtCoords(e,t,n,i=-1){var r,s;let o,a=e.contentDOM.getBoundingClientRect(),l=a.top+e.viewState.paddingTop,{docHeight:c}=e.viewState,{x:d,y:u}=t,h=u-l;if(h<0)return 0;if(h>c)return e.state.doc.length;for(let t=e.viewState.heightOracle.textHeight/2,r=!1;o=e.elementAtHeight(h),o.type!=BlockType.Text;)for(;h=i>0?o.bottom+t:o.top-t,!(h>=0&&h<=c);){if(r)return n?null:0;r=!0,i=-i}u=l+h;let m=o.from;if(m<e.viewport.from)return 0==e.viewport.from?0:n?null:posAtCoordsImprecise(e,a,o,d,u);if(m>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:n?null:posAtCoordsImprecise(e,a,o,d,u);let g=e.dom.ownerDocument,p=e.root.elementFromPoint?e.root:g,f=p.elementFromPoint(d,u);f&&!e.contentDOM.contains(f)&&(f=null),f||(d=Math.max(a.left+1,Math.min(a.right-1,d)),f=p.elementFromPoint(d,u),f&&!e.contentDOM.contains(f)&&(f=null));let y,b=-1;if(f&&0!=(null===(r=e.docView.nearest(f))||void 0===r?void 0:r.isEditable)){if(g.caretPositionFromPoint){let e=g.caretPositionFromPoint(d,u);e&&({offsetNode:y,offset:b}=e)}else if(g.caretRangeFromPoint){let t=g.caretRangeFromPoint(d,u);t&&(({startContainer:y,startOffset:b}=t),(!e.contentDOM.contains(y)||browser.safari&&isSuspiciousSafariCaretResult(y,b,d)||browser.chrome&&isSuspiciousChromeCaretResult(y,b,d))&&(y=void 0))}y&&(b=Math.min(maxOffset(y),b))}if(!y||!e.docView.dom.contains(y)){let t=LineView.find(e.docView,m);if(!t)return h>o.top+o.height/2?o.to:o.from;({node:y,offset:b}=domPosAtCoords(t.dom,d,u))}let O=e.docView.nearest(y);if(!O)return null;if(O.isWidget&&1==(null===(s=O.dom)||void 0===s?void 0:s.nodeType)){let e=O.dom.getBoundingClientRect();return t.y<e.top||t.y<=e.bottom&&t.x<=(e.left+e.right)/2?O.posAtStart:O.posAtEnd}return O.localPosFromDOM(y,b)+O.posAtStart}function posAtCoordsImprecise(e,t,n,i,r){let s=Math.round((i-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&n.height>1.5*e.defaultLineHeight){let t=e.viewState.heightOracle.textHeight;s+=Math.floor((r-n.top-.5*(e.defaultLineHeight-t))/t)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(n.from,n.to);return n.from+findColumn(o,s,e.state.tabSize)}function isSuspiciousSafariCaretResult(e,t,n){let i;if(3!=e.nodeType||t!=(i=e.nodeValue.length))return!1;for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return!1;return textRange(e,i-1,i).getBoundingClientRect().left>n}function isSuspiciousChromeCaretResult(e,t,n){if(0!=t)return!1;for(let t=e;;){let e=t.parentNode;if(!e||1!=e.nodeType||e.firstChild!=t)return!1;if(e.classList.contains("cm-line"))break;t=e}return n-(1==e.nodeType?e.getBoundingClientRect():textRange(e,0,Math.max(e.nodeValue.length,1)).getBoundingClientRect()).left>5}function blockAt(e,t){let n=e.lineBlockAt(t);if(Array.isArray(n.type))for(let e of n.type)if(e.to>t||e.to==t&&(e.to==n.to||e.type==BlockType.Text))return e;return n}function moveToLineBoundary(e,t,n,i){let r=blockAt(e,t.head),s=i&&r.type==BlockType.Text&&(e.lineWrapping||r.widgetLineBreaks)?e.coordsAtPos(t.assoc<0&&t.head>r.from?t.head-1:t.head):null;if(s){let t=e.dom.getBoundingClientRect(),i=e.textDirectionAt(r.from),o=e.posAtCoords({x:n==(i==Direction.LTR)?t.right-1:t.left+1,y:(s.top+s.bottom)/2});if(null!=o)return EditorSelection.cursor(o,n?-1:1)}return EditorSelection.cursor(n?r.to:r.from,n?-1:1)}function moveByChar(e,t,n,i){let r=e.state.doc.lineAt(t.head),s=e.bidiSpans(r),o=e.textDirectionAt(r.from);for(let a=t,l=null;;){let t=moveVisually(r,s,o,a,n),c=movedOver;if(!t){if(r.number==(n?e.state.doc.lines:1))return a;c="\n",r=e.state.doc.line(r.number+(n?1:-1)),s=e.bidiSpans(r),t=e.visualLineSide(r,!n)}if(l){if(!l(c))return a}else{if(!i)return t;l=i(c)}a=t}}function byGroup(e,t,n){let i=e.state.charCategorizer(t),r=i(n);return e=>{let t=i(e);return r==CharCategory.Space&&(r=t),r==t}}function moveVertically(e,t,n,i){let r=t.head,s=n?1:-1;if(r==(n?e.state.doc.length:0))return EditorSelection.cursor(r,t.assoc);let o,a=t.goalColumn,l=e.contentDOM.getBoundingClientRect(),c=e.coordsAtPos(r,t.assoc||-1),d=e.documentTop;if(c)null==a&&(a=c.left-l.left),o=s<0?c.top:c.bottom;else{let t=e.viewState.lineBlockAt(r);null==a&&(a=Math.min(l.right-l.left,e.defaultCharacterWidth*(r-t.from))),o=(s<0?t.top:t.bottom)+d}let u=l.left+a,h=null!=i?i:e.viewState.heightOracle.textHeight>>1;for(let t=0;;t+=10){let n=o+(h+t)*s,i=posAtCoords(e,{x:u,y:n},!1,s);if(n<l.top||n>l.bottom||(s<0?i<r:i>r)){let t=e.docView.coordsForChar(i),r=!t||n<t.top?-1:1;return EditorSelection.cursor(i,r,void 0,a)}}}function skipAtomicRanges(e,t,n){for(;;){let i=0;for(let r of e)r.between(t-1,t+1,((e,r,s)=>{if(t>e&&t<r){let s=i||n||(t-e<r-t?-1:1);t=s<0?e:r,i=s}}));if(!i)return t}}function skipAtoms(e,t,n){let i=skipAtomicRanges(e.state.facet(atomicRanges).map((t=>t(e))),n.from,t.head>n.from?-1:1);return i==n.from?n:EditorSelection.cursor(i,i<n.from?1:-1)}const LineBreakPlaceholder="￿";class DOMReader{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,t){if(!e)return this;let n=e.parentNode;for(let i=e;;){this.findPointBefore(n,i);let e=this.text.length;this.readNode(i);let r=i.nextSibling;if(r==t)break;let s=ContentView.get(i),o=ContentView.get(r);(s&&o?s.breakAfter:(s?s.breakAfter:isBlockElement(i))||isBlockElement(r)&&("BR"!=i.nodeName||i.cmIgnore)&&this.text.length>e)&&this.lineBreak(),i=r}return this.findPointBefore(n,t),this}readTextNode(e){let t=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,t.length));for(let n=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let r,s=-1,o=1;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,n),o=this.lineSeparator.length):(r=i.exec(t))&&(s=r.index,o=r[0].length),this.append(t.slice(n,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);n=s+o}}readNode(e){if(e.cmIgnore)return;let t=ContentView.get(e),n=t&&t.overrideDOMText;if(null!=n){this.findPointInside(e,n.length);for(let e=n.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==t&&(n.pos=this.text.length)}findPointInside(e,t){for(let n of this.points)(3==e.nodeType?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+(isAtEnd(e,n.node,n.offset)?t:0))}}function isAtEnd(e,t,n){for(;;){if(!t||n<maxOffset(t))return!1;if(t==e)return!0;n=domIndex(t)+1,t=t.parentNode}}class DOMPoint{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class DOMChange{constructor(e,t,n,i){this.typeOver=i,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:s}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,n,0))){let t=r||s?[]:selectionPoints(e),n=new DOMReader(t,e.state);n.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=n.text,this.newSel=selectionFromPoints(t,this.bounds.from)}else{let t=e.observer.selectionRange,n=r&&r.node==t.focusNode&&r.offset==t.focusOffset||!contains(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),i=s&&s.node==t.anchorNode&&s.offset==t.anchorOffset||!contains(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset),o=e.viewport;if((browser.ios||browser.chrome)&&e.state.selection.main.empty&&n!=i&&(o.from>0||o.to<e.state.doc.length)){let t=Math.min(n,i),r=Math.max(n,i),s=o.from-t,a=o.to-r;0!=s&&1!=s&&0!=t||0!=a&&-1!=a&&r!=e.state.doc.length||(n=0,i=e.state.doc.length)}this.newSel=EditorSelection.single(i,n)}}}function applyDOMChange(e,t){let n,{newSel:i}=t,r=e.state.selection.main,s=e.inputState.lastKeyTime>Date.now()-100?e.inputState.lastKeyCode:-1;if(t.bounds){let{from:i,to:o}=t.bounds,a=r.from,l=null;(8===s||browser.android&&t.text.length<o-i)&&(a=r.to,l="end");let c=findDiff(e.state.doc.sliceString(i,o,LineBreakPlaceholder),t.text,a-i,l);c&&(browser.chrome&&13==s&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&c.toB--,n={from:i+c.from,to:i+c.toA,insert:Text.of(t.text.slice(c.from,c.toB).split(LineBreakPlaceholder))})}else i&&(!e.hasFocus&&e.state.facet(editable)||i.main.eq(r))&&(i=null);if(!n&&!i)return!1;if(!n&&t.typeOver&&!r.empty&&i&&i.main.empty?n={from:r.from,to:r.to,insert:e.state.doc.slice(r.from,r.to)}:(browser.mac||browser.android)&&n&&n.from==n.to&&n.from==r.head-1&&/^\. ?$/.test(n.insert.toString())&&"off"==e.contentDOM.getAttribute("autocorrect")?(i&&2==n.insert.length&&(i=EditorSelection.single(i.main.anchor-1,i.main.head-1)),n={from:n.from,to:n.to,insert:Text.of([n.insert.toString().replace("."," ")])}):n&&n.from>=r.from&&n.to<=r.to&&(n.from!=r.from||n.to!=r.to)&&r.to-r.from-(n.to-n.from)<=4?n={from:r.from,to:r.to,insert:e.state.doc.slice(r.from,n.from).append(n.insert).append(e.state.doc.slice(n.to,r.to))}:browser.chrome&&n&&n.from==n.to&&n.from==r.head&&"\n "==n.insert.toString()&&e.lineWrapping&&(i&&(i=EditorSelection.single(i.main.anchor-1,i.main.head-1)),n={from:r.from,to:r.to,insert:Text.of([" "])}),n)return applyDOMChangeInner(e,n,i,s);if(i&&!i.main.eq(r)){let t=!1,n="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),n=e.inputState.lastSelectionOrigin),e.dispatch({selection:i,scrollIntoView:t,userEvent:n}),!0}return!1}function applyDOMChangeInner(e,t,n,i=-1){if(browser.ios&&e.inputState.flushIOSKey(t))return!0;let r=e.state.selection.main;if(browser.android&&(t.to==r.to&&(t.from==r.from||t.from==r.from-1&&" "==e.state.sliceDoc(t.from,r.from))&&1==t.insert.length&&2==t.insert.lines&&dispatchKey(e.contentDOM,"Enter",13)||(t.from==r.from-1&&t.to==r.to&&0==t.insert.length||8==i&&t.insert.length<t.to-t.from&&t.to>r.head)&&dispatchKey(e.contentDOM,"Backspace",8)||t.from==r.from&&t.to==r.to+1&&0==t.insert.length&&dispatchKey(e.contentDOM,"Delete",46)))return!0;let s,o=t.insert.toString();e.inputState.composing>=0&&e.inputState.composing++;let a=()=>s||(s=applyDefaultInsert(e,t,n));return e.state.facet(inputHandler$1).some((n=>n(e,t.from,t.to,o,a)))||e.dispatch(a()),!0}function applyDefaultInsert(e,t,n){let i,r=e.state,s=r.selection.main;if(t.from>=s.from&&t.to<=s.to&&t.to-t.from>=(s.to-s.from)/3&&(!n||n.main.empty&&n.main.from==t.from+t.insert.length)&&e.inputState.composing<0){let n=s.from<t.from?r.sliceDoc(s.from,t.from):"",o=s.to>t.to?r.sliceDoc(t.to,s.to):"";i=r.replaceSelection(e.state.toText(n+t.insert.sliceString(0,void 0,e.state.lineBreak)+o))}else{let o=r.changes(t),a=n&&n.main.to<=o.newLength?n.main:void 0;if(r.selection.ranges.length>1&&e.inputState.composing>=0&&t.to<=s.to&&t.to>=s.to-10){let l,c=e.state.sliceDoc(t.from,t.to),d=n&&findCompositionNode(e,n.main.head);if(d){let e=t.insert.length-(t.to-t.from);l={from:d.from,to:d.to-e}}else l=e.state.doc.lineAt(s.head);let u=s.to-t.to,h=s.to-s.from;i=r.changeByRange((n=>{if(n.from==s.from&&n.to==s.to)return{changes:o,range:a||n.map(o)};let i=n.to-u,d=i-c.length;if(n.to-n.from!=h||e.state.sliceDoc(d,i)!=c||n.to>=l.from&&n.from<=l.to)return{range:n};let m=r.changes({from:d,to:i,insert:t.insert}),g=n.to-s.to;return{changes:m,range:a?EditorSelection.range(Math.max(0,a.anchor+g),Math.max(0,a.head+g)):n.map(m)}}))}else i={changes:o,selection:a&&r.selection.replaceRange(a)}}let o="input.type";return(e.composing||e.inputState.compositionPendingChange&&e.inputState.compositionEndedAt>Date.now()-50)&&(e.inputState.compositionPendingChange=!1,o+=".compose",e.inputState.compositionFirstChange&&(o+=".start",e.inputState.compositionFirstChange=!1)),r.update(i,{userEvent:o,scrollIntoView:!0})}function findDiff(e,t,n,i){let r=Math.min(e.length,t.length),s=0;for(;s<r&&e.charCodeAt(s)==t.charCodeAt(s);)s++;if(s==r&&e.length==t.length)return null;let o=e.length,a=t.length;for(;o>0&&a>0&&e.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;return"end"==i&&(n-=o+Math.max(0,s-Math.min(o,a))-s),o<s&&e.length<t.length?(s-=n<=s&&n>=o?s-n:0,a=s+(a-o),o=s):a<s&&(s-=n<=s&&n>=a?s-n:0,o=s+(o-a),a=s),{from:s,toA:o,toB:a}}function selectionPoints(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:s}=e.observer.selectionRange;return n&&(t.push(new DOMPoint(n,i)),r==n&&s==i||t.push(new DOMPoint(r,s))),t}function selectionFromPoints(e,t){if(0==e.length)return null;let n=e[0].pos,i=2==e.length?e[1].pos:n;return n>-1&&i>-1?EditorSelection.single(n+t,i+t):null}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",(()=>null)),browser.gecko&&firefoxCopyCutHack(e.contentDOM.ownerDocument)}handleEvent(e){eventBelongsToEditor(this.view,e)&&!this.ignoreDuringComposition(e)&&("keydown"==e.type&&this.keydown(e)||this.runHandlers(e.type,e))}runHandlers(e,t){let n=this.handlers[e];if(n){for(let e of n.observers)e(this.view,t);for(let e of n.handlers){if(t.defaultPrevented)break;if(e(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=computeHandlers(e),n=this.handlers,i=this.view.contentDOM;for(let e in t)if("scroll"!=e){let r=!t[e].handlers.length,s=n[e];s&&r!=!s.handlers.length&&(i.removeEventListener(e,this.handleEvent),s=null),s||i.addEventListener(e,this.handleEvent,{passive:r})}for(let e in n)"scroll"==e||t[e]||i.removeEventListener(e,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=e.keyCode&&modifierCodes.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return!browser.ios||e.synthetic||e.altKey||e.metaKey||!((t=PendingKeys.find((t=>t.keyCode==e.keyCode)))&&!e.ctrlKey||EmacsyPendingKeys.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(229!=e.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=t||e,setTimeout((()=>this.flushIOSKey()),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&!("Enter"==t.key&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString()))&&(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(e,t){return(n,i)=>{try{return t.call(e,i,n)}catch(e){logException(n.state,e)}}}function computeHandlers(e){let t=Object.create(null);function n(e){return t[e]||(t[e]={observers:[],handlers:[]})}for(let t of e){let e=t.spec;if(e&&e.domEventHandlers)for(let i in e.domEventHandlers){let r=e.domEventHandlers[i];r&&n(i).handlers.push(bindHandler(t.value,r))}if(e&&e.domEventObservers)for(let i in e.domEventObservers){let r=e.domEventObservers[i];r&&n(i).observers.push(bindHandler(t.value,r))}}for(let e in handlers)n(e).handlers.push(handlers[e]);for(let e in observers)n(e).observers.push(observers[e]);return t}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(e){return.7*Math.max(0,e)+8}function dist(e,t){return Math.max(Math.abs(e.clientX-t.clientX),Math.abs(e.clientY-t.clientY))}class MouseSelection{constructor(e,t,n,i){this.view=e,this.startEvent=t,this.style=n,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=scrollableParents(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map((t=>t(e)));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,t),this.dragging=!(!isInPrimarySelection(e,t)||1!=getClickType(t))&&null}start(e){!1===this.dragging&&this.select(e)}move(e){if(0==e.buttons)return this.destroy();if(this.dragging||null==this.dragging&&dist(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,n=0,i=0,r=0,s=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:i,right:s}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:o}=this.scrollParents.y.getBoundingClientRect());let a=getScrollMargins(this.view);e.clientX-a.left<=i+dragScrollMargin?t=-dragScrollSpeed(i-e.clientX):e.clientX+a.right>=s-dragScrollMargin&&(t=dragScrollSpeed(e.clientX-s)),e.clientY-a.top<=r+dragScrollMargin?n=-dragScrollSpeed(r-e.clientY):e.clientY+a.bottom>=o-dragScrollMargin&&(n=dragScrollSpeed(e.clientY-o)),this.setScrollSpeed(t,n)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval((()=>this.scroll()),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let n=0;n<e.ranges.length;n++){let i=e.ranges[n],r=null;if(i.empty){let e=skipAtomicRanges(this.atoms,i.from,0);e!=i.from&&(r=EditorSelection.cursor(e,-1))}else{let e=skipAtomicRanges(this.atoms,i.from,-1),t=skipAtomicRanges(this.atoms,i.to,1);e==i.from&&t==i.to||(r=EditorSelection.range(i.from==i.anchor?e:t,i.from==i.head?e:t))}r&&(t||(t=e.ranges.slice()),t[n]=r)}return t?EditorSelection.create(t,e.mainIndex):e}select(e){let{view:t}=this,n=this.skipAtoms(this.style.get(e,this.extend,this.multiple));!this.mustSelect&&n.eq(t.state.selection,!1===this.dragging)||this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some((e=>e.isUserEvent("input.type")))?this.destroy():this.style.update(e)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function addsSelectionRange(e,t){let n=e.state.facet(clickAddsSelectionRange);return n.length?n[0](t):browser.mac?t.metaKey:t.ctrlKey}function dragMovesSelection(e,t){let n=e.state.facet(dragMovesSelection$1);return n.length?n[0](t):browser.mac?!t.altKey:!t.ctrlKey}function isInPrimarySelection(e,t){let{main:n}=e.state.selection;if(n.empty)return!1;let i=getSelection(e.root);if(!i||0==i.rangeCount)return!0;let r=i.getRangeAt(0).getClientRects();for(let e=0;e<r.length;e++){let n=r[e];if(n.left<=t.clientX&&n.right>=t.clientX&&n.top<=t.clientY&&n.bottom>=t.clientY)return!0}return!1}function eventBelongsToEditor(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n,i=t.target;i!=e.contentDOM;i=i.parentNode)if(!i||11==i.nodeType||(n=ContentView.get(i))&&n.ignoreEvent(t))return!1;return!0}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(e){let t=e.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout((()=>{e.focus(),n.remove(),doPaste(e,n.value)}),50)}function textFilter(e,t,n){for(let i of e.facet(t))n=i(n,e);return n}function doPaste(e,t){t=textFilter(e.state,clipboardInputFilter,t);let n,{state:i}=e,r=1,s=i.toText(t),o=s.lines==i.selection.ranges.length;if(null!=lastLinewiseCopy&&i.selection.ranges.every((e=>e.empty))&&lastLinewiseCopy==s.toString()){let e=-1;n=i.changeByRange((n=>{let a=i.doc.lineAt(n.from);if(a.from==e)return{range:n};e=a.from;let l=i.toText((o?s.line(r++).text:t)+i.lineBreak);return{changes:{from:a.from,insert:l},range:EditorSelection.cursor(n.from+l.length)}}))}else n=o?i.changeByRange((e=>{let t=s.line(r++);return{changes:{from:e.from,to:e.to,insert:t.text},range:EditorSelection.cursor(e.from+t.length)}})):i.replaceSelection(s);e.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}function rangeForClick(e,t,n,i){if(1==i)return EditorSelection.cursor(t,n);if(2==i)return groupAt(e.state,t,n);{let n=LineView.find(e.docView,t),i=e.state.doc.lineAt(n?n.posAtEnd:t),r=n?n.posAtStart:i.from,s=n?n.posAtEnd:i.to;return s<e.state.doc.length&&s==i.to&&s++,EditorSelection.range(r,s)}}observers.scroll=e=>{e.inputState.lastScrollTop=e.scrollDOM.scrollTop,e.inputState.lastScrollLeft=e.scrollDOM.scrollLeft},handlers.keydown=(e,t)=>(e.inputState.setSelectionOrigin("select"),27==t.keyCode&&0!=e.inputState.tabFocusMode&&(e.inputState.tabFocusMode=Date.now()+2e3),!1),observers.touchstart=(e,t)=>{e.inputState.lastTouchTime=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},observers.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},handlers.mousedown=(e,t)=>{if(e.observer.flush(),e.inputState.lastTouchTime>Date.now()-2e3)return!1;let n=null;for(let i of e.state.facet(mouseSelectionStyle))if(n=i(e,t),n)break;if(n||0!=t.button||(n=basicMouseSelection(e,t)),n){let i=!e.hasFocus;e.inputState.startMouseSelection(new MouseSelection(e,t,n,i)),i&&e.observer.ignore((()=>{focusPreventScroll(e.contentDOM);let t=e.root.activeElement;t&&!t.contains(e.contentDOM)&&t.blur()}));let r=e.inputState.mouseSelection;if(r)return r.start(t),!1===r.dragging}return!1};let inside=(e,t,n)=>t>=n.top&&t<=n.bottom&&e>=n.left&&e<=n.right;function findPositionSide(e,t,n,i){let r=LineView.find(e.docView,t);if(!r)return 1;let s=t-r.posAtStart;if(0==s)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&inside(n,i,o))return-1;let a=r.coordsAt(s,1);return a&&inside(n,i,a)?1:o&&o.bottom>=i?-1:1}function queryPos(e,t){let n=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:n,bias:findPositionSide(e,n,t.clientX,t.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(e){if(!BadMouseDetail)return e.detail;let t=lastMouseDown,n=lastMouseDownTime;return lastMouseDown=e,lastMouseDownTime=Date.now(),lastMouseDownCount=!t||n>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(e,t){let n=queryPos(e,t),i=getClickType(t),r=e.state.selection;return{update(e){e.docChanged&&(n.pos=e.changes.mapPos(n.pos),r=r.map(e.changes))},get(t,s,o){let a,l=queryPos(e,t),c=rangeForClick(e,l.pos,l.bias,i);if(n.pos!=l.pos&&!s){let t=rangeForClick(e,n.pos,n.bias,i),r=Math.min(t.from,c.from),s=Math.max(t.to,c.to);c=r<c.from?EditorSelection.range(r,s):EditorSelection.range(s,r)}return s?r.replaceRange(r.main.extend(c.from,c.to)):o&&1==i&&r.ranges.length>1&&(a=removeRangeAround(r,l.pos))?a:o?r.addRange(c):EditorSelection.create([c])}}}function removeRangeAround(e,t){for(let n=0;n<e.ranges.length;n++){let{from:i,to:r}=e.ranges[n];if(i<=t&&r>=t)return EditorSelection.create(e.ranges.slice(0,n).concat(e.ranges.slice(n+1)),e.mainIndex==n?0:e.mainIndex-(e.mainIndex>n?1:0))}return null}function dropText(e,t,n,i){if(!(n=textFilter(e.state,clipboardInputFilter,n)))return;let r=e.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:s}=e.inputState,o=i&&s&&dragMovesSelection(e,t)?{from:s.from,to:s.to}:null,a={from:r,insert:n},l=e.state.changes(o?[o,a]:a);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(r,-1),head:l.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"}),e.inputState.draggedContent=null}function captureCopy(e,t){let n=e.dom.parentNode;if(!n)return;let i=n.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout((()=>{i.remove(),e.focus()}),50)}function copiedRange(e){let t=[],n=[],i=!1;for(let i of e.selection.ranges)i.empty||(t.push(e.sliceDoc(i.from,i.to)),n.push(i));if(!t.length){let r=-1;for(let{from:i}of e.selection.ranges){let s=e.doc.lineAt(i);s.number>r&&(t.push(s.text),n.push({from:s.from,to:Math.min(e.doc.length,s.to+1)})),r=s.number}i=!0}return{text:textFilter(e,clipboardOutputFilter,t.join(e.lineBreak)),ranges:n,linewise:i}}handlers.dragstart=(e,t)=>{let{selection:{main:n}}=e.state;if(t.target.draggable){let i=e.docView.nearest(t.target);if(i&&i.isWidget){let e=i.posAtStart,t=e+i.length;(e>=n.to||t<=n.from)&&(n=EditorSelection.range(e,t))}}let{inputState:i}=e;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=n,t.dataTransfer&&(t.dataTransfer.setData("Text",textFilter(e.state,clipboardOutputFilter,e.state.sliceDoc(n.from,n.to))),t.dataTransfer.effectAllowed="copyMove"),!1},handlers.dragend=e=>(e.inputState.draggedContent=null,!1),handlers.drop=(e,t)=>{if(!t.dataTransfer)return!1;if(e.state.readOnly)return!0;let n=t.dataTransfer.files;if(n&&n.length){let i=Array(n.length),r=0,s=()=>{++r==n.length&&dropText(e,t,i.filter((e=>null!=e)).join(e.state.lineBreak),!1)};for(let e=0;e<n.length;e++){let t=new FileReader;t.onerror=s,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(i[e]=t.result),s()},t.readAsText(n[e])}return!0}{let n=t.dataTransfer.getData("Text");if(n)return dropText(e,t,n,!0),!0}return!1},handlers.paste=(e,t)=>{if(e.state.readOnly)return!0;e.observer.flush();let n=brokenClipboardAPI?null:t.clipboardData;return n?(doPaste(e,n.getData("text/plain")||n.getData("text/uri-list")),!0):(capturePaste(e),!1)};let lastLinewiseCopy=null;handlers.copy=handlers.cut=(e,t)=>{let{text:n,ranges:i,linewise:r}=copiedRange(e.state);if(!n&&!r)return!1;lastLinewiseCopy=r?n:null,"cut"!=t.type||e.state.readOnly||e.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let s=brokenClipboardAPI?null:t.clipboardData;return s?(s.clearData(),s.setData("text/plain",n),!0):(captureCopy(e,n),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(e,t){let n=[];for(let i of e.facet(focusChangeEffect)){let r=i(e,t);r&&n.push(r)}return n?e.update({effects:n,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(e){setTimeout((()=>{let t=e.hasFocus;if(t!=e.inputState.notifiedFocused){let n=focusChangeTransaction(e.state,t);n?e.dispatch(n):e.update([])}}),10)}observers.focus=e=>{e.inputState.lastFocusTime=Date.now(),e.scrollDOM.scrollTop||!e.inputState.lastScrollTop&&!e.inputState.lastScrollLeft||(e.scrollDOM.scrollTop=e.inputState.lastScrollTop,e.scrollDOM.scrollLeft=e.inputState.lastScrollLeft),updateForFocusChange(e)},observers.blur=e=>{e.observer.clearSelectionRange(),updateForFocusChange(e)},observers.compositionstart=observers.compositionupdate=e=>{e.observer.editContext||(null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0))},observers.compositionend=e=>{e.observer.editContext||(e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionPendingKey=!0,e.inputState.compositionPendingChange=e.observer.pendingRecords().length>0,e.inputState.compositionFirstChange=null,browser.chrome&&browser.android?e.observer.flushSoon():e.inputState.compositionPendingChange?Promise.resolve().then((()=>e.observer.flush())):setTimeout((()=>{e.inputState.composing<0&&e.docView.hasComposition&&e.update([])}),50))},observers.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},handlers.beforeinput=(e,t)=>{var n,i;if("insertReplacementText"==t.inputType&&e.observer.editContext){let i=null===(n=t.dataTransfer)||void 0===n?void 0:n.getData("text/plain"),r=t.getTargetRanges();if(i&&r.length){let t=r[0],n=e.posAtDOM(t.startContainer,t.startOffset),s=e.posAtDOM(t.endContainer,t.endOffset);return applyDOMChangeInner(e,{from:n,to:s,insert:e.state.toText(i)},null),!0}}let r;if(browser.chrome&&browser.android&&(r=PendingKeys.find((e=>e.inputType==t.inputType)))&&(e.observer.delayAndroidKey(r.key,r.keyCode),"Backspace"==r.key||"Delete"==r.key)){let t=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var n;((null===(n=window.visualViewport)||void 0===n?void 0:n.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())}),100)}return browser.ios&&"deleteContentForward"==t.inputType&&e.observer.flushSoon(),browser.safari&&"insertText"==t.inputType&&e.inputState.composing>=0&&setTimeout((()=>observers.compositionend(e,t)),20),!1};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(e){appliedFirefoxHack.has(e)||(appliedFirefoxHack.add(e),e.addEventListener("copy",(()=>{})),e.addEventListener("cut",(()=>{})))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let n=0;n<e.length;n++){let i=e[n];i<0?n++:this.heightSamples[Math.floor(10*i)]||(t=!0,this.heightSamples[Math.floor(10*i)]=!0)}return t}refresh(e,t,n,i,r,s){let o=wrappingWhiteSpace.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=n,this.textHeight=i,this.lineLength=r,a){this.heightSamples={};for(let e=0;e<s.length;e++){let t=s[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return a}}class MeasuredHeights{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,t,n,i,r){this.from=e,this.length=t,this.top=n,this.height=i,this._content=r}get type(){return"number"==typeof this._content?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var QueryType=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(QueryType||(QueryType={}));const Epsilon=.001;class HeightMap{constructor(e,t,n=2){this.length=e,this.height=t,this.flags=n}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Epsilon&&(heightChangeFlag=!0),this.height=e)}replace(e,t,n){return HeightMap.of(n)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,n,i){let r=this,s=n.doc;for(let o=i.length-1;o>=0;o--){let{fromA:a,toA:l,fromB:c,toB:d}=i[o],u=r.lineAt(a,QueryType.ByPosNoHeight,n.setDoc(t),0,0),h=u.to>=l?u:r.lineAt(l,QueryType.ByPosNoHeight,n,0,0);for(d+=h.to-l,l=h.to;o>0&&u.from<=i[o-1].toA;)a=i[o-1].fromA,c=i[o-1].fromB,o--,a<u.from&&(u=r.lineAt(a,QueryType.ByPosNoHeight,n,0,0));c+=u.from-a,a=u.from;let m=NodeBuilder.build(n.setDoc(s),e,c,d);r=replace(r,r.replace(a,l,m))}return r.updateHeight(n,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(1==e.length)return e[0];let t=0,n=e.length,i=0,r=0;for(;;)if(t==n)if(i>2*r){let r=e[t-1];r.break?e.splice(--t,1,r.left,null,r.right):e.splice(--t,1,r.left,r.right),n+=1+r.break,i-=r.size}else{if(!(r>2*i))break;{let t=e[n];t.break?e.splice(n,1,t.left,null,t.right):e.splice(n,1,t.left,t.right),n+=2+t.break,r-=t.size}}else if(i<r){let n=e[t++];n&&(i+=n.size)}else{let t=e[--n];t&&(r+=t.size)}let s=0;return null==e[t-1]?(s=1,t--):null==e[t]&&(s=1,n++),new HeightMapBranch(HeightMap.of(e.slice(0,t)),s,HeightMap.of(e.slice(n)))}}function replace(e,t){return e==t?e:(e.constructor!=t.constructor&&(heightChangeFlag=!0),t)}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,t,n){super(e,t),this.deco=n}blockAt(e,t,n,i){return new BlockInfo(i,this.length,n,this.height,this.deco||0)}lineAt(e,t,n,i,r){return this.blockAt(0,n,i,r)}forEachLine(e,t,n,i,r,s){e<=r+this.length&&t>=r&&s(this.blockAt(0,n,i,r))}updateHeight(e,t=0,n=!1,i){return i&&i.from<=t&&i.more&&this.setHeight(i.heights[i.index++]),this.outdated=!1,this}toString(){return"block("+this.length+")"}}class HeightMapText extends HeightMapBlock{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,n,i){return new BlockInfo(i,this.length,n,this.height,this.breaks)}replace(e,t,n){let i=n[0];return 1==n.length&&(i instanceof HeightMapText||i instanceof HeightMapGap&&4&i.flags)&&Math.abs(this.length-i.length)<10?(i instanceof HeightMapGap?i=new HeightMapText(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):HeightMap.of(n)}updateHeight(e,t=0,n=!1,i){return i&&i.from<=t&&i.more?this.setHeight(i.heights[i.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return"line("+this.length+(this.collapsed?-this.collapsed:"")+(this.widgetHeight?":"+this.widgetHeight:"")+")"}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,t){let n,i=e.doc.lineAt(t).number,r=e.doc.lineAt(t+this.length).number,s=r-i+1,o=0;if(e.lineWrapping){let t=Math.min(this.height,e.lineHeight*s);n=t/s,this.length>s+1&&(o=(this.height-t)/(this.length-s-1))}else n=this.height/s;return{firstLine:i,lastLine:r,perLine:n,perChar:o}}blockAt(e,t,n,i){let{firstLine:r,lastLine:s,perLine:o,perChar:a}=this.heightMetrics(t,i);if(t.lineWrapping){let r=i+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length)),s=t.doc.lineAt(r),l=o+s.length*a,c=Math.max(n,e-l/2);return new BlockInfo(s.from,s.length,c,l,0)}{let i=Math.max(0,Math.min(s-r,Math.floor((e-n)/o))),{from:a,length:l}=t.doc.line(r+i);return new BlockInfo(a,l,n+o*i,o,0)}}lineAt(e,t,n,i,r){if(t==QueryType.ByHeight)return this.blockAt(e,n,i,r);if(t==QueryType.ByPosNoHeight){let{from:t,to:i}=n.doc.lineAt(e);return new BlockInfo(t,i-t,0,0,0)}let{firstLine:s,perLine:o,perChar:a}=this.heightMetrics(n,r),l=n.doc.lineAt(e),c=o+l.length*a,d=l.number-s,u=i+o*d+a*(l.from-r-d);return new BlockInfo(l.from,l.length,Math.max(i,Math.min(u,i+this.height-c)),c,0)}forEachLine(e,t,n,i,r,s){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(n,r);for(let c=e,d=i;c<=t;){let t=n.doc.lineAt(c);if(c==e){let n=t.number-o;d+=a*n+l*(e-r-n)}let i=a+l*t.length;s(new BlockInfo(t.from,t.length,d,i,0)),d+=i,c=t.to+1}}replace(e,t,n){let i=this.length-t;if(i>0){let e=n[n.length-1];e instanceof HeightMapGap?n[n.length-1]=new HeightMapGap(e.length+i):n.push(null,new HeightMapGap(i-1))}if(e>0){let t=n[0];t instanceof HeightMapGap?n[0]=new HeightMapGap(e+t.length):n.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(n)}decomposeLeft(e,t){t.push(new HeightMapGap(e-1),null)}decomposeRight(e,t){t.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,t=0,n=!1,i){let r=t+this.length;if(i&&i.from<=t+this.length&&i.more){let n=[],s=Math.max(t,i.from),o=-1;for(i.from>t&&n.push(new HeightMapGap(i.from-t-1).updateHeight(e,t));s<=r&&i.more;){let t=e.doc.lineAt(s).length;n.length&&n.push(null);let r=i.heights[i.index++];-1==o?o=r:Math.abs(r-o)>=Epsilon&&(o=-2);let a=new HeightMapText(t,r);a.outdated=!1,n.push(a),s+=t+1}s<=r&&n.push(null,new HeightMapGap(r-s).updateHeight(e,s));let a=HeightMap.of(n);return(o<0||Math.abs(a.height-this.height)>=Epsilon||Math.abs(o-this.heightMetrics(e,t).perLine)>=Epsilon)&&(heightChangeFlag=!0),replace(this,a)}return(n||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return"gap("+this.length+")"}}class HeightMapBranch extends HeightMap{constructor(e,t,n){super(e.length+t+n.length,e.height+n.height,t|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return 1&this.flags}blockAt(e,t,n,i){let r=n+this.left.height;return e<r?this.left.blockAt(e,t,n,i):this.right.blockAt(e,t,r,i+this.left.length+this.break)}lineAt(e,t,n,i,r){let s=i+this.left.height,o=r+this.left.length+this.break,a=t==QueryType.ByHeight?e<s:e<o,l=a?this.left.lineAt(e,t,n,i,r):this.right.lineAt(e,t,n,s,o);if(this.break||(a?l.to<o:l.from>o))return l;let c=t==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return a?l.join(this.right.lineAt(o,c,n,s,o)):this.left.lineAt(o,c,n,i,r).join(l)}forEachLine(e,t,n,i,r,s){let o=i+this.left.height,a=r+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,n,i,r,s),t>=a&&this.right.forEachLine(e,t,n,o,a,s);else{let l=this.lineAt(a,QueryType.ByPos,n,i,r);e<l.from&&this.left.forEachLine(e,l.from-1,n,i,r,s),l.to>=e&&l.from<=t&&s(l),t>l.to&&this.right.forEachLine(l.to+1,t,n,o,a,s)}}replace(e,t,n){let i=this.left.length+this.break;if(t<i)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,t-i,n));let r=[];e>0&&this.decomposeLeft(e,r);let s=r.length;for(let e of n)r.push(e);if(e>0&&mergeGaps(r,s-1),t<this.length){let e=r.length;this.decomposeRight(t,r),mergeGaps(r,e)}return HeightMap.of(r)}decomposeLeft(e,t){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(n++,e>=n&&t.push(null)),e>n&&this.right.decomposeLeft(e-n,t)}decomposeRight(e,t){let n=this.left.length,i=n+this.break;if(e>=i)return this.right.decomposeRight(e-i,t);e<n&&this.left.decomposeRight(e,t),this.break&&e<i&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?HeightMap.of(this.break?[e,null,t]:[e,t]):(this.left=replace(this.left,e),this.right=replace(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,n=!1,i){let{left:r,right:s}=this,o=t+r.length+this.break,a=null;return i&&i.from<=t+r.length&&i.more?a=r=r.updateHeight(e,t,n,i):r.updateHeight(e,t,n),i&&i.from<=o+s.length&&i.more?a=s=s.updateHeight(e,o,n,i):s.updateHeight(e,o,n),a?this.balanced(r,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(e,t){let n,i;null==e[t]&&(n=e[t-1])instanceof HeightMapGap&&(i=e[t+1])instanceof HeightMapGap&&e.splice(t-1,3,new HeightMapGap(n.length+1+i.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof HeightMapText?n.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,n){if(e<t||n.heightRelevant){let i=n.widget?n.widget.estimatedHeight:0,r=n.widget?n.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let s=t-e;n.block?this.addBlock(new HeightMapBlock(s,i,n)):(s||r||i>=relevantWidgetHeight)&&this.addLineDeco(i,r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let n=new HeightMapGap(t-e);return this.oracle.doc.lineAt(e).to==t&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let t=new HeightMapText(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,n){let i=this.ensureLine();i.length+=n,i.collapsed+=n,i.widgetHeight=Math.max(i.widgetHeight,e),i.breaks+=t,this.writtenTo=this.pos=this.pos+n}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof HeightMapText||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new HeightMapText(0,-1));let n=e;for(let e of this.nodes)e instanceof HeightMapText&&e.updateHeight(this.oracle,n),n+=e?e.length:1;return this.nodes}static build(e,t,n,i){let r=new NodeBuilder(n,e);return RangeSet.spans(t,n,i,r,0),r.finish(n)}}function heightRelevantDecoChanges(e,t,n){let i=new DecorationComparator;return RangeSet.compare(e,t,n,i,0),i.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,n,i){(e<t||n&&n.heightRelevant||i&&i.heightRelevant)&&addRange(e,t,this.changes,5)}}function visiblePixelRange(e,t){let n=e.getBoundingClientRect(),i=e.ownerDocument,r=i.defaultView||window,s=Math.max(0,n.left),o=Math.min(r.innerWidth,n.right),a=Math.max(0,n.top),l=Math.min(r.innerHeight,n.bottom);for(let t=e.parentNode;t&&t!=i.body;)if(1==t.nodeType){let n=t,i=window.getComputedStyle(n);if((n.scrollHeight>n.clientHeight||n.scrollWidth>n.clientWidth)&&"visible"!=i.overflow){let i=n.getBoundingClientRect();s=Math.max(s,i.left),o=Math.min(o,i.right),a=Math.max(a,i.top),l=Math.min(t==e.parentNode?r.innerHeight:l,i.bottom)}t="absolute"==i.position||"fixed"==i.position?n.offsetParent:n.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:s-n.left,right:Math.max(s,o)-n.left,top:a-(n.top+t),bottom:Math.max(a,l)-(n.top+t)}}function inWindow(e){let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView||window;return t.left<n.innerWidth&&t.right>0&&t.top<n.innerHeight&&t.bottom>0}function fullPixelRange(e,t){let n=e.getBoundingClientRect();return{left:0,right:n.right-n.left,top:t,bottom:n.bottom-(n.top+t)}}class LineGap{constructor(e,t,n,i){this.from=e,this.to=t,this.size=n,this.displaySize=i}static same(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let i=e[n],r=t[n];if(i.from!=r.from||i.to!=r.to||i.size!=r.size)return!1}return!0}draw(e,t){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(contentAttributes).some((e=>"function"!=typeof e&&"cm-lineWrapping"==e.class));this.heightOracle=new HeightOracle(t),this.stateDeco=e.facet(decorations).filter((e=>"function"!=typeof e)),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);for(let e=0;e<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());e++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map((e=>e.draw(this,!1)))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let n=0;n<=1;n++){let i=n?t.head:t.anchor;if(!e.some((({from:e,to:t})=>i>=e&&i<=t))){let{from:t,to:n}=this.lineBlockAt(i);e.push(new Viewport(t,n))}}return this.viewports=e.sort(((e,t)=>e.from-t.from)),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,(e=>{this.viewportLines.push(scaleBlock(e,this.scaler))}))}update(e,t=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter((e=>"function"!=typeof e));let i=e.changedRanges,r=ChangedRange.extendWithRanges(i,heightRelevantDecoChanges(n,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),s=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=s||heightChangeFlag)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let l=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(l||!e.changes.empty||2&e.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,n=window.getComputedStyle(t),i=this.heightOracle,r=n.whiteSpace;this.defaultTextDirection="rtl"==n.direction?Direction.RTL:Direction.LTR;let s=this.heightOracle.mustRefreshForWrapping(r),o=t.getBoundingClientRect(),a=s||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let l=0,c=0;if(o.width&&o.height){let{scaleX:e,scaleY:n}=getScale(t,o);(e>.005&&Math.abs(this.scaleX-e)>.005||n>.005&&Math.abs(this.scaleY-n)>.005)&&(this.scaleX=e,this.scaleY=n,l|=16,s=a=!0)}let d=(parseInt(n.paddingTop)||0)*this.scaleY,u=(parseInt(n.paddingBottom)||0)*this.scaleY;this.paddingTop==d&&this.paddingBottom==u||(this.paddingTop=d,this.paddingBottom=u,l|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=16);let h=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=h&&(this.scrollAnchorHeight=-1,this.scrollTop=h),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let m=(this.printing?fullPixelRange:visiblePixelRange)(t,this.paddingTop),g=m.top-this.pixelViewport.top,p=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let f=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(f!=this.inView&&(this.inView=f,f&&(a=!0)),!this.inView&&!this.scrollTarget&&!inWindow(e.dom))return 0;let y=o.width;if(this.contentDOMWidth==y&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,l|=16),a){let t=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(t)&&(s=!0),s||i.lineWrapping&&Math.abs(y-this.contentDOMWidth)>i.charWidth){let{lineHeight:n,charWidth:o,textHeight:a}=e.docView.measureTextSize();s=n>0&&i.refresh(r,n,o,a,y/o,t),s&&(e.docView.minWidth=0,l|=16)}g>0&&p>0?c=Math.max(g,p):g<0&&p<0&&(c=Math.min(g,p)),clearHeightChangeFlag();for(let n of this.viewports){let r=n.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(n);this.heightMap=(s?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(i,0,s,new MeasuredHeights(n.from,r))}heightChangeFlag&&(l|=2)}let b=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return b&&(2&l&&(l|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),l|=this.updateForViewport()),(2&l||b)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps,e)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,r=this.heightOracle,{visibleTop:s,visibleBottom:o}=this,a=new Viewport(i.lineAt(s-1e3*n,QueryType.ByHeight,r,0,0).from,i.lineAt(o+1e3*(1-n),QueryType.ByHeight,r,0,0).to);if(t){let{head:e}=t.range;if(e<a.from||e>a.to){let n,s=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=i.lineAt(e,QueryType.ByPos,r,0,0);n="center"==t.y?(o.top+o.bottom)/2-s/2:"start"==t.y||"nearest"==t.y&&e<a.from?o.top:o.bottom-s,a=new Viewport(i.lineAt(n-500,QueryType.ByHeight,r,0,0).from,i.lineAt(n+s+500,QueryType.ByHeight,r,0,0).to)}}return a}mapViewport(e,t){let n=t.mapPos(e.from,-1),i=t.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(n,QueryType.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,QueryType.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},n=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,QueryType.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,QueryType.ByPos,this.heightOracle,0,0),{visibleTop:s,visibleBottom:o}=this;return(0==e||i<=s-Math.max(10,Math.min(-n,250)))&&(t==this.state.doc.length||r>=o+Math.max(10,Math.min(n,250)))&&i>s-2e3&&r<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let n=[];for(let i of e)t.touchesRange(i.from,i.to)||n.push(new LineGap(t.mapPos(i.from),t.mapPos(i.to),i.size,i.displaySize));return n}ensureLineGaps(e,t){let n=this.heightOracle.lineWrapping,i=n?1e4:2e3,r=i>>1,s=i<<1;if(this.defaultTextDirection!=Direction.LTR&&!n)return[];let o=[],a=(i,s,l,c)=>{if(s-i<r)return;let d=this.state.selection.main,u=[d.from];d.empty||u.push(d.to);for(let e of u)if(e>i&&e<s)return a(i,e-10,l,c),void a(e+10,s,l,c);let h=find(e,(e=>e.from>=l.from&&e.to<=l.to&&Math.abs(e.from-i)<r&&Math.abs(e.to-s)<r&&!u.some((t=>e.from<t&&e.to>t))));if(!h){if(s<l.to&&t&&n&&t.visibleRanges.some((e=>e.from<=s&&e.to>=s))){let e=t.moveToLineBoundary(EditorSelection.cursor(s),!1,!0).head;e>i&&(s=e)}let e=this.gapSize(l,i,s,c);h=new LineGap(i,s,e,n||e<2e6?e:2e6)}o.push(h)},l=t=>{if(t.length<s||t.type!=BlockType.Text)return;let r=lineStructure(t.from,t.to,this.stateDeco);if(r.total<s)return;let o,l,c=this.scrollTarget?this.scrollTarget.range.head:null;if(n){let e,n,s=i/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=c){let i=findFraction(r,c),o=((this.visibleBottom-this.visibleTop)/2+s)/t.height;e=i-o,n=i+o}else e=(this.visibleTop-t.top-s)/t.height,n=(this.visibleBottom-t.top+s)/t.height;o=findPosition(r,e),l=findPosition(r,n)}else{let n=r.total*this.heightOracle.charWidth,s=i*this.heightOracle.charWidth,a=0;if(n>2e6)for(let n of e)n.from>=t.from&&n.from<t.to&&n.size!=n.displaySize&&n.from*this.heightOracle.charWidth+a<this.pixelViewport.left&&(a=n.size-n.displaySize);let d,u,h=this.pixelViewport.left+a,m=this.pixelViewport.right+a;if(null!=c){let e=findFraction(r,c),t=((m-h)/2+s)/n;d=e-t,u=e+t}else d=(h-s)/n,u=(m+s)/n;o=findPosition(r,d),l=findPosition(r,u)}o>t.from&&a(t.from,o,t,r),l<t.to&&a(l,t.to,t,r)};for(let e of this.viewportLines)Array.isArray(e.type)?e.type.forEach(l):l(e);return o}gapSize(e,t,n,i){let r=findFraction(i,n)-findFraction(i,t);return this.heightOracle.lineWrapping?e.height*r:i.total*this.heightOracle.charWidth*r}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map((e=>e.draw(this,this.heightOracle.lineWrapping)))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let n=[];RangeSet.spans(t,this.viewport.from,this.viewport.to,{span(e,t){n.push({from:e,to:t})},point(){}},20);let i=0;if(n.length!=this.visibleRanges.length)i=12;else for(let t=0;t<n.length&&!(8&i);t++){let r=this.visibleRanges[t],s=n[t];r.from==s.from&&r.to==s.to||(i|=4,e&&e.mapPos(r.from,-1)==s.from&&e.mapPos(r.to,1)==s.to||(i|=8))}return this.visibleRanges=n,i}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((t=>t.from<=e&&t.to>=e))||scaleBlock(this.heightMap.lineAt(e,QueryType.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find((t=>t.top<=e&&t.bottom>=e))||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,t){this.from=e,this.to=t}}function lineStructure(e,t,n){let i=[],r=e,s=0;return RangeSet.spans(n,e,t,{span(){},point(e,t){e>r&&(i.push({from:r,to:e}),s+=e-r),r=t}},20),r<t&&(i.push({from:r,to:t}),s+=t-r),{total:s,ranges:i}}function findPosition({total:e,ranges:t},n){if(n<=0)return t[0].from;if(n>=1)return t[t.length-1].to;let i=Math.floor(e*n);for(let e=0;;e++){let{from:n,to:r}=t[e],s=r-n;if(i<=s)return n+i;i-=s}}function findFraction(e,t){let n=0;for(let{from:i,to:r}of e.ranges){if(t<=r){n+=t-i;break}n+=r-i}return n/e.total}function find(e,t){for(let n of e)if(t(n))return n}const IdScaler={toDOM:e=>e,fromDOM:e=>e,scale:1,eq(e){return e==this}};class BigScaler{constructor(e,t,n){let i=0,r=0,s=0;this.viewports=n.map((({from:n,to:r})=>{let s=t.lineAt(n,QueryType.ByPos,e,0,0).top,o=t.lineAt(r,QueryType.ByPos,e,0,0).bottom;return i+=o-s,{from:n,to:r,top:s,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-i)/(t.height-i);for(let e of this.viewports)e.domTop=s+(e.top-r)*this.scale,s=e.domBottom=e.domTop+(e.bottom-e.top),r=e.bottom}toDOM(e){for(let t=0,n=0,i=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return i+(e-n)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);n=r.bottom,i=r.domBottom}}fromDOM(e){for(let t=0,n=0,i=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return n+(e-i)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);n=r.bottom,i=r.domBottom}}eq(e){return e instanceof BigScaler&&this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every(((t,n)=>t.from==e.viewports[n].from&&t.to==e.viewports[n].to))}}function scaleBlock(e,t){if(1==t.scale)return e;let n=t.toDOM(e.top),i=t.toDOM(e.bottom);return new BlockInfo(e.from,e.length,n,i-n,Array.isArray(e._content)?e._content.map((e=>scaleBlock(e,t))):e._content)}const theme=Facet.define({combine:e=>e.join(" ")}),darkTheme=Facet.define({combine:e=>e.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(e,t,n){return new StyleModule(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,(t=>{if("&"==t)return e;if(!n||!n[t])throw new RangeError("Unsupported selector: "+t);return n[t]})):e+" "+t})}const baseTheme$1$1=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver((t=>{for(let e of t)this.queue.push(e);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&t.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),!window.EditContext||!1===e.constructor.EDIT_CONTEXT||browser.chrome&&browser.chrome_version<126||(this.editContext=new EditContextManager(e),e.state.facet(editable)&&(e.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver((()=>{var e;(null===(e=this.view.docView)||void 0===e?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()})),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(e){("change"!=e.type&&e.type||e.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some(((t,n)=>t!=e[n])))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,i=this.selectionRange;if(n.state.facet(editable)?n.root.activeElement!=this.dom:!hasSelection(this.dom,i))return;let r=i.anchorNode&&n.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)?t||(this.selectionChanged=!1):(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!n.state.selection.main.empty&&i.focusNode&&isEquivalentPosition(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=getSelection(e.root);if(!t)return!1;let n=browser.safari&&11==e.root.nodeType&&e.root.activeElement==this.dom&&safariSelectionRangeHack(this.view,t)||t;if(!n||this.selectionRange.eq(n))return!1;let i=hasSelection(this.dom,n);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,n)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(n),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let n=this.dom;n;)if(1==n.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(n),n=n.assignedSlot||n.parentNode;else{if(11!=n.nodeType)break;n=n.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var n;if(!this.delayedAndroidKey){let e=()=>{let e=this.delayedAndroidKey;e&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=e.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&e.force&&dispatchKey(this.dom,e.key,e.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(e)}this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(null===(n=this.delayedAndroidKey)||void 0===n?void 0:n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,n=-1,i=!1;for(let r of e){let e=this.readMutation(r);e&&(e.typeOver&&(i=!0),-1==t?({from:t,to:n}=e):(t=Math.min(e.from,t),n=Math.max(e.to,n)))}return{from:t,to:n,typeOver:i}}readChange(){let{from:e,to:t,typeOver:n}=this.processRecords(),i=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(e<0&&!i)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new DOMChange(this.view,e,t,n);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let n=this.view.state,i=applyDOMChange(this.view,t);return this.view.state==n&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),i}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.flags|=4),"childList"==e.type){let n=findChild(t,e.previousSibling||e.target.previousSibling,-1),i=findChild(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:i?t.posBefore(i):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(editable)!=e.state.facet(editable)&&(e.view.contentDOM.editContext=e.state.facet(editable)?this.editContext.editContext:null))}destroy(){var e,t,n;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(n=this.resizeScroll)||void 0===n||n.disconnect();for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(e,t,n){for(;t;){let i=ContentView.get(t);if(i&&i.parent==e)return i;let r=t.parentNode;t=r!=e.dom?r:n>0?t.nextSibling:t.previousSibling}return null}function buildSelectionRangeFromRange(e,t){let n=t.startContainer,i=t.startOffset,r=t.endContainer,s=t.endOffset,o=e.docView.domAtPos(e.state.selection.main.anchor);return isEquivalentPosition(o.node,o.offset,r,s)&&([n,i,r,s]=[r,s,n,i]),{anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:s}}function safariSelectionRangeHack(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return buildSelectionRangeFromRange(e,n)}let n=null;function i(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.contentDOM.addEventListener("beforeinput",i,!0),e.dom.ownerDocument.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",i,!0),n?buildSelectionRangeFromRange(e,n):null}class EditContextManager{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=t=>{let n=e.state.selection.main,{anchor:i,head:r}=n,s=this.toEditorPos(t.updateRangeStart),o=this.toEditorPos(t.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:t.updateRangeStart,editorBase:s,drifted:!1});let a={from:s,to:o,insert:Text.of(t.text.split("\n"))};if(a.from==this.from&&i<this.from?a.from=i:a.to==this.to&&i>this.to&&(a.to=i),a.from!=a.to||a.insert.length){if((browser.mac||browser.android)&&a.from==r-1&&/^\. ?$/.test(t.text)&&"off"==e.contentDOM.getAttribute("autocorrect")&&(a={from:s,to:o,insert:Text.of([t.text.replace("."," ")])}),this.pendingContextChange=a,!e.state.readOnly){let n=this.to-this.from+(a.to-a.from+a.insert.length);applyDOMChangeInner(e,a,EditorSelection.single(this.toEditorPos(t.selectionStart,n),this.toEditorPos(t.selectionEnd,n)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))}else{let i=EditorSelection.single(this.toEditorPos(t.selectionStart),this.toEditorPos(t.selectionEnd));i.main.eq(n)||e.dispatch({selection:i,userEvent:"select"})}},this.handlers.characterboundsupdate=n=>{let i=[],r=null;for(let t=this.toEditorPos(n.rangeStart),s=this.toEditorPos(n.rangeEnd);t<s;t++){let n=e.coordsForChar(t);r=n&&new DOMRect(n.left,n.top,n.right-n.left,n.bottom-n.top)||r||new DOMRect,i.push(r)}t.updateCharacterBounds(n.rangeStart,i)},this.handlers.textformatupdate=t=>{let n=[];for(let e of t.getTextFormats()){let t=e.underlineStyle,i=e.underlineThickness;if("None"!=t&&"None"!=i){let r=this.toEditorPos(e.rangeStart),s=this.toEditorPos(e.rangeEnd);if(r<s){let e="text-decoration: underline "+("Dashed"==t?"dashed ":"Squiggle"==t?"wavy ":"")+("Thin"==i?1:2)+"px";n.push(Decoration.mark({attributes:{style:e}}).range(r,s))}}}e.dispatch({effects:setEditContextFormatting.of(Decoration.set(n))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:t}=this.composing;this.composing=null,t&&this.reset(e.state)}};for(let e in this.handlers)t.addEventListener(e,this.handlers[e]);this.measureReq={read:e=>{this.editContext.updateControlBounds(e.contentDOM.getBoundingClientRect());let t=getSelection(e.root);t&&t.rangeCount&&this.editContext.updateSelectionBounds(t.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,n=!1,i=this.pendingContextChange;return e.changes.iterChanges(((r,s,o,a,l)=>{if(n)return;let c=l.length-(s-r);if(i&&s>=i.to){if(i.from==r&&i.to==s&&i.insert.eq(l))return i=this.pendingContextChange=null,t+=c,void(this.to+=c);i=null,this.revertPending(e.state)}if(r+=t,(s+=t)<=this.from)this.from+=c,this.to+=c;else if(r<this.to){if(r<this.from||s>this.to||this.to-this.from+l.length>3e4)return void(n=!0);this.editContext.updateText(this.toContextPos(r),this.toContextPos(s),l.toString()),this.to+=c}t+=c})),i&&!n&&this.revertPending(e.state),!n}update(e){let t=this.pendingContextChange;this.composing&&(this.composing.drifted||e.transactions.some((e=>!e.isUserEvent("input.type")&&e.changes.touchesRange(this.from,this.to))))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):this.applyEdits(e)&&this.rangeIsValid(e.state)?(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state):(this.pendingContextChange=null,this.reset(e.state)),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),i=this.toContextPos(t.head);this.editContext.selectionStart==n&&this.editContext.selectionEnd==i||this.editContext.updateSelection(n,i)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>3e4)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let n=this.composing;return n&&n.drifted?n.editorBase+(e-n.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:n}=e;this.dispatchTransactions=e.dispatchTransactions||n&&(e=>e.forEach((e=>n(e,this))))||(e=>this.update(e)),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),e.scrollTo&&e.scrollTo.is(scrollIntoView$1)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map((e=>new PluginInstance(e)));for(let e of this.plugins)e.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(t=document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then((()=>this.requestMeasure()))}dispatch(...e){let t=1==e.length&&e[0]instanceof Transaction?e:1==e.length&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,n=!1,i=!1,r=this.state;for(let t of e){if(t.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=t.state}if(this.destroyed)return void(this.viewState.state=r);let s=this.hasFocus,o=0,a=null;e.some((e=>e.annotation(isFocusChange)))?(this.inputState.notifiedFocused=s,o=1):s!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=s,a=focusChangeTransaction(r,s),a||(o=1));let l=this.observer.delayedAndroidKey,c=null;if(l?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(c=null)):this.observer.clear(),r.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(r);t=ViewUpdate.create(this,r,e),t.flags|=o;let d=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(d&&(d=d.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;d=new ScrollTarget(e.empty?e:EditorSelection.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(scrollIntoView$1)&&(d=e.value.clip(this.state))}this.viewState.update(t,d),this.bidiCache=CachedOrder.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),n=this.docView.update(t),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(n,e.some((e=>e.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(t.startState.facet(theme)!=t.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(n||i||d||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),n&&this.docViewUpdate(),!t.empty)for(let e of this.state.facet(updateListener))try{e(t)}catch(e){logException(this.state,e,"update listener")}(a||c)&&Promise.resolve().then((()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!applyDOMChange(this,c)&&l.force&&dispatchKey(this.contentDOM,l.key,l.keyCode)}))}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map((e=>new PluginInstance(e))),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(viewPlugin),n=e.state.facet(viewPlugin);if(t!=n){let i=[];for(let r of n){let n=t.indexOf(r);if(n<0)i.push(new PluginInstance(r));else{let t=this.plugins[n];t.mustUpdate=e,i.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let t of this.plugins)t.mustUpdate=e;for(let e=0;e<this.plugins.length;e++)this.plugins[e].update(this);t!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(e){logException(this.state,e,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,n=this.scrollDOM,i=n.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:s}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(s=-1),this.viewState.scrollAnchorHeight=-1;try{for(let e=0;;e++){if(s<0)if(isScrolledToBottom(n))r=-1,s=this.viewState.heightMap.height;else{let e=this.viewState.scrollAnchorAt(i);r=e.from,s=e.top}this.updateState=1;let o=this.viewState.measure(this);if(!o&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let a=[];4&o||([this.measureRequests,a]=[a,this.measureRequests]);let l=a.map((e=>{try{return e.read(this)}catch(e){return logException(this.state,e),BadMeasure}})),c=ViewUpdate.create(this,this.state,[]),d=!1;c.flags|=o,t?t.flags|=o:t=c,this.updateState=2,c.empty||(this.updatePlugins(c),this.inputState.update(c),this.updateAttrs(),d=this.docView.update(c),d&&this.docViewUpdate());for(let e=0;e<a.length;e++)if(l[e]!=BadMeasure)try{let t=a[e];t.write&&t.write(l[e],this)}catch(e){logException(this.state,e)}if(d&&this.docView.updateSelection(!0),!c.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,s=-1;continue}{let e=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-s;if(e>1||e<-1){i+=e,n.scrollTop=i/this.scaleY,s=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let e of this.state.facet(updateListener))e(t)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:browser.tabSize+": "+this.state.tabSize,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,t);let n=this.observer.ignore((()=>{let n=updateAttrs(this.contentDOM,this.contentAttrs,t),i=updateAttrs(this.dom,this.editorAttrs,e);return n||i}));return this.editorAttrs=e,this.contentAttrs=t,n}showAnnouncements(e){let t=!0;for(let n of e)for(let e of n.effects)e.is(EditorView.announce)&&(t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value)}mountStyles(){this.styleModules=this.state.facet(styleModule);let e=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$1).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),e){if(this.measureRequests.indexOf(e)>-1)return;if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find((t=>t.spec==e))||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,n){return skipAtoms(this,e,moveByChar(this,e,t,n))}moveByGroup(e,t){return skipAtoms(this,e,moveByChar(this,e,t,(t=>byGroup(this,e.head,t))))}visualLineSide(e,t){let n=this.bidiSpans(e),i=this.textDirectionAt(e.from),r=n[t?n.length-1:0];return EditorSelection.cursor(r.side(t,i)+e.from,r.forward(!t,i)?1:-1)}moveToLineBoundary(e,t,n=!0){return moveToLineBoundary(this,e,t,n)}moveVertically(e,t,n){return skipAtoms(this,e,moveVertically(this,e,t,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),posAtCoords(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;let i=this.state.doc.lineAt(e),r=this.bidiSpans(i);return flattenRect(n,r[BidiSpan.find(r,e-i.from,-1,t)].dir==Direction.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let t,n=this.textDirectionAt(e.from);for(let i of this.bidiCache)if(i.from==e.from&&i.dir==n&&(i.fresh||isolatesEq(i.isolates,t=getIsolatedRanges(this,e))))return i.order;t||(t=getIsolatedRanges(this,e));let i=computeOrder(e.text,n,t);return this.bidiCache.push(new CachedOrder(e.from,e.to,n,t,!0,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()}))}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((9==e.nodeType?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return scrollIntoView$1.of(new ScrollTarget("number"==typeof e?EditorSelection.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,n=this.viewState.scrollAnchorAt(e);return scrollIntoView$1.of(new ScrollTarget(EditorSelection.cursor(n.from),"start","start",n.top-e,t,!0))}setTabFocusMode(e){null==e?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof e?this.inputState.tabFocusMode=e?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ViewPlugin.define((()=>({})),{eventHandlers:e})}static domEventObservers(e){return ViewPlugin.define((()=>({})),{eventObservers:e})}static theme(e,t){let n=StyleModule.newName(),i=[theme.of(n),styleModule.of(buildTheme("."+n,e))];return t&&t.dark&&i.push(darkTheme.of(!0)),i}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var t;let n=e.querySelector(".cm-content"),i=n&&ContentView.get(n)||ContentView.get(e);return(null===(t=null==i?void 0:i.rootView)||void 0===t?void 0:t.view)||null}}EditorView.styleModule=styleModule,EditorView.inputHandler=inputHandler$1,EditorView.clipboardInputFilter=clipboardInputFilter,EditorView.clipboardOutputFilter=clipboardOutputFilter,EditorView.scrollHandler=scrollHandler,EditorView.focusChangeEffect=focusChangeEffect,EditorView.perLineTextDirection=perLineTextDirection,EditorView.exceptionSink=exceptionSink,EditorView.updateListener=updateListener,EditorView.editable=editable,EditorView.mouseSelectionStyle=mouseSelectionStyle,EditorView.dragMovesSelection=dragMovesSelection$1,EditorView.clickAddsSelectionRange=clickAddsSelectionRange,EditorView.decorations=decorations,EditorView.outerDecorations=outerDecorations,EditorView.atomicRanges=atomicRanges,EditorView.bidiIsolatedRanges=bidiIsolatedRanges,EditorView.scrollMargins=scrollMargins,EditorView.darkTheme=darkTheme,EditorView.cspNonce=Facet.define({combine:e=>e.length?e[0]:""}),EditorView.contentAttributes=contentAttributes,EditorView.editorAttributes=editorAttributes,EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"}),EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,t,n,i,r,s){this.from=e,this.to=t,this.dir=n,this.isolates=i,this.fresh=r,this.order=s}static update(e,t){if(t.empty&&!e.some((e=>e.fresh)))return e;let n=[],i=e.length?e[e.length-1].dir:Direction.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let s=e[r];s.dir!=i||t.touchesRange(s.from,s.to)||n.push(new CachedOrder(t.mapPos(s.from,1),t.mapPos(s.to,-1),s.dir,s.isolates,!1,s.order))}return n}}function attrsFromFacet(e,t,n){for(let i=e.state.facet(t),r=i.length-1;r>=0;r--){let t=i[r],s="function"==typeof t?t(e):t;s&&combineAttrs(s,n)}return n}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(e,t){const n=e.split(/-(?!$)/);let i,r,s,o,a=n[n.length-1];"Space"==a&&(a=" ");for(let e=0;e<n.length-1;++e){const a=n[e];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))i=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))s=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==t?o=!0:r=!0}}return i&&(a="Alt-"+a),r&&(a="Ctrl-"+a),o&&(a="Meta-"+a),s&&(a="Shift-"+a),a}function modifiers(e,t,n){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==n&&t.shiftKey&&(e="Shift-"+e),e}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown:(e,t)=>runHandlers(getKeymap(t.state),e,t,"editor")})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(e){let t=e.facet(keymap),n=Keymaps.get(t);return n||Keymaps.set(t,n=buildKeymap(t.reduce(((e,t)=>e.concat(t)),[]))),n}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(e,t=currentPlatform){let n=Object.create(null),i=Object.create(null),r=(e,t)=>{let n=i[e];if(null==n)i[e]=t;else if(n!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},s=(e,i,s,o,a)=>{var l,c;let d=n[e]||(n[e]=Object.create(null)),u=i.split(/ (?!$)/).map((e=>normalizeKeyName(e,t)));for(let t=1;t<u.length;t++){let n=u.slice(0,t).join(" ");r(n,!0),d[n]||(d[n]={preventDefault:!0,stopPropagation:!1,run:[t=>{let i=storedPrefix={view:t,prefix:n,scope:e};return setTimeout((()=>{storedPrefix==i&&(storedPrefix=null)}),PrefixTimeout),!0}]})}let h=u.join(" ");r(h,!1);let m=d[h]||(d[h]={preventDefault:!1,stopPropagation:!1,run:(null===(c=null===(l=d._any)||void 0===l?void 0:l.run)||void 0===c?void 0:c.slice())||[]});s&&m.run.push(s),o&&(m.preventDefault=!0),a&&(m.stopPropagation=!0)};for(let i of e){let e=i.scope?i.scope.split(" "):["editor"];if(i.any)for(let t of e){let e=n[t]||(n[t]=Object.create(null));e._any||(e._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:r}=i;for(let t in e)e[t].run.push((e=>r(e,currentKeyEvent)))}let r=i[t]||i.key;if(r)for(let t of e)s(t,r,i.run,i.preventDefault,i.stopPropagation),i.shift&&s(t,"Shift-"+r,i.shift,i.preventDefault,i.stopPropagation)}return n}let currentKeyEvent=null;function runHandlers(e,t,n,i){currentKeyEvent=t;let r=keyName(t),s=codePointSize(codePointAt(r,0))==r.length&&" "!=r,o="",a=!1,l=!1,c=!1;storedPrefix&&storedPrefix.view==n&&storedPrefix.scope==i&&(o=storedPrefix.prefix+" ",modifierCodes.indexOf(t.keyCode)<0&&(l=!0,storedPrefix=null));let d,u,h=new Set,m=e=>{if(e){for(let t of e.run)if(!h.has(t)&&(h.add(t),t(n)))return e.stopPropagation&&(c=!0),!0;e.preventDefault&&(e.stopPropagation&&(c=!0),l=!0)}return!1},g=e[i];return g&&(m(g[o+modifiers(r,t,!s)])?a=!0:s&&(t.altKey||t.metaKey||t.ctrlKey)&&!(browser.windows&&t.ctrlKey&&t.altKey)&&(d=base$2[t.keyCode])&&d!=r?(m(g[o+modifiers(d,t,!0)])||t.shiftKey&&(u=shift[t.keyCode])!=r&&u!=d&&m(g[o+modifiers(u,t,!1)]))&&(a=!0):s&&t.shiftKey&&m(g[o+modifiers(r,t,!0)])&&(a=!0),!a&&m(g._any)&&(a=!0)),l&&(a=!0),a&&c&&t.stopPropagation(),currentKeyEvent=null,a}class RectangleMarker{constructor(e,t,n,i,r){this.className=e,this.left=t,this.top=n,this.width=i,this.height=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className==this.className&&(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",null!=this.width&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,n){if(n.empty){let i=e.coordsAtPos(n.head,n.assoc||1);if(!i)return[];let r=getBase(e);return[new RectangleMarker(t,i.left-r.left,i.top-r.top,null,i.bottom-i.top)]}return rectanglesForRange(e,t,n)}}function getBase(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==Direction.LTR?t.left:t.right-e.scrollDOM.clientWidth*e.scaleX)-e.scrollDOM.scrollLeft*e.scaleX,top:t.top-e.scrollDOM.scrollTop*e.scaleY}}function wrappedLine(e,t,n,i){let r=e.coordsAtPos(t,2*n);if(!r)return i;let s=e.dom.getBoundingClientRect(),o=(r.top+r.bottom)/2,a=e.posAtCoords({x:s.left+1,y:o}),l=e.posAtCoords({x:s.right-1,y:o});return null==a||null==l?i:{from:Math.max(i.from,Math.min(a,l)),to:Math.min(i.to,Math.max(a,l))}}function rectanglesForRange(e,t,n){if(n.to<=e.viewport.from||n.from>=e.viewport.to)return[];let i=Math.max(n.from,e.viewport.from),r=Math.min(n.to,e.viewport.to),s=e.textDirection==Direction.LTR,o=e.contentDOM,a=o.getBoundingClientRect(),l=getBase(e),c=o.querySelector(".cm-line"),d=c&&window.getComputedStyle(c),u=a.left+(d?parseInt(d.paddingLeft)+Math.min(0,parseInt(d.textIndent)):0),h=a.right-(d?parseInt(d.paddingRight):0),m=blockAt(e,i),g=blockAt(e,r),p=m.type==BlockType.Text?m:null,f=g.type==BlockType.Text?g:null;if(p&&(e.lineWrapping||m.widgetLineBreaks)&&(p=wrappedLine(e,i,1,p)),f&&(e.lineWrapping||g.widgetLineBreaks)&&(f=wrappedLine(e,r,-1,f)),p&&f&&p.from==f.from&&p.to==f.to)return b(O(n.from,n.to,p));{let t=p?O(n.from,null,p):w(m,!1),i=f?O(null,n.to,f):w(g,!0),r=[];return(p||m).to<(f||g).from-(p&&f?1:0)||m.widgetLineBreaks>1&&t.bottom+e.defaultLineHeight/2<i.top?r.push(y(u,t.bottom,h,i.top)):t.bottom<i.top&&e.elementAtHeight((t.bottom+i.top)/2).type==BlockType.Text&&(t.bottom=i.top=(t.bottom+i.top)/2),b(t).concat(r).concat(b(i))}function y(e,n,i,r){return new RectangleMarker(t,e-l.left,n-l.top,i-e,r-n)}function b({top:e,bottom:t,horizontal:n}){let i=[];for(let r=0;r<n.length;r+=2)i.push(y(n[r],e,n[r+1],t));return i}function O(t,n,i){let r=1e9,o=-1e9,a=[];function l(t,n,l,c,d){let m=e.coordsAtPos(t,t==i.to?-2:2),g=e.coordsAtPos(l,l==i.from?2:-2);m&&g&&(r=Math.min(m.top,g.top,r),o=Math.max(m.bottom,g.bottom,o),d==Direction.LTR?a.push(s&&n?u:m.left,s&&c?h:g.right):a.push(!s&&c?u:g.left,!s&&n?h:m.right))}let c=null!=t?t:i.from,d=null!=n?n:i.to;for(let i of e.visibleRanges)if(i.to>c&&i.from<d)for(let r=Math.max(i.from,c),s=Math.min(i.to,d);;){let i=e.state.doc.lineAt(r);for(let o of e.bidiSpans(i)){let e=o.from+i.from,a=o.to+i.from;if(e>=s)break;a>r&&l(Math.max(e,r),null==t&&e<=c,Math.min(a,s),null==n&&a>=d,o.dir)}if(r=i.to+1,r>=s)break}return 0==a.length&&l(c,null==t,d,null==n,e.textDirection),{top:r,bottom:o,horizontal:a}}function w(e,t){let n=a.top+(t?e.top:e.bottom);return{top:n,bottom:n,horizontal:[]}}}function sameMarker(e,t){return e.constructor==t.constructor&&e.eq(t)}class LayerView{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){!1!==this.layer.updateOnDocViewUpdate&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,n=e.facet(layerOrder);for(;t<n.length&&n[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;e==this.scaleX&&t==this.scaleY||(this.scaleX=e,this.scaleY=t,this.dom.style.transform="scale("+1/e+", "+1/t+")")}draw(e){if(e.length!=this.drawn.length||e.some(((e,t)=>!sameMarker(e,this.drawn[t])))){let t=this.dom.firstChild,n=0;for(let i of e)i.update&&t&&i.constructor&&this.drawn[n].constructor&&i.update(t,this.drawn[n])?(t=t.nextSibling,n++):this.dom.insertBefore(i.draw(),t);for(;t;){let e=t.nextSibling;t.remove(),t=e}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(e){return[ViewPlugin.define((t=>new LayerView(t,e))),layerOrder.of(e)]}const CanHidePrimary=!(browser.ios&&browser.webkit&&browser.webkit_version<534),selectionConfig=Facet.define({combine:e=>combineConfig(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function drawSelection(e={}){return[selectionConfig.of(e),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(e){return e.startState.facet(selectionConfig)!=e.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(e){let{state:t}=e,n=t.facet(selectionConfig),i=[];for(let r of t.selection.ranges){let s=r==t.selection.main;if(r.empty?!s||CanHidePrimary:n.drawRangeCursor){let t=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",n=r.empty?r:EditorSelection.cursor(r.head,r.head>r.anchor?-1:1);for(let r of RectangleMarker.forRange(e,t,n))i.push(r)}}return i},update(e,t){e.transactions.some((e=>e.selection))&&(t.style.animationName="cm-blink"==t.style.animationName?"cm-blink2":"cm-blink");let n=configChanged(e);return n&&setBlinkRate(e.state,t),e.docChanged||e.selectionSet||n},mount(e,t){setBlinkRate(t.state,e)},class:"cm-cursorLayer"});function setBlinkRate(e,t){t.style.animationDuration=e.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers:e=>e.state.selection.ranges.map((t=>t.empty?[]:RectangleMarker.forRange(e,"cm-selectionBackground",t))).reduce(((e,t)=>e.concat(t))),update:(e,t)=>e.docChanged||e.selectionSet||e.viewportChanged||configChanged(e),class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor=themeSpec[".cm-content"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=StateEffect.define({map:(e,t)=>null==e?null:t.mapPos(e)}),dropCursorPos=StateField.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce(((e,t)=>t.is(setDropCursorPos)?t.value:e),e))}),drawDropCursor=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let n=e.state.field(dropCursorPos);null==n?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(dropCursorPos)!=n||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:e}=this,t=e.state.field(dropCursorPos),n=null!=t&&e.coordsAtPos(t);if(!n)return null;let i=e.scrollDOM.getBoundingClientRect();return{left:n.left-i.left+e.scrollDOM.scrollLeft*e.scaleX,top:n.top-i.top+e.scrollDOM.scrollTop*e.scaleY,height:n.bottom-n.top}}drawCursor(e){if(this.cursor){let{scaleX:t,scaleY:n}=this.view;e?(this.cursor.style.left=e.left/t+"px",this.cursor.style.top=e.top/n+"px",this.cursor.style.height=e.height/n+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(dropCursorPos)!=e&&this.view.dispatch({effects:setDropCursorPos.of(e)})}},{eventObservers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(e,t,n,i,r){t.lastIndex=0;for(let s,o=e.iterRange(n,i),a=n;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;s=t.exec(o.value);)r(a+s.index,s)}function matchRanges(e,t){let n=e.visibleRanges;if(1==n.length&&n[0].from==e.viewport.from&&n[0].to==e.viewport.to)return n;let i=[];for(let{from:r,to:s}of n)r=Math.max(e.state.doc.lineAt(r).from,r-t),s=Math.min(e.state.doc.lineAt(s).to,s+t),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class MatchDecorator{constructor(e){const{regexp:t,decoration:n,decorate:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,i)this.addMatch=(e,t,n,r)=>i(r,n,n+e[0].length,e,t);else if("function"==typeof n)this.addMatch=(e,t,i,r)=>{let s=n(e,t,i);s&&r(i,i+e[0].length,s)};else{if(!n)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(e,t,i,r)=>r(i,i+e[0].length,n)}this.boundary=r,this.maxLength=s}createDeco(e){let t=new RangeSetBuilder,n=t.add.bind(t);for(let{from:t,to:i}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,t,i,((t,i)=>this.addMatch(i,e,t,n)));return t.finish()}updateDeco(e,t){let n=1e9,i=-1;return e.docChanged&&e.changes.iterChanges(((t,r,s,o)=>{o>=e.view.viewport.from&&s<=e.view.viewport.to&&(n=Math.min(s,n),i=Math.max(o,i))})),e.viewportMoved||i-n>1e3?this.createDeco(e.view):i>-1?this.updateRange(e.view,t.map(e.changes),n,i):t}updateRange(e,t,n,i){for(let r of e.visibleRanges){let s=Math.max(r.from,n),o=Math.min(r.to,i);if(o>s){let n=e.state.doc.lineAt(s),i=n.to<o?e.state.doc.lineAt(o):n,a=Math.max(r.from,n.from),l=Math.min(r.to,i.to);if(this.boundary){for(;s>n.from;s--)if(this.boundary.test(n.text[s-1-n.from])){a=s;break}for(;o<i.to;o++)if(this.boundary.test(i.text[o-i.from])){l=o;break}}let c,d=[],u=(e,t,n)=>d.push(n.range(e,t));if(n==i)for(this.regexp.lastIndex=a-n.from;(c=this.regexp.exec(n.text))&&c.index<l-n.from;)this.addMatch(c,e,c.index+n.from,u);else iterMatches(e.state.doc,this.regexp,a,l,((t,n)=>this.addMatch(n,e,t,u)));t=t.update({filterFrom:a,filterTo:l,filter:(e,t)=>e<a||t>l,add:d})}}return t}}const UnicodeRegexpSupport=null!=/x/.unicode?"gu":"g",Specials=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\ufeff￹-￼]",UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var e;if(null==_supportsTabSize&&"undefined"!=typeof document&&document.body){let t=document.body.style;_supportsTabSize=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(e){let t=combineConfig(e,{render:null,specialChars:Specials,addSpecialChars:null});return(t.replaceTabs=!supportsTabSize())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,UnicodeRegexpSupport)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,UnicodeRegexpSupport)),t}});function highlightSpecialChars(e={}){return[specialCharConfig.of(e),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new MatchDecorator({regexp:e.specialChars,decoration:(t,n,i)=>{let{doc:r}=n.state,s=codePointAt(t[0],0);if(9==s){let e=r.lineAt(i),t=n.state.tabSize,s=countColumn(e.text,t,i-e.from);return Decoration.replace({widget:new TabWidget((t-s%t)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[s]||(this.decorationCache[s]=Decoration.replace({widget:new SpecialCharWidget(e,s)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(specialCharConfig);e.startState.facet(specialCharConfig)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))}const DefaultPlaceholder="•";function placeholder$1(e){return e>=32?DefaultPlaceholder:10==e?"␤":String.fromCharCode(9216+e)}class SpecialCharWidget extends WidgetType{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=placeholder$1(this.code),n=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,n,t);if(i)return i;let r=document.createElement("span");return r.textContent=t,r.title=n,r.setAttribute("aria-label",n),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,n=[];for(let i of e.state.selection.ranges){let r=e.lineBlockAt(i.head);r.from>t&&(n.push(lineDeco.range(r.from)),t=r.from)}return Decoration.set(n)}},{decorations:e=>e.decorations}),MaxOff=2e3;function rectangleFor(e,t,n){let i=Math.min(t.line,n.line),r=Math.max(t.line,n.line),s=[];if(t.off>MaxOff||n.off>MaxOff||t.col<0||n.col<0){let o=Math.min(t.off,n.off),a=Math.max(t.off,n.off);for(let t=i;t<=r;t++){let n=e.doc.line(t);n.length<=a&&s.push(EditorSelection.range(n.from+o,n.to+a))}}else{let o=Math.min(t.col,n.col),a=Math.max(t.col,n.col);for(let t=i;t<=r;t++){let n=e.doc.line(t),i=findColumn(n.text,o,e.tabSize,!0);if(i<0)s.push(EditorSelection.cursor(n.to));else{let t=findColumn(n.text,a,e.tabSize);s.push(EditorSelection.range(n.from+i,n.from+t))}}}return s}function absoluteColumn(e,t){let n=e.coordsAtPos(e.viewport.from);return n?Math.round(Math.abs((n.left-t)/e.defaultCharacterWidth)):-1}function getPos(e,t){let n=e.posAtCoords({x:t.clientX,y:t.clientY},!1),i=e.state.doc.lineAt(n),r=n-i.from,s=r>MaxOff?-1:r==i.length?absoluteColumn(e,t.clientX):countColumn(i.text,e.state.tabSize,n-i.from);return{line:i.number,col:s,off:r}}function rectangleSelectionStyle(e,t){let n=getPos(e,t),i=e.state.selection;return n?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(n.line).from),r=e.state.doc.lineAt(t);n={line:r.number,col:n.col,off:Math.min(n.off,r.length)},i=i.map(e.changes)}},get(t,r,s){let o=getPos(e,t);if(!o)return i;let a=rectangleFor(e.state,n,o);return a.length?s?EditorSelection.create(a.concat(i.ranges)):EditorSelection.create(a):i}}:null}function rectangularSelection(e){return EditorView.mouseSelectionStyle.of(((e,t)=>{return(n=t).altKey&&0==n.button?rectangleSelectionStyle(e,t):null;var n}))}const keys={Alt:[18,e=>!!e.altKey],Control:[17,e=>!!e.ctrlKey],Shift:[16,e=>!!e.shiftKey],Meta:[91,e=>!!e.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(e={}){let[t,n]=keys[e.key||"Alt"],i=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventObservers:{keydown(e){this.set(e.keyCode==t||n(e))},keyup(e){e.keyCode!=t&&n(e)||this.set(!1)},mousemove(e){this.set(n(e))}}});return[i,EditorView.contentAttributes.of((e=>{var t;return(null===(t=e.plugin(i))||void 0===t?void 0:t.isDown)?showCrosshair:null}))]}const Outside="-10000px";class TooltipViewManager{constructor(e,t,n,i){this.facet=t,this.createTooltipView=n,this.removeTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter((e=>e));let r=null;this.tooltipViews=this.tooltips.map((e=>r=n(e,r)))}update(e,t){var n;let i=e.state.facet(this.facet),r=i.filter((e=>e));if(i===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let s=[],o=t?[]:null;for(let n=0;n<r.length;n++){let i=r[n],a=-1;if(i){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==i.create&&(a=e)}if(a<0)s[n]=this.createTooltipView(i,n?s[n-1]:null),o&&(o[n]=!!i.above);else{let i=s[n]=this.tooltipViews[a];o&&(o[n]=t[a]),i.update&&i.update(e)}}}for(let e of this.tooltipViews)s.indexOf(e)<0&&(this.removeTooltipView(e),null===(n=e.destroy)||void 0===n||n.call(e));return t&&(o.forEach(((e,n)=>t[n]=e)),t.length=o.length),this.input=i,this.tooltips=r,this.tooltipViews=s,!0}}function windowSpace(e){let{win:t}=e;return{top:0,left:0,bottom:t.innerHeight,right:t.innerWidth}}const tooltipConfig=Facet.define({combine:e=>{var t,n,i;return{position:browser.ios?"absolute":(null===(t=e.find((e=>e.position)))||void 0===t?void 0:t.position)||"fixed",parent:(null===(n=e.find((e=>e.parent)))||void 0===n?void 0:n.parent)||null,tooltipSpace:(null===(i=e.find((e=>e.tooltipSpace)))||void 0===i?void 0:i.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=e.state.facet(tooltipConfig);this.position=t.position,this.parent=t.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver((()=>this.measureSoon())):null,this.manager=new TooltipViewManager(e,showTooltip,((e,t)=>this.createTooltip(e,t)),(e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()})),this.above=this.manager.tooltips.map((e=>!!e.above)),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),e.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e,this.above);t&&this.observeIntersection();let n=t||e.geometryChanged,i=e.state.facet(tooltipConfig);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;n=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);n=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);n&&this.maybeMeasure()}createTooltip(e,t){let n=e.create(this.view),i=t?t.dom:null;if(n.dom.classList.add("cm-tooltip"),e.arrow&&!n.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",n.dom.appendChild(e)}return n.dom.style.position=this.position,n.dom.style.top=Outside,n.dom.style.left="0px",this.container.insertBefore(n.dom,i),n.mount&&n.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(n.dom),n}destroy(){var e,t,n;this.view.win.removeEventListener("resize",this.measureSoon);for(let t of this.manager.tooltipViews)t.dom.remove(),null===(e=t.destroy)||void 0===e||e.call(t);this.parent&&this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(n=this.intersectionObserver)||void 0===n||n.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=1,t=1,n=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom:e}=this.manager.tooltipViews[0];if(browser.gecko)n=e.offsetParent!=this.container.ownerDocument.body;else if(e.style.top==Outside&&"0px"==e.style.left){let t=e.getBoundingClientRect();n=Math.abs(t.top+1e4)>1||Math.abs(t.left)>1}}if(n||"absolute"==this.position)if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(e=n.width/this.parent.offsetWidth,t=n.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);let i=this.view.scrollDOM.getBoundingClientRect(),r=getScrollMargins(this.view);return{visible:{left:i.left+r.left,top:i.top+r.top,right:i.right-r.right,bottom:i.bottom-r.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map(((e,t)=>{let n=this.manager.tooltipViews[t];return n.getCoords?n.getCoords(e.pos):this.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((({dom:e})=>e.getBoundingClientRect())),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:n}}writeMeasure(e){var t;if(e.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let e of this.manager.tooltipViews)e.dom.style.position="absolute"}let{visible:n,space:i,scaleX:r,scaleY:s}=e,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:d}=c,u=e.pos[a],h=e.size[a];if(!u||!1!==l.clip&&(u.bottom<=Math.max(n.top,i.top)||u.top>=Math.min(n.bottom,i.bottom)||u.right<Math.max(n.left,i.left)-.1||u.left>Math.min(n.right,i.right)+.1)){d.style.top=Outside;continue}let m=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,g=m?7:0,p=h.right-h.left,f=null!==(t=knownHeight.get(c))&&void 0!==t?t:h.bottom-h.top,y=c.offset||noOffset,b=this.view.textDirection==Direction.LTR,O=h.width>i.right-i.left?b?i.left:i.right-h.width:b?Math.max(i.left,Math.min(u.left-(m?14:0)+y.x,i.right-p)):Math.min(Math.max(i.left,u.left-p+(m?14:0)-y.x),i.right-p),w=this.above[a];!l.strictSide&&(w?u.top-f-g-y.y<i.top:u.bottom+f+g+y.y>i.bottom)&&w==i.bottom-u.bottom>u.top-i.top&&(w=this.above[a]=!w);let v=(w?u.top-i.top:i.bottom-u.bottom)-g;if(v<f&&!1!==c.resize){if(v<this.view.defaultLineHeight){d.style.top=Outside;continue}knownHeight.set(c,f),d.style.height=(f=v)/s+"px"}else d.style.height&&(d.style.height="");let S=w?u.top-f-g-y.y:u.bottom+g+y.y,T=O+p;if(!0!==c.overlap)for(let e of o)e.left<T&&e.right>O&&e.top<S+f&&e.bottom>S&&(S=w?e.top-f-2-g:e.bottom+g+2);if("absolute"==this.position?(d.style.top=(S-e.parent.top)/s+"px",setLeftStyle(d,(O-e.parent.left)/r)):(d.style.top=S/s+"px",setLeftStyle(d,O/r)),m){let e=u.left+(b?y.x:-y.x)-(O+14-7);m.style.left=e/r+"px"}!0!==c.overlap&&o.push({left:O,top:S,right:T,bottom:S+f}),d.classList.toggle("cm-tooltip-above",w),d.classList.toggle("cm-tooltip-below",!w),c.positioned&&c.positioned(e.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=Outside}},{eventObservers:{scroll(){this.maybeMeasure()}}});function setLeftStyle(e,t){let n=parseInt(e.style.left,10);(isNaN(n)||Math.abs(t-n)>1)&&(e.style.left=t+"px")}const baseTheme$3=EditorView.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$3]});function getTooltip(e,t){let n=e.plugin(tooltipPlugin);if(!n)return null;let i=n.manager.tooltips.indexOf(t);return i<0?null:n.manager.tooltipViews[i]}class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="",GutterMarker.prototype.toDOM=void 0,GutterMarker.prototype.mapMode=MapMode.TrackBefore,GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1,GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),gutterWidgetClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(e){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),e))]}const unfixGutters=Facet.define({combine:e=>e.some((e=>e))});function gutters(e){return[gutterView]}const gutterView=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=e.state.facet(activeGutters).map((t=>new SingleGutterView(e,t)));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!e.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(e){if(this.updateGutters(e)){let t=this.prevViewport,n=e.view.viewport,i=Math.min(t.to,n.to)-Math.max(t.from,n.from);this.syncGutters(i<.8*(n.to-n.from))}e.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&this.dom.remove();let n=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),i=[],r=this.gutters.map((e=>new UpdateContext(e,this.view.viewport,-this.view.documentPadding.top)));for(let e of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(e.type)){let t=!0;for(let s of e.type)if(s.type==BlockType.Text&&t){advanceCursor(n,i,s.from);for(let e of r)e.line(this.view,s,i);t=!1}else if(s.widget)for(let e of r)e.widget(this.view,s)}else if(e.type==BlockType.Text){advanceCursor(n,i,e.from);for(let t of r)t.line(this.view,e,i)}else if(e.widget)for(let t of r)t.widget(this.view,e);for(let e of r)e.finish();e&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(e){let t=e.startState.facet(activeGutters),n=e.state.facet(activeGutters),i=e.docChanged||e.heightChanged||e.viewportChanged||!RangeSet.eq(e.startState.facet(gutterLineClass),e.state.facet(gutterLineClass),e.view.viewport.from,e.view.viewport.to);if(t==n)for(let t of this.gutters)t.update(e)&&(i=!0);else{i=!0;let r=[];for(let i of n){let n=t.indexOf(i);n<0?r.push(new SingleGutterView(this.view,i)):(this.gutters[n].update(e),r.push(this.gutters[n]))}for(let e of this.gutters)e.dom.remove(),r.indexOf(e)<0&&e.destroy();for(let e of r)this.dom.appendChild(e.dom);this.gutters=r}return i}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove()}},{provide:e=>EditorView.scrollMargins.of((t=>{let n=t.plugin(e);return n&&0!=n.gutters.length&&n.fixed?t.textDirection==Direction.LTR?{left:n.dom.offsetWidth*t.scaleX}:{right:n.dom.offsetWidth*t.scaleX}:null}))});function asArray$1(e){return Array.isArray(e)?e:[e]}function advanceCursor(e,t,n){for(;e.value&&e.from<=n;)e.from==n&&t.push(e.value),e.next()}class UpdateContext{constructor(e,t,n){this.gutter=e,this.height=n,this.i=0,this.cursor=RangeSet.iter(e.markers,t.from)}addElement(e,t,n){let{gutter:i}=this,r=(t.top-this.height)/e.scaleY,s=t.height/e.scaleY;if(this.i==i.elements.length){let t=new GutterElement(e,s,r,n);i.elements.push(t),i.dom.appendChild(t.dom)}else i.elements[this.i].update(e,s,r,n);this.height=t.bottom,this.i++}line(e,t,n){let i=[];advanceCursor(this.cursor,i,t.from),n.length&&(i=i.concat(n));let r=this.gutter.config.lineMarker(e,t,i);r&&i.unshift(r);let s=this.gutter;(0!=i.length||s.config.renderEmptyElements)&&this.addElement(e,t,i)}widget(e,t){let n=this.gutter.config.widgetMarker(e,t.widget,t),i=n?[n]:null;for(let n of e.state.facet(gutterWidgetClass)){let r=n(e,t.widget,t);r&&(i||(i=[])).push(r)}i&&this.addElement(e,t,i)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class SingleGutterView{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in t.domEventHandlers)this.dom.addEventListener(n,(i=>{let r,s=i.target;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let e=s.getBoundingClientRect();r=(e.top+e.bottom)/2}else r=i.clientY;let o=e.lineBlockAtHeight(r-e.documentTop);t.domEventHandlers[n](e,o,i)&&i.preventDefault()}));this.markers=asArray$1(t.markers(e)),t.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=asArray$1(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let n=e.view.viewport;return!RangeSet.eq(this.markers,t,n.from,n.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,t,n,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,n,i)}update(e,t,n,i){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),sameMarkers(this.markers,i)||this.setMarkers(e,i)}setMarkers(e,t){let n="cm-gutterElement",i=this.dom.firstChild;for(let r=0,s=0;;){let o=s,a=r<t.length?t[r++]:null,l=!1;if(a){let e=a.elementClass;e&&(n+=" "+e);for(let e=s;e<this.markers.length;e++)if(this.markers[e].compare(a)){o=e,l=!0;break}}else o=this.markers.length;for(;s<o;){let e=this.markers[s++];if(e.toDOM){e.destroy(i);let t=i.nextSibling;i.remove(),i=t}}if(!a)break;a.toDOM&&(l?i=i.nextSibling:this.dom.insertBefore(a.toDOM(e),i)),l&&s++}this.dom.className=n,this.markers=t}destroy(){this.setMarkers(null,[])}}function sameMarkers(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].compare(t[n]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberWidgetMarker=Facet.define(),lineNumberConfig=Facet.define({combine:e=>combineConfig(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let n=Object.assign({},e);for(let e in t){let i=n[e],r=t[e];n[e]=i?(e,t,n)=>i(e,t,n)||r(e,t,n):r}return n}})});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(e,t){return e.state.facet(lineNumberConfig).formatNumber(t,e.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],(e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(lineNumberMarkers),lineMarker:(e,t,n)=>n.some((e=>e.toDOM))?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(t.from).number)),widgetMarker:(e,t,n)=>{for(let i of e.state.facet(lineNumberWidgetMarker)){let r=i(e,t,n);if(r)return r}return null},lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer:e=>new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines))),updateSpacer(e,t){let n=formatNumber(t.view,maxLineNumber(t.view.state.doc.lines));return n==e.number?e:new NumberMarker(n)},domEventHandlers:e.facet(lineNumberConfig).domEventHandlers})));function lineNumbers(e={}){return[lineNumberConfig.of(e),gutters(),lineNumberGutter]}function maxLineNumber(e){let t=9;for(;t<e;)t=10*t+9;return t}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],(e=>{let t=[],n=-1;for(let i of e.selection.ranges){let r=e.doc.lineAt(i.head).from;r>n&&(n=r,t.push(activeLineGutterMarker.range(r)))}return RangeSet.of(t)}));function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,t){this.from=e,this.to=t}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=NodeType.match(e)),t=>{let n=e(t);return void 0===n?null:[this,n]}}}NodeProp.closedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.group=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.isolate=new NodeProp({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(e,t,n){this.tree=e,this.overlay=t,this.parser=n}static get(e){return e&&e.props&&e.props[NodeProp.mounted.id]}}const noProps=Object.create(null);class NodeType{constructor(e,t,n,i=0){this.name=e,this.props=t,this.id=n,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):noProps,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),i=new NodeType(e.name||"",t,e.id,n);if(e.props)for(let n of e.props)if(Array.isArray(n)||(n=n(i)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}return i}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(NodeProp.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let i of n.split(" "))t[i]=e[n];return e=>{for(let n=e.prop(NodeProp.group),i=-1;i<(n?n.length:0);i++){let r=t[i<0?e.name:n[i]];if(r)return r}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let n of this.types){let i=null;for(let t of e){let e=t(n);e&&(i||(i=Object.assign({},n.props)),i[e[0].id]=e[1])}t.push(i?new NodeType(n.name,i,n.id,n.flags):n)}return new NodeSet(t)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(IterMode||(IterMode={}));class Tree{constructor(e,t,n,i,r){if(this.type=e,this.children=t,this.positions=n,this.length=i,this.props=null,r&&r.length){this.props=Object.create(null);for(let[e,t]of r)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=MountedTree.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let n=e.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,t=0,n=0){let i=CachedNode.get(this)||this.topNode,r=new TreeCursor(i);return r.moveTo(e,t),CachedNode.set(this,r._tree),r}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,t=0){let n=resolveNode(CachedNode.get(this)||this.topNode,e,t,!1);return CachedNode.set(this,n),n}resolveInner(e,t=0){let n=resolveNode(CachedInnerNode.get(this)||this.topNode,e,t,!0);return CachedInnerNode.set(this,n),n}resolveStack(e,t=0){return stackIterator(this,e,t)}iterate(e){let{enter:t,leave:n,from:i=0,to:r=this.length}=e,s=e.mode||0,o=(s&IterMode.IncludeAnonymous)>0;for(let e=this.cursor(s|IterMode.IncludeAnonymous);;){let s=!1;if(e.from<=r&&e.to>=i&&(!o&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;s=!0}for(;s&&n&&(o||!e.type.isAnonymous)&&n(e),!e.nextSibling();){if(!e.parent())return;s=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,n)=>new Tree(this.type,e,t,n,this.propValues)),e.makeTree||((e,t,n)=>new Tree(NodeType.none,e,t,n)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return NodeType.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],i=this.set.types[t],r=i.name;if(/\W/.test(r)&&!i.isError&&(r=JSON.stringify(r)),n==(e+=4))return r;let s=[];for(;e<n;)s.push(this.childString(e)),e=this.buffer[e+3];return r+"("+s.join(",")+")"}findChild(e,t,n,i,r){let{buffer:s}=this,o=-1;for(let a=e;a!=t&&!(checkSide(r,i,s[a+1],s[a+2])&&(o=a,n>0));a=s[a+3]);return o}slice(e,t,n){let i=this.buffer,r=new Uint16Array(t-e),s=0;for(let o=e,a=0;o<t;){r[a++]=i[o++],r[a++]=i[o++]-n;let t=r[a++]=i[o++]-n;r[a++]=i[o++]-e,s=Math.max(s,t)}return new TreeBuffer(r,s,this.set)}}function checkSide(e,t,n,i){switch(e){case-2:return n<t;case-1:return i>=t&&n<t;case 0:return n<t&&i>t;case 1:return n<=t&&i>t;case 2:return i>t;case 4:return!0}}function resolveNode(e,t,n,i){for(var r;e.from==e.to||(n<1?e.from>=t:e.from>t)||(n>-1?e.to<=t:e.to<t);){let t=!i&&e instanceof TreeNode&&e.index<0?null:e.parent;if(!t)return e;e=t}let s=i?0:IterMode.IgnoreOverlays;if(i)for(let i=e,o=i.parent;o;i=o,o=i.parent)i instanceof TreeNode&&i.index<0&&(null===(r=o.enter(t,n,s))||void 0===r?void 0:r.from)!=i.from&&(e=o);for(;;){let i=e.enter(t,n,s);if(!i)return e;e=i}}class BaseNode{cursor(e=0){return new TreeCursor(this,e)}getChild(e,t=null,n=null){let i=getChildren(this,e,t,n);return i.length?i[0]:null}getChildren(e,t=null,n=null){return getChildren(this,e,t,n)}resolve(e,t=0){return resolveNode(this,e,t,!1)}resolveInner(e,t=0){return resolveNode(this,e,t,!0)}matchContext(e){return matchNodeContext(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),n=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(n=t,t=e.prevSibling):t=e}return n}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(e,t,n,i){super(),this._tree=e,this.from=t,this.index=n,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,n,i,r=0){for(let s=this;;){for(let{children:o,positions:a}=s._tree,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],c=a[e]+s.from;if(checkSide(i,n,c,c+l.length))if(l instanceof TreeBuffer){if(r&IterMode.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,t,n-c,i);if(o>-1)return new BufferNode(new BufferContext(s,l,e,c),null,o)}else if(r&IterMode.IncludeAnonymous||!l.type.isAnonymous||hasChild(l)){let o;if(!(r&IterMode.IgnoreMounts)&&(o=MountedTree.get(l))&&!o.overlay)return new TreeNode(o.tree,c,e,s);let a=new TreeNode(l,c,e,s);return r&IterMode.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?l.children.length-1:0,t,n,i)}}if(r&IterMode.IncludeAnonymous||!s.type.isAnonymous)return null;if(e=s.index>=0?s.index+t:t<0?-1:s._parent._tree.children.length,s=s._parent,!s)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,n=0){let i;if(!(n&IterMode.IgnoreOverlays)&&(i=MountedTree.get(this._tree))&&i.overlay){let n=e-this.from;for(let{from:e,to:r}of i.overlay)if((t>0?e<=n:e<n)&&(t<0?r>=n:r>n))return new TreeNode(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(e,t,n,i){let r=e.cursor(),s=[];if(!r.firstChild())return s;if(null!=n)for(let e=!1;!e;)if(e=r.type.is(n),!r.nextSibling())return s;for(;;){if(null!=i&&r.type.is(i))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return null==i?s:[]}}function matchNodeContext(e,t,n=t.length-1){for(let i=e;n>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[n]&&t[n]!=i.name)return!1;n--}}return!0}class BufferContext{constructor(e,t,n,i){this.parent=e,this.buffer=t,this.index=n,this.start=i}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,n){super(),this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,t,n){let{buffer:i}=this.context,r=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,n);return r<0?null:new BufferNode(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n=0){if(n&IterMode.ExcludeBuffers)return null;let{buffer:i}=this.context,r=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new BufferNode(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,i=this.index+4,r=n.buffer[this.index+3];if(r>i){let s=n.buffer[this.index+1];e.push(n.slice(i,r,s)),t.push(0)}return new Tree(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(e){if(!e.length)return null;let t=0,n=e[0];for(let i=1;i<e.length;i++){let r=e[i];(r.from>n.from||r.to<n.to)&&(n=r,t=i)}let i=n instanceof TreeNode&&n.index<0?null:n.parent,r=e.slice();return i?r[t]=i:r.splice(t,1),new StackIterator(r,n)}class StackIterator{constructor(e,t){this.heads=e,this.node=t}get next(){return iterStack(this.heads)}}function stackIterator(e,t,n){let i=e.resolveInner(t,n),r=null;for(let e=i instanceof TreeNode?i:i.context.parent;e;e=e.parent)if(e.index<0){let s=e.parent;(r||(r=[i])).push(s.resolve(t,n)),e=s}else{let s=MountedTree.get(e.tree);if(s&&s.overlay&&s.overlay[0].from<=t&&s.overlay[s.overlay.length-1].to>=t){let o=new TreeNode(s.tree,s.overlay[0].from+e.from,-1,e);(r||(r=[i])).push(resolveNode(o,t,n,!1))}}return r?iterStack(r):i}class TreeCursor{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:n,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=n+i.buffer[e+1],this.to=n+i.buffer[e+2],!0}yield(e){return!!e&&(e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,n,this.mode));let{buffer:i}=this.buffer,r=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,n);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=this.mode){return this.buffer?!(n&IterMode.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let e=n<0?0:this.stack[n]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(e)}return n<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(i.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:n}=i)}else({index:t,_parent:n}=this._tree);for(;n;({index:t,_parent:n}=n))if(t>-1)for(let i=t+e,r=e<0?-1:n._tree.children.length;i!=r;i+=e){let e=n._tree.children[i];if(this.mode&IterMode.IncludeAnonymous||e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer)e:for(let i=this.index,r=this.stack.length;r>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;t=s,n=r+1;break e}i=this.stack[--r]}for(let e=n;e<this.stack.length;e++)t=new BufferNode(this.buffer,t,this.stack[e]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let n=0;;){let i=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){n++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&t&&t(this),i=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,i=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node.parent,e);let{buffer:t}=this.buffer,{types:n}=t.set;for(let i=e.length-1,r=this.stack.length-1;i>=0;r--){if(r<0)return matchNodeContext(this._tree,e,i);let s=n[t.buffer[this.stack[r]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}}function hasChild(e){return e.children.some((e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e)))}function buildTree(e){var t;let{buffer:n,nodeSet:i,maxBufferLength:r=DefaultBufferLength,reused:s=[],minRepeatType:o=i.types.length}=e,a=Array.isArray(n)?new FlatBufferCursor(n,n.length):n,l=i.types,c=0,d=0;function u(e,t,n,f,y,b){let{id:O,start:w,end:v,size:S}=a,T=d,_=c;for(;S<0;){if(a.next(),-1==S){let t=s[O];return n.push(t),void f.push(w-e)}if(-3==S)return void(c=O);if(-4==S)return void(d=O);throw new RangeError("Unrecognized record size: "+S)}let C,k,E=l[O],A=w-e;if(v-w<=r&&(k=function(e,t){let n=a.fork(),i=0,s=0,l=0,c=n.end-r,d={size:0,start:0,skip:0};e:for(let r=n.pos-e;n.pos>r;){let e=n.size;if(n.id==t&&e>=0){d.size=i,d.start=s,d.skip=l,l+=4,i+=4,n.next();continue}let a=n.pos-e;if(e<0||a<r||n.start<c)break;let u=n.id>=o?4:0,h=n.start;for(n.next();n.pos>a;){if(n.size<0){if(-3!=n.size)break e;u+=4}else n.id>=o&&(u+=4);n.next()}s=h,i+=e,l+=u}return(t<0||i==e)&&(d.size=i,d.start=s,d.skip=l),d.size>4?d:void 0}(a.pos-t,y))){let t=new Uint16Array(k.size-k.skip),n=a.pos-k.size,r=t.length;for(;a.pos>n;)r=p(k.start,t,r);C=new TreeBuffer(t,v-k.start,i),A=k.start-e}else{let e=a.pos-S;a.next();let t=[],n=[],i=O>=o?O:-1,s=0,l=v;for(;a.pos>e;)i>=0&&a.id==i&&a.size>=0?(a.end<=l-r&&(m(t,n,w,s,a.end,l,i,T,_),s=t.length,l=a.end),a.next()):b>2500?h(w,e,t,n):u(w,e,t,n,i,b+1);if(i>=0&&s>0&&s<t.length&&m(t,n,w,s,w,l,i,T,_),t.reverse(),n.reverse(),i>-1&&s>0){let e=(I=E,x=_,(e,t,n)=>{let i,r,s=0,o=e.length-1;if(o>=0&&(i=e[o])instanceof Tree){if(!o&&i.type==I&&i.length==n)return i;(r=i.prop(NodeProp.lookAhead))&&(s=t[o]+i.length+r)}return g(I,e,t,n,s,x)});C=balanceRange(E,t,n,0,t.length,0,v-w,e,e)}else C=g(E,t,n,v-w,T-v,_)}var I,x;n.push(C),f.push(A)}function h(e,t,n,s){let o=[],l=0,c=-1;for(;a.pos>t;){let{id:e,start:t,end:n,size:i}=a;if(i>4)a.next();else{if(c>-1&&t<c)break;c<0&&(c=n-r),o.push(e,t,n),l++,a.next()}}if(l){let t=new Uint16Array(4*l),r=o[o.length-2];for(let e=o.length-3,n=0;e>=0;e-=3)t[n++]=o[e],t[n++]=o[e+1]-r,t[n++]=o[e+2]-r,t[n++]=n;n.push(new TreeBuffer(t,o[2]-r,i)),s.push(r-e)}}function m(e,t,n,r,s,o,a,l,c){let d=[],u=[];for(;e.length>r;)d.push(e.pop()),u.push(t.pop()+n-s);e.push(g(i.types[a],d,u,o-s,l-o,c)),t.push(s-n)}function g(e,t,n,i,r,s,o){if(s){let e=[NodeProp.contextHash,s];o=o?[e].concat(o):[e]}if(r>25){let e=[NodeProp.lookAhead,r];o=o?[e].concat(o):[e]}return new Tree(e,t,n,i,o)}function p(e,t,n){let{id:i,start:r,end:s,size:l}=a;if(a.next(),l>=0&&i<o){let o=n;if(l>4){let i=a.pos-(l-4);for(;a.pos>i;)n=p(e,t,n)}t[--n]=o,t[--n]=s-e,t[--n]=r-e,t[--n]=i}else-3==l?c=i:-4==l&&(d=i);return n}let f=[],y=[];for(;a.pos>0;)u(e.start||0,e.bufferStart||0,f,y,-1,0);let b=null!==(t=e.length)&&void 0!==t?t:f.length?y[0]+f[0].length:0;return new Tree(l[e.topID],f.reverse(),y.reverse(),b)}const nodeSizeCache=new WeakMap;function nodeSize(e,t){if(!e.isAnonymous||t instanceof TreeBuffer||t.type!=e)return 1;let n=nodeSizeCache.get(t);if(null==n){n=1;for(let i of t.children){if(i.type!=e||!(i instanceof Tree)){n=1;break}n+=nodeSize(e,i)}nodeSizeCache.set(t,n)}return n}function balanceRange(e,t,n,i,r,s,o,a,l){let c=0;for(let n=i;n<r;n++)c+=nodeSize(e,t[n]);let d=Math.ceil(1.5*c/8),u=[],h=[];return function t(n,i,r,o,a){for(let c=r;c<o;){let r=c,m=i[c],g=nodeSize(e,n[c]);for(c++;c<o;c++){let t=nodeSize(e,n[c]);if(g+t>=d)break;g+=t}if(c==r+1){if(g>d){let e=n[r];t(e.children,e.positions,0,e.children.length,i[r]+a);continue}u.push(n[r])}else{let t=i[c-1]+n[c-1].length-m;u.push(balanceRange(e,n,i,r,c,m,t,null,l))}h.push(m+a-s)}}(t,n,i,r,0),(a||l)(u,h,o)}class NodeWeakMap{constructor(){this.map=new WeakMap}setBuffer(e,t,n){let i=this.map.get(e);i||this.map.set(e,i=new Map),i.set(t,n)}getBuffer(e,t){let n=this.map.get(e);return n&&n.get(t)}set(e,t){e instanceof BufferNode?this.setBuffer(e.context.buffer,e.index,t):e instanceof TreeNode&&this.map.set(e.tree,t)}get(e){return e instanceof BufferNode?this.getBuffer(e.context.buffer,e.index):e instanceof TreeNode?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class TreeFragment{constructor(e,t,n,i,r=!1,s=!1){this.from=e,this.to=t,this.tree=n,this.offset=i,this.open=(r?1:0)|(s?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],n=!1){let i=[new TreeFragment(0,e.length,e,0,!1,n)];for(let n of t)n.to>e.length&&i.push(n);return i}static applyChanges(e,t,n=128){if(!t.length)return e;let i=[],r=1,s=e.length?e[0]:null;for(let o=0,a=0,l=0;;o++){let c=o<t.length?t[o]:null,d=c?c.fromA:1e9;if(d-a>=n)for(;s&&s.from<d;){let t=s;if(a>=t.from||d<=t.to||l){let e=Math.max(t.from,a)-l,n=Math.min(t.to,d)-l;t=e>=n?null:new TreeFragment(e,n,t.tree,t.offset+l,o>0,!!c)}if(t&&i.push(t),s.to>d)break;s=r<e.length?e[r++]:null}if(!c)break;a=c.toA,l=c.toA-c.toB}return i}}class Parser{startParse(e,t,n){return"string"==typeof e&&(e=new StringInput(e)),n=n?n.length?n.map((e=>new Range(e.from,e.to))):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let i=this.startParse(e,t,n);for(;;){let e=i.advance();if(e)return e}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function parseMixed(e){return(t,n,i,r)=>new MixedParse(t,e,n,i,r)}class InnerParse{constructor(e,t,n,i,r){this.parser=e,this.parse=t,this.overlay=n,this.target=i,this.from=r}}function checkRanges(e){if(!e.length||e.some((e=>e.from>=e.to)))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(e))}class ActiveOverlay{constructor(e,t,n,i,r,s,o){this.parser=e,this.predicate=t,this.mounts=n,this.index=i,this.start=r,this.target=s,this.prev=o,this.depth=0,this.ranges=[]}}const stoppedInner=new NodeProp({perNode:!0});class MixedParse{constructor(e,t,n,i,r){this.nest=t,this.input=n,this.fragments=i,this.ranges=r,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let e=this.baseParse.advance();if(!e)return null;if(this.baseParse=null,this.baseTree=e,this.startInner(),null!=this.stoppedAt)for(let e of this.inner)e.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let e=this.baseTree;return null!=this.stoppedAt&&(e=new Tree(e.type,e.children,e.positions,e.length,e.propValues.concat([[stoppedInner,this.stoppedAt]]))),e}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let n=Object.assign(Object.create(null),e.target.props);n[NodeProp.mounted.id]=new MountedTree(t,e.overlay,e.parser),e.target.props=n}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new FragmentCursor$2(this.fragments),t=null,n=null,i=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),IterMode.IncludeAnonymous|IterMode.IgnoreMounts);e:for(let r,s;;){let o,a=!0;if(null!=this.stoppedAt&&i.from>=this.stoppedAt)a=!1;else if(e.hasNode(i)){if(t){let e=t.mounts.find((e=>e.frag.from<=i.from&&e.frag.to>=i.to&&e.mount.overlay));if(e)for(let n of e.mount.overlay){let r=n.from+e.pos,s=n.to+e.pos;r>=i.from&&s<=i.to&&!t.ranges.some((e=>e.from<s&&e.to>r))&&t.ranges.push({from:r,to:s})}}a=!1}else if(n&&(s=checkCover(n.ranges,i.from,i.to)))a=2!=s;else if(!i.type.isAnonymous&&(r=this.nest(i,this.input))&&(i.from<i.to||!r.overlay)){i.tree||materialize(i);let s=e.findMounts(i.from,r.parser);if("function"==typeof r.overlay)t=new ActiveOverlay(r.parser,r.overlay,s,this.inner.length,i.from,i.tree,t);else{let e=punchRanges(this.ranges,r.overlay||(i.from<i.to?[new Range(i.from,i.to)]:[]));e.length&&checkRanges(e),!e.length&&r.overlay||this.inner.push(new InnerParse(r.parser,e.length?r.parser.startParse(this.input,enterFragments(s,e),e):r.parser.startParse(""),r.overlay?r.overlay.map((e=>new Range(e.from-i.from,e.to-i.from))):null,i.tree,e.length?e[0].from:i.from)),r.overlay?e.length&&(n={ranges:e,depth:0,prev:n}):a=!1}}else if(t&&(o=t.predicate(i))&&(!0===o&&(o=new Range(i.from,i.to)),o.from<o.to)){let e=t.ranges.length-1;e>=0&&t.ranges[e].to==o.from?t.ranges[e]={from:t.ranges[e].from,to:o.to}:t.ranges.push(o)}if(a&&i.firstChild())t&&t.depth++,n&&n.depth++;else for(;!i.nextSibling();){if(!i.parent())break e;if(t&&! --t.depth){let e=punchRanges(this.ranges,t.ranges);e.length&&(checkRanges(e),this.inner.splice(t.index,0,new InnerParse(t.parser,t.parser.startParse(this.input,enterFragments(t.mounts,e),e),t.ranges.map((e=>new Range(e.from-t.start,e.to-t.start))),t.target,e[0].from))),t=t.prev}n&&! --n.depth&&(n=n.prev)}}}}function checkCover(e,t,n){for(let i of e){if(i.from>=n)break;if(i.to>t)return i.from<=t&&i.to>=n?2:1}return 0}function sliceBuf(e,t,n,i,r,s){if(t<n){let o=e.buffer[t+1];i.push(e.slice(t,n,o)),r.push(o-s)}}function materialize(e){let{node:t}=e,n=[],i=t.context.buffer;do{n.push(e.index),e.parent()}while(!e.tree);let r=e.tree,s=r.children.indexOf(i),o=r.children[s],a=o.buffer,l=[s];r.children[s]=function e(i,r,s,c,d,u){let h=n[u],m=[],g=[];sliceBuf(o,i,h,m,g,c);let p=a[h+1],f=a[h+2];l.push(m.length);let y=u?e(h+4,a[h+3],o.set.types[a[h]],p,f-p,u-1):t.toTree();return m.push(y),g.push(p-c),sliceBuf(o,a[h+3],r,m,g,c),new Tree(s,m,g,d)}(0,a.length,NodeType.none,0,o.length,n.length-1);for(let t of l){let n=e.tree.children[t],i=e.tree.positions[t];e.yield(new TreeNode(n,i+e.from,t,e._tree))}}class StructureCursor{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(IterMode.IncludeAnonymous|IterMode.IgnoreMounts)}moveTo(e){let{cursor:t}=this,n=e-this.offset;for(;!this.done&&t.from<n;)t.to>=e&&t.enter(n,1,IterMode.IgnoreOverlays|IterMode.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(!(t.children.length&&0==t.positions[0]&&t.children[0]instanceof Tree))break;t=t.children[0]}return!1}}let FragmentCursor$2=class{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let n=this.curFrag=e[0];this.curTo=null!==(t=n.tree.prop(stoppedInner))&&void 0!==t?t:n.to,this.inner=new StructureCursor(n.tree,-n.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=null!==(e=t.tree.prop(stoppedInner))&&void 0!==e?e:t.to,this.inner=new StructureCursor(t.tree,-t.offset)}}findMounts(e,t){var n;let i=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let e=this.inner.cursor.node;e;e=e.parent){let r=null===(n=e.tree)||void 0===n?void 0:n.prop(NodeProp.mounted);if(r&&r.parser==t)for(let t=this.fragI;t<this.fragments.length;t++){let n=this.fragments[t];if(n.from>=e.to)break;n.tree==this.curFrag.tree&&i.push({frag:n,pos:e.from-n.offset,mount:r})}}}return i}};function punchRanges(e,t){let n=null,i=t;for(let r=1,s=0;r<e.length;r++){let o=e[r-1].to,a=e[r].from;for(;s<i.length;s++){let e=i[s];if(e.from>=a)break;e.to<=o||(n||(i=n=t.slice()),e.from<o?(n[s]=new Range(e.from,o),e.to>a&&n.splice(s+1,0,new Range(a,e.to))):e.to>a?n[s--]=new Range(a,e.to):n.splice(s--,1))}}return i}function findCoverChanges(e,t,n,i){let r=0,s=0,o=!1,a=!1,l=-1e9,c=[];for(;;){let d=r==e.length?1e9:o?e[r].to:e[r].from,u=s==t.length?1e9:a?t[s].to:t[s].from;if(o!=a){let e=Math.max(l,n),t=Math.min(d,u,i);e<t&&c.push(new Range(e,t))}if(l=Math.min(d,u),1e9==l)break;d==l&&(o?(o=!1,r++):o=!0),u==l&&(a?(a=!1,s++):a=!0)}return c}function enterFragments(e,t){let n=[];for(let{pos:i,mount:r,frag:s}of e){let e=i+(r.overlay?r.overlay[0].from:0),o=e+r.tree.length,a=Math.max(s.from,e),l=Math.min(s.to,o);if(r.overlay){let o=findCoverChanges(t,r.overlay.map((e=>new Range(e.from+i,e.to+i))),a,l);for(let t=0,i=a;;t++){let a=t==o.length,c=a?l:o[t].from;if(c>i&&n.push(new TreeFragment(i,c,r.tree,-e,s.from>=i||s.openStart,s.to<=c||s.openEnd)),a)break;i=o[t].to}}else n.push(new TreeFragment(a,l,r.tree,-e,s.from>=e||s.openStart,s.to<=o||s.openEnd))}return n}let nextTagID=0;class Tag{constructor(e,t,n,i){this.name=e,this.set=t,this.base=n,this.modified=i,this.id=nextTagID++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=t.name+"("+e+")");return e}static define(e,t){let n="string"==typeof e?e:"?";if(e instanceof Tag&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let i=new Tag(n,[],null,[]);if(i.set.push(i),t)for(let e of t.set)i.set.push(e);return i}static defineModifier(e){let t=new Modifier(e);return e=>e.modified.indexOf(t)>-1?e:Modifier.get(e.base||e,e.modified.concat(t).sort(((e,t)=>e.id-t.id)))}}let nextModifierID=0;class Modifier{constructor(e){this.name=e,this.instances=[],this.id=nextModifierID++}static get(e,t){if(!t.length)return e;let n=t[0].instances.find((n=>n.base==e&&sameArray(t,n.modified)));if(n)return n;let i=[],r=new Tag(e.name,i,e,t);for(let e of t)e.instances.push(r);let s=powerSet(t);for(let t of e.set)if(!t.modified.length)for(let e of s)i.push(Modifier.get(t,e));return r}}function sameArray(e,t){return e.length==t.length&&e.every(((e,n)=>e==t[n]))}function powerSet(e){let t=[[]];for(let n=0;n<e.length;n++)for(let i=0,r=t.length;i<r;i++)t.push(t[i].concat(e[n]));return t.sort(((e,t)=>t.length-e.length))}function styleTags(e){let t=Object.create(null);for(let n in e){let i=e[n];Array.isArray(i)||(i=[i]);for(let e of n.split(" "))if(e){let n=[],r=2,s=e;for(let t=0;;){if("..."==s&&t>0&&t+3==e.length){r=1;break}let i=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(s);if(!i)throw new RangeError("Invalid path: "+e);if(n.push("*"==i[0]?"":'"'==i[0][0]?JSON.parse(i[0]):i[0]),t+=i[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){r=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);s=e.slice(t)}let o=n.length-1,a=n[o];if(!a)throw new RangeError("Invalid path: "+e);let l=new Rule(i,r,o>0?n.slice(0,o):null);t[a]=l.sort(t[a])}}return ruleNodeProp.add(t)}const ruleNodeProp=new NodeProp;class Rule{constructor(e,t,n,i){this.tags=e,this.mode=t,this.context=n,this.next=i}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function tagHighlighter(e,t){let n=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)n[e.id]=t.class;else n[t.tag.id]=t.class;let{scope:i,all:r=null}=t||{};return{style:e=>{let t=r;for(let i of e)for(let e of i.set){let i=n[e.id];if(i){t=t?t+" "+i:i;break}}return t},scope:i}}function highlightTags(e,t){let n=null;for(let i of e){let e=i.style(t);e&&(n=n?n+" "+e:e)}return n}function highlightTree(e,t,n,i=0,r=e.length){let s=new HighlightBuilder(i,Array.isArray(t)?t:[t],n);s.highlightRange(e.cursor(),i,r,"",s.highlighters),s.flush(r)}Rule.empty=new Rule([],2,null);class HighlightBuilder{constructor(e,t,n){this.at=e,this.highlighters=t,this.span=n,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,n,i,r){let{type:s,from:o,to:a}=e;if(o>=n||a<=t)return;s.isTop&&(r=this.highlighters.filter((e=>!e.scope||e.scope(s))));let l=i,c=getStyleTags(e)||Rule.empty,d=highlightTags(r,c.tags);if(d&&(l&&(l+=" "),l+=d,1==c.mode&&(i+=(i?" ":"")+d)),this.startSpan(Math.max(t,o),l),c.opaque)return;let u=e.tree&&e.tree.prop(NodeProp.mounted);if(u&&u.overlay){let s=e.node.enter(u.overlay[0].from+o,1),c=this.highlighters.filter((e=>!e.scope||e.scope(u.tree.type))),d=e.firstChild();for(let h=0,m=o;;h++){let g=h<u.overlay.length?u.overlay[h]:null,p=g?g.from+o:a,f=Math.max(t,m),y=Math.min(n,p);if(f<y&&d)for(;e.from<y&&(this.highlightRange(e,f,y,i,r),this.startSpan(Math.min(y,e.to),l),!(e.to>=p)&&e.nextSibling()););if(!g||p>n)break;m=g.to+o,m>t&&(this.highlightRange(s.cursor(),Math.max(t,g.from+o),Math.min(n,m),"",c),this.startSpan(Math.min(n,m),l))}d&&e.parent()}else if(e.firstChild()){u&&(i="");do{if(!(e.to<=t)){if(e.from>=n)break;this.highlightRange(e,t,n,i,r),this.startSpan(Math.min(n,e.to),l)}}while(e.nextSibling());e.parent()}}}function getStyleTags(e){let t=e.type.prop(ruleNodeProp);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags$1={comment:comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name,variableName:t(name),typeName:typeName,tagName:t(typeName),propertyName:propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal:literal,string:string,docString:t(string),character:t(string),attributeValue:t(string),number:number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword:keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator:operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation:punctuation,separator:t(punctuation),bracket:bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content:content,heading:heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let e in tags$1){let t=tags$1[e];t instanceof Tag&&(t.name=e)}var _a;tagHighlighter([{tag:tags$1.link,class:"tok-link"},{tag:tags$1.heading,class:"tok-heading"},{tag:tags$1.emphasis,class:"tok-emphasis"},{tag:tags$1.strong,class:"tok-strong"},{tag:tags$1.keyword,class:"tok-keyword"},{tag:tags$1.atom,class:"tok-atom"},{tag:tags$1.bool,class:"tok-bool"},{tag:tags$1.url,class:"tok-url"},{tag:tags$1.labelName,class:"tok-labelName"},{tag:tags$1.inserted,class:"tok-inserted"},{tag:tags$1.deleted,class:"tok-deleted"},{tag:tags$1.literal,class:"tok-literal"},{tag:tags$1.string,class:"tok-string"},{tag:tags$1.number,class:"tok-number"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],class:"tok-string2"},{tag:tags$1.variableName,class:"tok-variableName"},{tag:tags$1.local(tags$1.variableName),class:"tok-variableName tok-local"},{tag:tags$1.definition(tags$1.variableName),class:"tok-variableName tok-definition"},{tag:tags$1.special(tags$1.variableName),class:"tok-variableName2"},{tag:tags$1.definition(tags$1.propertyName),class:"tok-propertyName tok-definition"},{tag:tags$1.typeName,class:"tok-typeName"},{tag:tags$1.namespace,class:"tok-namespace"},{tag:tags$1.className,class:"tok-className"},{tag:tags$1.macroName,class:"tok-macroName"},{tag:tags$1.propertyName,class:"tok-propertyName"},{tag:tags$1.operator,class:"tok-operator"},{tag:tags$1.comment,class:"tok-comment"},{tag:tags$1.meta,class:"tok-meta"},{tag:tags$1.invalid,class:"tok-invalid"},{tag:tags$1.punctuation,class:"tok-punctuation"}]);const languageDataProp=new NodeProp;function defineLanguageFacet(e){return Facet.define({combine:e?t=>t.concat(e):void 0})}const sublanguageProp=new NodeProp;class Language{constructor(e,t,n=[],i=""){this.data=e,this.name=i,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=t,this.extension=[language.of(this),EditorState.languageData.of(((e,t,n)=>{let i=topNodeAt(e,t,n),r=i.type.prop(languageDataProp);if(!r)return[];let s=e.facet(r),o=i.type.prop(sublanguageProp);if(o){let r=i.resolve(t-i.from,n);for(let t of o)if(t.test(r,e)){let n=e.facet(t.facet);return"replace"==t.type?n:n.concat(s)}}return s}))].concat(n)}isActiveAt(e,t,n=-1){return topNodeAt(e,t,n).type.prop(languageDataProp)==this.data}findRegions(e){let t=e.facet(language);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let n=[],i=(e,t)=>{if(e.prop(languageDataProp)==this.data)return void n.push({from:t,to:t+e.length});let r=e.prop(NodeProp.mounted);if(r){if(r.tree.prop(languageDataProp)==this.data){if(r.overlay)for(let e of r.overlay)n.push({from:e.from+t,to:e.to+t});else n.push({from:t,to:t+e.length});return}if(r.overlay){let e=n.length;if(i(r.tree,r.overlay[0].from+t),n.length>e)return}}for(let n=0;n<e.children.length;n++){let r=e.children[n];r instanceof Tree&&i(r,e.positions[n]+t)}};return i(syntaxTree(e),0),n}get allowsNesting(){return!0}}function topNodeAt(e,t,n){let i=e.facet(language),r=syntaxTree(e).topNode;if(!i||i.allowsNesting)for(let e=r;e;e=e.enter(t,n,IterMode.ExcludeBuffers))e.type.isTop&&(r=e);return r}Language.setState=StateEffect.define();class LRLanguage extends Language{constructor(e,t,n){super(e,t,[],n),this.parser=t}static define(e){let t=defineLanguageFacet(e.languageData);return new LRLanguage(t,e.parser.configure({props:[languageDataProp.add((e=>e.isTop?t:void 0))]}),e.name)}configure(e,t){return new LRLanguage(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(e){let t=e.field(Language.state,!1);return t?t.tree:Tree.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let n=this.cursorPos-this.string.length;return e<n||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-n,t-n)}}let currentContext=null;class ParseContext{constructor(e,t,n=[],i,r,s,o,a){this.parser=e,this.state=t,this.fragments=n,this.tree=i,this.treeLen=r,this.viewport=s,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,n){return new ParseContext(e,t,[],Tree.empty,0,n,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=Tree.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var n;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i){if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(i,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(n=this.parse.stoppedAt)&&void 0!==n?n:this.state.doc.length,this.tree=i,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=currentContext;currentContext=this;try{return e()}finally{currentContext=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=cutFragments(e,t.from,t.to);return e}changes(e,t){let{fragments:n,tree:i,treeLen:r,viewport:s,skipped:o}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,n,i,r)=>t.push({fromA:e,toA:n,fromB:i,toB:r}))),n=TreeFragment.applyChanges(n,t),i=Tree.empty,r=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){o=[];for(let t of this.skipped){let n=e.mapPos(t.from,1),i=e.mapPos(t.to,-1);n<i&&o.push({from:n,to:i})}}}return new ParseContext(this.parser,t,n,i,r,s,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:n,to:i}=this.skipped[t];n<e.to&&i>e.from&&(this.fragments=cutFragments(this.fragments,n,i),this.skipped.splice(t--,1))}return!(this.skipped.length>=t||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Parser{createParse(t,n,i){let r=i[0].from,s=i[i.length-1].to;return{parsedPos:r,advance(){let t=currentContext;if(t){for(let e of i)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=s,new Tree(NodeType.none,[],[],s-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return currentContext}}function cutFragments(e,t,n){return TreeFragment.applyChanges(e,[{fromA:t,toA:n,fromB:t,toB:n}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,n)||t.takeTree(),new LanguageState(t)}static init(e){let t=Math.min(3e3,e.doc.length),n=ParseContext.create(e.facet(language).parser,e,{from:0,to:t});return n.work(20,t)||n.takeTree(),new LanguageState(n)}}Language.state=StateField.define({create:LanguageState.init,update(e,t){for(let e of t.effects)if(e.is(Language.setState))return e.value;return t.startState.facet(language)!=t.state.facet(language)?LanguageState.init(t.state):e.apply(t)}});let requestIdle=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(requestIdle=e=>{let t=-1,n=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(n):cancelIdleCallback(t)});const isInputPending="undefined"!=typeof navigator&&(null===(_a=navigator.scheduling)||void 0===_a?void 0:_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Language.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Language.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=requestIdle(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,r=n.field(Language.state);if(r.tree==r.context.tree&&r.context.isDone(i+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),o=r.context.treeLen<i&&n.doc.length>i+1e3,a=r.context.work((()=>isInputPending&&isInputPending()||Date.now()>s),i+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(r.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>logException(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine:e=>e.length?e[0]:null,enables:e=>[Language.state,parseWorker,EditorView.contentAttributes.compute([e],(t=>{let n=t.facet(e);return n&&n.name?{"data-language":n.name}:{}}))]});class LanguageSupport{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class LanguageDescription{constructor(e,t,n,i,r,s=void 0){this.name=e,this.alias=t,this.extensions=n,this.filename=i,this.loadFunc=r,this.support=s,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then((e=>this.support=e),(e=>{throw this.loading=null,e})))}static of(e){let{load:t,support:n}=e;if(!t){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(n)}return new LanguageDescription(e.name,(e.alias||[]).concat(e.name).map((e=>e.toLowerCase())),e.extensions||[],e.filename,t,n)}static matchFilename(e,t){for(let n of e)if(n.filename&&n.filename.test(t))return n;let n=/\.([^.]+)$/.exec(t);if(n)for(let t of e)if(t.extensions.indexOf(n[1])>-1)return t;return null}static matchLanguageName(e,t,n=!0){t=t.toLowerCase();for(let n of e)if(n.alias.some((e=>e==t)))return n;if(n)for(let n of e)for(let e of n.alias){let i=t.indexOf(e);if(i>-1&&(e.length>2||!/\w/.test(t[i-1])&&!/\w/.test(t[i+e.length])))return n}return null}}const indentService=Facet.define(),indentUnit=Facet.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some((e=>e!=t[0])))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function getIndentUnit(e){let t=e.facet(indentUnit);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function indentString(e,t){let n="",i=e.tabSize,r=e.facet(indentUnit)[0];if("\t"==r){for(;t>=i;)n+="\t",t-=i;r=" "}for(let e=0;e<t;e++)n+=r;return n}function getIndentation(e,t){e instanceof EditorState&&(e=new IndentContext(e));for(let n of e.state.facet(indentService)){let i=n(e,t);if(void 0!==i)return i}let n=syntaxTree(e.state);return n.length>=t?syntaxIndentation(e,n,t):null}class IndentContext{constructor(e,t={}){this.state=e,this.options=t,this.unit=getIndentUnit(e)}lineAt(e,t=1){let n=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:r}=this.options;return null!=i&&i>=n.from&&i<=n.to?r&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(e,t);return n.slice(e-i,Math.min(n.length,e+100-i))}column(e,t=1){let{text:n,from:i}=this.lineAt(e,t),r=this.countColumn(n,e-i),s=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return s>-1&&(r+=s-this.countColumn(n,n.search(/\S|$/))),r}countColumn(e,t=e.length){return countColumn(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:n,from:i}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let e=r(i);if(e>-1)return e}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(e,t,n){let i=t.resolveStack(n),r=t.resolveInner(n,-1).resolve(n,0).enterUnfinishedNodesBefore(n);if(r!=i.node){let e=[];for(let t=r;t&&(t.from!=i.node.from||t.type!=i.node.type);t=t.parent)e.push(t);for(let t=e.length-1;t>=0;t--)i={node:e[t],next:i}}return indentFor(i,e,n)}function indentFor(e,t,n){for(let i=e;i;i=i.next){let e=indentStrategy(i.node);if(e)return e(TreeIndentContext.create(t,n,i))}return 0}function ignoreClosed(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}function indentStrategy(e){let t=e.type.prop(indentNodeProp);if(t)return t;let n,i=e.firstChild;if(i&&(n=i.type.prop(NodeProp.closedBy))){let t=e.lastChild,i=t&&n.indexOf(t.name)>-1;return e=>delimitedStrategy(e,!0,1,void 0,i&&!ignoreClosed(e)?t.from:void 0)}return null==e.parent?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,t,n){super(e.state,e.options),this.base=e,this.pos=t,this.context=n}get node(){return this.context.node}static create(e,t,n){return new TreeIndentContext(e,t,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let n=e.resolve(t.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(isParent(n,e))break;t=this.state.doc.lineAt(n.from)}return this.lineIndent(t.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(e,t){for(let n=t;n;n=n.parent)if(e==n)return!0;return!1}function bracketedAligned(e){let t=e.node,n=t.childAfter(t.from),i=t.lastChild;if(!n)return null;let r=e.options.simulateBreak,s=e.state.doc.lineAt(n.from),o=null==r||r<=s.from?s.to:Math.min(s.to,r);for(let e=n.to;;){let r=t.childAfter(e);if(!r||r==i)return null;if(!r.type.isSkipped){if(r.from>=o)return null;let e=/^ */.exec(s.text.slice(n.to-s.from))[0].length;return{from:n.from,to:n.to+e}}e=r.to}}function delimitedIndent({closing:e,align:t=!0,units:n=1}){return i=>delimitedStrategy(i,t,n,e)}function delimitedStrategy(e,t,n,i,r){let s=e.textAfter,o=s.match(/^\s*/)[0].length,a=i&&s.slice(o,o+i.length)==i||r==e.pos+o,l=t?bracketedAligned(e):null;return l?a?e.column(l.from):e.column(l.to):e.baseIndent+(a?0:e.unit*n)}const flatIndent=e=>e.baseIndent;function continuedIndent({except:e,units:t=1}={}){return n=>{let i=e&&e.test(n.textAfter);return n.baseIndent+(i?0:t*n.unit)}}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of((e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let n=e.newDoc,{head:i}=e.newSelection.main,r=n.lineAt(i);if(i>r.from+DontIndentBeyond)return e;let s=n.sliceString(r.from,i);if(!t.some((e=>e.test(s))))return e;let{state:o}=e,a=-1,l=[];for(let{head:e}of o.selection.ranges){let t=o.doc.lineAt(e);if(t.from==a)continue;a=t.from;let n=getIndentation(o,t.from);if(null==n)continue;let i=/^\s*/.exec(t.text)[0],r=indentString(o,n);i!=r&&l.push({from:t.from,to:t.from+i.length,insert:r})}return l.length?[e,{changes:l,sequential:!0}]:e}))}const foldService=Facet.define(),foldNodeProp=new NodeProp;function foldInside(e){let t=e.firstChild,n=e.lastChild;return t&&t.to<n.from?{from:t.to,to:n.type.isError?e.to:n.from}:null}function syntaxFolding(e,t,n){let i=syntaxTree(e);if(i.length<n)return null;let r=null;for(let s=i.resolveStack(n,1);s;s=s.next){let o=s.node;if(o.to<=n||o.from>n)continue;if(r&&o.from<t)break;let a=o.type.prop(foldNodeProp);if(a&&(o.to<i.length-50||i.length==e.doc.length||!isUnfinished(o))){let i=a(o,e);i&&i.from<=n&&i.from>=t&&i.to>n&&(r=i)}}return r}function isUnfinished(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function foldable(e,t,n){for(let i of e.facet(foldService)){let r=i(e,t,n);if(r)return r}return syntaxFolding(e,t,n)}function mapRange(e,t){let n=t.mapPos(e.from,1),i=t.mapPos(e.to,-1);return n>=i?void 0:{from:n,to:i}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(e){let t=[];for(let{head:n}of e.state.selection.ranges)t.some((e=>e.from<=n&&e.to>=n))||t.push(e.lineBlockAt(n));return t}const foldState=StateField.define({create:()=>Decoration.none,update(e,t){e=e.map(t.changes);for(let n of t.effects)if(n.is(foldEffect)&&!foldExists(e,n.value.from,n.value.to)){let{preparePlaceholder:i}=t.state.facet(foldConfig),r=i?Decoration.replace({widget:new PreparedFoldWidget(i(t.state,n.value))}):foldWidget;e=e.update({add:[r.range(n.value.from,n.value.to)]})}else n.is(unfoldEffect)&&(e=e.update({filter:(e,t)=>n.value.from!=e||n.value.to!=t,filterFrom:n.value.from,filterTo:n.value.to}));if(t.selection){let n=!1,{head:i}=t.selection.main;e.between(i,i,((e,t)=>{e<i&&t>i&&(n=!0)})),n&&(e=e.update({filterFrom:i,filterTo:i,filter:(e,t)=>t<=i||e>=i}))}return e},provide:e=>EditorView.decorations.from(e),toJSON(e,t){let n=[];return e.between(0,t.doc.length,((e,t)=>{n.push(e,t)})),n},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let n=0;n<e.length;){let i=e[n++],r=e[n++];if("number"!=typeof i||"number"!=typeof r)throw new RangeError("Invalid JSON for fold state");t.push(foldWidget.range(i,r))}return Decoration.set(t,!0)}});function findFold(e,t,n){var i;let r=null;return null===(i=e.field(foldState,!1))||void 0===i||i.between(t,n,((e,t)=>{(!r||r.from>e)&&(r={from:e,to:t})})),r}function foldExists(e,t,n){let i=!1;return e.between(t,t,((e,r)=>{e==t&&r==n&&(i=!0)})),i}function maybeEnable(e,t){return e.field(foldState,!1)?t:t.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=e=>{for(let t of selectedLines(e)){let n=foldable(e.state,t.from,t.to);if(n)return e.dispatch({effects:maybeEnable(e.state,[foldEffect.of(n),announceFold(e,n)])}),!0}return!1},unfoldCode=e=>{if(!e.state.field(foldState,!1))return!1;let t=[];for(let n of selectedLines(e)){let i=findFold(e.state,n.from,n.to);i&&t.push(unfoldEffect.of(i),announceFold(e,i,!1))}return t.length&&e.dispatch({effects:t}),t.length>0};function announceFold(e,t,n=!0){let i=e.state.doc.lineAt(t.from).number,r=e.state.doc.lineAt(t.to).number;return EditorView.announce.of(e.state.phrase(n?"Folded lines":"Unfolded lines")+" "+i+" "+e.state.phrase("to")+" "+r+".")}const foldAll=e=>{let{state:t}=e,n=[];for(let i=0;i<t.doc.length;){let r=e.lineBlockAt(i),s=foldable(t,r.from,r.to);s&&n.push(foldEffect.of(s)),i=(s?e.lineBlockAt(s.to):r).to+1}return n.length&&e.dispatch({effects:maybeEnable(e.state,n)}),!!n.length},unfoldAll=e=>{let t=e.state.field(foldState,!1);if(!t||!t.size)return!1;let n=[];return t.between(0,e.state.doc.length,((e,t)=>{n.push(unfoldEffect.of({from:e,to:t}))})),e.dispatch({effects:n}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},foldConfig=Facet.define({combine:e=>combineConfig(e,defaultConfig)});function codeFolding(e){return[foldState,baseTheme$1]}function widgetToDOM(e,t){let{state:n}=e,i=n.facet(foldConfig),r=t=>{let n=e.lineBlockAt(e.posAtDOM(t.target)),i=findFold(e.state,n.from,n.to);i&&e.dispatch({effects:unfoldEffect.of(i)}),t.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(e,r,t);let s=document.createElement("span");return s.textContent=i.placeholderText,s.setAttribute("aria-label",n.phrase("folded code")),s.title=n.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=r,s}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(e){return widgetToDOM(e,null)}}});class PreparedFoldWidget extends WidgetType{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return widgetToDOM(e,this.value)}}const foldGutterDefaults={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function foldGutter(e={}){let t=Object.assign(Object.assign({},foldGutterDefaults),e),n=new FoldMarker(t,!0),i=new FoldMarker(t,!1),r=ViewPlugin.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(language)!=e.state.facet(language)||e.startState.field(foldState,!1)!=e.state.field(foldState,!1)||syntaxTree(e.startState)!=syntaxTree(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new RangeSetBuilder;for(let r of e.viewportLineBlocks){let s=findFold(e.state,r.from,r.to)?i:foldable(e.state,r.from,r.to)?n:null;s&&t.add(r.from,r.from,s)}return t.finish()}}),{domEventHandlers:s}=t;return[r,gutter({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(r))||void 0===t?void 0:t.markers)||RangeSet.empty},initialSpacer:()=>new FoldMarker(t,!1),domEventHandlers:Object.assign(Object.assign({},s),{click:(e,t,n)=>{if(s.click&&s.click(e,t,n))return!0;let i=findFold(e.state,t.from,t.to);if(i)return e.dispatch({effects:unfoldEffect.of(i)}),!0;let r=foldable(e.state,t.from,t.to);return!!r&&(e.dispatch({effects:foldEffect.of(r)}),!0)}})}),codeFolding()]}const baseTheme$1=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,t){let n;function i(e){let t=StyleModule.newName();return(n||(n=Object.create(null)))["."+t]=e,t}this.specs=e;const r="string"==typeof t.all?t.all:t.all?i(t.all):void 0,s=t.scope;this.scope=s instanceof Language?e=>e.prop(languageDataProp)==s.data:s?e=>e==s:void 0,this.style=tagHighlighter(e.map((e=>({tag:e.tag,class:e.class||i(Object.assign({},e,{tag:null}))}))),{all:r}).style,this.module=n?new StyleModule(n):null,this.themeType=t.themeType}static define(e,t){return new HighlightStyle(e,t||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine:e=>e.length?[e[0]]:null});function getHighlighters(e){let t=e.facet(highlighterFacet);return t.length?t:e.facet(fallbackHighlighter)}function syntaxHighlighting(e,t){let n,i=[treeHighlighter];return e instanceof HighlightStyle&&(e.module&&i.push(EditorView.styleModule.of(e.module)),n=e.themeType),(null==t?void 0:t.fallback)?i.push(fallbackHighlighter.of(e)):n?i.push(highlighterFacet.computeN([EditorView.darkTheme],(t=>t.facet(EditorView.darkTheme)==("dark"==n)?[e]:[]))):i.push(highlighterFacet.of(e)),i}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=syntaxTree(e.state),n=getHighlighters(e.state),i=n!=getHighlighters(e.startState),{viewport:r}=e.view,s=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!i&&t.type==this.tree.type&&s>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=s):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,n),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return Decoration.none;let n=new RangeSetBuilder;for(let{from:i,to:r}of e.visibleRanges)highlightTree(this.tree,t,((e,t,i)=>{n.add(e,t,this.markCache[i]||(this.markCache[i]=Decoration.mark({class:i})))}),i,r);return n.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:e=>e.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags$1.meta,color:"#404740"},{tag:tags$1.link,textDecoration:"underline"},{tag:tags$1.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags$1.emphasis,fontStyle:"italic"},{tag:tags$1.strong,fontWeight:"bold"},{tag:tags$1.strikethrough,textDecoration:"line-through"},{tag:tags$1.keyword,color:"#708"},{tag:[tags$1.atom,tags$1.bool,tags$1.url,tags$1.contentSeparator,tags$1.labelName],color:"#219"},{tag:[tags$1.literal,tags$1.inserted],color:"#164"},{tag:[tags$1.string,tags$1.deleted],color:"#a11"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],color:"#e40"},{tag:tags$1.definition(tags$1.variableName),color:"#00f"},{tag:tags$1.local(tags$1.variableName),color:"#30a"},{tag:[tags$1.typeName,tags$1.namespace],color:"#085"},{tag:tags$1.className,color:"#167"},{tag:[tags$1.special(tags$1.variableName),tags$1.macroName],color:"#256"},{tag:tags$1.definition(tags$1.propertyName),color:"#00c"},{tag:tags$1.comment,color:"#940"},{tag:tags$1.invalid,color:"#f00"}]),baseTheme$2=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine:e=>combineConfig(e,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(e){let t=[],n=e.matched?matchingMark:nonmatchingMark;return t.push(n.range(e.start.from,e.start.to)),e.end&&t.push(n.range(e.end.from,e.end.to)),t}const bracketMatchingState=StateField.define({create:()=>Decoration.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let n=[],i=t.state.facet(bracketMatchingConfig);for(let e of t.state.selection.ranges){if(!e.empty)continue;let r=matchBrackets(t.state,e.head,-1,i)||e.head>0&&matchBrackets(t.state,e.head-1,1,i)||i.afterCursor&&(matchBrackets(t.state,e.head,1,i)||e.head<t.state.doc.length&&matchBrackets(t.state,e.head+1,-1,i));r&&(n=n.concat(i.renderMatch(r,t.state)))}return Decoration.set(n,!0)},provide:e=>EditorView.decorations.from(e)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$2];function bracketMatching(e={}){return[bracketMatchingConfig.of(e),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(e,t,n){let i=e.prop(t<0?NodeProp.openedBy:NodeProp.closedBy);if(i)return i;if(1==e.name.length){let i=n.indexOf(e.name);if(i>-1&&i%2==(t<0?1:0))return[n[i+t]]}return null}function findHandle(e){let t=e.type.prop(bracketMatchingHandle);return t?t(e.node):e}function matchBrackets(e,t,n,i={}){let r=i.maxScanDistance||DefaultScanDist,s=i.brackets||DefaultBrackets,o=syntaxTree(e),a=o.resolveInner(t,n);for(let i=a;i;i=i.parent){let r=matchingNodes(i.type,n,s);if(r&&i.from<i.to){let o=findHandle(i);if(o&&(n>0?t>=o.from&&t<o.to:t>o.from&&t<=o.to))return matchMarkedBrackets(e,t,n,i,o,r,s)}}return matchPlainBrackets(e,t,n,o,a.type,r,s)}function matchMarkedBrackets(e,t,n,i,r,s,o){let a=i.parent,l={from:r.from,to:r.to},c=0,d=null==a?void 0:a.cursor();if(d&&(n<0?d.childBefore(i.from):d.childAfter(i.to)))do{if(n<0?d.to<=i.from:d.from>=i.to){if(0==c&&s.indexOf(d.type.name)>-1&&d.from<d.to){let e=findHandle(d);return{start:l,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}if(matchingNodes(d.type,n,o))c++;else if(matchingNodes(d.type,-n,o)){if(0==c){let e=findHandle(d);return{start:l,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}c--}}}while(n<0?d.prevSibling():d.nextSibling());return{start:l,matched:!1}}function matchPlainBrackets(e,t,n,i,r,s,o){let a=n<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=n>0)return null;let c={from:n<0?t-1:t,to:n>0?t+1:t},d=e.doc.iterRange(t,n>0?e.doc.length:0),u=0;for(let e=0;!d.next().done&&e<=s;){let s=d.value;n<0&&(e+=s.length);let a=t+e*n;for(let e=n>0?0:s.length-1,t=n>0?s.length:-1;e!=t;e+=n){let t=o.indexOf(s[e]);if(!(t<0||i.resolveInner(a+e,1).type!=r))if(t%2==0==n>0)u++;else{if(1==u)return{start:c,end:{from:a+e,to:a+e+1},matched:t>>1==l>>1};u--}}n>0&&(e+=s.length)}return d.done?{start:c,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[e]=createTokenType(noTokens,t);function warnForPart(e,t){warned.indexOf(e)>-1||(warned.push(e),console.warn(t))}function createTokenType(e,t){let n=[];for(let i of t.split(" ")){let t=[];for(let n of i.split(".")){let i=e[n]||tags$1[n];i?"function"==typeof i?t.length?t=t.map(i):warnForPart(n,"Modifier "+n+" used at start of tag"):t.length?warnForPart(n,"Tag "+n+" used as modifier"):t=Array.isArray(i)?i:[i]:warnForPart(n,"Unknown highlighting tag "+n)}for(let e of t)n.push(e)}if(!n.length)return 0;let i=t.replace(/ /g,"_"),r=i+" "+n.map((e=>e.id)),s=byTag[r];if(s)return s.id;let o=byTag[r]=NodeType.define({id:typeArray.length,name:i,props:[styleTags({[i]:n})]});return typeArray.push(o),o.id}Direction.RTL,Direction.LTR;const toggleComment=e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),i=getConfig(e.state,n.from);return i.line?toggleLineComment(e):!!i.block&&toggleBlockCommentByLine(e)};function command(e,t){return({state:n,dispatch:i})=>{if(n.readOnly)return!1;let r=e(t,n);return!!r&&(i(n.update(r)),!0)}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command(((e,t)=>changeBlockComment(e,t,selectedLineRanges(t))),0);function getConfig(e,t){let n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}const SearchMargin=50;function findBlockComment(e,{open:t,close:n},i,r){let s,o,a=e.sliceDoc(i-SearchMargin,i),l=e.sliceDoc(r,r+SearchMargin),c=/\s*$/.exec(a)[0].length,d=/^\s*/.exec(l)[0].length,u=a.length-c;if(a.slice(u-t.length,u)==t&&l.slice(d,d+n.length)==n)return{open:{pos:i-c,margin:c&&1},close:{pos:r+d,margin:d&&1}};r-i<=2*SearchMargin?s=o=e.sliceDoc(i,r):(s=e.sliceDoc(i,i+SearchMargin),o=e.sliceDoc(r-SearchMargin,r));let h=/^\s*/.exec(s)[0].length,m=/\s*$/.exec(o)[0].length,g=o.length-m-n.length;return s.slice(h,h+t.length)==t&&o.slice(g,g+n.length)==n?{open:{pos:i+h+t.length,margin:/\s/.test(s.charAt(h+t.length))?1:0},close:{pos:r-m-n.length,margin:/\s/.test(o.charAt(g-1))?1:0}}:null}function selectedLineRanges(e){let t=[];for(let n of e.selection.ranges){let i=e.doc.lineAt(n.from),r=n.to<=i.to?i:e.doc.lineAt(n.to);r.from>i.from&&r.from==n.to&&(r=n.to==i.to+1?i:e.doc.lineAt(n.to-1));let s=t.length-1;s>=0&&t[s].to>i.from?t[s].to=r.to:t.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:r.to})}return t}function changeBlockComment(e,t,n=t.selection.ranges){let i=n.map((e=>getConfig(t,e.from).block));if(!i.every((e=>e)))return null;let r=n.map(((e,n)=>findBlockComment(t,i[n],e.from,e.to)));if(2!=e&&!r.every((e=>e)))return{changes:t.changes(n.map(((e,t)=>r[t]?[]:[{from:e.from,insert:i[t].open+" "},{from:e.to,insert:" "+i[t].close}])))};if(1!=e&&r.some((e=>e))){let e=[];for(let t,n=0;n<r.length;n++)if(t=r[n]){let r=i[n],{open:s,close:o}=t;e.push({from:s.pos-r.open.length,to:s.pos+s.margin},{from:o.pos-o.margin,to:o.pos+r.close.length})}return{changes:e}}return null}function changeLineComment(e,t,n=t.selection.ranges){let i=[],r=-1;for(let{from:e,to:s}of n){let n=i.length,o=1e9,a=getConfig(t,e).line;if(a){for(let n=e;n<=s;){let l=t.doc.lineAt(n);if(l.from>r&&(e==s||s>l.from)){r=l.from;let e=/^\s*/.exec(l.text)[0].length,t=e==l.length,n=l.text.slice(e,e+a.length)==a?e:-1;e<l.text.length&&e<o&&(o=e),i.push({line:l,comment:n,token:a,indent:e,empty:t,single:!1})}n=l.to+1}if(o<1e9)for(let e=n;e<i.length;e++)i[e].indent<i[e].line.text.length&&(i[e].indent=o);i.length==n+1&&(i[n].single=!0)}}if(2!=e&&i.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:n,indent:r,empty:s,single:o}of i)!o&&s||e.push({from:t.from+r,insert:n+" "});let n=t.changes(e);return{changes:n,selection:t.selection.map(n,1)}}if(1!=e&&i.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:n,token:r}of i)if(n>=0){let i=t.from+n,s=i+r.length;" "==t.text[s-t.from]&&s++,e.push({from:i,to:s})}return{changes:e}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine:e=>combineConfig(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(n,i)=>e(n,i)||t(n,i)})}),historyField_=StateField.define({create:()=>HistoryState.empty,update(e,t){let n=t.state.facet(historyConfig),i=t.annotation(fromHistory);if(i){let r=HistEvent.fromTransaction(t,i.selection),s=i.side,o=0==s?e.undone:e.done;return o=r?updateBranch(o,o.length,n.minDepth,r):addSelection(o,t.startState.selection),new HistoryState(0==s?i.rest:o,0==s?o:i.rest)}let r=t.annotation(isolateHistory);if("full"!=r&&"before"!=r||(e=e.isolate()),!1===t.annotation(Transaction.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let s=HistEvent.fromTransaction(t),o=t.annotation(Transaction.time),a=t.annotation(Transaction.userEvent);return s?e=e.addChanges(s,o,a,n,t):t.selection&&(e=e.addSelection(t.startState.selection,o,a,n.newGroupDelay)),"full"!=r&&"after"!=r||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new HistoryState(e.done.map(HistEvent.fromJSON),e.undone.map(HistEvent.fromJSON))});function history(e={}){return[historyField_,historyConfig.of(e),EditorView.domEventHandlers({beforeinput(e,t){let n="historyUndo"==e.inputType?undo:"historyRedo"==e.inputType?redo:null;return!!n&&(e.preventDefault(),n(t))}})]}function cmd(e,t){return function({state:n,dispatch:i}){if(!t&&n.readOnly)return!1;let r=n.field(historyField_,!1);if(!r)return!1;let s=r.pop(e,n,t);return!!s&&(i(s),!0)}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,t,n,i,r){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=i,this.selectionsAfter=r}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(n=this.startSelection)||void 0===n?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,t){let n=none$2;for(let t of e.startState.facet(invertedEffects)){let i=t(e);i.length&&(n=n.concat(i))}return!n.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,none$2)}static selection(e){return new HistEvent(void 0,none$2,void 0,void 0,e)}}function updateBranch(e,t,n,i){let r=t+1>n+20?t-n-1:0,s=e.slice(r,t);return s.push(i),s}function isAdjacent(e,t){let n=[],i=!1;return e.iterChangedRanges(((e,t)=>n.push(e,t))),t.iterChangedRanges(((e,t,r,s)=>{for(let e=0;e<n.length;){let t=n[e++],o=n[e++];s>=t&&r<=o&&(i=!0)}})),i}function eqSelectionShape(e,t){return e.ranges.length==t.ranges.length&&0===e.ranges.filter(((e,n)=>e.empty!=t.ranges[n].empty)).length}function conc(e,t){return e.length?t.length?e.concat(t):e:t}const none$2=[],MaxSelectionsPerEvent=200;function addSelection(e,t){if(e.length){let n=e[e.length-1],i=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-MaxSelectionsPerEvent));return i.length&&i[i.length-1].eq(t)?e:(i.push(t),updateBranch(e,e.length-1,1e9,n.setSelAfter(i)))}return[HistEvent.selection([t])]}function popSelection(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function addMappingToBranch(e,t){if(!e.length)return e;let n=e.length,i=none$2;for(;n;){let r=mapEvent(e[n-1],t,i);if(r.changes&&!r.changes.empty||r.effects.length){let t=e.slice(0,n);return t[n-1]=r,t}t=r.mapped,n--,i=r.selectionsAfter}return i.length?[HistEvent.selection(i)]:none$2}function mapEvent(e,t,n){let i=conc(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):none$2,n);if(!e.changes)return HistEvent.selection(i);let r=e.changes.map(t),s=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(s):s;return new HistEvent(r,StateEffect.mapEffects(e.effects,t),o,e.startSelection.map(s),i)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,t,n=0,i=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,t,n,i,r){let s=this.done,o=s[s.length-1];return s=o&&o.changes&&!o.changes.empty&&e.changes&&(!n||joinableUserEvent.test(n))&&(!o.selectionsAfter.length&&t-this.prevTime<i.newGroupDelay&&i.joinToEvent(r,isAdjacent(o.changes,e.changes))||"input.type.compose"==n)?updateBranch(s,s.length-1,i.minDepth,new HistEvent(e.changes.compose(o.changes),conc(StateEffect.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,none$2)):updateBranch(s,s.length,i.minDepth,e),new HistoryState(s,none$2,t,n)}addSelection(e,t,n,i){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:none$2;return r.length>0&&t-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&eqSelectionShape(r[r.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,t,n)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let i=0==e?this.done:this.undone;if(0==i.length)return null;let r=i[i.length-1],s=r.selectionsAfter[0]||t.selection;if(n&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(i),selection:s}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let n=1==i.length?none$2:i.slice(0,i.length-1);return r.mapped&&(n=addMappingToBranch(n,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:fromHistory.of({side:e,rest:n,selection:s}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}HistoryState.empty=new HistoryState(none$2,none$2);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(e,t){return EditorSelection.create(e.ranges.map(t),e.mainIndex)}function setSel(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:e,dispatch:t},n){let i=updateSel(e.selection,n);return!i.eq(e.selection,!0)&&(t(setSel(e,i)),!0)}function rangeEnd(e,t){return EditorSelection.cursor(t?e.to:e.from)}function cursorByChar(e,t){return moveSel(e,(n=>n.empty?e.moveByChar(n,t):rangeEnd(n,t)))}function ltrAtCursor(e){return e.textDirectionAt(e.state.selection.main.head)==Direction.LTR}const cursorCharLeft=e=>cursorByChar(e,!ltrAtCursor(e)),cursorCharRight=e=>cursorByChar(e,ltrAtCursor(e));function cursorByGroup(e,t){return moveSel(e,(n=>n.empty?e.moveByGroup(n,t):rangeEnd(n,t)))}const cursorGroupLeft=e=>cursorByGroup(e,!ltrAtCursor(e)),cursorGroupRight=e=>cursorByGroup(e,ltrAtCursor(e));function interestingNode(e,t,n){if(t.type.prop(n))return!0;let i=t.to-t.from;return i&&(i>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function moveBySyntax(e,t,n){let i,r,s=syntaxTree(e).resolveInner(t.head),o=n?NodeProp.closedBy:NodeProp.openedBy;for(let i=t.head;;){let t=n?s.childAfter(i):s.childBefore(i);if(!t)break;interestingNode(e,t,o)?s=t:i=n?t.to:t.from}return r=s.type.prop(o)&&(i=n?matchBrackets(e,s.from,1):matchBrackets(e,s.to,-1))&&i.matched?n?i.end.to:i.end.from:n?s.to:s.from,EditorSelection.cursor(r,n?-1:1)}const cursorSyntaxLeft=e=>moveSel(e,(t=>moveBySyntax(e.state,t,!ltrAtCursor(e)))),cursorSyntaxRight=e=>moveSel(e,(t=>moveBySyntax(e.state,t,ltrAtCursor(e))));function cursorByLine(e,t){return moveSel(e,(n=>{if(!n.empty)return rangeEnd(n,t);let i=e.moveVertically(n,t);return i.head!=n.head?i:e.moveToLineBoundary(n,t)}))}const cursorLineUp=e=>cursorByLine(e,!1),cursorLineDown=e=>cursorByLine(e,!0);function pageInfo(e){let t,n=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,i=0,r=0;if(n){for(let t of e.state.facet(EditorView.scrollMargins)){let n=t(e);(null==n?void 0:n.top)&&(i=Math.max(null==n?void 0:n.top,i)),(null==n?void 0:n.bottom)&&(r=Math.max(null==n?void 0:n.bottom,r))}t=e.scrollDOM.clientHeight-i-r}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:i,marginBottom:r,selfScroll:n,height:Math.max(e.defaultLineHeight,t-5)}}function cursorByPage(e,t){let n,i=pageInfo(e),{state:r}=e,s=updateSel(r.selection,(n=>n.empty?e.moveVertically(n,t,i.height):rangeEnd(n,t)));if(s.eq(r.selection))return!1;if(i.selfScroll){let t=e.coordsAtPos(r.selection.main.head),o=e.scrollDOM.getBoundingClientRect(),a=o.top+i.marginTop,l=o.bottom-i.marginBottom;t&&t.top>a&&t.bottom<l&&(n=EditorView.scrollIntoView(s.main.head,{y:"start",yMargin:t.top-a}))}return e.dispatch(setSel(r,s),{effects:n}),!0}const cursorPageUp=e=>cursorByPage(e,!1),cursorPageDown=e=>cursorByPage(e,!0);function moveByLineBoundary(e,t,n){let i=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,n);if(r.head==t.head&&r.head!=(n?i.to:i.from)&&(r=e.moveToLineBoundary(t,n,!1)),!n&&r.head==i.from&&i.length){let n=/^\s*/.exec(e.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;n&&t.head!=i.from+n&&(r=EditorSelection.cursor(i.from+n))}return r}const cursorLineBoundaryForward=e=>moveSel(e,(t=>moveByLineBoundary(e,t,!0))),cursorLineBoundaryBackward=e=>moveSel(e,(t=>moveByLineBoundary(e,t,!1))),cursorLineBoundaryLeft=e=>moveSel(e,(t=>moveByLineBoundary(e,t,!ltrAtCursor(e)))),cursorLineBoundaryRight=e=>moveSel(e,(t=>moveByLineBoundary(e,t,ltrAtCursor(e)))),cursorLineStart=e=>moveSel(e,(t=>EditorSelection.cursor(e.lineBlockAt(t.head).from,1))),cursorLineEnd=e=>moveSel(e,(t=>EditorSelection.cursor(e.lineBlockAt(t.head).to,-1)));function toMatchingBracket(e,t,n){let i=!1,r=updateSel(e.selection,(t=>{let n=matchBrackets(e,t.head,-1)||matchBrackets(e,t.head,1)||t.head>0&&matchBrackets(e,t.head-1,1)||t.head<e.doc.length&&matchBrackets(e,t.head+1,-1);if(!n||!n.end)return t;i=!0;let r=n.start.from==t.head?n.end.to:n.end.from;return EditorSelection.cursor(r)}));return!!i&&(t(setSel(e,r)),!0)}const cursorMatchingBracket=({state:e,dispatch:t})=>toMatchingBracket(e,t);function extendSel(e,t){let n=updateSel(e.state.selection,(e=>{let n=t(e);return EditorSelection.range(e.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)}));return!n.eq(e.state.selection)&&(e.dispatch(setSel(e.state,n)),!0)}function selectByChar(e,t){return extendSel(e,(n=>e.moveByChar(n,t)))}const selectCharLeft=e=>selectByChar(e,!ltrAtCursor(e)),selectCharRight=e=>selectByChar(e,ltrAtCursor(e));function selectByGroup(e,t){return extendSel(e,(n=>e.moveByGroup(n,t)))}const selectGroupLeft=e=>selectByGroup(e,!ltrAtCursor(e)),selectGroupRight=e=>selectByGroup(e,ltrAtCursor(e)),selectSyntaxLeft=e=>extendSel(e,(t=>moveBySyntax(e.state,t,!ltrAtCursor(e)))),selectSyntaxRight=e=>extendSel(e,(t=>moveBySyntax(e.state,t,ltrAtCursor(e))));function selectByLine(e,t){return extendSel(e,(n=>e.moveVertically(n,t)))}const selectLineUp=e=>selectByLine(e,!1),selectLineDown=e=>selectByLine(e,!0);function selectByPage(e,t){return extendSel(e,(n=>e.moveVertically(n,t,pageInfo(e).height)))}const selectPageUp=e=>selectByPage(e,!1),selectPageDown=e=>selectByPage(e,!0),selectLineBoundaryForward=e=>extendSel(e,(t=>moveByLineBoundary(e,t,!0))),selectLineBoundaryBackward=e=>extendSel(e,(t=>moveByLineBoundary(e,t,!1))),selectLineBoundaryLeft=e=>extendSel(e,(t=>moveByLineBoundary(e,t,!ltrAtCursor(e)))),selectLineBoundaryRight=e=>extendSel(e,(t=>moveByLineBoundary(e,t,ltrAtCursor(e)))),selectLineStart=e=>extendSel(e,(t=>EditorSelection.cursor(e.lineBlockAt(t.head).from))),selectLineEnd=e=>extendSel(e,(t=>EditorSelection.cursor(e.lineBlockAt(t.head).to))),cursorDocStart=({state:e,dispatch:t})=>(t(setSel(e,{anchor:0})),!0),cursorDocEnd=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.doc.length})),!0),selectDocStart=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.selection.main.anchor,head:0})),!0),selectDocEnd=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),selectAll=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),selectLine=({state:e,dispatch:t})=>{let n=selectedLineBlocks(e).map((({from:t,to:n})=>EditorSelection.range(t,Math.min(n+1,e.doc.length))));return t(e.update({selection:EditorSelection.create(n),userEvent:"select"})),!0},selectParentSyntax=({state:e,dispatch:t})=>{let n=updateSel(e.selection,(t=>{let n=syntaxTree(e),i=n.resolveStack(t.from,1);if(t.empty){let e=n.resolveStack(t.from,-1);e.node.from>=i.node.from&&e.node.to<=i.node.to&&(i=e)}for(let e=i;e;e=e.next){let{node:n}=e;if((n.from<t.from&&n.to>=t.to||n.to>t.to&&n.from<=t.from)&&e.next)return EditorSelection.range(n.to,n.from)}return t}));return!n.eq(e.selection)&&(t(setSel(e,n)),!0)},simplifySelection=({state:e,dispatch:t})=>{let n=e.selection,i=null;return n.ranges.length>1?i=EditorSelection.create([n.main]):n.main.empty||(i=EditorSelection.create([EditorSelection.cursor(n.main.head)])),!!i&&(t(setSel(e,i)),!0)};function deleteBy(e,t){if(e.state.readOnly)return!1;let n="delete.selection",{state:i}=e,r=i.changeByRange((i=>{let{from:r,to:s}=i;if(r==s){let o=t(i);o<r?(n="delete.backward",o=skipAtomic(e,o,!1)):o>r&&(n="delete.forward",o=skipAtomic(e,o,!0)),r=Math.min(r,o),s=Math.max(s,o)}else r=skipAtomic(e,r,!1),s=skipAtomic(e,s,!0);return r==s?{range:i}:{changes:{from:r,to:s},range:EditorSelection.cursor(r,r<i.head?-1:1)}}));return!r.changes.empty&&(e.dispatch(i.update(r,{scrollIntoView:!0,userEvent:n,effects:"delete.selection"==n?EditorView.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(e,t,n){if(e instanceof EditorView)for(let i of e.state.facet(EditorView.atomicRanges).map((t=>t(e))))i.between(t,t,((e,i)=>{e<t&&i>t&&(t=n?i:e)}));return t}const deleteByChar=(e,t,n)=>deleteBy(e,(i=>{let r,s,o=i.from,{state:a}=e,l=a.doc.lineAt(o);if(n&&!t&&o>l.from&&o<l.from+200&&!/[^ \t]/.test(r=l.text.slice(0,o-l.from))){if("\t"==r[r.length-1])return o-1;let e=countColumn(r,a.tabSize)%getIndentUnit(a)||getIndentUnit(a);for(let t=0;t<e&&" "==r[r.length-1-t];t++)o--;s=o}else s=findClusterBreak(l.text,o-l.from,t,t)+l.from,s==o&&l.number!=(t?a.doc.lines:1)?s+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(l.text.slice(s-l.from,o-l.from))&&(s=findClusterBreak(l.text,s-l.from,!1,!1)+l.from);return s})),deleteCharBackward=e=>deleteByChar(e,!1,!0),deleteCharForward=e=>deleteByChar(e,!0,!1),deleteByGroup=(e,t)=>deleteBy(e,(n=>{let i=n.head,{state:r}=e,s=r.doc.lineAt(i),o=r.charCategorizer(i);for(let e=null;;){if(i==(t?s.to:s.from)){i==n.head&&s.number!=(t?r.doc.lines:1)&&(i+=t?1:-1);break}let a=findClusterBreak(s.text,i-s.from,t)+s.from,l=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),c=o(l);if(null!=e&&c!=e)break;" "==l&&i==n.head||(e=c),i=a}return i})),deleteGroupBackward=e=>deleteByGroup(e,!1),deleteGroupForward=e=>deleteByGroup(e,!0),deleteToLineEnd=e=>deleteBy(e,(t=>{let n=e.lineBlockAt(t.head).to;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)})),deleteLineBoundaryBackward=e=>deleteBy(e,(t=>{let n=e.moveToLineBoundary(t,!1).head;return t.head>n?n:Math.max(0,t.head-1)})),deleteLineBoundaryForward=e=>deleteBy(e,(t=>{let n=e.moveToLineBoundary(t,!0).head;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)})),splitLine=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:Text.of(["",""])},range:EditorSelection.cursor(e.from)})));return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let n=t.from,i=e.doc.lineAt(n),r=n==i.from?n-1:findClusterBreak(i.text,n-i.from,!1)+i.from,s=n==i.to?n+1:findClusterBreak(i.text,n-i.from,!0)+i.from;return{changes:{from:r,to:s,insert:e.doc.slice(n,s).append(e.doc.slice(r,n))},range:EditorSelection.cursor(s)}}));return!n.changes.empty&&(t(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(e){let t=[],n=-1;for(let i of e.selection.ranges){let r=e.doc.lineAt(i.from),s=e.doc.lineAt(i.to);if(i.empty||i.to!=s.from||(s=e.doc.lineAt(i.to-1)),n>=r.number){let e=t[t.length-1];e.to=s.to,e.ranges.push(i)}else t.push({from:r.from,to:s.to,ranges:[i]});n=s.number+1}return t}function moveLine(e,t,n){if(e.readOnly)return!1;let i=[],r=[];for(let t of selectedLineBlocks(e)){if(n?t.to==e.doc.length:0==t.from)continue;let s=e.doc.lineAt(n?t.to+1:t.from-1),o=s.length+1;if(n){i.push({from:t.to,to:s.to},{from:t.from,insert:s.text+e.lineBreak});for(let n of t.ranges)r.push(EditorSelection.range(Math.min(e.doc.length,n.anchor+o),Math.min(e.doc.length,n.head+o)))}else{i.push({from:s.from,to:t.from},{from:t.to,insert:e.lineBreak+s.text});for(let e of t.ranges)r.push(EditorSelection.range(e.anchor-o,e.head-o))}}return!!i.length&&(t(e.update({changes:i,scrollIntoView:!0,selection:EditorSelection.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0)}const moveLineUp=({state:e,dispatch:t})=>moveLine(e,t,!1),moveLineDown=({state:e,dispatch:t})=>moveLine(e,t,!0);function copyLine(e,t,n){if(e.readOnly)return!1;let i=[];for(let t of selectedLineBlocks(e))n?i.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):i.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:e,dispatch:t})=>copyLine(e,t,!1),copyLineDown=({state:e,dispatch:t})=>copyLine(e,t,!0),deleteLine=e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(selectedLineBlocks(t).map((({from:e,to:n})=>(e>0?e--:n<t.doc.length&&n++,{from:e,to:n})))),i=updateSel(t.selection,(t=>{let n;if(e.lineWrapping){let i=e.lineBlockAt(t.head),r=e.coordsAtPos(t.head,t.assoc||1);r&&(n=i.bottom+e.documentTop-r.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,n)})).map(n);return e.dispatch({changes:n,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n,i=syntaxTree(e).resolveInner(t),r=i.childBefore(t),s=i.childAfter(t);return r&&s&&r.to<=t&&s.from>=t&&(n=r.type.prop(NodeProp.closedBy))&&n.indexOf(s.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(s.from).from&&!/\S/.test(e.sliceDoc(r.to,s.from))?{from:r.to,to:s.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let i=t.changeByRange((n=>{let{from:i,to:r}=n,s=t.doc.lineAt(i),o=!e&&i==r&&isBetweenBrackets(t,i);e&&(i=r=(r<=s.to?s:t.doc.lineAt(r)).to);let a=new IndentContext(t,{simulateBreak:i,simulateDoubleBreak:!!o}),l=getIndentation(a,i);for(null==l&&(l=countColumn(/^\s*/.exec(t.doc.lineAt(i).text)[0],t.tabSize));r<s.to&&/\s/.test(s.text[r-s.from]);)r++;o?({from:i,to:r}=o):i>s.from&&i<s.from+100&&!/\S/.test(s.text.slice(0,i))&&(i=s.from);let c=["",indentString(t,l)];return o&&c.push(indentString(t,a.lineIndent(s.from,-1))),{changes:{from:i,to:r,insert:Text.of(c)},range:EditorSelection.cursor(i+1+c[1].length)}}));return n(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(e,t){let n=-1;return e.changeByRange((i=>{let r=[];for(let s=i.from;s<=i.to;){let o=e.doc.lineAt(s);o.number>n&&(i.empty||i.to>o.from)&&(t(o,r,i),n=o.number),s=o.to+1}let s=e.changes(r);return{changes:r,range:EditorSelection.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}}))}const indentSelection=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),i=new IndentContext(e,{overrideIndentation:e=>{let t=n[e];return null==t?-1:t}}),r=changeBySelectedLine(e,((t,r,s)=>{let o=getIndentation(i,t.from);if(null==o)return;/\S/.test(t.text)||(o=0);let a=/^\s*/.exec(t.text)[0],l=indentString(e,o);(a!=l||s.from<t.from+a.length)&&(n[t.from]=o,r.push({from:t.from,to:t.from+a.length,insert:l}))}));return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0},indentMore=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(changeBySelectedLine(e,((t,n)=>{n.push({from:t.from,insert:e.facet(indentUnit)})})),{userEvent:"input.indent"})),!0),indentLess=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(changeBySelectedLine(e,((t,n)=>{let i=/^\s*/.exec(t.text)[0];if(!i)return;let r=countColumn(i,e.tabSize),s=0,o=indentString(e,Math.max(0,r-getIndentUnit(e)));for(;s<i.length&&s<o.length&&i.charCodeAt(s)==o.charCodeAt(s);)s++;n.push({from:t.from+s,to:t.from+i.length,insert:o.slice(s)})})),{userEvent:"delete.dedent"})),!0),toggleTabFocusMode=e=>(e.setTabFocusMode(),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent,shift:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward},{mac:"Mod-Delete",run:deleteLineBoundaryForward}].concat(emacsStyleKeymap.map((e=>({mac:e.key,run:e.run,shift:e.shift})))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment},{key:"Ctrl-m",mac:"Shift-Alt-m",run:toggleTabFocusMode}].concat(standardKeymap);class CompletionContext{constructor(e,t,n,i){this.state=e,this.pos=t,this.explicit=n,this.view=i,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=syntaxTree(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),i=t.text.slice(n-t.from,this.pos-t.from),r=i.search(ensureAnchor(e,!1));return r<0?null:{from:n+r,to:this.pos,text:i.slice(r)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,n){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function toSet(e){let t=Object.keys(e).join(""),n=/\w/.test(t);return n&&(t=t.replace(/\w/g,"")),"["+(n?"\\w":"")+t.replace(/[^\w\s]/g,"\\$&")+"]"}function prefixMatch(e){let t=Object.create(null),n=Object.create(null);for(let{label:i}of e){t[i[0]]=!0;for(let e=1;e<i.length;e++)n[i[e]]=!0}let i=toSet(t)+toSet(n)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function completeFromList(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[n,i]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:prefixMatch(t);return e=>{let r=e.matchBefore(i);return r||e.explicit?{from:r?r.from:e.pos,options:t,validFor:n}:null}}function ifNotIn(e,t){return n=>{for(let t=syntaxTree(n.state).resolveInner(n.pos,-1);t;t=t.parent){if(e.indexOf(t.name)>-1)return null;if(t.type.isTop)break}return t(n)}}class Option{constructor(e,t,n,i){this.completion=e,this.source=t,this.match=n,this.score=i}}function cur(e){return e.selection.main.from}function ensureAnchor(e,t){var n;let{source:i}=e,r=t&&"^"!=i[0],s="$"!=i[i.length-1];return r||s?new RegExp((r?"^":"")+"(?:"+i+")"+(s?"$":""),null!==(n=e.flags)&&void 0!==n?n:e.ignoreCase?"i":""):e}const pickedCompletion=Annotation.define();function insertCompletionText(e,t,n,i){let{main:r}=e.selection,s=n-r.from,o=i-r.from;return Object.assign(Object.assign({},e.changeByRange((a=>{if(a!=r&&n!=i&&e.sliceDoc(a.from+s,a.from+o)!=e.sliceDoc(n,i))return{range:a};let l=e.toText(t);return{changes:{from:a.from+s,to:i==r.from?a.to:a.from+o,insert:l},range:EditorSelection.cursor(a.from+s+l.length)}}))),{scrollIntoView:!0,userEvent:"input.complete"})}const SourceCache=new WeakMap;function asSource(e){if(!Array.isArray(e))return e;let t=SourceCache.get(e);return t||SourceCache.set(e,t=completeFromList(e)),t}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let n=codePointAt(e,t),i=codePointSize(n);this.chars.push(n);let r=e.slice(t,t+i),s=r.toUpperCase();this.folded.push(codePointAt(s==r?r.toLowerCase():s,0)),t+=i}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(0==this.pattern.length)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:n,any:i,precise:r,byWord:s}=this;if(1==t.length){let i=codePointAt(e,0),r=codePointSize(i),s=r==e.length?0:-100;if(i==t[0]);else{if(i!=n[0])return null;s+=-200}return this.ret(s,[0,r])}let o=e.indexOf(this.pattern);if(0==o)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,l=0;if(o<0){for(let r=0,s=Math.min(e.length,200);r<s&&l<a;){let s=codePointAt(e,r);s!=t[l]&&s!=n[l]||(i[l++]=r),r+=codePointSize(s)}if(l<a)return null}let c=0,d=0,u=!1,h=0,m=-1,g=-1,p=/[a-z]/.test(e),f=!0;for(let i=0,l=Math.min(e.length,200),y=0;i<l&&d<a;){let l=codePointAt(e,i);o<0&&(c<a&&l==t[c]&&(r[c++]=i),h<a&&(l==t[h]||l==n[h]?(0==h&&(m=i),g=i+1,h++):h=0));let b,O=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(b=fromCodePoint(l))!=b.toLowerCase()?1:b!=b.toUpperCase()?2:0;(!i||1==O&&p||0==y&&0!=O)&&(t[d]==l||n[d]==l&&(u=!0)?s[d++]=i:s.length&&(f=!1)),y=O,i+=codePointSize(l)}return d==a&&0==s[0]&&f?this.result((u?-200:0)-100,s,e):h==a&&0==m?this.ret(-200-e.length+(g==e.length?0:-100),[0,g]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):h==a?this.ret(-900-e.length,[m,g]):d==a?this.result((u?-200:0)-100-700+(f?0:-1100),s,e):2==t.length?null:this.result((i[0]?-700:0)-200-1100,i,e)}result(e,t,n){let i=[],r=0;for(let e of t){let t=e+(this.astral?codePointSize(codePointAt(n,e)):1);r&&i[r-1]==e?i[r-1]=t:(i[r++]=e,i[r++]=t)}return this.ret(e-n.length,i)}}class StrictMatcher{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),n=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==n?null:(this.matched=[0,t.length],this.score=n+(e.length==this.pattern.length?0:-100),this)}}const completionConfig=Facet.define({combine:e=>combineConfig(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>n=>joinClass(e(n),t(n)),optionClass:(e,t)=>n=>joinClass(e(n),t(n)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function joinClass(e,t){return e?t?e+" "+t:e:t}function defaultPositionInfo(e,t,n,i,r,s){let o,a,l=e.textDirection==Direction.RTL,c=l,d=!1,u="top",h=t.left-r.left,m=r.right-t.right,g=i.right-i.left,p=i.bottom-i.top;if(c&&h<Math.min(g,m)?c=!1:!c&&m<Math.min(g,h)&&(c=!0),g<=(c?h:m))o=Math.max(r.top,Math.min(n.top,r.bottom-p))-t.top,a=Math.min(400,c?h:m);else{d=!0,a=Math.min(400,(l?t.right:r.right-t.left)-30);let e=r.bottom-t.bottom;e>=p||e>t.top?o=n.bottom-t.top:(u="bottom",o=t.bottom-n.top)}return{style:u+": "+o/((t.bottom-t.top)/s.offsetHeight)+"px; max-width: "+a/((t.right-t.left)/s.offsetWidth)+"px",class:"cm-completionInfo-"+(d?l?"left-narrow":"right-narrow":c?"left":"right")}}function optionContent(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,n,i){let r=document.createElement("span");r.className="cm-completionLabel";let s=e.displayLabel||e.label,o=0;for(let e=0;e<i.length;){let t=i[e++],n=i[e++];t>o&&r.appendChild(document.createTextNode(s.slice(o,t)));let a=r.appendChild(document.createElement("span"));a.appendChild(document.createTextNode(s.slice(t,n))),a.className="cm-completionMatchedText",o=n}return o<s.length&&r.appendChild(document.createTextNode(s.slice(o))),r},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}function rangeAroundSelected(e,t,n){if(e<=n)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/n);return{from:e*n,to:(e+1)*n}}let i=Math.floor((e-t)/n);return{from:e-(i+1)*n,to:e-i*n}}class CompletionTooltip{constructor(e,t,n){this.view=e,this.stateField=t,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let i=e.state.field(t),{options:r,selected:s}=i.open,o=e.state.facet(completionConfig);this.optionContent=optionContent(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=rangeAroundSelected(r.length,s,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",(n=>{let{options:i}=e.state.field(t).open;for(let t,r=n.target;r&&r!=this.dom;r=r.parentNode)if("LI"==r.nodeName&&(t=/-(\d+)$/.exec(r.id))&&+t[1]<i.length)return this.applyCompletion(e,i[+t[1]]),void n.preventDefault()})),this.dom.addEventListener("focusout",(t=>{let n=e.state.field(this.stateField,!1);n&&n.tooltip&&e.state.facet(completionConfig).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})})),this.showOptions(r,i.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)}))}update(e){var t;let n=e.state.field(this.stateField),i=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=i){let{options:r,selected:s,disabled:o}=n.open;i.open&&i.open.options==r||(this.range=rangeAroundSelected(r.length,s,e.state.facet(completionConfig).maxRenderedOptions),this.showOptions(r,n.id)),this.updateSel(),o!=(null===(t=i.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=rangeAroundSelected(t.options.length,t.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:i}=n;if(!i)return;let r="string"==typeof i?document.createTextNode(i):i(n);if(!r)return;"then"in r?r.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,n)})).catch((e=>logException(this.view.state,e,"completion info"))):this.addInfoPane(r,n)}}addInfoPane(e,t){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",null!=e.nodeType)n.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:i}=e;n.appendChild(t),this.infoDestroy=i||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,i=this.range.from;n;n=n.nextSibling,i++)"LI"==n.nodeName&&n.id?i==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected"):i--;return t&&scrollIntoView(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),i=e.getBoundingClientRect(),r=this.space;if(!r){let e=this.dom.ownerDocument.documentElement;r={left:0,top:0,right:e.clientWidth,bottom:e.clientHeight}}return i.top>Math.min(r.bottom,t.bottom)-10||i.bottom<Math.max(r.top,t.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,t,i,n,r,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,n){const i=document.createElement("ul");i.id=t,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-label",this.view.state.phrase("Completions")),i.addEventListener("mousedown",(e=>{e.target==i&&e.preventDefault()}));let r=null;for(let s=n.from;s<n.to;s++){let{completion:o,match:a}=e[s],{section:l}=o;if(l){let e="string"==typeof l?l:l.name;e!=r&&(s>n.from||0==n.from)&&(r=e,"string"!=typeof l&&l.header?i.appendChild(l.header(l)):i.appendChild(document.createElement("completion-section")).textContent=e)}const c=i.appendChild(document.createElement("li"));c.id=t+"-"+s,c.setAttribute("role","option");let d=this.optionClass(o);d&&(c.className=d);for(let e of this.optionContent){let t=e(o,this.view.state,this.view,a);t&&c.appendChild(t)}}return n.from&&i.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(e,t){return n=>new CompletionTooltip(n,e,t)}function scrollIntoView(e,t){let n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),r=n.height/e.offsetHeight;i.top<n.top?e.scrollTop-=(n.top-i.top)/r:i.bottom>n.bottom&&(e.scrollTop+=(i.bottom-n.bottom)/r)}function score(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function sortOptions(e,t){let n=[],i=null,r=e=>{n.push(e);let{section:t}=e.completion;if(t){i||(i=[]);let e="string"==typeof t?t:t.name;i.some((t=>t.name==e))||i.push("string"==typeof t?{name:e}:t)}},s=t.facet(completionConfig);for(let i of e)if(i.hasResult()){let e=i.result.getMatch;if(!1===i.result.filter)for(let t of i.result.options)r(new Option(t,i.source,e?e(t):[],1e9-n.length));else{let n,o=t.sliceDoc(i.from,i.to),a=s.filterStrict?new StrictMatcher(o):new FuzzyMatcher(o);for(let t of i.result.options)if(n=a.match(t.label)){let s=t.displayLabel?e?e(t,n.matched):[]:n.matched;r(new Option(t,i.source,s,n.score+(t.boost||0)))}}}if(i){let e=Object.create(null),t=0,r=(e,t)=>{var n,i;return(null!==(n=e.rank)&&void 0!==n?n:1e9)-(null!==(i=t.rank)&&void 0!==i?i:1e9)||(e.name<t.name?-1:1)};for(let n of i.sort(r))t-=1e5,e[n.name]=t;for(let t of n){let{section:n}=t.completion;n&&(t.score+=e["string"==typeof n?n:n.name])}}let o=[],a=null,l=s.compareCompletions;for(let e of n.sort(((e,t)=>t.score-e.score||l(e.completion,t.completion)))){let t=e.completion;!a||a.label!=t.label||a.detail!=t.detail||null!=a.type&&null!=t.type&&a.type!=t.type||a.apply!=t.apply||a.boost!=t.boost?o.push(e):score(e.completion)>score(a)&&(o[o.length-1]=e),a=e.completion}return o}class CompletionDialog{constructor(e,t,n,i,r,s){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=i,this.selected=r,this.disabled=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,n,i,r,s){if(i&&!s&&e.some((e=>e.isPending)))return i.setDisabled();let o=sortOptions(e,t);if(!o.length)return i&&e.some((e=>e.isPending))?i.setDisabled():null;let a=t.facet(completionConfig).selectOnOpen?0:-1;if(i&&i.selected!=a&&-1!=i.selected){let e=i.options[i.selected].completion;for(let t=0;t<o.length;t++)if(o[t].completion==e){a=t;break}}return new CompletionDialog(o,makeAttrs(n,a),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:createTooltip,above:r.aboveCursor},i?i.timestamp:Date.now(),a,!1)}map(e){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new CompletionDialog(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class CompletionState{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new CompletionState(none$1,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,n=t.facet(completionConfig),i=(n.override||t.languageDataAt("autocomplete",cur(t)).map(asSource)).map((t=>(this.active.find((e=>e.source==t))||new ActiveSource(t,this.active.some((e=>0!=e.state))?1:0)).update(e,n)));i.length==this.active.length&&i.every(((e,t)=>e==this.active[t]))&&(i=this.active);let r=this.open,s=e.effects.some((e=>e.is(setActiveEffect)));r&&e.docChanged&&(r=r.map(e.changes)),e.selection||i.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!sameResults(i,this.active)||s?r=CompletionDialog.build(i,t,this.id,r,n,s):r&&r.disabled&&!i.some((e=>e.isPending))&&(r=null),!r&&i.every((e=>!e.isPending))&&i.some((e=>e.hasResult()))&&(i=i.map((e=>e.hasResult()?new ActiveSource(e.source,0):e)));for(let t of e.effects)t.is(setSelectedEffect)&&(r=r&&r.setSelected(t.value,this.id));return i==this.active&&r==this.open?this:new CompletionState(i,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?baseAttrs:noAttrs}}function sameResults(e,t){if(e==t)return!0;for(let n=0,i=0;;){for(;n<e.length&&!e[n].hasResult();)n++;for(;i<t.length&&!t[i].hasResult();)i++;let r=n==e.length,s=i==t.length;if(r||s)return r==s;if(e[n++].result!=t[i++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"},noAttrs={};function makeAttrs(e,t){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(n["aria-activedescendant"]=e+"-"+t),n}const none$1=[];function getUpdateType(e,t){if(e.isUserEvent("input.complete")){let n=e.annotation(pickedCompletion);if(n&&t.activateOnCompletion(n))return 12}let n=e.isUserEvent("input.type");return n&&t.activateOnTyping?5:n?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class ActiveSource{constructor(e,t,n=!1){this.source=e,this.state=t,this.explicit=n}hasResult(){return!1}get isPending(){return 1==this.state}update(e,t){let n=getUpdateType(e,t),i=this;(8&n||16&n&&this.touches(e))&&(i=new ActiveSource(i.source,0)),4&n&&0==i.state&&(i=new ActiveSource(this.source,1)),i=i.updateFor(e,n);for(let t of e.effects)if(t.is(startCompletionEffect))i=new ActiveSource(i.source,1,t.value);else if(t.is(closeCompletionEffect))i=new ActiveSource(i.source,0);else if(t.is(setActiveEffect))for(let e of t.value)e.source==i.source&&(i=e);return i}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(cur(e.state))}}class ActiveResult extends ActiveSource{constructor(e,t,n,i,r,s){super(e,3,t),this.limit=n,this.result=i,this.from=r,this.to=s}hasResult(){return!0}updateFor(e,t){var n;if(!(3&t))return this.map(e.changes);let i=this.result;i.map&&!e.changes.empty&&(i=i.map(i,e.changes));let r=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),o=cur(e.state);if(o>s||!i||2&t&&(cur(e.startState)==this.from||o<this.limit))return new ActiveSource(this.source,4&t?1:0);let a=e.changes.mapPos(this.limit);return checkValid(i.validFor,e.state,r,s)?new ActiveResult(this.source,this.explicit,a,i,r,s):i.update&&(i=i.update(i,r,s,new CompletionContext(e.state,o,!1)))?new ActiveResult(this.source,this.explicit,a,i,i.from,null!==(n=i.to)&&void 0!==n?n:cur(e.state)):new ActiveSource(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new ActiveResult(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new ActiveSource(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function checkValid(e,t,n,i){if(!e)return!1;let r=t.sliceDoc(n,i);return"function"==typeof e?e(r,n,i,t):ensureAnchor(e,!0).test(r)}const setActiveEffect=StateEffect.define({map:(e,t)=>e.map((e=>e.map(t)))}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create:()=>CompletionState.start(),update:(e,t)=>e.update(t),provide:e=>[showTooltip.from(e,(e=>e.tooltip)),EditorView.contentAttributes.from(e,(e=>e.attrs))]});function applyCompletion(e,t){const n=t.completion.apply||t.completion.label;let i=e.state.field(completionState).active.find((e=>e.source==t.source));return i instanceof ActiveResult&&("string"==typeof n?e.dispatch(Object.assign(Object.assign({},insertCompletionText(e.state,n,i.from,i.to)),{annotations:pickedCompletion.of(t.completion)})):n(e,t.completion,i.from,i.to),!0)}const createTooltip=completionTooltip(completionState,applyCompletion);function moveCompletionSelection(e,t="option"){return n=>{let i=n.state.field(completionState,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<n.state.facet(completionConfig).interactionDelay)return!1;let r,s=1;"page"==t&&(r=getTooltip(n,i.open.tooltip))&&(s=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let{length:o}=i.open.options,a=i.open.selected>-1?i.open.selected+s*(e?1:-1):e?0:o-1;return a<0?a="page"==t?0:o-1:a>=o&&(a="page"==t?o-1:0),n.dispatch({effects:setSelectedEffect.of(a)}),!0}}const acceptCompletion=e=>{let t=e.state.field(completionState,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(completionConfig).interactionDelay)&&applyCompletion(e,t.open.options[t.open.selected])},startCompletion=e=>!!e.state.field(completionState,!1)&&(e.dispatch({effects:startCompletionEffect.of(!0)}),!0),closeCompletion=e=>{let t=e.state.field(completionState,!1);return!(!t||!t.active.some((e=>0!=e.state))||(e.dispatch({effects:closeCompletionEffect.of(null)}),0))};class RunningQuery{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(completionState).active)t.isPending&&this.startQuery(t)}update(e){let t=e.state.field(completionState),n=e.state.facet(completionConfig);if(!e.selectionSet&&!e.docChanged&&e.startState.field(completionState)==t)return;let i=e.transactions.some((e=>{let t=getUpdateType(e,n);return 8&t||(e.selection||e.docChanged)&&!(3&t)}));for(let t=0;t<this.running.length;t++){let n=this.running[t];if(i||n.context.abortOnDocChange&&e.docChanged||n.updates.length+e.transactions.length>MaxUpdateCount&&Date.now()-n.time>MinAbortTime){for(let e of n.context.abortListeners)try{e()}catch(e){logException(this.view.state,e)}n.context.abortListeners=null,this.running.splice(t--,1)}else n.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some((e=>e.effects.some((e=>e.is(startCompletionEffect)))))&&(this.pendingStart=!0);let r=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=t.active.some((e=>e.isPending&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),r):-1,0!=this.composing)for(let t of e.transactions)t.isUserEvent("input.type")?this.composing=2:2==this.composing&&t.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(completionState);for(let e of t.active)e.isPending&&!this.running.some((t=>t.active.source==e.source))&&this.startQuery(e);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(completionConfig).updateSyncTime))}startQuery(e){let{state:t}=this.view,n=cur(t),i=new CompletionContext(t,n,e.explicit,this.view),r=new RunningQuery(e,i);this.running.push(r),Promise.resolve(e.source(i)).then((e=>{r.context.aborted||(r.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(completionConfig).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],n=this.view.state.facet(completionConfig),i=this.view.state.field(completionState);for(let r=0;r<this.running.length;r++){let s=this.running[r];if(void 0===s.done)continue;if(this.running.splice(r--,1),s.done){let i=cur(s.updates.length?s.updates[0].startState:this.view.state),r=Math.min(i,s.done.from+(s.active.explicit?0:1)),o=new ActiveResult(s.active.source,s.active.explicit,r,s.done,s.done.from,null!==(e=s.done.to)&&void 0!==e?e:i);for(let e of s.updates)o=o.update(e,n);if(o.hasResult()){t.push(o);continue}}let o=i.active.find((e=>e.source==s.active.source));if(o&&o.isPending)if(null==s.done){let e=new ActiveSource(s.active.source,0);for(let t of s.updates)e=e.update(t,n);e.isPending||t.push(e)}else this.startQuery(o)}(t.length||i.open&&i.open.disabled)&&this.view.dispatch({effects:setActiveEffect.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(completionState,!1);if(t&&t.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let n=t.open&&getTooltip(this.view,t.open.tooltip);n&&n.dom.contains(e.relatedTarget)||setTimeout((()=>this.view.dispatch({effects:closeCompletionEffect.of(null)})),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:startCompletionEffect.of(!1)})),20),this.composing=0}}}),windows="object"==typeof navigator&&/Win/.test(navigator.platform),commitCharacters=Prec.highest(EditorView.domEventHandlers({keydown(e,t){let n=t.state.field(completionState,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||e.key.length>1||e.ctrlKey&&(!windows||!e.altKey)||e.metaKey)return!1;let i=n.open.options[n.open.selected],r=n.active.find((e=>e.source==i.source)),s=i.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(e.key)>-1&&applyCompletion(t,i),!1}})),baseTheme=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class FieldPos{constructor(e,t,n,i){this.field=e,this.line=t,this.from=n,this.to=i}}class FieldRange{constructor(e,t,n){this.field=e,this.from=t,this.to=n}map(e){let t=e.mapPos(this.from,-1,MapMode.TrackDel),n=e.mapPos(this.to,1,MapMode.TrackDel);return null==t||null==n?null:new FieldRange(this.field,t,n)}}class Snippet{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let n=[],i=[t],r=e.doc.lineAt(t),s=/^\s*/.exec(r.text)[0];for(let r of this.lines){if(n.length){let n=s,o=/^\t*/.exec(r)[0].length;for(let t=0;t<o;t++)n+=e.facet(indentUnit);i.push(t+n.length-o),r=n+r.slice(o)}n.push(r),t+=r.length+1}return{text:n,ranges:this.fieldPositions.map((e=>new FieldRange(e.field,i[e.line]+e.from,i[e.line]+e.to)))}}static parse(e){let t,n=[],i=[],r=[];for(let s of e.split(/\r\n?|\n/)){for(;t=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(s);){let e=t[1]?+t[1]:null,o=t[2]||t[3]||"",a=-1,l=o.replace(/\\[{}]/g,(e=>e[1]));for(let t=0;t<n.length;t++)(null!=e?n[t].seq==e:l&&n[t].name==l)&&(a=t);if(a<0){let t=0;for(;t<n.length&&(null==e||null!=n[t].seq&&n[t].seq<e);)t++;n.splice(t,0,{seq:e,name:l}),a=t;for(let e of r)e.field>=a&&e.field++}r.push(new FieldPos(a,i.length,t.index,t.index+l.length)),s=s.slice(0,t.index)+o+s.slice(t.index+t[0].length)}s=s.replace(/\\([{}])/g,((e,t,n)=>{for(let e of r)e.line==i.length&&e.from>n&&(e.from--,e.to--);return t})),i.push(s)}return new Snippet(i,r)}}let fieldMarker=Decoration.widget({widget:new class extends WidgetType{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),fieldRange=Decoration.mark({class:"cm-snippetField"});class ActiveSnippet{constructor(e,t){this.ranges=e,this.active=t,this.deco=Decoration.set(e.map((e=>(e.from==e.to?fieldMarker:fieldRange).range(e.from,e.to))))}map(e){let t=[];for(let n of this.ranges){let i=n.map(e);if(!i)return null;t.push(i)}return new ActiveSnippet(t,this.active)}selectionInsideField(e){return e.ranges.every((e=>this.ranges.some((t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))))}}const setActive=StateEffect.define({map:(e,t)=>e&&e.map(t)}),moveToField=StateEffect.define(),snippetState=StateField.define({create:()=>null,update(e,t){for(let n of t.effects){if(n.is(setActive))return n.value;if(n.is(moveToField)&&e)return new ActiveSnippet(e.ranges,n.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>EditorView.decorations.from(e,(e=>e?e.deco:Decoration.none))});function fieldSelection(e,t){return EditorSelection.create(e.filter((e=>e.field==t)).map((e=>EditorSelection.range(e.from,e.to))))}function snippet(e){let t=Snippet.parse(e);return(e,n,i,r)=>{let{text:s,ranges:o}=t.instantiate(e.state,i),{main:a}=e.state.selection,l={changes:{from:i,to:r==a.from?a.to:r,insert:Text.of(s)},scrollIntoView:!0,annotations:n?[pickedCompletion.of(n),Transaction.userEvent.of("input.complete")]:void 0};if(o.length&&(l.selection=fieldSelection(o,0)),o.some((e=>e.field>0))){let t=new ActiveSnippet(o,0),n=l.effects=[setActive.of(t)];void 0===e.state.field(snippetState,!1)&&n.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme]))}e.dispatch(e.state.update(l))}}function moveField(e){return({state:t,dispatch:n})=>{let i=t.field(snippetState,!1);if(!i||e<0&&0==i.active)return!1;let r=i.active+e,s=e>0&&!i.ranges.some((t=>t.field==r+e));return n(t.update({selection:fieldSelection(i.ranges,r),effects:setActive.of(s?null:new ActiveSnippet(i.ranges,r)),scrollIntoView:!0})),!0}}const clearSnippet=({state:e,dispatch:t})=>!!e.field(snippetState,!1)&&(t(e.update({effects:setActive.of(null)})),!0),nextSnippetField=moveField(1),prevSnippetField=moveField(-1),defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}],snippetKeymap=Facet.define({combine:e=>e.length?e[0]:defaultSnippetKeymap}),addSnippetKeymap=Prec.highest(keymap.compute([snippetKeymap],(e=>e.facet(snippetKeymap))));function snippetCompletion(e,t){return Object.assign(Object.assign({},t),{apply:snippet(e)})}const snippetPointerHandler=EditorView.domEventHandlers({mousedown(e,t){let n,i=t.state.field(snippetState,!1);if(!i||null==(n=t.posAtCoords({x:e.clientX,y:e.clientY})))return!1;let r=i.ranges.find((e=>e.from<=n&&e.to>=n));return!(!r||r.field==i.active||(t.dispatch({selection:fieldSelection(i.ranges,r.field),effects:setActive.of(i.ranges.some((e=>e.field>r.field))?new ActiveSnippet(i.ranges,r.field):null),scrollIntoView:!0}),0))}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(e,t){let n=t.mapPos(e,-1,MapMode.TrackAfter);return null==n?void 0:n}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1,closedBracket.endSide=-1;const bracketState=StateField.define({create:()=>RangeSet.empty,update(e,t){if(e=e.map(t.changes),t.selection){let n=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=n.from&&e<=n.to})}for(let n of t.effects)n.is(closeBracketEffect)&&(e=e.update({add:[closedBracket.range(n.value,n.value+1)]}));return e}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>";function closing(e){for(let t=0;t<definedClosing.length;t+=2)if(definedClosing.charCodeAt(t)==e)return definedClosing.charAt(t+1);return fromCodePoint(e<128?e:e+1)}function config(e,t){return e.languageDataAt("closeBrackets",t)[0]||defaults}const android$1="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of(((e,t,n,i)=>{if((android$1?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let r=e.state.selection.main;if(i.length>2||2==i.length&&1==codePointSize(codePointAt(i,0))||t!=r.from||n!=r.to)return!1;let s=insertBracket(e.state,i);return!!s&&(e.dispatch(s),!0)})),deleteBracketPair=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=config(e,e.selection.main.head).brackets||defaults.brackets,i=null,r=e.changeByRange((t=>{if(t.empty){let i=prevChar(e.doc,t.head);for(let r of n)if(r==i&&nextChar(e.doc,t.head)==closing(codePointAt(r,0)))return{changes:{from:t.head-r.length,to:t.head+r.length},range:EditorSelection.cursor(t.head-r.length)}}return{range:i=t}}));return i||t(e.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!i},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(e,t){let n=config(e,e.selection.main.head),i=n.brackets||defaults.brackets;for(let r of i){let s=closing(codePointAt(r,0));if(t==r)return s==r?handleSame(e,r,i.indexOf(r+r+r)>-1,n):handleOpen(e,r,s,n.before||defaults.before);if(t==s&&closedBracketAt(e,e.selection.main.from))return handleClose(e,r,s)}return null}function closedBracketAt(e,t){let n=!1;return e.field(bracketState).between(0,e.doc.length,(e=>{e==t&&(n=!0)})),n}function nextChar(e,t){let n=e.sliceString(t,t+2);return n.slice(0,codePointSize(codePointAt(n,0)))}function prevChar(e,t){let n=e.sliceString(t-2,t);return codePointSize(codePointAt(n,0))==n.length?n:n.slice(1)}function handleOpen(e,t,n,i){let r=null,s=e.changeByRange((s=>{if(!s.empty)return{changes:[{insert:t,from:s.from},{insert:n,from:s.to}],effects:closeBracketEffect.of(s.to+t.length),range:EditorSelection.range(s.anchor+t.length,s.head+t.length)};let o=nextChar(e.doc,s.head);return!o||/\s/.test(o)||i.indexOf(o)>-1?{changes:{insert:t+n,from:s.head},effects:closeBracketEffect.of(s.head+t.length),range:EditorSelection.cursor(s.head+t.length)}:{range:r=s}}));return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(e,t,n){let i=null,r=e.changeByRange((t=>t.empty&&nextChar(e.doc,t.head)==n?{changes:{from:t.head,to:t.head+n.length,insert:n},range:EditorSelection.cursor(t.head+n.length)}:i={range:t}));return i?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(e,t,n,i){let r=i.stringPrefixes||defaults.stringPrefixes,s=null,o=e.changeByRange((i=>{if(!i.empty)return{changes:[{insert:t,from:i.from},{insert:t,from:i.to}],effects:closeBracketEffect.of(i.to+t.length),range:EditorSelection.range(i.anchor+t.length,i.head+t.length)};let o,a=i.head,l=nextChar(e.doc,a);if(l==t){if(nodeStart(e,a))return{changes:{insert:t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)};if(closedBracketAt(e,a)){let i=n&&e.sliceDoc(a,a+3*t.length)==t+t+t?t+t+t:t;return{changes:{from:a,to:a+i.length,insert:i},range:EditorSelection.cursor(a+i.length)}}}else{if(n&&e.sliceDoc(a-2*t.length,a)==t+t&&(o=canStartStringAt(e,a-2*t.length,r))>-1&&nodeStart(e,o))return{changes:{insert:t+t+t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)};if(e.charCategorizer(a)(l)!=CharCategory.Word&&canStartStringAt(e,a,r)>-1&&!probablyInString(e,a,t,r))return{changes:{insert:t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)}}return{range:s=i}}));return s?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(e,t){let n=syntaxTree(e).resolveInner(t+1);return n.parent&&n.from==t}function probablyInString(e,t,n,i){let r=syntaxTree(e).resolveInner(t,-1),s=i.reduce(((e,t)=>Math.max(e,t.length)),0);for(let o=0;o<5;o++){let o=e.sliceDoc(r.from,Math.min(r.to,r.from+n.length+s)),a=o.indexOf(n);if(!a||a>-1&&i.indexOf(o.slice(0,a))>-1){let t=r.firstChild;for(;t&&t.from==r.from&&t.to-t.from>n.length+a;){if(e.sliceDoc(t.to-n.length,t.to)==n)return!1;t=t.firstChild}return!0}let l=r.to==t&&r.parent;if(!l)break;r=l}return!1}function canStartStringAt(e,t,n){let i=e.charCategorizer(t);if(i(e.sliceDoc(t-1,t))!=CharCategory.Word)return t;for(let r of n){let n=t-r.length;if(e.sliceDoc(n,t)==r&&i(e.sliceDoc(n-1,n))!=CharCategory.Word)return n}return-1}function autocompletion(e={}){return[commitCharacters,completionState,completionConfig.of(e),completionPlugin,completionKeymapExt,baseTheme]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{mac:"Alt-`",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],(e=>e.facet(completionConfig).defaultKeymap?[completionKeymap]:[])));class Stack{constructor(e,t,n,i,r,s,o,a,l,c=0,d){this.p=e,this.stack=t,this.state=n,this.reducePos=i,this.pos=r,this.score=s,this.buffer=o,this.bufferBase=a,this.curContext=l,this.lookAhead=c,this.parent=d}toString(){return"["+this.stack.filter(((e,t)=>t%3==0)).concat(this.state)+"]@"+this.pos+(this.score?"!"+this.score:"")}static start(e,t,n=0){let i=e.parser.context;return new Stack(e,[],t,n,n,0,[],0,i?new StackContext(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let n=e>>19,i=65535&e,{parser:r}=this.p,s=this.reducePos<this.pos-25;s&&this.setLookAhead(this.pos);let o=r.dynamicPrecedence(i);if(o&&(this.score+=o),0==n)return this.pushState(r.getGoto(this.state,i,!0),this.reducePos),i<r.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,s?8:4,!0),void this.reduceContext(i,this.reducePos);let a=this.stack.length-3*(n-1)-(262144&e?6:0),l=a?this.stack[a-2]:this.p.ranges[0].from,c=this.reducePos-l;c>=2e3&&!(null===(t=this.p.parser.nodeSet.types[i])||void 0===t?void 0:t.isAnonymous)&&(l==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=l,this.p.lastBigReductionSize=c));let d=a?this.stack[a-1]:0,u=this.bufferBase+this.buffer.length-d;if(i<r.minRepeatTerm||131072&e){let e=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,l,e,u+4,!0)}if(262144&e)this.state=this.stack[a];else{let e=this.stack[a-3];this.state=r.getGoto(e,i,!0)}for(;this.stack.length>a;)this.stack.pop();this.reduceContext(i,l)}storeNode(e,t,n,i=4,r=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,i=this.buffer.length;if(0==i&&e.parent&&(i=e.bufferBase-e.parent.bufferBase,e=e.parent),i>0&&0==e.buffer[i-4]&&e.buffer[i-1]>-1){if(t==n)return;if(e.buffer[i-2]>=t)return void(e.buffer[i-2]=n)}}if(r&&this.pos!=n){let r=this.buffer.length;if(r>0&&0!=this.buffer[r-4]){let e=!1;for(let t=r;t>0&&this.buffer[t-2]>n;t-=4)if(this.buffer[t-1]>=0){e=!0;break}if(e)for(;r>0&&this.buffer[r-2]>n;)this.buffer[r]=this.buffer[r-4],this.buffer[r+1]=this.buffer[r-3],this.buffer[r+2]=this.buffer[r-2],this.buffer[r+3]=this.buffer[r-1],r-=4,i>4&&(i-=4)}this.buffer[r]=e,this.buffer[r+1]=t,this.buffer[r+2]=n,this.buffer[r+3]=i}else this.buffer.push(e,t,n,i)}shift(e,t,n,i){if(131072&e)this.pushState(65535&e,this.pos);else if(262144&e)this.pos=i,this.shiftContext(t,n),t<=this.p.parser.maxNode&&this.buffer.push(t,n,i,4);else{let r=e,{parser:s}=this.p;(i>this.pos||t<=s.maxNode)&&(this.pos=i,s.stateFlag(r,1)||(this.reducePos=i)),this.pushState(r,n),this.shiftContext(t,n),t<=s.maxNode&&this.buffer.push(t,n,i,4)}}apply(e,t,n,i){65536&e?this.reduce(e):this.shift(e,t,n,i)}useNode(e,t){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=e)&&(this.p.reused.push(e),n++);let i=this.pos;this.reducePos=this.pos=i+e.length,this.pushState(t,i),this.buffer.push(n,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let n=e.buffer.slice(t),i=e.bufferBase+t;for(;e&&i==e.bufferBase;)e=e.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,i,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let n=e<=this.p.parser.maxNode;n&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,n?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new SimulatedStack(this);;){let n=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==n)return!1;if(!(65536&n))return!0;t.reduce(n)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let n=[];for(let i,r=0;r<t.length;r+=2)(i=t[r+1])!=this.state&&this.p.parser.hasAction(i,e)&&n.push(t[r],i);if(this.stack.length<120)for(let e=0;n.length<8&&e<t.length;e+=2){let i=t[e+1];n.some(((e,t)=>1&t&&e==i))||n.push(t[e],i)}t=n}let n=[];for(let e=0;e<t.length&&n.length<4;e+=2){let i=t[e+1];if(i==this.state)continue;let r=this.split();r.pushState(i,this.pos),r.storeNode(0,r.pos,r.pos,4,!0),r.shiftContext(t[e],this.pos),r.reducePos=this.pos,r.score-=200,n.push(r)}return n}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(65536&t))return!1;if(!e.validAction(this.state,t)){let n=t>>19,i=65535&t,r=this.stack.length-3*n;if(r<0||e.getGoto(this.stack[r],i,!1)<0){let e=this.findForcedReduction();if(null==e)return!1;t=e}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],n=(i,r)=>{if(!t.includes(i))return t.push(i),e.allActions(i,(t=>{if(393216&t);else if(65536&t){let n=(t>>19)-r;if(n>1){let i=65535&t,r=this.stack.length-3*n;if(r>=0&&e.getGoto(this.stack[r],i,!1)>=0)return n<<19|65536|i}}else{let e=n(t,r+1);if(null!=e)return e}}))};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new StackContext(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,n=e>>19;0==n?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(n-1);let i=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=i}}class StackBufferCursor{constructor(e,t,n){this.stack=e,this.pos=t,this.index=n,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}function decodeArray(e,t=Uint16Array){if("string"!=typeof e)return e;let n=null;for(let i=0,r=0;i<e.length;){let s=0;for(;;){let t=e.charCodeAt(i++),n=!1;if(126==t){s=65535;break}t>=92&&t--,t>=34&&t--;let r=t-32;if(r>=46&&(r-=46,n=!0),s+=r,n)break;s*=46}n?n[r++]=s:n=new t(s)}return n}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let n=this.range,i=this.rangeIndex,r=this.pos+e;for(;r<n.from;){if(!i)return null;let e=this.ranges[--i];r-=n.from-e.to,n=e}for(;t<0?r>n.to:r>=n.to;){if(i==this.ranges.length-1)return null;let e=this.ranges[++i];r+=e.from-n.to,n=e}return r}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,n,i=this.chunkOff+e;if(i>=0&&i<this.chunk.length)t=this.pos+e,n=this.chunk.charCodeAt(i);else{let i=this.resolveOffset(e,1);if(null==i)return-1;if(t=i,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,i=this.range;for(;i.to<=t;)i=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>i.to&&(this.chunk2=this.chunk2.slice(0,i.to-t)),n=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),n}acceptToken(e,t=0){let n=t?this.resolveOffset(t,-1):this.pos;if(null==n||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=n}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let n="";for(let i of this.ranges){if(i.from>=t)break;i.to>e&&(n+=this.input.read(Math.max(i.from,e),Math.min(i.to,t)))}return n}}class TokenGroup{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:n}=t.p;readToken(this.data,e,t,this.id,n.data,n.tokenPrecTable)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;class LocalTokenGroup{constructor(e,t,n){this.precTable=t,this.elseToken=n,this.data="string"==typeof e?decodeArray(e):e}token(e,t){let n=e.pos,i=0;for(;;){let n=e.next<0,r=e.resolveOffset(1,1);if(readToken(this.data,e,t,0,this.data,this.precTable),e.token.value>-1)break;if(null==this.elseToken)return;if(n||i++,null==r)break;e.reset(r,e.token)}i&&(e.reset(n,e.token),e.acceptToken(this.elseToken,i))}}LocalTokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;class ExternalTokenizer{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function readToken(e,t,n,i,r,s){let o=0,a=1<<i,{dialect:l}=n.p.parser;e:for(;a&e[o];){let n=e[o+1];for(let i=o+3;i<n;i+=2)if((e[i+1]&a)>0){let n=e[i];if(l.allows(n)&&(-1==t.token.value||t.token.value==n||overrides(n,t.token.value,r,s))){t.acceptToken(n);break}}let i=t.next,c=0,d=e[o+2];if(!(t.next<0&&d>c&&65535==e[n+3*d-3])){for(;c<d;){let r=c+d>>1,s=n+r+(r<<1),a=e[s],l=e[s+1]||65536;if(i<a)d=r;else{if(!(i>=l)){o=e[s+2],t.advance();continue e}c=r+1}}break}o=e[n+3*d-1]}}function findOffset(e,t,n){for(let i,r=t;65535!=(i=e[r]);r++)if(i==n)return r-t;return-1}function overrides(e,t,n,i){let r=findOffset(n,i,t);return r<0||findOffset(n,i,e)<r}const verbose="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let stackIDs=null;function cutAt(e,t,n){let i=e.cursor(IterMode.IncludeAnonymous);for(i.moveTo(t);;)if(!(n<0?i.childBefore(t):i.childAfter(t)))for(;;){if((n<0?i.to<t:i.from>t)&&!i.type.isError)return n<0?Math.max(0,Math.min(i.to-1,t-25)):Math.min(e.length,Math.max(i.from+1,t+25));if(n<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return n<0?0:e.length}}let FragmentCursor$1=class{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let n=this.trees[t],i=this.index[t];if(i==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=n.children[i],s=this.start[t]+n.positions[i];if(s>e)return this.nextStart=s,null;if(r instanceof Tree){if(s==e){if(s<this.safeFrom)return null;let e=s+r.length;if(e<=this.safeTo){let t=r.prop(NodeProp.lookAhead);if(!t||e+t<this.fragment.to)return r}}this.index[t]++,s+r.length>=Math.max(this.safeFrom,e)&&(this.trees.push(r),this.start.push(s),this.index.push(0))}else this.index[t]++,this.nextStart=s+r.length}}};class TokenCache{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new CachedToken))}getActions(e){let t=0,n=null,{parser:i}=e.p,{tokenizers:r}=i,s=i.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,a=0;for(let i=0;i<r.length;i++){if(!(1<<i&s))continue;let l=r[i],c=this.tokens[i];if((!n||l.fallback)&&((l.contextual||c.start!=e.pos||c.mask!=s||c.context!=o)&&(this.updateCachedToken(c,l,e),c.mask=s,c.context=o),c.lookAhead>c.end+25&&(a=Math.max(c.lookAhead,a)),0!=c.value)){let i=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!l.extend&&(n=c,t>i))break}}for(;this.actions.length>t;)this.actions.pop();return a&&e.setLookAhead(a),n||e.pos!=this.stream.end||(n=new CachedToken,n.value=e.p.parser.eofTerm,n.start=n.end=e.pos,t=this.addActions(e,n.value,n.end,t)),this.mainToken=n,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new CachedToken,{pos:n,p:i}=e;return t.start=n,t.end=Math.min(n+1,i.stream.end),t.value=n==i.stream.end?i.parser.eofTerm:0,t}updateCachedToken(e,t,n){let i=this.stream.clipPos(n.pos);if(t.token(this.stream.reset(i,e),n),e.value>-1){let{parser:t}=n.p;for(let i=0;i<t.specialized.length;i++)if(t.specialized[i]==e.value){let r=t.specializers[i](this.stream.read(e.start,e.end),n);if(r>=0&&n.p.parser.dialect.allows(r>>1)){1&r?e.extended=r>>1:e.value=r>>1;break}}}else e.value=0,e.end=this.stream.clipPos(i+1)}putAction(e,t,n,i){for(let t=0;t<i;t+=3)if(this.actions[t]==e)return i;return this.actions[i++]=e,this.actions[i++]=t,this.actions[i++]=n,i}addActions(e,t,n,i){let{state:r}=e,{parser:s}=e.p,{data:o}=s;for(let e=0;e<2;e++)for(let a=s.stateSlot(r,e?2:1);;a+=3){if(65535==o[a]){if(1!=o[a+1]){0==i&&2==o[a+1]&&(i=this.putAction(pair(o,a+2),t,n,i));break}a=pair(o,a+2)}o[a]==t&&(i=this.putAction(pair(o,a+1),t,n,i))}return i}}class Parse{constructor(e,t,n,i){this.parser=e,this.input=t,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new InputStream(t,i),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:r}=i[0];this.stacks=[Stack.start(this,e.top[0],r)],this.fragments=n.length&&this.stream.end-r>4*e.bufferLength?new FragmentCursor$1(n,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,n=this.stacks,i=this.minStackPos,r=this.stacks=[];if(this.bigReductionCount>300&&1==n.length){let[e]=n;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let s=0;s<n.length;s++){let o=n[s];for(;;){if(this.tokens.mainToken=null,o.pos>i)r.push(o);else{if(this.advanceStack(o,r,n))continue;{e||(e=[],t=[]),e.push(o);let n=this.tokens.getMainToken(o);t.push(n.value,n.end)}}break}}if(!r.length){let t=e&&findFinished(e);if(t)return verbose&&console.log("Finish with "+this.stackID(t)),this.stackToTree(t);if(this.parser.strict)throw verbose&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+i);this.recovering||(this.recovering=5)}if(this.recovering&&e){let n=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,r);if(n)return verbose&&console.log("Force-finish "+this.stackID(n)),this.stackToTree(n.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(r.length>e)for(r.sort(((e,t)=>t.score-e.score));r.length>e;)r.pop();r.some((e=>e.reducePos>i))&&this.recovering--}else if(r.length>1){e:for(let e=0;e<r.length-1;e++){let t=r[e];for(let n=e+1;n<r.length;n++){let i=r[n];if(t.sameState(i)||t.buffer.length>500&&i.buffer.length>500){if(!((t.score-i.score||t.buffer.length-i.buffer.length)>0)){r.splice(e--,1);continue e}r.splice(n--,1)}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let e=1;e<r.length;e++)r[e].pos<this.minStackPos&&(this.minStackPos=r[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,n){let i=e.pos,{parser:r}=this,s=verbose?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&i>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,n=t?e.curContext.hash:0;for(let o=this.fragments.nodeAt(i);o;){let i=this.parser.nodeSet.types[o.type.id]==o.type?r.getGoto(e.state,o.type.id):-1;if(i>-1&&o.length&&(!t||(o.prop(NodeProp.contextHash)||0)==n))return e.useNode(o,i),verbose&&console.log(s+this.stackID(e)+" (via reuse of "+r.getName(o.type.id)+")"),!0;if(!(o instanceof Tree)||0==o.children.length||o.positions[0]>0)break;let a=o.children[0];if(!(a instanceof Tree&&0==o.positions[0]))break;o=a}}let o=r.stateSlot(e.state,4);if(o>0)return e.reduce(o),verbose&&console.log(s+this.stackID(e)+" (via always-reduce "+r.getName(65535&o)+")"),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let a=this.tokens.getActions(e);for(let o=0;o<a.length;){let l=a[o++],c=a[o++],d=a[o++],u=o==a.length||!n,h=u?e:e.split(),m=this.tokens.mainToken;if(h.apply(l,c,m?m.start:h.pos,d),verbose&&console.log(s+this.stackID(h)+" (via "+(65536&l?"reduce of "+r.getName(65535&l):"shift")+" for "+r.getName(c)+" @ "+i+(h==e?"":", split")+")"),u)return!0;h.pos>i?t.push(h):n.push(h)}return!1}advanceFully(e,t){let n=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>n)return pushStackDedup(e,t),!0}}runRecovery(e,t,n){let i=null,r=!1;for(let s=0;s<e.length;s++){let o=e[s],a=t[s<<1],l=t[1+(s<<1)],c=verbose?this.stackID(o)+" -> ":"";if(o.deadEnd){if(r)continue;if(r=!0,o.restart(),verbose&&console.log(c+this.stackID(o)+" (restarted)"),this.advanceFully(o,n))continue}let d=o.split(),u=c;for(let e=0;d.forceReduce()&&e<10&&(verbose&&console.log(u+this.stackID(d)+" (via force-reduce)"),!this.advanceFully(d,n));e++)verbose&&(u=this.stackID(d)+" -> ");for(let e of o.recoverByInsert(a))verbose&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,n);this.stream.end>o.pos?(l==o.pos&&(l++,a=0),o.recoverByDelete(a,l),verbose&&console.log(c+this.stackID(o)+" (via recover-delete "+this.parser.getName(a)+")"),pushStackDedup(o,n)):(!i||i.score<o.score)&&(i=o)}return i}stackToTree(e){return e.close(),Tree.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(stackIDs||(stackIDs=new WeakMap)).get(e);return t||stackIDs.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function pushStackDedup(e,t){for(let n=0;n<t.length;n++){let i=t[n];if(i.pos==e.pos&&i.sameState(e))return void(t[n].score<e.score&&(t[n]=e))}t.push(e)}class Dialect{constructor(e,t,n){this.source=e,this.flags=t,this.disabled=n}allows(e){return!this.disabled||0==this.disabled[e]}}const id=e=>e;class ContextTracker{constructor(e){this.start=e.start,this.shift=e.shift||id,this.reduce=e.reduce||id,this.reuse=e.reuse||id,this.hash=e.hash||(()=>0),this.strict=!1!==e.strict}}class LRParser extends Parser{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError("Parser version ("+e.version+") doesn't match runtime version (14)");let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let n=0;n<e.repeatNodeCount;n++)t.push("");let n=Object.keys(e.topRules).map((t=>e.topRules[t][1])),i=[];for(let e=0;e<t.length;e++)i.push([]);function r(e,t,n){i[e].push([t,t.deserialize(String(n))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];"string"==typeof e&&(e=NodeProp[e]);for(let n=1;n<t.length;){let i=t[n++];if(i>=0)r(i,e,t[n++]);else{let s=t[n+-i];for(let o=-i;o>0;o--)r(t[n++],e,s);n++}}}this.nodeSet=new NodeSet(t.map(((t,r)=>NodeType.define({name:r>=this.minRepeatTerm?void 0:t,id:r,props:i[r],top:n.indexOf(r)>-1,error:0==r,skipped:e.skippedNodes&&e.skippedNodes.indexOf(r)>-1})))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=DefaultBufferLength;let s=decodeArray(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let e=0;e<this.specializerSpecs.length;e++)this.specialized[e]=this.specializerSpecs[e].term;this.specializers=this.specializerSpecs.map(getSpecializer),this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new TokenGroup(s,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,n){let i=new Parse(this,e,t,n);for(let r of this.wrappers)i=r(i,e,t,n);return i}getGoto(e,t,n=!1){let i=this.goto;if(t>=i[0])return-1;for(let r=i[t+1];;){let t=i[r++],s=1&t,o=i[r++];if(s&&n)return o;for(let n=r+(t>>1);r<n;r++)if(i[r]==e)return o;if(s)return-1}}hasAction(e,t){let n=this.data;for(let i=0;i<2;i++)for(let r,s=this.stateSlot(e,i?2:1);;s+=3){if(65535==(r=n[s])){if(1!=n[s+1]){if(2==n[s+1])return pair(n,s+2);break}r=n[s=pair(n,s+2)]}if(r==t||0==r)return pair(n,s+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,(e=>e==t||null))}allActions(e,t){let n=this.stateSlot(e,4),i=n?t(n):void 0;for(let n=this.stateSlot(e,1);null==i;n+=3){if(65535==this.data[n]){if(1!=this.data[n+1])break;n=pair(this.data,n+2)}i=t(pair(this.data,n+1))}return i}nextStates(e){let t=[];for(let n=this.stateSlot(e,1);;n+=3){if(65535==this.data[n]){if(1!=this.data[n+1])break;n=pair(this.data,n+2)}if(!(1&this.data[n+2])){let e=this.data[n+1];t.some(((t,n)=>1&n&&t==e))||t.push(this.data[n],e)}}return t}configure(e){let t=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let n=this.topRules[e.top];if(!n)throw new RangeError("Invalid top rule name "+e.top);t.top=n}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let n=e.tokenizers.find((e=>e.from==t));return n?n.to:t}))),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map(((n,i)=>{let r=e.specializers.find((e=>e.from==n.external));if(!r)return n;let s=Object.assign(Object.assign({},n),{external:r.to});return t.specializers[i]=getSpecializer(s),s}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),n=t.map((()=>!1));if(e)for(let i of e.split(" ")){let e=t.indexOf(i);e>=0&&(n[e]=!0)}let i=null;for(let e=0;e<t.length;e++)if(!n[e])for(let n,r=this.dialects[t[e]];65535!=(n=this.data[r++]);)(i||(i=new Uint8Array(this.maxTerm+1)))[n]=1;return new Dialect(e,n,i)}static deserialize(e){return new LRParser(e)}}function pair(e,t){return e[t]|e[t+1]<<16}function findFinished(e){let t=null;for(let n of e){let e=n.p.stoppedAt;(n.pos==n.p.stream.end||null!=e&&n.pos>e)&&n.p.parser.stateFlag(n.state,2)&&(!t||t.score<n.score)&&(t=n)}return t}function getSpecializer(e){if(e.external){let t=e.extend?1:0;return(n,i)=>e.external(n,i)<<1|t}return e.get}const scriptText=54,StartCloseScriptTag=1,styleText=55,StartCloseStyleTag=2,textareaText=56,StartCloseTextareaTag=3,EndTag=4,SelfClosingEndTag=5,StartTag=6,StartScriptTag=7,StartStyleTag=8,StartTextareaTag=9,StartSelfClosingTag=10,StartCloseTag=11,NoMatchStartCloseTag=12,MismatchedStartCloseTag=13,missingCloseTag=57,IncompleteCloseTag=14,commentContent$1=58,Element$2=20,TagName=22,Attribute=23,AttributeName=24,AttributeValue=26,UnquotedAttributeValue=27,ScriptText=28,StyleText=31,TextareaText=34,OpenTag=36,CloseTag=37,Dialect_noMatch=0,Dialect_selfClosing=1,selfClosers$1={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed={dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},closeOnOpen={dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}};function nameChar(e){return 45==e||46==e||58==e||e>=65&&e<=90||95==e||e>=97&&e<=122||e>=161}function isSpace(e){return 9==e||10==e||13==e||32==e}let cachedName=null,cachedInput=null,cachedPos=0;function tagNameAfter(e,t){let n=e.pos+t;if(cachedPos==n&&cachedInput==e)return cachedName;let i=e.peek(t);for(;isSpace(i);)i=e.peek(++t);let r="";for(;nameChar(i);)r+=String.fromCharCode(i),i=e.peek(++t);return cachedInput=e,cachedPos=n,cachedName=r?r.toLowerCase():i==question$1||i==bang?void 0:null}const lessThan=60,greaterThan=62,slash$1=47,question$1=63,bang=33,dash$1=45;function ElementContext(e,t){this.name=e,this.parent=t}const startTagTerms=[StartTag,StartSelfClosingTag,StartScriptTag,StartStyleTag,StartTextareaTag],elementContext=new ContextTracker({start:null,shift:(e,t,n,i)=>startTagTerms.indexOf(t)>-1?new ElementContext(tagNameAfter(i,1)||"",e):e,reduce:(e,t)=>t==Element$2&&e?e.parent:e,reuse(e,t,n,i){let r=t.type.id;return r==StartTag||r==OpenTag?new ElementContext(tagNameAfter(i,1)||"",e):e},strict:!1}),tagStart=new ExternalTokenizer(((e,t)=>{if(e.next!=lessThan)return void(e.next<0&&t.context&&e.acceptToken(missingCloseTag));e.advance();let n=e.next==slash$1;n&&e.advance();let i=tagNameAfter(e,0);if(void 0===i)return;if(!i)return e.acceptToken(n?IncompleteCloseTag:StartTag);let r=t.context?t.context.name:null;if(n){if(i==r)return e.acceptToken(StartCloseTag);if(r&&implicitlyClosed[r])return e.acceptToken(missingCloseTag,-2);if(t.dialectEnabled(Dialect_noMatch))return e.acceptToken(NoMatchStartCloseTag);for(let e=t.context;e;e=e.parent)if(e.name==i)return;e.acceptToken(MismatchedStartCloseTag)}else{if("script"==i)return e.acceptToken(StartScriptTag);if("style"==i)return e.acceptToken(StartStyleTag);if("textarea"==i)return e.acceptToken(StartTextareaTag);if(selfClosers$1.hasOwnProperty(i))return e.acceptToken(StartSelfClosingTag);r&&closeOnOpen[r]&&closeOnOpen[r][i]?e.acceptToken(missingCloseTag,-1):e.acceptToken(StartTag)}}),{contextual:!0}),commentContent=new ExternalTokenizer((e=>{for(let t=0,n=0;;n++){if(e.next<0){n&&e.acceptToken(commentContent$1);break}if(e.next==dash$1)t++;else{if(e.next==greaterThan&&t>=2){n>=3&&e.acceptToken(commentContent$1,-2);break}t=0}e.advance()}}));function inForeignElement(e){for(;e;e=e.parent)if("svg"==e.name||"math"==e.name)return!0;return!1}const endTag=new ExternalTokenizer(((e,t)=>{if(e.next==slash$1&&e.peek(1)==greaterThan){let n=t.dialectEnabled(Dialect_selfClosing)||inForeignElement(t.context);e.acceptToken(n?SelfClosingEndTag:EndTag,2)}else e.next==greaterThan&&e.acceptToken(EndTag,1)}));function contentTokenizer(e,t,n){let i=2+e.length;return new ExternalTokenizer((r=>{for(let s=0,o=0,a=0;;a++){if(r.next<0){a&&r.acceptToken(t);break}if(0==s&&r.next==lessThan||1==s&&r.next==slash$1||s>=2&&s<i&&r.next==e.charCodeAt(s-2))s++,o++;else if(2!=s&&s!=i||!isSpace(r.next)){if(s==i&&r.next==greaterThan){a>o?r.acceptToken(t,-o):r.acceptToken(n,-(o-2));break}if((10==r.next||13==r.next)&&a){r.acceptToken(t,1);break}s=o=0}else o++;r.advance()}}))}const scriptTokens=contentTokenizer("script",scriptText,StartCloseScriptTag),styleTokens=contentTokenizer("style",styleText,StartCloseStyleTag),textareaTokens=contentTokenizer("textarea",textareaText,StartCloseTextareaTag),htmlHighlighting=styleTags({"Text RawText":tags$1.content,"StartTag StartCloseTag SelfClosingEndTag EndTag":tags$1.angleBracket,TagName:tags$1.tagName,"MismatchedCloseTag/TagName":[tags$1.tagName,tags$1.invalid],AttributeName:tags$1.attributeName,"AttributeValue UnquotedAttributeValue":tags$1.attributeValue,Is:tags$1.definitionOperator,"EntityReference CharacterReference":tags$1.character,Comment:tags$1.blockComment,ProcessingInst:tags$1.processingInstruction,DoctypeDecl:tags$1.documentMeta}),parser$3=LRParser.deserialize({version:14,states:",xOVO!rOOO!WQ#tO'#CqO!]Q#tO'#CzO!bQ#tO'#C}O!gQ#tO'#DQO!lQ#tO'#DSO!qOaO'#CpO!|ObO'#CpO#XOdO'#CpO$eO!rO'#CpOOO`'#Cp'#CpO$lO$fO'#DTO$tQ#tO'#DVO$yQ#tO'#DWOOO`'#Dk'#DkOOO`'#DY'#DYQVO!rOOO%OQ&rO,59]O%ZQ&rO,59fO%fQ&rO,59iO%qQ&rO,59lO%|Q&rO,59nOOOa'#D^'#D^O&XOaO'#CxO&dOaO,59[OOOb'#D_'#D_O&lObO'#C{O&wObO,59[OOOd'#D`'#D`O'POdO'#DOO'[OdO,59[OOO`'#Da'#DaO'dO!rO,59[O'kQ#tO'#DROOO`,59[,59[OOOp'#Db'#DbO'pO$fO,59oOOO`,59o,59oO'xQ#|O,59qO'}Q#|O,59rOOO`-E7W-E7WO(SQ&rO'#CsOOQW'#DZ'#DZO(bQ&rO1G.wOOOa1G.w1G.wOOO`1G/Y1G/YO(mQ&rO1G/QOOOb1G/Q1G/QO(xQ&rO1G/TOOOd1G/T1G/TO)TQ&rO1G/WOOO`1G/W1G/WO)`Q&rO1G/YOOOa-E7[-E7[O)kQ#tO'#CyOOO`1G.v1G.vOOOb-E7]-E7]O)pQ#tO'#C|OOOd-E7^-E7^O)uQ#tO'#DPOOO`-E7_-E7_O)zQ#|O,59mOOOp-E7`-E7`OOO`1G/Z1G/ZOOO`1G/]1G/]OOO`1G/^1G/^O*PQ,UO,59_OOQW-E7X-E7XOOOa7+$c7+$cOOO`7+$t7+$tOOOb7+$l7+$lOOOd7+$o7+$oOOO`7+$r7+$rO*[Q#|O,59eO*aQ#|O,59hO*fQ#|O,59kOOO`1G/X1G/XO*kO7[O'#CvO*|OMhO'#CvOOQW1G.y1G.yOOO`1G/P1G/POOO`1G/S1G/SOOO`1G/V1G/VOOOO'#D['#D[O+_O7[O,59bOOQW,59b,59bOOOO'#D]'#D]O+pOMhO,59bOOOO-E7Y-E7YOOQW1G.|1G.|OOOO-E7Z-E7Z",stateData:",]~O!^OS~OUSOVPOWQOXROYTO[]O][O^^O`^Oa^Ob^Oc^Ox^O{_O!dZO~OfaO~OfbO~OfcO~OfdO~OfeO~O!WfOPlP!ZlP~O!XiOQoP!ZoP~O!YlORrP!ZrP~OUSOVPOWQOXROYTOZqO[]O][O^^O`^Oa^Ob^Oc^Ox^O!dZO~O!ZrO~P#dO![sO!euO~OfvO~OfwO~OS|OT}OhyO~OS!POT}OhyO~OS!ROT}OhyO~OS!TOT}OhyO~OS}OT}OhyO~O!WfOPlX!ZlX~OP!WO!Z!XO~O!XiOQoX!ZoX~OQ!ZO!Z!XO~O!YlORrX!ZrX~OR!]O!Z!XO~O!Z!XO~P#dOf!_O~O![sO!e!aO~OS!bO~OS!cO~Oi!dOSgXTgXhgX~OS!fOT!gOhyO~OS!hOT!gOhyO~OS!iOT!gOhyO~OS!jOT!gOhyO~OS!gOT!gOhyO~Of!kO~Of!lO~Of!mO~OS!nO~Ok!qO!`!oO!b!pO~OS!rO~OS!sO~OS!tO~Oa!uOb!uOc!uO!`!wO!a!uO~Oa!xOb!xOc!xO!b!wO!c!xO~Oa!uOb!uOc!uO!`!{O!a!uO~Oa!xOb!xOc!xO!b!{O!c!xO~OT~bac!dx{!d~",goto:"%p!`PPPPPPPPPPPPPPPPPPPP!a!gP!mPP!yP!|#P#S#Y#]#`#f#i#l#r#x!aP!a!aP$O$U$l$r$x%O%U%[%bPPPPPPPP%hX^OX`pXUOX`pezabcde{!O!Q!S!UR!q!dRhUR!XhXVOX`pRkVR!XkXWOX`pRnWR!XnXXOX`pQrXR!XpXYOX`pQ`ORx`Q{aQ!ObQ!QcQ!SdQ!UeZ!e{!O!Q!S!UQ!v!oR!z!vQ!y!pR!|!yQgUR!VgQjVR!YjQmWR![mQpXR!^pQtZR!`tS_O`ToXp",nodeNames:"⚠ StartCloseTag StartCloseTag StartCloseTag EndTag SelfClosingEndTag StartTag StartTag StartTag StartTag StartTag StartCloseTag StartCloseTag StartCloseTag IncompleteCloseTag Document Text EntityReference CharacterReference InvalidEntity Element OpenTag TagName Attribute AttributeName Is AttributeValue UnquotedAttributeValue ScriptText CloseTag OpenTag StyleText CloseTag OpenTag TextareaText CloseTag OpenTag CloseTag SelfClosingTag Comment ProcessingInst MismatchedCloseTag CloseTag DoctypeDecl",maxTerm:67,context:elementContext,nodeProps:[["closedBy",-10,1,2,3,7,8,9,10,11,12,13,"EndTag",6,"EndTag SelfClosingEndTag",-4,21,30,33,36,"CloseTag"],["openedBy",4,"StartTag StartCloseTag",5,"StartTag",-4,29,32,35,37,"OpenTag"],["group",-9,14,17,18,19,20,39,40,41,42,"Entity",16,"Entity TextContent",-3,28,31,34,"TextContent Entity"],["isolate",-11,21,29,30,32,33,35,36,37,38,41,42,"ltr",-3,26,27,39,""]],propSources:[htmlHighlighting],skippedNodes:[0],repeatNodeCount:9,tokenData:"!<p!aR!YOX$qXY,QYZ,QZ[$q[]&X]^,Q^p$qpq,Qqr-_rs3_sv-_vw3}wxHYx}-_}!OH{!O!P-_!P!Q$q!Q![-_![!]Mz!]!^-_!^!_!$S!_!`!;x!`!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4U-_4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!Z$|c`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr$qrs&}sv$qvw+Pwx(tx!^$q!^!_*V!_!a&X!a#S$q#S#T&X#T;'S$q;'S;=`+z<%lO$q!R&bX`P!a`!cpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&Xq'UV`P!cpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}P'pT`POv'kw!^'k!_;'S'k;'S;=`(P<%lO'kP(SP;=`<%l'kp([S!cpOv(Vx;'S(V;'S;=`(h<%lO(Vp(kP;=`<%l(Vq(qP;=`<%l&}a({W`P!a`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t`)jT!a`Or)esv)ew;'S)e;'S;=`)y<%lO)e`)|P;=`<%l)ea*SP;=`<%l(t!Q*^V!a`!cpOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!Q*vP;=`<%l*V!R*|P;=`<%l&XW+UYkWOX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+PW+wP;=`<%l+P!Z+}P;=`<%l$q!a,]``P!a`!cp!^^OX&XXY,QYZ,QZ]&X]^,Q^p&Xpq,Qqr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!_-ljhS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q[/ebhSkWOX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+PS0rXhSqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0mS1bP;=`<%l0m[1hP;=`<%l/^!V1vchS`P!a`!cpOq&Xqr1krs&}sv1kvw0mwx(tx!P1k!P!Q&X!Q!^1k!^!_*V!_!a&X!a#s1k#s$f&X$f;'S1k;'S;=`3R<%l?Ah1k?Ah?BY&X?BY?Mn1k?MnO&X!V3UP;=`<%l1k!_3[P;=`<%l-_!Z3hV!`h`P!cpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}!_4WihSkWc!ROX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst>]tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^/^!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!Z5zbkWOX5uXZ7SZ[5u[^7S^p5uqr5urs7Sst+Ptw5uwx7Sx!]5u!]!^7w!^!a7S!a#S5u#S#T7S#T;'S5u;'S;=`8n<%lO5u!R7VVOp7Sqs7St!]7S!]!^7l!^;'S7S;'S;=`7q<%lO7S!R7qOa!R!R7tP;=`<%l7S!Z8OYkWa!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!Z8qP;=`<%l5u!_8{ihSkWOX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst/^tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^:j!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!_:sbhSkWa!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!V<QchSOp7Sqr;{rs7Sst0mtw;{wx7Sx!P;{!P!Q7S!Q!];{!]!^=]!^!a7S!a#s;{#s$f7S$f;'S;{;'S;=`>P<%l?Ah;{?Ah?BY7S?BY?Mn;{?MnO7S!V=dXhSa!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!V>SP;=`<%l;{!_>YP;=`<%l8t!_>dhhSkWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^/^!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!Z@TakWOX@OXZAYZ[@O[^AY^p@Oqr@OrsAYsw@OwxAYx!]@O!]!^Az!^!aAY!a#S@O#S#TAY#T;'S@O;'S;=`Bq<%lO@O!RA]UOpAYq!]AY!]!^Ao!^;'SAY;'S;=`At<%lOAY!RAtOb!R!RAwP;=`<%lAY!ZBRYkWb!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!ZBtP;=`<%l@O!_COhhSkWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^Dj!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!_DsbhSkWb!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!VFQbhSOpAYqrE{rsAYswE{wxAYx!PE{!P!QAY!Q!]E{!]!^GY!^!aAY!a#sE{#s$fAY$f;'SE{;'S;=`G|<%l?AhE{?Ah?BYAY?BY?MnE{?MnOAY!VGaXhSb!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!VHPP;=`<%lE{!_HVP;=`<%lBw!ZHcW!bx`P!a`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t!aIYlhS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OKQ!O!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!aK_khS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!`&X!`!aMS!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!TM_X`P!a`!cp!eQOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!aNZ!ZhSfQ`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OMz!O!PMz!P!Q$q!Q![Mz![!]Mz!]!^-_!^!_*V!_!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f$}-_$}%OMz%O%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4UMz4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Je-_$Je$JgMz$Jg$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!a!$PP;=`<%lMz!R!$ZY!a`!cpOq*Vqr!$yrs(Vsv*Vwx)ex!a*V!a!b!4t!b;'S*V;'S;=`*s<%lO*V!R!%Q]!a`!cpOr*Vrs(Vsv*Vwx)ex}*V}!O!%y!O!f*V!f!g!']!g#W*V#W#X!0`#X;'S*V;'S;=`*s<%lO*V!R!&QX!a`!cpOr*Vrs(Vsv*Vwx)ex}*V}!O!&m!O;'S*V;'S;=`*s<%lO*V!R!&vV!a`!cp!dPOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!'dX!a`!cpOr*Vrs(Vsv*Vwx)ex!q*V!q!r!(P!r;'S*V;'S;=`*s<%lO*V!R!(WX!a`!cpOr*Vrs(Vsv*Vwx)ex!e*V!e!f!(s!f;'S*V;'S;=`*s<%lO*V!R!(zX!a`!cpOr*Vrs(Vsv*Vwx)ex!v*V!v!w!)g!w;'S*V;'S;=`*s<%lO*V!R!)nX!a`!cpOr*Vrs(Vsv*Vwx)ex!{*V!{!|!*Z!|;'S*V;'S;=`*s<%lO*V!R!*bX!a`!cpOr*Vrs(Vsv*Vwx)ex!r*V!r!s!*}!s;'S*V;'S;=`*s<%lO*V!R!+UX!a`!cpOr*Vrs(Vsv*Vwx)ex!g*V!g!h!+q!h;'S*V;'S;=`*s<%lO*V!R!+xY!a`!cpOr!+qrs!,hsv!+qvw!-Swx!.[x!`!+q!`!a!/j!a;'S!+q;'S;=`!0Y<%lO!+qq!,mV!cpOv!,hvx!-Sx!`!,h!`!a!-q!a;'S!,h;'S;=`!.U<%lO!,hP!-VTO!`!-S!`!a!-f!a;'S!-S;'S;=`!-k<%lO!-SP!-kO{PP!-nP;=`<%l!-Sq!-xS!cp{POv(Vx;'S(V;'S;=`(h<%lO(Vq!.XP;=`<%l!,ha!.aX!a`Or!.[rs!-Ssv!.[vw!-Sw!`!.[!`!a!.|!a;'S!.[;'S;=`!/d<%lO!.[a!/TT!a`{POr)esv)ew;'S)e;'S;=`)y<%lO)ea!/gP;=`<%l!.[!R!/sV!a`!cp{POr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!0]P;=`<%l!+q!R!0gX!a`!cpOr*Vrs(Vsv*Vwx)ex#c*V#c#d!1S#d;'S*V;'S;=`*s<%lO*V!R!1ZX!a`!cpOr*Vrs(Vsv*Vwx)ex#V*V#V#W!1v#W;'S*V;'S;=`*s<%lO*V!R!1}X!a`!cpOr*Vrs(Vsv*Vwx)ex#h*V#h#i!2j#i;'S*V;'S;=`*s<%lO*V!R!2qX!a`!cpOr*Vrs(Vsv*Vwx)ex#m*V#m#n!3^#n;'S*V;'S;=`*s<%lO*V!R!3eX!a`!cpOr*Vrs(Vsv*Vwx)ex#d*V#d#e!4Q#e;'S*V;'S;=`*s<%lO*V!R!4XX!a`!cpOr*Vrs(Vsv*Vwx)ex#X*V#X#Y!+q#Y;'S*V;'S;=`*s<%lO*V!R!4{Y!a`!cpOr!4trs!5ksv!4tvw!6Vwx!8]x!a!4t!a!b!:]!b;'S!4t;'S;=`!;r<%lO!4tq!5pV!cpOv!5kvx!6Vx!a!5k!a!b!7W!b;'S!5k;'S;=`!8V<%lO!5kP!6YTO!a!6V!a!b!6i!b;'S!6V;'S;=`!7Q<%lO!6VP!6lTO!`!6V!`!a!6{!a;'S!6V;'S;=`!7Q<%lO!6VP!7QOxPP!7TP;=`<%l!6Vq!7]V!cpOv!5kvx!6Vx!`!5k!`!a!7r!a;'S!5k;'S;=`!8V<%lO!5kq!7yS!cpxPOv(Vx;'S(V;'S;=`(h<%lO(Vq!8YP;=`<%l!5ka!8bX!a`Or!8]rs!6Vsv!8]vw!6Vw!a!8]!a!b!8}!b;'S!8];'S;=`!:V<%lO!8]a!9SX!a`Or!8]rs!6Vsv!8]vw!6Vw!`!8]!`!a!9o!a;'S!8];'S;=`!:V<%lO!8]a!9vT!a`xPOr)esv)ew;'S)e;'S;=`)y<%lO)ea!:YP;=`<%l!8]!R!:dY!a`!cpOr!4trs!5ksv!4tvw!6Vwx!8]x!`!4t!`!a!;S!a;'S!4t;'S;=`!;r<%lO!4t!R!;]V!a`!cpxPOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!;uP;=`<%l!4t!V!<TXiS`P!a`!cpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X",tokenizers:[scriptTokens,styleTokens,textareaTokens,endTag,tagStart,commentContent,0,1,2,3,4,5],topRules:{Document:[0,15]},dialects:{noMatch:0,selfClosing:509},tokenPrec:511});function getAttrs(e,t){let n=Object.create(null);for(let i of e.getChildren(Attribute)){let e=i.getChild(AttributeName),r=i.getChild(AttributeValue)||i.getChild(UnquotedAttributeValue);e&&(n[t.read(e.from,e.to)]=r?r.type.id==AttributeValue?t.read(r.from+1,r.to-1):t.read(r.from,r.to):"")}return n}function findTagName(e,t){let n=e.getChild(TagName);return n?t.read(n.from,n.to):" "}function maybeNest(e,t,n){let i;for(let r of n)if(!r.attrs||r.attrs(i||(i=getAttrs(e.node.parent.firstChild,t))))return{parser:r.parser};return null}function configureNesting(e=[],t=[]){let n=[],i=[],r=[],s=[];for(let t of e)("script"==t.tag?n:"style"==t.tag?i:"textarea"==t.tag?r:s).push(t);let o=t.length?Object.create(null):null;for(let e of t)(o[e.name]||(o[e.name]=[])).push(e);return parseMixed(((e,t)=>{let a=e.type.id;if(a==ScriptText)return maybeNest(e,t,n);if(a==StyleText)return maybeNest(e,t,i);if(a==TextareaText)return maybeNest(e,t,r);if(a==Element$2&&s.length){let n,i=e.node,r=i.firstChild,o=r&&findTagName(r,t);if(o)for(let e of s)if(e.tag==o&&(!e.attrs||e.attrs(n||(n=getAttrs(r,t))))){let t=i.lastChild,n=t.type.id==CloseTag?t.from:i.to;if(n>r.to)return{parser:e.parser,overlay:[{from:r.to,to:n}]}}}if(o&&a==Attribute){let n,i=e.node;if(n=i.firstChild){let e=o[t.read(n.from,n.to)];if(e)for(let n of e){if(n.tagName&&n.tagName!=findTagName(i.parent,t))continue;let e=i.lastChild;if(e.type.id==AttributeValue){let t=e.from+1,i=e.lastChild,r=e.to-(i&&i.isError?0:1);if(r>t)return{parser:n.parser,overlay:[{from:t,to:r}]}}else if(e.type.id==UnquotedAttributeValue)return{parser:n.parser,overlay:[{from:e.from,to:e.to}]}}}}return null}))}const descendantOp=100,Unit=1,callee=101,identifier$2=102,VariableName=2,space$2=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],colon=58,parenL=40,underscore=95,bracketL$1=91,dash=45,period=46,hash=35,percent=37,ampersand=38,backslash=92,newline$1=10;function isAlpha(e){return e>=65&&e<=90||e>=97&&e<=122||e>=161}function isDigit(e){return e>=48&&e<=57}const identifiers=new ExternalTokenizer(((e,t)=>{for(let n=!1,i=0,r=0;;r++){let{next:s}=e;if(isAlpha(s)||s==dash||s==underscore||n&&isDigit(s))!n&&(s!=dash||r>0)&&(n=!0),i===r&&s==dash&&i++,e.advance();else{if(s!=backslash||e.peek(1)==newline$1){n&&e.acceptToken(s==parenL?callee:2==i&&t.canShift(VariableName)?VariableName:identifier$2);break}e.advance(),e.next>-1&&e.advance(),n=!0}}})),descendant=new ExternalTokenizer((e=>{if(space$2.includes(e.peek(-1))){let{next:t}=e;(isAlpha(t)||t==underscore||t==hash||t==period||t==bracketL$1||t==colon&&isAlpha(e.peek(1))||t==dash||t==ampersand)&&e.acceptToken(descendantOp)}})),unitToken=new ExternalTokenizer((e=>{if(!space$2.includes(e.peek(-1))){let{next:t}=e;if(t==percent&&(e.advance(),e.acceptToken(Unit)),isAlpha(t)){do{e.advance()}while(isAlpha(e.next)||isDigit(e.next));e.acceptToken(Unit)}}})),cssHighlighting=styleTags({"AtKeyword import charset namespace keyframes media supports":tags$1.definitionKeyword,"from to selector":tags$1.keyword,NamespaceName:tags$1.namespace,KeyframeName:tags$1.labelName,KeyframeRangeName:tags$1.operatorKeyword,TagName:tags$1.tagName,ClassName:tags$1.className,PseudoClassName:tags$1.constant(tags$1.className),IdName:tags$1.labelName,"FeatureName PropertyName":tags$1.propertyName,AttributeName:tags$1.attributeName,NumberLiteral:tags$1.number,KeywordQuery:tags$1.keyword,UnaryQueryOp:tags$1.operatorKeyword,"CallTag ValueName":tags$1.atom,VariableName:tags$1.variableName,Callee:tags$1.operatorKeyword,Unit:tags$1.unit,"UniversalSelector NestingSelector":tags$1.definitionOperator,MatchOp:tags$1.compareOperator,"ChildOp SiblingOp, LogicOp":tags$1.logicOperator,BinOp:tags$1.arithmeticOperator,Important:tags$1.modifier,Comment:tags$1.blockComment,ColorLiteral:tags$1.color,"ParenthesizedContent StringLiteral":tags$1.string,":":tags$1.punctuation,"PseudoOp #":tags$1.derefOperator,"; ,":tags$1.separator,"( )":tags$1.paren,"[ ]":tags$1.squareBracket,"{ }":tags$1.brace}),spec_callee={__proto__:null,lang:34,"nth-child":34,"nth-last-child":34,"nth-of-type":34,"nth-last-of-type":34,dir:34,"host-context":34,url:62,"url-prefix":62,domain:62,regexp:62,selector:140},spec_AtKeyword={__proto__:null,"@import":120,"@media":144,"@charset":148,"@namespace":152,"@keyframes":158,"@supports":170},spec_identifier$1={__proto__:null,not:134,only:134},parser$2=LRParser.deserialize({version:14,states:":jQYQ[OOO#_Q[OOP#fOWOOOOQP'#Cd'#CdOOQP'#Cc'#CcO#kQ[O'#CfO$_QXO'#CaO$fQ[O'#CiO$qQ[O'#DUO$vQ[O'#DXOOQP'#En'#EnO${QdO'#DhO%jQ[O'#DuO${QdO'#DwO%{Q[O'#DyO&WQ[O'#D|O&`Q[O'#ESO&nQ[O'#EUOOQS'#Em'#EmOOQS'#EX'#EXQYQ[OOO&uQXO'#CdO'jQWO'#DdO'oQWO'#EsO'zQ[O'#EsQOQWOOP(UO#tO'#C_POOO)C@])C@]OOQP'#Ch'#ChOOQP,59Q,59QO#kQ[O,59QO(aQ[O'#E]O({QWO,58{O)TQ[O,59TO$qQ[O,59pO$vQ[O,59sO(aQ[O,59vO(aQ[O,59xO(aQ[O,59yO)`Q[O'#DcOOQS,58{,58{OOQP'#Cl'#ClOOQO'#DS'#DSOOQP,59T,59TO)gQWO,59TO)lQWO,59TOOQP'#DW'#DWOOQP,59p,59pOOQO'#DY'#DYO)qQ`O,59sOOQS'#Cq'#CqO${QdO'#CrO)yQvO'#CtO+ZQtO,5:SOOQO'#Cy'#CyO)lQWO'#CxO+oQWO'#CzO+tQ[O'#DPOOQS'#Ep'#EpOOQO'#Dk'#DkO+|Q[O'#DrO,[QWO'#EtO&`Q[O'#DpO,jQWO'#DsOOQO'#Eu'#EuO)OQWO,5:aO,oQpO,5:cOOQS'#D{'#D{O,wQWO,5:eO,|Q[O,5:eOOQO'#EO'#EOO-UQWO,5:hO-ZQWO,5:nO-cQWO,5:pOOQS-E8V-E8VO-kQdO,5:OO-{Q[O'#E_O.YQWO,5;_O.YQWO,5;_POOO'#EW'#EWP.eO#tO,58yPOOO,58y,58yOOQP1G.l1G.lO/[QXO,5:wOOQO-E8Z-E8ZOOQS1G.g1G.gOOQP1G.o1G.oO)gQWO1G.oO)lQWO1G.oOOQP1G/[1G/[O/iQ`O1G/_O0SQXO1G/bO0jQXO1G/dO1QQXO1G/eO1hQWO,59}O1mQ[O'#DTO1tQdO'#CpOOQP1G/_1G/_O${QdO1G/_O1{QpO,59^OOQS,59`,59`O${QdO,59bO2TQWO1G/nOOQS,59d,59dO2YQ!bO,59fOOQS'#DQ'#DQOOQS'#EZ'#EZO2eQ[O,59kOOQS,59k,59kO2mQWO'#DkO2xQWO,5:WO2}QWO,5:^O&`Q[O,5:YO&`Q[O'#E`O3VQWO,5;`O3bQWO,5:[O(aQ[O,5:_OOQS1G/{1G/{OOQS1G/}1G/}OOQS1G0P1G0PO3sQWO1G0PO3xQdO'#EPOOQS1G0S1G0SOOQS1G0Y1G0YOOQS1G0[1G0[O4TQtO1G/jOOQO1G/j1G/jOOQO,5:y,5:yO4kQ[O,5:yOOQO-E8]-E8]O4xQWO1G0yPOOO-E8U-E8UPOOO1G.e1G.eOOQP7+$Z7+$ZOOQP7+$y7+$yO${QdO7+$yOOQS1G/i1G/iO5TQXO'#ErO5[QWO,59oO5aQtO'#EYO6XQdO'#EoO6cQWO,59[O6hQpO7+$yOOQS1G.x1G.xOOQS1G.|1G.|OOQS7+%Y7+%YOOQS1G/Q1G/QO6pQWO1G/QOOQS-E8X-E8XOOQS1G/V1G/VO${QdO1G/rOOQO1G/x1G/xOOQO1G/t1G/tO6uQWO,5:zOOQO-E8^-E8^O7TQXO1G/yOOQS7+%k7+%kO7[QYO'#CtOOQO'#ER'#ERO7gQ`O'#EQOOQO'#EQ'#EQO7rQWO'#EaO7zQdO,5:kOOQS,5:k,5:kO8VQtO'#E^O${QdO'#E^O9WQdO7+%UOOQO7+%U7+%UOOQO1G0e1G0eO9kQpO<<HeO9sQWO,5;^OOQP1G/Z1G/ZOOQS-E8W-E8WO${QdO'#E[O9{QWO,5;ZOOQT1G.v1G.vOOQP<<He<<HeOOQS7+$l7+$lO:TQdO7+%^OOQO7+%e7+%eOOQO,5:l,5:lO3{QdO'#EbO7rQWO,5:{OOQS,5:{,5:{OOQS-E8_-E8_OOQS1G0V1G0VO:[QtO,5:xOOQS-E8[-E8[OOQO<<Hp<<HpOOQPAN>PAN>PO;]QdO,5:vOOQO-E8Y-E8YOOQO<<Hx<<HxOOQO,5:|,5:|OOQO-E8`-E8`OOQS1G0g1G0g",stateData:";o~O#[OS#]QQ~OUYOXYOZTO^VO_VOrXOyWO!]aO!^ZO!j[O!l]O!n^O!q_O!w`O#YRO~OQfOUYOXYOZTO^VO_VOrXOyWO!]aO!^ZO!j[O!l]O!n^O!q_O!w`O#YeO~O#V#gP~P!ZO#]jO~O#YlO~OZnO^qO_qOrsOuoOyrO!PtO!SvO#WuO~O!UwO~P#pOa}O#XzO#YyO~O#Y!OO~O#Y!QO~OQ![Oc!TOg![Oi![Oo!YOr!ZO#X!WO#Y!SO#e!UO~Oc!^O!e!`O!h!aO#Y!]O!U#hP~Oi!fOo!YO#Y!eO~Oi!hO#Y!hO~Oc!^O!e!`O!h!aO#Y!]O~O!Z#hP~P%jOZWX^WX^!XX_WXrWXuWXyWX!PWX!SWX!UWX#WWX~O^!mO~O!Z!nO#V#gX!T#gX~O#V#gX!T#gX~P!ZO#^!qO#_!qO#`!sO~OUYOXYOZTO^VO_VOrXOyWO#YRO~OuoO!UwO~Oa!zO#XzO#YyO~O!T#gP~P!ZOc#RO~Oc#SO~Oq#TO}#UO~OP#WOchXkhX!ZhX!ehX!hhX#YhXbhXQhXghXihXohXrhXuhX!YhX#VhX#XhX#ehXqhX!ThX~Oc!^Ok#XO!e!`O!h!aO#Y!]O!Z#hP~Oc#[O~Oq#`O#Y#]O~Oc!^O!e!`O!h!aO#Y#aO~Ou#eO!c#dO!U#hX!Z#hX~Oc#hO~Ok#XO!Z#jO~O!Z#kO~Oi#lOo!YO~O!U#mO~O!UwO!c#dO~O!UwO!Z#pO~O!Y#rO!Z!Wa#V!Wa!T!Wa~P${O!Z#RX#V#RX!T#RX~P!ZO!Z!nO#V#ga!T#ga~O#^!qO#_!qO#`#xO~OZnO^qO_qOrsOyrO!PtO!SvO#WuO~Ou#Pa!U#Pab#Pa~P.pOq#zO}#{O~OZnO^qO_qOrsOyrO~Ou!Oi!P!Oi!S!Oi!U!Oi#W!Oib!Oi~P/qOu!Qi!P!Qi!S!Qi!U!Qi#W!Qib!Qi~P/qOu!Ri!P!Ri!S!Ri!U!Ri#W!Rib!Ri~P/qO!T#|O~Ob#fP~P(aOb#cP~P${Ob$TOk#XO~O!Z$VO~Ob$WOi$XOp$XO~Oq$ZO#Y#]O~O^!aXb!_X!c!_X~O^$[O~Ob$]O!c#dO~Ou#eO!U#ha!Z#ha~O!c#dOu!da!U!da!Z!dab!da~O!Z$bO~O!T$iO#Y$dO#e$cO~Ok#XOu$kO!Y$mO!Z!Wi#V!Wi!T!Wi~P${O!Z#Ra#V#Ra!T#Ra~P!ZO!Z!nO#V#gi!T#gi~Ob#fX~P#pOb$qO~Ok#XOQ!|Xb!|Xc!|Xg!|Xi!|Xo!|Xr!|Xu!|X#X!|X#Y!|X#e!|X~Ou$sOb#cX~P${Ob$uO~Ok#XOq$vO~Ob$wO~O!c#dOu#Sa!U#Sa!Z#Sa~Ob$yO~P.pOP#WOuhX!UhX~O#e$cOu!tX!U!tX~Ou${O!UwO~O!T%PO#Y$dO#e$cO~Ok#XOQ#QXc#QXg#QXi#QXo#QXr#QXu#QX!Y#QX!Z#QX#V#QX#X#QX#Y#QX#e#QX!T#QX~Ou$kO!Y%SO!Z!Wq#V!Wq!T!Wq~P${Ok#XOq%TO~OuoOb#fa~Ou$sOb#ca~Ob%WO~P${Ok#XOQ#Qac#Qag#Qai#Qao#Qar#Qau#Qa!Y#Qa!Z#Qa#V#Qa#X#Qa#Y#Qa#e#Qa!T#Qa~Ob#Oau#Oa~P${O#[p#]#ek!S#e~",goto:"-g#jPPP#kP#nP#w$WP#wP$g#wPP$mPPP$s$|$|P%`P$|P$|%z&^PPPP$|&vP&z'Q#wP'W#w'^P#wP#w#wPPP'd'y(WPP#nPP(_(_(i(_P(_P(_(_P#nP#nP#nP(l#nP(o(r(u(|#nP#nP)R)X)h)v)|*S*^*d*n*t*zPPPPPPPPPP+Q+Z+v+yP,o,r,x-RRkQ_bOPdhw!n#tkYOPdhotuvw!n#R#h#tkSOPdhotuvw!n#R#h#tQmTR!tnQ{VR!xqQ!x}Q#Z!XR#y!zq![Z]!T!m#S#U#X#q#{$Q$[$k$l$s$x%Up![Z]!T!m#S#U#X#q#{$Q$[$k$l$s$x%UU$f#m$h${R$z$eq!XZ]!T!m#S#U#X#q#{$Q$[$k$l$s$x%Up![Z]!T!m#S#U#X#q#{$Q$[$k$l$s$x%UQ!f^R#l!gT#^!Z#_Q|VR!yqQ!x|R#y!yQ!PWR!{rQ!RXR!|sQxUQ!wpQ#i!cQ#o!jQ#p!kQ$}$gR%Z$|SgPwQ!phQ#s!nR$n#tZfPhw!n#ta!b[`a!V!^!`#d#eR#b!^R!g^R!i_R#n!iS$g#m$hR%X${V$e#m$h${Q!rjR#w!rQdOShPwU!ldh#tR#t!nQ$Q#SU$r$Q$x%UQ$x$[R%U$sQ#_!ZR$Y#_Q$t$QR%V$tQpUS!vp$pR$p#}Q$l#qR%R$lQ!ogS#u!o#vR#v!pQ#f!_R$`#fQ$h#mR%O$hQ$|$gR%Y$|_cOPdhw!n#t^UOPdhw!n#tQ!uoQ!}tQ#OuQ#PvQ#}#RR$a#hR$R#SQ!VZQ!d]Q#V!TQ#q!m[$P#S$Q$[$s$x%UQ$S#UQ$U#XS$j#q$lQ$o#{R%Q$kR$O#RQiPR#QwQ!c[Q!kaR#Y!VU!_[a!VQ!j`Q#c!^Q#g!`Q$^#dR$_#e",nodeNames:"⚠ Unit VariableName Comment StyleSheet RuleSet UniversalSelector TagSelector TagName NestingSelector ClassSelector . ClassName PseudoClassSelector : :: PseudoClassName PseudoClassName ) ( ArgList ValueName ParenthesizedValue ColorLiteral NumberLiteral StringLiteral BinaryExpression BinOp CallExpression Callee CallLiteral CallTag ParenthesizedContent ] [ LineNames LineName , PseudoClassName ArgList IdSelector # IdName AttributeSelector AttributeName MatchOp ChildSelector ChildOp DescendantSelector SiblingSelector SiblingOp } { Block Declaration PropertyName Important ; ImportStatement AtKeyword import KeywordQuery FeatureQuery FeatureName BinaryQuery LogicOp UnaryQuery UnaryQueryOp ParenthesizedQuery SelectorQuery selector MediaStatement media CharsetStatement charset NamespaceStatement namespace NamespaceName KeyframesStatement keyframes KeyframeName KeyframeList KeyframeSelector KeyframeRangeName SupportsStatement supports AtRule Styles",maxTerm:117,nodeProps:[["isolate",-2,3,25,""],["openedBy",18,"(",33,"[",51,"{"],["closedBy",19,")",34,"]",52,"}"]],propSources:[cssHighlighting],skippedNodes:[0,3,88],repeatNodeCount:11,tokenData:"J^~R!^OX$}X^%u^p$}pq%uqr)Xrs.Rst/utu6duv$}vw7^wx7oxy9^yz9oz{9t{|:_|}?Q}!O?c!O!P@Q!P!Q@i!Q![Ab![!]B]!]!^CX!^!_$}!_!`Cj!`!aC{!a!b$}!b!cDw!c!}$}!}#OFa#O#P$}#P#QFr#Q#R6d#R#T$}#T#UGT#U#c$}#c#dHf#d#o$}#o#pH{#p#q6d#q#rI^#r#sIo#s#y$}#y#z%u#z$f$}$f$g%u$g#BY$}#BY#BZ%u#BZ$IS$}$IS$I_%u$I_$I|$}$I|$JO%u$JO$JT$}$JT$JU%u$JU$KV$}$KV$KW%u$KW&FU$}&FU&FV%u&FV;'S$};'S;=`JW<%lO$}`%QSOy%^z;'S%^;'S;=`%o<%lO%^`%cSp`Oy%^z;'S%^;'S;=`%o<%lO%^`%rP;=`<%l%^~%zh#[~OX%^X^'f^p%^pq'fqy%^z#y%^#y#z'f#z$f%^$f$g'f$g#BY%^#BY#BZ'f#BZ$IS%^$IS$I_'f$I_$I|%^$I|$JO'f$JO$JT%^$JT$JU'f$JU$KV%^$KV$KW'f$KW&FU%^&FU&FV'f&FV;'S%^;'S;=`%o<%lO%^~'mh#[~p`OX%^X^'f^p%^pq'fqy%^z#y%^#y#z'f#z$f%^$f$g'f$g#BY%^#BY#BZ'f#BZ$IS%^$IS$I_'f$I_$I|%^$I|$JO'f$JO$JT%^$JT$JU'f$JU$KV%^$KV$KW'f$KW&FU%^&FU&FV'f&FV;'S%^;'S;=`%o<%lO%^l)[UOy%^z#]%^#]#^)n#^;'S%^;'S;=`%o<%lO%^l)sUp`Oy%^z#a%^#a#b*V#b;'S%^;'S;=`%o<%lO%^l*[Up`Oy%^z#d%^#d#e*n#e;'S%^;'S;=`%o<%lO%^l*sUp`Oy%^z#c%^#c#d+V#d;'S%^;'S;=`%o<%lO%^l+[Up`Oy%^z#f%^#f#g+n#g;'S%^;'S;=`%o<%lO%^l+sUp`Oy%^z#h%^#h#i,V#i;'S%^;'S;=`%o<%lO%^l,[Up`Oy%^z#T%^#T#U,n#U;'S%^;'S;=`%o<%lO%^l,sUp`Oy%^z#b%^#b#c-V#c;'S%^;'S;=`%o<%lO%^l-[Up`Oy%^z#h%^#h#i-n#i;'S%^;'S;=`%o<%lO%^l-uS!Y[p`Oy%^z;'S%^;'S;=`%o<%lO%^~.UWOY.RZr.Rrs.ns#O.R#O#P.s#P;'S.R;'S;=`/o<%lO.R~.sOi~~.vRO;'S.R;'S;=`/P;=`O.R~/SXOY.RZr.Rrs.ns#O.R#O#P.s#P;'S.R;'S;=`/o;=`<%l.R<%lO.R~/rP;=`<%l.Rn/zYyQOy%^z!Q%^!Q![0j![!c%^!c!i0j!i#T%^#T#Z0j#Z;'S%^;'S;=`%o<%lO%^l0oYp`Oy%^z!Q%^!Q![1_![!c%^!c!i1_!i#T%^#T#Z1_#Z;'S%^;'S;=`%o<%lO%^l1dYp`Oy%^z!Q%^!Q![2S![!c%^!c!i2S!i#T%^#T#Z2S#Z;'S%^;'S;=`%o<%lO%^l2ZYg[p`Oy%^z!Q%^!Q![2y![!c%^!c!i2y!i#T%^#T#Z2y#Z;'S%^;'S;=`%o<%lO%^l3QYg[p`Oy%^z!Q%^!Q![3p![!c%^!c!i3p!i#T%^#T#Z3p#Z;'S%^;'S;=`%o<%lO%^l3uYp`Oy%^z!Q%^!Q![4e![!c%^!c!i4e!i#T%^#T#Z4e#Z;'S%^;'S;=`%o<%lO%^l4lYg[p`Oy%^z!Q%^!Q![5[![!c%^!c!i5[!i#T%^#T#Z5[#Z;'S%^;'S;=`%o<%lO%^l5aYp`Oy%^z!Q%^!Q![6P![!c%^!c!i6P!i#T%^#T#Z6P#Z;'S%^;'S;=`%o<%lO%^l6WSg[p`Oy%^z;'S%^;'S;=`%o<%lO%^d6gUOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^d7QS}Sp`Oy%^z;'S%^;'S;=`%o<%lO%^b7cSXQOy%^z;'S%^;'S;=`%o<%lO%^~7rWOY7oZw7owx.nx#O7o#O#P8[#P;'S7o;'S;=`9W<%lO7o~8_RO;'S7o;'S;=`8h;=`O7o~8kXOY7oZw7owx.nx#O7o#O#P8[#P;'S7o;'S;=`9W;=`<%l7o<%lO7o~9ZP;=`<%l7on9cSc^Oy%^z;'S%^;'S;=`%o<%lO%^~9tOb~n9{UUQkWOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^n:fWkW!SQOy%^z!O%^!O!P;O!P!Q%^!Q![>T![;'S%^;'S;=`%o<%lO%^l;TUp`Oy%^z!Q%^!Q![;g![;'S%^;'S;=`%o<%lO%^l;nYp`#e[Oy%^z!Q%^!Q![;g![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^l<cYp`Oy%^z{%^{|=R|}%^}!O=R!O!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l=WUp`Oy%^z!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l=qUp`#e[Oy%^z!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l>[[p`#e[Oy%^z!O%^!O!P;g!P!Q%^!Q![>T![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^n?VSu^Oy%^z;'S%^;'S;=`%o<%lO%^l?hWkWOy%^z!O%^!O!P;O!P!Q%^!Q![>T![;'S%^;'S;=`%o<%lO%^n@VUZQOy%^z!Q%^!Q![;g![;'S%^;'S;=`%o<%lO%^~@nTkWOy%^z{@}{;'S%^;'S;=`%o<%lO%^~AUSp`#]~Oy%^z;'S%^;'S;=`%o<%lO%^lAg[#e[Oy%^z!O%^!O!P;g!P!Q%^!Q![>T![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^bBbU^QOy%^z![%^![!]Bt!];'S%^;'S;=`%o<%lO%^bB{S_Qp`Oy%^z;'S%^;'S;=`%o<%lO%^nC^S!Z^Oy%^z;'S%^;'S;=`%o<%lO%^dCoS}SOy%^z;'S%^;'S;=`%o<%lO%^bDQU!PQOy%^z!`%^!`!aDd!a;'S%^;'S;=`%o<%lO%^bDkS!PQp`Oy%^z;'S%^;'S;=`%o<%lO%^bDzWOy%^z!c%^!c!}Ed!}#T%^#T#oEd#o;'S%^;'S;=`%o<%lO%^bEk[!]Qp`Oy%^z}%^}!OEd!O!Q%^!Q![Ed![!c%^!c!}Ed!}#T%^#T#oEd#o;'S%^;'S;=`%o<%lO%^nFfSr^Oy%^z;'S%^;'S;=`%o<%lO%^nFwSq^Oy%^z;'S%^;'S;=`%o<%lO%^bGWUOy%^z#b%^#b#cGj#c;'S%^;'S;=`%o<%lO%^bGoUp`Oy%^z#W%^#W#XHR#X;'S%^;'S;=`%o<%lO%^bHYS!cQp`Oy%^z;'S%^;'S;=`%o<%lO%^bHiUOy%^z#f%^#f#gHR#g;'S%^;'S;=`%o<%lO%^fIQS!UUOy%^z;'S%^;'S;=`%o<%lO%^nIcS!T^Oy%^z;'S%^;'S;=`%o<%lO%^fItU!SQOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^`JZP;=`<%l$}",tokenizers:[descendant,unitToken,identifiers,1,2,3,4,new LocalTokenGroup("m~RRYZ[z{a~~g~aO#_~~dP!P!Qg~lO#`~~",28,106)],topRules:{StyleSheet:[0,4],Styles:[1,87]},specialized:[{term:101,get:e=>spec_callee[e]||-1},{term:59,get:e=>spec_AtKeyword[e]||-1},{term:102,get:e=>spec_identifier$1[e]||-1}],tokenPrec:1219});let _properties=null;function properties(){if(!_properties&&"object"==typeof document&&document.body){let{style:e}=document.body,t=[],n=new Set;for(let i in e)"cssText"!=i&&"cssFloat"!=i&&"string"==typeof e[i]&&(/[A-Z]/.test(i)&&(i=i.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))),n.has(i)||(t.push(i),n.add(i)));_properties=t.sort().map((e=>({type:"property",label:e,apply:e+": "})))}return _properties||[]}const pseudoClasses=["active","after","any-link","autofill","backdrop","before","checked","cue","default","defined","disabled","empty","enabled","file-selector-button","first","first-child","first-letter","first-line","first-of-type","focus","focus-visible","focus-within","fullscreen","has","host","host-context","hover","in-range","indeterminate","invalid","is","lang","last-child","last-of-type","left","link","marker","modal","not","nth-child","nth-last-child","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","part","placeholder","placeholder-shown","read-only","read-write","required","right","root","scope","selection","slotted","target","target-text","valid","visited","where"].map((e=>({type:"class",label:e}))),values=["above","absolute","activeborder","additive","activecaption","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","antialiased","appworkspace","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic-abegede-gez","ethiopic-halehame-aa-er","ethiopic-halehame-gez","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","graytext","grid","groove","hand","hard-light","help","hidden","hide","higher","highlight","highlighttext","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","justify","keep-all","landscape","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-hexadecimal","lower-latin","lower-norwegian","lowercase","ltr","luminosity","manipulation","match","matrix","matrix3d","medium","menu","menutext","message-box","middle","min-intrinsic","mix","monospace","move","multiple","multiple_mask_images","multiply","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","opacity","open-quote","optimizeLegibility","optimizeSpeed","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","text","text-bottom","text-top","textarea","textfield","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","to","top","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-latin","uppercase","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"].map((e=>({type:"keyword",label:e}))).concat(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"].map((e=>({type:"constant",label:e})))),tags=["a","abbr","address","article","aside","b","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","dd","del","details","dfn","dialog","div","dl","dt","em","figcaption","figure","footer","form","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","main","meter","nav","ol","output","p","pre","ruby","section","select","small","source","span","strong","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","tr","u","ul"].map((e=>({type:"type",label:e}))),atRules=["@charset","@color-profile","@container","@counter-style","@font-face","@font-feature-values","@font-palette-values","@import","@keyframes","@layer","@media","@namespace","@page","@position-try","@property","@scope","@starting-style","@supports","@view-transition"].map((e=>({type:"keyword",label:e}))),identifier$1=/^(\w[\w-]*|-\w[\w-]*|)$/,variable=/^-(-[\w-]*)?$/;function isVarArg(e,t){var n;if(("("==e.name||e.type.isError)&&(e=e.parent||e),"ArgList"!=e.name)return!1;let i=null===(n=e.parent)||void 0===n?void 0:n.firstChild;return"Callee"==(null==i?void 0:i.name)&&"var"==t.sliceString(i.from,i.to)}const VariablesByNode=new NodeWeakMap,declSelector=["Declaration"];function astTop(e){for(let t=e;;){if(t.type.isTop)return t;if(!(t=t.parent))return e}}function variableNames(e,t,n){if(t.to-t.from>4096){let i=VariablesByNode.get(t);if(i)return i;let r=[],s=new Set,o=t.cursor(IterMode.IncludeAnonymous);if(o.firstChild())do{for(let t of variableNames(e,o.node,n))s.has(t.label)||(s.add(t.label),r.push(t))}while(o.nextSibling());return VariablesByNode.set(t,r),r}{let i=[],r=new Set;return t.cursor().iterate((t=>{var s;if(n(t)&&t.matchContext(declSelector)&&":"==(null===(s=t.node.nextSibling)||void 0===s?void 0:s.name)){let n=e.sliceString(t.from,t.to);r.has(n)||(r.add(n),i.push({label:n,type:"variable"}))}})),i}}const defineCSSCompletionSource=e=>t=>{let{state:n,pos:i}=t,r=syntaxTree(n).resolveInner(i,-1),s=r.type.isError&&r.from==r.to-1&&"-"==n.doc.sliceString(r.from,r.to);if("PropertyName"==r.name||(s||"TagName"==r.name)&&/^(Block|Styles)$/.test(r.resolve(r.to).name))return{from:r.from,options:properties(),validFor:identifier$1};if("ValueName"==r.name)return{from:r.from,options:values,validFor:identifier$1};if("PseudoClassName"==r.name)return{from:r.from,options:pseudoClasses,validFor:identifier$1};if(e(r)||(t.explicit||s)&&isVarArg(r,n.doc))return{from:e(r)||s?r.from:i,options:variableNames(n.doc,astTop(r),e),validFor:variable};if("TagName"==r.name){for(let{parent:e}=r;e;e=e.parent)if("Block"==e.name)return{from:r.from,options:properties(),validFor:identifier$1};return{from:r.from,options:tags,validFor:identifier$1}}if("AtKeyword"==r.name)return{from:r.from,options:atRules,validFor:identifier$1};if(!t.explicit)return null;let o=r.resolve(i),a=o.childBefore(i);return a&&":"==a.name&&"PseudoClassSelector"==o.name?{from:i,options:pseudoClasses,validFor:identifier$1}:a&&":"==a.name&&"Declaration"==o.name||"ArgList"==o.name?{from:i,options:values,validFor:identifier$1}:"Block"==o.name||"Styles"==o.name?{from:i,options:properties(),validFor:identifier$1}:null},cssCompletionSource=defineCSSCompletionSource((e=>"VariableName"==e.name)),cssLanguage=LRLanguage.define({name:"css",parser:parser$2.configure({props:[indentNodeProp.add({Declaration:continuedIndent()}),foldNodeProp.add({"Block KeyframeList":foldInside})]}),languageData:{commentTokens:{block:{open:"/*",close:"*/"}},indentOnInput:/^\s*\}$/,wordChars:"-"}});function css(){return new LanguageSupport(cssLanguage,cssLanguage.data.of({autocomplete:cssCompletionSource}))}const noSemi=314,noSemiType=315,incdec=1,incdecPrefix=2,questionDot=3,JSXStartTag=4,insertSemi=316,spaces=318,newline=319,LineComment=5,BlockComment=6,Dialect_jsx=0,space$1=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],braceR=125,semicolon=59,slash=47,star=42,plus=43,minus=45,lt=60,comma=44,question=63,dot=46,bracketL=91,trackNewline=new ContextTracker({start:!1,shift:(e,t)=>t==LineComment||t==BlockComment||t==spaces?e:t==newline,strict:!1}),insertSemicolon=new ExternalTokenizer(((e,t)=>{let{next:n}=e;(n==braceR||-1==n||t.context)&&e.acceptToken(insertSemi)}),{contextual:!0,fallback:!0}),noSemicolon=new ExternalTokenizer(((e,t)=>{let n,{next:i}=e;space$1.indexOf(i)>-1||(i!=slash||(n=e.peek(1))!=slash&&n!=star)&&(i==braceR||i==semicolon||-1==i||t.context||e.acceptToken(noSemi))}),{contextual:!0}),noSemicolonType=new ExternalTokenizer(((e,t)=>{e.next!=bracketL||t.context||e.acceptToken(noSemiType)}),{contextual:!0}),operatorToken=new ExternalTokenizer(((e,t)=>{let{next:n}=e;if(n==plus||n==minus){if(e.advance(),n==e.next){e.advance();let n=!t.context&&t.canShift(incdec);e.acceptToken(n?incdec:incdecPrefix)}}else n==question&&e.peek(1)==dot&&(e.advance(),e.advance(),(e.next<48||e.next>57)&&e.acceptToken(questionDot))}),{contextual:!0});function identifierChar(e,t){return e>=65&&e<=90||e>=97&&e<=122||95==e||e>=192||!t&&e>=48&&e<=57}const jsx=new ExternalTokenizer(((e,t)=>{if(e.next!=lt||!t.dialectEnabled(Dialect_jsx))return;if(e.advance(),e.next==slash)return;let n=0;for(;space$1.indexOf(e.next)>-1;)e.advance(),n++;if(identifierChar(e.next,!0)){for(e.advance(),n++;identifierChar(e.next,!1);)e.advance(),n++;for(;space$1.indexOf(e.next)>-1;)e.advance(),n++;if(e.next==comma)return;for(let t=0;;t++){if(7==t){if(!identifierChar(e.next,!0))return;break}if(e.next!="extends".charCodeAt(t))break;e.advance(),n++}}e.acceptToken(JSXStartTag,-n)})),jsHighlight=styleTags({"get set async static":tags$1.modifier,"for while do if else switch try catch finally return throw break continue default case":tags$1.controlKeyword,"in of await yield void typeof delete instanceof":tags$1.operatorKeyword,"let var const using function class extends":tags$1.definitionKeyword,"import export from":tags$1.moduleKeyword,"with debugger as new":tags$1.keyword,TemplateString:tags$1.special(tags$1.string),super:tags$1.atom,BooleanLiteral:tags$1.bool,this:tags$1.self,null:tags$1.null,Star:tags$1.modifier,VariableName:tags$1.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":tags$1.function(tags$1.variableName),VariableDefinition:tags$1.definition(tags$1.variableName),Label:tags$1.labelName,PropertyName:tags$1.propertyName,PrivatePropertyName:tags$1.special(tags$1.propertyName),"CallExpression/MemberExpression/PropertyName":tags$1.function(tags$1.propertyName),"FunctionDeclaration/VariableDefinition":tags$1.function(tags$1.definition(tags$1.variableName)),"ClassDeclaration/VariableDefinition":tags$1.definition(tags$1.className),"NewExpression/VariableName":tags$1.className,PropertyDefinition:tags$1.definition(tags$1.propertyName),PrivatePropertyDefinition:tags$1.definition(tags$1.special(tags$1.propertyName)),UpdateOp:tags$1.updateOperator,"LineComment Hashbang":tags$1.lineComment,BlockComment:tags$1.blockComment,Number:tags$1.number,String:tags$1.string,Escape:tags$1.escape,ArithOp:tags$1.arithmeticOperator,LogicOp:tags$1.logicOperator,BitOp:tags$1.bitwiseOperator,CompareOp:tags$1.compareOperator,RegExp:tags$1.regexp,Equals:tags$1.definitionOperator,Arrow:tags$1.function(tags$1.punctuation),": Spread":tags$1.punctuation,"( )":tags$1.paren,"[ ]":tags$1.squareBracket,"{ }":tags$1.brace,"InterpolationStart InterpolationEnd":tags$1.special(tags$1.brace),".":tags$1.derefOperator,", ;":tags$1.separator,"@":tags$1.meta,TypeName:tags$1.typeName,TypeDefinition:tags$1.definition(tags$1.typeName),"type enum interface implements namespace module declare":tags$1.definitionKeyword,"abstract global Privacy readonly override":tags$1.modifier,"is keyof unique infer asserts":tags$1.operatorKeyword,JSXAttributeValue:tags$1.attributeValue,JSXText:tags$1.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":tags$1.angleBracket,"JSXIdentifier JSXNameSpacedName":tags$1.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":tags$1.attributeName,"JSXBuiltin/JSXIdentifier":tags$1.standard(tags$1.tagName)}),spec_identifier={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,const:52,extends:56,this:60,true:68,false:68,null:80,void:84,typeof:88,super:104,new:138,delete:150,yield:159,await:163,class:168,public:231,private:231,protected:231,readonly:233,instanceof:252,satisfies:255,in:256,import:290,keyof:347,unique:351,infer:357,asserts:393,is:395,abstract:415,implements:417,type:419,let:422,var:424,using:427,interface:433,enum:437,namespace:443,module:445,declare:449,global:453,for:472,of:481,while:484,with:488,do:492,if:496,else:498,switch:502,case:508,try:514,catch:518,finally:522,return:526,throw:530,break:534,continue:538,debugger:542},spec_word={__proto__:null,async:125,get:127,set:129,declare:191,public:193,private:193,protected:193,static:195,abstract:197,override:199,readonly:205,accessor:207,new:399},spec_LessThan={__proto__:null,"<":189},parser$1=LRParser.deserialize({version:14,states:"$EOQ%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#D_O.QQlO'#DeO.bQlO'#DpO%[QlO'#DxO0fQlO'#EQOOQ!0Lf'#EY'#EYO1PQ`O'#EVOOQO'#En'#EnOOQO'#Ij'#IjO1XQ`O'#GrO1dQ`O'#EmO1iQ`O'#EmO3hQ!0MxO'#JpO6[Q!0MxO'#JqO6uQ`O'#F[O6zQ,UO'#FsOOQ!0Lf'#Fe'#FeO7VO7dO'#FeO7eQMhO'#F{O9UQ`O'#FzOOQ!0Lf'#Jq'#JqOOQ!0Lb'#Jp'#JpO9ZQ`O'#GvOOQ['#K]'#K]O9fQ`O'#IWO9kQ!0LrO'#IXOOQ['#J^'#J^OOQ['#I]'#I]Q`QlOOQ`QlOOO9sQ!L^O'#DtO9zQlO'#D|O:RQlO'#EOO9aQ`O'#GrO:YQMhO'#CoO:hQ`O'#ElO:sQ`O'#EwO:xQMhO'#FdO;gQ`O'#GrOOQO'#K^'#K^O;lQ`O'#K^O;zQ`O'#GzO;zQ`O'#G{O;zQ`O'#G}O9aQ`O'#HQO<qQ`O'#HTO>YQ`O'#CeO>jQ`O'#HaO>rQ`O'#HgO>rQ`O'#HiO`QlO'#HkO>rQ`O'#HmO>rQ`O'#HpO>wQ`O'#HvO>|Q!0LsO'#H|O%[QlO'#IOO?XQ!0LsO'#IQO?dQ!0LsO'#ISO9kQ!0LrO'#IUO?oQ!0MxO'#CiO@qQpO'#DjQOQ`OOO%[QlO'#EOOAXQ`O'#ERO:YQMhO'#ElOAdQ`O'#ElOAoQ!bO'#FdOOQ['#Cg'#CgOOQ!0Lb'#Do'#DoOOQ!0Lb'#Jt'#JtO%[QlO'#JtOOQO'#Jw'#JwOOQO'#If'#IfOBoQpO'#EeOOQ!0Lb'#Ed'#EdOOQ!0Lb'#J{'#J{OCkQ!0MSO'#EeOCuQpO'#EUOOQO'#Jv'#JvODZQpO'#JwOEhQpO'#EUOCuQpO'#EePEuO&2DjO'#CbPOOO)CD{)CD{OOOO'#I^'#I^OFQO#tO,59UOOQ!0Lh,59U,59UOOOO'#I_'#I_OF`O&jO,59UOFnQ!L^O'#DaOOOO'#Ia'#IaOFuO#@ItO,59yOOQ!0Lf,59y,59yOGTQlO'#IbOGhQ`O'#JrOIgQ!fO'#JrO+}QlO'#JrOInQ`O,5:POJUQ`O'#EnOJcQ`O'#KROJnQ`O'#KQOJnQ`O'#KQOJvQ`O,5;[OJ{Q`O'#KPOOQ!0Ln,5:[,5:[OKSQlO,5:[OMQQ!0MxO,5:dOMqQ`O,5:lON[Q!0LrO'#KOONcQ`O'#J}O9ZQ`O'#J}ONwQ`O'#J}O! PQ`O,5;ZO! UQ`O'#J}O!#ZQ!fO'#JqOOQ!0Lh'#Ci'#CiO%[QlO'#EQO!#yQ!fO,5:qOOQS'#Jx'#JxOOQO-E<h-E<hO9aQ`O,5=^O!$aQ`O,5=^O!$fQlO,5;XO!&iQMhO'#EiO!(SQ`O,5;XO!(XQlO'#DwO!(cQpO,5;bO!(kQpO,5;bO%[QlO,5;bOOQ['#FS'#FSOOQ['#FU'#FUO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cOOQ['#FY'#FYO!(yQlO,5;sOOQ!0Lf,5;x,5;xOOQ!0Lf,5;y,5;yOOQ!0Lf,5;{,5;{O%[QlO'#InO!*|Q!0LrO,5<hO%[QlO,5;cO!&iQMhO,5;cO!+kQMhO,5;cO!-]QMhO'#E[O%[QlO,5;vOOQ!0Lf,5;z,5;zO!-dQ,UO'#FiO!.aQ,UO'#KVO!-{Q,UO'#KVO!.hQ,UO'#KVOOQO'#KV'#KVO!.|Q,UO,5<ROOOW,5<_,5<_O!/_QlO'#FuOOOW'#Im'#ImO7VO7dO,5<PO!/fQ,UO'#FwOOQ!0Lf,5<P,5<PO!0VQ$IUO'#CwOOQ!0Lh'#C{'#C{O!0jO#@ItO'#DPO!1WQMjO,5<dO!1_Q`O,5<gO!2zQ(CWO'#GWO!3XQ`O'#GXO!3^Q`O'#GXO!4|Q(CWO'#G]O!6RQpO'#GaOOQO'#Gm'#GmO!+rQMhO'#GlOOQO'#Go'#GoO!+rQMhO'#GnO!6tQ$IUO'#JjOOQ!0Lh'#Jj'#JjO!7OQ`O'#JiO!7^Q`O'#JhO!7fQ`O'#CuOOQ!0Lh'#Cy'#CyO!7qQ`O'#C{OOQ!0Lh'#DT'#DTOOQ!0Lh'#DV'#DVO1SQ`O'#DXO!+rQMhO'#GOO!+rQMhO'#GQO!7vQ`O'#GSO!7{Q`O'#GTO!3^Q`O'#GZO!+rQMhO'#G`O;zQ`O'#JiO!8QQ`O'#EoO!8oQ`O,5<fOOQ!0Lb'#Cr'#CrO!8wQ`O'#EpO!9qQpO'#EqOOQ!0Lb'#KP'#KPO!9xQ!0LrO'#K_O9kQ!0LrO,5=bO`QlO,5>rOOQ['#Jf'#JfOOQ[,5>s,5>sOOQ[-E<Z-E<ZO!;wQ!0MxO,5:`O!9lQpO,5:^O!>bQ!0MxO,5:hO%[QlO,5:hO!@xQ!0MxO,5:jOOQO,5@x,5@xO!AiQMhO,5=^O!AwQ!0LrO'#JgO9UQ`O'#JgO!BYQ!0LrO,59ZO!BeQpO,59ZO!BmQMhO,59ZO:YQMhO,59ZO!BxQ`O,5;XO!CQQ`O'#H`O!CfQ`O'#KbO%[QlO,5;|O!9lQpO,5<OO!CnQ`O,5=yO!CsQ`O,5=yO!CxQ`O,5=yO9kQ!0LrO,5=yO;zQ`O,5=iOOQO'#Cw'#CwO!DWQpO,5=fO!D`QMhO,5=gO!DkQ`O,5=iO!DpQ!bO,5=lO!DxQ`O'#K^O>wQ`O'#HVO9aQ`O'#HXO!D}Q`O'#HXO:YQMhO'#HZO!ESQ`O'#HZOOQ[,5=o,5=oO!EXQ`O'#H[O!EjQ`O'#CoO!EoQ`O,59PO!EyQ`O,59PO!HOQlO,59POOQ[,59P,59PO!H`Q!0LrO,59PO%[QlO,59PO!JkQlO'#HcOOQ['#Hd'#HdOOQ['#He'#HeO`QlO,5={O!KRQ`O,5={O`QlO,5>RO`QlO,5>TO!KWQ`O,5>VO`QlO,5>XO!K]Q`O,5>[O!KbQlO,5>bOOQ[,5>h,5>hO%[QlO,5>hO9kQ!0LrO,5>jOOQ[,5>l,5>lO# lQ`O,5>lOOQ[,5>n,5>nO# lQ`O,5>nOOQ[,5>p,5>pO#!YQpO'#D]O%[QlO'#JtO#!{QpO'#JtO##VQpO'#DkO##hQpO'#DkO#%yQlO'#DkO#&QQ`O'#JsO#&YQ`O,5:UO#&_Q`O'#ErO#&mQ`O'#KSO#&uQ`O,5;]O#&zQpO'#DkO#'XQpO'#ETOOQ!0Lf,5:m,5:mO%[QlO,5:mO#'`Q`O,5:mO>wQ`O,5;WO!BeQpO,5;WO!BmQMhO,5;WO:YQMhO,5;WO#'hQ`O,5@`O#'mQ07dO,5:qOOQO-E<d-E<dO#(sQ!0MSO,5;POCuQpO,5:pO#(}QpO,5:pOCuQpO,5;PO!BYQ!0LrO,5:pOOQ!0Lb'#Eh'#EhOOQO,5;P,5;PO%[QlO,5;PO#)[Q!0LrO,5;PO#)gQ!0LrO,5;PO!BeQpO,5:pOOQO,5;V,5;VO#)uQ!0LrO,5;PPOOO'#I['#I[P#*ZO&2DjO,58|POOO,58|,58|OOOO-E<[-E<[OOQ!0Lh1G.p1G.pOOOO-E<]-E<]OOOO,59{,59{O#*fQ!bO,59{OOOO-E<_-E<_OOQ!0Lf1G/e1G/eO#*kQ!fO,5>|O+}QlO,5>|OOQO,5?S,5?SO#*uQlO'#IbOOQO-E<`-E<`O#+SQ`O,5@^O#+[Q!fO,5@^O#+cQ`O,5@lOOQ!0Lf1G/k1G/kO%[QlO,5@mO#+kQ`O'#IhOOQO-E<f-E<fO#+cQ`O,5@lOOQ!0Lb1G0v1G0vOOQ!0Ln1G/v1G/vOOQ!0Ln1G0W1G0WO%[QlO,5@jO#,PQ!0LrO,5@jO#,bQ!0LrO,5@jO#,iQ`O,5@iO9ZQ`O,5@iO#,qQ`O,5@iO#-PQ`O'#IkO#,iQ`O,5@iOOQ!0Lb1G0u1G0uO!(cQpO,5:sO!(nQpO,5:sOOQS,5:u,5:uO#-qQdO,5:uO#-yQMhO1G2xO9aQ`O1G2xOOQ!0Lf1G0s1G0sO#.XQ!0MxO1G0sO#/^Q!0MvO,5;TOOQ!0Lh'#GV'#GVO#/zQ!0MzO'#JjO!$fQlO1G0sO#2VQ!fO'#JuO%[QlO'#JuO#2aQ`O,5:cOOQ!0Lh'#D]'#D]OOQ!0Lf1G0|1G0|O%[QlO1G0|OOQ!0Lf1G1e1G1eO#2fQ`O1G0|O#4zQ!0MxO1G0}O#5RQ!0MxO1G0}O#7iQ!0MxO1G0}O#7pQ!0MxO1G0}O#:WQ!0MxO1G0}O#<nQ!0MxO1G0}O#<uQ!0MxO1G0}O#<|Q!0MxO1G0}O#?dQ!0MxO1G0}O#?kQ!0MxO1G0}O#AxQ?MtO'#CiO#CsQ?MtO1G1_O#CzQ?MtO'#JqO#D_Q!0MxO,5?YOOQ!0Lb-E<l-E<lO#FlQ!0MxO1G0}O#GiQ!0MzO1G0}OOQ!0Lf1G0}1G0}O#HlQMjO'#JzO#HvQ`O,5:vO#H{Q!0MxO1G1bO#IoQ,UO,5<VO#IwQ,UO,5<WO#JPQ,UO'#FnO#JhQ`O'#FmOOQO'#KW'#KWOOQO'#Il'#IlO#JmQ,UO1G1mOOQ!0Lf1G1m1G1mOOOW1G1x1G1xO#KOQ?MtO'#JpO#KYQ`O,5<aO!(yQlO,5<aOOOW-E<k-E<kOOQ!0Lf1G1k1G1kO#K_QpO'#KVOOQ!0Lf,5<c,5<cO#KgQpO,5<cO#KlQMhO'#DROOOO'#I`'#I`O#KsO#@ItO,59kOOQ!0Lh,59k,59kO%[QlO1G2OO!7{Q`O'#IpO#LOQ`O,5<yOOQ!0Lh,5<v,5<vO!+rQMhO'#IsO#LlQMjO,5=WO!+rQMhO'#IuO#M_QMjO,5=YO!&iQMhO,5=[OOQO1G2R1G2RO#MiQ!dO'#CrO#M|Q(CWO'#EpO$ RQpO'#GaO$ iQ!dO,5<rO$ pQ`O'#KYO9ZQ`O'#KYO$!OQ`O,5<tO!+rQMhO,5<sO$!TQ`O'#GYO$!fQ`O,5<sO$!kQ!dO'#GVO$!xQ!dO'#KZO$#SQ`O'#KZO!&iQMhO'#KZO$#XQ`O,5<wO$#^QlO'#JtO$#hQpO'#GbO##hQpO'#GbO$#yQ`O'#GfO!3^Q`O'#GjO$$OQ!0LrO'#IrO$$ZQpO,5<{OOQ!0Lp,5<{,5<{O$$bQpO'#GbO$$oQpO'#GcO$%QQpO'#GcO$%VQMjO,5=WO$%gQMjO,5=YOOQ!0Lh,5=],5=]O!+rQMhO,5@TO!+rQMhO,5@TO$%wQ`O'#IwO$&VQ`O,5@SO$&_Q`O,59aOOQ!0Lh,59g,59gO$'UQ$IYO,59sOOQ!0Lh'#Jn'#JnO$'wQMjO,5<jO$(jQMjO,5<lO@iQ`O,5<nOOQ!0Lh,5<o,5<oO$(tQ`O,5<uO$(yQMjO,5<zO$)ZQ`O,5@TO$)iQ`O'#J}O!$fQlO1G2QO$)nQ`O1G2QO9ZQ`O'#KQO9ZQ`O'#ErO%[QlO'#ErO9ZQ`O'#IyO$)sQ!0LrO,5@yOOQ[1G2|1G2|OOQ[1G4^1G4^OOQ!0Lf1G/z1G/zOOQ!0Lf1G/x1G/xO$+uQ!0MxO1G0SOOQ[1G2x1G2xO!&iQMhO1G2xO%[QlO1G2xO#-|Q`O1G2xO$-yQMhO'#EiOOQ!0Lb,5@R,5@RO$.WQ!0LrO,5@ROOQ[1G.u1G.uO!BYQ!0LrO1G.uO!BeQpO1G.uO!BmQMhO1G.uO$.iQ`O1G0sO$.nQ`O'#CiO$.yQ`O'#KcO$/RQ`O,5=zO$/WQ`O'#KcO$/]Q`O'#KcO$/kQ`O'#JPO$/yQ`O,5@|O$0RQ!fO1G1hOOQ!0Lf1G1j1G1jO9aQ`O1G3eO@iQ`O1G3eO$0YQ`O1G3eO$0_Q`O1G3eOOQ[1G3e1G3eO!DkQ`O1G3TO!&iQMhO1G3QO$0dQ`O1G3QOOQ[1G3R1G3RO!&iQMhO1G3RO$0iQ`O1G3RO$0qQpO'#HPOOQ[1G3T1G3TO!5|QpO'#I{O!DpQ!bO1G3WOOQ[1G3W1G3WOOQ[,5=q,5=qO$0yQMhO,5=sO9aQ`O,5=sO$#yQ`O,5=uO9UQ`O,5=uO!BeQpO,5=uO!BmQMhO,5=uO:YQMhO,5=uO$1XQ`O'#KaO$1dQ`O,5=vOOQ[1G.k1G.kO$1iQ!0LrO1G.kO@iQ`O1G.kO$1tQ`O1G.kO9kQ!0LrO1G.kO$3|Q!fO,5AOO$4ZQ`O,5AOO9ZQ`O,5AOO$4fQlO,5=}O$4mQ`O,5=}OOQ[1G3g1G3gO`QlO1G3gOOQ[1G3m1G3mOOQ[1G3o1G3oO>rQ`O1G3qO$4rQlO1G3sO$8vQlO'#HrOOQ[1G3v1G3vO$9TQ`O'#HxO>wQ`O'#HzOOQ[1G3|1G3|O$9]QlO1G3|O9kQ!0LrO1G4SOOQ[1G4U1G4UOOQ!0Lb'#G^'#G^O9kQ!0LrO1G4WO9kQ!0LrO1G4YO$=dQ`O,5@`O!(yQlO,5;^O9ZQ`O,5;^O>wQ`O,5:VO!(yQlO,5:VO!BeQpO,5:VO$=iQ?MtO,5:VOOQO,5;^,5;^O$=sQpO'#IcO$>ZQ`O,5@_OOQ!0Lf1G/p1G/pO$>cQpO'#IiO$>mQ`O,5@nOOQ!0Lb1G0w1G0wO##hQpO,5:VOOQO'#Ie'#IeO$>uQpO,5:oOOQ!0Ln,5:o,5:oO#'cQ`O1G0XOOQ!0Lf1G0X1G0XO%[QlO1G0XOOQ!0Lf1G0r1G0rO>wQ`O1G0rO!BeQpO1G0rO!BmQMhO1G0rOOQ!0Lb1G5z1G5zO!BYQ!0LrO1G0[OOQO1G0k1G0kO%[QlO1G0kO$>|Q!0LrO1G0kO$?XQ!0LrO1G0kO!BeQpO1G0[OCuQpO1G0[O$?gQ!0LrO1G0kOOQO1G0[1G0[O$?{Q!0MxO1G0kPOOO-E<Y-E<YPOOO1G.h1G.hOOOO1G/g1G/gO$@VQ!bO,5<hO$@_Q!fO1G4hOOQO1G4n1G4nO%[QlO,5>|O$@iQ`O1G5xO$@qQ`O1G6WO$@yQ!fO1G6XO9ZQ`O,5?SO$ATQ!0MxO1G6UO%[QlO1G6UO$AeQ!0LrO1G6UO$AvQ`O1G6TO$AvQ`O1G6TO9ZQ`O1G6TO$BOQ`O,5?VO9ZQ`O,5?VOOQO,5?V,5?VO$BdQ`O,5?VO$)iQ`O,5?VOOQO-E<i-E<iOOQS1G0_1G0_OOQS1G0a1G0aO#-tQ`O1G0aOOQ[7+(d7+(dO!&iQMhO7+(dO%[QlO7+(dO$BrQ`O7+(dO$B}QMhO7+(dO$C]Q!0MzO,5=WO$EhQ!0MzO,5=YO$GsQ!0MzO,5=WO$JUQ!0MzO,5=YO$LgQ!0MzO,59sO$NlQ!0MzO,5<jO%!wQ!0MzO,5<lO%%SQ!0MzO,5<zOOQ!0Lf7+&_7+&_O%'eQ!0MxO7+&_O%(XQlO'#IdO%(fQ`O,5@aO%(nQ!fO,5@aOOQ!0Lf1G/}1G/}O%(xQ`O7+&hOOQ!0Lf7+&h7+&hO%(}Q?MtO,5:dO%[QlO7+&yO%)XQ?MtO,5:`O%)fQ?MtO,5:hO%)pQ?MtO,5:jO%)zQMhO'#IgO%*UQ`O,5@fOOQ!0Lh1G0b1G0bOOQO1G1q1G1qOOQO1G1r1G1rO%*^Q!jO,5<YO!(yQlO,5<XOOQO-E<j-E<jOOQ!0Lf7+'X7+'XOOOW7+'d7+'dOOOW1G1{1G1{O%*iQ`O1G1{OOQ!0Lf1G1}1G1}OOOO,59m,59mO%*nQ!dO,59mOOOO-E<^-E<^OOQ!0Lh1G/V1G/VO%*uQ!0MxO7+'jOOQ!0Lh,5?[,5?[O%+iQMhO1G2eP%+pQ`O'#IpPOQ!0Lh-E<n-E<nO%,^QMjO,5?_OOQ!0Lh-E<q-E<qO%-PQMjO,5?aOOQ!0Lh-E<s-E<sO%-ZQ!dO1G2vO%-bQ!dO'#CrO%-xQMhO'#KQO$#^QlO'#JtOOQ!0Lh1G2^1G2^O%.PQ`O'#IoO%.eQ`O,5@tO%.eQ`O,5@tO%.mQ`O,5@tO%.xQ`O,5@tOOQO1G2`1G2`O%/WQMjO1G2_O!+rQMhO1G2_O%/hQ(CWO'#IqO%/uQ`O,5@uO!&iQMhO,5@uO%/}Q!dO,5@uOOQ!0Lh1G2c1G2cO%2_Q!fO'#CiO%2iQ`O,5=OOOQ!0Lb,5<|,5<|O%2qQpO,5<|OOQ!0Lb,5<},5<}OCfQ`O,5<|O%2|QpO,5<|OOQ!0Lb,5=Q,5=QO$)iQ`O,5=UOOQO,5?^,5?^OOQO-E<p-E<pOOQ!0Lp1G2g1G2gO##hQpO,5<|O$#^QlO,5=OO%3[Q`O,5<}O%3gQpO,5<}O!+rQMhO'#IsO%4aQMjO1G2rO!+rQMhO'#IuO%5SQMjO1G2tO%5^QMjO1G5oO%5hQMjO1G5oOOQO,5?c,5?cOOQO-E<u-E<uOOQO1G.{1G.{O!9lQpO,59uO%[QlO,59uOOQ!0Lh,5<i,5<iO%5uQ`O1G2YO!+rQMhO1G2aO!+rQMhO1G5oO!+rQMhO1G5oO%5zQ!0MxO7+'lOOQ!0Lf7+'l7+'lO!$fQlO7+'lO%6nQ`O,5;^OOQ!0Lb,5?e,5?eOOQ!0Lb-E<w-E<wO%6sQ!dO'#K[O#'cQ`O7+(dO4UQ!fO7+(dO$BuQ`O7+(dO%6}Q!0MvO'#CiO%7nQ!0LrO,5=RO%8PQ!0MvO,5=RO%8dQ`O,5=ROOQ!0Lb1G5m1G5mOOQ[7+$a7+$aO!BYQ!0LrO7+$aO!BeQpO7+$aO!$fQlO7+&_O%8lQ`O'#JOO%9TQ`O,5@}OOQO1G3f1G3fO9aQ`O,5@}O%9TQ`O,5@}O%9]Q`O,5@}OOQO,5?k,5?kOOQO-E<}-E<}OOQ!0Lf7+'S7+'SO%9bQ`O7+)PO9kQ!0LrO7+)PO9aQ`O7+)PO@iQ`O7+)POOQ[7+(o7+(oO%9gQ!0MvO7+(lO!&iQMhO7+(lO!DfQ`O7+(mOOQ[7+(m7+(mO!&iQMhO7+(mO%9qQ`O'#K`O%9|Q`O,5=kOOQO,5?g,5?gOOQO-E<y-E<yOOQ[7+(r7+(rO%;`QpO'#HYOOQ[1G3_1G3_O!&iQMhO1G3_O%[QlO1G3_O%;gQ`O1G3_O%;rQMhO1G3_O9kQ!0LrO1G3aO$#yQ`O1G3aO9UQ`O1G3aO!BeQpO1G3aO!BmQMhO1G3aO%<QQ`O'#I}O%<fQ`O,5@{O%<nQpO,5@{OOQ!0Lb1G3b1G3bOOQ[7+$V7+$VO@iQ`O7+$VO9kQ!0LrO7+$VO%<yQ`O7+$VO%[QlO1G6jO%[QlO1G6kO%=OQ!0LrO1G6jO%=YQlO1G3iO%=aQ`O1G3iO%=fQlO1G3iOOQ[7+)R7+)RO9kQ!0LrO7+)]O`QlO7+)_OOQ['#Kf'#KfOOQ['#JQ'#JQO%=mQlO,5>^OOQ[,5>^,5>^O%[QlO'#HsO%=zQ`O'#HuOOQ[,5>d,5>dO9ZQ`O,5>dOOQ[,5>f,5>fOOQ[7+)h7+)hOOQ[7+)n7+)nOOQ[7+)r7+)rOOQ[7+)t7+)tO%>PQpO1G5zO%>kQ?MtO1G0xO%>uQ`O1G0xOOQO1G/q1G/qO%?QQ?MtO1G/qO>wQ`O1G/qO!(yQlO'#DkOOQO,5>},5>}OOQO-E<a-E<aOOQO,5?T,5?TOOQO-E<g-E<gO!BeQpO1G/qOOQO-E<c-E<cOOQ!0Ln1G0Z1G0ZOOQ!0Lf7+%s7+%sO#'cQ`O7+%sOOQ!0Lf7+&^7+&^O>wQ`O7+&^O!BeQpO7+&^OOQO7+%v7+%vO$?{Q!0MxO7+&VOOQO7+&V7+&VO%[QlO7+&VO%?[Q!0LrO7+&VO!BYQ!0LrO7+%vO!BeQpO7+%vO%?gQ!0LrO7+&VO%?uQ!0MxO7++pO%[QlO7++pO%@VQ`O7++oO%@VQ`O7++oOOQO1G4q1G4qO9ZQ`O1G4qO%@_Q`O1G4qOOQS7+%{7+%{O#'cQ`O<<LOO4UQ!fO<<LOO%@mQ`O<<LOOOQ[<<LO<<LOO!&iQMhO<<LOO%[QlO<<LOO%@uQ`O<<LOO%AQQ!0MzO,5?_O%C]Q!0MzO,5?aO%EhQ!0MzO1G2_O%GyQ!0MzO1G2rO%JUQ!0MzO1G2tO%LaQ!fO,5?OO%[QlO,5?OOOQO-E<b-E<bO%LkQ`O1G5{OOQ!0Lf<<JS<<JSO%LsQ?MtO1G0sO%NzQ?MtO1G0}O& RQ?MtO1G0}O&#SQ?MtO1G0}O&#ZQ?MtO1G0}O&%[Q?MtO1G0}O&']Q?MtO1G0}O&'dQ?MtO1G0}O&'kQ?MtO1G0}O&)lQ?MtO1G0}O&)sQ?MtO1G0}O&)zQ!0MxO<<JeO&+rQ?MtO1G0}O&,oQ?MvO1G0}O&-rQ?MvO'#JjO&/xQ?MtO1G1bO&0VQ?MtO1G0SO&0aQMjO,5?ROOQO-E<e-E<eO!(yQlO'#FpOOQO'#KX'#KXOOQO1G1t1G1tO&0kQ`O1G1sO&0pQ?MtO,5?YOOOW7+'g7+'gOOOO1G/X1G/XO&0zQ!dO1G4vOOQ!0Lh7+(P7+(PP!&iQMhO,5?[O!+rQMhO7+(bO&1RQ`O,5?ZO9ZQ`O,5?ZOOQO-E<m-E<mO&1aQ`O1G6`O&1aQ`O1G6`O&1iQ`O1G6`O&1tQMjO7+'yO&2UQ!dO,5?]O&2`Q`O,5?]O!&iQMhO,5?]OOQO-E<o-E<oO&2eQ!dO1G6aO&2oQ`O1G6aO&2wQ`O1G2jO!&iQMhO1G2jOOQ!0Lb1G2h1G2hOOQ!0Lb1G2i1G2iO%2qQpO1G2hO!BeQpO1G2hOCfQ`O1G2hOOQ!0Lb1G2p1G2pO&2|QpO1G2hO&3[Q`O1G2jO$)iQ`O1G2iOCfQ`O1G2iO$#^QlO1G2jO&3dQ`O1G2iO&4WQMjO,5?_OOQ!0Lh-E<r-E<rO&4yQMjO,5?aOOQ!0Lh-E<t-E<tO!+rQMhO7++ZOOQ!0Lh1G/a1G/aO&5TQ`O1G/aOOQ!0Lh7+'t7+'tO&5YQMjO7+'{O&5jQMjO7++ZO&5tQMjO7++ZO&6RQ!0MxO<<KWOOQ!0Lf<<KW<<KWO&6uQ`O1G0xO!&iQMhO'#IxO&6zQ`O,5@vO&8|Q!fO<<LOO!&iQMhO1G2mO&9TQ!0LrO1G2mOOQ[<<G{<<G{O!BYQ!0LrO<<G{O&9fQ!0MxO<<IyOOQ!0Lf<<Iy<<IyOOQO,5?j,5?jO&:YQ`O,5?jO&:_Q`O,5?jOOQO-E<|-E<|O&:mQ`O1G6iO&:mQ`O1G6iO9aQ`O1G6iO@iQ`O<<LkOOQ[<<Lk<<LkO&:uQ`O<<LkO9kQ!0LrO<<LkOOQ[<<LW<<LWO%9gQ!0MvO<<LWOOQ[<<LX<<LXO!DfQ`O<<LXO&:zQpO'#IzO&;VQ`O,5@zO!(yQlO,5@zOOQ[1G3V1G3VOOQO'#I|'#I|O9kQ!0LrO'#I|O&;_QpO,5=tOOQ[,5=t,5=tO&;fQpO'#EeO&;mQpO'#GdO&;rQ`O7+(yO&;wQ`O7+(yOOQ[7+(y7+(yO!&iQMhO7+(yO%[QlO7+(yO&<PQ`O7+(yOOQ[7+({7+({O9kQ!0LrO7+({O$#yQ`O7+({O9UQ`O7+({O!BeQpO7+({O&<[Q`O,5?iOOQO-E<{-E<{OOQO'#H]'#H]O&<gQ`O1G6gO9kQ!0LrO<<GqOOQ[<<Gq<<GqO@iQ`O<<GqO&<oQ`O7+,UO&<tQ`O7+,VO%[QlO7+,UO%[QlO7+,VOOQ[7+)T7+)TO&<yQ`O7+)TO&=OQlO7+)TO&=VQ`O7+)TOOQ[<<Lw<<LwOOQ[<<Ly<<LyOOQ[-E=O-E=OOOQ[1G3x1G3xO&=[Q`O,5>_OOQ[,5>a,5>aO&=aQ`O1G4OO9ZQ`O7+&dO!(yQlO7+&dOOQO7+%]7+%]O&=fQ?MtO1G6XO>wQ`O7+%]OOQ!0Lf<<I_<<I_OOQ!0Lf<<Ix<<IxO>wQ`O<<IxOOQO<<Iq<<IqO$?{Q!0MxO<<IqO%[QlO<<IqOOQO<<Ib<<IbO!BYQ!0LrO<<IbO&=pQ!0LrO<<IqO&={Q!0MxO<= [O&>]Q`O<= ZOOQO7+*]7+*]O9ZQ`O7+*]OOQ[ANAjANAjO&>eQ!fOANAjO!&iQMhOANAjO#'cQ`OANAjO4UQ!fOANAjO&>lQ`OANAjO%[QlOANAjO&>tQ!0MzO7+'yO&AVQ!0MzO,5?_O&CbQ!0MzO,5?aO&EmQ!0MzO7+'{O&HOQ!fO1G4jO&HYQ?MtO7+&_O&J^Q?MvO,5=WO&LeQ?MvO,5=YO&LuQ?MvO,5=WO&MVQ?MvO,5=YO&MgQ?MvO,59sO' mQ?MvO,5<jO'#pQ?MvO,5<lO'&UQ?MvO,5<zO''zQ?MtO7+'jO'(XQ?MtO7+'lO'(fQ`O,5<[OOQO7+'_7+'_OOQ!0Lh7+*b7+*bO'(kQMjO<<K|OOQO1G4u1G4uO'(rQ`O1G4uO'(}Q`O1G4uO')]Q`O7++zO')]Q`O7++zO!&iQMhO1G4wO')eQ!dO1G4wO')oQ`O7++{O')wQ`O7+(UO'*SQ!dO7+(UOOQ!0Lb7+(S7+(SOOQ!0Lb7+(T7+(TO!BeQpO7+(SOCfQ`O7+(SO'*^Q`O7+(UO!&iQMhO7+(UO$)iQ`O7+(TO'*cQ`O7+(UOCfQ`O7+(TO'*kQMjO<<NuOOQ!0Lh7+${7+${O!+rQMhO<<NuO'*uQ!dO,5?dOOQO-E<v-E<vO'+PQ!0MvO7+(XO!&iQMhO7+(XOOQ[AN=gAN=gO9aQ`O1G5UOOQO1G5U1G5UO'+aQ`O1G5UO'+fQ`O7+,TO'+fQ`O7+,TO9kQ!0LrOANBVO@iQ`OANBVOOQ[ANBVANBVOOQ[ANArANArOOQ[ANAsANAsO'+nQ`O,5?fOOQO-E<x-E<xO'+yQ?MtO1G6fOOQO,5?h,5?hOOQO-E<z-E<zOOQ[1G3`1G3`O',TQ`O,5=OOOQ[<<Le<<LeO!&iQMhO<<LeO&;rQ`O<<LeO',YQ`O<<LeO%[QlO<<LeOOQ[<<Lg<<LgO9kQ!0LrO<<LgO$#yQ`O<<LgO9UQ`O<<LgO',bQpO1G5TO',mQ`O7+,ROOQ[AN=]AN=]O9kQ!0LrOAN=]OOQ[<= p<= pOOQ[<= q<= qO',uQ`O<= pO',zQ`O<= qOOQ[<<Lo<<LoO'-PQ`O<<LoO'-UQlO<<LoOOQ[1G3y1G3yO>wQ`O7+)jO'-]Q`O<<JOO'-hQ?MtO<<JOOOQO<<Hw<<HwOOQ!0LfAN?dAN?dOOQOAN?]AN?]O$?{Q!0MxOAN?]OOQOAN>|AN>|O%[QlOAN?]OOQO<<Mw<<MwOOQ[G27UG27UO!&iQMhOG27UO#'cQ`OG27UO'-rQ!fOG27UO4UQ!fOG27UO'-yQ`OG27UO'.RQ?MtO<<JeO'.`Q?MvO1G2_O'0UQ?MvO,5?_O'2XQ?MvO,5?aO'4[Q?MvO1G2rO'6_Q?MvO1G2tO'8bQ?MtO<<KWO'8oQ?MtO<<IyOOQO1G1v1G1vO!+rQMhOANAhOOQO7+*a7+*aO'8|Q`O7+*aO'9XQ`O<= fO'9aQ!dO7+*cOOQ!0Lb<<Kp<<KpO$)iQ`O<<KpOCfQ`O<<KpO'9kQ`O<<KpO!&iQMhO<<KpOOQ!0Lb<<Kn<<KnO!BeQpO<<KnO'9vQ!dO<<KpOOQ!0Lb<<Ko<<KoO':QQ`O<<KpO!&iQMhO<<KpO$)iQ`O<<KoO':VQMjOANDaO':aQ!0MvO<<KsOOQO7+*p7+*pO9aQ`O7+*pO':qQ`O<= oOOQ[G27qG27qO9kQ!0LrOG27qO!(yQlO1G5QO':yQ`O7+,QO';RQ`O1G2jO&;rQ`OANBPOOQ[ANBPANBPO!&iQMhOANBPO';WQ`OANBPOOQ[ANBRANBRO9kQ!0LrOANBRO$#yQ`OANBROOQO'#H^'#H^OOQO7+*o7+*oOOQ[G22wG22wOOQ[ANE[ANE[OOQ[ANE]ANE]OOQ[ANBZANBZO';`Q`OANBZOOQ[<<MU<<MUO!(yQlOAN?jOOQOG24wG24wO$?{Q!0MxOG24wO#'cQ`OLD,pOOQ[LD,pLD,pO!&iQMhOLD,pO';eQ!fOLD,pO';lQ?MvO7+'yO'=bQ?MvO,5?_O'?eQ?MvO,5?aO'AhQ?MvO7+'{O'C^QMjOG27SOOQO<<M{<<M{OOQ!0LbANA[ANA[O$)iQ`OANA[OCfQ`OANA[O'CnQ!dOANA[OOQ!0LbANAYANAYO'CuQ`OANA[O!&iQMhOANA[O'DQQ!dOANA[OOQ!0LbANAZANAZOOQO<<N[<<N[OOQ[LD-]LD-]O'D[Q?MtO7+*lOOQO'#Ge'#GeOOQ[G27kG27kO&;rQ`OG27kO!&iQMhOG27kOOQ[G27mG27mO9kQ!0LrOG27mOOQ[G27uG27uO'DfQ?MtOG25UOOQOLD*cLD*cOOQ[!$(![!$(![O#'cQ`O!$(![O!&iQMhO!$(![O'DpQ!0MzOG27SOOQ!0LbG26vG26vO$)iQ`OG26vO'GRQ`OG26vOCfQ`OG26vO'G^Q!dOG26vO!&iQMhOG26vOOQ[LD-VLD-VO&;rQ`OLD-VOOQ[LD-XLD-XOOQ[!)9Ev!)9EvO#'cQ`O!)9EvOOQ!0LbLD,bLD,bO$)iQ`OLD,bOCfQ`OLD,bO'GeQ`OLD,bO'GpQ!dOLD,bOOQ[!$(!q!$(!qOOQ[!.K;b!.K;bO'GwQ?MvOG27SOOQ!0Lb!$( |!$( |O$)iQ`O!$( |OCfQ`O!$( |O'ImQ`O!$( |OOQ!0Lb!)9Eh!)9EhO$)iQ`O!)9EhOCfQ`O!)9EhOOQ!0Lb!.K;S!.K;SO$)iQ`O!.K;SOOQ!0Lb!4/0n!4/0nO!(yQlO'#DxO1PQ`O'#EVO'IxQ!fO'#JpO'JPQ!L^O'#DtO'JWQlO'#D|O'J_Q!fO'#CiO'LuQ!fO'#CiO!(yQlO'#EOO'MVQlO,5;XO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO'#InO( YQ`O,5<hO!(yQlO,5;cO( bQMhO,5;cO(!{QMhO,5;cO!(yQlO,5;vO!&iQMhO'#GlO( bQMhO'#GlO!&iQMhO'#GnO( bQMhO'#GnO1SQ`O'#DXO1SQ`O'#DXO!&iQMhO'#GOO( bQMhO'#GOO!&iQMhO'#GQO( bQMhO'#GQO!&iQMhO'#G`O( bQMhO'#G`O!(yQlO,5:hO(#SQpO'#D]O(#^QpO'#JtO!(yQlO,5@mO'MVQlO1G0sO(#hQ?MtO'#CiO!(yQlO1G2OO!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO(#rQ!dO'#CrO!&iQMhO,5<sO( bQMhO,5<sO'MVQlO1G2QO!(yQlO7+&yO!&iQMhO1G2_O( bQMhO1G2_O!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO!&iQMhO1G2aO( bQMhO1G2aO'MVQlO7+'lO'MVQlO7+&_O!&iQMhOANAhO( bQMhOANAhO($VQ`O'#EmO($[Q`O'#EmO($dQ`O'#F[O($iQ`O'#EwO($nQ`O'#KRO($yQ`O'#KPO(%UQ`O,5;XO(%ZQMjO,5<dO(%bQ`O'#GXO(%gQ`O'#GXO(%lQ`O,5<fO(%tQ`O,5;XO(%|Q?MtO1G1_O(&TQ`O,5<sO(&YQ`O,5<sO(&_Q`O,5<uO(&dQ`O,5<uO(&iQ`O1G2QO(&nQ`O1G0sO(&sQMjO<<K|O(&zQMjO<<K|O7eQMhO'#F{O9UQ`O'#FzOAdQ`O'#ElO!(yQlO,5;sO!3^Q`O'#GXO!3^Q`O'#GXO!3^Q`O'#GZO!3^Q`O'#GZO!+rQMhO7+(bO!+rQMhO7+(bO%-ZQ!dO1G2vO%-ZQ!dO1G2vO!&iQMhO,5=[O!&iQMhO,5=[",stateData:"((P~O'zOS'{OSTOS'|RQ~OPYOQYOSfOY!VOaqOdzOeyOj!POnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!swO!vxO!z]O$V|O$miO%g}O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO&U!WO&[!XO&^!YO&`!ZO&b![O&e!]O&k!^O&q!_O&s!`O&u!aO&w!bO&y!cO(RSO(TTO(WUO(_VO(m[O~OWtO~P`OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa!wOq!nO!Q!oO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!xO#U!pO#V!pO#Y!zO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O'|!{O~OP]XR]X[]Xa]Xp]X!O]X!Q]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X'x]X(_]X(p]X(w]X(x]X~O!e%QX~P(qO_!}O(T#PO(U!}O(V#PO~O_#QO(V#PO(W#PO(X#QO~Ov#SO!S#TO(`#TO(a#VO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R;{O(TTO(WUO(_VO(m[O~O!Y#ZO!Z#WO!W(fP!W(tP~P+}O![#cO~P`OPYOQYOSfOd!jOe!iOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(TTO(WUO(_VO(m[O~On#mO!Y#iO!z]O#g#lO#h#iO(R;|O!i(qP~P.iO!j#oO(R#nO~O!v#sO!z]O%g#tO~O#i#uO~O!e#vO#i#uO~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z$_O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa(dX'x(dX'u(dX!i(dX!W(dX!](dX%h(dX!e(dX~P1qO#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX!](eX%h(eX~Oa(eX'x(eX'u(eX!W(eX!i(eXt(eX!e(eX~P4UO#^$eO~O$[$hO$^$gO$e$mO~OSfO!]$nO$h$oO$j$qO~Oh%VOj%cOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R$sO(TTO(WUO(_$uO(w$}O(x%POg([P~O!j%dO~O!Q%gO!]%hO(R%fO~O!e%lO~Oa%mO'x%mO~O!O%qO~P%[O(S!lO~P%[O%m%uO~P%[Oh%VO!j%dO(R%fO(S!lO~Oe%|O!j%dO(R%fO~O#t$RO~O!O&RO!]&OO!j&QO%i&UO(R%fO(S!lO(TTO(WUO`)UP~O!v#sO~O%r&WO!Q)QX!])QX(R)QX~O(R&XO~Oj!PO!s&^O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO~Od&cOe&bO!v&`O%g&aO%z&_O~P<POd&fOeyOj!PO!]&eO!s&^O!vxO!z]O%g}O%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO~Ob&iO#^&lO%i&gO(S!lO~P=UO!j&mO!s&qO~O!j#oO~O!]XO~Oa%mO'v&yO'x%mO~Oa%mO'v&|O'x%mO~Oa%mO'v'OO'x%mO~O'u]X!W]Xt]X!i]X&Y]X!]]X%h]X!e]X~P(qO!`']O!a'UO!b'UO(S!lO(TTO(WUO~Oq'SO!Q'RO!Y'VO(c'QO![(gP![(vP~P@]Ol'`O!]'^O(R%fO~Oe'eO!j%dO(R%fO~O!O&RO!j&QO~Oq!nO!Q!oO!z;wO#R!pO#S!pO#U!pO#V!pO(S!lO(TTO(WUO(c!mO(m!sO~O!`'kO!a'jO!b'jO#T!pO#Y'lO#Z'lO~PAwOa%mOh%VO!e#vO!j%dO'x%mO(p'nO~O!n'rO#^'pO~PCVOq!nO!Q!oO(TTO(WUO(c!mO(m!sO~O!]XOq(kX!Q(kX!`(kX!a(kX!b(kX!z(kX#R(kX#S(kX#T(kX#U(kX#V(kX#Y(kX#Z(kX(S(kX(T(kX(W(kX(c(kX(m(kX~O!a'jO!b'jO(S!lO~PCuO'}'vO(O'vO(P'xO~O_!}O(T'zO(U!}O(V'zO~O_#QO(V'zO(W'zO(X#QO~Ot'|O~P%[Ov#SO!S#TO(`#TO(a(PO~O!Y(RO!W'UX!W'[X!Z'UX!Z'[X~P+}O!Z(TO!W(fX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z(TO!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~O!W(fX~PGpO!W(YO~O!W(sX!Z(sX!e(sX!i(sX(p(sX~O#^(sX#i#bX![(sX~PIsO#^(ZO!W(uX!Z(uX~O!Z([O!W(tX~O!W(_O~O#^$eO~PIsO![(`O~P`OR#zO!O#yO!Q#{O!j#xO(_VOP!la[!lap!la!Z!la!n!la#P!la#l!la#m!la#n!la#o!la#p!la#q!la#r!la#s!la#t!la#u!la#w!la#y!la#z!la(p!la(w!la(x!la~Oa!la'x!la'u!la!W!la!i!lat!la!]!la%h!la!e!la~PKZO!i(aO~O!e#vO#^(bO(p'nO!Z(rXa(rX'x(rX~O!i(rX~PMvO!Q%gO!]%hO!z]O#g(gO#h(fO(R%fO~O!Z(hO!i(qX~O!i(jO~O!Q%gO!]%hO#h(fO(R%fO~OP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O!e#vO!i(eX~P! dOR(lO!O(kO!j#xO#Q$dO!z!ya!Q!ya~O!v!ya%g!ya!]!ya#g!ya#h!ya(R!ya~P!#eO!v(pO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~O#i(vO~O!Y(xO!i(iP~P%[O(c(zO(m[O~O!Q(|O!j#xO(c(zO(m[O~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z$_Oa$pa'x$pa'u$pa!i$pa!W$pa!]$pa%h$pa!e$pa~Oj)bO~P!&iOh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Og(nP~P!+rO!O)gO!e)fO!]$]X$Y$]X$[$]X$^$]X$e$]X~O!e)fO!](yX$Y(yX$[(yX$^(yX$e(yX~O!O)gO~P!-{O!O)gO!](yX$Y(yX$[(yX$^(yX$e(yX~O!])iO$Y)mO$[)hO$^)hO$e)nO~O!Y)qO~P!(yO$[$hO$^$gO$e)uO~Ol$yX!O$yX#Q$yX'w$yX(w$yX(x$yX~OgkXg$yXlkX!ZkX#^kX~P!/qOv)wO(`)xO(a)zO~Ol*TO!O)|O'w)}O(w$}O(x%PO~Og){O~P!0uOg*UO~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q*WO!]*XO!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~O!Y*[O(R*VO!i(|P~P!1dO#i*^O~O!j*_O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R*aO(TTO(WUO(_$uO(w$}O(x%PO~O!Y*dO!W(}P~P!3cOp*pOq!nO!Q*fO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO(c!mO~O![*mO~P!5WO#Q$dOl(^X!O(^X'w(^X(w(^X(x(^X!Z(^X#^(^X~Og(^X#}(^X~P!6YOl*uO#^*tOg(]X!Z(]X~O!Z*vOg([X~Oj%cO(R&XOg([P~Oq*yO~O!j+OO~O(R(tO~On+TO!Q%gO!Y#iO!]%hO!z]O#g#lO#h#iO(R%fO!i(qP~O!e#vO#i+UO~O!Q%gO!Y+WO!Z([O!]%hO(R%fO!W(tP~Oq'YO!Q+YO!Y+XO(TTO(WUO(c(zO~O![(vP~P!9]O!Z+ZOa)RX'x)RX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa!ha!Z!ha'x!ha'u!ha!W!ha!i!hat!ha!]!ha%h!ha!e!ha~P!:TOR#zO!O#yO!Q#{O!j#xO(_VOP!pa[!pap!pa!Z!pa!n!pa#P!pa#l!pa#m!pa#n!pa#o!pa#p!pa#q!pa#r!pa#s!pa#t!pa#u!pa#w!pa#y!pa#z!pa(p!pa(w!pa(x!pa~Oa!pa'x!pa'u!pa!W!pa!i!pat!pa!]!pa%h!pa!e!pa~P!<kOR#zO!O#yO!Q#{O!j#xO(_VOP!ra[!rap!ra!Z!ra!n!ra#P!ra#l!ra#m!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#w!ra#y!ra#z!ra(p!ra(w!ra(x!ra~Oa!ra'x!ra'u!ra!W!ra!i!rat!ra!]!ra%h!ra!e!ra~P!?ROh%VOl+dO!]'^O%h+cO~O!e+fOa(ZX!](ZX'x(ZX!Z(ZX~Oa%mO!]XO'x%mO~Oh%VO!j%dO~Oh%VO!j%dO(R%fO~O!e#vO#i(vO~Ob+qO%i+rO(R+nO(TTO(WUO![)VP~O!Z+sO`)UX~O[+wO~O`+xO~O!]&OO(R%fO(S!lO`)UP~Oh%VO#^+}O~Oh%VOl,QO!]$|O~O!],SO~O!O,UO!]XO~O%m%uO~O!v,ZO~Oe,`O~Ob,aO(R#nO(TTO(WUO![)TP~Oe%|O~O%i!QO(R&XO~P=UO[,fO`,eO~OPYOQYOSfOdzOeyOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!guO!jZO!mYO!nYO!oYO!qvO!vxO!z]O$miO%g}O(TTO(WUO(_VO(m[O~O!]!eO!s!gO$V!kO(R!dO~P!FRO`,eOa%mO'x%mO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa,kOj!OO!swO%k!OO%l!OO%m!OO~P!HkO!j&mO~O&[,qO~O!],sO~O&m,uO&o,vOP&jaQ&jaS&jaY&jaa&jad&jae&jaj&jan&jap&jaq&jar&jax&jaz&ja|&ja!Q&ja!U&ja!V&ja!]&ja!g&ja!j&ja!m&ja!n&ja!o&ja!q&ja!s&ja!v&ja!z&ja$V&ja$m&ja%g&ja%i&ja%k&ja%l&ja%m&ja%p&ja%r&ja%u&ja%v&ja%x&ja&U&ja&[&ja&^&ja&`&ja&b&ja&e&ja&k&ja&q&ja&s&ja&u&ja&w&ja&y&ja'u&ja(R&ja(T&ja(W&ja(_&ja(m&ja![&ja&c&jab&ja&h&ja~O(R,{O~Oh!cX!Z!PX![!PX!e!PX!e!cX!j!cX#^!PX~O!Z!cX![!cX~P# qO!e-QO#^-POh(hX!Z#fX![#fX!e(hX!j(hX~O!Z(hX![(hX~P#!dOh%VO!e-SO!j%dO!Z!_X![!_X~Oq!nO!Q!oO(TTO(WUO(c!mO~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(TTO(WUO(_VO(m[O~O(R<rO~P##yO!Z-WO![(gX~O![-YO~O!e-QO#^-PO!Z#fX![#fX~O!Z-ZO![(vX~O![-]O~O!a-^O!b-^O(S!lO~P##hO![-aO~P'_Ol-dO!]'^O~O!W-iO~Oq!ya!`!ya!a!ya!b!ya#R!ya#S!ya#T!ya#U!ya#V!ya#Y!ya#Z!ya(S!ya(T!ya(W!ya(c!ya(m!ya~P!#eO!n-nO#^-lO~PCVO!a-pO!b-pO(S!lO~PCuOa%mO#^-lO'x%mO~Oa%mO!e#vO#^-lO'x%mO~Oa%mO!e#vO!n-nO#^-lO'x%mO(p'nO~O'}'vO(O'vO(P-uO~Ot-vO~O!W'Ua!Z'Ua~P!:TO!Y-zO!W'UX!Z'UX~P%[O!Z(TO!W(fa~O!W(fa~PGpO!Z([O!W(ta~O!Q%gO!Y.OO!]%hO(R%fO!W'[X!Z'[X~O#^.QO!Z(ra!i(raa(ra'x(ra~O!e#vO~P#,PO!Z(hO!i(qa~O!Q%gO!]%hO#h.UO(R%fO~On.ZO!Q%gO!Y.WO!]%hO!z]O#g.YO#h.WO(R%fO!Z'_X!i'_X~OR._O!j#xO~Oh%VOl.bO!]'^O%h.aO~Oa#ai!Z#ai'x#ai'u#ai!W#ai!i#ait#ai!]#ai%h#ai!e#ai~P!:TOl=|O!O)|O'w)}O(w$}O(x%PO~O#i#]aa#]a#^#]a'x#]a!Z#]a!i#]a!]#]a!W#]a~P#.{O#i(^XP(^XR(^X[(^Xa(^Xp(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X'x(^X(_(^X(p(^X!i(^X!W(^X'u(^Xt(^X!](^X%h(^X!e(^X~P!6YO!Z.oO!i(iX~P!:TO!i.rO~O!W.tO~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kia#kip#ki!Z#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#l#ki~P#2kO#l$OO~P#2kOP$[OR#zOp$aO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO[#kia#ki!Z#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#p#ki~P#5YO#p$QO~P#5YOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO(_VOa#ki!Z#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#u#ki~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO(_VO(x#}Oa#ki!Z#ki#y#ki#z#ki'x#ki(p#ki(w#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#w$UO~P#:_O#w#ki~P#:_O#u$SO~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO(_VO(w#|O(x#}Oa#ki!Z#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#y#ki~P#=TO#y$WO~P#=TOP]XR]X[]Xp]X!O]X!Q]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X!Z]X![]X~O#}]X~P#?rOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO#y<XO#z<YO(_VO(p$YO(w#|O(x#}O~O#}.vO~P#BPO#Q$dO#^<`O$P<`O#}(eX![(eX~P! dOa'ba!Z'ba'x'ba'u'ba!i'ba!W'bat'ba!]'ba%h'ba!e'ba~P!:TO[#kia#kip#ki!Z#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO(w#ki(x#ki~P#EROl=|O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P#ERO!Z.zOg(nX~P!0uOg.|O~Oa$Oi!Z$Oi'x$Oi'u$Oi!W$Oi!i$Oit$Oi!]$Oi%h$Oi!e$Oi~P!:TO$[.}O$^.}O~O$[/OO$^/OO~O!e)fO#^/PO!]$bX$Y$bX$[$bX$^$bX$e$bX~O!Y/QO~O!])iO$Y/SO$[)hO$^)hO$e/TO~O!Z<ZO![(dX~P#BPO![/UO~O!e)fO$e(yX~O$e/WO~Ot/XO~P!&iOv)wO(`)xO(a/[O~O!Q/_O~O(w$}Ol%`a!O%`a'w%`a(x%`a!Z%`a#^%`a~Og%`a#}%`a~P#LTO(x%POl%ba!O%ba'w%ba(w%ba!Z%ba#^%ba~Og%ba#}%ba~P#LvO!ZfX!efX!ifX!i$yX(pfX~P!/qO!Y/hO!Z([O(R/gO!W(tP!W(}P~P!1dOp*pO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO~Oq<oO!Q/iO!Y+XO![*mO(c<nO![(vP~P#NaO!i/jO~P#.{O!Z/kO!e#vO(p'nO!i(|X~O!i/pO~O!Q%gO!Y*[O!]%hO(R%fO!i(|P~O#i/rO~O!W$yX!Z$yX!e%QX~P!/qO!Z/sO!W(}X~P#.{O!e/uO~O!W/wO~OnkO(R/xO~P.iOh%VOp/}O!e#vO!j%dO(p'nO~O!e+fO~Oa%mO!Z0RO'x%mO~O![0TO~P!5WO!a0UO!b0UO(S!lO~P##hOq!nO!Q0VO(TTO(WUO(c!mO~O#Y0XO~Og%`a!Z%`a#^%`a#}%`a~P!0uOg%ba!Z%ba#^%ba#}%ba~P!0uOj%cO(R&XOg'kX!Z'kX~O!Z*vOg([a~Og0bO~OR0cO!O0cO!Q0dO#Q$dOl{a'w{a(w{a(x{a!Z{a#^{a~Og{a#}{a~P$&dO!O)|O'w)}Ol$ra(w$ra(x$ra!Z$ra#^$ra~Og$ra#}$ra~P$'`O!O)|O'w)}Ol$ta(w$ta(x$ta!Z$ta#^$ta~Og$ta#}$ta~P$(RO#i0gO~Og%Sa!Z%Sa#^%Sa#}%Sa~P!0uOl0iO#^0hOg(]a!Z(]a~O!e#vO~O#i0lO~O!Z+ZOa)Ra'x)Ra~OR#zO!O#yO!Q#{O!j#xO(_VOP!pi[!pip!pi!Z!pi!n!pi#P!pi#l!pi#m!pi#n!pi#o!pi#p!pi#q!pi#r!pi#s!pi#t!pi#u!pi#w!pi#y!pi#z!pi(p!pi(w!pi(x!pi~Oa!pi'x!pi'u!pi!W!pi!i!pit!pi!]!pi%h!pi!e!pi~P$*OOh%VOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~On0vO%[0wO(R0tO~P$,fO!e+fOa(Za!](Za'x(Za!Z(Za~O#i0|O~O[]X!ZfX![fX~O!Z0}O![)VX~O![1PO~O[1QO~Ob1SO(R+nO(TTO(WUO~O!]&OO(R%fO`'sX!Z'sX~O!Z+sO`)Ua~O!i1VO~P!:TO[1YO~O`1ZO~O#^1^O~Ol1aO!]$|O~O(c(zO![)SP~Oh%VOl1jO!]1gO%h1iO~O[1tO!Z1rO![)TX~O![1uO~O`1wOa%mO'x%mO~O(R#nO(TTO(WUO~O#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O#t1zO&Y1{Oa(eX~P$2PO#^$eO#t1zO&Y1{O~Oa1}O~P%[Oa2PO~O&c2SOP&aiQ&aiS&aiY&aia&aid&aie&aij&ain&aip&aiq&air&aix&aiz&ai|&ai!Q&ai!U&ai!V&ai!]&ai!g&ai!j&ai!m&ai!n&ai!o&ai!q&ai!s&ai!v&ai!z&ai$V&ai$m&ai%g&ai%i&ai%k&ai%l&ai%m&ai%p&ai%r&ai%u&ai%v&ai%x&ai&U&ai&[&ai&^&ai&`&ai&b&ai&e&ai&k&ai&q&ai&s&ai&u&ai&w&ai&y&ai'u&ai(R&ai(T&ai(W&ai(_&ai(m&ai![&aib&ai&h&ai~Ob2YO![2WO&h2XO~P`O!]XO!j2[O~O&o,vOP&jiQ&jiS&jiY&jia&jid&jie&jij&jin&jip&jiq&jir&jix&jiz&ji|&ji!Q&ji!U&ji!V&ji!]&ji!g&ji!j&ji!m&ji!n&ji!o&ji!q&ji!s&ji!v&ji!z&ji$V&ji$m&ji%g&ji%i&ji%k&ji%l&ji%m&ji%p&ji%r&ji%u&ji%v&ji%x&ji&U&ji&[&ji&^&ji&`&ji&b&ji&e&ji&k&ji&q&ji&s&ji&u&ji&w&ji&y&ji'u&ji(R&ji(T&ji(W&ji(_&ji(m&ji![&ji&c&jib&ji&h&ji~O!W2bO~O!Z!_a![!_a~P#BPOq!nO!Q!oO!Y2hO(c!mO!Z'VX!['VX~P@]O!Z-WO![(ga~O!Z']X![']X~P!9]O!Z-ZO![(va~O![2oO~P'_Oa%mO#^2xO'x%mO~Oa%mO!e#vO#^2xO'x%mO~Oa%mO!e#vO!n2|O#^2xO'x%mO(p'nO~Oa%mO'x%mO~P!:TO!Z$_Ot$pa~O!W'Ui!Z'Ui~P!:TO!Z(TO!W(fi~O!Z([O!W(ti~O!W(ui!Z(ui~P!:TO!Z(ri!i(ria(ri'x(ri~P!:TO#^3OO!Z(ri!i(ria(ri'x(ri~O!Z(hO!i(qi~O!Q%gO!]%hO!z]O#g3TO#h3SO(R%fO~O!Q%gO!]%hO#h3SO(R%fO~Ol3[O!]'^O%h3ZO~Oh%VOl3[O!]'^O%h3ZO~O#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`at%`a!]%`a%h%`a!e%`a~P#LTO#i%baP%baR%ba[%baa%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%bat%ba!]%ba%h%ba!e%ba~P#LvO#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!Z%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`a#^%`at%`a!]%`a%h%`a!e%`a~P#.{O#i%baP%baR%ba[%baa%bap%ba!Q%ba!Z%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%ba#^%bat%ba!]%ba%h%ba!e%ba~P#.{O#i{aP{a[{aa{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a'x{a(_{a(p{a!i{a!W{a'u{at{a!]{a%h{a!e{a~P$&dO#i$raP$raR$ra[$raa$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra'x$ra(_$ra(p$ra!i$ra!W$ra'u$rat$ra!]$ra%h$ra!e$ra~P$'`O#i$taP$taR$ta[$taa$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta'x$ta(_$ta(p$ta!i$ta!W$ta'u$tat$ta!]$ta%h$ta!e$ta~P$(RO#i%SaP%SaR%Sa[%Saa%Sap%Sa!Q%Sa!Z%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa'x%Sa(_%Sa(p%Sa!i%Sa!W%Sa'u%Sa#^%Sat%Sa!]%Sa%h%Sa!e%Sa~P#.{Oa#aq!Z#aq'x#aq'u#aq!W#aq!i#aqt#aq!]#aq%h#aq!e#aq~P!:TO!Y3dO!Z'WX!i'WX~P%[O!Z.oO!i(ia~O!Z.oO!i(ia~P!:TO!W3gO~O#}!la![!la~PKZO#}!ha!Z!ha![!ha~P#BPO#}!pa![!pa~P!<kO#}!ra![!ra~P!?ROg'ZX!Z'ZX~P!+rO!Z.zOg(na~OSfO!]3{O$c3|O~O![4QO~Ot4RO~P#.{Oa$lq!Z$lq'x$lq'u$lq!W$lq!i$lqt$lq!]$lq%h$lq!e$lq~P!:TO!W4TO~P!&iO!Q4UO~O!O)|O'w)}O(x%POl'ga(w'ga!Z'ga#^'ga~Og'ga#}'ga~P%+uO!O)|O'w)}Ol'ia(w'ia(x'ia!Z'ia#^'ia~Og'ia#}'ia~P%,hO(p$YO~P#.{O!WfX!W$yX!ZfX!Z$yX!e%QX#^fX~P!/qO(R<xO~P!1dO!Q%gO!Y4XO!]%hO(R%fO!Z'cX!i'cX~O!Z/kO!i(|a~O!Z/kO!e#vO!i(|a~O!Z/kO!e#vO(p'nO!i(|a~Og${i!Z${i#^${i#}${i~P!0uO!Y4aO!W'eX!Z'eX~P!3cO!Z/sO!W(}a~O!Z/sO!W(}a~P#.{OP]XR]X[]Xp]X!O]X!Q]X!W]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!e%XX#t%XX~P%0XO!e#vO#t4fO~Oh%VO!e#vO!j%dO~Oh%VOp4kO!j%dO(p'nO~Op4pO!e#vO(p'nO~Oq!nO!Q4qO(TTO(WUO(c!mO~O(w$}Ol%`i!O%`i'w%`i(x%`i!Z%`i#^%`i~Og%`i#}%`i~P%3xO(x%POl%bi!O%bi'w%bi(w%bi!Z%bi#^%bi~Og%bi#}%bi~P%4kOg(]i!Z(]i~P!0uO#^4wOg(]i!Z(]i~P!0uO!i4zO~Oa$nq!Z$nq'x$nq'u$nq!W$nq!i$nqt$nq!]$nq%h$nq!e$nq~P!:TO!W5QO~O!Z5RO!])OX~P#.{Oa]Xa$yX!]]X!]$yX%]]X'x]X'x$yX!Z]X!Z$yX~P!/qO%]5UOa%Za!]%Za'x%Za!Z%Za~OlmX!OmX'wmX(wmX(xmX~P%7nOn5VO(R#nO~Ob5]O%i5^O(R+nO(TTO(WUO!Z'rX!['rX~O!Z0}O![)Va~O[5bO~O`5cO~Oa%mO'x%mO~P#.{O!Z5kO#^5mO![)SX~O![5nO~Op5tOq!nO!Q*fO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!pO#U!pO#V!pO#Y5sO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O![5rO~P%:ROl5yO!]1gO%h5xO~Oh%VOl5yO!]1gO%h5xO~Ob6QO(R#nO(TTO(WUO!Z'qX!['qX~O!Z1rO![)Ta~O(TTO(WUO(c6SO~O`6WO~O#t6ZO&Y6[O~PMvO!i6]O~P%[Oa6_O~Oa6_O~P%[Ob2YO![6dO&h2XO~P`O!e6fO~O!e6hOh(hi!Z(hi![(hi!e(hi!j(hip(hi(p(hi~O!Z#fi![#fi~P#BPO#^6iO!Z#fi![#fi~O!Z!_i![!_i~P#BPOa%mO#^6rO'x%mO~Oa%mO!e#vO#^6rO'x%mO~O!Z(rq!i(rqa(rq'x(rq~P!:TO!Z(hO!i(qq~O!Q%gO!]%hO#h6yO(R%fO~O!]'^O%h6|O~Ol7QO!]'^O%h6|O~O#i'gaP'gaR'ga['gaa'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga'x'ga(_'ga(p'ga!i'ga!W'ga'u'gat'ga!]'ga%h'ga!e'ga~P%+uO#i'iaP'iaR'ia['iaa'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia'x'ia(_'ia(p'ia!i'ia!W'ia'u'iat'ia!]'ia%h'ia!e'ia~P%,hO#i${iP${iR${i[${ia${ip${i!Q${i!Z${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i'x${i(_${i(p${i!i${i!W${i'u${i#^${it${i!]${i%h${i!e${i~P#.{O#i%`iP%`iR%`i[%`ia%`ip%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i'x%`i(_%`i(p%`i!i%`i!W%`i'u%`it%`i!]%`i%h%`i!e%`i~P%3xO#i%biP%biR%bi[%bia%bip%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi'x%bi(_%bi(p%bi!i%bi!W%bi'u%bit%bi!]%bi%h%bi!e%bi~P%4kO!Z'Wa!i'Wa~P!:TO!Z.oO!i(ii~O#}#ai!Z#ai![#ai~P#BPOP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kip#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#l#ki~P%MQO#l<PO~P%MQOP$[OR#zOp<]O!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO[#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#p#ki~P& YO#p<RO~P& YOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO(_VO#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#u#ki~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO(_VO(x#}O#y#ki#z#ki#}#ki(p#ki(w#ki!Z#ki![#ki~O#w<VO~P&%cO#w#ki~P&%cO#u<TO~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO(_VO(w#|O(x#}O#z#ki#}#ki(p#ki!Z#ki![#ki~O#y#ki~P&'rO#y<XO~P&'rOa#{y!Z#{y'x#{y'u#{y!W#{y!i#{yt#{y!]#{y%h#{y!e#{y~P!:TO[#kip#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki!Z#ki![#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO(w#ki(x#ki~P&*nOl=}O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P&*nO#Q$dOP(^XR(^X[(^Xl(^Xp(^X!O(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X#}(^X'w(^X(_(^X(p(^X(w(^X(x(^X!Z(^X![(^X~O#}$Oi!Z$Oi![$Oi~P#BPO#}!pi![!pi~P$*OOg'Za!Z'Za~P!0uO![7dO~O!Z'ba!['ba~P#BPO!W7eO~P#.{O!e#vO(p'nO!Z'ca!i'ca~O!Z/kO!i(|i~O!Z/kO!e#vO!i(|i~Og${q!Z${q#^${q#}${q~P!0uO!W'ea!Z'ea~P#.{O!e7lO~O!Z/sO!W(}i~P#.{O!Z/sO!W(}i~O!W7oO~Oh%VOp7tO!j%dO(p'nO~O!e#vO#t7vO~Op7yO!e#vO(p'nO~O!O)|O'w)}O(x%POl'ha(w'ha!Z'ha#^'ha~Og'ha#}'ha~P&3oO!O)|O'w)}Ol'ja(w'ja(x'ja!Z'ja#^'ja~Og'ja#}'ja~P&4bO!W7{O~Og$}q!Z$}q#^$}q#}$}q~P!0uOg(]q!Z(]q~P!0uO#^7|Og(]q!Z(]q~P!0uOa$ny!Z$ny'x$ny'u$ny!W$ny!i$nyt$ny!]$ny%h$ny!e$ny~P!:TO!e6hO~O!Z5RO!])Oa~O!]'^OP$SaR$Sa[$Sap$Sa!O$Sa!Q$Sa!Z$Sa!j$Sa!n$Sa#P$Sa#l$Sa#m$Sa#n$Sa#o$Sa#p$Sa#q$Sa#r$Sa#s$Sa#t$Sa#u$Sa#w$Sa#y$Sa#z$Sa(_$Sa(p$Sa(w$Sa(x$Sa~O%h6|O~P&7SO%]8QOa%Zi!]%Zi'x%Zi!Z%Zi~Oa#ay!Z#ay'x#ay'u#ay!W#ay!i#ayt#ay!]#ay%h#ay!e#ay~P!:TO[8SO~Ob8UO(R+nO(TTO(WUO~O!Z0}O![)Vi~O`8YO~O(c(zO!Z'nX!['nX~O!Z5kO![)Sa~O![8cO~P%:RO(m!sO~P$$oO#Y8dO~O!]1gO~O!]1gO%h8fO~Ol8iO!]1gO%h8fO~O[8nO!Z'qa!['qa~O!Z1rO![)Ti~O!i8rO~O!i8sO~O!i8vO~O!i8vO~P%[Oa8xO~O!e8yO~O!i8zO~O!Z(ui![(ui~P#BPOa%mO#^9SO'x%mO~O!Z(ry!i(rya(ry'x(ry~P!:TO!Z(hO!i(qy~O%h9VO~P&7SO!]'^O%h9VO~O#i${qP${qR${q[${qa${qp${q!Q${q!Z${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q'x${q(_${q(p${q!i${q!W${q'u${q#^${qt${q!]${q%h${q!e${q~P#.{O#i'haP'haR'ha['haa'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha'x'ha(_'ha(p'ha!i'ha!W'ha'u'hat'ha!]'ha%h'ha!e'ha~P&3oO#i'jaP'jaR'ja['jaa'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja'x'ja(_'ja(p'ja!i'ja!W'ja'u'jat'ja!]'ja%h'ja!e'ja~P&4bO#i$}qP$}qR$}q[$}qa$}qp$}q!Q$}q!Z$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q'x$}q(_$}q(p$}q!i$}q!W$}q'u$}q#^$}qt$}q!]$}q%h$}q!e$}q~P#.{O!Z'Wi!i'Wi~P!:TO#}#aq!Z#aq![#aq~P#BPO(w$}OP%`aR%`a[%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a#}%`a(_%`a(p%`a!Z%`a![%`a~Ol%`a!O%`a'w%`a(x%`a~P&HgO(x%POP%baR%ba[%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba#}%ba(_%ba(p%ba!Z%ba![%ba~Ol%ba!O%ba'w%ba(w%ba~P&JnOl=}O!O)|O'w)}O(x%PO~P&HgOl=}O!O)|O'w)}O(w$}O~P&JnOR0cO!O0cO!Q0dO#Q$dOP{a[{al{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a#}{a'w{a(_{a(p{a(w{a(x{a!Z{a![{a~O!O)|O'w)}OP$raR$ra[$ral$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra#}$ra(_$ra(p$ra(w$ra(x$ra!Z$ra![$ra~O!O)|O'w)}OP$taR$ta[$tal$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta#}$ta(_$ta(p$ta(w$ta(x$ta!Z$ta![$ta~Ol=}O!O)|O'w)}O(w$}O(x%PO~OP%SaR%Sa[%Sap%Sa!Q%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa#}%Sa(_%Sa(p%Sa!Z%Sa![%Sa~P'%sO#}$lq!Z$lq![$lq~P#BPO#}$nq!Z$nq![$nq~P#BPO![9dO~O#}9eO~P!0uO!e#vO!Z'ci!i'ci~O!e#vO(p'nO!Z'ci!i'ci~O!Z/kO!i(|q~O!W'ei!Z'ei~P#.{O!Z/sO!W(}q~Op9lO!e#vO(p'nO~O[9nO!W9mO~P#.{O!W9mO~O!e#vO#t9tO~Og(]y!Z(]y~P!0uO!Z'la!]'la~P#.{Oa%Zq!]%Zq'x%Zq!Z%Zq~P#.{O[9yO~O!Z0}O![)Vq~O#^9}O!Z'na!['na~O!Z5kO![)Si~P#BPO!Q:PO~O!]1gO%h:SO~O(TTO(WUO(c:XO~O!Z1rO![)Tq~O!i:[O~O!i:]O~O!i:^O~O!i:^O~P%[O#^:aO!Z#fy![#fy~O!Z#fy![#fy~P#BPO%h:fO~P&7SO!]'^O%h:fO~O#}#{y!Z#{y![#{y~P#BPOP${iR${i[${ip${i!Q${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i#}${i(_${i(p${i!Z${i![${i~P'%sO!O)|O'w)}O(x%POP'gaR'ga['gal'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga#}'ga(_'ga(p'ga(w'ga!Z'ga!['ga~O!O)|O'w)}OP'iaR'ia['ial'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia#}'ia(_'ia(p'ia(w'ia(x'ia!Z'ia!['ia~O(w$}OP%`iR%`i[%`il%`ip%`i!O%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i#}%`i'w%`i(_%`i(p%`i(x%`i!Z%`i![%`i~O(x%POP%biR%bi[%bil%bip%bi!O%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi#}%bi'w%bi(_%bi(p%bi(w%bi!Z%bi![%bi~O#}$ny!Z$ny![$ny~P#BPO#}#ay!Z#ay![#ay~P#BPO!e#vO!Z'cq!i'cq~O!Z/kO!i(|y~O!W'eq!Z'eq~P#.{Op:pO!e#vO(p'nO~O[:tO!W:sO~P#.{O!W:sO~Og(]!R!Z(]!R~P!0uOa%Zy!]%Zy'x%Zy!Z%Zy~P#.{O!Z0}O![)Vy~O!Z5kO![)Sq~O(R:zO~O!]1gO%h:}O~O!i;QO~O%h;VO~P&7SOP${qR${q[${qp${q!Q${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q#}${q(_${q(p${q!Z${q![${q~P'%sO!O)|O'w)}O(x%POP'haR'ha['hal'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha#}'ha(_'ha(p'ha(w'ha!Z'ha!['ha~O!O)|O'w)}OP'jaR'ja['jal'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja#}'ja(_'ja(p'ja(w'ja(x'ja!Z'ja!['ja~OP$}qR$}q[$}qp$}q!Q$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q#}$}q(_$}q(p$}q!Z$}q![$}q~P'%sOg%d!Z!Z%d!Z#^%d!Z#}%d!Z~P!0uO!W;ZO~P#.{Op;[O!e#vO(p'nO~O[;^O!W;ZO~P#.{O!Z'nq!['nq~P#BPO!Z#f!Z![#f!Z~P#BPO#i%d!ZP%d!ZR%d!Z[%d!Za%d!Zp%d!Z!Q%d!Z!Z%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z'x%d!Z(_%d!Z(p%d!Z!i%d!Z!W%d!Z'u%d!Z#^%d!Zt%d!Z!]%d!Z%h%d!Z!e%d!Z~P#.{Op;fO!e#vO(p'nO~O!W;gO~P#.{Op;nO!e#vO(p'nO~O!W;oO~P#.{OP%d!ZR%d!Z[%d!Zp%d!Z!Q%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z#}%d!Z(_%d!Z(p%d!Z!Z%d!Z![%d!Z~P'%sOp;rO!e#vO(p'nO~Ot(dX~P1qO!O%qO~P!(yO(S!lO~P!(yO!WfX!ZfX#^fX~P%0XOP]XR]X[]Xp]X!O]X!Q]X!Z]X!ZfX!j]X!n]X#P]X#Q]X#^]X#^fX#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!efX!i]X!ifX(pfX~P'JlOP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]XO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z<ZO![$pa~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<fO!Q${O!]$|O!g=wO!j$xO#h<lO$V%_O$s<hO$u<jO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Oj)bO~P( bOp!cX(p!cX~P# qOp(hX(p(hX~P#!dO![]X![fX~P'JlO!WfX!W$yX!ZfX!Z$yX#^fX~P!/qO#i<OO~O!e#vO#i<OO~O#^<`O~O#t<SO~O#^<pO!Z(uX![(uX~O#^<`O!Z(sX![(sX~O#i<qO~Og<sO~P!0uO#i<yO~O#i<zO~O!e#vO#i<{O~O!e#vO#i<qO~O#}<|O~P#BPO#i<}O~O#i=OO~O#i=TO~O#i=UO~O#i=VO~O#i=WO~O#}=XO~P!0uO#}=YO~P!0uO#Q#R#S#U#V#Y#g#h#s$m$s$u$x%[%]%g%h%i%p%r%u%v%x%z~'|T#m!V'z(S#nq#l#op!O'{$['{(R$^(c~",goto:"$8f)ZPPPPPP)[PP)_P)pP+Q/VPPPP6aPP6wPP<oP@cP@yP@yPPP@yPCRP@yP@yP@yPCVPC[PCyPHsPPPHwPPPPHwKzPPPLQLrPHwPHwPP! QHwPPPHwPHwP!#XHwP!&o!'t!'}P!(q!(u!(q!,SPPPPPPP!,s!'tPP!-T!.uP!2RHwHw!2W!5d!:Q!:Q!>PPPP!>XHwPPPPPPPPPP!AhP!BuPPHw!DWPHwPHwHwHwHwHwPHw!EjP!HtP!KzP!LO!LY!L^!L^P!HqP!Lb!LbP# hP# lHwPHw# r#$wCV@yP@yP@y@yP#&U@y@y#(h@y#+`@y#-l@y@y#.[#0p#0p#0u#1O#0p#1ZPP#0pP@y#1s@y#5r@y@y6aPPP#9wPPP#:b#:bP#:bP#:x#:bPP#;OP#:uP#:u#;c#:u#;}#<T#<W)_#<Z)_P#<b#<b#<bP)_P)_P)_P)_PP)_P#<h#<kP#<k)_P#<oP#<rP)_P)_P)_P)_P)_P)_)_PP#<x#=O#=Z#=a#=g#=m#=s#>R#>X#>c#>i#>s#>y#?Z#?a#@R#@e#@k#@q#AP#Af#CZ#Ci#Cp#E[#Ej#G[#Gj#Gp#Gv#G|#HW#H^#Hd#Hn#IQ#IWPPPPPPPPPPP#I^PPPPPPP#JR#MY#Nr#Ny$ RPPP$&mP$&v$)o$0Y$0]$0`$1_$1b$1i$1qP$1w$1zP$2h$2l$3d$4r$4w$5_PP$5d$5j$5n$5q$5u$5y$6u$7^$7u$7y$7|$8P$8V$8Y$8^$8bR!|RoqOXst!Z#d%l&p&r&s&u,n,s2S2VY!vQ'^-`1g5qQ%svQ%{yQ&S|Q&h!VS'U!e-WQ'd!iS'j!r!yU*h$|*X*lQ+l%|Q+y&UQ,_&bQ-^']Q-h'eQ-p'kQ0U*nQ1q,`R<m;z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9SS#q];w!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU*{%[<e<fQ+q&OQ,a&eQ,h&mQ0r+dQ0u+fQ1S+rQ1y,fQ3W.bQ5V0wQ5]0}Q6Q1rQ7O3[Q8U5^R9Y7Q'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s!S!nQ!r!v!y!z$|'U']'^'j'k'l*h*l*n*o-W-^-`-p0U0X1g5q5s%[$ti#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q&V|Q'S!eS'Y%h-ZQ+q&OQ,a&eQ0f+OQ1S+rQ1X+xQ1x,eQ1y,fQ5]0}Q5f1ZQ6Q1rQ6T1tQ6U1wQ8U5^Q8X5cQ8q6WQ9|8YQ:Y8nR<o*XrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR,c&i&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=r=s[#]WZ#W#Z'V(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ%vxQ%zyS&P|&UQ&]!TQ'a!hQ'c!iQ(o#sS+k%{%|Q+o&OQ,Y&`Q,^&bS-g'd'eQ.d(pQ0{+lQ1R+rQ1T+sQ1W+wQ1l,ZS1p,_,`Q2t-hQ5[0}Q5`1QQ5e1YQ6P1qQ8T5^Q8W5bQ9x8SR:w9y!U$zi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y!^%xy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pQ+e%vQ,O&YQ,R&ZQ,]&bQ.c(oQ1k,YU1o,^,_,`Q3].dQ5z1lS6O1p1qQ8m6P#f=t#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o=u<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YW%Ti%V*v=pS&Y!Q&gQ&Z!RQ&[!SQ+S%cR+|&W%]%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}T)x$u)yV*{%[<e<fW'Y!e%h*X-ZS({#y#zQ+`%qQ+v&RS.](k(lQ1b,SQ4x0cR8^5k'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s$i$^c#Y#e%p%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.w.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ'W!eR2i-W!W!nQ!e!r!v!y!z$|'U']'^'j'k'l*X*h*l*n*o-W-^-`-p0U0X1g5q5sR1d,UnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&w!^Q't!xS(q#u<OQ+i%yQ,W&]Q,X&_Q-e'bQ-r'mS.m(v<qS0k+U<{Q0y+jQ1f,VQ2Z,uQ2],vQ2e-RQ2r-fQ2u-jS5P0l=VQ5W0zS5Z0|=WQ6j2gQ6n2sQ6s2zQ8R5XQ8}6lQ9O6oQ9R6tR:`8z$d$]c#Y#e%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gS(m#p'gQ(}#zS+_%p.wS.^(l(nR3U._'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS#q];wQ&r!XQ&s!YQ&u![Q&v!]R2R,qQ'_!hQ+b%vQ-c'aS.`(o+eQ2p-bW3Y.c.d0q0sQ6m2qW6z3V3X3]5TU9U6{6}7PU:e9W9X9ZS;T:d:gQ;b;UR;j;cU!wQ'^-`T5o1g5q!Q_OXZ`st!V!Z#d#h%d%l&g&i&p&r&s&u(h,n,s.V2S2V]!pQ!r'^-`1g5qT#q];w%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS({#y#zS.](k(l!s=^$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU$fd)],hS(n#p'gU*s%R(u3vU0e*z.i7]Q5T0rQ6{3WQ9X7OR:g9Ym!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sQ'r!uS(d#g1|S-n'i'uQ/n*ZQ/{*gQ2|-qQ4]/oQ4i/}Q4j0OQ4o0WQ7h4WS7s4k4mS7w4p4rQ9g7iQ9k7oQ9p7tQ9u7yS:o9l9mS;Y:p:sS;e;Z;[S;m;f;gS;q;n;oR;t;rQ#wbQ'q!uS(c#g1|S(e#m+TQ+V%eQ+g%wQ+m%}U-m'i'r'uQ.R(dQ/m*ZQ/|*gQ0P*iQ0x+hQ1m,[S2y-n-qQ3R.ZS4[/n/oQ4e/yS4h/{0WQ4l0QQ5|1nQ6u2|Q7g4WQ7k4]U7r4i4o4rQ7u4nQ8k5}S9f7h7iQ9j7oQ9r7wQ9s7xQ:V8lQ:m9gS:n9k9mQ:v9uQ;P:WS;X:o:sS;d;Y;ZS;l;e;gS;p;m;oQ;s;qQ;u;tQ=a=[Q=l=eR=m=fV!wQ'^-`%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS#wz!j!r=Z$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=a=r%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SQ%ej!^%wy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pS%}z!jQ+h%xQ,[&bW1n,],^,_,`U5}1o1p1qS8l6O6PQ:W8m!r=[$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ=e=qR=f=r%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SY#bWZ#W#Z(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ,i&m!p=]$Z$n)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=`'VU'Z!e%h*XR2k-Z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9S!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ,h&mQ0r+dQ3W.bQ7O3[R9Y7Q!b$Tc#Y%p(Q(W(r(w)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!P<U)[)o-U.w2c2f3h3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!f$Vc#Y%p(Q(W(r(w)U)V)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!T<W)[)o-U.w2c2f3h3n3o3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!^$Zc#Y%p(Q(W(r(w)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;xQ4V/fz=s)[)o-U.w2c2f3h3w4P6k7W7a7b8`8|9[9b9c:y;R=gQ=x=zR=y={'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS$oh$pR3|/P'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$kf$qQ$ifS)h$l)lR)t$qT$jf$qT)j$l)l'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$oh$pQ$rhR)s$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9S!s=q$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s#glOPXZst!Z!`!o#S#d#o#{$n%l&i&l&m&p&r&s&u&y'R'`(|)q*f+Y+d,k,n,s-d.b/Q/i0V0d1j1z1{1}2P2S2V2X3[3{4q5y6Z6[6_7Q8i8x!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}Q+P%`Q/^)|o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!U$yi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yQ*`$zU*i$|*X*lQ+Q%aQ0Q*j#f=c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n=d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YQ=h=tQ=i=uQ=j=vR=k=w!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YnoOXst!Z#d%l&p&r&s&u,n,s2S2VS*c${*WQ,|&|Q,}'OR4`/s%[%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q,P&ZQ1`,RQ5i1_R8]5jV*k$|*X*lU*k$|*X*lT5p1g5qS/y*f/iQ4n0VT7x4q:PQ+g%wQ0P*iQ0x+hQ1m,[Q5|1nQ8k5}Q:V8lR;P:W!U%Oi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yx*P$v)c*Q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=oS0Y*q0Z#f<a#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<b<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!d<t(s)a*Y*b.e.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={`<u3u7X7[7`9]:h:k;kS=P.g3aT=Q7Z9`!U%Qi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y|*R$v)c*S*q+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=oS0[*r0]#f<c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!h<v(s)a*Y*b.f.g.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={d<w3u7Y7Z7`9]9^:h:i:k;kS=R.h3bT=S7[9arnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ&d!UR,k&mrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR&d!UQ,T&[R1[+|snOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ1h,YS5w1k1lU8e5u5v5zS:R8g8hS:{:Q:TQ;_:|R;i;`Q&k!VR,d&gR6T1tR:Y8nS&P|&UR1T+sQ&p!WR,n&qR,t&vT2T,s2VR,x&wQ,w&wR2^,xQ'w!{R-t'wSsOtQ#dXT%os#dQ#OTR'y#OQ#RUR'{#RQ)y$uR/Z)yQ#UVR(O#UQ#XWU(U#X(V-{Q(V#YR-{(WQ-X'WR2j-XQ.p(wS3e.p3fR3f.qQ-`'^R2n-`Y!rQ'^-`1g5qR'h!rQ.{)cR3z.{U#_W%g*WU(]#_(^-|Q(^#`R-|(XQ-['ZR2l-[t`OXst!V!Z#d%l&g&i&p&r&s&u,n,s2S2VS#hZ%dU#r`#h.VR.V(hQ(i#jQ.S(eW.[(i.S3P6wQ3P.TR6w3QQ)l$lR/R)lQ$phR)r$pQ$`cU)_$`-w<[Q-w;xR<[)oQ/l*ZW4Y/l4Z7j9hU4Z/m/n/oS7j4[4]R9h7k$e*O$v(s)a)c*Y*b*q*r*|*}+R.g.h.j.k.l/Y/b/d/f/q/v0^0_0p1]3^3_3`3u3y4S4^4_4c4s4u4{4|4}5h7R7S7T7U7Z7[7^7_7`7f7m7p7z7}8P9]9^9_9i9q9v9w:h:i:j:k:l:q:u;W;];h;k=b=n=o=z={Q/t*bU4b/t4d7nQ4d/vR7n4cS*l$|*XR0S*lx*Q$v)c*q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=o!d.e(s)a*Y*b.g.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/c*Q.e7Xa7X3u7Z7[7`9]:h:k;kQ0Z*qQ3a.gU4t0Z3a9`R9`7Z|*S$v)c*q*r+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=o!h.f(s)a*Y*b.g.h.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/e*S.f7Ye7Y3u7Z7[7`9]9^:h:i:k;kQ0]*rQ3b.hU4v0]3b9aR9a7[Q*w%UR0a*wQ5S0pR8O5SQ+[%jR0o+[Q5l1bS8_5l:OR:O8`Q,V&]R1e,VQ5q1gR8b5qQ1s,aS6R1s8oR8o6TQ1O+oW5_1O5a8V9zQ5a1RQ8V5`R9z8WQ+t&PR1U+tQ2V,sR6c2VYrOXst#dQ&t!ZQ+^%lQ,m&pQ,o&rQ,p&sQ,r&uQ2Q,nS2T,s2VR6b2SQ%npQ&x!_Q&{!aQ&}!bQ'P!cQ'o!uQ+]%kQ+i%yQ+{&VQ,c&kQ,z&zW-k'i'q'r'uQ-r'mQ0R*kQ0y+jS1v,d,gQ2_,yQ2`,|Q2a,}Q2u-jW2w-m-n-q-sQ5W0zQ5d1XQ5g1]Q5{1mQ6V1xQ6a2RU6p2v2y2|Q6s2zQ8R5XQ8Z5fQ8[5hQ8a5pQ8j5|Q8p6US9P6q6uQ9R6tQ9{8XQ:U8kQ:Z8qQ:b9QQ:x9|Q;O:VQ;S:cR;a;PQ%yyQ'b!iQ'm!uU+j%z%{%|Q-R'TU-f'c'd'eS-j'i'sQ/z*gS0z+k+lQ2g-TS2s-g-hQ2z-oS4g/{0OQ5X0{Q6l2mQ6o2tQ6t2{U7q4i4j4mQ9o7sR:r9pS$wi=pR*x%VU%Ui%V=pR0`*vQ$viS(s#v+fS)a$b$cQ)c$dQ*Y$xS*b${*WQ*q%OQ*r%QQ*|%]Q*}%^Q+R%bQ.g<aQ.h<cQ.j<gQ.k<iQ.l<kQ/Y)wQ/b*PQ/d*RQ/f*TQ/q*^S/v*d/hQ0^*tQ0_*ul0p+c,Q.a1a1i3Z5x6|8f9V:S:f:};VQ1]+}Q3^<tQ3_<vQ3`<yS3u<^<_Q3y.zS4S/_4UQ4^/rQ4_/sQ4c/uQ4s0YQ4u0[Q4{0gQ4|0hQ4}0iQ5h1^Q7R<}Q7S=PQ7T=RQ7U=TQ7Z<bQ7[<dQ7^<hQ7_<jQ7`<lQ7f4VQ7m4aQ7p4fQ7z4wQ7}5RQ8P5UQ9]<zQ9^<uQ9_<wQ9i7lQ9q7vQ9v7|Q9w8QQ:h=OQ:i=QQ:j=SQ:k=UQ:l9eQ:q9nQ:u9tQ;W=XQ;]:tQ;h;^Q;k=YQ=b=pQ=n=xQ=o=yQ=z=|R={=}Q*z%[Q.i<eR7]<fnpOXst!Z#d%l&p&r&s&u,n,s2S2VQ!fPS#fZ#oQ&z!`W'f!o*f0V4qQ'}#SQ)O#{Q)p$nS,g&i&lQ,l&mQ,y&yS-O'R/iQ-b'`Q.s(|Q/V)qQ0m+YQ0s+dQ2O,kQ2q-dQ3X.bQ4O/QQ4y0dQ5v1jQ6X1zQ6Y1{Q6^1}Q6`2PQ6e2XQ7P3[Q7c3{Q8h5yQ8t6ZQ8u6[Q8w6_Q9Z7QQ:T8iR:_8x#[cOPXZst!Z!`!o#d#o#{%l&i&l&m&p&r&s&u&y'R'`(|*f+Y+d,k,n,s-d.b/i0V0d1j1z1{1}2P2S2V2X3[4q5y6Z6[6_7Q8i8xQ#YWQ#eYQ%puQ%rvS%tw!gS(Q#W(TQ(W#ZQ(r#uQ(w#xQ)P$OQ)Q$PQ)R$QQ)S$RQ)T$SQ)U$TQ)V$UQ)W$VQ)X$WQ)Y$XQ)[$ZQ)^$_Q)`$aQ)e$eW)o$n)q/Q3{Q+a%sQ+u&QS-U'V2hQ-s'pS-x(R-zQ-}(ZQ.P(bQ.n(vQ.q(xQ.u;vQ.w;yQ.x;zQ.y;}Q/]){Q0j+UQ2c-PQ2f-SQ2v-lQ2}.QQ3c.oQ3h<OQ3i<PQ3j<QQ3k<RQ3l<SQ3m<TQ3n<UQ3o<VQ3p<WQ3q<XQ3r<YQ3s.vQ3t<]Q3w<`Q3x<mQ4P<ZQ5O0lQ5Y0|Q6k<pQ6q2xQ6v3OQ7V3dQ7W<qQ7a<sQ7b<{Q8`5mQ8|6iQ9Q6rQ9[<|Q9b=VQ9c=WQ:c9SQ:y9}Q;R:aQ;x#SR=g=sR#[WR'X!el!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sS'T!e-WU*g$|*X*lS-T'U']S0O*h*nQ0W*oQ2m-^Q4m0UR4r0XR(y#xQ!fQT-_'^-`]!qQ!r'^-`1g5qQ#p]R'g;wR)d$dY!uQ'^-`1g5qQ'i!rS's!v!yS'u!z5sS-o'j'kQ-q'lR2{-pT#kZ%dS#jZ%dS%jm,jU(e#h#i#lS.T(f(gQ.X(hQ0n+ZQ3Q.UU3R.V.W.YS6x3S3TR9T6yd#^W#W#Z%g(R([*W+W.O/hr#gZm#h#i#l%d(f(g(h+Z.U.V.W.Y3S3T6yS*Z$x*_Q/o*[Q1|,jQ2d-QQ4W/kQ6g2[Q7i4XQ8{6hT=_'V+XV#aW%g*WU#`W%g*WS(S#W([U(X#Z+W/hS-V'V+XT-y(R.OV'[!e%h*XQ$lfR)v$qT)k$l)lR3}/PT*]$x*_T*e${*WQ0q+cQ1_,QQ3V.aQ5j1aQ5u1iQ6}3ZQ8g5xQ9W6|Q:Q8fQ:d9VQ:|:SQ;U:fQ;`:}R;c;VnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&j!VR,c&gtmOXst!U!V!Z#d%l&g&p&r&s&u,n,s2S2VR,j&mT%km,jR1c,SR,b&eQ&T|R+z&UR+p&OT&n!W&qT&o!W&qT2U,s2V",nodeNames:"⚠ ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies in CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:378,context:trackNewline,nodeProps:[["isolate",-8,5,6,14,35,37,49,51,53,""],["group",-26,9,17,19,66,206,210,214,215,217,220,223,233,235,241,243,245,247,250,256,262,264,266,268,270,272,273,"Statement",-34,13,14,30,33,34,40,49,52,53,55,60,68,70,74,78,80,82,83,108,109,118,119,135,138,140,141,142,143,144,146,147,166,168,170,"Expression",-23,29,31,35,39,41,43,172,174,176,177,179,180,181,183,184,185,187,188,189,200,202,204,205,"Type",-3,86,101,107,"ClassItem"],["openedBy",23,"<",36,"InterpolationStart",54,"[",58,"{",71,"(",159,"JSXStartCloseTag"],["closedBy",-2,24,167,">",38,"InterpolationEnd",48,"]",59,"}",72,")",164,"JSXEndTag"]],propSources:[jsHighlight],skippedNodes:[0,5,6,276],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$h&j(Up(X!b'z0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(V#S$h&j'{0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$h&j(Up(X!b'{0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$h&j!n),Q(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(T':f$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$h&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$c`$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$c``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$c`$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(X!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$c`(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$h&j(Up(X!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$h&j(Up(X!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$h&j(X!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$h&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(X!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$h&j(UpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(UpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Up(X!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$h&j(m%1l(Up(X!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$h&j(Up(X!b$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$h&j(Up(X!b$[#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$h&j(Up(X!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$h&j$P(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(x+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$h&j#y(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(W';W$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$h&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$c`$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(UpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$c`(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!j/.^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!i!Lf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$h&j(Up(X!b(S%&f#o(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$h&j(Up(X!b#l(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$h&j(Up(X!bp+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!Z+Jf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$h&j(Up(X!b!O.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_!Y!L^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$h&j(Up(X!b#m(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$h&j(X!b!V7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$h&j!V7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$h&j!V7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!V7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!V7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$h&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$h&j(X!b!V7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(X!b!V7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(X!b!V7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(X!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$h&j(X!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$h&j(Up!V7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$h&j(Up!V7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Up!V7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Up!V7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(UpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$h&j(UpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$h&j(Up(X!b!V7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Up(X!b!V7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Up(X!b!V7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Up(X!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$h&j(Up(X!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$h&j(Up(X!b'|0/l!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$h&j(Up(X!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$h&j(X!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$h&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(X!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$h&j(UpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(UpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Up(X!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$h&j$P(Ch(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Y#t$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!e$b$h&j#})Lv(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#P-<U(Up(X!b$m7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$j&j(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#p(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$P(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#q(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#^*!Y$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#i(Cl$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#q(Ch$e#|$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#q(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(p(Ct$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$h&j#z(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!z$Ip$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!Q0,v$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$h&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$h&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$h&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$h&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$h&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!W#)l$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#w(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$h&j(Up(X!b(_+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$h&j(Up(X!b(R,2j$^#t(c$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$h&j(Up(X!b$^#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!]#Hb(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(w+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_![(CdtBr$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!o7`$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$h&j(Up(X!b'z0/l$[#t(R,2j(c$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$h&j(Up(X!b'{0/l$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[noSemicolon,noSemicolonType,operatorToken,jsx,2,3,4,5,6,7,8,9,10,11,12,13,14,insertSemicolon,new LocalTokenGroup("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOv~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!S~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(a~~",141,338),new LocalTokenGroup("j~RQYZXz{^~^O(O~~aP!P!Qd~iO(P~~",25,321)],topRules:{Script:[0,7],SingleExpression:[1,274],SingleClassItem:[2,275]},dialects:{jsx:0,ts:15091},dynamicPrecedences:{78:1,80:1,92:1,168:1,198:1},specialized:[{term:325,get:e=>spec_identifier[e]||-1},{term:341,get:e=>spec_word[e]||-1},{term:93,get:e=>spec_LessThan[e]||-1}],tokenPrec:15116}),snippets=[snippetCompletion("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),snippetCompletion("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),snippetCompletion("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),snippetCompletion("do {\n\t${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),snippetCompletion("while (${}) {\n\t${}\n}",{label:"while",detail:"loop",type:"keyword"}),snippetCompletion("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"/ catch block",type:"keyword"}),snippetCompletion("if (${}) {\n\t${}\n}",{label:"if",detail:"block",type:"keyword"}),snippetCompletion("if (${}) {\n\t${}\n} else {\n\t${}\n}",{label:"if",detail:"/ else block",type:"keyword"}),snippetCompletion("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),snippetCompletion('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),snippetCompletion('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],typescriptSnippets=snippets.concat([snippetCompletion("interface ${name} {\n\t${}\n}",{label:"interface",detail:"definition",type:"keyword"}),snippetCompletion("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),snippetCompletion("enum ${name} {\n\t${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),cache=new NodeWeakMap,ScopeNodes=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function defID(e){return(t,n)=>{let i=t.node.getChild("VariableDefinition");return i&&n(i,e),!0}}const functionContext=["FunctionDeclaration"],gatherCompletions={FunctionDeclaration:defID("function"),ClassDeclaration:defID("class"),ClassExpression:()=>!0,EnumDeclaration:defID("constant"),TypeAliasDeclaration:defID("type"),NamespaceDeclaration:defID("namespace"),VariableDefinition(e,t){e.matchContext(functionContext)||t(e,"variable")},TypeDefinition(e,t){t(e,"type")},__proto__:null};function getScope(e,t){let n=cache.get(t);if(n)return n;let i=[],r=!0;function s(t,n){let r=e.sliceString(t.from,t.to);i.push({label:r,type:n})}return t.cursor(IterMode.IncludeAnonymous).iterate((t=>{if(r)r=!1;else if(t.name){let e=gatherCompletions[t.name];if(e&&e(t,s)||ScopeNodes.has(t.name))return!1}else if(t.to-t.from>8192){for(let n of getScope(e,t.node))i.push(n);return!1}})),cache.set(t,i),i}const Identifier=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,dontComplete=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName",".","?."];function localCompletionSource(e){let t=syntaxTree(e.state).resolveInner(e.pos,-1);if(dontComplete.indexOf(t.name)>-1)return null;let n="VariableName"==t.name||t.to-t.from<20&&Identifier.test(e.state.sliceDoc(t.from,t.to));if(!n&&!e.explicit)return null;let i=[];for(let n=t;n;n=n.parent)ScopeNodes.has(n.name)&&(i=i.concat(getScope(e.state.doc,n)));return{options:i,from:n?t.from:e.pos,validFor:Identifier}}const javascriptLanguage=LRLanguage.define({name:"javascript",parser:parser$1.configure({props:[indentNodeProp.add({IfStatement:continuedIndent({except:/^\s*({|else\b)/}),TryStatement:continuedIndent({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:flatIndent,SwitchBody:e=>{let t=e.textAfter,n=/^\s*\}/.test(t),i=/^\s*(case|default)\b/.test(t);return e.baseIndent+(n?0:i?1:2)*e.unit},Block:delimitedIndent({closing:"}"}),ArrowFunction:e=>e.baseIndent+e.unit,"TemplateString BlockComment":()=>null,"Statement Property":continuedIndent({except:/^{/}),JSXElement(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},JSXEscape(e){let t=/\s*\}/.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"JSXOpenTag JSXSelfClosingTag":e=>e.column(e.node.from)+e.unit}),foldNodeProp.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":foldInside,BlockComment:e=>({from:e.from+2,to:e.to-2})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),jsxSublanguage={test:e=>/^JSX/.test(e.name),facet:defineLanguageFacet({commentTokens:{block:{open:"{/*",close:"*/}"}}})},typescriptLanguage=javascriptLanguage.configure({dialect:"ts"},"typescript"),jsxLanguage=javascriptLanguage.configure({dialect:"jsx",props:[sublanguageProp.add((e=>e.isTop?[jsxSublanguage]:void 0))]}),tsxLanguage=javascriptLanguage.configure({dialect:"jsx ts",props:[sublanguageProp.add((e=>e.isTop?[jsxSublanguage]:void 0))]},"typescript");let kwCompletion=e=>({label:e,type:"keyword"});const keywords="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(kwCompletion),typescriptKeywords=keywords.concat(["declare","implements","private","protected","public"].map(kwCompletion));function javascript(e={}){let t=e.jsx?e.typescript?tsxLanguage:jsxLanguage:e.typescript?typescriptLanguage:javascriptLanguage,n=e.typescript?typescriptSnippets.concat(typescriptKeywords):snippets.concat(keywords);return new LanguageSupport(t,[javascriptLanguage.data.of({autocomplete:ifNotIn(dontComplete,completeFromList(n))}),javascriptLanguage.data.of({autocomplete:localCompletionSource}),e.jsx?autoCloseTags$1:[]])}function findOpenTag(e){for(;;){if("JSXOpenTag"==e.name||"JSXSelfClosingTag"==e.name||"JSXFragmentTag"==e.name)return e;if("JSXEscape"==e.name||!e.parent)return null;e=e.parent}}function elementName$1(e,t,n=e.length){for(let i=null==t?void 0:t.firstChild;i;i=i.nextSibling)if("JSXIdentifier"==i.name||"JSXBuiltin"==i.name||"JSXNamespacedName"==i.name||"JSXMemberExpression"==i.name)return e.sliceString(i.from,Math.min(i.to,n));return""}const android="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),autoCloseTags$1=EditorView.inputHandler.of(((e,t,n,i,r)=>{if((android?e.composing:e.compositionStarted)||e.state.readOnly||t!=n||">"!=i&&"/"!=i||!javascriptLanguage.isActiveAt(e.state,t,-1))return!1;let s=r(),{state:o}=s,a=o.changeByRange((e=>{var t;let n,{head:r}=e,s=syntaxTree(o).resolveInner(r-1,-1);if("JSXStartTag"==s.name&&(s=s.parent),o.doc.sliceString(r-1,r)!=i||"JSXAttributeValue"==s.name&&s.to>r);else{if(">"==i&&"JSXFragmentTag"==s.name)return{range:e,changes:{from:r,insert:"</>"}};if("/"==i&&"JSXStartCloseTag"==s.name){let e=s.parent,i=e.parent;if(i&&e.from==r-2&&((n=elementName$1(o.doc,i.firstChild,r))||"JSXFragmentTag"==(null===(t=i.firstChild)||void 0===t?void 0:t.name))){let e=n+">";return{range:EditorSelection.cursor(r+e.length,-1),changes:{from:r,insert:e}}}}else if(">"==i){let t=findOpenTag(s);if(t&&"JSXOpenTag"==t.name&&!/^\/?>|^<\//.test(o.doc.sliceString(r,r+2))&&(n=elementName$1(o.doc,t,r)))return{range:e,changes:{from:r,insert:"</"+n+">"}}}}return{range:e}}));return!a.changes.empty&&(e.dispatch([s,o.update(a,{userEvent:"input.complete",scrollIntoView:!0})]),!0)})),Targets=["_blank","_self","_top","_parent"],Charsets=["ascii","utf-8","utf-16","latin1","latin1"],Methods=["get","post","put","delete"],Encs=["application/x-www-form-urlencoded","multipart/form-data","text/plain"],Bool=["true","false"],S={},Tags={a:{attrs:{href:null,ping:null,type:null,media:null,target:Targets,hreflang:null}},abbr:S,address:S,area:{attrs:{alt:null,coords:null,href:null,target:null,ping:null,media:null,hreflang:null,type:null,shape:["default","rect","circle","poly"]}},article:S,aside:S,audio:{attrs:{src:null,mediagroup:null,crossorigin:["anonymous","use-credentials"],preload:["none","metadata","auto"],autoplay:["autoplay"],loop:["loop"],controls:["controls"]}},b:S,base:{attrs:{href:null,target:Targets}},bdi:S,bdo:S,blockquote:{attrs:{cite:null}},body:S,br:S,button:{attrs:{form:null,formaction:null,name:null,value:null,autofocus:["autofocus"],disabled:["autofocus"],formenctype:Encs,formmethod:Methods,formnovalidate:["novalidate"],formtarget:Targets,type:["submit","reset","button"]}},canvas:{attrs:{width:null,height:null}},caption:S,center:S,cite:S,code:S,col:{attrs:{span:null}},colgroup:{attrs:{span:null}},command:{attrs:{type:["command","checkbox","radio"],label:null,icon:null,radiogroup:null,command:null,title:null,disabled:["disabled"],checked:["checked"]}},data:{attrs:{value:null}},datagrid:{attrs:{disabled:["disabled"],multiple:["multiple"]}},datalist:{attrs:{data:null}},dd:S,del:{attrs:{cite:null,datetime:null}},details:{attrs:{open:["open"]}},dfn:S,div:S,dl:S,dt:S,em:S,embed:{attrs:{src:null,type:null,width:null,height:null}},eventsource:{attrs:{src:null}},fieldset:{attrs:{disabled:["disabled"],form:null,name:null}},figcaption:S,figure:S,footer:S,form:{attrs:{action:null,name:null,"accept-charset":Charsets,autocomplete:["on","off"],enctype:Encs,method:Methods,novalidate:["novalidate"],target:Targets}},h1:S,h2:S,h3:S,h4:S,h5:S,h6:S,head:{children:["title","base","link","style","meta","script","noscript","command"]},header:S,hgroup:S,hr:S,html:{attrs:{manifest:null}},i:S,iframe:{attrs:{src:null,srcdoc:null,name:null,width:null,height:null,sandbox:["allow-top-navigation","allow-same-origin","allow-forms","allow-scripts"],seamless:["seamless"]}},img:{attrs:{alt:null,src:null,ismap:null,usemap:null,width:null,height:null,crossorigin:["anonymous","use-credentials"]}},input:{attrs:{alt:null,dirname:null,form:null,formaction:null,height:null,list:null,max:null,maxlength:null,min:null,name:null,pattern:null,placeholder:null,size:null,src:null,step:null,value:null,width:null,accept:["audio/*","video/*","image/*"],autocomplete:["on","off"],autofocus:["autofocus"],checked:["checked"],disabled:["disabled"],formenctype:Encs,formmethod:Methods,formnovalidate:["novalidate"],formtarget:Targets,multiple:["multiple"],readonly:["readonly"],required:["required"],type:["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","number","range","color","checkbox","radio","file","submit","image","reset","button"]}},ins:{attrs:{cite:null,datetime:null}},kbd:S,keygen:{attrs:{challenge:null,form:null,name:null,autofocus:["autofocus"],disabled:["disabled"],keytype:["RSA"]}},label:{attrs:{for:null,form:null}},legend:S,li:{attrs:{value:null}},link:{attrs:{href:null,type:null,hreflang:null,media:null,sizes:["all","16x16","16x16 32x32","16x16 32x32 64x64"]}},map:{attrs:{name:null}},mark:S,menu:{attrs:{label:null,type:["list","context","toolbar"]}},meta:{attrs:{content:null,charset:Charsets,name:["viewport","application-name","author","description","generator","keywords"],"http-equiv":["content-language","content-type","default-style","refresh"]}},meter:{attrs:{value:null,min:null,low:null,high:null,max:null,optimum:null}},nav:S,noscript:S,object:{attrs:{data:null,type:null,name:null,usemap:null,form:null,width:null,height:null,typemustmatch:["typemustmatch"]}},ol:{attrs:{reversed:["reversed"],start:null,type:["1","a","A","i","I"]},children:["li","script","template","ul","ol"]},optgroup:{attrs:{disabled:["disabled"],label:null}},option:{attrs:{disabled:["disabled"],label:null,selected:["selected"],value:null}},output:{attrs:{for:null,form:null,name:null}},p:S,param:{attrs:{name:null,value:null}},pre:S,progress:{attrs:{value:null,max:null}},q:{attrs:{cite:null}},rp:S,rt:S,ruby:S,samp:S,script:{attrs:{type:["text/javascript"],src:null,async:["async"],defer:["defer"],charset:Charsets}},section:S,select:{attrs:{form:null,name:null,size:null,autofocus:["autofocus"],disabled:["disabled"],multiple:["multiple"]}},slot:{attrs:{name:null}},small:S,source:{attrs:{src:null,type:null,media:null}},span:S,strong:S,style:{attrs:{type:["text/css"],media:null,scoped:null}},sub:S,summary:S,sup:S,table:S,tbody:S,td:{attrs:{colspan:null,rowspan:null,headers:null}},template:S,textarea:{attrs:{dirname:null,form:null,maxlength:null,name:null,placeholder:null,rows:null,cols:null,autofocus:["autofocus"],disabled:["disabled"],readonly:["readonly"],required:["required"],wrap:["soft","hard"]}},tfoot:S,th:{attrs:{colspan:null,rowspan:null,headers:null,scope:["row","col","rowgroup","colgroup"]}},thead:S,time:{attrs:{datetime:null}},title:S,tr:S,track:{attrs:{src:null,label:null,default:null,kind:["subtitles","captions","descriptions","chapters","metadata"],srclang:null}},ul:{children:["li","script","template","ul","ol"]},var:S,video:{attrs:{src:null,poster:null,width:null,height:null,crossorigin:["anonymous","use-credentials"],preload:["auto","metadata","none"],autoplay:["autoplay"],mediagroup:["movie"],muted:["muted"],controls:["controls"]}},wbr:S},GlobalAttrs={accesskey:null,class:null,contenteditable:Bool,contextmenu:null,dir:["ltr","rtl","auto"],draggable:["true","false","auto"],dropzone:["copy","move","link","string:","file:"],hidden:["hidden"],id:null,inert:["inert"],itemid:null,itemprop:null,itemref:null,itemscope:["itemscope"],itemtype:null,lang:["ar","bn","de","en-GB","en-US","es","fr","hi","id","ja","pa","pt","ru","tr","zh"],spellcheck:Bool,autocorrect:Bool,autocapitalize:Bool,style:null,tabindex:null,title:null,translate:["yes","no"],rel:["stylesheet","alternate","author","bookmark","help","license","next","nofollow","noreferrer","prefetch","prev","search","tag"],role:"alert application article banner button cell checkbox complementary contentinfo dialog document feed figure form grid gridcell heading img list listbox listitem main navigation region row rowgroup search switch tab table tabpanel textbox timer".split(" "),"aria-activedescendant":null,"aria-atomic":Bool,"aria-autocomplete":["inline","list","both","none"],"aria-busy":Bool,"aria-checked":["true","false","mixed","undefined"],"aria-controls":null,"aria-describedby":null,"aria-disabled":Bool,"aria-dropeffect":null,"aria-expanded":["true","false","undefined"],"aria-flowto":null,"aria-grabbed":["true","false","undefined"],"aria-haspopup":Bool,"aria-hidden":Bool,"aria-invalid":["true","false","grammar","spelling"],"aria-label":null,"aria-labelledby":null,"aria-level":null,"aria-live":["off","polite","assertive"],"aria-multiline":Bool,"aria-multiselectable":Bool,"aria-owns":null,"aria-posinset":null,"aria-pressed":["true","false","mixed","undefined"],"aria-readonly":Bool,"aria-relevant":null,"aria-required":Bool,"aria-selected":["true","false","undefined"],"aria-setsize":null,"aria-sort":["ascending","descending","none","other"],"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null,"aria-valuetext":null},eventAttributes="beforeunload copy cut dragstart dragover dragleave dragenter dragend drag paste focus blur change click load mousedown mouseenter mouseleave mouseup keydown keyup resize scroll unload".split(" ").map((e=>"on"+e));for(let e of eventAttributes)GlobalAttrs[e]=null;class Schema{constructor(e,t){this.tags=Object.assign(Object.assign({},Tags),e),this.globalAttrs=Object.assign(Object.assign({},GlobalAttrs),t),this.allTags=Object.keys(this.tags),this.globalAttrNames=Object.keys(this.globalAttrs)}}function elementName(e,t,n=e.length){if(!t)return"";let i=t.firstChild,r=i&&i.getChild("TagName");return r?e.sliceString(r.from,Math.min(r.to,n)):""}function findParentElement(e,t=!1){for(;e;e=e.parent)if("Element"==e.name){if(!t)return e;t=!1}return null}function allowedChildren(e,t,n){let i=n.tags[elementName(e,findParentElement(t))];return(null==i?void 0:i.children)||n.allTags}function openTags(e,t){let n=[];for(let i=findParentElement(t);i&&!i.type.isTop;i=findParentElement(i.parent)){let r=elementName(e,i);if(r&&"CloseTag"==i.lastChild.name)break;r&&n.indexOf(r)<0&&("EndTag"==t.name||t.from>=i.firstChild.to)&&n.push(r)}return n}Schema.default=new Schema;const identifier=/^[:\-\.\w\u00b7-\uffff]*$/;function completeTag(e,t,n,i,r){let s=/\s*>/.test(e.sliceDoc(r,r+5))?"":">",o=findParentElement(n,!0);return{from:i,to:r,options:allowedChildren(e.doc,o,t).map((e=>({label:e,type:"type"}))).concat(openTags(e.doc,n).map(((e,t)=>({label:"/"+e,apply:"/"+e+s,type:"type",boost:99-t})))),validFor:/^\/?[:\-\.\w\u00b7-\uffff]*$/}}function completeCloseTag(e,t,n,i){let r=/\s*>/.test(e.sliceDoc(i,i+5))?"":">";return{from:n,to:i,options:openTags(e.doc,t).map(((e,t)=>({label:e,apply:e+r,type:"type",boost:99-t}))),validFor:identifier}}function completeStartTag(e,t,n,i){let r=[],s=0;for(let i of allowedChildren(e.doc,n,t))r.push({label:"<"+i,type:"type"});for(let t of openTags(e.doc,n))r.push({label:"</"+t+">",type:"type",boost:99-s++});return{from:i,to:i,options:r,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}function completeAttrName(e,t,n,i,r){let s=findParentElement(n),o=s?t.tags[elementName(e.doc,s)]:null,a=o&&o.attrs?Object.keys(o.attrs):[];return{from:i,to:r,options:(o&&!1===o.globalAttrs?a:a.length?a.concat(t.globalAttrNames):t.globalAttrNames).map((e=>({label:e,type:"property"}))),validFor:identifier}}function completeAttrValue(e,t,n,i,r){var s;let o,a=null===(s=n.parent)||void 0===s?void 0:s.getChild("AttributeName"),l=[];if(a){let s=e.sliceDoc(a.from,a.to),c=t.globalAttrs[s];if(!c){let i=findParentElement(n),r=i?t.tags[elementName(e.doc,i)]:null;c=(null==r?void 0:r.attrs)&&r.attrs[s]}if(c){let t=e.sliceDoc(i,r).toLowerCase(),n='"',s='"';/^['"]/.test(t)?(o='"'==t[0]?/^[^"]*$/:/^[^']*$/,n="",s=e.sliceDoc(r,r+1)==t[0]?"":t[0],t=t.slice(1),i++):o=/^[^\s<>='"]*$/;for(let e of c)l.push({label:e,apply:n+e+s,type:"constant"})}}return{from:i,to:r,options:l,validFor:o}}function htmlCompletionFor(e,t){let{state:n,pos:i}=t,r=syntaxTree(n).resolveInner(i,-1),s=r.resolve(i);for(let e,t=i;s==r&&(e=r.childBefore(t));){let n=e.lastChild;if(!n||!n.type.isError||n.from<n.to)break;s=r=e,t=n.from}return"TagName"==r.name?r.parent&&/CloseTag$/.test(r.parent.name)?completeCloseTag(n,r,r.from,i):completeTag(n,e,r,r.from,i):"StartTag"==r.name?completeTag(n,e,r,i,i):"StartCloseTag"==r.name||"IncompleteCloseTag"==r.name?completeCloseTag(n,r,i,i):"OpenTag"==r.name||"SelfClosingTag"==r.name||"AttributeName"==r.name?completeAttrName(n,e,r,"AttributeName"==r.name?r.from:i,i):"Is"==r.name||"AttributeValue"==r.name||"UnquotedAttributeValue"==r.name?completeAttrValue(n,e,r,"Is"==r.name?i:r.from,i):!t.explicit||"Element"!=s.name&&"Text"!=s.name&&"Document"!=s.name?null:completeStartTag(n,e,r,i)}function htmlCompletionSource(e){return htmlCompletionFor(Schema.default,e)}function htmlCompletionSourceWith(e){let{extraTags:t,extraGlobalAttributes:n}=e,i=n||t?new Schema(t,n):Schema.default;return e=>htmlCompletionFor(i,e)}const jsonParser=javascriptLanguage.parser.configure({top:"SingleExpression"}),defaultNesting=[{tag:"script",attrs:e=>"text/typescript"==e.type||"ts"==e.lang,parser:typescriptLanguage.parser},{tag:"script",attrs:e=>"text/babel"==e.type||"text/jsx"==e.type,parser:jsxLanguage.parser},{tag:"script",attrs:e=>"text/typescript-jsx"==e.type,parser:tsxLanguage.parser},{tag:"script",attrs:e=>/^(importmap|speculationrules|application\/(.+\+)?json)$/i.test(e.type),parser:jsonParser},{tag:"script",attrs:e=>!e.type||/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i.test(e.type),parser:javascriptLanguage.parser},{tag:"style",attrs:e=>(!e.lang||"css"==e.lang)&&(!e.type||/^(text\/)?(x-)?(stylesheet|css)$/i.test(e.type)),parser:cssLanguage.parser}],defaultAttrs=[{name:"style",parser:cssLanguage.parser.configure({top:"Styles"})}].concat(eventAttributes.map((e=>({name:e,parser:javascriptLanguage.parser})))),htmlPlain=LRLanguage.define({name:"html",parser:parser$3.configure({props:[indentNodeProp.add({Element(e){let t=/^(\s*)(<\/)?/.exec(e.textAfter);return e.node.to<=e.pos+t[0].length?e.continue():e.lineIndent(e.node.from)+(t[2]?0:e.unit)},"OpenTag CloseTag SelfClosingTag":e=>e.column(e.node.from)+e.unit,Document(e){if(e.pos+/\s*/.exec(e.textAfter)[0].length<e.node.to)return e.continue();let t,n=null;for(let t=e.node;;){let e=t.lastChild;if(!e||"Element"!=e.name||e.to!=t.to)break;n=t=e}return n&&(!(t=n.lastChild)||"CloseTag"!=t.name&&"SelfClosingTag"!=t.name)?e.lineIndent(n.from)+e.unit:null}}),foldNodeProp.add({Element(e){let t=e.firstChild,n=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==n.name?n.from:e.to}:null}}),bracketMatchingHandle.add({"OpenTag CloseTag":e=>e.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/\w+\W$/,wordChars:"-._"}}),htmlLanguage=htmlPlain.configure({wrap:configureNesting(defaultNesting,defaultAttrs)});function html(e={}){let t,n="";!1===e.matchClosingTags&&(n="noMatch"),!0===e.selfClosingTags&&(n=(n?n+" ":"")+"selfClosing"),(e.nestedLanguages&&e.nestedLanguages.length||e.nestedAttributes&&e.nestedAttributes.length)&&(t=configureNesting((e.nestedLanguages||[]).concat(defaultNesting),(e.nestedAttributes||[]).concat(defaultAttrs)));let i=t?htmlPlain.configure({wrap:t,dialect:n}):n?htmlLanguage.configure({dialect:n}):htmlLanguage;return new LanguageSupport(i,[htmlLanguage.data.of({autocomplete:htmlCompletionSourceWith(e)}),!1!==e.autoCloseTags?autoCloseTags:[],javascript().support,css().support])}const selfClosers=new Set("area base br col command embed frame hr img input keygen link meta param source track wbr menuitem".split(" ")),autoCloseTags=EditorView.inputHandler.of(((e,t,n,i,r)=>{if(e.composing||e.state.readOnly||t!=n||">"!=i&&"/"!=i||!htmlLanguage.isActiveAt(e.state,t,-1))return!1;let s=r(),{state:o}=s,a=o.changeByRange((e=>{var t,n,r;let s,a=o.doc.sliceString(e.from-1,e.to)==i,{head:l}=e,c=syntaxTree(o).resolveInner(l,-1);if(a&&">"==i&&"EndTag"==c.name){let i=c.parent;if("CloseTag"!=(null===(n=null===(t=i.parent)||void 0===t?void 0:t.lastChild)||void 0===n?void 0:n.name)&&(s=elementName(o.doc,i.parent,l))&&!selfClosers.has(s))return{range:e,changes:{from:l,to:l+(">"===o.doc.sliceString(l,l+1)?1:0),insert:"</"+s+">"}}}else if(a&&"/"==i&&"IncompleteCloseTag"==c.name){let e=c.parent;if(c.from==l-2&&"CloseTag"!=(null===(r=e.lastChild)||void 0===r?void 0:r.name)&&(s=elementName(o.doc,e,l))&&!selfClosers.has(s)){let e=l+(">"===o.doc.sliceString(l,l+1)?1:0),t=s+">";return{range:EditorSelection.cursor(l+t.length,-1),changes:{from:l,to:e,insert:t}}}}return{range:e}}));return!a.changes.empty&&(e.dispatch([s,o.update(a,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}));class CompositeBlock{static create(e,t,n,i,r){return new CompositeBlock(e,t,n,i+(i<<8)+e+(t<<4)|0,r,[],[])}constructor(e,t,n,i,r,s,o){this.type=e,this.value=t,this.from=n,this.hash=i,this.end=r,this.children=s,this.positions=o,this.hashProp=[[NodeProp.contextHash,i]]}addChild(e,t){e.prop(NodeProp.contextHash)!=this.hash&&(e=new Tree(e.type,e.children,e.positions,e.length,this.hashProp)),this.children.push(e),this.positions.push(t)}toTree(e,t=this.end){let n=this.children.length-1;return n>=0&&(t=Math.max(t,this.positions[n]+this.children[n].length+this.from)),new Tree(e.types[this.type],this.children,this.positions,t-this.from).balance({makeTree:(e,t,n)=>new Tree(NodeType.none,e,t,n,this.hashProp)})}}var Type;!function(e){e[e.Document=1]="Document",e[e.CodeBlock=2]="CodeBlock",e[e.FencedCode=3]="FencedCode",e[e.Blockquote=4]="Blockquote",e[e.HorizontalRule=5]="HorizontalRule",e[e.BulletList=6]="BulletList",e[e.OrderedList=7]="OrderedList",e[e.ListItem=8]="ListItem",e[e.ATXHeading1=9]="ATXHeading1",e[e.ATXHeading2=10]="ATXHeading2",e[e.ATXHeading3=11]="ATXHeading3",e[e.ATXHeading4=12]="ATXHeading4",e[e.ATXHeading5=13]="ATXHeading5",e[e.ATXHeading6=14]="ATXHeading6",e[e.SetextHeading1=15]="SetextHeading1",e[e.SetextHeading2=16]="SetextHeading2",e[e.HTMLBlock=17]="HTMLBlock",e[e.LinkReference=18]="LinkReference",e[e.Paragraph=19]="Paragraph",e[e.CommentBlock=20]="CommentBlock",e[e.ProcessingInstructionBlock=21]="ProcessingInstructionBlock",e[e.Escape=22]="Escape",e[e.Entity=23]="Entity",e[e.HardBreak=24]="HardBreak",e[e.Emphasis=25]="Emphasis",e[e.StrongEmphasis=26]="StrongEmphasis",e[e.Link=27]="Link",e[e.Image=28]="Image",e[e.InlineCode=29]="InlineCode",e[e.HTMLTag=30]="HTMLTag",e[e.Comment=31]="Comment",e[e.ProcessingInstruction=32]="ProcessingInstruction",e[e.Autolink=33]="Autolink",e[e.HeaderMark=34]="HeaderMark",e[e.QuoteMark=35]="QuoteMark",e[e.ListMark=36]="ListMark",e[e.LinkMark=37]="LinkMark",e[e.EmphasisMark=38]="EmphasisMark",e[e.CodeMark=39]="CodeMark",e[e.CodeText=40]="CodeText",e[e.CodeInfo=41]="CodeInfo",e[e.LinkTitle=42]="LinkTitle",e[e.LinkLabel=43]="LinkLabel",e[e.URL=44]="URL"}(Type||(Type={}));class LeafBlock{constructor(e,t){this.start=e,this.content=t,this.marks=[],this.parsers=[]}}class Line{constructor(){this.text="",this.baseIndent=0,this.basePos=0,this.depth=0,this.markers=[],this.pos=0,this.indent=0,this.next=-1}forward(){this.basePos>this.pos&&this.forwardInner()}forwardInner(){let e=this.skipSpace(this.basePos);this.indent=this.countIndent(e,this.pos,this.indent),this.pos=e,this.next=e==this.text.length?-1:this.text.charCodeAt(e)}skipSpace(e){return skipSpace(this.text,e)}reset(e){for(this.text=e,this.baseIndent=this.basePos=this.pos=this.indent=0,this.forwardInner(),this.depth=1;this.markers.length;)this.markers.pop()}moveBase(e){this.basePos=e,this.baseIndent=this.countIndent(e,this.pos,this.indent)}moveBaseColumn(e){this.baseIndent=e,this.basePos=this.findColumn(e)}addMarker(e){this.markers.push(e)}countIndent(e,t=0,n=0){for(let i=t;i<e;i++)n+=9==this.text.charCodeAt(i)?4-n%4:1;return n}findColumn(e){let t=0;for(let n=0;t<this.text.length&&n<e;t++)n+=9==this.text.charCodeAt(t)?4-n%4:1;return t}scrub(){if(!this.baseIndent)return this.text;let e="";for(let t=0;t<this.basePos;t++)e+=" ";return e+this.text.slice(this.basePos)}}function skipForList(e,t,n){if(n.pos==n.text.length||e!=t.block&&n.indent>=t.stack[n.depth+1].value+n.baseIndent)return!0;if(n.indent>=n.baseIndent+4)return!1;let i=(e.type==Type.OrderedList?isOrderedList:isBulletList)(n,t,!1);return i>0&&(e.type!=Type.BulletList||isHorizontalRule(n,t,!1)<0)&&n.text.charCodeAt(n.pos+i-1)==e.value}const DefaultSkipMarkup={[Type.Blockquote]:(e,t,n)=>62==n.next&&(n.markers.push(elt(Type.QuoteMark,t.lineStart+n.pos,t.lineStart+n.pos+1)),n.moveBase(n.pos+(space(n.text.charCodeAt(n.pos+1))?2:1)),e.end=t.lineStart+n.text.length,!0),[Type.ListItem]:(e,t,n)=>!(n.indent<n.baseIndent+e.value&&n.next>-1||(n.moveBaseColumn(n.baseIndent+e.value),0)),[Type.OrderedList]:skipForList,[Type.BulletList]:skipForList,[Type.Document]:()=>!0};function space(e){return 32==e||9==e||10==e||13==e}function skipSpace(e,t=0){for(;t<e.length&&space(e.charCodeAt(t));)t++;return t}function skipSpaceBack(e,t,n){for(;t>n&&space(e.charCodeAt(t-1));)t--;return t}function isFencedCode(e){if(96!=e.next&&126!=e.next)return-1;let t=e.pos+1;for(;t<e.text.length&&e.text.charCodeAt(t)==e.next;)t++;if(t<e.pos+3)return-1;if(96==e.next)for(let n=t;n<e.text.length;n++)if(96==e.text.charCodeAt(n))return-1;return t}function isBlockquote(e){return 62!=e.next?-1:32==e.text.charCodeAt(e.pos+1)?2:1}function isHorizontalRule(e,t,n){if(42!=e.next&&45!=e.next&&95!=e.next)return-1;let i=1;for(let t=e.pos+1;t<e.text.length;t++){let n=e.text.charCodeAt(t);if(n==e.next)i++;else if(!space(n))return-1}return n&&45==e.next&&isSetextUnderline(e)>-1&&e.depth==t.stack.length&&t.parser.leafBlockParsers.indexOf(DefaultLeafBlocks.SetextHeading)>-1||i<3?-1:1}function inList(e,t){for(let n=e.stack.length-1;n>=0;n--)if(e.stack[n].type==t)return!0;return!1}function isBulletList(e,t,n){return 45!=e.next&&43!=e.next&&42!=e.next||e.pos!=e.text.length-1&&!space(e.text.charCodeAt(e.pos+1))||!(!n||inList(t,Type.BulletList)||e.skipSpace(e.pos+2)<e.text.length)?-1:1}function isOrderedList(e,t,n){let i=e.pos,r=e.next;for(;r>=48&&r<=57;){if(i++,i==e.text.length)return-1;r=e.text.charCodeAt(i)}return i==e.pos||i>e.pos+9||46!=r&&41!=r||i<e.text.length-1&&!space(e.text.charCodeAt(i+1))||n&&!inList(t,Type.OrderedList)&&(e.skipSpace(i+1)==e.text.length||i>e.pos+1||49!=e.next)?-1:i+1-e.pos}function isAtxHeading(e){if(35!=e.next)return-1;let t=e.pos+1;for(;t<e.text.length&&35==e.text.charCodeAt(t);)t++;if(t<e.text.length&&32!=e.text.charCodeAt(t))return-1;let n=t-e.pos;return n>6?-1:n}function isSetextUnderline(e){if(45!=e.next&&61!=e.next||e.indent>=e.baseIndent+4)return-1;let t=e.pos+1;for(;t<e.text.length&&e.text.charCodeAt(t)==e.next;)t++;let n=t;for(;t<e.text.length&&space(e.text.charCodeAt(t));)t++;return t==e.text.length?n:-1}const EmptyLine=/^[ \t]*$/,CommentEnd=/-->/,ProcessingEnd=/\?>/,HTMLBlockStyle=[[/^<(?:script|pre|style)(?:\s|>|$)/i,/<\/(?:script|pre|style)>/i],[/^\s*<!--/,CommentEnd],[/^\s*<\?/,ProcessingEnd],[/^\s*<![A-Z]/,/>/],[/^\s*<!\[CDATA\[/,/\]\]>/],[/^\s*<\/?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|\/?>|$)/i,EmptyLine],[/^\s*(?:<\/[a-z][\w-]*\s*>|<[a-z][\w-]*(\s+[a-z:_][\w-.]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*>)\s*$/i,EmptyLine]];function isHTMLBlock(e,t,n){if(60!=e.next)return-1;let i=e.text.slice(e.pos);for(let e=0,t=HTMLBlockStyle.length-(n?1:0);e<t;e++)if(HTMLBlockStyle[e][0].test(i))return e;return-1}function getListIndent(e,t){let n=e.countIndent(t,e.pos,e.indent),i=e.countIndent(e.skipSpace(t),t,n);return i>=n+5?n+1:i}function addCodeText(e,t,n){let i=e.length-1;i>=0&&e[i].to==t&&e[i].type==Type.CodeText?e[i].to=n:e.push(elt(Type.CodeText,t,n))}const DefaultBlockParsers={LinkReference:void 0,IndentedCode(e,t){let n=t.baseIndent+4;if(t.indent<n)return!1;let i=t.findColumn(n),r=e.lineStart+i,s=e.lineStart+t.text.length,o=[],a=[];for(addCodeText(o,r,s);e.nextLine()&&t.depth>=e.stack.length;)if(t.pos==t.text.length){addCodeText(a,e.lineStart-1,e.lineStart);for(let e of t.markers)a.push(e)}else{if(t.indent<n)break;{if(a.length){for(let e of a)e.type==Type.CodeText?addCodeText(o,e.from,e.to):o.push(e);a=[]}addCodeText(o,e.lineStart-1,e.lineStart);for(let e of t.markers)o.push(e);s=e.lineStart+t.text.length;let n=e.lineStart+t.findColumn(t.baseIndent+4);n<s&&addCodeText(o,n,s)}}return a.length&&(a=a.filter((e=>e.type!=Type.CodeText)),a.length&&(t.markers=a.concat(t.markers))),e.addNode(e.buffer.writeElements(o,-r).finish(Type.CodeBlock,s-r),r),!0},FencedCode(e,t){let n=isFencedCode(t);if(n<0)return!1;let i=e.lineStart+t.pos,r=t.next,s=n-t.pos,o=t.skipSpace(n),a=skipSpaceBack(t.text,t.text.length,o),l=[elt(Type.CodeMark,i,i+s)];o<a&&l.push(elt(Type.CodeInfo,e.lineStart+o,e.lineStart+a));for(let n=!0;e.nextLine()&&t.depth>=e.stack.length;n=!1){let i=t.pos;if(t.indent-t.baseIndent<4)for(;i<t.text.length&&t.text.charCodeAt(i)==r;)i++;if(i-t.pos>=s&&t.skipSpace(i)==t.text.length){for(let e of t.markers)l.push(e);l.push(elt(Type.CodeMark,e.lineStart+t.pos,e.lineStart+i)),e.nextLine();break}{n||addCodeText(l,e.lineStart-1,e.lineStart);for(let e of t.markers)l.push(e);let i=e.lineStart+t.basePos,r=e.lineStart+t.text.length;i<r&&addCodeText(l,i,r)}}return e.addNode(e.buffer.writeElements(l,-i).finish(Type.FencedCode,e.prevLineEnd()-i),i),!0},Blockquote(e,t){let n=isBlockquote(t);return!(n<0)&&(e.startContext(Type.Blockquote,t.pos),e.addNode(Type.QuoteMark,e.lineStart+t.pos,e.lineStart+t.pos+1),t.moveBase(t.pos+n),null)},HorizontalRule(e,t){if(isHorizontalRule(t,e,!1)<0)return!1;let n=e.lineStart+t.pos;return e.nextLine(),e.addNode(Type.HorizontalRule,n),!0},BulletList(e,t){let n=isBulletList(t,e,!1);if(n<0)return!1;e.block.type!=Type.BulletList&&e.startContext(Type.BulletList,t.basePos,t.next);let i=getListIndent(t,t.pos+1);return e.startContext(Type.ListItem,t.basePos,i-t.baseIndent),e.addNode(Type.ListMark,e.lineStart+t.pos,e.lineStart+t.pos+n),t.moveBaseColumn(i),null},OrderedList(e,t){let n=isOrderedList(t,e,!1);if(n<0)return!1;e.block.type!=Type.OrderedList&&e.startContext(Type.OrderedList,t.basePos,t.text.charCodeAt(t.pos+n-1));let i=getListIndent(t,t.pos+n);return e.startContext(Type.ListItem,t.basePos,i-t.baseIndent),e.addNode(Type.ListMark,e.lineStart+t.pos,e.lineStart+t.pos+n),t.moveBaseColumn(i),null},ATXHeading(e,t){let n=isAtxHeading(t);if(n<0)return!1;let i=t.pos,r=e.lineStart+i,s=skipSpaceBack(t.text,t.text.length,i),o=s;for(;o>i&&t.text.charCodeAt(o-1)==t.next;)o--;o!=s&&o!=i&&space(t.text.charCodeAt(o-1))||(o=t.text.length);let a=e.buffer.write(Type.HeaderMark,0,n).writeElements(e.parser.parseInline(t.text.slice(i+n+1,o),r+n+1),-r);o<t.text.length&&a.write(Type.HeaderMark,o-i,s-i);let l=a.finish(Type.ATXHeading1-1+n,t.text.length-i);return e.nextLine(),e.addNode(l,r),!0},HTMLBlock(e,t){let n=isHTMLBlock(t,e,!1);if(n<0)return!1;let i=e.lineStart+t.pos,r=HTMLBlockStyle[n][1],s=[],o=r!=EmptyLine;for(;!r.test(t.text)&&e.nextLine();){if(t.depth<e.stack.length){o=!1;break}for(let e of t.markers)s.push(e)}o&&e.nextLine();let a=r==CommentEnd?Type.CommentBlock:r==ProcessingEnd?Type.ProcessingInstructionBlock:Type.HTMLBlock,l=e.prevLineEnd();return e.addNode(e.buffer.writeElements(s,-i).finish(a,l-i),i),!0},SetextHeading:void 0};class LinkReferenceParser{constructor(e){this.stage=0,this.elts=[],this.pos=0,this.start=e.start,this.advance(e.content)}nextLine(e,t,n){if(-1==this.stage)return!1;let i=n.content+"\n"+t.scrub(),r=this.advance(i);return r>-1&&r<i.length&&this.complete(e,n,r)}finish(e,t){return(2==this.stage||3==this.stage)&&skipSpace(t.content,this.pos)==t.content.length&&this.complete(e,t,t.content.length)}complete(e,t,n){return e.addLeafElement(t,elt(Type.LinkReference,this.start,this.start+n,this.elts)),!0}nextStage(e){return e?(this.pos=e.to-this.start,this.elts.push(e),this.stage++,!0):(!1===e&&(this.stage=-1),!1)}advance(e){for(;;){if(-1==this.stage)return-1;if(0==this.stage){if(!this.nextStage(parseLinkLabel(e,this.pos,this.start,!0)))return-1;if(58!=e.charCodeAt(this.pos))return this.stage=-1;this.elts.push(elt(Type.LinkMark,this.pos+this.start,this.pos+this.start+1)),this.pos++}else{if(1!=this.stage){if(2==this.stage){let t=skipSpace(e,this.pos),n=0;if(t>this.pos){let i=parseLinkTitle(e,t,this.start);if(i){let t=lineEnd(e,i.to-this.start);t>0&&(this.nextStage(i),n=t)}}return n||(n=lineEnd(e,this.pos)),n>0&&n<e.length?n:-1}return lineEnd(e,this.pos)}if(!this.nextStage(parseURL(e,skipSpace(e,this.pos),this.start)))return-1}}}}function lineEnd(e,t){for(;t<e.length;t++){let n=e.charCodeAt(t);if(10==n)break;if(!space(n))return-1}return t}class SetextHeadingParser{nextLine(e,t,n){let i=t.depth<e.stack.length?-1:isSetextUnderline(t),r=t.next;if(i<0)return!1;let s=elt(Type.HeaderMark,e.lineStart+t.pos,e.lineStart+i);return e.nextLine(),e.addLeafElement(n,elt(61==r?Type.SetextHeading1:Type.SetextHeading2,n.start,e.prevLineEnd(),[...e.parser.parseInline(n.content,n.start),s])),!0}finish(){return!1}}const DefaultLeafBlocks={LinkReference:(e,t)=>91==t.content.charCodeAt(0)?new LinkReferenceParser(t):null,SetextHeading:()=>new SetextHeadingParser},DefaultEndLeaf=[(e,t)=>isAtxHeading(t)>=0,(e,t)=>isFencedCode(t)>=0,(e,t)=>isBlockquote(t)>=0,(e,t)=>isBulletList(t,e,!0)>=0,(e,t)=>isOrderedList(t,e,!0)>=0,(e,t)=>isHorizontalRule(t,e,!0)>=0,(e,t)=>isHTMLBlock(t,e,!0)>=0],scanLineResult={text:"",end:0};class BlockContext{constructor(e,t,n,i){this.parser=e,this.input=t,this.ranges=i,this.line=new Line,this.atEnd=!1,this.reusePlaceholders=new Map,this.stoppedAt=null,this.rangeI=0,this.to=i[i.length-1].to,this.lineStart=this.absoluteLineStart=this.absoluteLineEnd=i[0].from,this.block=CompositeBlock.create(Type.Document,0,this.lineStart,0,0),this.stack=[this.block],this.fragments=n.length?new FragmentCursor(n,t):null,this.readLine()}get parsedPos(){return this.absoluteLineStart}advance(){if(null!=this.stoppedAt&&this.absoluteLineStart>this.stoppedAt)return this.finish();let{line:e}=this;for(;;){for(let t=0;;){let n=e.depth<this.stack.length?this.stack[this.stack.length-1]:null;for(;t<e.markers.length&&(!n||e.markers[t].from<n.end);){let n=e.markers[t++];this.addNode(n.type,n.from,n.to)}if(!n)break;this.finishContext()}if(e.pos<e.text.length)break;if(!this.nextLine())return this.finish()}if(this.fragments&&this.reuseFragment(e.basePos))return null;e:for(;;){for(let t of this.parser.blockParsers)if(t){let n=t(this,e);if(0!=n){if(1==n)return null;e.forward();continue e}}break}let t=new LeafBlock(this.lineStart+e.pos,e.text.slice(e.pos));for(let e of this.parser.leafBlockParsers)if(e){let n=e(this,t);n&&t.parsers.push(n)}e:for(;this.nextLine()&&e.pos!=e.text.length;){if(e.indent<e.baseIndent+4)for(let n of this.parser.endLeafBlock)if(n(this,e,t))break e;for(let n of t.parsers)if(n.nextLine(this,e,t))return null;t.content+="\n"+e.scrub();for(let n of e.markers)t.marks.push(n)}return this.finishLeaf(t),null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}reuseFragment(e){if(!this.fragments.moveTo(this.absoluteLineStart+e,this.absoluteLineStart)||!this.fragments.matches(this.block.hash))return!1;let t=this.fragments.takeNodes(this);return!!t&&(this.absoluteLineStart+=t,this.lineStart=toRelative(this.absoluteLineStart,this.ranges),this.moveRangeI(),this.absoluteLineStart<this.to?(this.lineStart++,this.absoluteLineStart++,this.readLine()):(this.atEnd=!0,this.readLine()),!0)}get depth(){return this.stack.length}parentType(e=this.depth-1){return this.parser.nodeSet.types[this.stack[e].type]}nextLine(){return this.lineStart+=this.line.text.length,this.absoluteLineEnd>=this.to?(this.absoluteLineStart=this.absoluteLineEnd,this.atEnd=!0,this.readLine(),!1):(this.lineStart++,this.absoluteLineStart=this.absoluteLineEnd+1,this.moveRangeI(),this.readLine(),!0)}peekLine(){return this.scanLine(this.absoluteLineEnd+1).text}moveRangeI(){for(;this.rangeI<this.ranges.length-1&&this.absoluteLineStart>=this.ranges[this.rangeI].to;)this.rangeI++,this.absoluteLineStart=Math.max(this.absoluteLineStart,this.ranges[this.rangeI].from)}scanLine(e){let t=scanLineResult;if(t.end=e,e>=this.to)t.text="";else if(t.text=this.lineChunkAt(e),t.end+=t.text.length,this.ranges.length>1){let e=this.absoluteLineStart,n=this.rangeI;for(;this.ranges[n].to<t.end;){n++;let i=this.ranges[n].from,r=this.lineChunkAt(i);t.end=i+r.length,t.text=t.text.slice(0,this.ranges[n-1].to-e)+r,e=t.end-t.text.length}}return t}readLine(){let{line:e}=this,{text:t,end:n}=this.scanLine(this.absoluteLineStart);for(this.absoluteLineEnd=n,e.reset(t);e.depth<this.stack.length;e.depth++){let t=this.stack[e.depth],n=this.parser.skipContextMarkup[t.type];if(!n)throw new Error("Unhandled block context "+Type[t.type]);if(!n(t,this,e))break;e.forward()}}lineChunkAt(e){let t,n=this.input.chunk(e);if(this.input.lineChunks)t="\n"==n?"":n;else{let e=n.indexOf("\n");t=e<0?n:n.slice(0,e)}return e+t.length>this.to?t.slice(0,this.to-e):t}prevLineEnd(){return this.atEnd?this.lineStart:this.lineStart-1}startContext(e,t,n=0){this.block=CompositeBlock.create(e,n,this.lineStart+t,this.block.hash,this.lineStart+this.line.text.length),this.stack.push(this.block)}startComposite(e,t,n=0){this.startContext(this.parser.getNodeType(e),t,n)}addNode(e,t,n){"number"==typeof e&&(e=new Tree(this.parser.nodeSet.types[e],none,none,(null!=n?n:this.prevLineEnd())-t)),this.block.addChild(e,t-this.block.from)}addElement(e){this.block.addChild(e.toTree(this.parser.nodeSet),e.from-this.block.from)}addLeafElement(e,t){this.addNode(this.buffer.writeElements(injectMarks(t.children,e.marks),-t.from).finish(t.type,t.to-t.from),t.from)}finishContext(){let e=this.stack.pop(),t=this.stack[this.stack.length-1];t.addChild(e.toTree(this.parser.nodeSet),e.from-t.from),this.block=t}finish(){for(;this.stack.length>1;)this.finishContext();return this.addGaps(this.block.toTree(this.parser.nodeSet,this.lineStart))}addGaps(e){return this.ranges.length>1?injectGaps(this.ranges,0,e.topNode,this.ranges[0].from,this.reusePlaceholders):e}finishLeaf(e){for(let t of e.parsers)if(t.finish(this,e))return;let t=injectMarks(this.parser.parseInline(e.content,e.start),e.marks);this.addNode(this.buffer.writeElements(t,-e.start).finish(Type.Paragraph,e.content.length),e.start)}elt(e,t,n,i){return"string"==typeof e?elt(this.parser.getNodeType(e),t,n,i):new TreeElement(e,t)}get buffer(){return new Buffer$1(this.parser.nodeSet)}}function injectGaps(e,t,n,i,r){let s=e[t].to,o=[],a=[],l=n.from+i;function c(n,r){for(;r?n>=s:n>s;){let r=e[t+1].from-s;i+=r,n+=r,t++,s=e[t].to}}for(let d=n.firstChild;d;d=d.nextSibling){c(d.from+i,!0);let n,u=d.from+i,h=r.get(d.tree);h?n=h:d.to+i>s?(n=injectGaps(e,t,d,i,r),c(d.to+i,!1)):n=d.toTree(),o.push(n),a.push(u-l)}return c(n.to+i,!1),new Tree(n.type,o,a,n.to+i-l,n.tree?n.tree.propValues:void 0)}class MarkdownParser extends Parser{constructor(e,t,n,i,r,s,o,a,l){super(),this.nodeSet=e,this.blockParsers=t,this.leafBlockParsers=n,this.blockNames=i,this.endLeafBlock=r,this.skipContextMarkup=s,this.inlineParsers=o,this.inlineNames=a,this.wrappers=l,this.nodeTypes=Object.create(null);for(let t of e.types)this.nodeTypes[t.name]=t.id}createParse(e,t,n){let i=new BlockContext(this,e,t,n);for(let r of this.wrappers)i=r(i,e,t,n);return i}configure(e){let t=resolveConfig(e);if(!t)return this;let{nodeSet:n,skipContextMarkup:i}=this,r=this.blockParsers.slice(),s=this.leafBlockParsers.slice(),o=this.blockNames.slice(),a=this.inlineParsers.slice(),l=this.inlineNames.slice(),c=this.endLeafBlock.slice(),d=this.wrappers;if(nonEmpty(t.defineNodes)){i=Object.assign({},i);let e,r=n.types.slice();for(let n of t.defineNodes){let{name:t,block:s,composite:o,style:a}="string"==typeof n?{name:n}:n;if(r.some((e=>e.name==t)))continue;o&&(i[r.length]=(e,t,n)=>o(t,n,e.value));let l=r.length,c=o?["Block","BlockContext"]:s?l>=Type.ATXHeading1&&l<=Type.SetextHeading2?["Block","LeafBlock","Heading"]:["Block","LeafBlock"]:void 0;r.push(NodeType.define({id:l,name:t,props:c&&[[NodeProp.group,c]]})),a&&(e||(e={}),Array.isArray(a)||a instanceof Tag?e[t]=a:Object.assign(e,a))}n=new NodeSet(r),e&&(n=n.extend(styleTags(e)))}if(nonEmpty(t.props)&&(n=n.extend(...t.props)),nonEmpty(t.remove))for(let e of t.remove){let t=this.blockNames.indexOf(e),n=this.inlineNames.indexOf(e);t>-1&&(r[t]=s[t]=void 0),n>-1&&(a[n]=void 0)}if(nonEmpty(t.parseBlock))for(let e of t.parseBlock){let t=o.indexOf(e.name);if(t>-1)r[t]=e.parse,s[t]=e.leaf;else{let t=e.before?findName(o,e.before):e.after?findName(o,e.after)+1:o.length-1;r.splice(t,0,e.parse),s.splice(t,0,e.leaf),o.splice(t,0,e.name)}e.endLeaf&&c.push(e.endLeaf)}if(nonEmpty(t.parseInline))for(let e of t.parseInline){let t=l.indexOf(e.name);if(t>-1)a[t]=e.parse;else{let t=e.before?findName(l,e.before):e.after?findName(l,e.after)+1:l.length-1;a.splice(t,0,e.parse),l.splice(t,0,e.name)}}return t.wrap&&(d=d.concat(t.wrap)),new MarkdownParser(n,r,s,o,c,i,a,l,d)}getNodeType(e){let t=this.nodeTypes[e];if(null==t)throw new RangeError("Unknown node type '"+e+"'");return t}parseInline(e,t){let n=new InlineContext(this,e,t);e:for(let e=t;e<n.end;){let t=n.char(e);for(let i of this.inlineParsers)if(i){let r=i(n,t,e);if(r>=0){e=r;continue e}}e++}return n.resolveMarkers(0)}}function nonEmpty(e){return null!=e&&e.length>0}function resolveConfig(e){if(!Array.isArray(e))return e;if(0==e.length)return null;let t=resolveConfig(e[0]);if(1==e.length)return t;let n=resolveConfig(e.slice(1));if(!n||!t)return t||n;let i=(e,t)=>(e||none).concat(t||none),r=t.wrap,s=n.wrap;return{props:i(t.props,n.props),defineNodes:i(t.defineNodes,n.defineNodes),parseBlock:i(t.parseBlock,n.parseBlock),parseInline:i(t.parseInline,n.parseInline),remove:i(t.remove,n.remove),wrap:r?s?(e,t,n,i)=>r(s(e,t,n,i),t,n,i):r:s}}function findName(e,t){let n=e.indexOf(t);if(n<0)throw new RangeError("Position specified relative to unknown parser "+t);return n}let nodeTypes=[NodeType.none];for(let e=1,t;t=Type[e];e++)nodeTypes[e]=NodeType.define({id:e,name:t,props:e>=Type.Escape?[]:[[NodeProp.group,e in DefaultSkipMarkup?["Block","BlockContext"]:["Block","LeafBlock"]]],top:"Document"==t});const none=[];let Buffer$1=class{constructor(e){this.nodeSet=e,this.content=[],this.nodes=[]}write(e,t,n,i=0){return this.content.push(e,t,n,4+4*i),this}writeElements(e,t=0){for(let n of e)n.writeTo(this,t);return this}finish(e,t){return Tree.build({buffer:this.content,nodeSet:this.nodeSet,reused:this.nodes,topID:e,length:t})}},Element$1=class{constructor(e,t,n,i=none){this.type=e,this.from=t,this.to=n,this.children=i}writeTo(e,t){let n=e.content.length;e.writeElements(this.children,t),e.content.push(this.type,this.from+t,this.to+t,e.content.length+4-n)}toTree(e){return new Buffer$1(e).writeElements(this.children,-this.from).finish(this.type,this.to-this.from)}};class TreeElement{constructor(e,t){this.tree=e,this.from=t}get to(){return this.from+this.tree.length}get type(){return this.tree.type.id}get children(){return none}writeTo(e,t){e.nodes.push(this.tree),e.content.push(e.nodes.length-1,this.from+t,this.to+t,-1)}toTree(){return this.tree}}function elt(e,t,n,i){return new Element$1(e,t,n,i)}const EmphasisUnderscore={resolve:"Emphasis",mark:"EmphasisMark"},EmphasisAsterisk={resolve:"Emphasis",mark:"EmphasisMark"},LinkStart={},ImageStart={};class InlineDelimiter{constructor(e,t,n,i){this.type=e,this.from=t,this.to=n,this.side=i}}const Escapable="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";let Punctuation=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\u2010-\u2027]/;try{Punctuation=new RegExp("[\\p{S}|\\p{P}]","u")}catch(e){}const DefaultInline={Escape(e,t,n){if(92!=t||n==e.end-1)return-1;let i=e.char(n+1);for(let t=0;t<Escapable.length;t++)if(Escapable.charCodeAt(t)==i)return e.append(elt(Type.Escape,n,n+2));return-1},Entity(e,t,n){if(38!=t)return-1;let i=/^(?:#\d+|#x[a-f\d]+|\w+);/i.exec(e.slice(n+1,n+31));return i?e.append(elt(Type.Entity,n,n+1+i[0].length)):-1},InlineCode(e,t,n){if(96!=t||n&&96==e.char(n-1))return-1;let i=n+1;for(;i<e.end&&96==e.char(i);)i++;let r=i-n,s=0;for(;i<e.end;i++)if(96==e.char(i)){if(s++,s==r&&96!=e.char(i+1))return e.append(elt(Type.InlineCode,n,i+1,[elt(Type.CodeMark,n,n+r),elt(Type.CodeMark,i+1-r,i+1)]))}else s=0;return-1},HTMLTag(e,t,n){if(60!=t||n==e.end-1)return-1;let i=e.slice(n+1,e.end),r=/^(?:[a-z][-\w+.]+:[^\s>]+|[a-z\d.!#$%&'*+/=?^_`{|}~-]+@[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)*)>/i.exec(i);if(r)return e.append(elt(Type.Autolink,n,n+1+r[0].length,[elt(Type.LinkMark,n,n+1),elt(Type.URL,n+1,n+r[0].length),elt(Type.LinkMark,n+r[0].length,n+1+r[0].length)]));let s=/^!--[^>](?:-[^-]|[^-])*?-->/i.exec(i);if(s)return e.append(elt(Type.Comment,n,n+1+s[0].length));let o=/^\?[^]*?\?>/.exec(i);if(o)return e.append(elt(Type.ProcessingInstruction,n,n+1+o[0].length));let a=/^(?:![A-Z][^]*?>|!\[CDATA\[[^]*?\]\]>|\/\s*[a-zA-Z][\w-]*\s*>|\s*[a-zA-Z][\w-]*(\s+[a-zA-Z:_][\w-.:]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*(\/\s*)?>)/.exec(i);return a?e.append(elt(Type.HTMLTag,n,n+1+a[0].length)):-1},Emphasis(e,t,n){if(95!=t&&42!=t)return-1;let i=n+1;for(;e.char(i)==t;)i++;let r=e.slice(n-1,n),s=e.slice(i,i+1),o=Punctuation.test(r),a=Punctuation.test(s),l=/\s|^$/.test(r),c=/\s|^$/.test(s),d=!c&&(!a||l||o),u=!l&&(!o||c||a),h=d&&(42==t||!u||o),m=u&&(42==t||!d||a);return e.append(new InlineDelimiter(95==t?EmphasisUnderscore:EmphasisAsterisk,n,i,(h?1:0)|(m?2:0)))},HardBreak(e,t,n){if(92==t&&10==e.char(n+1))return e.append(elt(Type.HardBreak,n,n+2));if(32==t){let t=n+1;for(;32==e.char(t);)t++;if(10==e.char(t)&&t>=n+2)return e.append(elt(Type.HardBreak,n,t+1))}return-1},Link:(e,t,n)=>91==t?e.append(new InlineDelimiter(LinkStart,n,n+1,1)):-1,Image:(e,t,n)=>33==t&&91==e.char(n+1)?e.append(new InlineDelimiter(ImageStart,n,n+2,1)):-1,LinkEnd(e,t,n){if(93!=t)return-1;for(let t=e.parts.length-1;t>=0;t--){let i=e.parts[t];if(i instanceof InlineDelimiter&&(i.type==LinkStart||i.type==ImageStart)){if(!i.side||e.skipSpace(i.to)==n&&!/[(\[]/.test(e.slice(n+1,n+2)))return e.parts[t]=null,-1;let r=e.takeContent(t),s=e.parts[t]=finishLink(e,r,i.type==LinkStart?Type.Link:Type.Image,i.from,n+1);if(i.type==LinkStart)for(let n=0;n<t;n++){let t=e.parts[n];t instanceof InlineDelimiter&&t.type==LinkStart&&(t.side=0)}return s.to}}return-1}};function finishLink(e,t,n,i,r){let{text:s}=e,o=e.char(r),a=r;if(t.unshift(elt(Type.LinkMark,i,i+(n==Type.Image?2:1))),t.push(elt(Type.LinkMark,r-1,r)),40==o){let n,i=e.skipSpace(r+1),o=parseURL(s,i-e.offset,e.offset);o&&(i=e.skipSpace(o.to),i!=o.to&&(n=parseLinkTitle(s,i-e.offset,e.offset),n&&(i=e.skipSpace(n.to)))),41==e.char(i)&&(t.push(elt(Type.LinkMark,r,r+1)),a=i+1,o&&t.push(o),n&&t.push(n),t.push(elt(Type.LinkMark,i,a)))}else if(91==o){let n=parseLinkLabel(s,r-e.offset,e.offset,!1);n&&(t.push(n),a=n.to)}return elt(n,i,a,t)}function parseURL(e,t,n){if(60==e.charCodeAt(t)){for(let i=t+1;i<e.length;i++){let r=e.charCodeAt(i);if(62==r)return elt(Type.URL,t+n,i+1+n);if(60==r||10==r)return!1}return null}{let i=0,r=t;for(let t=!1;r<e.length;r++){let n=e.charCodeAt(r);if(space(n))break;if(t)t=!1;else if(40==n)i++;else if(41==n){if(!i)break;i--}else 92==n&&(t=!0)}return r>t?elt(Type.URL,t+n,r+n):r==e.length&&null}}function parseLinkTitle(e,t,n){let i=e.charCodeAt(t);if(39!=i&&34!=i&&40!=i)return!1;let r=40==i?41:i;for(let i=t+1,s=!1;i<e.length;i++){let o=e.charCodeAt(i);if(s)s=!1;else{if(o==r)return elt(Type.LinkTitle,t+n,i+1+n);92==o&&(s=!0)}}return null}function parseLinkLabel(e,t,n,i){for(let r=!1,s=t+1,o=Math.min(e.length,s+999);s<o;s++){let o=e.charCodeAt(s);if(r)r=!1;else{if(93==o)return!i&&elt(Type.LinkLabel,t+n,s+1+n);if(i&&!space(o)&&(i=!1),91==o)return!1;92==o&&(r=!0)}}return null}class InlineContext{constructor(e,t,n){this.parser=e,this.text=t,this.offset=n,this.parts=[]}char(e){return e>=this.end?-1:this.text.charCodeAt(e-this.offset)}get end(){return this.offset+this.text.length}slice(e,t){return this.text.slice(e-this.offset,t-this.offset)}append(e){return this.parts.push(e),e.to}addDelimiter(e,t,n,i,r){return this.append(new InlineDelimiter(e,t,n,(i?1:0)|(r?2:0)))}get hasOpenLink(){for(let e=this.parts.length-1;e>=0;e--){let t=this.parts[e];if(t instanceof InlineDelimiter&&(t.type==LinkStart||t.type==ImageStart))return!0}return!1}addElement(e){return this.append(e)}resolveMarkers(e){for(let t=e;t<this.parts.length;t++){let n=this.parts[t];if(!(n instanceof InlineDelimiter&&n.type.resolve&&2&n.side))continue;let i,r=n.type==EmphasisUnderscore||n.type==EmphasisAsterisk,s=n.to-n.from,o=t-1;for(;o>=e;o--){let e=this.parts[o];if(e instanceof InlineDelimiter&&1&e.side&&e.type==n.type&&!(r&&(1&n.side||2&e.side)&&(e.to-e.from+s)%3==0&&((e.to-e.from)%3||s%3))){i=e;break}}if(!i)continue;let a=n.type.resolve,l=[],c=i.from,d=n.to;if(r){let e=Math.min(2,i.to-i.from,s);c=i.to-e,d=n.from+e,a=1==e?"Emphasis":"StrongEmphasis"}i.type.mark&&l.push(this.elt(i.type.mark,c,i.to));for(let e=o+1;e<t;e++)this.parts[e]instanceof Element$1&&l.push(this.parts[e]),this.parts[e]=null;n.type.mark&&l.push(this.elt(n.type.mark,n.from,d));let u=this.elt(a,c,d,l);this.parts[o]=r&&i.from!=c?new InlineDelimiter(i.type,i.from,c,i.side):null,(this.parts[t]=r&&n.to!=d?new InlineDelimiter(n.type,d,n.to,n.side):null)?this.parts.splice(t,0,u):this.parts[t]=u}let t=[];for(let n=e;n<this.parts.length;n++){let e=this.parts[n];e instanceof Element$1&&t.push(e)}return t}findOpeningDelimiter(e){for(let t=this.parts.length-1;t>=0;t--){let n=this.parts[t];if(n instanceof InlineDelimiter&&n.type==e)return t}return null}takeContent(e){let t=this.resolveMarkers(e);return this.parts.length=e,t}skipSpace(e){return skipSpace(this.text,e-this.offset)+this.offset}elt(e,t,n,i){return"string"==typeof e?elt(this.parser.getNodeType(e),t,n,i):new TreeElement(e,t)}}function injectMarks(e,t){if(!t.length)return e;if(!e.length)return t;let n=e.slice(),i=0;for(let e of t){for(;i<n.length&&n[i].to<e.to;)i++;if(i<n.length&&n[i].from<e.from){let t=n[i];t instanceof Element$1&&(n[i]=new Element$1(t.type,t.from,t.to,injectMarks(t.children,[e])))}else n.splice(i++,0,e)}return n}const NotLast=[Type.CodeBlock,Type.ListItem,Type.OrderedList,Type.BulletList];class FragmentCursor{constructor(e,t){this.fragments=e,this.input=t,this.i=0,this.fragment=null,this.fragmentEnd=-1,this.cursor=null,e.length&&(this.fragment=e[this.i++])}nextFragment(){this.fragment=this.i<this.fragments.length?this.fragments[this.i++]:null,this.cursor=null,this.fragmentEnd=-1}moveTo(e,t){for(;this.fragment&&this.fragment.to<=e;)this.nextFragment();if(!this.fragment||this.fragment.from>(e?e-1:0))return!1;if(this.fragmentEnd<0){let e=this.fragment.to;for(;e>0&&"\n"!=this.input.read(e-1,e);)e--;this.fragmentEnd=e?e-1:0}let n=this.cursor;n||(n=this.cursor=this.fragment.tree.cursor(),n.firstChild());let i=e+this.fragment.offset;for(;n.to<=i;)if(!n.parent())return!1;for(;;){if(n.from>=i)return this.fragment.from<=t;if(!n.childAfter(i))return!1}}matches(e){let t=this.cursor.tree;return t&&t.prop(NodeProp.contextHash)==e}takeNodes(e){let t=this.cursor,n=this.fragment.offset,i=this.fragmentEnd-(this.fragment.openEnd?1:0),r=e.absoluteLineStart,s=r,o=e.block.children.length,a=s,l=o;for(;;){if(t.to-n>i){if(t.type.isAnonymous&&t.firstChild())continue;break}let r=toRelative(t.from-n,e.ranges);if(t.to-n<=e.ranges[e.rangeI].to)e.addNode(t.tree,r);else{let n=new Tree(e.parser.nodeSet.types[Type.Paragraph],[],[],0,e.block.hashProp);e.reusePlaceholders.set(n,t.tree),e.addNode(n,r)}if(t.type.is("Block")&&(NotLast.indexOf(t.type.id)<0?(s=t.to-n,o=e.block.children.length):(s=a,o=l,a=t.to-n,l=e.block.children.length)),!t.nextSibling())break}for(;e.block.children.length>o;)e.block.children.pop(),e.block.positions.pop();return s-r}}function toRelative(e,t){let n=e;for(let i=1;i<t.length;i++){let r=t[i-1].to,s=t[i].from;r<e&&(n-=s-r)}return n}const markdownHighlighting=styleTags({"Blockquote/...":tags$1.quote,HorizontalRule:tags$1.contentSeparator,"ATXHeading1/... SetextHeading1/...":tags$1.heading1,"ATXHeading2/... SetextHeading2/...":tags$1.heading2,"ATXHeading3/...":tags$1.heading3,"ATXHeading4/...":tags$1.heading4,"ATXHeading5/...":tags$1.heading5,"ATXHeading6/...":tags$1.heading6,"Comment CommentBlock":tags$1.comment,Escape:tags$1.escape,Entity:tags$1.character,"Emphasis/...":tags$1.emphasis,"StrongEmphasis/...":tags$1.strong,"Link/... Image/...":tags$1.link,"OrderedList/... BulletList/...":tags$1.list,"BlockQuote/...":tags$1.quote,"InlineCode CodeText":tags$1.monospace,"URL Autolink":tags$1.url,"HeaderMark HardBreak QuoteMark ListMark LinkMark EmphasisMark CodeMark":tags$1.processingInstruction,"CodeInfo LinkLabel":tags$1.labelName,LinkTitle:tags$1.string,Paragraph:tags$1.content}),parser=new MarkdownParser(new NodeSet(nodeTypes).extend(markdownHighlighting),Object.keys(DefaultBlockParsers).map((e=>DefaultBlockParsers[e])),Object.keys(DefaultBlockParsers).map((e=>DefaultLeafBlocks[e])),Object.keys(DefaultBlockParsers),DefaultEndLeaf,DefaultSkipMarkup,Object.keys(DefaultInline).map((e=>DefaultInline[e])),Object.keys(DefaultInline),[]);function leftOverSpace(e,t,n){let i=[];for(let r=e.firstChild,s=t;;r=r.nextSibling){let e=r?r.from:n;if(e>s&&i.push({from:s,to:e}),!r)break;s=r.to}return i}function parseCode(e){let{codeParser:t,htmlParser:n}=e;return{wrap:parseMixed(((e,i)=>{let r=e.type.id;if(!t||r!=Type.CodeBlock&&r!=Type.FencedCode){if(n&&(r==Type.HTMLBlock||r==Type.HTMLTag))return{parser:n,overlay:leftOverSpace(e.node,e.from,e.to)}}else{let n="";if(r==Type.FencedCode){let t=e.node.getChild(Type.CodeInfo);t&&(n=i.read(t.from,t.to))}let s=t(n);if(s)return{parser:s,overlay:e=>e.type.id==Type.CodeText}}return null}))}}const StrikethroughDelim={resolve:"Strikethrough",mark:"StrikethroughMark"},Strikethrough={defineNodes:[{name:"Strikethrough",style:{"Strikethrough/...":tags$1.strikethrough}},{name:"StrikethroughMark",style:tags$1.processingInstruction}],parseInline:[{name:"Strikethrough",parse(e,t,n){if(126!=t||126!=e.char(n+1)||126==e.char(n+2))return-1;let i=e.slice(n-1,n),r=e.slice(n+2,n+3),s=/\s|^$/.test(i),o=/\s|^$/.test(r),a=Punctuation.test(i),l=Punctuation.test(r);return e.addDelimiter(StrikethroughDelim,n,n+2,!o&&(!l||s||a),!s&&(!a||o||l))},after:"Emphasis"}]};function parseRow(e,t,n=0,i,r=0){let s=0,o=!0,a=-1,l=-1,c=!1,d=()=>{i.push(e.elt("TableCell",r+a,r+l,e.parser.parseInline(t.slice(a,l),r+a)))};for(let u=n;u<t.length;u++){let n=t.charCodeAt(u);124!=n||c?(c||32!=n&&9!=n)&&(a<0&&(a=u),l=u+1):((!o||a>-1)&&s++,o=!1,i&&(a>-1&&d(),i.push(e.elt("TableDelimiter",u+r,u+r+1))),a=l=-1),c=!c&&92==n}return a>-1&&(s++,i&&d()),s}function hasPipe(e,t){for(let n=t;n<e.length;n++){let t=e.charCodeAt(n);if(124==t)return!0;92==t&&n++}return!1}const delimiterLine=/^\|?(\s*:?-+:?\s*\|)+(\s*:?-+:?\s*)?$/;class TableParser{constructor(){this.rows=null}nextLine(e,t,n){if(null==this.rows){let i;if(this.rows=!1,(45==t.next||58==t.next||124==t.next)&&delimiterLine.test(i=t.text.slice(t.pos))){let r=[];parseRow(e,n.content,0,r,n.start)==parseRow(e,i,t.pos)&&(this.rows=[e.elt("TableHeader",n.start,n.start+n.content.length,r),e.elt("TableDelimiter",e.lineStart+t.pos,e.lineStart+t.text.length)])}}else if(this.rows){let n=[];parseRow(e,t.text,t.pos,n,e.lineStart),this.rows.push(e.elt("TableRow",e.lineStart+t.pos,e.lineStart+t.text.length,n))}return!1}finish(e,t){return!!this.rows&&(e.addLeafElement(t,e.elt("Table",t.start,t.start+t.content.length,this.rows)),!0)}}const Table={defineNodes:[{name:"Table",block:!0},{name:"TableHeader",style:{"TableHeader/...":tags$1.heading}},"TableRow",{name:"TableCell",style:tags$1.content},{name:"TableDelimiter",style:tags$1.processingInstruction}],parseBlock:[{name:"Table",leaf:(e,t)=>hasPipe(t.content,0)?new TableParser:null,endLeaf(e,t,n){if(n.parsers.some((e=>e instanceof TableParser))||!hasPipe(t.text,t.basePos))return!1;let i=e.peekLine();return delimiterLine.test(i)&&parseRow(e,t.text,t.basePos)==parseRow(e,i,t.basePos)},before:"SetextHeading"}]};class TaskParser{nextLine(){return!1}finish(e,t){return e.addLeafElement(t,e.elt("Task",t.start,t.start+t.content.length,[e.elt("TaskMarker",t.start,t.start+3),...e.parser.parseInline(t.content.slice(3),t.start+3)])),!0}}const TaskList={defineNodes:[{name:"Task",block:!0,style:tags$1.list},{name:"TaskMarker",style:tags$1.atom}],parseBlock:[{name:"TaskList",leaf:(e,t)=>/^\[[ xX]\][ \t]/.test(t.content)&&"ListItem"==e.parentType().name?new TaskParser:null,after:"SetextHeading"}]},autolinkRE=/(www\.)|(https?:\/\/)|([\w.+-]{1,100}@)|(mailto:|xmpp:)/gy,urlRE=/[\w-]+(\.[\w-]+)+(\/[^\s<]*)?/gy,lastTwoDomainWords=/[\w-]+\.[\w-]+($|\/)/,emailRE=/[\w.+-]+@[\w-]+(\.[\w.-]+)+/gy,xmppResourceRE=/\/[a-zA-Z\d@.]+/gy;function count(e,t,n,i){let r=0;for(let s=t;s<n;s++)e[s]==i&&r++;return r}function autolinkURLEnd(e,t){urlRE.lastIndex=t;let n=urlRE.exec(e);if(!n||lastTwoDomainWords.exec(n[0])[0].indexOf("_")>-1)return-1;let i=t+n[0].length;for(;;){let n,r=e[i-1];if(/[?!.,:*_~]/.test(r)||")"==r&&count(e,t,i,")")>count(e,t,i,"("))i--;else{if(";"!=r||!(n=/&(?:#\d+|#x[a-f\d]+|\w+);$/.exec(e.slice(t,i))))break;i=t+n.index}}return i}function autolinkEmailEnd(e,t){emailRE.lastIndex=t;let n=emailRE.exec(e);if(!n)return-1;let i=n[0][n[0].length-1];return"_"==i||"-"==i?-1:t+n[0].length-("."==i?1:0)}const Autolink={parseInline:[{name:"Autolink",parse(e,t,n){let i=n-e.offset;if(i&&/\w/.test(e.text[i-1]))return-1;autolinkRE.lastIndex=i;let r=autolinkRE.exec(e.text),s=-1;return r?(r[1]||r[2]?(s=autolinkURLEnd(e.text,i+r[0].length),s>-1&&e.hasOpenLink&&(s=i+/([^\[\]]|\[[^\]]*\])*/.exec(e.text.slice(i,s))[0].length)):r[3]?s=autolinkEmailEnd(e.text,i):(s=autolinkEmailEnd(e.text,i+r[0].length),s>-1&&"xmpp:"==r[0]&&(xmppResourceRE.lastIndex=s,r=xmppResourceRE.exec(e.text),r&&(s=r.index+r[0].length))),s<0?-1:(e.addElement(e.elt("URL",n,s+e.offset)),s+e.offset)):-1}}]},GFM=[Table,TaskList,Strikethrough,Autolink];function parseSubSuper(e,t,n){return(i,r,s)=>{if(r!=e||i.char(s+1)==e)return-1;let o=[i.elt(n,s,s+1)];for(let r=s+1;r<i.end;r++){let a=i.char(r);if(a==e)return i.addElement(i.elt(t,s,r+1,o.concat(i.elt(n,r,r+1))));if(92==a&&o.push(i.elt("Escape",r,2+r++)),space(a))break}return-1}}const Superscript={defineNodes:[{name:"Superscript",style:tags$1.special(tags$1.content)},{name:"SuperscriptMark",style:tags$1.processingInstruction}],parseInline:[{name:"Superscript",parse:parseSubSuper(94,"Superscript","SuperscriptMark")}]},Subscript={defineNodes:[{name:"Subscript",style:tags$1.special(tags$1.content)},{name:"SubscriptMark",style:tags$1.processingInstruction}],parseInline:[{name:"Subscript",parse:parseSubSuper(126,"Subscript","SubscriptMark")}]},Emoji={defineNodes:[{name:"Emoji",style:tags$1.character}],parseInline:[{name:"Emoji",parse(e,t,n){let i;return 58==t&&(i=/^[a-zA-Z_0-9]+:/.exec(e.slice(n+1,e.end)))?e.addElement(e.elt("Emoji",n,n+1+i[0].length)):-1}}]},data=defineLanguageFacet({commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}}}),headingProp=new NodeProp,commonmark=parser.configure({props:[foldNodeProp.add((e=>!e.is("Block")||e.is("Document")||null!=isHeading(e)||isList(e)?void 0:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to}))),headingProp.add(isHeading),indentNodeProp.add({Document:()=>null}),languageDataProp.add({Document:data})]});function isHeading(e){let t=/^(?:ATX|Setext)Heading(\d)$/.exec(e.name);return t?+t[1]:void 0}function isList(e){return"OrderedList"==e.name||"BulletList"==e.name}function findSectionEnd(e,t){let n=e;for(;;){let e,i=n.nextSibling;if(!i||null!=(e=isHeading(i.type))&&e<=t)break;n=i}return n.to}const headerIndent=foldService.of(((e,t,n)=>{for(let i=syntaxTree(e).resolveInner(n,-1);i&&!(i.from<t);i=i.parent){let e=i.type.prop(headingProp);if(null==e)continue;let t=findSectionEnd(i,e);if(t>n)return{from:n,to:t}}return null}));function mkLang(e){return new Language(data,e,[headerIndent],"markdown")}const commonmarkLanguage=mkLang(commonmark),extended=commonmark.configure([GFM,Subscript,Superscript,Emoji,{props:[foldNodeProp.add({Table:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})})]}]),markdownLanguage=mkLang(extended);function getCodeParser(e,t){return n=>{if(n&&e){let t=null;if(n=/\S*/.exec(n)[0],t="function"==typeof e?e(n):LanguageDescription.matchLanguageName(e,n,!0),t instanceof LanguageDescription)return t.support?t.support.language.parser:ParseContext.getSkippingParser(t.load());if(t)return t.parser}return t?t.parser:null}}class Context{constructor(e,t,n,i,r,s,o){this.node=e,this.from=t,this.to=n,this.spaceBefore=i,this.spaceAfter=r,this.type=s,this.item=o}blank(e,t=!0){let n=this.spaceBefore+("Blockquote"==this.node.name?">":"");if(null!=e){for(;n.length<e;)n+=" ";return n}for(let e=this.to-this.from-n.length-this.spaceAfter.length;e>0;e--)n+=" ";return n+(t?this.spaceAfter:"")}marker(e,t){let n="OrderedList"==this.node.name?String(+itemNumber(this.item,e)[2]+t):"";return this.spaceBefore+n+this.type+this.spaceAfter}}function getContext(e,t){let n=[],i=[];for(let t=e;t;t=t.parent){if("FencedCode"==t.name)return i;"ListItem"!=t.name&&"Blockquote"!=t.name||n.push(t)}for(let e=n.length-1;e>=0;e--){let r,s=n[e],o=t.lineAt(s.from),a=s.from-o.from;if("Blockquote"==s.name&&(r=/^ *>( ?)/.exec(o.text.slice(a))))i.push(new Context(s,a,a+r[0].length,"",r[1],">",null));else if("ListItem"==s.name&&"OrderedList"==s.parent.name&&(r=/^( *)\d+([.)])( *)/.exec(o.text.slice(a)))){let e=r[3],t=r[0].length;e.length>=4&&(e=e.slice(0,e.length-4),t-=4),i.push(new Context(s.parent,a,a+t,r[1],e,r[2],s))}else if("ListItem"==s.name&&"BulletList"==s.parent.name&&(r=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(o.text.slice(a)))){let e=r[4],t=r[0].length;e.length>4&&(e=e.slice(0,e.length-4),t-=4);let n=r[2];r[3]&&(n+=r[3].replace(/[xX]/," ")),i.push(new Context(s.parent,a,a+t,r[1],e,n,s))}}return i}function itemNumber(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function renumberList(e,t,n,i=0){for(let r=-1,s=e;;){if("ListItem"==s.name){let e=itemNumber(s,t),o=+e[2];if(r>=0){if(o!=r+1)return;n.push({from:s.from+e[1].length,to:s.from+e[0].length,insert:String(r+2+i)})}r=o}let e=s.nextSibling;if(!e)break;s=e}}function normalizeIndent(e,t){let n=/^[ \t]*/.exec(e)[0].length;if(!n||"\t"!=t.facet(indentUnit))return e;let i="";for(let t=countColumn(e,4,n);t>0;)t>=4?(i+="\t",t-=4):(i+=" ",t--);return i+e.slice(n)}const insertNewlineContinueMarkup=({state:e,dispatch:t})=>{let n=syntaxTree(e),{doc:i}=e,r=null,s=e.changeByRange((t=>{if(!t.empty||!markdownLanguage.isActiveAt(e,t.from,0))return r={range:t};let s=t.from,o=i.lineAt(s),a=getContext(n.resolveInner(s,-1),i);for(;a.length&&a[a.length-1].from>s-o.from;)a.pop();if(!a.length)return r={range:t};let l=a[a.length-1];if(l.to-l.spaceAfter.length>s-o.from)return r={range:t};let c=s>=l.to-l.spaceAfter.length&&!/\S/.test(o.text.slice(l.to));if(l.item&&c){let t=l.node.firstChild,n=l.node.getChild("ListItem","ListItem");if(t.to>=s||n&&n.to<s||o.from>0&&!/[^\s>]/.test(i.lineAt(o.from-1).text)){let e,t=a.length>1?a[a.length-2]:null,n="";t&&t.item?(e=o.from+t.from,n=t.marker(i,1)):e=o.from+(t?t.to:0);let r=[{from:e,to:s,insert:n}];return"OrderedList"==l.node.name&&renumberList(l.item,i,r,-2),t&&"OrderedList"==t.node.name&&renumberList(t.item,i,r),{range:EditorSelection.cursor(e+n.length),changes:r}}{let t=blankLine(a,e,o);return{range:EditorSelection.cursor(s+t.length+1),changes:{from:o.from,insert:t+e.lineBreak}}}}if("Blockquote"==l.node.name&&c&&o.from){let n=i.lineAt(o.from-1),r=/>\s*$/.exec(n.text);if(r&&r.index==l.from){let i=e.changes([{from:n.from+r.index,to:n.to},{from:o.from+l.from,to:o.to}]);return{range:t.map(i),changes:i}}}let d=[];"OrderedList"==l.node.name&&renumberList(l.item,i,d);let u=l.item&&l.item.from<o.from,h="";if(!u||/^[\s\d.)\-+*>]*/.exec(o.text)[0].length>=l.to)for(let e=0,t=a.length-1;e<=t;e++)h+=e!=t||u?a[e].blank(e<t?countColumn(o.text,4,a[e+1].from)-h.length:null):a[e].marker(i,1);let m=s;for(;m>o.from&&/\s/.test(o.text.charAt(m-o.from-1));)m--;return h=normalizeIndent(h,e),nonTightList(l.node,e.doc)&&(h=blankLine(a,e,o)+e.lineBreak+h),d.push({from:m,to:s,insert:e.lineBreak+h}),{range:EditorSelection.cursor(m+h.length+1),changes:d}}));return!r&&(t(e.update(s,{scrollIntoView:!0,userEvent:"input"})),!0)};function isMark(e){return"QuoteMark"==e.name||"ListMark"==e.name}function nonTightList(e,t){if("OrderedList"!=e.name&&"BulletList"!=e.name)return!1;let n=e.firstChild,i=e.getChild("ListItem","ListItem");if(!i)return!1;let r=t.lineAt(n.to),s=t.lineAt(i.from),o=/^[\s>]*$/.test(r.text);return r.number+(o?0:1)<s.number}function blankLine(e,t,n){let i="";for(let t=0,r=e.length-2;t<=r;t++)i+=e[t].blank(t<r?countColumn(n.text,4,Math.min(n.text.length,e[t+1].from))-i.length:null,t<r);return normalizeIndent(i,t)}function contextNodeForDelete(e,t){let n=e.resolveInner(t,-1),i=t;isMark(n)&&(i=n.from,n=n.parent);for(let e;e=n.childBefore(i);)if(isMark(e))i=e.from;else{if("OrderedList"!=e.name&&"BulletList"!=e.name)break;n=e.lastChild,i=n.to}return n}const deleteMarkupBackward=({state:e,dispatch:t})=>{let n=syntaxTree(e),i=null,r=e.changeByRange((t=>{let r=t.from,{doc:s}=e;if(t.empty&&markdownLanguage.isActiveAt(e,t.from)){let t=s.lineAt(r),i=getContext(contextNodeForDelete(n,r),s);if(i.length){let n=i[i.length-1],s=n.to-n.spaceAfter.length+(n.spaceAfter?1:0);if(r-t.from>s&&!/\S/.test(t.text.slice(s,r-t.from)))return{range:EditorSelection.cursor(t.from+s),changes:{from:t.from+s,to:r}};if(r-t.from==s&&(!n.item||t.from<=n.item.from||!/\S/.test(t.text.slice(0,n.to)))){let i=t.from+n.from;if(n.item&&n.node.from<n.item.from&&/\S/.test(t.text.slice(n.from,n.to))){let r=n.blank(countColumn(t.text,4,n.to)-countColumn(t.text,4,n.from));return i==t.from&&(r=normalizeIndent(r,e)),{range:EditorSelection.cursor(i+r.length),changes:{from:i,to:t.from+n.to,insert:r}}}if(i<r)return{range:EditorSelection.cursor(i),changes:{from:i,to:r}}}}}return i={range:t}}));return!i&&(t(e.update(r,{scrollIntoView:!0,userEvent:"delete"})),!0)},markdownKeymap=[{key:"Enter",run:insertNewlineContinueMarkup},{key:"Backspace",run:deleteMarkupBackward}],htmlNoMatch=html({matchClosingTags:!1});function markdown(e={}){let{codeLanguages:t,defaultCodeLanguage:n,addKeymap:i=!0,base:{parser:r}=commonmarkLanguage,completeHTMLTags:s=!0,htmlTagLanguage:o=htmlNoMatch}=e;if(!(r instanceof MarkdownParser))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let a,l=e.extensions?[e.extensions]:[],c=[o.support];n instanceof LanguageSupport?(c.push(n.support),a=n.language):n&&(a=n);let d=t||a?getCodeParser(t,a):void 0;l.push(parseCode({codeParser:d,htmlParser:o.language.parser})),i&&c.push(Prec.high(keymap.of(markdownKeymap)));let u=mkLang(r.configure(l));return s&&c.push(u.data.of({autocomplete:htmlTagCompletion})),new LanguageSupport(u,c)}function htmlTagCompletion(e){let{state:t,pos:n}=e,i=/<[:\-\.\w\u00b7-\uffff]*$/.exec(t.sliceDoc(n-25,n));if(!i)return null;let r=syntaxTree(t).resolveInner(n,-1);for(;r&&!r.type.isTop;){if("CodeBlock"==r.name||"FencedCode"==r.name||"ProcessingInstructionBlock"==r.name||"CommentBlock"==r.name||"Link"==r.name||"Image"==r.name)return null;r=r.parent}return{from:n-i[0].length,to:n,options:htmlTagCompletions(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}let _tagCompletions=null;function htmlTagCompletions(){if(_tagCompletions)return _tagCompletions;let e=htmlCompletionSource(new CompletionContext(EditorState.create({extensions:htmlNoMatch}),0,!0));return _tagCompletions=e?e.options:[]}function createCodeMirrorEditor(e){const t=getDefaultExtensions(),n=new Compartment;t.push(n.of(EditorView.editable.of(!0))),"html"===e.syntaxLanguage?t.push(html()):t.push(markdown()),e.theme&&t.push(e.theme),t.push(...getKeybindings());const i=new EditorView({extensions:t,parent:e.parent});return toggleTabFocusMode(i),{focus:()=>{i.dispatch({selection:{anchor:0},scrollIntoView:!0}),i.focus()},getData:()=>i.state.doc.toString(),setData:e=>{i.dispatch({changes:{from:0,to:i.state.doc.length,insert:e},annotations:Transaction.addToHistory.of(!1)})},setReadOnly:e=>{i.dispatch({effects:[n.reconfigure(EditorView.editable.of(!e))]})},destroy:()=>{i.destroy()},instance:i}}function getKeybindings(){return[keymap.of([...closeBracketsKeymap,...defaultKeymap,...historyKeymap,...foldKeymap,...completionKeymap,{key:"Tab",run:indentMore,shift:indentLess,preventDefault:!0,stopPropagation:!0},{key:"Ctrl-y",mac:"Cmd-y",run:redo,preventDefault:!0,stopPropagation:!0},{key:"Ctrl-Shift-z",mac:"Cmd-Shift-z",run:redo,preventDefault:!0,stopPropagation:!0},{key:"Ctrl-z",mac:"Cmd-z",run:undo,preventDefault:!0,stopPropagation:!0}])]}function getDefaultExtensions(){return[EditorView.lineWrapping,autocompletion(),bracketMatching(),closeBrackets(),crosshairCursor(),drawSelection(),dropCursor(),lineNumbers(),foldGutter(),highlightActiveLine(),highlightActiveLineGutter(),highlightSpecialChars(),history(),indentOnInput(),rectangularSelection(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0})]}class CodeEditorView extends View{constructor(e,t){super(e),this._codeEditorApi=null,this._options=t,this.set("isReadOnly",!1),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all-excluded","ck-code-editor"],tabindex:-1}})}render(){super.render(),this._codeEditorApi=createCodeMirrorEditor({parent:this.element,syntaxLanguage:this._options.syntaxLanguage,theme:this._options.theme}),this.on("change:isReadOnly",((e,t,n)=>{this.setReadOnly(n)}))}destroy(){super.destroy(),this._codeEditorApi.destroy(),this._codeEditorApi=null}focus(){this.isReadOnly?this.element.focus():this._codeEditorApi.focus()}getData(){return this._codeEditorApi.getData()}setData(e){this._codeEditorApi.setData(e)}setReadOnly(e){this._codeEditorApi.setReadOnly(e)}}class EditSourceCommand extends _0x338ed0{constructor(e){super(e),this.affectsData=!1,this.editor.plugins.get(PendingActions).on("change:hasAny",((e,t,n)=>{n?this.forceDisabled("pendingActions"):this.clearForceDisabled("pendingActions")}))}refresh(){this.isEnabled=!0}execute(){const e=this.editor,t=e.locale,n=e.plugins.get("Dialog"),i=getActiveRootName(e),r=formatSource(e.data.get({rootName:i})),s=new CodeEditorView(t,{syntaxLanguage:e.plugins.has("Markdown")?"markdown":"html",theme:e.config.get("sourceEditingEnhanced.theme")});let o=!0;const a=e=>{if(o)return unformatSource(s.getData())!==unformatSource(r)?window.confirm(getTranslation$3(t,"Are you sure you want to discard your changes? This action cannot be undone."))?void 0:e.stop():void 0};n.show({id:"sourceEditingEnhanced",title:getTranslation$3(t,"Edit source modal label"),isModal:!0,className:"ck-source-editing-enhanced-dialog",content:s,actionButtons:[{label:getTranslation$3(t,"Cancel"),withText:!0,onExecute:()=>{n.hide()}},{label:getTranslation$3(t,"Save"),class:"ck-button-action",withText:!0,onExecute:()=>{const t=unformatSource(s.getData())!==unformatSource(r);t&&e.execute("replaceSource",s.getData()),o=!1,n.hide(),t&&"editables"in e.ui.view&&e.ui.view.editables[i].element.focus()},onCreate:t=>{t.set("isEnabled",!e.isReadOnly),t.bind("isEnabled").to(e,"isReadOnly",this,"isEnabled",((e,t)=>!e&&t))}}],onHide:()=>{n.off("hide",a),s.destroy()},onShow:()=>{s.bind("isReadOnly").to(e,"isReadOnly",this,"isEnabled",((e,t)=>e||!t)),s.setData(r),s.focus(),n.on("hide",a,{priority:"highest"})}})}}class SourceEditingEnhancedUI extends Plugin{static get pluginName(){return"SourceEditingEnhancedUI"}static get requires(){return[PendingActions]}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor,t=e.locale,n=new EditSourceCommand(e);e.commands.add("editSource",n),e.ui.componentFactory.add("sourceEditingEnhanced",(()=>{const e=this._createButton(ButtonView,n);return e.set({label:getTranslation$3(t,"Source"),icon:_0x42409c.source,tooltip:getTranslation$3(t,"Edit source modal label"),class:"ck-source-editing-enhanced-button"}),e})),e.ui.componentFactory.add("menuBar:sourceEditingEnhanced",(()=>{const e=this._createButton(MenuBarMenuListItemButtonView,n,!0);return e.set({label:getTranslation$3(t,"Edit source modal label"),icon:_0x42409c.source,role:"menuitemcheckbox"}),e})),this._registerKeybindings()}afterInit(){checkLicense$3(this)}_createButton(e,t,n=!1){const i=new e(this.editor.locale);return i.set({withText:n,isToggleable:!1}),i.bind("isEnabled").to(t,"isEnabled"),this.listenTo(i,"execute",(()=>t.execute())),i}_registerKeybindings(){const e=this.editor.locale;this.editor.accessibility.addKeystrokeInfoCategory({id:"sourceEditingEnhanced",label:getTranslation$3(e,"Source Editing Enhanced")});const t=env.isMac||env.isiOS;this.editor.accessibility.addKeystrokeInfos({categoryId:"sourceEditingEnhanced",keystrokes:[{label:getTranslation$3(e,"Copy line down"),keystroke:"Shift+Alt+ArrowDown"},{label:getTranslation$3(e,"Copy line up"),keystroke:"Shift+Alt+ArrowUp"},{label:getTranslation$3(e,"Delete line"),keystroke:"Shift+Ctrl+K"},{label:getTranslation$3(e,"Indent less"),keystroke:"Ctrl+["},{label:getTranslation$3(e,"Indent more"),keystroke:"Ctrl+]"},{label:getTranslation$3(e,"Fold all"),keystroke:"Ctrl!+Alt+["},{label:getTranslation$3(e,"Fold code (current level)"),keystroke:t?"Cmd+Alt+[":"Ctrl+Shift+["},{label:getTranslation$3(e,"Move line down"),keystroke:"Alt+ArrowDown"},{label:getTranslation$3(e,"Move line up"),keystroke:"Alt+ArrowUp"},{label:getTranslation$3(e,"Redo (keystroke)"),keystroke:[["Ctrl+Shift+Z"],["Ctrl+Y"]]},{label:getTranslation$3(e,"Select line"),keystroke:t?"Ctrl!+L":"Alt+L"},{label:getTranslation$3(e,'Switch between "focus with tab" and "indent with tab" mode'),keystroke:t?"Alt+Shift+M":"Ctrl+M"},{label:getTranslation$3(e,"Toggle block comment"),keystroke:"Shift+Alt+A"},{label:getTranslation$3(e,"Toggle comment"),keystroke:"Ctrl+/"},{label:getTranslation$3(e,"Undo (keystroke)"),keystroke:"Ctrl+Z"},{label:getTranslation$3(e,"Unfold all"),keystroke:"Ctrl!+Alt+]"},{label:getTranslation$3(e,"Unfold code (current level)"),keystroke:t?"Cmd+Alt+]":"Ctrl+Shift+]"}]})}}async function checkLicense$3(e){const t=g([73,88,51,69,67,82,102,54,65,90,57,85,52,81,104,70,75,99,112,106,66,80,71,101,119,72,78,109,118,103,68,113,108,53,110,50,114,120,121,116,89,48,97,84,79,87,105,74,86,98,56,76,117,49,111,100,77,107,83,122,115,55]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([73]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([115,111,117,114,99,101,69,100,105,116,105,110,103,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([83,69,69])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class ReplaceSourceCommand extends _0x338ed0{constructor(e){super(e),this.refresh()}refresh(){this.isEnabled=!this.editor.isReadOnly}execute(e,t){var n;const i=this.editor,r=null!==(n=null==t?void 0:t.rootName)&&void 0!==n?n:getActiveRootName(i);i.data.set({[r]:e},{batchType:{isUndoable:!0},suppressErrorInCollaboration:!0})}}class SourceEditingEnhanced extends Plugin{static get pluginName(){return"SourceEditingEnhanced"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}static get requires(){return[SourceEditingEnhancedUI]}constructor(e){super(e),e.config.define("sourceEditingEnhanced.allowCollaborationFeatures",!1)}init(){this._checkCompatibility(),this.editor.commands.add("replaceSource",new ReplaceSourceCommand(this.editor)),this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("sourceEditingEnhancedLicenseKeyValid"==r||"sourceEditingEnhancedLicenseKeyInvalid"==r||"sourceEditingEnhancedLicenseKeyExpired"==r||"sourceEditingEnhancedLicenseKeyDomainLimit"==r||"sourceEditingEnhancedLicenseKeyNotAllowed"==r||"sourceEditingEnhancedLicenseKeyEvaluationLimit"==r||"sourceEditingEnhancedLicenseKeyTrialLimit"==r||"sourceEditingEnhancedLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"sourceEditingEnhancedLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"sourceEditingEnhancedLicenseKeyExpired"==t&&e._showLicenseError("expired"),"sourceEditingEnhancedLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"sourceEditingEnhancedLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","SourceEditingEnhanced"),"sourceEditingEnhancedLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"sourceEditingEnhancedLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"sourceEditingEnhancedLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_checkCompatibility(){const e=this.editor,t=e.config.get("sourceEditingEnhanced.allowCollaborationFeatures");if(!t&&e.plugins.has("RealTimeCollaborativeEditing"))throw new CKEditorError("source-editing-enhanced-incompatible-with-real-time-collaboration",null);!t&&["CommentsEditing","TrackChangesEditing","RevisionHistory"].some((t=>e.plugins.has(t)))&&console.warn("You initialized the editor with the source editing enhanced feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing enhanced feature and restricted editing feature. Please be advised that the source editing enhanced feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}}class TemplateCommand extends _0x338ed0{execute(e){const{model:t}=this.editor;let n;switch(typeof e){case"string":n=e;break;case"function":n=e()}"string"==typeof n&&t.change((()=>{const e=this.editor.data.htmlProcessor.toView(n),i=this.editor.data.toModel(e);t.insertContent(i)}))}}class TemplateEditing extends Plugin{static get pluginName(){return"TemplateEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this;e.commands.add("insertTemplate",new TemplateCommand(e)),this.licenseKey=this.editor.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const n in t){const i=n,r=t[i];if("templateLicenseKeyValid"==r||"templateLicenseKeyInvalid"==r||"templateLicenseKeyExpired"==r||"templateLicenseKeyDomainLimit"==r||"templateLicenseKeyNotAllowed"==r||"templateLicenseKeyEvaluationLimit"==r||"templateLicenseKeyTrialLimit"==r||"templateLicenseKeyUsageLimit"==r){delete t[i],e=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"templateLicenseKeyInvalid"==e&&t._showLicenseError("invalid"),"templateLicenseKeyExpired"==e&&t._showLicenseError("expired"),"templateLicenseKeyDomainLimit"==e&&t._showLicenseError("domainLimit"),"templateLicenseKeyNotAllowed"==e&&t._showLicenseError("featureNotAllowed","Template"),"templateLicenseKeyEvaluationLimit"==e&&t._showLicenseError("evaluationLimit"),"templateLicenseKeyTrialLimit"==e&&t._showLicenseError("trialLimit"),"templateLicenseKeyUsageLimit"==e&&t._showLicenseError("usageLimit")}),1e3)}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class TemplateListView extends ListView{filter(e){if(!e)return this._resetFiltering();const t=new Map,n=this.items.map((n=>{const i=n.buttonView.isMatching(e);return n.isVisible=!!i,n.buttonView.highlightText(i?e:null),i&&t.set(n,i),n})).sort(unsortListItemsCallback).sort(getSortListItemsCallback(t));return this.items.clear(),this.items.addMany(n),{resultsCount:t.size,totalItemsCount:this.items.length}}_resetFiltering(){const e=this.items.map((e=>e)).sort(unsortListItemsCallback);return e.forEach((e=>{e.isVisible=!0,e.buttonView.highlightText(null)})),this.items.clear(),this.items.addMany(e),{resultsCount:e.length,totalItemsCount:e.length}}}function getSortListItemsCallback(e){return function(t,n){const i=e.get(t),r=e.get(n);return i&&!r?-1:r&&!i?1:i||r?i.title&&!r.title?-1:!i.title&&r.title?1:0:0}}function unsortListItemsCallback(e,t){return e.originalIndex-t.originalIndex}class TemplateListItemView extends ListItemView{constructor(e,t){super(e),this.originalIndex=t,this.buttonView=null}}var templateDefaultIcon='<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45">\n  <path fill="#F0F0F0" d="M2 0h41s2 0 2 2v41s0 2 -2 2h-41s-2 0 -2 -2v-41s0 -2 2 -2" />\n  <path fill="#D5D5D5" d="M11 10h10s1 0 1 1v24s0 1 -1 1h-10s-1 0 -1 -1v-24s0 -1 1 -1" />\n  <path fill="#D5D5D5" d="M25 10h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />\n  <path fill="#D5D5D5" d="M25 24h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />\n</svg>\n';class TemplateListButtonView extends ButtonView{constructor(e,t){super(e),this.templateDefinition=t,this.textPartView=null;const{icon:n=templateDefaultIcon}=t;this.set({withText:!0,class:"ck-template-button",role:"option",icon:n}),this.iconView.isColorInherited=!1}render(){super.render(),this.textPartView=new TextPartView(this.locale,this.templateDefinition,this.labelView.element.id),this.children.remove(this.labelView),this.children.add(this.textPartView)}destroy(){super.destroy(),this.labelView.destroy()}isMatching(e){const{title:t,description:n}=this.templateDefinition,i=!!t.match(e),r=!(!n||!n.match(e));return i||r?{title:i,description:r}:null}highlightText(e){this.textPartView.highlightText(e)}}class TextPartView extends View{constructor(e,t,n){super(e),this.title=t.title,this.description=t.description,this.titleView=new HighlightedTextView,this.titleView.text=this.title,this.titleView.extendTemplate({tag:"span",attributes:{class:["ck-button__label"],id:n}});const i=[this.titleView];this.description&&(this.descriptionView=new HighlightedTextView,this.descriptionView.text=this.description,this.descriptionView.extendTemplate({tag:"p",attributes:{class:["ck-template-form__description"]}}),i.push(this.descriptionView)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-template-form__text-part"]},children:i})}highlightText(e){this.titleView.highlightText(e),this.description&&this.descriptionView.highlightText(e)}}function getTranslation$2(e,t,...n){const i=e.t;switch(t){case'No templates were found matching "%0".':return i('No templates were found matching "%0".',...n);case"Please try a different phrase or check the spelling.":return i("Please try a different phrase or check the spelling.");case"No templates available.":return i("No templates available.");case"%0 templates found":return i("%0 templates found",...n);case"Search template":return i("Search template");case"Template":return i("Template");case"Insert template":return i("Insert template");default:return t}}class TemplateUI extends Plugin{static get pluginName(){return"TemplateUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this,t=e.config.get("template.definitions")||[];e.ui.componentFactory.add("insertTemplate",(n=>{const i=createDropdown(n),r=this._createTemplateListView(n,t),s=new SearchTextView(n,{filteredView:r,queryView:{label:getTranslation$2(n,"Search template")},class:"ck-template-form",infoView:{text:{notFound:{primary:e=>getTranslation$2(n,'No templates were found matching "%0".',e),secondary:getTranslation$2(n,"Please try a different phrase or check the spelling.")},noSearchableItems:{primary:getTranslation$2(n,"No templates available.")}}}}),o=e.commands.get("insertTemplate");return s.on("search",((t,i)=>{i.query&&i.query.length&&e.ui.ariaLiveAnnouncer.announce(getTranslation$2(n,"%0 templates found",i.resultsCount))})),i.bind("isEnabled").to(o),i.panelView.children.add(s),i.buttonView.set({label:getTranslation$2(n,"Insert template"),icon:icons.template,tooltip:!0}),i.on("change:isOpen",((e,t,n)=>{n||s.reset()})),i})),e.ui.componentFactory.add("menuBar:insertTemplate",(n=>{const i=e.commands.get("insertTemplate"),r=new MenuBarMenuView(n);r.buttonView.set({label:getTranslation$2(n,"Template"),icon:icons.template});const s=new MenuBarMenuListView(n);if(!t||!t.length){const t=new MenuBarMenuListItemView(n,r),i=new MenuBarMenuListItemButtonView(n);i.set({label:getTranslation$2(n,"No templates available.")}),i.delegate("execute").to(r),i.on("execute",(()=>{e.editing.view.focus()})),t.children.add(i),s.items.add(t)}for(const i of t){const t=new MenuBarMenuListItemView(n,r),o=new MenuBarMenuListItemButtonView(n);o.set({class:"ck-template-button",label:i.title,icon:i.icon||templateDefaultIcon}),o.delegate("execute").to(r),o.on("execute",(()=>{e.execute("insertTemplate",i.data),e.editing.view.focus()})),t.children.add(o),s.items.add(t)}return r.panelView.children.add(s),r.bind("isEnabled").to(i,"isEnabled"),r}))}afterInit(){checkLicense$2(this)}_createTemplateListView(e,t){const{editor:n}=this,i=new TemplateListView(e);return i.extendTemplate({attributes:{role:"listbox",class:["ck-template-list"]}}),i.items.addMany(t.map(((t,i)=>{const r=new TemplateListItemView(e,i),s=new TemplateListButtonView(e,t);return r.buttonView=s,r.children.add(s),r.buttonView.on("execute",(e=>{n.execute("insertTemplate",e.source.templateDefinition.data),n.editing.view.focus()})),r}))),i}}async function checkLicense$2(e){const t=g([49,98,120,53,100,86,121,71,102,117,119,118,87,112,48,75,69,85,89,97,108,77,106,113,70,122,65,68,80,67,83,54,56,99,51,79,88,73,74,57,103,66,115,116,78,90,81,84,114,111,82,104,50,107,52,76,55,109,72,110,105,101]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([98]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||(!!t[g([105,110,99,108,117,100,101,115])](g([84,80,76]))||(!!t[g([105,110,99,108,117,100,101,115])](g([80,80]))||!(!t[g([105,110,99,108,117,100,101,115])](g([68,82,85,80]))||!window[g([68,114,117,112,97,108])]))))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}class Template extends Plugin{static get requires(){return[TemplateEditing,TemplateUI]}static get pluginName(){return"Template"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}class TrackChangesCommand extends _0x338ed0{constructor(e,t){super(e),this._enabledCommands=t,this.value=!1,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(){this.value=!this.value,this.value?this._disableUnsupportedCommands():this._enableCommands()}_disableUnsupportedCommands(){for(const e of this.editor.commands.commands())e.affectsData&&!this._enabledCommands.has(e)&&e.forceDisabled("TrackChangesCommand")}_enableCommands(){for(const e of this.editor.commands.commands())e.affectsData&&!this._enabledCommands.has(e)&&e.clearForceDisabled("TrackChangesCommand")}}class AcceptSuggestionCommand extends _0x338ed0{constructor(e,t){super(e),this._suggestions=t,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-accept-suggestion-not-found",this);const n=t.getRanges();this.editor.model.canEditAt(n)&&this.editor.plugins.get("TrackChangesEditing").acceptSuggestion(t)}}class DiscardSuggestionCommand extends _0x338ed0{constructor(e,t){super(e),this._suggestions=t,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-discard-suggestion-not-found",this);const n=t.getRanges();this.editor.model.canEditAt(n)&&this.editor.plugins.get("TrackChangesEditing").discardSuggestion(t)}}function renderDescription(e,t){let n="";return n+=e.split("*").map(((e,t)=>t%2!=0?'<span class="ck-suggestion-type">'+sanitize(e)+"</span>":sanitize(e))).join(""),t&&(n+='<span class="ck-suggestion-color" style="background-color: '+t.value+'" title="'+t.title+'"></span>'),n}function sanitize(e){const t=document.createElement("span");return t.innerText=e,t.innerHTML}function sortSuggestions(e){return e.sort(((e,t)=>"deletion"==e.type&&"deletion"!=t.type?-1:"deletion"!=e.type&&"deletion"==t.type?1:0))}function getSelectedSuggestions(e,t){const n=Array.from(e.getRanges()),i=new Set;for(const r of t)if(r.isInContent)for(const t of n)for(const n of r.getRanges())(t.isIntersecting(n)||e.isCollapsed&&!r.isMultiRange&&r.next&&n.end.isTouching(t.start))&&i.add(r);return i}function getRangesOfBlockGroups(e,t){let n,i=0;const r=[],s=t.schema;for(;i<e.length;){const o=e[i],a=e[i+1];n||(n=t.createPositionBefore(o)),areNeighbourBlocks(t,o,a)||(r.push(t.createRange(n,s.isObject(o)?t.createPositionAfter(o):t.createPositionAt(o,"end"))),n=null),i++}return r}function areNeighbourBlocks(e,t,n){if(!n)return!1;const i=e.createPositionAfter(t),r=e.createPositionBefore(n);return i.isTouching(r)}const MAX_SUGGESTION_ACTIONS_IN_BATCH=100;function executeCommandForSuggestions(e,t,n){for(;n.length;){const i=n.splice(0,MAX_SUGGESTION_ACTIONS_IN_BATCH);e.change((()=>{for(const e of i)e.isInContent&&t.execute(e.id)}))}}class ExecuteOnAllSuggestionsCommand extends _0x338ed0{constructor(e,t,n){super(e),this._command=t,this._suggestions=n,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const e=Array.from(this._suggestions.values()).some((e=>e.isInContent));this.isEnabled=this._command.isEnabled&&e}execute(){const e=sortSuggestions(Array.from(this._suggestions.values()));for(const t of e){const e=t.getRanges();if(!this.editor.model.canEditAt(e))return}executeCommandForSuggestions(this.editor.model,this._command,e)}}class ExecuteOnSelectedSuggestionsCommand extends _0x338ed0{constructor(e,t,n){super(e),this._command=t,this._suggestions=n,this._selectedSuggestions=new Set,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const e=this.editor.model.document.selection,t=Array.from(this._suggestions.values());this._selectedSuggestions=getSelectedSuggestions(e,t),this.isEnabled=this._command.isEnabled&&!!this._selectedSuggestions.size}execute(){const e=sortSuggestions(Array.from(this._selectedSuggestions));for(const t of e){const e=t.getRanges();if(!this.editor.model.canEditAt(e))return}executeCommandForSuggestions(this.editor.model,this._command,e)}}class Suggestion extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t){super(),this._isDataLoaded=!1,this.id=t.id,this.type=t.type,this.subType=t.subType||null,this.author=t.author,this.creator=t.creator||t.author,this.isExternal=Boolean(t.attributes&&t.attributes["@external"]),this.data=null,this._model=e,this._onAccept=t.onAccept,this._onDiscard=t.onDiscard,this._onAttributesChange=t.onAttributesChange,this._markerNames=new Set,this.createdAt=null,this.set("authoredAt",null),this.set("attributes",t.attributes||{}),this.set("previous",null),this.set("next",null),this.set("commentThread",null),this.set("_saved",!1),this.decorate("accept"),this.decorate("discard")}get head(){let e=this;for(;e.previous;)e=e.previous;return e}get hasComments(){return!!this.commentThread&&this.commentThread.length>0}get isMultiRange(){return 0!=this._markerNames.size&&6==Array.from(this._markerNames)[0].split(":").length}get isInContent(){return null!==this.getFirstMarker()}addMarkerName(e){this._markerNames.add(e)}getMarkerNames(){return Array.from(this._markerNames)}getMarkers(){return this.getMarkerNames().map((e=>this._model.markers.get(e))).filter((e=>e))}getFirstMarker(){return this.getMarkers()[0]||null}removeMarkers(){this._model.change((e=>{for(const t of this.getMarkers())e.removeMarker(t)})),this._markerNames.clear()}removeMarker(e){this._model.change((t=>{t.removeMarker(e)})),this._markerNames.delete(e)}addRange(e){const t="suggestion:"+this.type+":"+this.subType+":"+this.id+":"+this.creator.id+":"+Suggestion.getMultiRangeId();this.addMarkerName(t),this._model.change((n=>{n.addMarker(t,{range:e,usingOperation:!0,affectsData:!0})}))}isIntersectingWithRange(e){for(const t of this.getRanges())if(t.isIntersecting(e))return!0;return!1}getRanges(){return this.getMarkers().map((e=>e.getRange()))}getItems(){return this.getRanges().reduce(((e,t)=>[...e,...t.getItems()]),[])}getFirstRange(){var e;return(null===(e=this.getFirstMarker())||void 0===e?void 0:e.getRange())||null}getContainedElement(){const e=this.getRanges();if(1!=e.length)return null;const t=e[0],n=t.start.nodeAfter,i=t.end.nodeBefore;return n instanceof Element$3?n!=i?null:n:null}accept(){this._onAccept(this.getRanges(),this.data,this.attributes),this.removeMarkers()}discard(){this._onDiscard(this.getRanges(),this.data,this.attributes),this.removeMarkers()}getAllAdjacentSuggestions(){const e=[];let t=this.head;for(;t;)e.push(t),t=t.next;return e}setAttribute(e,t){const n=cloneDeep(this.attributes);set$1(n,e,t),isEqual(n,this.attributes)||(this.attributes=n,this._onAttributesChange(n))}removeAttribute(e){const t=cloneDeep(this.attributes);unset(t,e),isEqual(t,this.attributes)||(this.attributes=t,this._onAttributesChange(this.attributes))}toJSON(){return{id:this.id,type:this.subType?this.type+":"+this.subType:this.type,authorId:this.creator.id,createdAt:this.createdAt,hasComments:this.hasComments,data:this.data,attributes:this.attributes}}static getMultiRangeId(){return uid().substr(1,5)}}function getTranslation$1(e,t,n){const i=e.t,r=e.t;switch(t){case"Track changes":return r("Track changes");case"Accept suggestion":return r("Accept suggestion");case"Discard suggestion":return r("Discard suggestion");case"Accept all suggestions":return r("Accept all suggestions");case"Accept all selected suggestions":return r("Accept all selected suggestions");case"Discard all suggestions":return r("Discard all suggestions");case"Discard all selected suggestions":return r("Discard all selected suggestions");case"Preview final content":return r("Preview final content");case"Final content preview":return r("Final content preview");case"*Reset font size*":return r("*Reset font size*");case"*Reset font family*":return r("*Reset font family*");case"*Reset font color*":return r("*Reset font color*");case"*Reset font background color*":return r("*Reset font background color*");case"*Remove image text alternative*":return r("*Remove image text alternative*");case"*Reset image width*":return r("*Reset image width*");case"*Remove link*":return r("*Remove link*");case"*Check item*":return r("*Check item*");case"*Uncheck item*":return r("*Uncheck item*");case"*Remove all formatting*":return r("*Remove all formatting*");case"*Replace table cells*":return r("*Replace table cells*");case"*Merge cells*":return r("*Merge cells*");case"*Split cell:* vertically":return r("*Split cell:* vertically");case"*Split cell:* horizontally":return r("*Split cell:* horizontally");case"*Indent:* %0":return r("*Indent:* %0",n);case"*Outdent:* %0":return r("*Outdent:* %0",n);case"*Change to:* %0":return r("*Change to:* %0",n);case"*Insert:* %0":return r("*Insert:* %0",n);case"*Format:* %0":return r("*Format:* %0",n);case"*Format:* change table properties":return r("*Format:* change table properties");case"*Format:* change table cell properties":return r("*Format:* change table cell properties");case"*Format:* insert into %0":return r("*Format:* insert into %0",n);case"*Format:* remove from %0":return r("*Format:* remove from %0",n);case"*Replace image*":return r("*Replace image*");case"*Format:* resize table":return r("*Format:* resize table");case"*Format:* set order to reversed":return r("*Format:* set order to reversed");case"*Format:* set order to regular":return r("*Format:* set order to regular");case"*Format:* set start index to %0":return r("*Format:* set start index to %0",n);case"*Change %0 content*":return r("*Change %0 content*",n);case"*Remove:* %0":return r("*Remove:* %0",n);case"*Merge:* %0":return r("*Merge:* %0",n);case"*Split:* %0":return r("*Split:* %0",n);case"*Remove format:* %0":return r("*Remove format:* %0",n);case"*Set bookmark:* %0":return r("*Set bookmark:* %0",n);case"*Set font size:* %0":return r("*Set font size:* %0",n);case"*Set font family:* %0":return r("*Set font family:* %0",n);case"*Set format to:* %0":return r("*Set format to:* %0",n);case"*Set font color:* %0":return r("*Set font color:* %0",n);case"*Set font background color:* %0":return r("*Set font background color:* %0",n);case"*Set format:* %0":return r("*Set format:* %0",n);case"*Set image text alternative:* %0":return r("*Set image text alternative:* %0",n);case"*Set image width:* %0":return r("*Set image width:* %0",n);case"*Set link:* %0":return r("*Set link:* %0",n);case"*Set highlight:* %0":return r("*Set highlight:* %0",n);case"*Remove highlight*":return r("*Remove highlight*");case"FORMAT_HIGHLIGHT":return r({string:"highlight",id:"FORMAT_HIGHLIGHT"});case"FORMAT_RESTRICTED_ENABLED":return r({string:"*Enable in restricted editing mode*",id:"FORMAT_RESTRICTED_ENABLED"});case"FORMAT_RESTRICTED_DISABLED":return r({string:"*Disable in restricted editing mode*",id:"FORMAT_RESTRICTED_DISABLED"});case"ELEMENT_TABLE":return r({string:"table",plural:"%0 tables",id:"ELEMENT_TABLE"},n);case"ELEMENT_PARAGRAPH":return r({string:"paragraph",plural:"%0 paragraphs",id:"ELEMENT_PARAGRAPH"},n);case"ELEMENT_PAGE_BREAK":return r({string:"page break",plural:"%0 page breaks",id:"ELEMENT_PAGE_BREAK"},n);case"ELEMENT_MEDIA":return r({string:"media item",plural:"%0 media items",id:"ELEMENT_MEDIA"},n);case"ELEMENT_IMAGE":return r({string:"image",plural:"%0 images",id:"ELEMENT_IMAGE"},n);case"ELEMENT_INLINE_IMAGE":return r({string:"image",plural:"%0 images",id:"ELEMENT_INLINE_IMAGE"},n);case"FORMAT_SIDE_IMAGE":return r({string:"side image",id:"FORMAT_SIDE_IMAGE"});case"ELEMENT_CAPTION":return r({string:"caption",id:"ELEMENT_CAPTION"});case"ELEMENT_HORIZONTAL_LINE":return r({string:"horizontal line",plural:"%0 horizontal lines",id:"ELEMENT_HORIZONTAL_LINE"},n);case"ELEMENT_HTML_EMBED":return r({string:"HTML embed",plural:"%0 HTML embeds",id:"ELEMENT_HTML_EMBED"},n);case"ELEMENT_HEADING":return r({string:"heading (level %1)",plural:"%0 headings (level %1)",id:"ELEMENT_HEADING"},n);case"ELEMENT_HEADING_CUSTOM":return r({string:"heading (%1)",plural:"%0 headings (%1)",id:"ELEMENT_HEADING_CUSTOM"},n);case"ELEMENT_LIST_ITEM":return r({string:"list item",plural:"%0 list items",id:"ELEMENT_LIST_ITEM"},n);case"ELEMENT_DEFAULT_LIST_DEFAULT":return r({string:"default list style",id:"ELEMENT_DEFAULT_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST":return r({string:"bulleted list",id:"ELEMENT_BULLETED_LIST"});case"ELEMENT_BULLETED_LIST_DEFAULT":return r({string:"bulleted list (default)",id:"ELEMENT_BULLETED_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST_CIRCLE":return r({string:"bulleted list (circle)",id:"ELEMENT_BULLETED_LIST_CIRCLE"});case"ELEMENT_BULLETED_LIST_DISC":return r({string:"bulleted list (disc)",id:"ELEMENT_BULLETED_LIST_DISC"});case"ELEMENT_BULLETED_LIST_SQUARE":return r({string:"bulleted list (square)",id:"ELEMENT_BULLETED_LIST_SQUARE"});case"ELEMENT_NUMBERED_LIST_DEFAULT":return r({string:"numbered list (default)",id:"ELEMENT_NUMBERED_LIST_DEFAULT"});case"ELEMENT_NUMBERED_LIST":return r({string:"numbered list",id:"ELEMENT_NUMBERED_LIST"});case"ELEMENT_NUMBERED_LIST_DECIMAL":return r({string:"numbered list (decimal)",id:"ELEMENT_NUMBERED_LIST_DECIMAL"});case"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO":return r({string:"numbered list (decimal with leading zero)",id:"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO"});case"ELEMENT_NUMBERED_LIST_LOWER_LATIN":return r({string:"numbered list (lower-latin)",id:"ELEMENT_NUMBERED_LIST_LOWER_LATIN"});case"ELEMENT_NUMBERED_LIST_LOWER_ROMAN":return r({string:"numbered list (lower-roman)",id:"ELEMENT_NUMBERED_LIST_LOWER_ROMAN"});case"ELEMENT_NUMBERED_LIST_UPPER_LATIN":return r({string:"numbered list (upper-latin)",id:"ELEMENT_NUMBERED_LIST_UPPER_LATIN"});case"ELEMENT_NUMBERED_LIST_UPPER_ROMAN":return r({string:"numbered list (upper-roman)",id:"ELEMENT_NUMBERED_LIST_UPPER_ROMAN"});case"ELEMENT_TODO_LIST":return r({string:"to-do list",id:"ELEMENT_TODO_LIST"});case"ELEMENT_MULTI_LEVEL_LIST":return r({string:"multi-level list",id:"ELEMENT_MULTI_LEVEL_LIST"});case"REPLACE_TEXT":return r({string:"*Replace:* %0 *with* %1",id:"REPLACE_TEXT"},n);case"ELEMENT_SPACE":return r({string:"space",plural:"%0 spaces",id:"ELEMENT_SPACE"},n);case"FORMAT_ALIGNMENT":return r({string:"alignment",id:"FORMAT_ALIGNMENT"});case"FORMAT_ALIGN_TO_LEFT":return r({string:"align to left",id:"FORMAT_ALIGN_TO_LEFT"});case"FORMAT_ALIGN_TO_RIGHT":return r({string:"align to right",id:"FORMAT_ALIGN_TO_RIGHT"});case"FORMAT_ALIGN_TO_CENTER":return r({string:"align to center",id:"FORMAT_ALIGN_TO_CENTER"});case"FORMAT_JUSTIFY_TEXT":return r({string:"justify",id:"FORMAT_JUSTIFY_TEXT"});case"FORMAT_BOLD":return r({string:"bold",id:"FORMAT_BOLD"});case"FORMAT_ITALIC":return r({string:"italic",id:"FORMAT_ITALIC"});case"FORMAT_UNDERLINE":return r({string:"underline",id:"FORMAT_UNDERLINE"});case"FORMAT_CODE":return r({string:"code",id:"FORMAT_CODE"});case"FORMAT_STRIKETHROUGH":return r({string:"strikethrough",id:"FORMAT_STRIKETHROUGH"});case"FORMAT_SUBSCRIPT":return r({string:"subscript",id:"FORMAT_SUBSCRIPT"});case"FORMAT_SUPERSCRIPT":return r({string:"superscript",id:"FORMAT_SUPERSCRIPT"});case"ELEMENT_BLOCK_QUOTE":return r({string:"block quote",id:"ELEMENT_BLOCK_QUOTE"});case"ELEMENT_CODE_BLOCK":return r({string:"code block",plural:"%0 code blocks",id:"ELEMENT_CODE_BLOCK"},n);case"FORMAT_HEADER_COLUMN":return r({string:"header column",id:"FORMAT_HEADER_COLUMN"});case"FORMAT_REGULAR_COLUMN":return r({string:"regular column",id:"FORMAT_REGULAR_COLUMN"});case"FORMAT_HEADER_ROW":return r({string:"header row",id:"FORMAT_HEADER_ROW"});case"FORMAT_REGULAR_ROW":return r({string:"regular row",id:"FORMAT_REGULAR_ROW"});case"FORMAT_INDENT":return r({string:"indent",id:"FORMAT_INDENT"});case"FORMAT_LIST_REVERSED":return r({string:"list reversed",id:"FORMAT_LIST_REVERSED"});case"FORMAT_LIST_START":return r({string:"list start",id:"FORMAT_LIST_START"});case"FORMAT_FONT_SIZE":return r({string:"font size",id:"FORMAT_FONT_SIZE"});case"FORMAT_FONT_FAMILY":return r({string:"font family",id:"FORMAT_FONT_FAMILY"});case"FORMAT_FONT_COLOR":return r({string:"font color",id:"FORMAT_FONT_COLOR"});case"FORMAT_FONT_BACKGROUND":return r({string:"font background color",id:"FORMAT_FONT_BACKGROUND"});case"FORMAT_IMAGE_SIZE":return r({string:"image size",id:"FORMAT_IMAGE_SIZE"});case"FORMAT_STYLE":return r({string:"style",id:"FORMAT_STYLE"});case"PENDING_ACTION_SUGGESTION":return r({string:"Unsaved change in suggestion.",id:"PENDING_ACTION_SUGGESTION"});case"ELEMENT_TABLE_WITH_TEXT":return r({string:"table *with text* %0",id:"ELEMENT_TABLE_WITH_TEXT"},n);case"ELEMENT_TABLE_ROW":return r({string:"table row",plural:"%0 table rows",id:"ELEMENT_TABLE_ROW"},n);case"ELEMENT_TABLE_ROW_WITH_TEXT":return r({string:"table row *with text* %1",plural:"%0 table rows *with text* %1",id:"ELEMENT_TABLE_ROW_WITH_TEXT"},n);case"ELEMENT_TABLE_COLUMN":return r({string:"table column",plural:"%0 table columns",id:"ELEMENT_TABLE_COLUMN"},n);case"ELEMENT_TABLE_COLUMN_WITH_TEXT":return r({string:"table column *with text* %1",plural:"%0 table columns *with text* %1",id:"ELEMENT_TABLE_COLUMN_WITH_TEXT"},n);case"ELEMENT_TABLE_OF_CONTENTS":return r({string:"table of contents",plural:"%0 tables of contents",id:"ELEMENT_TABLE_OF_CONTENTS"},n);case"ELEMENT_LINE_BREAK":return r({id:"ELEMENT_LINE_BREAK",string:"line break",plural:"%0 line breaks"},n);case"ELEMENT_TITLE":return r({id:"ELEMENT_TITLE",string:"title"});case"ELEMENT_MERGE_FIELD":return r({id:"ELEMENT_MERGE_FIELD",string:"merge field",plural:"%0 merge fields"},n);case"ELEMENT_BOOKMARK":return r({id:"ELEMENT_BOOKMARK",string:"bookmark",plural:"%0 bookmarks"},n);case"EXTERNAL_SUGGESTION":return r({id:"EXTERNAL_SUGGESTION",string:"This suggestion comes from an external source."});case"EXTERNAL_IMPORT_WORD_SUGGESTION":return r({string:"This suggestion comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_SUGGESTION"});case"EXTERNAL_AVATAR":return i({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},n);case"EXTERNAL_IMPORT_WORD_AVATAR":return i({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},n);case"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering insertion suggestion. Press %0 to go to the discussion.",id:"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving insertion suggestion.",id:"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering deletion suggestion. Press %0 to go to the discussion.",id:"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving deletion suggestion.",id:"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT":return r({string:"Entering formatting suggestion. Press %0 to go to the discussion.",id:"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT"},n);case"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT":return r({string:"Leaving formatting suggestion.",id:"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT"});case"SUGGESTION_THREAD_ARIA_LABEL":return r({string:"Suggestion by %1. Created on %2. %0 reply. %3",plural:"Suggestion by %1. Created on %2. %0 replies. %3",id:"SUGGESTION_THREAD_ARIA_LABEL"},n);case"SUGGESTION_THREAD_DESCRIPTION":return r({string:"Press Enter for more options. Press Escape to exit.",id:"SUGGESTION_THREAD_DESCRIPTION"});default:return t}}class SuggestionDescriptionFactory{constructor(e,t){this._customCallbacks=[],this._itemLabels=new Map,this._itemLabelsCallbacks=[],this._attributeLabels=new Map,this._schema=e,this._locale=t}getDescriptions(e){const t=[],n=new Set,i=new Set;for(let r=0;r<e.length;r++){const s=e[r];if(!s.isInContent)continue;const o=this._handleCustomCallbackDescription(s);if(o){if(null!=s.subType){if(n.has(s.subType))continue;n.add(s.subType)}t.push(o)}else if("attribute"!=s.type)"insertion"!=s.type&&"deletion"!=s.type||this._handleInsertRemoveSuggestionDescription(t,s,e[r+1]);else{const e=s.data.key;if(i.has(e))continue;i.add(s.data.key),e==renameAttributeKey?this._handleRenameSuggestionDescription(t,s):this._handleAttributeSuggestionDescription(t,s)}}return this._resolveDescriptionItems(t)}registerDescriptionCallback(e){this._customCallbacks.push(e)}registerElementLabel(e,t,n=priorities.normal){"function"==typeof e?insertToPriorityArray(this._itemLabelsCallbacks,{matchingCallback:e,label:t,priority:n}):this._itemLabels.set(e,t)}registerAttributeLabel(e,t){this._attributeLabels.set(e,t)}getItemLabel(e,t=1){let n;for(const t of this._itemLabelsCallbacks)if(t.matchingCallback(e)){n=t.label;break}return n||(n=this._itemLabels.get(e.name)),n?n(t):1!==t?t+" "+e.name+"s":""+e.name}_addDescriptionItems(e,t){const n=t.getFirstRange().getWalker(),i="insertion"==t.type?"add":"remove";for(const t of n){const r=t.item,s=e[e.length-1];if(r.is("$textProxy"))s&&s.type.indexOf("Container")>-1&&e.pop(),s&&"text"==s.type?s[i]+=r.data:e.push({type:"text",add:"add"==i?r.data:"",remove:"remove"==i?r.data:""});else if(this._schema.isObject(r)){const o=r;if(s&&s.type.indexOf("Container")>-1&&e.pop(),"elementEnd"==t.type)continue;s&&s.type==i+"Object"&&s.element.name==o.name?s.quantity++:e.push({type:i+"Object",element:o,quantity:1}),n.skip((e=>!("elementEnd"==e.type&&e.item==r)))}else if(this._schema.checkChild(r,"$text")||r.is("element","softBreak")){const n=r;if("add"==i&&"elementStart"==t.type||"remove"==i&&"elementEnd"==t.type)continue;if(s&&-1==s.type.indexOf("Container")){"text"==s.type&&(s[i]+="\n");continue}let o;if(o="add"==i?n.nextSibling&&!this._schema.isObject(n.nextSibling)?n.nextSibling:null:n.previousSibling&&!this._schema.isObject(n.previousSibling)?n.previousSibling:null,n.isEmpty||o&&o.isEmpty){const t=o&&o.isEmpty?o:n;s&&s.type==i+"EmptyContainer"&&s.element.name==t.name?s.quantity++:e.push({type:i+"EmptyContainer",element:t,quantity:1})}else e.push({type:i+"Container",element:n})}}}_resolveDescriptionItems(e){const t=this._locale,n=[],i=[],r=[];for(const s of e)switch(s.type){case"text":if(s.add=s.add.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),s.remove=s.remove.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),""!=s.add&&""!=s.remove){n.push({type:"replace",content:getTranslation$1(t,"REPLACE_TEXT",['"'+s.remove+'"','"'+s.add+'"'])});continue}if(null!=s.add.match(/^ +$/)){n.push({type:"insertion",content:getTranslation$1(t,"*Insert:* %0",getTranslation$1(t,"ELEMENT_SPACE",s.add.length))});continue}if(null!=s.remove.match(/^ +$/)){n.push({type:"deletion",content:getTranslation$1(t,"*Remove:* %0",getTranslation$1(t,"ELEMENT_SPACE",s.remove.length))});continue}if(""!=s.add){n.push({type:"insertion",content:getTranslation$1(t,"*Insert:* %0",'"'+s.add+'"')});continue}n.push({type:"deletion",content:getTranslation$1(t,"*Remove:* %0",'"'+s.remove+'"')});continue;case"addEmptyContainer":case"addObject":n.push({type:"insertion",content:getTranslation$1(t,"*Insert:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"removeEmptyContainer":case"removeObject":n.push({type:"deletion",content:getTranslation$1(t,"*Remove:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"addContainer":n.push({type:"insertion",content:getTranslation$1(t,"*Split:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"removeContainer":n.push({type:"deletion",content:getTranslation$1(t,"*Merge:* %0",this.getItemLabel(s.element,s.quantity))});continue;case"addFormat":i.push(s.key);continue;case"removeFormat":r.push(s.key);continue;default:n.push(s)}if(i.length){const e=i.map((e=>this._attributeLabels.has(e)?this._attributeLabels.get(e):e)).join(", ");n.push({type:"format",content:getTranslation$1(this._locale,"*Set format:* %0",e)})}if(r.length){const e=r.map((e=>this._attributeLabels.has(e)?this._attributeLabels.get(e):e)).join(", ");n.push({type:"format",content:getTranslation$1(this._locale,"*Remove format:* %0",e)})}return n}_handleCustomCallbackDescription(e){for(const t of this._customCallbacks){const n=t(e);if(n&&"type"in n)return n}}_handleAttributeSuggestionDescription(e,t){const n=t.data,i=void 0===n.newValue?"removeFormat":"addFormat";e.push({type:i,key:n.key})}_handleRenameSuggestionDescription(e,t){e.push({type:"format",content:getTranslation$1(this._locale,"*Change to:* %0",this.getItemLabel(t.getFirstRange().start.nodeAfter,1))})}_handleInsertRemoveSuggestionDescription(e,t,n){if(this._addDescriptionItems(e,t),n&&n.getFirstRange()&&!t.getFirstRange().end.isEqual(n.getFirstRange().start)){const n=e[e.length-1],i="insertion"==t.type?"add":"remove";n&&"text"==n.type&&(n[i]+="\n")}}}class TrackChangesAIAssistant extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.commands.get("showAIAssistant")&&t.enableCommand("showAIAssistant")}}class TrackChangesAlignment extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("AlignmentEditing"))return;const n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("alignment"),n.registerBlockAttribute("alignment"),n.descriptionFactory.registerAttributeLabel("alignment",getTranslation$1(t,"FORMAT_ALIGNMENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"alignment"==n.commandName){const e=n.commandParams[0].value;return{type:"format",content:getTranslation$1(t,"*Format:* %0",function(e){switch(e){case"left":return getTranslation$1(t,"FORMAT_ALIGN_TO_LEFT");case"right":return getTranslation$1(t,"FORMAT_ALIGN_TO_RIGHT");case"center":return getTranslation$1(t,"FORMAT_ALIGN_TO_CENTER");case"justify":return getTranslation$1(t,"FORMAT_JUSTIFY_TEXT")}}(e))}}}))}}const basicStylesPlugins=["BoldEditing","ItalicEditing","UnderlineEditing","CodeEditing","StrikethroughEditing","SubscriptEditing","SuperscriptEditing"];class TrackChangesBasicStyles extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.locale;for(const i of basicStylesPlugins){if(!e.plugins.has(i))continue;const r=i.slice(0,-7).toLowerCase(),s="FORMAT_"+r.toUpperCase();t.enableDefaultAttributesIntegration(r),t.registerInlineAttribute(r),t.descriptionFactory.registerAttributeLabel(r,getTranslation$1(n,s))}this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");function i(e,i){n.descriptionFactory.registerDescriptionCallback((n=>{if("formatInline"!=n.type)return;const{data:r}=n;return r&&r.commandName===e?r.commandParams[0].forceValue?{type:"format",content:getTranslation$1(t,"*Format:* %0",i)}:{type:"format",content:getTranslation$1(t,"*Remove format:* %0",i)}:void 0}))}i("bold",getTranslation$1(t,"FORMAT_BOLD")),i("italic",getTranslation$1(t,"FORMAT_ITALIC")),i("underline",getTranslation$1(t,"FORMAT_UNDERLINE")),i("code",getTranslation$1(t,"FORMAT_CODE")),i("strikethrough",getTranslation$1(t,"FORMAT_STRIKETHROUGH")),i("subscript",getTranslation$1(t,"FORMAT_SUBSCRIPT")),i("superscript",getTranslation$1(t,"FORMAT_SUPERSCRIPT"))}}class TrackChangesBlockQuote extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("BlockQuoteEditing"))return;const n=e.plugins.get("TrackChangesEditing"),i=this.editor.commands.get("blockQuote");n.enableCommand("blockQuote",((t,r={})=>{const s=this.editor.model.document.selection,o=r&&void 0!==r.forceValue?r.forceValue:!i.value;let a=[];if(o){const t=Array.from(s.getSelectedBlocks()).filter((e=>isInQuote(e)||checkCanBeQuoted(e,this.editor.model.schema)));a=getRangesOfBlockGroups(t,e.model)}else{const t=Array.from(s.getSelectedBlocks()).filter((e=>isInQuote(e)));a=getRangesOfBlockGroups(t,e.model)}e.model.change((()=>{for(const e of a)n.markBlockFormat(e,{commandName:"blockQuote",commandParams:[{forceValue:o}]})}))})),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(n&&"blockQuote"==n.commandName){const e=getTranslation$1(t,"ELEMENT_BLOCK_QUOTE");return n.commandParams[0].forceValue?{type:"format",content:getTranslation$1(t,"*Set format:* %0",e)}:{type:"format",content:getTranslation$1(t,"*Remove format:* %0",e)}}}))}}function checkCanBeQuoted(e,t){const n=t.checkChild(e.parent,"blockQuote"),i=t.checkChild(["$root","blockQuote"],e);return n&&i}function isInQuote(e){return"blockQuote"==e.parent.name}class TrackChangesBookmark extends Plugin{afterInit(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");e.plugins.has("BookmarkEditing")&&(n.enableCommand("insertBookmark"),n.enableDefaultAttributesIntegration("updateBookmark"),n.registerBlockAttribute("bookmarkId"),n.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"!=e.type&&"deletion"!=e.type&&"attribute"!=e.type)return;const n=e.getContainedElement();if(null==n)return;if(!n.is("element","bookmark"))return;const i=n.getAttribute("bookmarkId");if("insertion"==e.type)return{type:"insertion",content:getTranslation$1(t,"*Insert:* %0",'"'+i+'" '+getTranslation$1(t,"ELEMENT_BOOKMARK"))};if("deletion"==e.type)return{type:"deletion",content:getTranslation$1(t,"*Remove:* %0",'"'+i+'" '+getTranslation$1(t,"ELEMENT_BOOKMARK"))};const{data:r}=e;return r&&"bookmarkId"==r.key?{type:"format",content:getTranslation$1(t,"*Set bookmark:* %0",'"'+r.newValue+'"')}:void 0})))}}class TrackChangesCaseChange extends Plugin{afterInit(){const e=this.editor;e.plugins.has("CaseChange")&&(e.plugins.get("TrackChangesEditing").enableCommand("changeCaseUpper"),e.plugins.get("TrackChangesEditing").enableCommand("changeCaseLower"),e.plugins.get("TrackChangesEditing").enableCommand("changeCaseTitle"))}}class TrackChangesCKBox extends Plugin{afterInit(){const e=this.editor;e.commands.get("ckbox")&&e.plugins.get("TrackChangesEditing").enableCommand("ckbox")}}class TrackChangesCodeBlock extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("CodeBlock"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale,i=e.config.get("codeBlock").languages,r=e.commands.get("codeBlock");t.enableCommand("indentCodeBlock"),t.enableCommand("outdentCodeBlock"),t.enableCommand("codeBlock",((n,s={})=>{const o=e.model,a=e.model.document.selection,l=s&&void 0!==s.forceValue?s.forceValue:!r.value;let c;s.language||(s.language=i[0].language),c=l?Array.from(a.getSelectedBlocks()).filter((e=>isCodeBlock(e)||canBeCodeBlock(e,o.schema))):Array.from(a.getSelectedBlocks()).filter((e=>isCodeBlock(e)));const d=getRangesOfBlockGroups(c,o);o.change((()=>{for(const e of d)t.markBlockFormat(e,{commandName:"codeBlock",commandParams:[{...s,forceValue:l}],formatGroupId:"blockName"})}))})),t.descriptionFactory.registerElementLabel("codeBlock",(e=>getTranslation$1(n,"ELEMENT_CODE_BLOCK",e))),t.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const t=n.t,{data:r}=e;if(!r||"codeBlock"!=r.commandName)return;const s=r.commandParams[0].language,o=t(i.find((e=>e.language===s)).label).toLowerCase();return r.commandParams[0].forceValue?{type:"format",content:getTranslation$1(n,"*Set format:* %0",getTranslation$1(n,"ELEMENT_CODE_BLOCK",1)+" ("+o+")")}:{type:"format",content:getTranslation$1(n,"*Remove format:* %0",getTranslation$1(n,"ELEMENT_CODE_BLOCK",1))}}))}}function canBeCodeBlock(e,t){return!e.is("rootElement")&&!t.isLimit(e)&&t.checkChild(e.parent,"codeBlock")}function isCodeBlock(e){return"codeBlock"==e.name}class TrackChangesComments extends Plugin{afterInit(){const e=this.editor;e.plugins.has("CommentsEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("addCommentThread")}}function getRangesWithAttribute(e,t,n){const i=[];for(const r of t.getItems())r.hasAttribute(e)&&i.push(n.createRangeOn(r));return i}function downcastSplitMergeMarker$1(e,t,{showActiveMarker:n=!0}={}){const i=e.plugins.get("TrackChangesEditing");return(r,s,o)=>{if(!o.consumable.test(s.markerRange,r.name))return;const a=s.markerRange.getWalker(),l=s.markerRange.start,c=e.model.schema;let d=null,u=null,h=!1,m=!1;for(const e of a){const t=e.item;h=h||c.isContent(t);const n=o.mapper.toViewElement(t);if(n&&n.getCustomProperty("addHighlight"))return;"elementEnd"==e.type&&c.isBlock(t)&&!c.isLimit(t)&&(t.nextSibling||l.isAtEnd?d&&d.parent==t||(d=t,g(e.previousPosition),m=!0):u=u||e.previousPosition)}function g(e){const{authorId:r}=i._splitMarkerName(s.markerName),a=o.writer.createUIElement("span",{class:"ck-suggestion-marker-"+t,"data-author-id":r}),l=o.mapper.toViewPosition(e);n&&i.activeMarkers.includes(s.markerName)&&o.writer.addClass("ck-suggestion-marker--active",a),o.writer.insert(l,a),o.mapper.bindElementToMarker(a,s.markerName)}h||m||!u||g(u)}}class TrackChangesDeleteCommand extends Plugin{static get requires(){return[Delete]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");t.enableCommand("delete");const n=e.commands.get("deleteForward");t.enableCommand("deleteForward",((t,i={})=>{const r=e.model.createSelection(e.model.document.selection);r.isCollapsed&&e.model.modifySelection(r,{direction:"forward",unit:i.unit});const s=r.getFirstRange(),o=LiveRange.fromRange(s);let a;t(i),a="$graveyard"==o.root.rootName?e.model.createRange(s.start):e.model.createRange(o.start,o.end),o.detach(),e.model.enqueueChange(n.buffer.batch,(e=>{n.buffer.lock(),e.setSelection(e.createRange(a.end)),n.buffer.unlock()}))})),e.editing.downcastDispatcher.on("addMarker:suggestion:deletion",downcastSplitMergeMarker$1(e,"merge"),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion:deletion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker$1(e,"merge",{showActiveMarker:!1}).bind(this)(t,n,i)}),{priority:"high"}),e.editing.downcastDispatcher.on("removeMarker:suggestion:deletion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.is("uiElement")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"})}}class TrackChangesList extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ListEditing"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing"),i=e.plugins.has("TodoListEditing"),r=!!e.config.get("list.multiBlock");function s(e){return{type:"format",content:""+getTranslation$1(t,"*Set format:* %0",e)}}function o(e){return{type:"format",content:""+getTranslation$1(t,"*Remove format:* %0",e)}}n.enableDefaultAttributesIntegration("numberedList"),n.enableDefaultAttributesIntegration("bulletedList"),n.enableDefaultAttributesIntegration("customNumberedList"),n.enableDefaultAttributesIntegration("customBulletedList"),n.enableDefaultAttributesIntegration("indentList"),n.enableDefaultAttributesIntegration("outdentList"),n.enableDefaultAttributesIntegration("splitListItemAfter"),n.enableDefaultAttributesIntegration("splitListItemBefore"),n.registerBlockAttribute("listItemId"),n.registerBlockAttribute("listType"),n.registerBlockAttribute("listIndent"),r&&(n.enableDefaultAttributesIntegration("mergeListItemBackward"),n.enableDefaultAttributesIntegration("mergeListItemForward")),i&&(n.enableDefaultAttributesIntegration("todoList"),n.enableDefaultAttributesIntegration("checkTodoList"),n.registerBlockAttribute("todoListChecked"),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(n&&"todoListChecked"==n.key)return{type:"format",content:n.newValue?getTranslation$1(t,"*Check item*"):getTranslation$1(t,"*Uncheck item*")}})),this.editor.model.document.registerPostFixer((e=>{if(e.batch.isUndo)return!1;let t=!1;const i=n.getSuggestions({skipNotAttached:!0}).filter((e=>"todoListChecked"===n._getAttributeKey(e)));for(const r of i)"todo"!=r.getFirstRange().start.nodeAfter.getAttribute("listType")&&(n._findSuggestions(r.getFirstRange(),"attribute").find((e=>"listType"===n._getAttributeKey(e.suggestion)))||(e.removeMarker(r.getFirstMarker()),t=!0));return t}))),n.descriptionFactory.registerAttributeLabel("listIndent",getTranslation$1(t,"FORMAT_INDENT"));const a={type:"format",content:""};n.descriptionFactory.registerDescriptionCallback((e=>{const{data:n}=e;if(!n||"listType"!=n.key)return;let i=e.head;for(;i;){if(i.data&&(("listStyle"==i.data.key||"listMarkerStyle"==i.data.key)&&(i.data.newValue&&"default"!=i.data.newValue||"default"!=i.data.oldValue&&!n.newValue)||!r&&i.data.key==renameAttributeKey))return a;i=i.next}if(null==n.newValue)switch(n.oldValue){case"bulleted":return o(getTranslation$1(t,"ELEMENT_BULLETED_LIST"));case"numbered":return o(getTranslation$1(t,"ELEMENT_NUMBERED_LIST"));case"todo":return o(getTranslation$1(t,"ELEMENT_TODO_LIST"))}switch(n.newValue){case"bulleted":return s(getTranslation$1(t,"ELEMENT_BULLETED_LIST"));case"numbered":return s(getTranslation$1(t,"ELEMENT_NUMBERED_LIST"));case"todo":return s(getTranslation$1(t,"ELEMENT_TODO_LIST"))}})),n.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listIndent"==t.key)return null==t.newValue||null==t.oldValue&&0==t.newValue?a:void 0})),n.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:n}=e;if(!n||"listItemId"!=n.key)return;const i=checkSiblingsListItemId(e);return"newValue"==i?{type:"format",content:getTranslation$1(t,"*Merge:* list item")}:"oldValue"==i?{type:"format",content:getTranslation$1(t,"*Split:* list item")}:a})),e.model.document.registerPostFixer((e=>this.listItemIdFixer(e))),e.model.document.registerPostFixer((e=>this.noTrackChangesFixer(e))),e.model.document.on("change:data",((e,t)=>{if(t.isUndo||!t.isLocal)return!1;this.assureChains()}),{priority:"high"}),this._supportLegacySuggestions()}listItemIdFixer(e){if(e.batch.isUndo||!e.batch.isLocal)return!1;let t=!1;const n=this.editor.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0}).filter((e=>e.data&&"listItemId"==e.data.key)).filter((e=>e.data.newValue&&e.data.oldValue));for(const i of n)checkSiblingsListItemId(i)||(e.removeMarker(i.getFirstMarker()),t=!0);return t}noTrackChangesFixer(e){if(e.batch.isUndo||!e.batch.isLocal)return!1;const t=this.editor.plugins.get("TrackChangesEditing");if(t.trackChangesCommand.value)return!1;let n=!1;const i=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"],r=this.editor.model.document.differ.getChanges().filter((e=>"attribute"==e.type)).filter((e=>i.includes(e.attributeKey)));if(0==r.length)return n;for(const s of r){const r=t._findSuggestions(s.range,"attribute").filter((e=>!e.meta.isNextTo)).map((e=>e.suggestion)).filter((e=>{const n=t._getAttributeKey(e);return i.includes(n)}));if(r.length){for(const t of r)e.removeMarker(t.getFirstMarker());n=!0}}return n}assureChains(){const e=this.editor.plugins.get("TrackChangesEditing"),t=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"];let n;const i=new Set(this.editor.model.document.differ.getChangedMarkers().filter((n=>{if(n.data.oldRange||!n.data.newRange)return null;if(!n.name.startsWith("suggestion:attribute:"))return null;const{id:i}=e._splitMarkerName(n.name);if(!e.hasSuggestion(i))return null;const r=e.getSuggestion(i);return t.includes(r.data.key)})).map((t=>{const{id:i}=e._splitMarkerName(t.name),r=e.getSuggestion(i);return n=r.attributes.groupId,r.getFirstRange().start.nodeAfter})));if(0==i.size)return;const r=e.getSuggestions({skipNotAttached:!0}).filter((e=>"attribute"==e.type&&e.data&&t.includes(e.data.key)&&e.attributes.groupId!=n)).map((e=>({listItem:e.getFirstRange().start.nodeAfter,groupId:e.attributes.groupId}))),s=new Set;for(const{groupId:e,listItem:t}of r)i.has(t)&&s.add(e);for(const t of e.getSuggestions())s.has(t.attributes.groupId)&&t.setAttribute("groupId",n)}_supportLegacySuggestions(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");this._registerLegacyDescription(),n._suggestionFactory.registerCustomCallback("formatBlock","documentList","accept",(function(t,n){const i=[];for(let n of t)n.start.nodeAfter===n.end.parent&&(n=e.model.createRange(e.model.createPositionAt(n.start.nodeAfter,0))),i.push(n);e.model.change((t=>{const r=e.model.document.selection,s=Array.from(r.getRanges()).map((e=>LiveRange.fromRange(e)));t.setSelection(i),e.commands.get(n.commandName).refresh(),n.commandParams.push({forceDefaultExecution:!0}),e.execute(n.commandName,...n.commandParams),t.setSelection(s);for(const e of s)e.detach()}))})),n.descriptionFactory.registerElementLabel((function(t){const n=!e.model.schema.isObject(t),i=t.previousSibling,r=t.nextSibling,s=t.getAttribute("listItemId"),o=!i||i.getAttribute("listItemId")!==s,a=!r||r.getAttribute("listItemId")!==s;return n&&Boolean(s)&&o&&a}),(e=>getTranslation$1(t,"ELEMENT_LIST_ITEM",e)))}_registerLegacyDescription(){const e=this.editor,t=e.locale;function n(t){const n=e.commands.get("bulletedList").value,i=e.commands.get("numberedList").value;return"numberedList"===t?n:i}e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((function(i){if("formatBlock"!=i.type)return;const{data:r}=i;if(!r)return;let s,o,a,l;switch(r.commandName){case"bulletedList":a=r.commandParams[0].forceValue,l=n(r.commandName),s=a?"*Format:* insert into %0":"*Format:* remove from %0",!l&&e.config.get("list.multiBlock")||(s="*Change to:* %0"),o={type:"format",content:getTranslation$1(t,s,getTranslation$1(t,"ELEMENT_BULLETED_LIST"))};break;case"numberedList":a=r.commandParams[0].forceValue,l=n(r.commandName),s=a?"*Format:* insert into %0":"*Format:* remove from %0",!l&&e.config.get("list.multiBlock")||(s="*Change to:* %0"),o={type:"format",content:getTranslation$1(t,s,getTranslation$1(t,"ELEMENT_NUMBERED_LIST"))};break;case"indentList":s="*Indent:* %0",o={type:"format",content:getTranslation$1(t,s,getTranslation$1(t,"ELEMENT_LIST_ITEM"))};break;case"outdentList":s=function(e){const t=e.getFirstRange();let n=t.start.nodeAfter;for(;n&&t.containsItem(n);){if(n.getAttribute("listIndent")>0)return!1;n=n.nextSibling}return!0}(i)?getTranslation$1(t,"*Format:* remove from %0",getTranslation$1(t,"ELEMENT_"+i.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST")):getTranslation$1(t,"*Outdent:* %0",getTranslation$1(t,"ELEMENT_LIST_ITEM")),o={type:"format",content:s};break;case"mergeListItemBackward":case"mergeListItemForward":!1===r.multipleBlocks&&(s="*Merge:* %0",o={type:"deletion",content:getTranslation$1(t,s,getTranslation$1(t,"ELEMENT_LIST_ITEM"))})}return o}))}}function checkSiblingsListItemId(e){let t=e.getFirstRange().start.nodeAfter.previousSibling;for(;t;){const n=t.getAttribute("listItemId");if(!n)return!1;if(n==e.data.newValue)return"newValue";if(n==e.data.oldValue)return"oldValue";t=t.previousSibling}return!1}class TrackChangesDocumentListProperties extends Plugin{afterInit(){if(!this.editor.plugins.has("ListPropertiesEditing"))return;const e=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");e.styles&&(t.enableDefaultAttributesIntegration("listStyle"),t.registerBlockAttribute("listStyle")),e.reversed&&(t.enableDefaultAttributesIntegration("listReversed"),t.registerBlockAttribute("listReversed")),e.startIndex&&(t.enableDefaultAttributesIntegration("listStart"),t.registerBlockAttribute("listStart"));const n={type:"format",content:""};t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this));const i=this.editor.locale;t.descriptionFactory.registerAttributeLabel("listReversed",getTranslation$1(i,"FORMAT_LIST_REVERSED")),t.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listReversed"==t.key)return null==t.newValue||0==t.newValue&&null==t.oldValue?n:void 0})),t.descriptionFactory.registerAttributeLabel("listStart",getTranslation$1(i,"FORMAT_LIST_START")),t.descriptionFactory.registerDescriptionCallback((e=>{const{data:t}=e;if(t&&"listStart"==t.key)return null==t.newValue||1==t.newValue&&null==t.oldValue?n:void 0})),this.editor.model.document.registerPostFixer((e=>{if(e.batch.isUndo)return!1;let n=!1;const i=t.getSuggestions({skipNotAttached:!0}).filter((e=>{const n=t._getAttributeKey(e);return"listStart"==n||"listReversed"==n}));for(const r of i){const i=r.getFirstRange().start.nodeAfter.getAttribute("listType");"numbered"!=i&&"customNumbered"!=i&&(t._findSuggestions(r.getFirstRange(),"attribute").find((e=>"listType"==t._getAttributeKey(e.suggestion)))||(e.removeMarker(r.getFirstMarker()),n=!0))}return n})),this._registerLegacyDescription()}handleDescriptions(e){const t=this.editor.locale,{data:n}=e,i={type:"format",content:""};if(!n||"listStyle"!=n.key)return;if(!n.oldValue)return"default"==n.newValue?i:{type:"format",content:""+getTranslation$1(t,"*Set format:* %0",getTranslation$1(t,this._getTranslationKeyForListStyle(n.newValue)))};if(!n.newValue){if("default"==n.oldValue)return i;let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue)return i;r=r.next}return{type:"format",content:""+getTranslation$1(t,"*Remove format:* %0",getTranslation$1(t,this._getTranslationKeyForListStyle(n.oldValue)))}}if("default"!=n.newValue)return{type:"format",content:""+getTranslation$1(t,"*Set format:* %0",getTranslation$1(t,this._getTranslationKeyForListStyle(n.newValue)))};let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue&&r.data.oldValue)return i;r=r.next}return{type:"format",content:getTranslation$1(t,"*Set format:* %0",getTranslation$1(t,"ELEMENT_"+e.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST_DEFAULT"))}}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(!n)return;let i,r;switch(n.commandName){case"listStyle":i="*Change to:* %0",r={type:"format",content:getTranslation$1(t,i,getTranslation$1(t,this._getTranslationKeyForListStyle(n.commandParams[0].type)))};break;case"listReversed":i=n.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",r={type:"format",content:getTranslation$1(t,i)};break;case"listStart":i="*Format:* set start index to %0",r={type:"format",content:getTranslation$1(t,i,n.commandParams[0].startIndex)}}return r}))}_getTranslationKeyForListStyle(e){return"ELEMENT_"+getListTypeFromListStyleType(e).toUpperCase()+"_LIST_"+e.toUpperCase().replace(/-/g,"_")}}const BULLETED_LIST_STYLE_TYPES=["disc","circle","square"],NUMBERED_LIST_STYLE_TYPES=["decimal","decimal-leading-zero","lower-roman","upper-roman","lower-latin","upper-latin"];function getListTypeFromListStyleType(e){return BULLETED_LIST_STYLE_TYPES.includes(e)?"bulleted":NUMBERED_LIST_STYLE_TYPES.includes(e)?"numbered":null}class TrackChangesEmoji extends Plugin{afterInit(){const e=this.editor;e.commands.get("emoji")&&e.plugins.get("TrackChangesEditing").enableCommand("emoji")}}class TrackChangesEnterCommand extends Plugin{static get requires(){return[Enter]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("enter");t.enableCommand("enter",(()=>{e.model.change((i=>{const r=e.model.document.selection,s=r.getFirstPosition(),o=LiveRange.fromRange(r.getFirstRange());if(n.enterBlock(i)){const n=e.model.createPositionAt(s.parent.nextSibling,0),r=i.createRange(s,n);t.markInsertion(r)}else i.setSelection(i.createRange(o.end));o.detach(),n.fire("afterExecute",{writer:i})}))})),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastSplitMergeMarker$1(e,"split"),{priority:"high"}),e.editing.downcastDispatcher.on("removeMarker:suggestion:insertion",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.hasClass("ck-suggestion-marker-split")&&(n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.remove(e))}),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion:insertion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker$1(e,"split",{showActiveMarker:!1}).bind(this)(t,n,i)}),{priority:"high"})}}class TrackChangesFindAndReplace extends Plugin{afterInit(){if(!this.editor.plugins.has("FindAndReplaceEditing"))return;const e=this.editor.plugins.get("TrackChangesEditing");e.enableCommand("find",this.handleFindCommand.bind(this)),e.enableCommand("findNext"),e.enableCommand("findPrevious"),e.enableCommand("replace"),e.enableCommand("replaceAll")}handleFindCommand(e,t,n={}){const i=this.editor.plugins.get("FindAndReplaceUtils");return e((e=>{let r=("string"==typeof t?i.findByTextCallback(t,n):t)(e);Array.isArray(r)&&(r={results:r,searchText:"string"==typeof t?t:""});const s=r.results.filter((t=>!1===this._isInDeletionRange(t,e.item)));return{...r,results:s}}),n)}_isInDeletionRange(e,t){const n=this.editor.model.createRange(this.editor.model.createPositionAt(t,e.start),this.editor.model.createPositionAt(t,e.end));for(const e of this.editor.model.markers.getMarkersGroup("suggestion:deletion"))if(null!==n.getIntersection(e.getRange()))return!0;return!1}}const fontPlugins=[{pluginName:"FontSizeEditing",commandName:"fontSize"},{pluginName:"FontFamilyEditing",commandName:"fontFamily"},{pluginName:"FontColorEditing",commandName:"fontColor"},{pluginName:"FontBackgroundColorEditing",commandName:"fontBackgroundColor"}];class TrackChangesFont extends Plugin{afterInit(){const e=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");for(const{pluginName:e,commandName:n}of fontPlugins)this.editor.plugins.has(e)&&(t.enableDefaultAttributesIntegration(n),t.registerInlineAttribute(n));t.descriptionFactory.registerAttributeLabel("fontSize",getTranslation$1(e,"FORMAT_FONT_SIZE")),t.descriptionFactory.registerAttributeLabel("fontFamily",getTranslation$1(e,"FORMAT_FONT_FAMILY")),t.descriptionFactory.registerAttributeLabel("fontColor",getTranslation$1(e,"FORMAT_FONT_COLOR")),t.descriptionFactory.registerAttributeLabel("fontBackgroundColor",getTranslation$1(e,"FORMAT_FONT_BACKGROUND")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{const n=t.t;if("formatInline"!=e.type)return;const{data:i}=e;if(null!=i){if("fontSize"==i.commandName){const e=i.commandParams[0].value;if(e){const i=n(this.editor.plugins.get("FontSize").normalizeSizeOptions(this.editor.config.get("fontSize.options")).find((t=>t.model==e)).title).toLowerCase();return{type:"format",content:getTranslation$1(t,"*Set font size:* %0",i)}}return{type:"format",content:getTranslation$1(t,"*Reset font size*")}}if("fontFamily"==i.commandName){const e=i.commandParams[0].value;return e?{type:"format",content:getTranslation$1(t,"*Set font family:* %0",e)}:{type:"format",content:getTranslation$1(t,"*Reset font family*")}}if("fontColor"==i.commandName){const e=i.commandParams[0].value;if(e){const i=normalizeColorOptions(this.editor.config.get("fontColor.colors")).find((t=>t.model==e));let r=e,s="";return i&&(r=i.label,s=n(r).toLowerCase()),{type:"format",content:getTranslation$1(t,"*Set font color:* %0",s).trim(),color:{value:e,title:s||r}}}return{type:"format",content:getTranslation$1(t,"*Reset font color*")}}if("fontBackgroundColor"==i.commandName){const e=i.commandParams[0].value;if(e){const i=normalizeColorOptions(this.editor.config.get("fontBackgroundColor.colors")).find((t=>t.model==e));let r=e,s="";return i&&(r=i.label,s=n(r).toLowerCase()),{type:"format",content:getTranslation$1(t,"*Set font background color:* %0",s).trim(),color:{value:e,title:s||r}}}return{type:"format",content:getTranslation$1(t,"*Reset font background color*")}}}}))}}class TrackChangesFormatPainter extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("copyFormat"),i=e.commands.get("pasteFormat");n&&i&&(t.enableDefaultAttributesIntegration("pasteFormat"),t.enableCommand("copyFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((n=>{if("formatBlock"!=n.type&&"formatInline"!=n.type)return;const{data:i}=n;if(i&&"pasteFormat"===i.commandName){const n=[],r=i.commandParams[0];for(const[t,i]of Object.entries(r))n.push(translateFormatting(e,t,i));return n.length?{type:"format",content:getTranslation$1(t,"*Set format to:* %0",n.join(", "))}:{type:"format",content:getTranslation$1(t,"*Remove all formatting*")}}}))}}function translateFormatting(e,t,n){const i=e.locale.t,r=t.split(/(?=[A-Z])/).join(" "),s=i(r.charAt(0).toUpperCase()+r.slice(1)).toLowerCase();if("boolean"==typeof n)return s;if("fontColor"===t||"fontBackgroundColor"===t){const t=normalizeColorOptions(e.config.get("fontColor.colors")).find((e=>e.model==n));return s+" ("+(t?i(t.label).toLowerCase():n)+")"}if("fontSize"===t&&isNaN(parseFloat(n))){const t=e.plugins.get("FontSize").normalizeSizeOptions(e.config.get("fontSize.options")).find((e=>e.model==n));return s+" ("+(t?i(t.title).toLowerCase():n)+")"}return s+" ("+n+")"}class TrackChangesHeading extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HeadingEditing"))return;this._headingOptions=e.config.get("heading.options");const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("heading");for(const e of this._headingOptions)"paragraph"!=e.model&&n.descriptionFactory.registerElementLabel(e.model,(n=>{const i=this._getHeadingLevel(e.model);return null!==i?getTranslation$1(t,"ELEMENT_HEADING",[n,i]):(r=n,s=e.title,getTranslation$1(t,"ELEMENT_HEADING_CUSTOM",[r,s]));var r,s}));this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"heading"==n.commandName){const e=n.commandParams[0].value,o=this._getHeadingLevel(e);if(null!==o)return{type:"format",content:getTranslation$1(t,"*Change to:* %0",(s=o,getTranslation$1(t,"ELEMENT_HEADING",[1,s])))};const a=this._headingOptions.find((t=>t.model===e)).title;return{type:"format",content:getTranslation$1(t,"*Change to:* %0",(i=1,r=a,getTranslation$1(t,"ELEMENT_HEADING_CUSTOM",[i,r])))}}var i,r,s}))}_getHeadingLevel(e){var t,n;const i=e.match(/^heading(\d+)/);if(i)return i[1];const r=null===(t=this._headingOptions)||void 0===t?void 0:t.find((t=>t.model==e));if(r&&r.view){const e=r.view,t=(null!==(n=e.name)&&void 0!==n?n:e).match(/^h(\d+)/);if(t)return t[1]}return null}}class TrackChangesHighlight extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HighlightEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.enableDefaultAttributesIntegration("highlight"),t.registerInlineAttribute("highlight"),t.descriptionFactory.registerAttributeLabel("highlight",getTranslation$1(n,"FORMAT_HIGHLIGHT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((n=>{if("formatInline"!=n.type)return;const{data:i}=n;if(i&&"highlight"==i.commandName){const n=t.t,r=i.commandParams[0].value;if(r){const i=e.config.get("highlight.options").find((e=>e.model==r)),s=n(i.title).toLowerCase();return{type:"format",content:getTranslation$1(t,"*Set highlight:* %0",s),color:{value:i.color,title:i.title}}}return{type:"format",content:getTranslation$1(t,"*Remove highlight*",getTranslation$1(t,"FORMAT_HIGHLIGHT"))}}}))}}class TrackChangesHorizontalLine extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HorizontalLineEditing"))return;e.plugins.get("TrackChangesEditing").enableCommand("horizontalLine");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("horizontalLine",(e=>getTranslation$1(n,"ELEMENT_HORIZONTAL_LINE",e))),e.conversion.for("dataDowncast").elementToStructure({model:"horizontalLine",view:(e,{writer:t,options:n})=>{if(!n.showSuggestionHighlights)return null;const i=t.createContainerElement("div"),r=t.createEmptyElement("hr");return t.addClass("ck-horizontal-line",i),t.insert(t.createPositionAt(i,0),r),i},converterPriority:"high"})}}class TrackChangesHtmlEmbed extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("HtmlEmbed"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("rawHtml",(e=>getTranslation$1(n,"ELEMENT_HTML_EMBED",e))),t.enableDefaultAttributesIntegration("htmlEmbed"),t.registerBlockAttribute("value"),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;if(t&&"value"==t.key&&e.getFirstRange().start.nodeAfter.is("element","rawHtml")){const e=getTranslation$1(n,"ELEMENT_HTML_EMBED");return{type:"format",content:getTranslation$1(n,"*Change %0 content*",e)}}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;if(n&&"htmlEmbed"==n.commandName){const e=getTranslation$1(t,"ELEMENT_HTML_EMBED");return{type:"format",content:getTranslation$1(t,"*Change %0 content*",e)}}}))}}class TrackChangesImage extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ImageEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("ImageUtils"),i=e.locale;t.enableCommand("insertImage"),t.descriptionFactory.registerElementLabel("imageBlock",(e=>getTranslation$1(i,"ELEMENT_IMAGE",e))),t.descriptionFactory.registerElementLabel("imageInline",(e=>getTranslation$1(i,"ELEMENT_INLINE_IMAGE",e))),t.descriptionFactory.registerElementLabel("caption",(()=>getTranslation$1(i,"ELEMENT_CAPTION"))),e.plugins.has("ImageUploadEditing")&&t.enableCommand("uploadImage"),e.plugins.has("ImageBlockEditing")&&e.plugins.has("ImageInlineEditing")&&(t.enableCommand("imageTypeInline",((i,r)=>{const s=n.getClosestSelectedImageElement(e.model.document.selection);e.model.change((()=>{t.markBlockFormat(s,{commandName:"imageTypeInline",commandParams:[r]},[],"convertBlockImageToInline")}))})),t.enableCommand("imageTypeBlock",((i,r)=>{e.model.change((s=>{let o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.createRangeOn(o);const l=LivePosition.fromPosition(a.start,"toPrevious"),c=LivePosition.fromPosition(a.end,"toNext");t.forceDefaultExecution((()=>i(r))),o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.createRangeOn(o);const d=s.createRange(l,c);l.detach(),c.detach(),t.markBlockFormat(o,{commandName:"imageTypeInline",commandParams:[r]},[],"convertInlineImageToBlock"),d.start.isBefore(a.start)&&t.markInsertion(s.createRange(d.start,a.start),"convertInlineImageToBlock"),a.end.isBefore(d.end)&&t.markInsertion(s.createRange(a.end,d.end),"convertInlineImageToBlock")}))})),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","accept",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","discard",t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","discard",(([n])=>{const i=t._suggestionFactory.getSuggestionCallback("insertion","","discard");let r=n.start,s=n.end;const o=e.model.schema.getNearestSelectionRange(r,"backward"),a=e.model.schema.getNearestSelectionRange(s,"forward");o.isCollapsed&&(r=o.start),a.isCollapsed&&(s=a.end),i([e.model.createRange(r,s)])})),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","chain",o),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","chain",o)),e.plugins.has("ImageCaptionEditing")&&(t.enableCommand("toggleImageCaption",((i,r)=>{const s=e.plugins.get("ImageCaptionUtils");let o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.getCaptionFromImageModelElement(o);e.model.change((()=>{if(a)return void t.markDeletion(e.model.createRangeOn(a));const l=n.isBlockImage(o);i(r),o=n.getClosestSelectedImageElement(e.model.document.selection),a=s.getCaptionFromImageModelElement(o),t.markInsertion(e.model.createRangeOn(a),l?null:"imageCaption")}))})),t._suggestionFactory.registerCustomCallback("insertion","imageCaption","chain",o));const r=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function s(e,i){const s=r.findIndex((({type:t,subType:n})=>e.type==t&&e.subType==n)),o=r.findIndex((({type:e,subType:t})=>i.type==e&&i.subType==t));if(s<0||o<0)return!1;const a=e.getFirstRange(),l=i.getFirstRange();if((0==s||1==s)&&2==o&&a.isIntersecting(l))return!0;if(2==s&&3==o){const e=t._findSuggestions(a,"insertion").filter((({suggestion:e,meta:t})=>t.isOwn&&"convertInlineImageToBlock"==e.subType));if(e.length>1&&l.end.isEqual(a.start))return!0;if(1==e.length&&(a.start.isEqual(l.end)||a.end.isEqual(l.start)))return!0}if(3==s&&3==o&&a.start.isBefore(l.start)){const e=a.end.nodeAfter,t=l.start.nodeBefore;return n.isBlockImage(e)&&e===t}return!1}function o(e,t){return s(e,t)?[e,t]:s(t,e)?[t,e]:null}e.plugins.has("ImageResize")&&(t.enableDefaultAttributesIntegration("resizeImage"),t.registerBlockAttribute("resizedWidth"),t.descriptionFactory.registerAttributeLabel("resizedWidth",getTranslation$1(i,"FORMAT_IMAGE_SIZE"))),e.plugins.has("ImageTextAlternativeEditing")&&(t.enableDefaultAttributesIntegration("imageTextAlternative"),t.registerBlockAttribute("alt")),e.plugins.has("PictureEditing")&&(t.registerBlockAttribute("sources"),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;return t&&"sources"==t.key?{type:"format",content:""}:void 0}))),e.plugins.has("ImageSizeAttributes")&&(t.registerBlockAttribute("width"),t.registerBlockAttribute("height"),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;return!t||"width"!=t.key&&"height"!=t.key?void 0:{type:"format",content:""}}))),t.descriptionFactory.registerDescriptionCallback((e=>{if(r.find((({type:t,subType:n})=>e.type==t&&e.subType==n)))return e.previous?{}:void 0})),t.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"==e.type||"deletion"==e.type){const t=e.getContainedElement();if(t&&t.is("element","caption"))return{type:"insertion"==e.type?"addObject":"removeObject",element:t,quantity:1}}})),t.descriptionFactory.registerDescriptionCallback((e=>"formatBlock"==e.type&&"convertInlineImageToBlock"==e.subType?{type:"format",content:"Inline image to block image"}:"formatBlock"==e.type&&"convertBlockImageToInline"==e.subType?{type:"format",content:"Block image to inline image"}:void 0)),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;if(!t||"alt"!=t.key)return;const n=t.newValue;return n?{type:"format",content:getTranslation$1(i,"*Set image text alternative:* %0",'"'+n+'"')}:{type:"format",content:getTranslation$1(i,"*Remove image text alternative*")}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;if(n){if("imageTextAlternative"==n.commandName){const e=n.commandParams[0].newValue;return e?{type:"format",content:getTranslation$1(t,"*Set image text alternative:* %0",'"'+e+'"')}:{type:"format",content:getTranslation$1(t,"*Remove image text alternative*")}}if("resizeImage"==n.commandName){const e=n.commandParams[0].width;return e?{type:"format",content:getTranslation$1(t,"*Set image width:* %0",e)}:{type:"format",content:getTranslation$1(t,"*Reset image width*")}}}}))}}class TrackChangesImageReplace extends Plugin{afterInit(){if(!this.editor.plugins.has("ImageEditing"))return;const e=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");t.enableDefaultAttributesIntegration("replaceImageSource"),t.registerBlockAttribute("src"),t.descriptionFactory.registerDescriptionCallback((t=>{if("attribute"!=t.type)return;const{data:n}=t;return n&&"src"==n.key?n.newValue&&n.oldValue?{type:"format",content:getTranslation$1(e,"*Replace image*")}:{type:"format",content:""}:void 0})),this._handleLegacySuggestions()}_handleLegacySuggestions(){const e=this.editor.plugins.get("TrackChangesEditing");e._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","discard",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;return n&&"replaceImageSource"==n.commandName?{type:"format",content:getTranslation$1(t,"*Format:* replace image URL")}:void 0}))}}class TrackChangesImageStyle extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("ImageStyleEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("ImageUtils"),i={};t.enableCommand("imageStyle",((i,r)=>{const s=e.plugins.get("Users").me,o=e.commands.get("imageStyle");let a=n.getClosestSelectedImageElement(e.model.document.selection),l=e.model.createRangeOn(a),c=o.value;if(c==r.value)return;const d={commandName:"imageStyle",commandParams:[r],formatGroupId:uid()};e.model.change((()=>{if(t.getSuggestions().filter((e=>e.isInContent&&s==e.author&&("formatBlock"==e.type||"formatInline"==e.type)&&("imageStylePreApply"==e.subType||"imageStylePostApply"==e.subType)&&e.getFirstRange().isEqual(l))).forEach((e=>t.discardSuggestion(e.head))),a=n.getClosestSelectedImageElement(e.model.document.selection),l=e.model.createRangeOn(a),o.refresh(),e.commands.get("imageTypeInline").refresh(),e.commands.get("imageTypeBlock").refresh(),c=o.value,c!=r.value)return n.isInlineImage(a)&&o.shouldConvertImageType(r.value,a)?(i({...r,setImageSizes:!1}),a=n.getClosestSelectedImageElement(e.model.document.selection),void t.markBlockFormat(a,{...d,commandReversedParams:[{value:c||null,setImageSizes:!1}]},[],"imageStylePreApply")):void(n.isBlockImage(a)?t.markBlockFormat(a,d,[],"imageStylePostApply"):t.markInlineFormat(l,d,"imageStylePostApply"))}))}));for(const t of e.plugins.get("ImageStyleEditing").normalizedStyles)i[t.name]=t.title.toLowerCase();t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePostApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatInline","imageStylePostApply","join",(()=>!1)),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","accept",(([e])=>{n.setImageNaturalSizeAttributes(e.getContainedElement())})),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","discard",((e,n)=>{t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")(e,{commandName:n.commandName,commandParams:n.commandReversedParams})})),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","chain",(function(e,t){return s(e,t)?[e,t]:s(t,e)?[t,e]:null}));const r=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function s(e,i){const s=r.findIndex((({type:t,subType:n})=>e.type==t&&e.subType==n)),o=r.findIndex((({type:e,subType:t})=>i.type==e&&i.subType==t));if(s<0||o<0)return!1;const a=e.getFirstRange(),l=i.getFirstRange();if((0==s||1==s)&&2==o&&a.isIntersecting(l))return!0;if(2==s&&3==o){const e=t._findSuggestions(a,"insertion").filter((({suggestion:e,meta:t})=>t.isOwn&&"convertInlineImageToBlock"==e.subType));if(e.length>1&&l.end.isEqual(a.start))return!0;if(1==e.length&&(a.start.isEqual(l.end)||a.end.isEqual(l.start)))return!0}if(3==s&&3==o&&a.start.isBefore(l.start)){const e=a.end.nodeAfter,t=l.start.nodeBefore;return n.isBlockImage(e)&&e===t}return!1}e.model.document.registerPostFixer((()=>{let i=!1;const r=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:e,data:s}of r){const{group:r,type:o,subType:a,id:l}=t._splitMarkerName(e);if("suggestion"==r&&t.hasSuggestion(l)){if("formatBlock"==o&&("imageStylePreApply"==a||"imageStylePostApply"==a)){const e=t.getSuggestion(l);if(s.newRange){const r=e.getFirstRange().getContainedElement();if(n.isBlockImage(r))continue;t.discardSuggestion(e),i=!0}}if("insertion"==o&&"imageCaption"==a&&!s.newRange){const e=t.getSuggestion(l);e.next&&e.next.isInContent&&(t.discardSuggestion(e.next),i=!0)}}}return i})),this._registerLegacyDescription(i)}_registerLegacyDescription(e){const t=this.editor,n=t.locale;t.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((t=>{if("formatBlock"!=t.type&&"formatInline"!=t.type)return;const{data:i}=t;if(!i||"imageStyle"!=i.commandName)return;const r=i.commandParams[0].value;return s="side"===r?getTranslation$1(n,"FORMAT_SIDE_IMAGE"):e[r]||r,{type:"format",content:getTranslation$1(n,"*Format:* %0",s)};var s}))}}class TrackChangesImportWord extends Plugin{constructor(e){super(e),this._trackChangesValueDuringImport=!1,this._trackChangesExecuted=!1}afterInit(){const e=this.editor,t=e.commands.get("importWord"),n=e.commands.get("trackChanges");t&&(t.on("execute",((e,[,t])=>{this._trackChangesValueDuringImport=n.value,t.collaboration_features.track_changes=!this._trackChangesValueDuringImport}),{priority:"high"}),this.listenTo(t,"dataInsert",this._handleImportedData.bind(this)),this.listenTo(t,"dataInsert",(()=>{this._trackChangesExecuted&&(n.execute(),this._trackChangesExecuted=!1)}),{priority:"lowest"}),e.plugins.get("TrackChangesEditing").enableCommand("importWord"))}_handleImportedData(e,t){const{suggestions:n}=t,i=this.editor.commands.get("trackChanges"),r=i.value;this._trackChangesValueDuringImport!==r&&(i.execute(),this._trackChangesExecuted=!0),n&&n.forEach((({id:e,type:t,author:n,created_at:i})=>{const r={id:e,type:t,authorId:this.editor.plugins.get("Users").me.id,createdAt:new Date,data:null,hasComments:!1,attributes:{"@external":{authorName:n,createdAt:i?new Date(i):new Date,source:"importWord"}}};this.editor.plugins.get("TrackChangesEditing")._setSuggestionData(r)}))}}class TrackChangesIndent extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");if(e.plugins.has("IndentEditing")&&(t.enableCommand("indent"),t.enableCommand("outdent")),e.plugins.has("IndentBlock"))for(const e of["indentBlock","outdentBlock"])t.enableDefaultAttributesIntegration(e);const n=e.locale;t.registerBlockAttribute("blockIndent"),t.descriptionFactory.registerAttributeLabel("blockIndent",getTranslation$1(n,"FORMAT_INDENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale,n=e.plugins.get("TrackChangesEditing");n.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:i}=e;if(!i)return;if("indentBlock"!=i.commandName&&"outdentBlock"!=i.commandName)return;const r=e.getItems()[0],s=n.descriptionFactory.getItemLabel(r);return"indentBlock"==i.commandName?{type:"format",content:getTranslation$1(t,"*Indent:* %0",s)}:"outdentBlock"==i.commandName?{type:"format",content:getTranslation$1(t,"*Outdent:* %0",s)}:void 0}))}}class TrackChangesInputCommand extends Plugin{static get requires(){return[Input]}init(){this.editor.plugins.get("TrackChangesEditing").enableCommand("input")}}class TrackChangesLink extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("LinkEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.commands.get("link");t.enableDefaultAttributesIntegration("link"),t.enableDefaultAttributesIntegration("unlink"),t.registerInlineAttribute("linkHref");for(const e of n.manualDecorators)t.registerInlineAttribute(e.id),t.descriptionFactory.registerAttributeLabel(e.id,"link ("+e.label.toLowerCase()+")");t.descriptionFactory.registerDescriptionCallback((t=>{if("attribute"!=t.type)return;const{data:n}=t;if(!n||"linkHref"!=n.key)return;const i=n.newValue,r=e.locale;return{type:"format",content:null==i?getTranslation$1(r,"*Remove link*"):getTranslation$1(r,"*Set link:* %0",'"'+i+'"')}})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatInline"!=e.type)return;const{data:n}=e;if(n){if("link"==n.commandName){const e=n.commandParams[0];return{type:"format",content:getTranslation$1(t,"*Set link:* %0",'"'+e+'"')}}return"unlink"==n.commandName?{type:"format",content:getTranslation$1(t,"*Remove link*")}:void 0}}))}}class TrackChangesLegacyList extends Plugin{afterInit(){const e=this.editor,t=e.locale;if(!e.plugins.has("LegacyListEditing"))return;const n=e.plugins.get("TrackChangesEditing"),i=e.plugins.has("LegacyTodoListEditing");function r(t){return()=>{const i=e.model.document.selection,r=e.commands.get(t);if(r.value)return void e.execute("paragraph",{});const s=t.slice(0,-4),o=getBlocksToMarkForListTypeChange(i.getSelectedBlocks(),s,e.model.schema);e.model.change((()=>{for(const e of o)n.markBlockFormat(e,{commandName:t,commandParams:[{forceValue:!r.value}],formatGroupId:"blockName"},getBlocksAffectedByListTypeChange(e))}))}}function s(t){return()=>{const i=getBlocksToMarkForIndentChange(e.model.document.selection.getSelectedBlocks()),r=e.model.createRange(e.model.createPositionAt(i[0],"before"),e.model.createPositionAt(i[i.length-1],"end"));e.model.change((()=>{n.markBlockFormat(r,{commandName:t,commandParams:[],formatGroupId:"listIndent"},getBlocksAffectedByIndent(i))}))}}n.enableCommand("numberedList",r("numberedList")),n.enableCommand("bulletedList",r("bulletedList")),i&&n.enableCommand("todoList",r("todoList")),n.enableCommand("indentList",s("indentList")),n.enableCommand("outdentList",s("outdentList")),i&&n.enableCommand("checkTodoList",(()=>{const t=e.commands.get("checkTodoList"),i=Array.from(t._selectedElements);i.filter((e=>e.getAttribute("todoListChecked")!=t.value)),e.model.change((()=>{for(const e of i)n.markBlockFormat(e,{commandName:"checkTodoList",commandParams:[{forceValue:!t.value}]})}))})),n.descriptionFactory.registerElementLabel("listItem",(e=>getTranslation$1(t,"ELEMENT_LIST_ITEM",e))),n.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;if(n){if("numberedList"==n.commandName||"bulletedList"==n.commandName||"todoList"==n.commandName)switch(n.commandName.replace("List","")){case"bulleted":return i(getTranslation$1(t,"ELEMENT_BULLETED_LIST"));case"numbered":return i(getTranslation$1(t,"ELEMENT_NUMBERED_LIST"));case"todo":return i(getTranslation$1(t,"ELEMENT_TODO_LIST"))}if("indentList"==n.commandName)return{type:"format",content:getTranslation$1(t,"*Indent:* %0",getTranslation$1(t,"ELEMENT_LIST_ITEM"))};if("outdentList"==n.commandName)return{type:"format",content:getTranslation$1(t,"*Outdent:* %0",getTranslation$1(t,"ELEMENT_LIST_ITEM"))};if("checkTodoList"==n.commandName)return n.commandParams[0].forceValue?{type:"format",content:getTranslation$1(t,"*Check item*")}:{type:"format",content:getTranslation$1(t,"*Uncheck item*")}}function i(e){return{type:"format",content:getTranslation$1(t,"*Change to:* %0",e)}}}))}}function getBlocksToMarkForListTypeChange(e,t,n){let i=Array.from(e).filter((e=>checkCanBecomeListItem(e,n)));i=i.filter((e=>!e.is("element","listItem")||e.getAttribute("listType")!=t));const r=new Set;for(const e of i)e.is("element","listItem")?r.add(getListHead(e)):r.add(e);return Array.from(r)}function checkCanBecomeListItem(e,t){return t.checkChild(e.parent,"listItem")&&!t.isObject(e)}function getBlocksToMarkForIndentChange(e){let t=Array.from(e);const n=t.findIndex((e=>"listItem"!=e.name));return n>-1&&(t=t.slice(0,n)),t}function getListHead(e){const t=e.getAttribute("listIndent");if(0==t)return e;let n=e;for(;e.previousSibling&&e.previousSibling.is("element","listItem");){const i=e.previousSibling.getAttribute("listIndent");if(i==t)n=e.previousSibling;else if(i<t)break;e=e.previousSibling}return n}function getBlocksAffectedByListTypeChange(e){const t=[];if(e.is("element","listItem")&&e.getAttribute("listIndent")>0){let n=e.nextSibling;for(;n&&"listItem"==n.name&&n.getAttribute("listIndent")==e.getAttribute("listIndent");)t.push(n),n=n.nextSibling}return t}function getBlocksAffectedByIndent(e){const t=new Set;for(const n of e){let e=n.nextSibling;for(;e&&e.getAttribute("listIndent")>n.getAttribute("listIndent");)t.add(e),e=e.nextSibling}return Array.from(t)}class TrackChangesListProperties extends Plugin{afterInit(){if(!this.editor.plugins.has("LegacyListPropertiesEditing"))return;const e=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");e.styles&&t.enableCommand("listStyle",this.handleListStyleCommand.bind(this)),e.reversed&&t.enableCommand("listReversed",this.handleListReversedCommand.bind(this)),e.startIndex&&t.enableCommand("listStart",this.handleListStartCommand.bind(this)),t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this))}handleListStyleCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocksForListStyle();this.editor.model.change((()=>{n.markMultiRangeBlockFormat(i,{commandName:"listStyle",commandParams:[{type:t.type}],formatGroupId:"listStyle"})}))}handleListReversedCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocks((e=>e.is("element","listItem")&&"numbered"===e.getAttribute("listType")));if(i.length<1)return;const r=i.map((e=>this.editor.model.createRange(this.editor.model.createPositionAt(e,"before"),this.editor.model.createPositionAt(e,0))));this.editor.model.change((()=>{n.markMultiRangeBlockFormat(r,{commandName:"listReversed",commandParams:[{reversed:t.reversed}],formatGroupId:"listReversed"})}))}handleListStartCommand(e,t={}){const n=this.editor.plugins.get("TrackChangesEditing"),i=this._getSuggestionBlocks((e=>e.is("element","listItem")&&"numbered"===e.getAttribute("listType")));if(i.length<1)return;const r=i.map((e=>this.editor.model.createRange(this.editor.model.createPositionAt(e,"before"),this.editor.model.createPositionAt(e,0))));this.editor.model.change((()=>{n.markMultiRangeBlockFormat(r,{commandName:"listStart",commandParams:[{startIndex:t.startIndex}],formatGroupId:"listStart"})}))}handleDescriptions(e){if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const t=this.editor.locale,{data:n}=e;if(!n)return;let i,r;switch(n.commandName){case"listStyle":i="*Change to:* %0",r={type:"format",content:getTranslation$1(t,i,getTranslation$1(t,this._getTranslationKeyForListStyle(n.commandParams[0].type)))};break;case"listReversed":i=n.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",r={type:"format",content:getTranslation$1(t,i)};break;case"listStart":i="*Format:* set start index to %0",r={type:"format",content:getTranslation$1(t,i,n.commandParams[0].startIndex)}}return r}_getSuggestionBlocksForListStyle(){var e,t,n,i;const r=this.editor.plugins.get("LegacyListUtils");let s=Array.from(this.editor.model.document.selection.getSelectedBlocks());return(null===(e=s[0])||void 0===e?void 0:e.is("element","listItem"))&&s.unshift(...r.getSiblingNodes(this.editor.model.document.selection.getFirstPosition(),"backward")),(null===(t=s[s.length-1])||void 0===t?void 0:t.is("element","listItem"))&&s.push(...r.getSiblingNodes(this.editor.model.document.selection.getLastPosition(),"forward")),s=[...new Set(s)],(null===(i=null===(n=this.editor.model.document.selection.getFirstPosition())||void 0===n?void 0:n.parent)||void 0===i?void 0:i.is("element","listItem"))&&(s=s.filter((e=>e.is("element","listItem")))),s}_getSuggestionBlocks(e){const t=this.editor.plugins.get("LegacyListUtils");let n=Array.from(this.editor.model.document.selection.getSelectedBlocks()).filter(e).map((e=>{const n=this.editor.model.createPositionAt(e,0);return[...t.getSiblingNodes(n,"backward"),...t.getSiblingNodes(n,"forward")]})).flat();return n=[...new Set(n)],n}_getTranslationKeyForListStyle(e){return"ELEMENT_"+(this.editor.plugins.get("LegacyListUtils").getListTypeFromListStyleType(e)||"default").toUpperCase()+"_LIST_"+e.toUpperCase().replace(/-/g,"_")}}class TrackChangesMediaEmbed extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("MediaEmbedEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.enableCommand("mediaEmbed"),t.descriptionFactory.registerElementLabel("media",(e=>getTranslation$1(n,"ELEMENT_MEDIA",e))),e.conversion.for("dataDowncast").elementToElement({model:"media",view:(e,{writer:t,options:n})=>{if(n.showSuggestionHighlights)return t.createEmptyElement("div")},converterPriority:"high"}),e.data.downcastDispatcher.on("attribute:url:media",((e,t,n)=>{n.options.showSuggestionHighlights&&e.stop()}),{priority:"high"})}}class TrackChangesMention extends Plugin{afterInit(){const e=this.editor;e.plugins.has("MentionEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("mention")}}class TrackChangesMergeFields extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("MergeFieldsEditing"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.enableCommand("insertMergeField"),t.enableCommand("insertMergeFieldBlock"),t.enableCommand("insertMergeFieldImage"),t.descriptionFactory.registerElementLabel("mergeField",(e=>getTranslation$1(n,"ELEMENT_MERGE_FIELD",e))),t.descriptionFactory.registerElementLabel("mergeFieldBlock",(e=>getTranslation$1(n,"ELEMENT_MERGE_FIELD",e))),t.descriptionFactory.registerDescriptionCallback((t=>{if("insertion"!=t.type&&"deletion"!=t.type)return;const i=t.getContainedElement();if(null==i)return;const r=e.plugins.get("MergeFieldsEditing");let s;switch(r.getMergeFieldType(i)){case null:return;case"image":{const e=r.unwrapAffixes(i.getAttribute("src"));s=r.getLabel(e)||e;break}default:{const e=i.getAttribute("id");s=r.getLabel(e)||e;break}}return"insertion"==t.type?{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",'"'+s+'" '+getTranslation$1(n,"ELEMENT_MERGE_FIELD"))}:{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",'"'+s+'" '+getTranslation$1(n,"ELEMENT_MERGE_FIELD"))}}))}}class TrackChangesMultiLevelList extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.plugins.has("MultiLevelList")&&(t.enableDefaultAttributesIntegration("multiLevelList"),t.registerBlockAttribute("listMarkerStyle"),t.descriptionFactory.registerDescriptionCallback((e=>this.handleDescriptions(e))))}handleDescriptions(e){const t=this.editor.locale,{data:n}=e,i={type:"format",content:""};if(n&&"listMarkerStyle"==n.key){if(!n.oldValue)return{type:"format",content:getTranslation$1(t,"*Set format:* %0",getTranslation$1(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+n.newValue+")"};if(!n.newValue){let r=e.head;for(;r;){if(r.data&&"listType"==r.data.key&&r.data.newValue)return i;r=r.next}return{type:"format",content:getTranslation$1(t,"*Remove format:* %0",getTranslation$1(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+n.oldValue+")"}}}}}class TrackChangesPageBreak extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("PageBreakEditing"))return;e.plugins.get("TrackChangesEditing").enableCommand("pageBreak");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("pageBreak",(e=>getTranslation$1(n,"ELEMENT_PAGE_BREAK",e)))}}class TrackChangesParagraph extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Paragraph"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.descriptionFactory.registerElementLabel("paragraph",(e=>getTranslation$1(t,"ELEMENT_PARAGRAPH",e))),n.enableDefaultAttributesIntegration("paragraph"),n.enableCommand("insertParagraph"),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastInsertSplitMarkerSuggestion(e),{priority:"highest"}),e.data.downcastDispatcher.on("addMarker:suggestion:insertion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastInsertSplitMarkerSuggestion(e,{showActiveMarker:!1})(t,n,i)}),{priority:"highest"});const i=n.descriptionFactory;i.registerDescriptionCallback((n=>{if("insertion"!==n.type)return;const{start:r,end:s}=n.getFirstRange();if(!r.isTouching(s)||!r.nodeAfter)return;const o=e.model.schema,a=r.nodeAfter;return o.isBlock(a)&&!o.isLimit(a)&&o.checkChild(a,"$text")?{type:"insertion",content:getTranslation$1(t,"*Insert:* %0",i.getItemLabel(a,1))}:void 0})),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:n}=e;return n&&"paragraph"==n.commandName?{type:"format",content:getTranslation$1(t,"*Change to:* %0",getTranslation$1(t,"ELEMENT_PARAGRAPH"))}:void 0}))}}function downcastInsertSplitMarkerSuggestion(e,{showActiveMarker:t=!0}={}){return(n,i,r)=>{const s=e.plugins.get("TrackChangesEditing"),o=i.markerRange.start,a=i.markerRange.end,l=e.model.schema;if(!o.isTouching(a)||!o.nodeAfter)return;const c=o.nodeAfter;if(l.isBlock(c)&&!l.isLimit(c)&&l.checkChild(c,"$text")){if(!r.consumable.consume(i.markerRange,n.name))return;const{authorId:e}=s._splitMarkerName(i.markerName),o=r.writer.createUIElement("span",{class:"ck-suggestion-marker-split","data-author-id":e}),l=r.mapper.toViewPosition(a);t&&s.activeMarkers.includes(i.markerName)&&r.writer.addClass("ck-suggestion-marker--active",o),r.writer.insert(l,o),r.mapper.bindElementToMarker(o,i.markerName)}}}class TrackChangesReplaceSourceCommand extends Plugin{afterInit(){const e=this.editor;e.commands.get("replaceSource")&&e.plugins.get("TrackChangesEditing").enableCommand("replaceSource")}}class TrackChangesRemoveFormat extends Plugin{afterInit(){const e=this.editor;e.plugins.has("RemoveFormatEditing")&&(e.plugins.get("TrackChangesEditing").enableDefaultAttributesIntegration("removeFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const e=this.editor;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((t=>{if("formatBlock"!=t.type&&"formatInline"!=t.type)return;const{data:n}=t;return n&&"removeFormat"==n.commandName?{type:"format",content:getTranslation$1(e.locale,"*Remove all formatting*")}:void 0}))}}class TrackChangesRestrictedEditingMode extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("RestrictedEditingModeEditing"))return;const t=e.plugins.get("TrackChangesEditing");t.enableCommand("goToPreviousRestrictedEditingException"),t.enableCommand("goToNextRestrictedEditingException");const n=e.plugins.get("RestrictedEditingModeEditing");n.enableCommand("trackChanges"),n.enableCommand("acceptSuggestion"),n.enableCommand("discardSuggestion"),n.enableCommand("acceptAllSuggestions"),n.enableCommand("discardAllSuggestions"),n.enableCommand("acceptSelectedSuggestions"),n.enableCommand("discardSelectedSuggestions")}}class TrackChangesShiftEnterCommand extends Plugin{static get requires(){return[ShiftEnter]}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");t.enableCommand("shiftEnter"),e.editing.downcastDispatcher.on("addMarker:suggestion:insertion",downcastSplitMergeMarker(e),{priority:"high"}),e.editing.downcastDispatcher.on("addMarker:suggestion:deletion",downcastSplitMergeMarker(e),{priority:"high"}),e.data.downcastDispatcher.on("addMarker:suggestion",((t,n,i)=>{i.options.showSuggestionHighlights&&downcastSplitMergeMarker(e,{showActiveMarker:!1})(t,n,i)})),t.descriptionFactory.registerElementLabel("softBreak",(t=>getTranslation$1(e.locale,"ELEMENT_LINE_BREAK",t)))}}function downcastSplitMergeMarker(e,{showActiveMarker:t=!0}={}){return(n,i,r)=>{const s=e.plugins.get("TrackChangesEditing");if(!r.consumable.test(i.markerRange,n.name))return;const o=e.model;for(const e of i.markerRange.getItems()){if(!e.is("element","softBreak"))continue;const n="deletion"==i.markerName.split(":")[1]?"merge":"split",{authorId:a}=s._splitMarkerName(i.markerName),l=r.writer.createUIElement("span",{class:"ck-suggestion-marker-"+n,"data-author-id":a}),c=r.mapper.toViewPosition(o.createPositionBefore(e));t&&s.activeMarkers.includes(i.markerName)&&r.writer.addClass("ck-suggestion-marker--active",l),r.writer.insert(c,l),r.mapper.bindElementToMarker(l,i.markerName)}}}class TrackChangesStandardEditingMode extends Plugin{afterInit(){const e=this.editor,t=e.model,n=e.locale;if(!e.plugins.has("StandardEditingModeEditing"))return;const i=e.plugins.get("TrackChangesEditing"),r="restrictedEditingException",s=e.commands.get(r);i.enableCommand(r,((e,n={})=>{const o=t.document.selection;if(o.isCollapsed)return void e(n);const a=void 0!==n.forceValue?n.forceValue:!s.value;t.change((()=>{const e=Array.from(o.getRanges());for(const n of e){const e=a?[n]:getRangesWithAttribute(r,n,t);for(const t of e)i.markInlineFormat(t,{commandName:r,commandParams:[{forceValue:a}]})}}))})),i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t&&t.commandName==r?t.commandParams[0].forceValue?{type:"format",content:getTranslation$1(n,"FORMAT_RESTRICTED_ENABLED")}:{type:"format",content:getTranslation$1(n,"FORMAT_RESTRICTED_DISABLED")}:void 0}))}}class TrackChangesStylesDropdown extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Style")||!e.plugins.has("DataSchema"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.locale,i=e.config.get("style")||{},r=e.plugins.get("GeneralHtmlSupport"),s=e.plugins.get("StyleUtils").normalizeConfig(e.plugins.get("DataSchema"),i.definitions);t.enableDefaultAttributesIntegration("style");const o=new Set;for(const e of s.block){const t=r.getGhsAttributeNameForElement(e.element);o.add(t)}const a=new Set;for(const e of s.inline){const t=r.getGhsAttributeNameForElement(e.element);a.add(t);for(const t of e.ghsAttributes)a.add(t)}for(const e of o)t.registerBlockAttribute(e),t.descriptionFactory.registerAttributeLabel(e,getTranslation$1(n,"FORMAT_STYLE"));for(const e of a)t.registerInlineAttribute(e),t.descriptionFactory.registerAttributeLabel(e,getTranslation$1(n,"FORMAT_STYLE"));this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:n}=e;return n&&"style"===n.commandName?n.commandParams[0].forceValue?{type:"format",content:getTranslation$1(t,"*Set format:* %0",n.commandParams[0].styleName.toLowerCase())}:{type:"format",content:getTranslation$1(t,"*Remove format:* %0",n.commandParams[0].styleName.toLowerCase())}:void 0}))}}class TrackChangesTable extends Plugin{constructor(e){super(e),this._tablePostFixingSubtypes=["tableRow","tableColumn"],this._tableSuggestions=new Set}afterInit(){const e=this.editor,t=e.model.document.selection;if(!e.plugins.has("TableEditing"))return;const n=e.locale,i=e.plugins.get("TrackChangesEditing"),r=e.plugins.get("TableUtils");i.descriptionFactory.registerElementLabel("table",(e=>getTranslation$1(n,"ELEMENT_TABLE",e))),this._setupColumnsRowsFixing(),i.enableCommand("insertTable"),i.enableCommand("selectTableRow"),i.enableCommand("selectTableColumn");for(const n of["insertTableRowAbove","insertTableRowBelow"]){const s=e.commands.get(n);i.enableCommand(n,(n=>{e.model.change((e=>{n();const o="above"===s.order,a=r.getSelectionAffectedTableCells(t),l=r.getRowIndexes(a),c=o?l.first-1:l.last+1,d=a[0].findAncestor("table"),u=r.createTableWalker(d,{startRow:c,endRow:c}),h=Array.from(u).map((t=>e.createRangeOn(t.cell)));i.markMultiRangeInsertion(h,"tableRow")}))}))}for(const n of["insertTableColumnLeft","insertTableColumnRight"]){const s=e.commands.get(n);i.enableCommand(n,(n=>{e.model.change((e=>{n();const o="left"===s.order,a=r.getSelectionAffectedTableCells(t),l=r.getColumnIndexes(a),c=o?l.first-1:l.last+1,d=a[0].findAncestor("table"),u=r.createTableWalker(d,{startRow:0,column:c,includeAllSlots:!1}),h=Array.from(u).map((t=>e.createRangeOn(t.cell)));i.markMultiRangeInsertion(h,"tableColumn")}))}))}for(const n of["removeTableRow","removeTableColumn"]){const s=n.substr(11),o=s.toLowerCase(),a=o.substr(0,3)+"span",l="table"+s,c="min"+s,d="max"+s;i.enableCommand(n,(()=>{e.model.change((e=>{const s=r.getSelectionAffectedTableCells(t),u=s[0].findAncestor("table");let h;if("removeTableRow"==n){const e=r.getRowIndexes(s);h={startRow:e.first,endRow:e.last,includeAllSlots:!0}}else{const e=r.getColumnIndexes(s);h={startColumn:e.first,endColumn:e.last,includeAllSlots:!0}}const m=r.createTableWalker(u,h),g=Array.from(m).map((({cell:e})=>e)),p=uniqueValues(g.filter((e=>e.hasAttribute(a)))),f=uniqueValues(g.filter((e=>!e.hasAttribute(a)))).map((t=>e.createRangeOn(t))),y=i.markMultiRangeDeletion(f,l);if(y&&("tableRow"==y.subType||"tableColumn"==y.subType)){const t=this._getSuggestionCoords(y);for(const n of p){const i=e.createRangeOn(n),s=r.getCellLocation(n),l=n.getAttribute(a)-1,u=t[c],h=t[d];u<=s[o]&&s[o]+l<=h&&y.addRange(i)}}}))}))}function s(n){const i=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));e.model.change((t=>{const r=t.batch;n=n.filter((e=>"$graveyard"!=e.root.rootName)),t.setSelection(n),e.commands.get("removeTableRow").refresh(),e.execute("removeTableRow",{forceDefaultExecution:!0}),e.model.enqueueChange((()=>{e.model.enqueueChange(r,(e=>{const t=i.filter((e=>"$graveyard"!=e.root.rootName));t.length>0&&e.setSelection(t);for(const e of i)e.detach()}))}))}))}function o(n){e.model.change((i=>{const r=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e))),s=[];for(const e of n)for(const t of e.getItems({shallow:!0}))s.push(t);for(const t of s)"$graveyard"!=t.root.rootName&&(i.setSelection(i.createPositionAt(t,0)),e.commands.get("removeTableColumn").refresh(),e.execute("removeTableColumn",{forceDefaultExecution:!0}));const o=r.filter((e=>"$graveyard"!=e.root.rootName));o.length>0&&i.setSelection(o);for(const e of r)e.detach()}))}function a(e,t){return t.every((t=>e.some((e=>e.end.isEqual(t.start)||t.end.isEqual(e.start)))))}function l(e,t){return!e.some((e=>t.some((t=>e.isIntersecting(t)))))&&e.some((e=>t.some((t=>e.end.isTouching(t.start)))))}e.data.downcastDispatcher.on("addMarker:suggestion",((e,t,n)=>{if(!n.options.showSuggestionHighlights)return;const i=t.item;if(!i)return;const r=n.mapper.toViewElement(i);function s(e){return Array.isArray(e)?e:[e]}r&&"tableCell"===i.name&&setHighlightHandling(r,n.writer,((e,t,n)=>n.addClass(s(t.classes),e)),((e,t,n)=>n.removeClass(s(t.classes),e)))}),{priority:"highest"}),i.descriptionFactory.registerDescriptionCallback((e=>{if("insertion"!=e.type&&"deletion"!=e.type)return;const t=e.getContainedElement();if(null!=t&&t.is("element","table")){if("insertion"==e.type){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data));if(t.length)return{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",getTranslation$1(n,"ELEMENT_TABLE_WITH_TEXT",'"'+t.join(" ")+'"'))}}if("deletion"==e.type){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data));if(t.length)return{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",getTranslation$1(n,"ELEMENT_TABLE_WITH_TEXT",'"'+t.join(" ")+'"'))}}}})),i.descriptionFactory.registerDescriptionCallback((e=>{if("tableRow"==e.subType){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data)),i=this._getSuggestionCoords(e),r=i.maxRow-i.minRow+1;if("insertion"==e.type)return t.length?{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",getTranslation$1(n,"ELEMENT_TABLE_ROW_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",getTranslation$1(n,"ELEMENT_TABLE_ROW",r))};if("deletion"==e.type)return t.length?{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",getTranslation$1(n,"ELEMENT_TABLE_ROW_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",getTranslation$1(n,"ELEMENT_TABLE_ROW",r))}}if("tableColumn"==e.subType){const t=e.getItems().filter((e=>e.is("$textProxy"))).map((e=>e.data)),i=this._getSuggestionCoords(e),r=i.maxColumn-i.minColumn+1;if("insertion"==e.type)return t.length?{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",getTranslation$1(n,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"insertion",content:getTranslation$1(n,"*Insert:* %0",getTranslation$1(n,"ELEMENT_TABLE_COLUMN",r))};if("deletion"==e.type)return t.length?{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",getTranslation$1(n,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[r,'"'+t.join(" ")+'"']))}:{type:"deletion",content:getTranslation$1(n,"*Remove:* %0",getTranslation$1(n,"ELEMENT_TABLE_COLUMN",r))}}})),i._suggestionFactory.registerCustomCallback("insertion","tableRow","discard",s),i._suggestionFactory.registerCustomCallback("deletion","tableRow","accept",s),i._suggestionFactory.registerCustomCallback("insertion","tableColumn","discard",o),i._suggestionFactory.registerCustomCallback("deletion","tableColumn","accept",o),i._suggestionFactory.registerCustomCallback("insertion","tableColumn","join",a),i._suggestionFactory.registerCustomCallback("deletion","tableColumn","join",a),i._suggestionFactory.registerCustomCallback("insertion","tableRow","join",l),i._suggestionFactory.registerCustomCallback("deletion","tableRow","join",l)}_acceptFormatSuggestionCallbackFactory(){const e=this.editor,t=e.model.document.selection;return(n,i)=>{e.model.change((r=>{const{commandName:s,commandParams:o}=i;let a=n[0].end.nodeBefore;o&&o[0]&&!1===o[0].forceValue&&(a=n[0].start.nodeAfter);const l=r.createRangeIn(a);if("$graveyard"==l.root.rootName)return;const c=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));r.setSelection(l),e.commands.get(s).refresh(),o.push({forceDefaultExecution:!0}),e.execute(s,...o);const d=c.filter((e=>"$graveyard"!=e.root.rootName));d.length>0&&r.setSelection(d);for(const e of c)e.detach()}))}}_getCoordsForCells(e){const t=this.editor.plugins.get("TableUtils");let n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const o of e){if("$graveyard"==o.root.rootName)continue;const{row:e,column:a}=t.getCellLocation(o),l=o.hasAttribute("rowspan")?o.getAttribute("rowspan")-1:0,c=o.hasAttribute("colspan")?o.getAttribute("colspan")-1:0;n=e<n?e:n,i=e+l>i?e+l:i,r=a<r?a:r,s=a+c>s?a+c:s}return{minRow:n,maxRow:i,minColumn:r,maxColumn:s}}_setupColumnsRowsFixing(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("TableUtils");e.model.document.on("change:data",(()=>{const n=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:e,data:i}of n){const{group:n,id:r,subType:s}=t._splitMarkerName(e);if("suggestion"!=n)continue;if(null!=i.oldRange)continue;const o=t.getSuggestion(r);this._tablePostFixingSubtypes.includes(s)&&this._tableSuggestions.add(o)}}),{priority:"low"});const i=(e,t)=>{let i=!1;const r=t.createRangeOn(e),s=e.findAncestor("table"),o=n.getCellLocation(e);for(const t of this._tableSuggestions){const n=t.subType,a=n.startsWith("tablePaste"),l=n.substr(a?10:5),c=l.toLowerCase(),d=c.substr(0,3)+"span",u="min"+l,h="max"+l;if(!t.isInContent)continue;if(s!=t.getFirstRange().start.findAncestor("table"))continue;if(t.isIntersectingWithRange(r))continue;const m=e.hasAttribute(d)?e.getAttribute(d)-1:0,g=this._getSuggestionCoords(t),p=g[u],f=g[h];p<=o[c]&&o[c]+m<=f&&(t.addRange(r),i=!0)}return i};e.model.document.registerPostFixer((t=>{let n=!1;for(const r of e.model.document.differ.getChanges())if("insert"==r.type)if("tableRow"==r.name)for(const e of r.position.nodeAfter.getChildren())n=n||i(e,t);else"tableCell"==r.name&&(n=n||i(r.position.nodeAfter,t));return n}))}_getSuggestionCoords(e){return this._getCoordsForCells(e.getRanges().map((e=>e.start.nodeAfter)))}}function uniqueValues(e){return Array.from(new Set(e).values())}class TrackChangesTableMergeSplit extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor,t=e.model.document.selection,n=e.locale;if(!e.plugins.has("TableEditing"))return;const i=e.plugins.get("TrackChangesEditing"),r=e.plugins.get("TableUtils"),s=e.plugins.get(TrackChangesTable);s._tablePostFixingSubtypes.push("mergeTableCells"),i.enableCommand("mergeTableCells",(()=>{const t=r.getSelectionAffectedTableCells(e.model.document.selection);e.model.change((()=>{i.markMultiRangeBlockFormat(t,{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")}))})),e.commands.get("mergeTableCells").on("execute",((t,n)=>{e.commands.get("trackChanges").value&&(n.length>0&&n[n.length-1]&&n[n.length-1].forceDefaultExecution||i._isForcedDefaultExecutionBlock||this._areSelectedCellsMergable()||t.stop())}),{priority:"highest"});for(const t of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"]){const n=e.commands.get(t);i.enableCommand(t,(()=>{const t=e.model.document.selection.getFirstPosition().getAncestors().find((e=>e.is("element","tableCell"))),r=n.value;e.model.change((()=>{i.markMultiRangeBlockFormat([t,r],{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")}))}))}for(const t of["splitTableCellVertically","splitTableCellHorizontally"]){const n=e.commands.get(t);i.enableCommand(t,(()=>{const s=r.getSelectionAffectedTableCells(e.model.document.selection)[0],o=s.findAncestor("table"),{column:a,row:l}=r.getCellLocation(s);let c=[];if("horizontally"==n.direction){const e=r.createTableWalker(o,{startRow:l,endRow:l,includeAllSlots:!0});c=Array.from(e).map((e=>e.cell))}else{const e=r.createTableWalker(o,{column:a,includeAllSlots:!0});c=Array.from(e).map((e=>e.cell))}e.model.change((e=>{i.markBlockFormat(e.createRangeOn(s),{commandName:t,commandParams:[]},c,t)}))}))}i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t&&"mergeTableCells"==t.commandName?{type:"format",content:getTranslation$1(n,"*Merge cells*")}:void 0})),i.descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;return t?"splitTableCellVertically"==t.commandName?{type:"format",content:getTranslation$1(n,"*Split cell:* vertically")}:"splitTableCellHorizontally"==t.commandName?{type:"format",content:getTranslation$1(n,"*Split cell:* horizontally")}:void 0:void 0}));const o=s._acceptFormatSuggestionCallbackFactory();for(const e of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"])i._suggestionFactory.registerCustomCallback("formatBlock",e,"accept",o);for(const e of["splitTableCellVertically","splitTableCellHorizontally"])i._suggestionFactory.registerCustomCallback("formatBlock",e,"accept",o);i._suggestionFactory.registerCustomCallback("formatBlock","mergeTableCells","accept",(n=>{e.model.change((i=>{const r=Array.from(t.getRanges()).map((e=>LiveRange.fromRange(e)));i.setSelection(n),e.commands.get("mergeTableCells").refresh(),e.execute("mergeTableCells",{forceDefaultExecution:!0});const s=r.filter((e=>"$graveyard"!=e.root.rootName));s.length>0&&i.setSelection(s);for(const e of r)e.detach()}))}));for(const t of["mergeTableCellUp","mergeTableCellDown","mergeTableCellLeft","mergeTableCellRight"]){const n=e.commands.get(t);n.on("set:isEnabled",((t,i,r)=>{if(r){const i=e.model.document.selection.getFirstPosition().getAncestors().find((e=>e.is("element","tableCell")));this._areMergableCells(n.value,i)||(t.return=!1,t.stop())}}),{priority:"low"})}}_areSelectedCellsMergable(){const e=this.editor.commands.get("mergeTableCells"),t=this.editor.plugins.get("TableUtils");if(!e.isEnabled)return!1;const n=t.getSelectionAffectedTableCells(this.editor.model.document.selection);for(const e of n)for(const t of n)if(e!=t&&!this._areMergableCells(e,t))return!1;return!0}_areMergableCells(e,t){const n=this.editor.plugins.get("TrackChangesEditing"),i=this.editor.model.createRangeOn(e),r=this.editor.model.createRangeOn(t),s=new Set,o=new Set;for(const e of n.getSuggestions())if(("insertion"==e.type||"deletion"==e.type||"mergeTableCells"==e.subType)&&e.isInContent)for(const t of e.getRanges())t.containsRange(i,!0)&&s.add(e.type+":"+e.author.id),t.containsRange(r,!0)&&o.add(e.type+":"+e.author.id);if(s.size!=o.size)return!1;for(const e of s)if(!o.has(e))return!1;return!0}}class TrackChangesTableHeadings extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;if(!e.plugins.has("TableEditing"))return;const t=e.locale,n=e.plugins.get("TrackChangesEditing");n.enableDefaultAttributesIntegration("setTableRowHeader"),n.enableDefaultAttributesIntegration("setTableColumnHeader"),n.registerBlockAttribute("headingRows"),n.registerBlockAttribute("headingColumns"),n.descriptionFactory.registerAttributeLabel("headingRows",getTranslation$1(t,"FORMAT_HEADER_ROW")),n.descriptionFactory.registerAttributeLabel("headingColumns",getTranslation$1(t,"FORMAT_HEADER_COLUMN")),this._handleLegacySuggestions()}_handleLegacySuggestions(){const e=this.editor.plugins.get("TrackChangesEditing"),t=this.editor.plugins.get("TableUtils"),n=this.editor.plugins.get(TrackChangesTable)._acceptFormatSuggestionCallbackFactory();function i({showActiveMarker:n=!0,setDataAttribute:i=!0}={}){return(r,s,o)=>{const{type:a,id:l}=e._splitMarkerName(s.markerName),c=e.getSuggestion(l),d=c.data;if("formatBlock"!=c.type||!d||"setTableColumnHeader"!=d.commandName)return;if(s.item)return void r.stop();if(!o.consumable.consume(s.markerRange,r.name))return;const u=s.markerRange.start.nodeAfter,h=s.markerRange.end.nodeBefore,m=u.parent.parent,{column:g}=t.getCellLocation(u),{column:p}=t.getCellLocation(h);for(let r=g;r<=p;r++){const c=t.createTableWalker(m,{column:r,includeAllSlots:!1});for(const t of c){const r=t.cell,c=o.mapper.toViewElement(r);o.writer.addClass("ck-suggestion-marker-"+a,c),i&&o.writer.setAttribute("data-suggestion",l,c),o.mapper.bindElementToMarker(c,s.markerName),n&&(e.activeMarkers.includes(s.markerName)?o.writer.addClass("ck-suggestion-marker--active",c):o.writer.removeClass("ck-suggestion-marker--active",c))}}}}e._suggestionFactory.registerCustomCallback("formatBlock","setTableRowHeader","accept",n),e._suggestionFactory.registerCustomCallback("formatBlock","setTableColumnHeader","accept",n),this.editor.editing.downcastDispatcher.on("addMarker:suggestion",i(),{priority:"highest"}),this.editor.data.downcastDispatcher.on("addMarker:suggestion",((e,t,n)=>{n.options.showSuggestionHighlights&&i({showActiveMarker:!1,setDataAttribute:!1})(e,t,n)}),{priority:"highest"}),this.editor.editing.downcastDispatcher.on("removeMarker:suggestion",((t,n,i)=>{const{type:r,id:s}=e._splitMarkerName(n.markerName),o=e.getSuggestion(s),a=o.data;if("formatBlock"!=o.type||!a||"setTableColumnHeader"!=a.commandName)return;const l=i.mapper.markerNameToElements(n.markerName);if(l)for(const e of l)i.writer.removeClass("ck-suggestion-marker-"+r,e),i.writer.removeClass("ck-suggestion-marker--active",e),i.writer.removeAttribute("data-suggestion",e),i.mapper.unbindElementFromMarkerName(e,n.markerName)}),{priority:"highest"}),this._registerLegacyDescription()}_registerLegacyDescription(){const e=this.editor,t=e.locale;function n(e){return{type:"format",content:getTranslation$1(t,"*Format:* %0",e)}}e.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback((e=>{if("formatBlock"!=e.type)return;const{data:i}=e;if(i){if("setTableRowHeader"==i.commandName){const e=i.commandParams[0].forceValue;return n(getTranslation$1(t,e?"FORMAT_HEADER_ROW":"FORMAT_REGULAR_ROW"))}if("setTableColumnHeader"==i.commandName){const e=i.commandParams[0].forceValue;return n(getTranslation$1(t,e?"FORMAT_HEADER_COLUMN":"FORMAT_REGULAR_COLUMN"))}}}))}}const tableCellStyleAttributeNames=["tableCellBorderWidth","tableCellBorderColor","tableCellBorderStyle","tableCellHorizontalAlignment","tableCellVerticalAlignment","tableCellBackgroundColor","tableCellPadding"],tableCellStyleAttributesObject=Object.fromEntries(tableCellStyleAttributeNames.map((e=>[e,null])));class TrackChangesTableClipboard extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;if(!e.plugins.has("TableClipboard"))return;const t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("TableUtils"),i=e.plugins.get(TrackChangesTable),r=e.plugins.get("TableClipboard");i._tablePostFixingSubtypes.push("tablePasteRow","tablePasteColumn"),e.model.schema.register("tableCellSuggestion",{allowIn:"tableCell",allowContentOf:"tableCell",isLimit:!0}),e.conversion.elementToElement({model:"tableCellSuggestion",view:"suggestion-td"});let s=null;e.model.on("insertContent",((i,o)=>{const[a,l]=o,c=o[o.length-1];c&&c.forceDefaultExecution||t._isForcedDefaultExecutionBlock||this.editor.commands.get("trackChanges").value&&isPasteTableIntoTable(a,l,e.model,n,r)&&(i.stop(),s={cells:[],insertionRanges:[],deletionRanges:[],rowInsertionRanges:[],rowInsertionIndexes:[],columnInsertionRanges:[],columnInsertionIndexes:[]},e.model.change((()=>{e.model.insertContent(o[0],o[1],o[2],{forceDefaultExecution:!0});const n=uid(),{rowInsertionRanges:i,columnInsertionRanges:r,insertionRanges:a,deletionRanges:l,cells:c}=s;i.length&&t.markMultiRangeInsertion(i,"tablePasteRow",{tablePasteChainId:n}),r.length&&t.markMultiRangeInsertion(r,"tablePasteColumn",{tablePasteChainId:n}),a.length&&(t.markMultiRangeInsertion(a,"tablePaste",{tablePasteChainId:n,skipNestingCheck:!0}),a.forEach((e=>{var t;return null===(t=e.detach)||void 0===t?void 0:t.call(e)}))),l.length&&(t.markMultiRangeDeletion(l,"tablePaste",{tablePasteChainId:n,skipNestingCheck:!0}),l.forEach((e=>{var t;return null===(t=e.detach)||void 0===t?void 0:t.call(e)})));const d=t.markMultiRangeBlockFormat(c.map((({element:e})=>e)),{formatGroupId:uid()},[],"tablePasteCell",{tablePasteChainId:n});if(d){const t=d.getMarkers(),n=[];for(const{element:i,attributes:r}of c){if(!r)continue;const s=e.model.createRangeOn(i),o=t.find((e=>e.getRange().isEqual(s)));o&&n.push([o.name,r])}n.length&&d.setAttribute("markerAttributes",Object.fromEntries(n))}s=null})))}),{priority:priorities.high+10}),e.plugins.get("TableClipboard").on("_replaceTableSlotCell",((e,t)=>{const[n,i,,r]=t;if(!s)return;e.stop();const o=n.cell,a=i,l=isEmpty(o),c=isEmpty(a);e.return=o;let d=null,u=null;if(c||l)if(l&&!c){r.remove(o.getChild(0));for(const e of Array.from(a.getChildren()))r.insert(e,o,"end");const e=s.rowInsertionIndexes.includes(n.row),t=s.columnInsertionIndexes.includes(n.column);e||t||(d=LiveRange.fromRange(r.createRangeIn(o)))}else c&&!l&&(u=r.createRangeIn(o));else{const e=r.createElement("tableCellSuggestion"),t=r.createElement("tableCellSuggestion");r.wrap(r.createRangeIn(o),t),r.insert(e,o,0);for(const t of Array.from(a.getChildren()))r.insert(t,e,"end");d=LiveRange.fromRange(r.createRangeOn(e)),u=LiveRange.fromRange(r.createRangeOn(t))}const h=Array.from(a.getAttributes()).filter((([e])=>tableCellStyleAttributeNames.includes(e)));s.cells.push({element:o,attributes:h.length?Object.fromEntries(h):null}),d&&s.insertionRanges.push(d),u&&s.deletionRanges.push(u)}),{priority:"high"}),n.on("insertColumns",((t,i)=>{const[r,o={}]=i;if(!s)return;const a=o.at||0,l=o.columns||1;s.columnInsertionIndexes=new Array(l).fill(a).map(((e,t)=>e+t));for(const{cell:t}of n.createTableWalker(r,{startColumn:a,endColumn:a+l-1}))s.columnInsertionRanges.push(e.model.createRangeOn(t))}),{priority:"low"}),n.on("insertRows",((t,i)=>{const[r,o={}]=i;if(!s)return;const a=o.at||0,l=o.rows||1;s.rowInsertionIndexes=new Array(l).fill(a).map(((e,t)=>e+t));for(const{cell:t}of n.createTableWalker(r,{startRow:a,endRow:a+l-1}))s.rowInsertionRanges.push(e.model.createRangeOn(t))}),{priority:"low"}),t.descriptionFactory.registerDescriptionCallback((t=>{if(t.subType&&t.subType.startsWith("tablePaste"))return t.previous?{}:{type:"insertion",content:getTranslation$1(e.locale,"*Replace table cells*")}}));const o=()=>!1;for(const e of["tablePaste","tablePasteColumn","tablePasteRow","tablePasteCell"])t._suggestionFactory.registerCustomCallback("insertion",e,"join",o),t._suggestionFactory.registerCustomCallback("deletion",e,"join",o),t._suggestionFactory.registerCustomCallback("formatBlock",e,"join",o);t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","discard",o),t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","accept",((t,n,i)=>{const r=t.map((e=>e.getContainedElement())).filter((e=>e)),o=new Map(r.map((e=>[e,null])));if(s)for(const{element:e,attributes:t}of s.cells)t&&o.set(e,t);else if(i&&i.markerAttributes)for(const[t,n]of Object.entries(i.markerAttributes)){const i=e.model.markers.get(t),r=i?i.getRange().getContainedElement():null;r&&o.set(r,n)}e.model.change((e=>{for(const[t,n]of o)e.setAttributes({...tableCellStyleAttributesObject,...n},t)}))}));const a=(n,i)=>{t._suggestionFactory.registerCustomCallback(n,"tablePaste",i,((r,s,o)=>{e.model.change((e=>{const a=[];for(const e of r){const t=e.start.nodeAfter;t.is("element","tableCellSuggestion")&&a.push(t)}t._suggestionFactory.getSuggestionCallback(n,null,i)(r,s,o);for(const t of a)"$graveyard"!=t.root.rootName&&e.unwrap(t)}))}))};a("insertion","accept"),a("insertion","discard"),a("deletion","accept"),a("deletion","discard"),t._suggestionFactory.registerCustomCallback("insertion","tablePasteRow","discard",(e=>{const t=e.map((e=>e.getContainedElement())),r=t[0].findAncestor("table"),{minRow:s,maxRow:o}=i._getCoordsForCells(t);n.removeRows(r,{at:s,rows:o-s+1})})),t._suggestionFactory.registerCustomCallback("insertion","tablePasteColumn","discard",(e=>{const t=e.map((e=>e.getContainedElement())),r=t[0].findAncestor("table"),{minColumn:s,maxColumn:o}=i._getCoordsForCells(t);n.removeColumns(r,{at:s,columns:o-s+1})}));const l=(e,n)=>{if(!n.subType||!n.subType.startsWith("tablePaste"))return;const i=n.attributes.tablePasteChainId,r=t.getSuggestions().filter((e=>e.isInContent&&e.attributes&&e.attributes.tablePasteChainId==i));r.length&&n.getAllAdjacentSuggestions().length!=r.length&&r.reduce(((e,t)=>(e.next=t,t.previous=e,t)))};function c(e,n=!0){const{id:i,authorId:r}=t._splitMarkerName(e.markerName),s=["ck-suggestion-marker","ck-suggestion-marker-insertion"],o=t.activeMarkers.includes(e.markerName);return o&&s.push("ck-suggestion-marker--active"),{classes:s,attributes:{"data-suggestion":i,"data-author-id":r},priority:o&&n?3010:3e3}}t.on("suggestionLoaded",l,{priority:"high"}),t.on("suggestionUnloaded",l,{priority:"high"}),e.model.document.registerPostFixer((()=>{let n=!1;const i=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:r,data:s}of i){const{group:i,type:o,id:a}=t._splitMarkerName(r);if("suggestion"!=i||"deletion"!=o||s.oldRange)continue;if(!t.hasSuggestion(a))continue;const l=t.getSuggestion(a).getRanges(),c=e.plugins.get("Users").me;for(const e of t.getSuggestions())if(e.isInContent&&e.author==c&&"formatBlock"==e.type&&"tablePasteCell"==e.subType&&e.getRanges().every((e=>l.some((t=>t.containsRange(e,!0))))))for(const t of e.getAllAdjacentSuggestions())t.isInContent&&(t.discard(),n=!0)}return n})),e.model.document.registerPostFixer((n=>{const i=e.commands.get("redo");if(!i||!i._createdBatches.has(n.batch))return!1;let r=!1;const s=e.plugins.get("Users").me,o=e.model.document.differ.getChanges(),a=Array.from(e.model.document.differ.getChangedMarkers()).filter((({name:e,data:n})=>{const{group:i,subType:r,authorId:o}=t._splitMarkerName(e);return"suggestion"==i&&"tablePaste"==r&&o==s.id&&!n.oldRange}));for(const e of o){if("insert"!=e.type||"tableCellSuggestion"!=e.name||1!=e.length)continue;const t=n.createRange(e.position,e.position.getShiftedBy(1));if(!a.find((({data:e})=>e.newRange.isEqual(t))))for(const{name:e,data:i}of a)if(t.containsRange(i.newRange)){n.updateMarker(e,{range:t}),r=!0;break}}return r})),e.model.document.registerPostFixer((n=>{let i=!1;const r=e.plugins.get("Users").me,s=t.getSuggestions().filter((e=>e.isInContent&&e.author==r)),o=new Set,a=new Set;for(const e of s)if("tablePaste"==e.subType)for(const t of e.getMarkers()){const n=t.getRange().getContainedElement();if(n)if(n.is("element","tableCellSuggestion")&&isEmpty(n)){e.removeMarker(t.name),o.add(n),i=!0;const r=n.nextSibling,s=n.previousSibling,l=r&&r.is("element","tableCellSuggestion"),c=s&&s.is("element","tableCellSuggestion");l&&!o.has(r)&&a.add(r),c&&!o.has(s)&&a.add(s)}else n.is("element","paragraph")&&n.isEmpty&&(e.removeMarker(t.name),i=!0)}else if("tablePasteCell"==e.subType){if(!e.attributes||!e.attributes.tablePasteChainId)continue;const t=e.attributes.markerAttributes;if(t&&Object.keys(t).length)continue;const n=e.attributes.tablePasteChainId;let r=!0,o=!0;for(const t of s)if(t.subType&&t.subType.startsWith("tablePaste")){if(!t.attributes.tablePasteChainId){o=!1;break}if(t.id!=e.id&&t.attributes.tablePasteChainId==n){r=!1;break}}o&&r&&(e.removeMarkers(),i=!0)}for(const e of o)n.remove(e);for(const e of a)n.unwrap(e);return i})),e.conversion.for("editingDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:e=>c(e),converterPriority:"high"}),e.conversion.for("dataDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:(e,t)=>t.options.showSuggestionHighlights?c(e,!1):null,converterPriority:"high"});const d=e.editing.view;this.listenTo(d.document,"clipboardOutput",((e,t)=>{const n=[];for(const e of d.createRangeIn(t.content).getItems())e.is("element","suggestion-td")&&n.push(e);d.change((e=>{for(const t of n)e.move(e.createRangeIn(t),e.createPositionBefore(t)),e.remove(t)}))}))}}function isEmpty(e){if(e.isEmpty)return!0;const t=e.getChild(0);return t.is("element","paragraph")&&t.isEmpty}function isPasteTableIntoTable(e,t,n,i,r){if(t&&!t.is("documentSelection"))return!1;const s=r.getTableIfOnlyTableInContent(e,n);if(!s||!isPlainTable(s,void 0,i))return!1;const o=i.getSelectionAffectedTableCells(n.document.selection);if(!o.length)return!1;const a=o[0].findAncestor("table"),l=i.getRowIndexes(o),c=i.getColumnIndexes(o),d={startRow:l.first,endRow:l.last,startColumn:c.first,endColumn:c.last};return 1==o.length&&(d.endRow+=i.getRows(s)-1,d.endColumn+=i.getColumns(s)-1),isPlainTable(a,d,i)}function isPlainTable(e,t={},n){for(const{isAnchor:i,cellHeight:r,cellWidth:s}of n.createTableWalker(e,{includeAllSlots:!0,...t}))if(!i||1!=r||1!=s)return!1;return!0}class TrackChangesTableColumnResize extends Plugin{afterInit(){if(!this.editor.plugins.has("TableColumnResizeEditing"))return;const e=this.editor.plugins.get("TrackChangesEditing");e.enableCommand("resizeTableWidth",this.handleResizeTableWidthCommand.bind(this)),e._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","discard",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),e.descriptionFactory.registerDescriptionCallback(this.handleSuggestionDescription.bind(this))}handleResizeTableWidthCommand(e,t){const n=this.editor.plugins.get("TrackChangesEditing"),i=this.editor.plugins.get("TableColumnResizeEditing"),r=t.table||this.editor.model.document.selection.getSelectedElement();this.editor.model.change((()=>{const s=i.getColumnGroupElement(r);let o=s?i.getTableColumnsWidths(s):null,a=r.getAttribute("tableWidth")||null;const l=t.tableWidth||a,c=t.columnWidths||o,d=this.editor.plugins.get("Users").me;for(const e of n.getSuggestions()){const t=e.getContainedElement();if("resizeTable"===e.subType&&t===r){e.author!==d&&e.discard();const t=e.data.commandParams;a=t[0].tableWidth,o=t[0].columnWidths;break}}e({table:r,tableWidth:l,columnWidths:c}),n.markBlockFormat(r,{commandName:"resizeTableWidth",commandParams:[{tableWidth:a,columnWidths:o}],formatGroupId:"resizeTable"},[],"resizeTable")}))}handleSuggestionDescription(e){if("formatBlock"!=e.type&&"formatInline"!=e.type)return;const{data:t}=e;if(t&&"resizeTable"===t.formatGroupId){const e="*Format:* resize table";return{type:"format",content:getTranslation$1(this.editor.locale,e)}}}}class TrackChangesTemplate extends Plugin{afterInit(){const e=this.editor;e.plugins.has("Template")&&e.plugins.get("TrackChangesEditing").enableCommand("insertTemplate")}}class TrackChangesTableOfContents extends Plugin{afterInit(){const e=this.editor;if(!e.commands.get("insertTableOfContents"))return;e.plugins.get("TrackChangesEditing").enableCommand("insertTableOfContents");const t=e.plugins.get("TrackChangesEditing"),n=e.locale;t.descriptionFactory.registerElementLabel("tableOfContents",(e=>getTranslation$1(n,"ELEMENT_TABLE_OF_CONTENTS",e)))}}class TrackChangesTitle extends Plugin{afterInit(){const e=this.editor;if(!e.plugins.has("Title"))return;const t=e.plugins.get("TrackChangesEditing");t.descriptionFactory.registerElementLabel("title-content",(()=>getTranslation$1(e.locale,"ELEMENT_TITLE"))),e.model.document.registerPostFixer((n=>{let i=!1;const r=Array.from(e.model.document.differ.getChangedMarkers());for(const{name:s,data:o}of r){const{group:r}=t._splitMarkerName(s);if("suggestion"!==r||!o.newRange)continue;const a=o.newRange,l=a.end.nodeBefore;if(!l||!l.is("element","title-content"))continue;if(!a.start.isTouching(a.end))continue;const c=e.model.schema.getNearestSelectionRange(a.end,"forward");if(c&&c.isCollapsed){const e=n.createRange(a.start,c.start);e.isEqual(a)||(n.updateMarker(s,{range:e}),i=!0)}i||(n.removeMarker(s),i=!0)}return i}))}}class TrackChangesUploadcare extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.plugins.has("Uploadcare")&&(t.enableCommand("uploadcare"),e.plugins.has("UploadcareImageEdit")&&(t.enableCommand("uploadcareImageEdit"),t.enableDefaultAttributesIntegration("uploadcareImageReplace"),t.registerBlockAttribute("uploadcareImageId"),t.descriptionFactory.registerDescriptionCallback((e=>{if("attribute"!=e.type)return;const{data:t}=e;return t&&"uploadcareImageId"==t.key?{type:"format",content:""}:void 0}))))}}class TrackChangesUndo extends Plugin{afterInit(){const e=this.editor,t=e.plugins.get("TrackChangesEditing");e.plugins.has("UndoEditing")&&(t.enableCommand("undo"),t.enableCommand("redo"))}}class TrackChangesTableCaption extends Plugin{static get requires(){return[TrackChangesTable]}afterInit(){const e=this.editor;e.plugins.has("TableCaptionEditing")&&e.plugins.get("TrackChangesEditing").enableCommand("toggleTableCaption")}}class TrackChangesTableProperties extends Plugin{constructor(e){super(e),this.tableProperties=["tableBorderColor","tableBorderStyle","tableBorderWidth","tableAlignment","tableWidth","tableHeight","tableBackgroundColor"],this.tableCellProperties=["tableCellBorderColor","tableCellBorderStyle","tableCellBorderWidth","tableCellPadding","tableCellWidth","tableCellHeight","tableCellBackgroundColor","tableCellHorizontalAlignment","tableCellVerticalAlignment"]}static get pluginName(){return"TrackChangesTableProperties"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}afterInit(){const e=this.editor.plugins.get("TrackChangesEditing");if(this.editor.plugins.has("TablePropertiesEditing")){for(const t of this.tableProperties)e.enableCommand(t,((e,n)=>{const i=this.editor.model.document.selection.getFirstPosition().findAncestor("table");this._handlePropertyChange(t,[i],this.tableProperties,"tableProperties",e,n)}));e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","discard",((e,t)=>this.handleDiscardAction(this.tableProperties,e,t))),e._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","join",(()=>!1))}if(this.editor.plugins.has("TableCellPropertiesEditing")){for(const t of this.tableCellProperties)e.enableCommand(t,((e,n)=>{const i=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this._handlePropertyChange(t,i,this.tableCellProperties,"tableCellProperties",e,n)}));e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","accept",e._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","discard",((e,t)=>this.handleDiscardAction(this.tableCellProperties,e,t))),e._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","join",(()=>!1))}e.descriptionFactory.registerDescriptionCallback((e=>this.handleSuggestionDescription(e)))}_handlePropertyChange(e,t,n,i,r,s){const o=this.editor.plugins.get("TrackChangesEditing");this.editor.model.enqueueChange(s.batch,(()=>{for(const e of t)if(this._getSuggestion(e,i))r(s);else{const t={};for(const i of n){const n=e.getAttribute(i);void 0!==n&&(t[i]=n)}r(s),o.markBlockFormat(e,{commandParams:[t]},[],i)}}))}handleDiscardAction(e,t,n){const i=t[0].start.nodeAfter,r=n.commandParams[0];this.editor.model.change((t=>{for(const n of e)void 0!==r[n]?t.setAttribute(n,r[n],i):t.removeAttribute(n,i)}))}handleSuggestionDescription(e){if(e.data)switch(e.subType){case"tableProperties":return{type:"format",content:getTranslation$1(this.editor.locale,"*Format:* change table properties")};case"tableCellProperties":return{type:"format",content:getTranslation$1(this.editor.locale,"*Format:* change table cell properties")}}}_getSuggestion(e,t){const n=this.editor.plugins.get("TrackChangesEditing");for(const i of n.getSuggestions({skipNotAttached:!0})){const n=i.getContainedElement();if(i.subType===t&&n===e)return i}return null}}const renameAttributeKey="$elementName";class TrackChangesEditing extends Plugin{static get requires(){return["CommentsRepository",Users,PendingActions,TrackChangesAIAssistant,TrackChangesAlignment,TrackChangesBasicStyles,TrackChangesBlockQuote,TrackChangesBookmark,TrackChangesCKBox,TrackChangesCaseChange,TrackChangesCodeBlock,TrackChangesComments,TrackChangesDeleteCommand,TrackChangesEmoji,TrackChangesEnterCommand,TrackChangesFindAndReplace,TrackChangesFont,TrackChangesFormatPainter,TrackChangesHeading,TrackChangesHighlight,TrackChangesHorizontalLine,TrackChangesHtmlEmbed,TrackChangesImage,TrackChangesImageStyle,TrackChangesImageReplace,TrackChangesImportWord,TrackChangesIndent,TrackChangesInputCommand,TrackChangesLegacyList,TrackChangesListProperties,TrackChangesMultiLevelList,TrackChangesLink,TrackChangesList,TrackChangesDocumentListProperties,TrackChangesMediaEmbed,TrackChangesMention,TrackChangesMergeFields,TrackChangesPageBreak,TrackChangesParagraph,TrackChangesReplaceSourceCommand,TrackChangesRemoveFormat,TrackChangesRestrictedEditingMode,TrackChangesShiftEnterCommand,TrackChangesStandardEditingMode,TrackChangesStylesDropdown,TrackChangesTable,TrackChangesTableMergeSplit,TrackChangesTableHeadings,TrackChangesTableCaption,TrackChangesTableClipboard,TrackChangesTableColumnResize,TrackChangesTableOfContents,TrackChangesTableProperties,TrackChangesTemplate,TrackChangesTitle,TrackChangesUploadcare,TrackChangesUndo]}static get pluginName(){return"TrackChangesEditing"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._recordAttributeSuggestions=!1,this.set("activeMarkers",[]),this.on("change:activeMarkers",((t,n,i,r)=>{this._model.change((()=>{for(const t of[...r,...i])this._model.markers.has(t)&&e.editing.reconvertMarker(t)}))})),this.descriptionFactory=new SuggestionDescriptionFactory(this.editor.model.schema,this.editor.locale),this._adapter=null,this._suggestionFactory=new SuggestionFactory(this.editor),this._suggestions=new Map,this._commentsRepository=e.plugins.get("CommentsRepository"),this._enabledCommands=new Set,this._model=this.editor.model,this._suggestionState=new WeakMap,this._isForcedDefaultExecutionBlock=!1,this._blockAttributeKeys=new Set([renameAttributeKey]),this._inlineAttributeKeys=new Set,e.config.define("trackChanges.trackFormatChanges","default"),this._trackFormatChanges=e.config.get("trackChanges.trackFormatChanges"),e.config.define("trackChanges.mergeNestedSuggestions",!0),this._mergeNestedSuggestions=e.config.get("trackChanges.mergeNestedSuggestions"),this.trackChangesCommand=new TrackChangesCommand(e,this._enabledCommands),this._initAriaMarkerChangeAnnouncements()}init(){const e=this.editor,t=(e,t)=>{if("attribute"!=e)return"ck-suggestion-marker-"+e;const n=t.split("|")[0];return this._isBlockAttribute(n)?"ck-suggestion-marker-formatBlock":"ck-suggestion-marker-formatInline"};e.conversion.for("editingDowncast").markerToHighlight({model:"suggestion",view:e=>{const{id:n,authorId:i,type:r,subType:s}=this._splitMarkerName(e.markerName),o=["ck-suggestion-marker",t(r,s)];let a=3e3;return this.activeMarkers.includes(e.markerName)&&(o.push("ck-suggestion-marker--active"),a=3010),"deletion"==r&&(a+=5),{classes:o,attributes:{"data-suggestion":n,"data-author-id":i},priority:a}}}),e.conversion.for("dataDowncast").add((t=>{t.on("addMarker:suggestion",((t,n,i)=>{if(!i.options.showSuggestionHighlights)return;const r=n.item;if(!r)return;const s=i.mapper.toViewElement(r);e.model.schema.isObject(r)&&s&&!s.getCustomProperty("widget")&&s.is("containerElement")&&toWidget(s,i.writer)}),{priority:"high"})})),e.conversion.for("dataDowncast").markerToHighlight({model:"suggestion",view:(e,n)=>{if(!n.options.showSuggestionHighlights)return null;const{type:i,subType:r}=this._splitMarkerName(e.markerName);return{classes:["ck-suggestion-marker",t(i,r)],priority:3e3}}});const n=({showActiveMarkers:t=!0,isAttributeSuggestion:n=!1}={})=>(i,r,s)=>{if(!r.item)return;const{id:o,authorId:a}=this._splitMarkerName(r.markerName);if(n){const e=this._suggestions.get(o),t=this._getAttributeKey(e);if(!this._isBlockAttribute(t))return}if(r.item.is("selection"))return void s.consumable.consume(r.item,i.name);const l=s.mapper.toViewElement(r.item);if(r.item.is("element")&&e.model.schema.isBlock(r.item)&&!l.getCustomProperty("addHighlight")){s.writer.addClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock"],l),s.writer.setAttribute("data-suggestion",o,l),s.writer.setAttribute("data-author-id",a,l),s.mapper.bindElementToMarker(l,r.markerName),t&&(this.activeMarkers.includes(r.markerName)?s.writer.addClass("ck-suggestion-marker--active",l):s.writer.removeClass("ck-suggestion-marker--active",l));for(const t of e.model.createRangeIn(r.item).getItems())s.consumable.consume(t,i.name);s.consumable.consume(r.item,i.name)}};e.conversion.for("dataDowncast").add((e=>{e.on("addMarker:suggestion:formatBlock",((e,t,i)=>{i.options.showSuggestionHighlights&&n({showActiveMarkers:!1})(e,t,i)}),{priority:"highest"})})),e.conversion.for("dataDowncast").add((e=>{e.on("addMarker:suggestion:attribute",((e,t,i)=>{i.options.showSuggestionHighlights&&n({showActiveMarkers:!1,isAttributeSuggestion:!0})(e,t,i)}),{priority:"highest"})})),e.conversion.for("dataDowncast").markerToData({model:"suggestion",view:(e,t)=>t.options.showSuggestionHighlights?null:{group:"suggestion",name:e.substr(11)}}),e.conversion.for("upcast").elementToElement({view:{name:"suggestion",attributes:{id:/^\w/,"suggestion-type":/^\w/}},model:(e,{writer:t})=>{let n="suggestion:"+e.getAttribute("suggestion-type")+":"+e.getAttribute("id");return e.getAttribute("marker-count")&&(n+=":"+e.getAttribute("marker-count")),t.createElement("$marker",{"data-name":n})}}),e.conversion.for("upcast").dataToMarker({view:"suggestion"}),e.conversion.for("editingDowncast").add((e=>{e.on("addMarker:suggestion:formatBlock",n(),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("addMarker:suggestion:attribute",n({isAttributeSuggestion:!0}),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("removeMarker:suggestion:formatBlock",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(i)for(const e of i)e.getCustomProperty("addHighlight")||(n.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],e),n.writer.removeAttribute("data-suggestion",e),n.writer.removeAttribute("data-author-id",e),n.mapper.unbindElementFromMarkerName(e,t.markerName))}),{priority:"high"})})),e.conversion.for("editingDowncast").add((e=>{e.on("removeMarker:suggestion:attribute",((e,t,n)=>{const i=n.mapper.markerNameToElements(t.markerName);if(!i)return;const{id:r}=this._splitMarkerName(t.markerName),s=this._suggestions.get(r),o=this._getAttributeKey(s);if(this._isBlockAttribute(o))for(const e of i)e.getCustomProperty("addHighlight")||(n.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],e),n.writer.removeAttribute("data-suggestion",e),n.writer.removeAttribute("data-author-id",e),n.mapper.unbindElementFromMarkerName(e,t.markerName))}),{priority:"high"})})),e.model.document.registerPostFixer((t=>{let n=!1;const i=Array.from(e.model.document.differ.getChangedMarkers()),r=new Set;for(const{name:s,data:o}of i){const{group:i,type:a,subType:l,id:c}=this._splitMarkerName(s);if("suggestion"!==i)continue;const d=this._suggestions.get(c);if(null!=o.newRange){"formatInline"==a&&(n=n||trimFormatInlineSuggestionRange(o.newRange,s,t,e.model.schema));const i="attribute"==a&&this._isBlockAttribute(l.split("|")[0]);if(o.newRange.isCollapsed||"$graveyard"==o.newRange.root.rootName||"formatBlock"==a&&!isCorrectFormatBlockSuggestionRange(o.newRange)||i&&!isCorrectFormatBlockSuggestionRange(o.newRange)||"deletion"==a&&!isCorrectDeletionSuggestionRange(o.newRange))t.removeMarker(s),n=!0;else{if(!d||!d.isInContent)continue;if(o.newRange&&o.oldRange&&o.newRange.isEqual(o.oldRange))continue;r.add(d)}}}return r.size>0&&(n=!!this._joinWithAdjacentSuggestions(r)||n),n})),e.model.document.registerPostFixer((t=>{let n=!1;for(const i of e.model.document.differ.getChanges())if("insert"==i.type)for(const i of this._suggestions.values()){if(i.isMultiRange||!i.isInContent)continue;const r="formatBlock"==i.type,s=this._getAttributeKey(i),o=s&&this._isBlockAttribute(s);if(!r&&!o)continue;const a=i.getFirstRange();if(a.start.parent!=a.end.parent&&!a.end.isAtEnd){const r=e.model.createPositionAt(a.start.nodeAfter,"end"),s=e.model.createRange(a.start,r);t.updateMarker(i.getFirstMarker(),{range:s}),n=!0}}return n})),e.model.document.registerPostFixer((e=>this._processAttributeChanges(e))),e.model.document.registerPostFixer((e=>!e.batch.isLocal&&this._processAttributeSuggestions(e))),e.model.on("_afterChanges",(()=>{this._recordAttributeSuggestions=!1})),e.model.document.on("change:data",((t,n)=>{if(!n.isLocal||n.isUndo)return;if(!this._recordAttributeSuggestions)return;const i=e.model.document.differ.getChanges();if(0==i.length)return;const r=[],s=i.filter((e=>"attribute"==e.type)),o=i.filter((e=>"insert"==e.type&&"$text"!=e.name));for(const t of s)this._isRegisteredAttribute(t.attributeKey)&&r.push({key:t.attributeKey,newValue:t.attributeNewValue,oldValue:t.attributeOldValue,range:extendRange(t.range,e.model)});for(const t of o){if("rename"!=t.action&&"refresh"!=t.action)continue;const n=createBlockFormatRangeForElement(t.position.nodeAfter,e.model),i=t.before;"rename"==t.action&&r.push({key:renameAttributeKey,newValue:t.name,oldValue:i.name,range:n});for(const[e,s]of i.attributes){if(!this._isRegisteredAttribute(e))continue;const i=t.attributes.get(e);s!==i&&r.push({key:e,newValue:i,oldValue:s,range:n})}for(const[e,s]of t.attributes)this._isRegisteredAttribute(e)&&(i.attributes.has(e)||r.push({key:e,newValue:s,oldValue:null,range:n}))}0!=r.length&&e.model.enqueueChange(n,(e=>{const t=uid();for(const{range:e,key:n,oldValue:i,newValue:s}of r)this.markAttributeChange(e,n,i,s,{groupId:t});this._reduceExistingSuggestions(e,r)}))}),{priority:"lowest"}),e.model.markers.on("update:suggestion",((e,t,n)=>{if(null==n){const{id:e}=this._splitMarkerName(t.name),n=this._suggestions.get(e);n&&n.addMarkerName(t.name)}})),e.model.document.on("change:data",(()=>{const t=Array.from(e.model.document.differ.getChangedMarkers()).filter((e=>"suggestion"===this._splitMarkerName(e.name).group));if(0===t.length)return;t.sort(((e,t)=>{const n=e.data.oldRange,i=t.data.oldRange;return null===n&&null===i?0:null===n&&null!==i?-1:null!==n&&null===i?1:n.start.isBefore(i.start)?-1:1}));const n=new Set,i=new Set;for(const{name:e,data:r}of t){const{id:t}=this._splitMarkerName(e);if(null===r.oldRange){const t=this._handleNewSuggestionMarker(e);i.add(t)}else{const e=this._suggestions.get(t);null!==r.newRange||e.isInContent?(n.add(e.head),i.add(e)):this._removeSuggestion(e)}}i.size>0&&this._refreshSuggestionsChain(i);for(const e of n)this.fire("suggestionChanged",e)})),e.model.on("applyOperation",((t,n)=>{const i=n[0];if(!this._suggestions.size)return;if(!i.isDocumentOperation)return;if(i.batch.isUndo||!i.batch.isLocal)return;let r,s;switch(i.type){case"insert":r=e.model.createPositionAt(i.position),s=r.getShiftedBy(i.howMany);break;case"split":r=e.model.createPositionAt(i.splitPosition),s=e.model.createPositionAt(i.moveTargetPosition);break;case"move":r=e.model.createPositionAt(i.targetPosition),s=r.getShiftedBy(i.howMany);break;default:return}const o=e.model.createRange(r,s);e.model.change((()=>{for(const{suggestion:e,meta:t}of this._findSuggestions(o)){if(e.isMultiRange)continue;if("formatInline"==e.type)continue;const n=this._getAttributeKey(e);if(n&&this._isBlockAttribute(n)&&"split"!=i.type)continue;const a=e.data&&e.data.multipleBlocks;("formatBlock"!=e.type||"split"==i.type&&!a)&&(t.containsRangeInObject||"insertion"==e.type&&t.isOwn||e.getFirstRange().containsRange(o)&&this._breakSuggestionMarker(e,r,s))}}))}),{priority:"lowest"}),e.model.on("deleteContent",((t,n)=>{const i=n[0],r=n[1];if(r&&r.forceDefaultExecution)return;if(this._isForcedDefaultExecutionBlock)return;if(!this.trackChangesCommand.value)return;if(i.isCollapsed)return;const s=e.model.schema,{start:o,end:a}=i.getFirstRange(),l=o.nodeAfter&&s.isLimit(o.nodeAfter)?null:s.getNearestSelectionRange(o,"forward"),c=a.nodeBefore&&s.isLimit(a.nodeBefore)?null:s.getNearestSelectionRange(a,"backward"),d=e.model.createRange(l?l.start:o,c?c.end:a);e.model.change((t=>{this.markDeletion(d);const n=e.model.schema.getNearestSelectionRange(d.start);i.is("documentSelection")?t.setSelection(n):i.setTo(n)})),t.stop()}),{priority:priorities.normal+10}),e.model.on("insertContent",((t,n)=>{const i=n[n.length-1];i&&i.forceDefaultExecution||this._isForcedDefaultExecutionBlock||this.trackChangesCommand.value&&(e.model.change((()=>{let i=e.model.insertContent(n[0],n[1],n[2],{forceDefaultExecution:!0});if(!i)return;t.return=i.clone();const r=i.end.nodeBefore,s=e.model.schema;r&&s.isBlock(r)&&!s.isObject(r)&&(i=e.model.createRange(i.start,e.model.createPositionAt(r,"end"))),this.markInsertion(i)})),t.stop())}),{priority:"high"}),this.editor.commands.add("trackChanges",this.trackChangesCommand),this.enableCommand("trackChanges");const i=new AcceptSuggestionCommand(e,this._suggestions);e.commands.add("acceptSuggestion",i),this.enableCommand("acceptSuggestion");const r=new DiscardSuggestionCommand(e,this._suggestions);e.commands.add("discardSuggestion",r),this.enableCommand("discardSuggestion"),e.commands.add("acceptAllSuggestions",new ExecuteOnAllSuggestionsCommand(e,i,this._suggestions)),this.enableCommand("acceptAllSuggestions"),e.commands.add("discardAllSuggestions",new ExecuteOnAllSuggestionsCommand(e,r,this._suggestions)),this.enableCommand("discardAllSuggestions"),e.commands.add("acceptSelectedSuggestions",new ExecuteOnSelectedSuggestionsCommand(e,i,this._suggestions)),this.enableCommand("acceptSelectedSuggestions"),e.commands.add("discardSelectedSuggestions",new ExecuteOnSelectedSuggestionsCommand(e,r,this._suggestions)),this.enableCommand("discardSelectedSuggestions");const s=e.plugins.get("CommentsRepository");this.listenTo(s,"addComment",((e,{threadId:t})=>{const n=this._suggestions.get(t);n&&n.commentThread&&1===n.commentThread.length&&this._updateSuggestionData(t,{hasComments:!0})}),{priority:"low"}),this.listenTo(s,"removeComment",((e,{threadId:t})=>{const n=this._suggestions.get(t);n&&n.commentThread&&!n.commentThread.length&&this._updateSuggestionData(t,{hasComments:!1})}),{priority:"low"})}afterInit(){checkLicense$1(this)}set adapter(e){if(this._adapter)throw new CKEditorError("track-changes-adapter-already-set",this);this._adapter=e}get adapter(){return this._adapter}getSuggestions({skipNotAttached:e=!1,toJSON:t=!1}={}){const n=[];for(const t of this._suggestions.values())e&&!t.isInContent||n.push(t);return t?n.map((e=>e.toJSON())):n}getSuggestion(e){const t=this._suggestions.get(e);if(!t)throw new CKEditorError("track-changes-suggestion-not-found",this);return t}hasSuggestion(e){return this._suggestions.has(e)}addSuggestionData(e){const{authorId:t,id:n,attributes:i}=e,[r,s]=e.type.split(":"),o=this._suggestions.get(n)||this._createSuggestion(r,s,n,t,i);if(this._addThreadToSuggestion(o),this._checkSuggestionCorrectness(o,r,s||null,t),o.createdAt=e.createdAt,o._isDataLoaded=!0,i&&i["@external"]){const e=i["@external"],t=this._getExternalAuthor(e.authorName);o.authoredAt=e.createdAt,o.author=t,o.isExternal=!0}else o.authoredAt=e.createdAt;switch(e.data&&(o.data=e.data),e.attributes&&(o.attributes=e.attributes),this._adapter&&this._adapter.addSuggestion||(o._saved=!0),this._suggestionState.get(o)){case"notReady":this._suggestionState.set(o,"dataReady");break;case"markerReady":o.isInContent?(this._joinWithAdjacentSuggestions(new Set([o])),this._refreshSuggestionsChain(new Set([o])),this._suggestionState.set(o,"ready"),this.fire("suggestionLoaded",o)):this._suggestionState.set(o,"removed")}return o}acceptSuggestion(e){this.forceDefaultExecution((()=>{this.editor.model.change((()=>{for(const t of e.getAllAdjacentSuggestions())t.accept()}))}))}discardSuggestion(e){this.forceDefaultExecution((()=>{this.editor.model.change((()=>{for(const t of e.getAllAdjacentSuggestions())t.discard()}))}))}enableCommand(e,t){const n=this.editor.commands.get(e);if(!n)throw new CKEditorError("track-changes-command-not-found",this,{commandName:e});if(this._enabledCommands.has(n))throw new CKEditorError("track-changes-enable-command-twice",this,{commandName:e});this._enabledCommands.add(n),t&&n.on("execute",((e,i)=>{this.trackChangesCommand.value&&(this._isForcedDefaultExecutionBlock||(i.length>0&&i[i.length-1]&&i[i.length-1].forceDefaultExecution?i.pop():(e.return=t(((...e)=>n.execute(...e,{forceDefaultExecution:!0})),...i),e.stop())))}),{priority:"high"})}forceDefaultExecution(e){let t,n;const i=this._isForcedDefaultExecutionBlock;this._isForcedDefaultExecutionBlock=!0;try{t=e()}catch(e){n=e}return i||(this._isForcedDefaultExecutionBlock=!1),n&&CKEditorError.rethrowUnexpectedError(n,this),t}markInsertion(e,t=null,n={}){if(e.isCollapsed)return null;const i=this.editor.plugins.get("Users").me;for(const{suggestion:i,meta:r}of this._findSuggestions(e,"insertion"))if(r.isOwn){if(!r.isNextTo){if(r.containsRangeInObject){if(!this._mergeNestedSuggestions||!_areSimilarAttributes(i,n))continue;return i}if(_areSimilarAttributes(i,n))return i;this._breakSuggestionMarker(i,e.start,e.end);break}if(t==i.subType&&_areSimilarAttributes(i,n)){const t=i.getFirstRange();return t.start.isEqual(e.end)?this._setSuggestionRange(i,this._model.createRange(e.start,t.end)):this._setSuggestionRange(i,this._model.createRange(t.start,e.end)),i}}const r=uid(),s=i.id,o=t?"insertion:"+t:"insertion",a=this._setSuggestionData({id:r,type:o,createdAt:new Date,authorId:s,attributes:n});return this._addSuggestionMarker(o,r,s,e),a}markMultiRangeInsertion(e,t="multi",n={}){const i=this.editor.plugins.get("Users").me,r=this._suggestionFactory.getSuggestionCallback("insertion",t,"join");for(const s of this.getSuggestions())if(s.author.id==i.id&&"insertion"==s.type&&s.subType==t&&_areSimilarAttributes(s,n)&&(r(s.getRanges(),e)||r(e,s.getRanges()))){for(const t of e)s.addRange(t);return s}for(const{suggestion:t,meta:i}of this._findSuggestions(e,"insertion")){if(!i.isOwn)continue;if(!this._mergeNestedSuggestions&&i.containsRangeInObject)continue;if(!_areSimilarAttributes(t,n))continue;let r=!0;for(const n of t.getRanges())for(const t of e)if(!n.containsRange(t)){r=!1;break}if(r)return t}const s=uid(),o=i.id,a="insertion:"+t,l=this._setSuggestionData({id:s,type:a,createdAt:new Date,authorId:o,attributes:n});for(const t of e)this._addSuggestionMarker(a,s,o,t,Suggestion.getMultiRangeId());return l}markInlineFormat(e,t,n=null,i={}){if(n=n||createFormatSubType(t),e.isCollapsed)return null;if("never"===this._trackFormatChanges){const r=this._suggestionFactory.getSuggestionCallback("formatInline",n,"accept");return this.forceDefaultExecution((()=>r([e],t,i))),null}const r=this.editor.plugins.get("Users").me,s=[];if("always"!==this._trackFormatChanges)for(const{suggestion:t,meta:n}of this._findSuggestions(e,"insertion"))n.isOwn&&!n.isInsideObject&&s.push(...t.getRanges());const o=getIntersectionsWithMultipleRanges(e,s),a=getDifferencesWithMultipleRanges(e,s);o.length&&this._model.change((()=>{for(const e of o){const r=this._suggestionFactory.getSuggestionCallback("formatInline",n,"accept");this.forceDefaultExecution((()=>r([e],t,i)))}}));for(const e of a){let s=null,o=e.start,a=e.end;for(const{suggestion:t,meta:r}of this._findSuggestions(e,"formatInline")){if(!r.isOwn)continue;if(t.subType!=n)continue;if(!_areSimilarAttributes(t,i))continue;const l=t.getFirstRange();if(l.containsRange(e,!0))return null;o=o.isBefore(l.start)?o:l.start,a=a.isAfter(l.end)?a:l.end,s?l.start.isBefore(s.getFirstRange().start)?(s.removeMarkers(),s=t):t.removeMarkers():s=t}const l=this._model.createRange(o,a);if(s)this._setSuggestionRange(s,l);else{const e=uid(),s=r.id;this._setSuggestionData({id:e,type:"formatInline:"+n,data:t,createdAt:new Date,authorId:s,attributes:i}),this._addSuggestionMarker("formatInline:"+n,e,s,l)}}return null}markBlockFormat(e,t,n=[],i=null,r={}){t.formatGroupId||(t.formatGroupId=t.commandName),t.multipleBlocks=e.is("range"),i=i||createFormatSubType(t);const s=n.map((e=>createBlockFormatRangeForElement(e,this._model))),o=e.is("range")?e:createBlockFormatRangeForElement(e,this._model);if("never"===this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e([o],t,r))),null}s.push(o);let a=!0;for(const e of s)if(!this._rangeIsInLocalUserInsertion(e)){a=!1;break}if(a&&"always"!==this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e([o],t,r))),null}let l=null,c=o.start,d=o.end;for(const{suggestion:e,meta:n}of this._findSuggestions(o,"formatBlock")){if(!n.isOwn)continue;if(n.isNextTo||n.containsRangeInObject||n.isInsideObject)continue;if(e.data.formatGroupId!=t.formatGroupId)continue;if(!_areSimilarAttributes(e,r))continue;const s=e.getFirstRange();if(e.subType==i){if(s.containsRange(o,!0))return null;c=c.isBefore(s.start)?c:s.start,d=d.isAfter(s.end)?d:s.end,l?s.start.isBefore(l.getFirstRange().start)?(l.removeMarkers(),l=e):e.removeMarkers():l=e}else{const t=o.getIntersection(s);this._cutOutSuggestionMarker(e,t)}}const u=this.editor.plugins.get("Users").me,h=uid(),m=u.id;if(l)return this._setSuggestionRange(l,this._model.createRange(c,d)),l;{const e=this._setSuggestionData({id:h,type:"formatBlock:"+i,data:t,createdAt:new Date,authorId:m,attributes:r});return this._addSuggestionMarker("formatBlock:"+i,h,m,this._model.createRange(c,d)),e}}markMultiRangeBlockFormat(e,t,n=[],i=null,r={}){t.formatGroupId||(t.formatGroupId=t.commandName);const s=e[0];t.multipleBlocks=s.is("range"),i=i||createFormatSubType(t);const o=n.map((e=>createBlockFormatRangeForElement(e,this._model))),a=s.is("range")?e:e.map((e=>createBlockFormatRangeForElement(e,this._model)));if("never"===this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e(a,t,r))),null}o.push(...a);let l=!0;for(const e of o)if(!this._rangeIsInLocalUserInsertion(e)){l=!1;break}if(l&&"always"!==this._trackFormatChanges){const e=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"accept");return this.forceDefaultExecution((()=>e(a,t,r))),null}const c=this.editor.plugins.get("Users").me;for(const e of this.getSuggestions()){if(e.author.id!=c.id)continue;if("formatBlock"!=e.type||e.data.formatGroupId!=t.formatGroupId)continue;if(!_areSimilarAttributes(e,r))continue;const n=e.subType==i;for(let t=0;t<a.length;t++){const i=a[t];for(const r of e.getMarkers()){const s=r.getRange();if(i.isEqual(s)){n?(a.splice(t,1),t--):e.removeMarker(r.name);break}}}}if(0==a.length)return null;const d=this._suggestionFactory.getSuggestionCallback("formatBlock",i,"join");for(const e of this.getSuggestions())if(e.author.id==c.id&&"formatBlock"==e.type&&e.data.formatGroupId==t.formatGroupId&&e.subType==i&&_areSimilarAttributes(e,r)&&(d(e.getRanges(),a)||d(a,e.getRanges()))){for(const t of a)e.addRange(t);return e}const u=uid(),h=c.id,m="formatBlock:"+i,g=this._setSuggestionData({id:u,type:m,data:t,createdAt:new Date,authorId:h,attributes:r});for(const e of a)this._addSuggestionMarker(m,u,h,e,Suggestion.getMultiRangeId());return g}markDeletion(e,t=null,n={}){if(e.isCollapsed)return null;const i=this.editor.plugins.get("Users").me,r=new LiveRange(e.start,e.end);for(const{suggestion:e,meta:i}of this._findSuggestions(r,"insertion"))if(i.isOwn&&!i.isNextTo)if(e.isMultiRange){const i=e.getRanges().filter((e=>"$graveyard"!=e.root.rootName));if(i.every((e=>r.containsRange(e,!0)))&&e.discard(),i.some((e=>e.containsRange(r,!0)))){const e=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>e([r],null,n))),null}}else{const t=r.getIntersection(e.getFirstRange());null!==t&&e._onDiscard([t],null,n)}if(r.detach(),r.isCollapsed||"$graveyard"==r.root.rootName)return null;let s=null,o=r.start,a=r.end;const l=this._findSuggestions(r,"deletion");for(const{suggestion:e,meta:t}of l){const i=this._model.createRange(o,a);if(t.isOwn&&(this._mergeNestedSuggestions||!t.containsRangeInObject&&!t.isInsideObject))if(e.isMultiRange){if(!_areSimilarAttributes(e,n))continue;let t=!0;for(const n of e.getRanges()){if(n.containsRange(i,!0))return e;i.containsRange(n)||(t=!1)}t&&e.discard()}else{const t=e.getFirstRange();if(t.containsRange(i,!0))return e;if(!_areSimilarAttributes(e,n)){i.containsRange(t)?e.removeMarkers():t.containsPosition(o)?o=t.end:t.containsPosition(a)&&(a=t.start);continue}o=o.isBefore(t.start)?o:t.start,a=a.isAfter(t.end)?a:t.end,n=Object.assign({},e.attributes),s?t.start.isBefore(s.getFirstRange().start)?(s.removeMarkers(),s=e):e.removeMarkers():s=e}}if(s)return this._setSuggestionRange(s,this._model.createRange(o,a)),s;{const e=uid(),r=this._model.createRange(o,a),s=i.id,l=t?"deletion:"+t:"deletion",c=this._setSuggestionData({id:e,type:l,createdAt:new Date,authorId:s,attributes:n});return this._addSuggestionMarker(l,e,s,r),c}}markMultiRangeDeletion(e,t="multi",n={}){const i=this.editor.plugins.get("Users").me,r=e.map((e=>new LiveRange(e.start,e.end))),s=new Set;for(const{suggestion:e,meta:t}of this._findSuggestions(r,"insertion"))t.isOwn&&!t.isNextTo&&s.add(e);for(const i of s)if(i.isMultiRange){const s=i.getRanges();if((!i.attributes||!i.attributes.skipNestingCheck)&&s.every((e=>r.some((t=>t.containsRange(e,!0)))))&&i.discard(),r.every((e=>s.some((t=>t.containsRange(e,!0)))))){const i=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>i(e,null,n))),null}}else{const e=i.getFirstRange();if(r.some((t=>t.containsRange(e,!0)))&&i.discard(),r.every((t=>e.containsRange(t,!0)))){const e=this._suggestionFactory.getSuggestionCallback("deletion",t,"accept");return this.forceDefaultExecution((()=>e(r,null,n))),null}}const o=this._suggestionFactory.getSuggestionCallback("deletion",t,"join");let a=null;for(const e of this.getSuggestions())if(e.author.id==i.id&&e.isInContent&&"deletion"==e.type&&e.subType==t&&_areSimilarAttributes(e,n)&&(o(e.getRanges(),r)||o(r,e.getRanges())))if(a){if(e.commentThread&&e.commentThread.length)continue;for(const t of e.getRanges())a.isIntersectingWithRange(t)||a.addRange(t);e.removeMarkers()}else{a=e;for(const t of r)e.isIntersectingWithRange(t)||e.addRange(t)}if(a)return a;s.clear();for(const{suggestion:e,meta:t}of this._findSuggestions(r,"deletion"))t.isOwn&&(this._mergeNestedSuggestions||!t.containsRangeInObject&&!t.isInsideObject)&&_areSimilarAttributes(e,n)&&s.add(e);for(const e of s){const t=e.getRanges();if((!n||!n.skipNestingCheck)&&r.every((e=>t.some((t=>t.containsRange(e,!0))))))return e;(!e.attributes||!e.attributes.skipNestingCheck)&&t.every((e=>r.some((t=>t.containsRange(e,!0)))))&&e.discard()}const l=uid(),c=i.id,d="deletion:"+t,u=this._setSuggestionData({id:l,type:d,createdAt:new Date,authorId:c,attributes:n});for(const e of r)e.detach(),e.isCollapsed||"$graveyard"==e.root.rootName||this._addSuggestionMarker(d,l,c,e,Suggestion.getMultiRangeId());return u}markAttributeChange(e,t,n,i,r){if(e.isCollapsed)return[];if("never"===this._trackFormatChanges)return[];const s=this.editor.plugins.get("Users").me.id,o=Array.from(this._suggestions.values()).filter((n=>"attribute"==n.type&&n.data.key==t&&n.isIntersectingWithRange(e)));if("default"===this._trackFormatChanges){const t=this._findSuggestions(e,"insertion").filter((({meta:e})=>e.isOwn&&!e.isInsideObject&&!e.isNextTo)).map((({suggestion:e})=>e));o.unshift(...t)}const a=new Map([[e,n]]);for(const e of o){const r="attribute"==e.type?e.data.oldValue:void 0,s=e.getFirstRange(),o=Array.from(a.keys()).find((e=>e.isIntersecting(s)));if(!o)continue;const l=o.getDifference(s);this._isBlockAttribute(t)&&"insertion"==e.type&&0!=l.length||(a.delete(o),l.forEach((e=>{a.set(e,n)})),"insertion"!=e.type&&r!=i&&a.set(o.getIntersection(s),r))}const l=[];for(const[e,n]of a){const o=uid(),a={key:t,oldValue:n,newValue:i};t.length>37&&console.warn("Creating a suggestion for attribute with too long attribute key. This may lead to errors. Change the attribute key to a value shorter than 37 characters.",{key:t});const c=("attribute:"+t+"|"+createFormatSubType({newValue:i})).substring(0,60),d=this._setSuggestionData({id:o,type:c,data:a,createdAt:new Date,authorId:s,attributes:r});l.push(d),this._addSuggestionMarker(c,o,s,e)}return l}enableDefaultAttributesIntegration(e){this.enableCommand(e,((e,...t)=>{this._recordAttributeChanges((()=>{e(...t)}))}))}registerBlockAttribute(e){this._blockAttributeKeys.add(e)}registerInlineAttribute(e){this._inlineAttributeKeys.add(e)}_getAttributeKey(e){return"attribute"==e.type?_getAttributeKeyFromSubType(e.subType):null}_setSuggestionRange(e,t){const n=e.getFirstMarker();this._model.change((e=>{e.updateMarker(n,{range:t})}))}_addThreadToSuggestion(e){const t=e.id,n=this.editor.config.get("collaboration.channelId");this._commentsRepository.hasCommentThread(t)||this._commentsRepository.addCommentThread({channelId:n,threadId:t,isResolvable:!1,isSubmitted:!0});const i=this._commentsRepository.getCommentThread(t);i.unbind("isRemovable"),i.isRemovable=!1,e.commentThread=i}_checkSuggestionCorrectness(e,t,n,i){if(e.type!=t||e.subType!=n||e.creator.id!=i)throw this.editor.enableReadOnlyMode("track-changes-suggestion-data-mismatch"),new CKEditorError("track-changes-suggestion-data-mismatch",this)}_cutOutSuggestionMarker(e,t){const n=e.getFirstRange();if(t.isEqual(n))e.removeMarkers();else if(n.containsRange(t)){const i=this._model.createPositionAt(t.start.nodeBefore,"end");this._setSuggestionRange(e,this._model.createRange(n.start,i));const r=uid(),s=e.creator.id,o=e.type+":"+e.subType;this._setSuggestionData({id:r,type:o,createdAt:new Date,authorId:s,data:e.data,attributes:e.attributes});const a=this._model.createPositionAt(t.end.parent,"after"),l=this._model.createRange(a,n.end);this._addSuggestionMarker(o,r,s,l)}else if(n.containsPosition(t.start)){const i=this._model.createPositionAt(t.start.nodeBefore,"end");this._setSuggestionRange(e,this._model.createRange(n.start,i))}else{const i=this._model.createPositionAt(t.end.parent,"after");this._setSuggestionRange(e,this._model.createRange(i,n.end))}}_rangeIsInLocalUserInsertion(e){for(const{suggestion:t,meta:n}of this._findSuggestions(e,"insertion")){if(!n.isOwn)continue;const i=t.getRanges();for(const t of i)if(!e.getDifference(t).length)return!0}return!1}_getAuthorFromId(e){const t=this.editor.plugins.get("Users").getUser(e);if(!t)throw new CKEditorError("track-changes-user-not-found",this);return t}_getExternalAuthor(e){const t=this.editor.plugins.get("Users"),n=hashObject("external:"+e);return t.getUser(n)||t.addUser({id:n,name:e})}_createSuggestion(e,t,n,i,r){const s=this._getAuthorFromId(i),o=this._suggestionFactory.buildSuggestion(e,t,n,s,r,(e=>{this._updateSuggestionData(n,{attributes:e});const t=this.getSuggestion(n);this._joinWithAdjacentSuggestions(new Set([t])),this._refreshSuggestionsChain(new Set([t]))}));return this.listenTo(o,"accept",(()=>{this._updateSuggestionData(n,{state:"accepted"})}),{priority:"high"}),this.listenTo(o,"discard",(()=>{this._updateSuggestionData(n,{state:"rejected"})}),{priority:"high"}),this._suggestions.set(n,o),this._suggestionState.set(o,"notReady"),o}_splitMarkerName(e){const t=e.split(":");return{group:t[0],type:t[1],subType:t.length>=5?t[2]:null,id:t.length<5?t[2]:t[3],authorId:t.length<5?t[3]:t[4],markerCount:6==t.length?t[5]:null}}_breakSuggestionMarker(e,t,n){const i=e.getFirstRange(),r=i.start,s=i.end;this._setSuggestionRange(e,this._model.createRange(r,t));const o=uid(),a=e.creator.id,l=e.type+(e.subType?":"+e.subType:"");this._setSuggestionData({id:o,type:l,createdAt:new Date,authorId:a,originalSuggestionId:e.id,attributes:e.attributes,data:e.data});const c=this._getAttributeKey(e);("formatBlock"==e.type||c&&this._isBlockAttribute(c))&&(n=this._model.createPositionBefore(n.parent)),this._addSuggestionMarker(l,o,a,this._model.createRange(n,s))}_findSuggestions(e,t=null){const n=[],i=this.editor.plugins.get("Users").me;Array.isArray(e)||(e=[e]);for(const r of this.getSuggestions()){if(!r.isInContent)continue;if(t&&r.type!=t)continue;let s=!1;for(const t of r.getRanges()){for(const o of e){const e=o.start.isEqual(t.end)||o.end.isEqual(t.start);if(e||o.getIntersection(t)){const a=o.containsRange(t)&&_isInObject(this._model.schema,t.start,o),l=t.containsRange(o)&&_isInObject(this._model.schema,o.start,t);n.push({suggestion:r,meta:{isOwn:i==r.author,isNextTo:e,isInsideObject:a,containsRangeInObject:l}}),s=!0;break}}if(s)break}}return n}_addSuggestionMarker(e,t,n,i,r){this._model.change((s=>{let o="suggestion:"+e+":"+t+":"+n;r&&(o=o+":"+r),s.addMarker(o,{range:i,usingOperation:!0,affectsData:!0})}))}_removeSuggestion(e){const t=e.previous,n=e.next;e.previous=null,e.next=null,null!=t&&t.next==e&&(t.next=n),null!=n&&n.previous==e&&(n.previous=t),"ready"==this._suggestionState.get(e)&&(this._suggestionState.set(e,"removed"),this.fire("suggestionUnloaded",e,t,n))}_setSuggestionData(e){const t=e.id,n=this.addSuggestionData(e);if(this._adapter&&this._adapter.addSuggestion){const i=this.editor.plugins.get("PendingActions"),r=n.hasComments,s=n.subType?n.type+":"+n.subType:n.type,o=this.editor.locale,a=i.add(getTranslation$1(o,"PENDING_ACTION_SUGGESTION")),l={id:t,type:s,hasComments:r,data:e.data||null,originalSuggestionId:e.originalSuggestionId||null,attributes:n.attributes};this._adapter.addSuggestion(l).then((e=>{n._saved=!0,i.remove(a),e&&e.createdAt&&(this._suggestions.get(t).createdAt=e.createdAt)})).catch((e=>{throw logWarning("error-saving-suggestion-data-suggestion-discarded"),this.editor.model.enqueueChange({isUndoable:!1},(()=>{n.discard()})),n.stopListening(),this._suggestions.delete(n.id),this._suggestionState.delete(n),e}))}return n}_isBlockAttribute(e){return this._blockAttributeKeys.has(e)}_updateSuggestionData(e,t){const n=this.editor.plugins.get("PendingActions"),i=this.getSuggestion(e);if(this._adapter&&this._adapter.updateSuggestion)if(i._saved){const i=n.add(getTranslation$1(this.editor.locale,"PENDING_ACTION_SUGGESTION"));this._adapter.updateSuggestion(e,t).then((()=>{n.remove(i)}))}else i.on("change:_saved",(()=>{this._updateSuggestionData(e,t)}))}_getSuggestionData(e){if(!this._adapter||!this._adapter.getSuggestion)throw new CKEditorError("track-changes-adapter-missing-getsuggestion",this);return this._adapter.getSuggestion(e)}_handleNewSuggestionMarker(e){const{id:t,type:n,subType:i,authorId:r}=this._splitMarkerName(e),s=this._suggestions.get(t)||this._createSuggestion(n,i,t,r,{});switch(this._checkSuggestionCorrectness(s,n,i,r),this._suggestionState.get(s)){case"notReady":this._getSuggestionData(t).then((e=>{let n=Promise.resolve();e.hasComments&&(n=this._commentsRepository.fetchCommentThread({channelId:this.editor.config.get("collaboration.channelId"),threadId:t})),n.then((()=>{this.addSuggestionData(e)._saved=!0}))})),this._suggestionState.set(s,"markerReady");break;case"removed":this._updateSuggestionData(t,{state:"open"});case"dataReady":this._suggestionState.set(s,"ready"),this.fire("suggestionLoaded",s);break;case"ready":this.fire("suggestionChanged",s)}return s.addMarkerName(e),s}_refreshSuggestionsChain(e){const t=Array.from(e),n=t.filter((e=>"attribute"==e.type));this._refreshAttributeSuggestionsChain(n);const i=t.filter((e=>!e.isMultiRange&&"attribute"!=e.type)),r=this.getSuggestions({skipNotAttached:!0}).filter((e=>!e.isMultiRange&&"attribute"!=e.type)),s=r.filter((t=>!e.has(t))),o=new Map(r.map((e=>[e,this._suggestionFactory.getSuggestionCallback(e.type,e.subType,"chain")]))),a=new Map(r.map((e=>[e,e.getFirstRange()]))),l=new Set,c=new Set;for(let e=0;e<i.length;e++)u(i[e],i,e+1);for(let e=0;e<i.length;e++)u(i[e],s,0);const d=new Set;for(let e=0;e<i.length;e++){const t=i[e];!c.has(t)&&t.previous&&(d.add(t.previous),t.previous.next===t&&(t.previous.next=null),t.previous=null),!l.has(t)&&t.next&&(d.add(t.next),t.next.previous===t&&(t.next.previous=null),t.next=null)}function u(e,t,n){for(let i=n;i<t.length;i++){const n=h(e,t[i]);n&&(n[0].next=n[1],n[1].previous=n[0],l.add(n[0]),c.add(n[1]))}}function h(e,t){if(e.author.id!==t.author.id)return null;const n=o.get(e)(e,t,a.get(e),a.get(t));return n&&o.get(t)(e,t,a.get(e),a.get(t))?n[1].commentThread&&n[1].commentThread.length?null:n:null}d.size&&this._refreshSuggestionsChain(d)}_refreshAttributeSuggestionsChain(e){if(0==e.length)return;const t=this.getSuggestions({skipNotAttached:!0}).filter((e=>"attribute"==e.type&&e._isDataLoaded)),n=[],i=new Map;for(const e of t){const t=hashObject(e.attributes);i.has(t)||(i.set(t,n.length),n.push([]));const r=i.get(t);n[r].push(e)}!function(){n.sort(((e,t)=>{const n=e[0].createdAt,i=t[0].createdAt;return n==i?e[0].attributes.groupId<t[0].attributes.groupId?-1:1:n<i?-1:1}));for(const e of n)e.sort(((e,t)=>e.id<t.id?-1:1))}();for(let e=0;e<n.length;e++){if(0==n[e].length)continue;const t=[];for(let i=e+1;i<n.length;i++)0!=n[i].length&&r(n[e],n[i])&&t.push(i);for(const i of t)n[e]=n[e].concat(n[i]),n[i]=[]}for(const e of n)for(let t=0;t<e.length;t++){const n=e[t+1]||null;e[t].next!==n&&(e[t].next=n)}for(const e of n)for(let t=0;t<e.length;t++){const n=e[t-1]||null;e[t].previous!==n&&(e[t].previous=n)}function r(e,t){return(e[0].attributes.groupId===t[0].attributes.groupId||e[0].author===t[0].author)&&(n=e[0],i=t[0],(!n.hasComments&&!i.hasComments||!(n.hasComments&&i.hasComments||!(n.hasComments&&i.createdAt<n.commentThread.comments.get(0).createdAt||i.hasComments&&n.createdAt<i.commentThread.comments.get(0).createdAt)))&&(!!isEqual(omit(e[0].attributes,"groupId"),omit(t[0].attributes,"groupId"))&&(!!e.every((e=>t.some((t=>e.getFirstRange().isEqual(t.getFirstRange())))))&&t.every((t=>e.some((e=>t.getFirstRange().isEqual(e.getFirstRange()))))))));var n,i}}_joinWithAdjacentSuggestions(e){const t=Array.from(e),n=this.getSuggestions({skipNotAttached:!0}),i=n.filter((t=>!e.has(t))),r=new Map(t.map((e=>[e,this._suggestionFactory.getSuggestionCallback(e.type,e.subType,"join")]))),s=new Map(n.map((e=>[e,e.getRanges()])));for(let e=0;e<t.length;e++)if(o(this,t[e],t,e+1))return!0;for(let e=0;e<t.length;e++)if(o(this,t[e],i,0))return!0;return!1;function o(e,t,n,i){for(let o=i;o<n.length;o++){const i=n[o];if(i.type!==t.type||i.author.id!==t.author.id||i.subType!==t.subType)continue;if(!_haveSameAttributes(t,i))continue;if("attribute"==t.type&&t.data.oldValue!=i.data.oldValue)continue;if("attribute"==t.type&&e._isBlockAttribute(t.data.key))continue;if("formatBlock"==t.type){const n=e.editor.model,i=t.getContainedElement();if(i&&(n.schema.isObject(i)||n.schema.isLimit(i)))continue}const a=r.get(t),l=s.get(t),c=s.get(i),d=t.commentThread&&t.commentThread.length,u=i.commentThread&&i.commentThread.length;if(!d&&a(c,l))return e._joinSuggestions(i,t),s.delete(t),!0;if(!u&&a(l,c))return e._joinSuggestions(t,i),s.delete(i),!0}return!1}}_joinSuggestions(e,t){if(e.isMultiRange)for(const n of t.getRanges())e.addRange(n);else{const n=t.getFirstRange().end;this._setSuggestionRange(e,this._model.createRange(e.getFirstRange().start,n))}t.removeMarkers()}_getMarkerAnnouncementText(e,t,n){const i=e.startsWith("format")||e.startsWith("attribute")?"FORMATTING":e.toUpperCase();return getTranslation$1(this.editor.locale,t+"_"+i+"_SUGGESTION_ANNOUNCEMENT",n)}_initAriaMarkerChangeAnnouncements(){const e=this.editor;if(!e.ui)return;const{ariaLiveAnnouncer:t}=e.ui;surroundingMarkersDetector(this._model,(({left:e,entered:n})=>{for(const n of e){const{group:e,type:i}=this._splitMarkerName(n.name);if("suggestion"===e){t.announce(this._getMarkerAnnouncementText(i,"LEAVE"));break}}for(const e of n){const{group:n,type:i}=this._splitMarkerName(e.name);if("suggestion"===n){t.announce(this._getMarkerAnnouncementText(i,"ENTER",getEnvKeystrokeText(FOCUS_ANNOTATION_KEYSTROKE)));break}}}))}_processAttributeChanges(e){if(this._recordAttributeSuggestions)return!1;const t=this.editor,n=t.model.document.differ.getChanges();if(0==n.length)return!1;const i=[],r=n.filter((e=>"attribute"==e.type)),s=n.filter((e=>"insert"==e.type&&"$text"!=e.name)),o=n.filter((e=>"remove"==e.type&&"$text"!=e.name));for(const e of r)i.push({key:e.attributeKey,newValue:e.attributeNewValue,oldValue:e.attributeOldValue,range:extendRange(e.range,t.model)});for(const e of s){const n=o.find((t=>t.position.isEqual(e.position)));n&&i.push({key:renameAttributeKey,newValue:e.name,oldValue:n.name,range:t.model.createRangeOn(e.position.nodeAfter)})}return 0!=i.length&&this._reduceExistingSuggestions(e,i)}_processAttributeSuggestions(e){let t=!1;const n=this.editor.model.document.differ.getChangedMarkers().filter((e=>e.data.newRange&&e.name.startsWith("suggestion:attribute:")));for(const i of n){const{subType:n,id:r}=this._splitMarkerName(i.name),s=n.split("|")[0];for(const n of this.getSuggestions({skipNotAttached:!0}))n.id!=r&&"attribute"==n.type&&n.data&&n.data.key==s&&n.getFirstRange().isIntersecting(i.data.newRange)&&(this._reduceSuggestionAttributeRange(n,i.data.newRange,e),t=!0)}return t}_recordAttributeChanges(e){this._recordAttributeSuggestions=!0,e()}_isRegisteredAttribute(e){const t=this._isBlockAttribute(e),n=this._inlineAttributeKeys.has(e);return t||n}_reduceExistingSuggestions(e,t){if(0==t.length)return!1;let n=!1;for(const i of t){const t=this._findSuggestions(i.range,"attribute").filter((e=>!e.meta.isNextTo)).map((e=>e.suggestion)),r=hashObject({newValue:i.newValue});t.filter((e=>{const[t,n]=e.subType.split("|");return t==i.key&&n!=r})).forEach((t=>{this._reduceSuggestionAttributeRange(t,i.range,e),n=!0}))}return n}_reduceSuggestionAttributeRange(e,t,n){const i=e.getFirstRange().getDifference(t);0!==i.length?1!==i.length?this._breakSuggestionMarker(e,t.start,t.end):this._setSuggestionRange(e,i[0]):n.removeMarker(e.getFirstMarker())}}class SuggestionFactory{constructor(e){this._editor=e,this._model=e.model,this._customCallbacks=new Map,this._defaultCallbacks=new Map,this._registerDefaultCallbacks()}buildSuggestion(e,t,n,i,r,s){return new Suggestion(this._model,{type:e,subType:t,id:n,author:i,creator:i,attributes:r,onAttributesChange:s,onAccept:(...n)=>this.getSuggestionCallback(e,t,"accept")(...n),onDiscard:(...n)=>this.getSuggestionCallback(e,t,"discard")(...n)})}registerCustomCallback(e,t,n,i){const r=e+":"+t+":"+n;this._customCallbacks.set(r,i)}getSuggestionCallback(e,t,n){const i=e+":"+t+":"+n;return this._customCallbacks.get(i)||this._defaultCallbacks.get(e+":"+n)}_registerDefaultCallbacks(){const e=()=>!1,t=e=>{e.sort(((e,t)=>e.start.isBefore(t.start)?1:-1)),this._model.change((t=>{for(const n of e){let e;e=n.end.isAtEnd&&n.end.parent==n.start.nodeAfter?t.createSelection(n.start.nodeAfter,"on"):t.createSelection(n),this._model.deleteContent(e,{forceDefaultExecution:!0,doNotAutoparagraph:!0})}}))},n=(e,t)=>{t&&this._model.change((n=>{const{commandName:i,commandParams:r=[]}=t,s=e.map((e=>(rangeOnOpeningTag(e)&&(e=this._model.createRange(e.end)),e))).filter((e=>"$graveyard"!==e.root.rootName));if(s.length<1)return;const o=Array.from(this._model.document.selection.getRanges()).map((e=>LiveRange.fromRange(e)));n.setSelection(s);for(const e of this._editor.commands.commands())e.refresh();r.push({forceDefaultExecution:!0}),this._editor.execute(i,...r);const a=o.filter((e=>"$graveyard"!=e.root.rootName));a.length>0&&n.setSelection(a);for(const e of o)e.detach()}))},i=(e,t)=>1==e.length&&1==t.length&&e[0].end.isEqual(t[0].start),r=(e,t,n,i)=>canChainSuggestions(e,t,n,i)?[e,t]:canChainSuggestions(t,e,i,n)?[t,e]:null;this._defaultCallbacks.set("insertion:accept",e),this._defaultCallbacks.set("insertion:discard",t),this._defaultCallbacks.set("insertion:join",i),this._defaultCallbacks.set("insertion:chain",r),this._defaultCallbacks.set("deletion:accept",t),this._defaultCallbacks.set("deletion:discard",e),this._defaultCallbacks.set("deletion:join",i),this._defaultCallbacks.set("deletion:chain",r),this._defaultCallbacks.set("formatInline:accept",n),this._defaultCallbacks.set("formatInline:discard",e),this._defaultCallbacks.set("formatInline:join",i),this._defaultCallbacks.set("formatInline:chain",e),this._defaultCallbacks.set("formatBlock:accept",n),this._defaultCallbacks.set("formatBlock:discard",e),this._defaultCallbacks.set("formatBlock:join",i),this._defaultCallbacks.set("formatBlock:chain",e),this._defaultCallbacks.set("attribute:accept",e),this._defaultCallbacks.set("attribute:discard",((e,t)=>{if(!t)return;const n=this._editor.plugins.get(TrackChangesEditing);this._model.change((i=>{if(t.key==renameAttributeKey)for(const n of e){const e=n.start.nodeAfter,r=t.oldValue;i.rename(e,r)}else if(n._isBlockAttribute(t.key))for(const n of e)void 0!==t.oldValue?i.setAttribute(t.key,t.oldValue,n.start.nodeAfter):i.removeAttribute(t.key,n.start.nodeAfter);else for(const n of e)t.oldValue?i.setAttribute(t.key,t.oldValue,n):i.removeAttribute(t.key,n)}))})),this._defaultCallbacks.set("attribute:join",i)}}function getIntersectionsWithMultipleRanges(e,t){const n=[];for(const i of t){const t=e.getIntersection(i);t&&n.push(t)}return n}function getDifferencesWithMultipleRanges(e,t){const n=[e];for(const e of t){let t=0;for(;t<n.length;){const i=n[t].getDifference(e);n.splice(t,1,...i),t+=i.length}}return n}function _isInObject(e,t,n){for(const i of t.parent.getAncestors({includeSelf:!0,parentFirst:!0})){if(i.root==i)return!1;if(!n.containsItem(i))return!1;if(e.isObject(i)||e.isLimit(i))return!0}return!1}function rangeOnOpeningTag(e){return e.end.parent==e.start.nodeAfter&&e.end.isAtStart}function rangeOnClosingTag(e){return e.start.parent==e.end.nodeBefore&&e.start.isAtEnd}function trimFormatInlineSuggestionRange(e,t,n,i){const r=e=>!e.item.is("$textProxy")&&!i.isObject(e.item),s=e.start.getLastMatchingPosition(r),o=e.end.getLastMatchingPosition(r,{direction:"backward"});return!(e.start.isEqual(s)&&e.end.isEqual(o)||(s.isBefore(o)?n.updateMarker(t,{range:n.createRange(s,o)}):n.removeMarker(t),0))}function createFormatSubType(e){return hashObject(e)}function isCorrectFormatBlockSuggestionRange(e){const t=e.start.nodeAfter;return t&&t.is("element")}function isCorrectDeletionSuggestionRange(e){return!rangeOnOpeningTag(e)&&!rangeOnClosingTag(e)}function extendRange(e,t){return null==e.end.nodeBefore&&e.end.parent==e.start.nodeAfter?createBlockFormatRangeForElement(e.start.nodeAfter,t):e}function createBlockFormatRangeForElement(e,t){const n=t.schema.isObject(e)||t.schema.isSelectable(e);return t.createRange(t.createPositionAt(e,"before"),n?t.createPositionAfter(e):t.createPositionAt(e,"end"))}function canChainSuggestions(e,t,n,i){return!!_haveSameAttributes(e,t)&&n.end.isEqual(i.start)}function _haveSameAttributes(e,t){if(!e._isDataLoaded||!t._isDataLoaded)return!1;const n=new Set(Object.keys(e.attributes)),i=new Set(Object.keys(t.attributes));if(n.delete("groupId"),i.delete("groupId"),0==n.size&&0==i.size)return!0;if(n.size!=i.size)return!1;const r={...e.attributes},s={...t.attributes};return delete r.groupId,delete s.groupId,JSON.stringify(r)==JSON.stringify(s)}function _areSimilarAttributes(e,t){const n=_cleanUpAttributes(e.attributes),i=_cleanUpAttributes(t);if(!e._isDataLoaded)return!1;for(const e of Object.keys(i))if(!isEqual(n[e],i[e]))return!1;return!0}function _cleanUpAttributes(e){const t=Object.assign({},e);return delete t.skipNestingCheck,delete t.tablePasteChainId,t}function _getAttributeKeyFromSubType(e){return e.split("|")[0]}async function checkLicense$1(e){const t=p([71,77,121,73,48,74,120,116,84,52,65,69,114,67,99,54,76,118,97,68,113,50,103,66,105,86,111,80,112,101,57,78,88,72,49,102,109,115,106,117,53,81,122,51,104,98,89,108,119,107,82,90,100,110,56,55,87,79,83,70,85,75]),n=window[p([68,97,116,101])][p([110,111,119])](),i=e[p([101,100,105,116,111,114])],r=new(window[p([80,114,111,109,105,115,101])])((e=>{i[p([111,110,99,101])](p([114,101,97,100,121]),e)})),s={[p([107,116,121])]:p([69,67]),[p([117,115,101])]:p([115,105,103]),[p([99,114,118])]:p([80,45,50,53,54]),[p([120])]:p([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[p([121])]:p([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[p([97,108,103])]:p([69,83,50,53,54])},o=i[p([99,111,110,102,105,103])][p([103,101,116])](p([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[p([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[p([116,104,101,110])]((()=>new(window[p([80,114,111,109,105,115,101])])((e=>{let t=0;i[p([109,111,100,101,108])][p([111,110])](p([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][p([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[p([111,102,102])]())}))}))))];return window[p([80,114,111,109,105,115,101])][p([114,97,99,101])](t)[p([116,104,101,110])]((()=>e))}function l(e){return e[p([115,116,97,114,116,115,87,105,116,104])](p([101,121]))?JSON[p([112,97,114,115,101])](c(e)):null}function c(e){return window[p([97,116,111,98])](e[p([114,101,112,108,97,99,101])](/-/g,p([43]))[p([114,101,112,108,97,99,101])](/_/g,p([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[p([108,101,110,103,116,104])];n++){const i=e[p([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[p([105,115,65,114,114,97,121])](t)?t[p([102,111,114,69,97,99,104])](e):t&&typeof t==p([111,98,106,101,99,116])?Object[p([101,110,116,114,105,101,115])](t)[p([115,111,114,116])]()[p([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[p([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[p([116,111,83,116,114,105,110,103])](16)[p([112,97,100,83,116,97,114,116])](8,p([48]))}function h(e){return e[p([115,112,108,105,116])]("")[p([114,101,118,101,114,115,101])]()[p([106,111,105,110])]("")}function m(e){return i[p([112,108,117,103,105,110,115])][p([104,97,115])](e)}function g(){}function p(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[p([83,116,114,105,110,103])](window[p([112,101,114,102,111,114,109,97,110,99,101])][p([110,111,119])]())[p([114,101,112,108,97,99,101])](p([46]),"");let n=p([71]);for(let i=0;i<e[p([108,101,110,103,116,104])];i+=2){let r=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[p([108,101,110,103,116,104])]&&(r-=t[p([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=p([116,114,97,99,107,67,104,97,110,103,101,115,76,105,99,101,110,115,101,75,101,121])+e,e!=p([86,97,108,105,100])&&async function(){await r,i[p([109,111,100,101,108])][p([99,104,97,110,103,101])]=g,i[p([109,111,100,101,108])][p([101,110,113,117,101,117,101,67,104,97,110,103,101])]=g,i[p([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](p([109,111,100,101,108]))}()}(await async function(){let e,t=null,g=null;try{if(o==p([71,80,76]))return p([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[p([115,112,108,105,116])](p([46]));if(3!=e[p([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[p([106,116,105])],n=window[p([112,97,114,115,101,73,110,116])](e[p([115,117,98,115,116,114,105,110,103])](e[p([108,101,110,103,116,104])]-8),16),i={...t,[p([106,116,105])]:e[p([115,117,98,115,116,114,105,110,103])](0,e[p([108,101,110,103,116,104])]-8)};return delete i[p([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return p([73,110,118,97,108,105,100]);e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(f=e[p([117,115,97,103,101,69,110,100,112,111,105,110,116])],y=e[p([106,116,105])],g=new(window[p([80,114,111,109,105,115,101])])((e=>{if(i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==p([97,117,116,111]))return e(p([86,97,108,105,100]));i[p([101,100,105,116,105,110,103])][p([118,105,101,119])][p([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=p([97,117,116,111]),i[p([100,101,99,111,114,97,116,101])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[p([80,114,111,109,105,115,101])])(((e,t)=>{i[p([116,104,101,110])](e,t),window[p([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[p([116,104,101,110])]((e=>e&&e[p([115,116,97,116,117,115])]==p([111,107])?u(d(s+y))!=e[p([118,101,114,105,102,105,99,97,116,105,111,110])]?p([85,115,97,103,101,76,105,109,105,116]):p([86,97,108,105,100]):p([85,115,97,103,101,76,105,109,105,116])))[p([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=p([108,108,99,116,45])+u(d(f)),t=window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([103,101,116,73,116,101,109])](e);return t?window[p([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),p([86,97,108,105,100])):p(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[p([116,104,101,110])](e)[p([99,97,116,99,104])]((()=>{e(p([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=p([108,108,99,116,45])+u(d(f)),t=h(u(window[p([77,97,116,104])][p([99,101,105,108])](n/r)));window[p([108,111,99,97,108,83,116,111,114,97,103,101])][p([115,101,116,73,116,101,109])](e,t)}}i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=f)return e(p([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[p([114,101,113,117,101,115,116,73,100])]:s}}),{[p([112,114,105,111,114,105,116,121])]:p([104,105,103,104])}),i[p([111,110])](p([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[p([114,101,116,117,114,110])])&&(typeof n===p([111,98,106,101,99,116])||typeof n===p([102,117,110,99,116,105,111,110]))&&typeof n[p([116,104,101,110])]===p([102,117,110,99,116,105,111,110])&&typeof n[p([99,97,116,99,104])]===p([102,117,110,99,116,105,111,110])&&(t=!0,o(e[p([114,101,116,117,114,110])]))}),{[p([112,114,105,111,114,105,116,121])]:p([108,111,119])}),r[p([116,104,101,110])]((()=>{t||e(p([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[p([115,112,108,105,116])](p([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[p([97,108,103])]==p([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[p([85,105,110,116,56,65,114,114,97,121])][p([102,114,111,109])](c(i),(e=>e[p([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[p([84,101,120,116,69,110,99,111,100,101,114])]))[p([101,110,99,111,100,101])](t+p([46])+n),a=window[p([99,114,121,112,116,111])][p([115,117,98,116,108,101])];if(!a)return;const l=await a[p([105,109,112,111,114,116,75,101,121])](p([106,119,107]),s,{[p([110,97,109,101])]:p([69,67,68,83,65]),[p([110,97,109,101,100,67,117,114,118,101])]:p([80,45,50,53,54])},!1,[p([118,101,114,105,102,121])]);await a[p([118,101,114,105,102,121])]({[p([110,97,109,101])]:p([69,67,68,83,65]),[p([104,97,115,104])]:{[p([110,97,109,101])]:p([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[p([102,101,97,116,117,114,101,115])];if(!t)return!1;if(t[p([105,110,99,108,117,100,101,115])](p([42])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([84,67])))return!0;if(t[p([105,110,99,108,117,100,101,115])](p([82,84,67]))){if(m(p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&(n=p([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]),i[p([112,108,117,103,105,110,115])][p([103,101,116])](n))[p([115,116,97,116,101])]==p([99,111,110,110,101,99,116,101,100]))return!0;if(m(p([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||m(p([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114])))return!0}var n;return!1}()?function(){const t=[p([101,118,97,108,117,97,116,105,111,110]),p([116,114,105,97,108])][p([105,110,99,108,117,100,101,115])](e[p([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[p([101,120,112])]<t}()?p([69,120,112,105,114,101,100]):function(){const t=e[p([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[p([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[p([108,111,99,97,116,105,111,110])].href);if(t[p([105,110,99,108,117,100,101,115])](n))return!0;const i=n[p([115,112,108,105,116])](p([46]));return t[p([102,105,108,116,101,114])]((e=>e[p([105,110,99,108,117,100,101,115])](p([42]))))[p([109,97,112])]((e=>e[p([115,112,108,105,116])](p([46]))))[p([115,111,109,101])]((e=>i[p([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===p([42])))))}()?(e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([101,118,97,108,117,97,116,105,111,110])&&(t=a(p([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[p([108,105,99,101,110,115,101,84,121,112,101])]==p([116,114,105,97,108])&&(t=a(p([84,114,105,97,108,76,105,109,105,116]))),await(t&&g?new(window[p([80,114,111,109,105,115,101])])(((e,n)=>{t[p([116,104,101,110])](e,n),g[p([116,104,101,110])]((t=>{t!=p([86,97,108,105,100])&&e(t)}),n)})):t||g||p([86,97,108,105,100]))):p([68,111,109,97,105,110,76,105,109,105,116]):p([78,111,116,65,108,108,111,119,101,100]):p([73,110,118,97,108,105,100])}catch(e){return p([73,110,118,97,108,105,100])}var f,y}())}class SuggestionController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n,i){super(),this.model=t,this.view=n,this.commentThreadController=i,this._editor=e,this._acceptCommand=e.commands.get("acceptSuggestion"),this._discardCommand=e.commands.get("discardSuggestion"),this.view.bind("isEnabled").to(this._acceptCommand,this._discardCommand,((e,t)=>e||t)),this.view.bind("canAccept").to(this._acceptCommand,"isEnabled",(e=>e&&this._editor.model.canEditAt(t.getRanges()))),this.view.bind("canDiscard").to(this._discardCommand,"isEnabled",(e=>e&&this._editor.model.canEditAt(t.getRanges()))),this._pendingAction=null,n.isDirty&&this._setPendingAction(),this.listenTo(n,"acceptSuggestion",(()=>this.acceptSuggestion())),this.listenTo(n,"discardSuggestion",(()=>this.discardSuggestion())),this.listenTo(n,"change:isDirty",(()=>{n.isDirty?this._setPendingAction():this._removePendingAction()}))}acceptSuggestion(){this._acceptCommand.execute(this.model.id)}discardSuggestion(){this._discardCommand.execute(this.model.id)}destroy(){this.view.unbind("isEnabled"),this.view.unbind("canAccept"),this.view.unbind("canDiscard"),this.stopListening(),this.commentThreadController.destroy(),this._pendingAction&&this._removePendingAction()}_setPendingAction(){const e=getTranslation$1(this._editor.locale,"PENDING_ACTION_SUGGESTION");this._pendingAction=this._editor.plugins.get("PendingActions").add(e)}_removePendingAction(){null!==this._pendingAction&&this._editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null}}class BaseSuggestionThreadView extends View{constructor(e,t,n,i){super(e),this.commentsListView=null,this.commentThreadInputView=null,this.ariaDescriptionView=new AriaDescriptionView(e,getTranslation$1(e,"SUGGESTION_THREAD_DESCRIPTION")),this.set("isActive",!1),this.set("authoredAt",t.authoredAt),this.bind("authoredAt").to(t),this.set("descriptionParts",[]),this.set("isDirty",!1),this.set("isEnabled",!1),this.set("canAccept",!1),this.set("canDiscard",!1),this.bind("ariaLabel").to(this,"length",t,"authoredAt",this,"descriptionParts",((e,n,r)=>{const s=r.map((e=>renderDescription(e.content))).join(". ")+".";return getTranslation$1(this.locale,"SUGGESTION_THREAD_ARIA_LABEL",[e-1,t.author.name,n?i.formatDateTime(n):"",(new DOMParser).parseFromString(s,"text/html").body.textContent])})),this.focusables=new ViewCollection,this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,keystrokeHandlerOptions:{filter:e=>e.target!==this.element},actions:{focusPrevious:"shift+tab",focusNext:"tab"}}),this._model=t,this._localUser=n,this._config=i,i.disableComments?this.set("length",1):this._createCommentViews()}render(){super.render(),setupThreadKeyboardNavigation(this,this.focusables)}focus(){this.element.focus()}destroy(){this.commentsListView&&this.commentsListView.destroy(),this.commentThreadInputView&&this.commentThreadInputView.destroy(),super.destroy()}_createCommentViews(){const{CommentsListView:e}=this._config;this.commentsListView=new e(this.locale,this._model.commentThread,Object.assign({CommentView:this._config.CommentView},this._config)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.bind("isActive").to(this),this.set("length",this.commentsListView.length+1),this.bind("length").to(this.commentsListView,"length",(e=>e+1)),this.commentThreadInputView=this._createCommentThreadInputView(),this.on("removeComment",(()=>this.focus())),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",((e,t)=>e||!!t))}_createCommentThreadInputView(){const{CommentThreadInputView:e}=this._config,t=new e(this.locale,this._localUser,this._config.editorConfig),n=t.commentInputView;return t.bind("showInput").to(this,"isActive",this._model.commentThread,"isReadOnly",n,"value",((e,t,n)=>!!n||e&&!t)),n.on("submit",((e,t)=>{this.fire("addComment",t),n.editor.setData("")})),n.on("cancel",(()=>this.focus())),n.bind("disabledSubmit").to(this._model.commentThread,"isReadOnly"),t}}class SuggestionThreadView extends BaseSuggestionThreadView{constructor(e,t,n,i){super(e,t,n,i),this.set("type",""),this.bind("type").to(this,"descriptionParts",(e=>e&&e[0]?e[0].type:"")),this.bind("description").to(this,"descriptionParts",this,"isActive",((e,t)=>{let n="";for(const t of e)n+="<p>"+renderDescription(t.content,t.color)+"</p>";return t?n:trimHtml(n,{limit:140})})),this._descriptionElement=null,this.suggestionView=new i.SuggestionView(e,t,{formatDateTime:i.formatDateTime}),this.suggestionView.bind("description").to(this),this.suggestionView.delegate("acceptSuggestion","discardSuggestion").to(this),this.suggestionView.acceptButton.bind("isEnabled").to(this,"canAccept"),this.suggestionView.discardButton.bind("isEnabled").to(this,"canDiscard"),this.focusables.add(this.suggestionView),this.commentsListView&&this.focusables.add(this.commentsListView),this.commentThreadInputView&&this.focusables.add(this.commentThreadInputView),this.setTemplate(this.getTemplate())}getTemplate(){const e=this.bindTemplate,t=[this.suggestionView];this.commentsListView&&t.push(this.commentsListView),this.commentThreadInputView&&t.push(this.commentThreadInputView),t.push(this.ariaDescriptionView);return{tag:"div",attributes:{class:["ck","ck-rounded-corners","ck-suggestion-wrapper",e.if("isActive","ck-suggestion-wrapper--active"),e.to("type",(e=>"ck-suggestion-"+e)),this._config.disableComments&&"ck-suggestion--disabled-comments"],"data-suggestion-id":this._model.id,"data-thread-id":this._model.commentThread.id,"data-author-id":this._model.author.id,tabindex:0,role:"listitem","aria-label":e.to("ariaLabel"),"aria-describedby":this.ariaDescriptionView.id},children:t}}render(){super.render(),this.commentsListView&&(this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this)),this.commentThreadInputView&&(this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this))}}class SuggestionView extends View{constructor(e,t,n){super(e),this._model=t,this._config=n,this.set("description",""),this.bind("authoredAt").to(t),this.acceptButton=this._createButton(getTranslation$1(e,"Accept suggestion"),_0x42409c.check,"ck-suggestion--accept","acceptSuggestion","sw"),this.discardButton=this._createButton(getTranslation$1(e,"Discard suggestion"),_0x42409c.cancel,"ck-suggestion--discard","discardSuggestion","sw"),this.userView=new UserView(e,t.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-suggestion__user","ck-annotation__user"],"aria-hidden":!0}}),this.focusables=new ViewCollection([this.acceptButton,this.discardButton]),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift+tab",focusNext:"tab"},keystrokeHandlerOptions:{filter:e=>e.target!==this.element}}),this.setTemplate(this.getTemplate())}render(){super.render();const e=this.element.querySelector(".ck-annotation__content-wrapper");e.innerHTML=this.description,this.on("change:description",((t,n,i)=>{e.innerHTML=i})),this._setupKeyboardNavigation()}getTemplate(){const e=this.bindTemplate,t=[{tag:"div",attributes:{class:["ck-suggestion__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-suggestion__info-name","ck-annotation__info-name"],"data-cke-tooltip-text":this.userView.name}},{tag:"time",attributes:{datetime:e.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:e.to("authoredAt",(e=>this._config.formatDateTime(e)))}]}]},{tag:"div",attributes:{class:["ck-suggestion__actions","ck-annotation__actions"]},children:[this.acceptButton,this.discardButton]},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]}}];return this._model.isExternal&&t.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalSuggestionNote()}]}),{tag:"div",attributes:{class:["ck-suggestion","ck-annotation"],tabindex:-1},children:[this.userView,{tag:"div",attributes:{class:["ck-suggestion__main","ck-annotation__main"],role:"presentation"},children:t}]}}focus(){this.element.focus()}getUserViewNotificationText(){return this._model.isExternal?"importWord"===this._model.attributes["@external"].source?getTranslation$1(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):getTranslation$1(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}getExternalSuggestionNote(){return"importWord"===this._model.attributes["@external"].source?getTranslation$1(this.locale,"EXTERNAL_IMPORT_WORD_SUGGESTION"):getTranslation$1(this.locale,"EXTERNAL_SUGGESTION")}_createButton(e,t,n,i,r){const s=new LateFocusButtonView(this.locale);return s.set({label:e,icon:t,tooltip:!0,tooltipPosition:r}),s.extendTemplate({attributes:{class:n}}),s.on("execute",(()=>{this.fire(i,this._model.id)})),s}_setupKeyboardNavigation(){const e=this.element;this.keystrokes.listenTo(e);for(const e of this.focusables)this.focusTracker.add(e.element),this.keystrokes.listenTo(e.element);this.keystrokes.set("enter",((t,n)=>{e===t.target&&(this.focusCycler.focusFirst(),n())})),this.keystrokes.set("esc",((t,n)=>{e!==t.target&&(this.focus(),n())}))}}var trackChangesIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.182 5.514a.643.643 0 0 0-.636.64v-.001a.636.636 0 0 0 .636.639h5.682a.641.641 0 0 0 .636-.638.637.637 0 0 0-.636-.64H6.182Z"/><path d="M6.182 8.5a.642.642 0 0 0-.588.882.636.636 0 0 0 .588.395h5.682a.641.641 0 0 0 .636-.639.635.635 0 0 0-.636-.638H6.182Z"/><path d="M6.18 11.5a.64.64 0 0 0 0 1.278h3.133a.64.64 0 0 0 0-1.278H6.18Z"/><path d="m11.772 18.308.154-.23c-.195-.098-.304-.192-.328-.28-.024-.09 0-.274.076-.551.062-.166.099-.296.11-.393a2.934 2.934 0 0 0 0-.479c-.137-.41-.2-.685-.186-.83.013-.145.117-.335.313-.57l4.465-6.207c.356-.6 1.059-.56 2.11.118 1.05.68 1.443 1.272 1.177 1.772l-3.876 6.833c-.105.27-.22.444-.347.515-.128.07-.4.119-.813.139a2.954 2.954 0 0 0-.487.21c-.127.09-.244.193-.347.31-.193.174-.332.262-.416.262-.064 0-.178-.05-.346-.15l-.204.27-1.056-.739Zm-.184.274 1.039.727-.26.34h-1.496l.717-1.067Z"/><path clip-rule="evenodd" d="M3.272 1A1.28 1.28 0 0 0 2 2.28v14.439a1.276 1.276 0 0 0 1.272 1.28h6.838a2.13 2.13 0 0 1 .003-.61c.024-.18.066-.363.113-.534.012-.046.027-.092.043-.136.011-.029.02-.052.025-.069v-.008a7.395 7.395 0 0 1-.042-.142H3.5V2.46s11 .002 11 .005v6.341l.627-.872c.204-.32.49-.614.873-.819V2.281c0-.707-.569-1.28-1.272-1.28L3.272 1ZM16 9.29l-1.5 2.085V16.5h-2.708c.005.118.002.236-.007.354a.904.904 0 0 1-.013.075l-.001.005a3.108 3.108 0 0 1-.097.312c-.027.101-.048.19-.062.266a.734.734 0 0 0-.014.287.25.25 0 0 0 .068.105.65.65 0 0 0 .088.074l.017.011.016.01h.175L14.73 18c.697 0 1.271-.573 1.271-1.281v-7.43Z"/></svg>\n';class TrackChangesUI extends Plugin{static get requires(){return[TrackChangesEditing,Users,"CommentsRepository","Annotations","EditorAnnotations"]}static get pluginName(){return"TrackChangesUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),this._suggestionToController=new Map,this._viewToController=new Map,this._annotationViews=new Map,this._handleControllerBuffer=new Map;const t=this.editor.config;t.define("trackChanges.SuggestionThreadView",SuggestionThreadView),t.define("trackChanges.SuggestionView",SuggestionView),t.define("trackChanges.disableComments",!1),this._disableComments=t.get("trackChanges.disableComments")}_handleSuggestionControllerDelayed(e,t){0===this._handleControllerBuffer.size&&setTimeout((()=>{for(const[e,t]of this._handleControllerBuffer){const n=this._suggestionToController.has(e);n||t?n&&t&&this._destroyController(e):this._initializeController(e)}this._handleControllerBuffer.clear(),this.editor.plugins.get("EditorAnnotations").refreshSelectedViews(),this._refreshActiveMarkers()}),10),this._handleControllerBuffer.set(e,t)}init(){const e=this.editor,t=e.plugins.get("TrackChangesEditing"),n=e.plugins.get("Annotations"),i=e.plugins.get("EditorAnnotations"),r=e.plugins.get("CommentsRepository");this._addUIComponentsToFactory(),i.addSourceCollector((()=>{const e=[];for(const[t,n]of Array.from(this._suggestionToController)){const i=t.getAllAdjacentSuggestions(),r=[];for(const e of i){if(!e.isInContent)continue;if(e.isMultiRange){r.push(...e.getRanges());continue}const t=e.getFirstRange();if(r.length>0){const e=r[0].getJoined(t);if(e){r[0]=e;continue}}r.push(t)}e.push([n.view,r])}return e})),this.listenTo(t,"suggestionLoaded",((e,t)=>{this.listenTo(t,"change:previous",((e,n,i,r)=>{t.isInContent&&(null==i?(this._updateController(r.head),this._handleSuggestionControllerDelayed(t,!1)):(this._updateController(i.head),null==r&&this._handleSuggestionControllerDelayed(t,!0)))})),null!==t.previous?this._updateController(t.head):this._handleSuggestionControllerDelayed(t,!1)})),this.listenTo(t,"suggestionUnloaded",((e,t,n)=>{this.stopListening(t,"change:previous"),this._handleControllerBuffer.delete(t),this._suggestionToController.has(t)&&this._destroyController(t),n&&this._updateController(n.head)})),this.listenTo(t,"suggestionChanged",((e,t)=>{this._updateController(t)})),this.listenTo(n,"change:activeAnnotations",(()=>{this._refreshActiveMarkers()})),this.listenTo(r,"addComment",((e,{threadId:n,isFromAdapter:i})=>{if(i||!t.hasSuggestion(n))return;const r=t.getSuggestion(n);this._suggestionToController.get(r).view.commentsListView.focus(-1)}),{priority:"lowest"}),this.licenseKey=this.editor.config.get("licenseKey");const s=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let e;for(const t in s){const n=t,i=s[n];if("trackChangesLicenseKeyValid"==i||"trackChangesLicenseKeyInvalid"==i||"trackChangesLicenseKeyExpired"==i||"trackChangesLicenseKeyDomainLimit"==i||"trackChangesLicenseKeyNotAllowed"==i||"trackChangesLicenseKeyEvaluationLimit"==i||"trackChangesLicenseKeyTrialLimit"==i||"trackChangesLicenseKeyUsageLimit"==i){delete s[n],e=i,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"trackChangesLicenseKeyInvalid"==e&&s._showLicenseError("invalid"),"trackChangesLicenseKeyExpired"==e&&s._showLicenseError("expired"),"trackChangesLicenseKeyDomainLimit"==e&&s._showLicenseError("domainLimit"),"trackChangesLicenseKeyNotAllowed"==e&&s._showLicenseError("featureNotAllowed","TrackChanges"),"trackChangesLicenseKeyEvaluationLimit"==e&&s._showLicenseError("evaluationLimit"),"trackChangesLicenseKeyTrialLimit"==e&&s._showLicenseError("trialLimit"),"trackChangesLicenseKeyUsageLimit"==e&&s._showLicenseError("usageLimit")}),1e3)}_refreshActiveMarkers(){const e=this.editor.plugins.get("Annotations"),t=this.editor.plugins.get("TrackChangesEditing"),n=Array.from(e.activeAnnotations,(e=>e.innerView)).filter((e=>this._viewToController.has(e))),i=[];for(const e of n){const t=this._viewToController.get(e).model.getAllAdjacentSuggestions();i.push(...t.reduce(((e,t)=>[...e,...t.getMarkerNames()]),[]))}t.activeMarkers=i}_addUIComponentsToFactory(){const e=this.editor,t=e.locale,n=getTranslation$1(t,"Track changes"),i=new Collection([{type:"switchbutton",model:new ViewModel({withText:!0,isToggleable:!0,label:n,commandName:"trackChanges",role:"menuitemcheckbox"})},{type:"separator"},{type:"button",model:new ViewModel({withText:!0,label:getTranslation$1(t,"Accept all suggestions"),commandName:"acceptAllSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation$1(t,"Accept all selected suggestions"),commandName:"acceptSelectedSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation$1(t,"Discard all suggestions"),commandName:"discardAllSuggestions",role:"menuitem"})},{type:"button",model:new ViewModel({withText:!0,label:getTranslation$1(t,"Discard all selected suggestions"),commandName:"discardSelectedSuggestions",role:"menuitem"})}]);e.plugins.has("TrackChangesPreview")&&i.addMany([{type:"separator"},{type:"button",model:new ViewModel({withText:!0,label:getTranslation$1(t,"Preview final content"),commandName:"previewFinalContent",role:"menuitem"})}]);for(const t of i)if(isListDropdownButtonDefinition(t)){const n=e.commands.get(t.model.commandName);t.model.bind("isOn","isEnabled").to(n,"value","isEnabled")}e.ui.componentFactory.add("trackChanges",(e=>this._createToolbarButton(e,i,n))),e.ui.componentFactory.add("menuBar:trackChanges",(e=>this._createMenuBarMenu(e,i,n)))}_createToolbarButton(e,t,n){const i=createDropdown(e,SplitButtonView),r=this.editor.commands.get("trackChanges");i.buttonView.set({tooltip:n,label:n,icon:trackChangesIcon}),i.buttonView.bind("isOn").to(r,"value"),i.buttonView.on("execute",(()=>{r.execute(),this.editor.editing.view.focus()})),addListToDropdown(i,t,{role:"menu"});const s=[];for(const e of t)isListDropdownButtonDefinition(e)&&s.push(this.editor.commands.get(e.model.commandName));const o=i.buttonView;return o.actionView.unbind("isEnabled"),o.arrowView.unbind("isEnabled"),o.actionView.bind("isEnabled").to(r,"isEnabled"),o.arrowView.bind("isEnabled").toMany(s,"isEnabled",((...e)=>e.some((e=>e)))),i.on("execute",(e=>{this.editor.execute(e.source.commandName),this.editor.editing.view.focus()})),i}_createMenuBarMenu(e,t,n){const i=new MenuBarMenuView(e),r=this.editor.commands.get("trackChanges");i.buttonView.set({label:n,icon:trackChangesIcon});const s=new MenuBarMenuListView(e);for(const n of t){if("separator"==n.type){s.items.add(new ListSeparatorView(e));continue}const t=new MenuBarMenuListItemView(e,i),r=new MenuBarMenuListItemButtonView(e),o=n.model;r.bind(...Object.keys(o)).to(o),r.delegate("execute").to(i),r.on("execute",(()=>{this.editor.execute(o.commandName),this.editor.editing.view.focus()})),t.children.add(r),s.items.add(t)}return i.bind("isEnabled").to(r,"isEnabled"),i.panelView.children.add(s),i}_initializeController(e){const t=this.editor,n=t.config,i=t.plugins.get("Annotations"),r=t.plugins.get("CommentsRepository"),s=t.plugins.get("EditorAnnotations"),o=t.plugins.get(Users).me,a=n.get("trackChanges").SuggestionThreadView,l=n.get("trackChanges").SuggestionView,{CommentsListView:c,CommentThreadInputView:d}=t.plugins.get("CommentsUI");let u,h,m;this._annotationViews.has(e.id)?(h=this._annotationViews.get(e.id),u=h.mainView):(u=new a(t.locale,e,o,{disableComments:this._disableComments,editorConfig:{...n.get("comments.editorConfig"),licenseKey:n.get("licenseKey")},maxCommentsWhenCollapsed:n.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:n.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:n.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:getDateTimeFormatter(n.get("locale")),CommentView:n.get("comments").CommentView,CommentsListView:c,CommentThreadInputView:d,SuggestionView:l}),u.suggestionView.acceptButton.on("execute",(()=>{t.editing.view.focus()})),u.suggestionView.discardButton.on("execute",(()=>{t.editing.view.focus()})),h=i.createAnnotationView(this.editor.locale,u),h.bind("isDirty").to(u,"isDirty"),h.bind("length").to(u),h.bind("type").to(u,"type",(e=>"suggestion-"+e)),u.on("escape",(()=>{m.fire("escape")})),this._annotationViews.set(e.id,h));const g=r.createCommentThreadController(e.commentThread,u),p=new SuggestionController(t,e,u,g),f=e.getAllAdjacentSuggestions().filter((e=>e.isInContent));u.descriptionParts=t.plugins.get("TrackChangesEditing").descriptionFactory.getDescriptions(f),this._suggestionToController.set(e,p),this._viewToController.set(u,p),m=i.createAnnotation({view:h,target:()=>{const n=[],i=e.getAllAdjacentSuggestions().filter((e=>e.isInContent));for(const e of i)n.push(...e.getMarkers());return getAllMarkersDomElementsSorted(t.editing,n)},type:()=>"suggestion-"+p.view.type}),r._bindAnnotationToEditors(u,m),i.add(m),s.registerAnnotation(m)}_destroyController(e){const t=this.editor.plugins.get("CommentsRepository"),n=this.editor.plugins.get("Annotations"),i=this._suggestionToController.get(e),r=i.view,s=n.getByInnerView(r);t._unbindEditors(r),s&&n.remove(s),this._suggestionToController.delete(e),this._viewToController.delete(r),i.destroy()}_updateController(e){if(!e.isInContent||!this._suggestionToController.has(e))return;const t=this.editor.plugins.get("TrackChangesEditing"),n=this._suggestionToController.get(e),i=e.getAllAdjacentSuggestions();n.view.descriptionParts=t.descriptionFactory.getDescriptions(i)}destroy(){for(const e of this._suggestionToController.keys())this._destroyController(e);for(const e of this._annotationViews.values())e.mainView.destroy();super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}function isListDropdownButtonDefinition(e){return"model"in e}class TrackChanges extends Plugin{static get requires(){return[TrackChangesEditing,TrackChangesUI,"Comments"]}static get pluginName(){return"TrackChanges"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}set adapter(e){this.editor.plugins.get(TrackChangesEditing).adapter=e}get adapter(){return this.editor.plugins.get(TrackChangesEditing).adapter}addSuggestion(e){return this.editor.plugins.get(TrackChangesEditing).addSuggestionData(e)}getSuggestions({skipNotAttached:e=!1,toJSON:t=!1}={}){return this.editor.plugins.get(TrackChangesEditing).getSuggestions({skipNotAttached:e,toJSON:t})}getSuggestion(e){return this.editor.plugins.get(TrackChangesEditing).getSuggestion(e)}}const blackListedPlugins=["Pagination"];class TrackChangesData extends Plugin{static get requires(){return[TrackChangesEditing]}static get pluginName(){return"TrackChangesData"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const e=this.editor;if(e.config.define("trackChangesData.editorCreator",(t=>{const n=e.model.document.getRootNames().reduce(((e,t)=>(e[t]="",e)),{});return e.constructor.create(n,t)})),"function"!=typeof e.config.get("trackChangesData").editorCreator)throw new CKEditorError("track-changes-data-invalid-editor-creator")}getDataWithAcceptedSuggestions(e){return getTrackChangesData(this.editor,!0,e)}getDataWithDiscardedSuggestions(e){return getTrackChangesData(this.editor,!1,e)}}class TrackChangesDataGetter extends Plugin{static get pluginName(){return"TrackChangesDataGetter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){function t(e){return e.map((e=>String.fromCharCode(e))).join("")}super(e),this.result="end",e[t([101,100,105,116,105,110,103])][t([118,105,101,119])][t([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=t([97,117,116,111]),e[t([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116])]=()=>window[t([80,114,111,109,105,115,101])][t([114,101,115,111,108,118,101])]({[t([115,116,97,116,117,115])]:t([111,107])})}init(){this.editor.plugins.get("CommentsRepository")._adapter={addCommentThread:()=>new Promise((()=>{})),getCommentThread:()=>new Promise((()=>{})),updateCommentThread:()=>new Promise((()=>{})),resolveCommentThread:()=>new Promise((()=>{})),reopenCommentThread:()=>new Promise((()=>{})),removeCommentThread:()=>new Promise((()=>{})),addComment:()=>new Promise((()=>{})),updateComment:()=>new Promise((()=>{})),removeComment:()=>new Promise((()=>{}))},this.editor.plugins.get("TrackChangesEditing")._adapter=null}}function isMultiRootEditor$1(e){return void 0!==e.getRootsAttributes}async function getTrackChangesData(e,t,n){const i=sanitizeEditorConfig(e,blackListedPlugins);i.plugins.push(TrackChangesEditing,TrackChangesDataGetter),i.rootsAttributes=isMultiRootEditor$1(e)?e.getRootsAttributes():void 0;const r=document.createDocumentFragment(),s=e.config.get("trackChangesData").editorCreator,o=await s(i,(()=>createAttachedElement(r)));copyEditorData(e,o),o.execute(t?"acceptAllSuggestions":"discardAllSuggestions");const a=isMultiRootEditor$1(o)?o.getFullData(n):o.data.get(n);return await o.destroy(),a}function copyEditorData(e,t){const n=e.model.document.getRootNames().reduce(((t,n)=>(t[n]=e.data.get({rootName:n}),t)),{}),i=e.plugins.get("Users").users.map((e=>({id:e.id,name:e.name}))),r=e.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0,toJSON:!0}),s=e.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,toJSON:!0}),o=t.plugins.get("Users"),a=t.plugins.get("TrackChangesEditing"),l=t.plugins.get("CommentsRepository");for(const e of l.getCommentThreads())e.remove();for(const e of i)o.getUser(e.id)||o.addUser(e);o.me||o.useAnonymousUser();for(const e of s)l.addCommentThread(e);for(const e of r)a.addSuggestionData(e);t.data.set(n)}function createAttachedElement(e){const t=document.createElement("div");return e.appendChild(t),t}class TrackChangesPreviewView extends View{constructor(e,t){super(e),this.options=t,this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-track-changes-preview"],tabindex:-1}})}render(){super.render(),this.element.style.width=this.options.dialogRects.width+"px",this.element.style.height=this.options.dialogRects.height+"px"}setPreviewData(e,t){if(!this.element)return;const n=[];for(const[t,i]of e){const e=document.createElement("div");e.setAttribute("data-ck-root-name",t),e.className=i.classes+" ck-track-changes-preview__root-container",e.innerHTML=i.content,n.push(e)}t(this.element,n),this.element.style.height="",this.fire("previewDataReady")}focus(){this.element.focus()}}class PreviewFinalContentCommand extends _0x338ed0{constructor(e){super(e),this.affectsData=!1,this.isEnabled=!0}refresh(){this.isEnabled=!0}execute(){const e=this.editor,t=e.locale,n=e.plugins.get("Dialog");let i;const r=getEditables(e),s=calculateDialogRects(r);n.show({id:"finalContentPreview",title:getTranslation$1(t,"Final content preview"),isModal:!0,className:"ck-track-changes-preview-dialog",content:new TrackChangesPreviewView(t,{dialogRects:s}),onHide:()=>{i.detachFromDom()},onShow:()=>{e.plugins.get("TrackChangesData").getDataWithAcceptedSuggestions({...this._getMergeFieldsData()}).then((t=>{const i=this._standarizeRootsData(t,e,r);n.view.contentView.children.get(0).setPreviewData(i,e.config.get("trackChanges.preview.renderFunction"))})),i=new BodyCollection(t,[n.view]),i.attachToDom(),i.bodyCollectionContainer.classList.remove("ck-reset_all"),e.once("destroy",(()=>{i.detachFromDom()}));const s=n.view.headerView.class;n.view.headerView.class=s?s+" ck-reset_all":"ck-reset_all",n.view.contentView.children.get(0).on("previewDataReady",(()=>{n.view.updatePosition()}))}})}_getMergeFieldsData(){if(!this.editor.plugins.has("MergeFieldsEditing"))return{};const e=this.editor.plugins.get("MergeFieldsEditing"),t=e.previewMode,n={};if("$labels"===t)for(const t of e.getMergeFieldsIds())n[t]=e.getLabel(t)||t;else{const i="$defaultValues"===t?e.getDefaultValues():e.getDataSetValues(t,!0);for(const t of Object.entries(i)){const[i,r]=t;n[i]=null!==r?r:e.getLabel(i)||i}}return{mergeFieldsData:n}}_standarizeRootsData(e,t,n){let i;if("string"==typeof e){const n=t.model.document.getRootNames()[0];i={[n]:e}}else i=e;const r=this._fixMediaEmbeds(i,t);return addEditableClasses(this._sortRoots(t).reduce(((e,t)=>(e.push([t,{content:r[t],classes:""}]),e)),[]),n)}_fixMediaEmbeds(e,t){if(!t.plugins.has("MediaEmbedEditing"))return e;const n=t.plugins.get("MediaEmbedEditing");for(const[i,r]of Object.entries(e)){const s=document.createElement("div");s.innerHTML=r,s.querySelectorAll("figure.media").forEach((e=>{const i=e.querySelector("oembed");if(i){const e=i.getAttribute("url");if(e){const r=n.registry.getMediaViewElement(new DowncastWriter(t.editing.view.document),e,{elementName:"",renderForEditingView:!0}),s=document.createElement("div");s.classList.add("ck-media__wrapper"),r.render(s,t.editing.view.domConverter),i.replaceWith(s)}}})),e[i]=s.innerHTML}return e}_sortRoots(e){if(!isMultiRootEditor(e))return e.model.document.getRootNames();const t=[],n=new Map;for(const i of e.model.document.getRootNames()){const r=e.editing.view.getDomRoot(i).getClientRects().item(0);t.push(i),n.set(i,r)}return t.sort(((e,t)=>{const i=n.get(e),r=n.get(t);return i.y-r.y||i.x-r.x})),t}}function getEditables(e){const t={};if("editables"in e.ui.view)for(const[n,i]of Object.entries(e.ui.view.editables))t[n]=i.element;else t[e.model.document.getRootNames()[0]]=e.ui.view.editable.element;return t}function calculateDialogRects(e){let t=0;for(const n of Object.values(e))t=Math.max(t,n.getBoundingClientRect().width);let n=0;for(const t of Object.values(e))n+=t.getBoundingClientRect().height;const i=.8*Math.max(document.documentElement.clientHeight,window.innerHeight);return{width:t,height:Math.min(n,i)}}function addEditableClasses(e,t){for(const[n,i]of e)i.classes=t[n].classList.value.replace("ck-focused","");return e}function isMultiRootEditor(e){return void 0!==e.getRootsAttributes}class TrackChangesPreview extends Plugin{static get requires(){return[TrackChangesData,Dialog]}static get pluginName(){return"TrackChangesPreview"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),e.commands.add("previewFinalContent",new PreviewFinalContentCommand(this.editor)),e.config.define("trackChanges.preview.renderFunction",((e,t)=>{for(const n of t)e.appendChild(n)}))}}var dropboxIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M5.972 3.115A.746.746 0 0 1 6.374 3c.14 0 .28.037.402.115l3.229 2.059 3.228-2.057a.75.75 0 0 1 .805 0l3.629 2.31h.002a.757.757 0 0 1 0 1.264h-.002L15.034 8.37l2.633 1.678h.002a.756.756 0 0 1 0 1.262h-.002l-3.63 2.312a.746.746 0 0 1-.161.076c.234.08.409.275.482.5a.75.75 0 0 1-.322.854l-3.629 2.308a.75.75 0 0 1-.805 0l-3.63-2.31a.75.75 0 0 1-.229-1.031l.076-.122h.022a.746.746 0 0 1 .32-.189.75.75 0 0 1-.19-.086l-3.63-2.312a.756.756 0 0 1 0-1.264l2.632-1.678-2.632-1.676a.757.757 0 0 1 0-1.263l3.63-2.313Zm2.64 2.946L6.374 4.635 4.136 6.06l2.238 1.423 2.238-1.423Zm7.262 0-2.236-1.426-2.239 1.426 2.237 1.423 2.238-1.423Zm-3.637 2.306-2.232-1.422-2.233 1.422 2.235 1.422 2.23-1.422Zm-3.625 2.31L6.374 9.253l-2.238 1.426 2.238 1.424 2.238-1.424Zm7.262 0-2.236-1.425-2.239 1.426 2.237 1.424 2.238-1.424Zm-2.64 2.944-3.23-2.056-3.228 2.056a.75.75 0 0 1-.185.084.724.724 0 0 1 .185.08l3.229 2.057 3.226-2.055a.827.827 0 0 1 .18-.084.746.746 0 0 1-.178-.082Z"/></svg>\n',facebookIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.01 2C5.59 2 2 5.59 2 10.01a8.011 8.011 0 0 0 6.775 7.914.754.754 0 0 0 .598-.17.75.75 0 0 0 .262-.565v-5.02a.745.745 0 0 0-.22-.524.745.745 0 0 0-.526-.221H7.77v-.627H8.89a.745.745 0 0 0 .525-.22c.14-.14.22-.329.22-.526V8.324c0-.466.122-1.083.524-1.48.33-.326 1.017-.6 2.332-.43v.408c-.152.012-.305.017-.457.04-.335.048-.662.136-.943.326-.313.21-.497.505-.59.804-.093.3-.107.602-.107.88v1.18a.746.746 0 0 0 .744.746h1.158l-.098.63h-1.06a.744.744 0 0 0-.744.744v5.017a.752.752 0 0 0 .26.567c.081.07.177.119.28.148a.75.75 0 0 0 .319.022A8.012 8.012 0 0 0 10.01 2Zm0 1.486a6.52 6.52 0 0 1 6.521 6.524c0 2.945-1.973 5.386-4.65 6.197v-3.291h.951a.749.749 0 0 0 .736-.63l.332-2.12a.742.742 0 0 0-.17-.6.745.745 0 0 0-.564-.26h-1.285V8.87c0-.252.024-.384.039-.433.003-.008.002-.012.002-.016.016-.011.104-.055.326-.088a7 7 0 0 1 .984-.05.746.746 0 0 0 .528-.218c.14-.139.217-.33.217-.527V5.76a.747.747 0 0 0-.586-.729c-2.04-.438-3.433-.083-4.278.75-.818.807-.968 1.884-.968 2.543v.983H7.027a.744.744 0 0 0-.525.22.743.743 0 0 0-.219.526v2.119c0 .197.08.386.219.525.14.14.328.221.525.221h1.118v3.291c-2.681-.809-4.659-3.25-4.659-6.197a6.523 6.523 0 0 1 6.524-6.526Z"/></svg>\n',googleDriveIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7.666 3a.736.736 0 0 0-.371.1.748.748 0 0 0-.275.267l-4.918 8.397a.743.743 0 0 0-.006.744l2.46 4.318a.747.747 0 0 0 .65.377h9.606a.754.754 0 0 0 .65-.377l2.46-4.318a.74.74 0 0 0 .002-.735l-4.688-8.392a.754.754 0 0 0-.654-.38H7.666Zm1.285 1.492h3.195l3.854 6.9h-3.1l-3.949-6.9Zm-1.293.742L9.223 7.97l-4.016 6.988-1.6-2.813 4.051-6.91Zm2.424 4.237 1.098 1.922H8.977l1.105-1.922ZM8.12 12.885h7.87L14.38 15.71H6.494l1.625-2.826Z"/></svg>\n',googlePhotosIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9.258 3.082c0-.594.486-1.082 1.08-1.082a4.38 4.38 0 0 1 4.239 5.489c-.18.688-.633 1.245-1.109 1.767h3.468c.595 0 1.082.488 1.082 1.082a4.382 4.382 0 0 1-5.49 4.24v-.001c-.689-.18-1.246-.633-1.768-1.109v3.468c0 .595-.487 1.082-1.082 1.082a4.384 4.384 0 0 1-4.111-2.866 4.382 4.382 0 0 1-.125-2.624c.18-.689.632-1.246 1.108-1.768H3.082A1.085 1.085 0 0 1 2 9.68a4.382 4.382 0 0 1 5.49-4.238c.69.18 1.246.632 1.768 1.108V3.082Zm3.164 1.32c-.435-.46-1.043-.667-1.662-.767v5.49c.619-.1 1.227-.307 1.662-.766a2.875 2.875 0 0 0 0-3.958ZM7.21 6.918a2.876 2.876 0 0 0-2.93.789c-.396.423-.569.983-.658 1.55h5.56c-.045-.295-.091-.59-.224-.859a2.879 2.879 0 0 0-1.748-1.48Zm9.254 3.841h-5.653l.013.1c.012.098.025.197.053.292a2.873 2.873 0 0 0 4.862 1.158 2.87 2.87 0 0 0 .398-.54v-.001c.111-.195.2-.403.263-.619.026-.092.038-.188.05-.283l.014-.107Zm-8.872 4.86c.437.459 1.045.666 1.665.766V10.89c-1.369.222-2.456 1.314-2.456 2.747 0 .738.283 1.447.791 1.981Z"/></svg>\n',linkIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.748 2a4.622 4.622 0 0 0-3.174 1.362L8.02 4.915a.783.783 0 0 0 .002 1.11.786.786 0 0 0 1.11 0l1.55-1.553c1.185-1.185 3.024-1.195 4.116-.104l.851.854c1.092 1.091 1.083 2.927-.101 4.11l-1.555 1.554a.787.787 0 0 0 .557 1.34.78.78 0 0 0 .553-.23l1.554-1.552c1.758-1.757 1.838-4.597.102-6.332l-.854-.853A4.31 4.31 0 0 0 12.748 2Zm-.488 4.973a.78.78 0 0 0-.553.23L7.2 11.71l-.004.002a.784.784 0 0 0 1.11 1.107l.003-.002 4.504-4.505a.785.785 0 0 0-.554-1.339Zm-6.79.815a.791.791 0 0 0-.554.234L3.36 9.573c-1.757 1.758-1.836 4.597-.101 6.332l.853.852c1.736 1.734 4.572 1.655 6.33-.102l1.547-1.547.006-.008a.777.777 0 0 0 .244-.554.782.782 0 0 0-.799-.797.774.774 0 0 0-.56.248l-1.545 1.547c-1.184 1.184-3.021 1.195-4.113.104l-.854-.854c-1.091-1.091-1.083-2.927.102-4.111l1.552-1.555a.787.787 0 0 0 .233-.555.79.79 0 0 0-.06-.3.793.793 0 0 0-.173-.253s-.104-.14-.183-.185c-.051-.03-.133-.047-.37-.047Z"/></svg>\n',oneDriveIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.223 5.001a5.277 5.277 0 0 0-4.408 2.258c-3.224.423-4.908 4.123-3.032 6.814l.004.008.002.004c.48.627 1.712 1.84 3.588 1.84h7.936c.667 0 1.32-.179 1.894-.522a3.838 3.838 0 0 0 1.381-1.46v-.005c1.13-2.16-.133-4.777-2.488-5.298-.617-1.853-2.177-3.242-4.111-3.565a5.273 5.273 0 0 0-.766-.074Zm-.092 1.5c.078 0 .154.001.23.008.077.004.154.014.231.021l.226.035a5.203 5.203 0 0 1 .45.116 3.31 3.31 0 0 1 .433.166 4.079 4.079 0 0 1 .606.348 4.195 4.195 0 0 1 .37.293 3.54 3.54 0 0 1 .33.348 3.517 3.517 0 0 1 .505.778 3.182 3.182 0 0 0-.42.117c-.082.03-.164.06-.244.094l-1.49.627-2.686-1.61a4.39 4.39 0 0 0-1.002-.445c.015-.01.032-.026.047-.039a3.744 3.744 0 0 1 .4-.289 3.713 3.713 0 0 1 .424-.23 3.02 3.02 0 0 1 .219-.094c.074-.03.15-.053.225-.076a3.77 3.77 0 0 1 .222-.06c.077-.02.157-.035.233-.05.075-.015.15-.025.228-.033.077-.007.154-.015.233-.02.078-.003.154-.005.23-.005Zm-3.8 2.193h.003c.54.001 1.111.156 1.551.428l1.783 1.07-5.867 2.471c-.535-1.29-.15-2.788 1.059-3.537l.007-.004c.441-.271.946-.42 1.463-.428Zm7.974 1.33.152.008c.086.008.173.018.258.033a1.956 1.956 0 0 1 .477.145 2.179 2.179 0 0 1 .918.756c.046.066.09.133.127.2a2.284 2.284 0 0 1 .269.919c.004.081.008.165.002.248-.003.055-.012.111-.02.166l-3.507-2.102.459-.193.015-.008a2.118 2.118 0 0 1 .41-.125 2.297 2.297 0 0 1 .44-.047Zm-3.008 1.112 4.506 2.699a2.217 2.217 0 0 1-.338.26 2.228 2.228 0 0 1-.668.275c-.078.019-.157.03-.24.04-.081.007-.164.015-.246.015H6.373c-.057 0-.113-.001-.168-.004a1.904 1.904 0 0 1-.164-.016l-.154-.023c-.051-.008-.102-.014-.15-.026a2.942 2.942 0 0 1-.77-.3 2.889 2.889 0 0 1-.21-.133c-.012-.008-.019-.016-.03-.024l6.57-2.763Z"/></svg>\n',UploadcareSource;function getTranslation(e,t,n){const i=e.t,r=e.t;switch(t){case UploadcareSource.Local:return{text:r("Insert"===n?"Upload from computer":"Replace from computer"),shortText:r("From computer")};case UploadcareSource.URL:return{text:"Insert"===n?r("Insert via URL"):i("Replace via URL"),shortText:r("Via URL")};case UploadcareSource.Dropbox:return{text:i("Insert"===n?"Insert with Dropbox":"Replace with Dropbox"),shortText:i("With Dropbox")};case UploadcareSource.Facebook:return{text:i("Insert"===n?"Insert with Facebook":"Replace with Facebook"),shortText:i("With Facebook")};case UploadcareSource.GDrive:return{text:i("Insert"===n?"Insert with Google Drive":"Replace with Google Drive"),shortText:i("With Google Drive")};case UploadcareSource.GPhotos:return{text:i("Insert"===n?"Insert with Google Photos":"Replace with Google Photos"),shortText:i("With Google Photos")};case UploadcareSource.OneDrive:return{text:i("Insert"===n?"Insert with OneDrive":"Replace with OneDrive"),shortText:i("With OneDrive")};default:return t}}!function(e){e.Local="local",e.URL="url",e.Dropbox="dropbox",e.GDrive="gdrive",e.Facebook="facebook",e.GPhotos="gphotos",e.OneDrive="onedrive"}(UploadcareSource||(UploadcareSource={}));class UploadcareUI extends Plugin{static get pluginName(){return"UploadcareUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){this.licenseKey=this.editor.config.get("licenseKey");const e=this.editor;this._licenseKeyCheckInterval=setInterval((()=>{let t;for(const n in e){const i=n,r=e[i];if("uploadcareLicenseKeyValid"==r||"uploadcareLicenseKeyInvalid"==r||"uploadcareLicenseKeyExpired"==r||"uploadcareLicenseKeyDomainLimit"==r||"uploadcareLicenseKeyNotAllowed"==r||"uploadcareLicenseKeyEvaluationLimit"==r||"uploadcareLicenseKeyTrialLimit"==r||"uploadcareLicenseKeyUsageLimit"==r){delete e[i],t=r,clearInterval(this._licenseKeyCheckInterval),this._licenseKeyCheckInterval=void 0;break}}"uploadcareLicenseKeyInvalid"==t&&e._showLicenseError("invalid"),"uploadcareLicenseKeyExpired"==t&&e._showLicenseError("expired"),"uploadcareLicenseKeyDomainLimit"==t&&e._showLicenseError("domainLimit"),"uploadcareLicenseKeyNotAllowed"==t&&e._showLicenseError("featureNotAllowed","Uploadcare"),"uploadcareLicenseKeyEvaluationLimit"==t&&e._showLicenseError("evaluationLimit"),"uploadcareLicenseKeyTrialLimit"==t&&e._showLicenseError("trialLimit"),"uploadcareLicenseKeyUsageLimit"==t&&e._showLicenseError("usageLimit")}),1e3)}afterInit(){const{editor:e}=this,t=e.commands.get("uploadcare");if(!t)return;const n=this._normalizeConfigSourceList(e.config.get("uploadcare.uploader.sourceList")).reduce(((e,t)=>{const n=this._getIntegrationKey(t.type);return e[n]||(e[n]=[]),e[n].push(t),e}),{});e.plugins.has("ImageInsertUI")&&e.commands.get("uploadcare")&&Object.entries(n).forEach((([n,i])=>{e.plugins.get("ImageInsertUI").registerIntegration({name:n,observable:()=>t,buttonViewCreator:()=>this._createToolbarButton(i),formViewCreator:()=>this._createDropdownButtons(i),menuBarButtonViewCreator:()=>this._createMenuBarButtons(i),override:"assetManager"!==n})}))}destroy(){super.destroy(),this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_normalizeConfigSourceList(e){const{locale:t}=this.editor;return e.map((e=>{const n=getTranslation(t,e,"Insert");switch(e){case UploadcareSource.Local:return{icon:_0x42409c.imageUpload,type:UploadcareSource.Local,...n};case UploadcareSource.URL:return{icon:linkIcon,type:UploadcareSource.URL,...n};case UploadcareSource.Dropbox:return{icon:dropboxIcon,type:UploadcareSource.Dropbox,...n};case UploadcareSource.Facebook:return{icon:facebookIcon,type:UploadcareSource.Facebook,...n};case UploadcareSource.GDrive:return{icon:googleDriveIcon,type:UploadcareSource.GDrive,...n};case UploadcareSource.GPhotos:return{icon:googlePhotosIcon,type:UploadcareSource.GPhotos,...n};case UploadcareSource.OneDrive:return{icon:oneDriveIcon,type:UploadcareSource.OneDrive,...n}}}))}_getIntegrationKey(e){switch(e){case UploadcareSource.Local:return"upload";case UploadcareSource.URL:return"url";default:return"assetManager"}}_createButton(e,t){const n=this.editor,i=new e(n.locale),r=n.commands.get("uploadcare");return i.bind("isEnabled").to(r),i.on("execute",(()=>{r.execute(t)})),i}_createToolbarButton(e){const{locale:t}=this.editor,n=this.editor.plugins.get("ImageInsertUI"),i=e[0],r=this._createButton(ButtonView,i.type);return r.icon=i.icon,r.bind("label").to(n,"isImageSelected",(e=>getTranslation(t,i.type,e?"Replace":"Insert").text)),r.tooltip=!0,r}_createDropdownButtons(e){const{locale:t}=this.editor,n=this.editor.plugins.get("ImageInsertUI");return e.map((e=>{const i=this._createButton(ButtonView,e.type);return i.withText=!0,i.icon=e.icon,i.bind("label").to(n,"isImageSelected",(n=>getTranslation(t,e.type,n?"Replace":"Insert").text)),i}))}_createMenuBarButtons(e){return e.map((e=>{const t=this._createButton(MenuBarMenuListItemButtonView,e.type);return t.icon=e.icon,t.label=e.shortText,t}))}}class DialogFocusManagerView extends View{constructor(e){super(e),this.focusTracker=new FocusTracker,this.focusCycler=new FocusCycler({focusables:this.createCollection(),focusTracker:this.focusTracker})}getFocusableElement(){return{tag:"div",attributes:{"aria-hidden":"true",tabindex:"0"},on:{focus:this.bindTemplate.to((()=>{this.focusCycler.fire("forwardCycle")}))}}}}class UploadcareFormView extends DialogFocusManagerView{constructor(e){super(e),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all-excluded","ck-uploadcare-form"],tabindex:"-1"},children:[{tag:"uc-file-uploader-inline",attributes:{class:["uc-light","ck-uploadcare-theme"],"ctx-name":"uploader"}},this.getFocusableElement()]})}focus(){this.element.focus()}}function createEditabilityChecker(e){const t=createUrlChecker(e);return e=>!(!e||!e.is("element","imageBlock")&&!e.is("element","imageInline"))&&(!!e.hasAttribute("uploadcareImageId")||!!e.hasAttribute("src")&&t(e.getAttribute("src")))}function getImageUrls(e,t){const n=[320,480,768,1024,1200,1600,1920,2400].filter((e=>e<=t)).map((t=>e.replace(/\/$/,"")+"/-/resize/"+t+"x/ "+t+"w"));return{imageFallbackUrl:e,imageSources:[{srcset:n.join(", "),sizes:"(max-width: "+t+"px) 100vw, "+t+"px",type:"image/webp"}]}}function getImageDimension(e,t,n){const i=e.match(/\/crop\/(\d+)x(\d+)\//);return{width:i?parseInt(i[1],10):t,height:i?parseInt(i[2],10):n}}function showImageProcessingIndicator(e,t){const n=Object.create(DomEmitterMixin),i=e.plugins.get("ImageUtils"),r=e.editing.mapper.toViewElement(t),s=i.findViewImgElement(r),o=e.editing.view.domConverter.viewToDom(s),a=t.getAttribute("width"),l=t.getAttribute("height"),c="image-processing";e.editing.view.change((e=>{e.addClass(c,r),e.setStyle("aspect-ratio",a+"/"+l,s)})),n.listenTo(o,"load",(()=>{n.stopListening(o,"load"),e.editing.view.change((e=>{e.removeClass(c,r),e.removeStyle("aspect-ratio",s)}))}))}function createUrlChecker(e){if(Array.isArray(e)){const t=e.map(createUrlChecker);return e=>t.some((t=>t(e)))}if("origin"==e){const e=_0x49a38d.window.location.origin;return t=>new URL(t,_0x49a38d.document.baseURI).origin==e}return"function"==typeof e?e:e instanceof RegExp?t=>!(!t.match(e)&&!t.replace(/^https?:\/\//,"").match(e)):()=>!1}function isAncestor(e,t){return getAncestors(e.target).includes(t)}class UploadcareController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n){super(),this._type=null,this._formView=null,this._editor=e,this._editing=t,this._dialog=e.plugins.get(Dialog),this._api=t.ctxElement.getAPI(),this._type=n,this._editing.configElement.setAttribute("source-list",this._type),this._initDialog(),this._initListeners(),this._api.initFlow()}destroy(){this._formView&&(this._formView.destroy(),this._formView=null),this._api&&this._api.doneFlow(),this.stopListening(),this.stopDelegating()}_initDialog(){const{locale:e,model:t}=this._editor,n=t.document.selection.getSelectedElement(),i=n&&(n.is("element","imageBlock")||n.is("element","imageInline"));this._formView=new UploadcareFormView(e),this._dialog.show({id:"uploadCare",icon:_0x42409c.imageUpload,title:getTranslation(e,this._type,i?"Replace":"Insert").text,content:this._formView,position:DialogViewPosition.EDITOR_TOP_CENTER,isModal:!0,onShow:()=>{this._formView.focus()},onHide:()=>{this._api.removeAllFiles(),this._editor.editing.view.focus(),this.destroy()},keystrokeHandlerOptions:{filter:e=>!isAncestor(e,this._formView.element)}})}_initListeners(){this._editing.ctxElement.addEventListener("done-click",(()=>{const{allEntries:e}=this._api.getOutputCollectionState();this._editor.model.change((t=>{const n=e.length;for(const i of e){const r=i===e[n-1],{cdnUrl:s,fileInfo:o}=i;if(!s||!o)continue;const{width:a,height:l}=o.imageInfo,c=getImageDimension(s,a,l),d=getImageUrls(s,c.width),u={id:o.uuid,type:"image",attributes:{imageDimension:c,...d}};this._insertAsset(u,r,t)}})),this._dialog.hide()})),this._editing.ctxElement.addEventListener("change",(e=>{"idle"===e.detail.status&&!e.detail.allEntries.length&&this._dialog.isOpen&&(this._type===UploadcareSource.Local?this._api.setCurrentActivity(UploadcareSource.Local):this._api.initFlow())}))}_insertAsset(e,t,n){const i=this._editor.model.document.selection,r=i.getSelectedElement(),s=!(!r||!r.is("element","imageInline"));n.removeSelectionAttribute("linkHref"),this._insertImage(e,s),t||n.setSelection(i.getLastPosition())}_insertImage(e,t){const n=this._editor,{imageDimension:i,imageFallbackUrl:r,imageSources:s}=e.attributes;n.execute("insertImage",{imageType:t?"imageInline":null,source:{uploadcareImageId:e.id,src:r,sources:s,...i}})}}class UploadcareCommand extends _0x338ed0{static get requires(){return[Dialog,UploadcareEditing]}constructor(e){super(e),this._controller=null,this._editing=e.plugins.get(UploadcareEditing)}refresh(){this.isEnabled=this._checkEnabled()}execute(e){this._controller&&(this._controller.destroy(),this._controller=null),this._controller=new UploadcareController(this.editor,this._editing,e)}_checkEnabled(){return this.editor.commands.get("insertImage").isEnabled}}function isObject$1(e){return"[object Object]"===Object.prototype.toString.call(e)}const SEPARATOR$1=/\W|_/g;function camelizeString$1(e){return e.split(SEPARATOR$1).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join("")}function camelizeArrayItems$1(e,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(e)?e.map((e=>camelizeKeys$1(e,{ignoreKeys:t}))):e}function camelizeKeys$1(e,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(e))return camelizeArrayItems$1(e,{ignoreKeys:t});if(!isObject$1(e))return e;const n={};for(const i of Object.keys(e)){let r=e[i];t.includes(i)?n[i]=r:(isObject$1(r)?r=camelizeKeys$1(r,{ignoreKeys:t}):Array.isArray(r)&&(r=camelizeArrayItems$1(r,{ignoreKeys:t})),n[camelizeString$1(i)]=r)}return n}const delay$1=e=>new Promise((t=>setTimeout(t,e)));function getUserAgent$1$1({libraryName:e,libraryVersion:t,userAgent:n,publicKey:i="",integration:r=""}){const s="JavaScript";return"string"==typeof n?n:"function"==typeof n?n({publicKey:i,libraryName:e,libraryVersion:t,languageName:s,integration:r}):[e,t,i].filter(Boolean).join("/")+" ("+[s,r].filter(Boolean).join("; ")+")"}const defaultOptions$1={factor:2,time:100};function retrier$1(e,t=defaultOptions$1){let n=0;return function e(i){const r=Math.round(t.time*t.factor**n);return i({attempt:n,retry:t=>delay$1(t??r).then((()=>(n+=1,e(i))))})}(e)}let UploadcareError$1=class extends Error{},NetworkError$1=class e extends UploadcareError$1{originalProgressEvent;constructor(t){super(),this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,e.prototype),this.originalProgressEvent=t}};const onCancel$1=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))};let CancelError$1=class e extends UploadcareError$1{isCancel=!0;constructor(t="Request canceled"){super(t),this.name="CancelError",Object.setPrototypeOf(this,e.prototype)}};const DEFAULT_INTERVAL$1=500,poll$1=({check:e,interval:t=DEFAULT_INTERVAL$1,timeout:n,signal:i})=>new Promise(((r,s)=>{let o,a;onCancel$1(i,(()=>{o&&clearTimeout(o),s(new CancelError$1("Poll cancelled"))})),n&&(a=setTimeout((()=>{o&&clearTimeout(o),s(new CancelError$1("Timed out"))}),n));const l=()=>{try{Promise.resolve(e(i)).then((e=>{e?(a&&clearTimeout(a),r(e)):o=setTimeout(l,t)})).catch((e=>{a&&clearTimeout(a),s(e)}))}catch(e){a&&clearTimeout(a),s(e)}};o=setTimeout(l,0)})),defaultSettings$1={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:4,pusherKey:"79ae88bd931ea68464d9"},defaultContentType$1="application/octet-stream",defaultFilename$1="original",request$1=({method:e,url:t,data:n,headers:i={},signal:r,onProgress:s})=>new Promise(((o,a)=>{const l=new XMLHttpRequest,c=e?.toUpperCase()||"GET";let d=!1;l.open(c,t,!0),i&&Object.entries(i).forEach((e=>{const[t,n]=e;void 0!==n&&!Array.isArray(n)&&l.setRequestHeader(t,n)})),l.responseType="text",onCancel$1(r,(()=>{d=!0,l.abort(),a(new CancelError$1)})),l.onload=()=>{if(200!=l.status)a(new Error("Error "+l.status+": "+l.statusText));else{const e={method:c,url:t,data:n,headers:i||void 0,signal:r,onProgress:s},a=l.getAllResponseHeaders().trim().split(/[\r\n]+/),d={};a.forEach((function(e){const t=e.split(": "),n=t.shift(),i=t.join(": ");n&&void 0!==n&&(d[n]=i)}));const u=l.response,h=l.status;o({request:e,data:u,headers:d,status:h})}},l.onerror=e=>{d||a(new NetworkError$1(e))},s&&"function"==typeof s&&(l.upload.onprogress=e=>{e.lengthComputable?s({isComputable:!0,value:e.loaded/e.total}):s({isComputable:!1})}),n?l.send(n):l.send()}));function identity$1(e,...t){return e}const getFileOptions$1=({name:e})=>e?[e]:[],transformFile$1=identity$1;var getFormData$1=()=>new FormData;const isBuffer$1=e=>!1,isBlob$1=e=>"undefined"!=typeof Blob&&e instanceof Blob,isFile$1=e=>"undefined"!=typeof File&&e instanceof File,isReactNativeAsset$1=e=>!!e&&"object"==typeof e&&!Array.isArray(e)&&"uri"in e&&"string"==typeof e.uri,isFileData$1=e=>isBlob$1(e)||isFile$1(e)||isBuffer$1()||isReactNativeAsset$1(e),isSimpleValue$1=e=>"string"==typeof e||"number"==typeof e||void 0===e,isObjectValue$1=e=>!!e&&"object"==typeof e&&!Array.isArray(e),isFileValue$1=e=>!!e&&"object"==typeof e&&"data"in e&&isFileData$1(e.data);function collectParams$1(e,t,n){if(Array.isArray(n))for(const i of n)collectParams$1(e,t+"[]",i);else if(isFileValue$1(n)){const{name:i,contentType:r}=n,s=transformFile$1(n.data,i,r??defaultContentType$1),o=getFileOptions$1({name:i});e.push([t,s,...o])}else if(isObjectValue$1(n))for(const[i,r]of Object.entries(n))void 0!==r&&e.push([t+"["+i+"]",String(r)]);else isSimpleValue$1(n)&&n&&e.push([t,n.toString()])}function getFormDataParams$1(e){const t=[];for(const[n,i]of Object.entries(e))collectParams$1(t,n,i);return t}function buildFormData$1(e){const t=getFormData$1(),n=getFormDataParams$1(e);for(const e of n){const[n,i,...r]=e;t.append(n,i,...r)}return t}let UploadError$1=class e extends UploadcareError$1{code;request;response;headers;constructor(t,n,i,r,s){super(),this.name="UploadError",this.message=t,this.code=n,this.request=i,this.response=r,this.headers=s,Object.setPrototypeOf(this,e.prototype)}};const buildSearchParams$1=e=>{const t=new URLSearchParams;for(const[n,i]of Object.entries(e))i&&"object"==typeof i&&!Array.isArray(i)?Object.entries(i).filter((e=>e[1]??!1)).forEach((e=>t.set(n+"["+e[0]+"]",String(e[1])))):Array.isArray(i)?i.forEach((e=>{t.append(n+"[]",e)})):"string"==typeof i&&i?t.set(n,i):"number"==typeof i&&t.set(n,i.toString());return t.toString()},getUrl$1=(e,t,n)=>{const i=new URL(e);return i.pathname=(i.pathname+t).replace("//","/"),n&&(i.search=buildSearchParams$1(n)),i.toString()};var version$1="6.14.1";const LIBRARY_NAME$1="UploadcareUploadClient",LIBRARY_VERSION$1=version$1;function getUserAgent$2(e){return getUserAgent$1$1({libraryName:LIBRARY_NAME$1,libraryVersion:LIBRARY_VERSION$1,...e})}const REQUEST_WAS_THROTTLED_CODE$1="RequestThrottledError",DEFAULT_RETRY_AFTER_TIMEOUT$1=15e3,DEFAULT_NETWORK_ERROR_TIMEOUT$1=1e3;function getTimeoutFromThrottledRequest$1(e){const{headers:t}=e||{};if(!t||"string"!=typeof t["retry-after"])return DEFAULT_RETRY_AFTER_TIMEOUT$1;const n=parseInt(t["retry-after"],10);return Number.isFinite(n)?1e3*n:DEFAULT_RETRY_AFTER_TIMEOUT$1}function retryIfFailed$1(e,t){const{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:i}=t;return retrier$1((({attempt:t,retry:r})=>e().catch((e=>{if("response"in e&&e?.code===REQUEST_WAS_THROTTLED_CODE$1&&t<n)return r(getTimeoutFromThrottledRequest$1(e));if(e instanceof NetworkError$1&&t<i)return r((t+1)*DEFAULT_NETWORK_ERROR_TIMEOUT$1);throw e}))))}const getContentType$1=e=>{let t="";return(isBlob$1(e)||isFile$1(e)||isReactNativeAsset$1(e))&&(t=e.type),t||defaultContentType$1},getFileName$1=e=>{let t="";return isFile$1(e)&&e.name?t=e.name:isBlob$1(e)||isBuffer$1()?t="":isReactNativeAsset$1(e)&&e.name&&(t=e.name),t||defaultFilename$1};function getStoreValue$1(e){return"auto"}function base$1(e,{publicKey:t,fileName:n,contentType:i,baseURL:r=defaultSettings$1.baseURL,secureSignature:s,secureExpire:o,store:a,signal:l,onProgress:c,source:d="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings$1.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed$1((()=>request$1({method:"POST",url:getUrl$1(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:u,userAgent:h})},data:buildFormData$1({file:{data:e,name:n||getFileName$1(e),contentType:i||getContentType$1(e)},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:getStoreValue$1(),signature:s,expire:o,source:d,metadata:p}),signal:l,onProgress:c}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i)throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}var TypeEnum$1,Status$1;function fromUrl$1(e,{publicKey:t,baseURL:n=defaultSettings$1.baseURL,store:i,fileName:r,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:c="url",signal:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings$1.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed$1((()=>request$1({method:"POST",headers:{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:u,userAgent:h})},url:getUrl$1(n,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:getStoreValue$1(),filename:r,check_URL_duplicates:s?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:c,metadata:p}),signal:d}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i)throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}!function(e){e.Token="token",e.FileInfo="file_info"}(TypeEnum$1||(TypeEnum$1={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(Status$1||(Status$1={}));const isErrorResponse$1=e=>"status"in e&&e.status===Status$1.Error;function fromUrlStatus$1(e,{publicKey:t,baseURL:n=defaultSettings$1.baseURL,signal:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=defaultSettings$1.retryNetworkErrorMaxTimes}={}){return retryIfFailed$1((()=>request$1({method:"GET",headers:t?{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:r,userAgent:s})}:void 0,url:getUrl$1(n,"/from_url/status/",{jsonerrors:1,token:e}),signal:i}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i&&!isErrorResponse$1(i))throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}function info$1(e,{publicKey:t,baseURL:n=defaultSettings$1.baseURL,signal:i,source:r,integration:s,userAgent:o,retryThrottledRequestMaxTimes:a=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=defaultSettings$1.retryNetworkErrorMaxTimes}){return retryIfFailed$1((()=>request$1({method:"GET",headers:{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:s,userAgent:o})},url:getUrl$1(n,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:r}),signal:i}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i)throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function multipartStart$1(e,{publicKey:t,contentType:n,fileName:i,multipartChunkSize:r=defaultSettings$1.multipartChunkSize,baseURL:s="",secureSignature:o,secureExpire:a,store:l,signal:c,source:d="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings$1.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed$1((()=>request$1({method:"POST",url:getUrl$1(s,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:u,userAgent:h})},data:buildFormData$1({filename:i||defaultFilename$1,size:e,content_type:n||defaultContentType$1,part_size:r,UPLOADCARE_STORE:getStoreValue$1(),UPLOADCARE_PUB_KEY:t,signature:o,expire:a,source:d,metadata:p}),signal:c}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i)throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i.parts=Object.keys(i.parts).map((e=>i.parts[Number(e)])),i}))),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g})}function multipartUpload$1(e,t,{contentType:n,signal:i,onProgress:r,retryThrottledRequestMaxTimes:s=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=defaultSettings$1.retryNetworkErrorMaxTimes}){return retryIfFailed$1((()=>request$1({method:"PUT",url:t,data:e,onProgress:r,signal:i,headers:{"Content-Type":n||defaultContentType$1}}).then((e=>(r&&r({isComputable:!0,value:1}),e))).then((({status:e})=>({code:e})))),{retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o})}function multipartComplete$1(e,{publicKey:t,baseURL:n=defaultSettings$1.baseURL,source:i="local",signal:r,integration:s,userAgent:o,retryThrottledRequestMaxTimes:a=defaultSettings$1.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=defaultSettings$1.retryNetworkErrorMaxTimes}){return retryIfFailed$1((()=>request$1({method:"POST",url:getUrl$1(n,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent$2({publicKey:t,integration:s,userAgent:o})},data:buildFormData$1({uuid:e,UPLOADCARE_PUB_KEY:t,source:i}),signal:r}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys$1(JSON.parse(e));if("error"in i)throw new UploadError$1(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function isReadyPoll$1(e,{publicKey:t,baseURL:n,source:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:l,onProgress:c}){return poll$1({check:l=>info$1(e,{publicKey:t,baseURL:n,signal:l,source:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then((e=>e.isReady?e:(c&&c({isComputable:!0,value:1}),!1))),signal:l})}function isGroupFileInfo$1(e){return"defaultEffects"in e}let UploadcareFile$1=class{uuid;name=null;size=null;isStored=null;isImage=null;mimeType=null;cdnUrl=null;s3Url=null;originalFilename=null;imageInfo=null;videoInfo=null;contentInfo=null;metadata=null;s3Bucket=null;defaultEffects=null;constructor(e,{baseCDN:t=defaultSettings$1.baseCDN,fileName:n}={}){const{uuid:i,s3Bucket:r}=e,s=getUrl$1(t,i+"/"),o=r?getUrl$1("https://"+r+".s3.amazonaws.com/",i+"/"+e.filename):null;this.uuid=i,this.name=n||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=s,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=r||null,this.s3Url=o,isGroupFileInfo$1(e)&&(this.defaultEffects=e.defaultEffects)}};const uploadDirect$1=(e,{publicKey:t,fileName:n,baseURL:i,secureSignature:r,secureExpire:s,store:o,contentType:a,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,baseCDN:p,metadata:f})=>base$1(e,{publicKey:t,fileName:n,contentType:a,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,metadata:f}).then((({file:e})=>isReadyPoll$1(e,{publicKey:t,baseURL:i,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,onProgress:c,signal:l}))).then((e=>new UploadcareFile$1(e,{baseCDN:p}))),uploadFromUploaded$1=(e,{publicKey:t,fileName:n,baseURL:i,signal:r,onProgress:s,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d,baseCDN:u})=>info$1(e,{publicKey:t,baseURL:i,signal:r,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d}).then((e=>new UploadcareFile$1(e,{baseCDN:u,fileName:n}))).then((e=>(s&&s({isComputable:!0,value:1}),e))),race$1=(e,{signal:t}={})=>{let n=null,i=null;const r=e.map((()=>new AbortController));return onCancel$1(t,(()=>{r.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const s=(o=t,()=>{i=o,r.forEach(((e,t)=>t!==o&&e.abort()))});var o;return Promise.resolve().then((()=>e({stopRace:s,signal:r[t].signal}))).then((e=>(s(),e))).catch((e=>(n=e,null)))}))).then((e=>{if(null===i)throw n;return e[i]}))};var WebSocket$1=window.WebSocket;let Events$1=class{events=Object.create({});emit(e,t){this.events[e]?.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}};const response$1=(e,t)=>"success"===e?{status:Status$1.Success,...t}:"progress"===e?{status:Status$1.Progress,...t}:{status:Status$1.Error,...t};let Pusher$1=class{key;disconnectTime;ws=void 0;queue=[];isConnected=!1;subscribers=0;emmitter=new Events$1;disconnectTimeoutId=null;constructor(e,t=3e4){this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e="wss://ws.pusherapp.com/app/"+this.key+"?protocol=5&client=js&version=1.12.2";this.ws=new WebSocket$1(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,response$1(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){const n=JSON.stringify({event:e,data:t});this.ws?.send(n)}subscribe(e,t){this.subscribers+=1,this.connect();const n="task-status-"+e,i={event:"pusher:subscribe",data:{channel:n}};this.emmitter.on(n,t),this.isConnected?this.send(i.event,i.data):this.queue.push(i)}unsubscribe(e){this.subscribers-=1;const t="task-status-"+e,n={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(n.event,n.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}},pusher$1=null;const getPusher$1=e=>{if(!pusher$1){const t="undefined"==typeof window?0:3e4;pusher$1=new Pusher$1(e,t)}return pusher$1},preconnect$1=e=>{getPusher$1(e).connect()};function pollStrategy$1({token:e,publicKey:t,baseURL:n,integration:i,userAgent:r,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o,onProgress:a,signal:l}){return poll$1({check:l=>fromUrlStatus$1(e,{publicKey:t,baseURL:n,integration:i,userAgent:r,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o,signal:l}).then((t=>{switch(t.status){case Status$1.Error:return new UploadError$1(t.error,t.errorCode);case Status$1.Waiting:return!1;case Status$1.Unknown:return new UploadError$1('Token "'+e+'" was not found.');case Status$1.Progress:return a&&("unknown"===t.total?a({isComputable:!1}):a({isComputable:!0,value:t.done/t.total})),!1;case Status$1.Success:return a&&a({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:l})}const pushStrategy$1=({token:e,pusherKey:t,signal:n,onProgress:i})=>new Promise(((r,s)=>{const o=getPusher$1(t),a=o.onError(s),l=()=>{a(),o.unsubscribe(e)};onCancel$1(n,(()=>{l(),s(new CancelError$1("pusher cancelled"))})),o.subscribe(e,(e=>{switch(e.status){case Status$1.Progress:i&&("unknown"===e.total?i({isComputable:!1}):i({isComputable:!0,value:e.done/e.total}));break;case Status$1.Success:l(),i&&i({isComputable:!0,value:e.done/e.total}),r(e);break;case Status$1.Error:l(),s(new UploadError$1(e.msg,e.error_code))}}))})),uploadFromUrl$1=(e,{publicKey:t,fileName:n,baseURL:i,baseCDN:r,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,onProgress:u,source:h,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,pusherKey:f=defaultSettings$1.pusherKey,metadata:y})=>Promise.resolve(preconnect$1(f)).then((()=>fromUrl$1(e,{publicKey:t,fileName:n,baseURL:i,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,source:h,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,metadata:y}))).catch((e=>{const t=getPusher$1(f);return t?.disconnect(),Promise.reject(e)})).then((e=>e.type===TypeEnum$1.FileInfo?e:race$1([({signal:n})=>pollStrategy$1({token:e.token,publicKey:t,baseURL:i,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,onProgress:u,signal:n}),({signal:t})=>pushStrategy$1({token:e.token,pusherKey:f,signal:t,onProgress:u})],{signal:d}))).then((e=>{if(e instanceof UploadError$1)throw e;return e})).then((e=>isReadyPoll$1(e.uuid,{publicKey:t,baseURL:i,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,onProgress:u,signal:d}))).then((e=>new UploadcareFile$1(e,{baseCDN:r}))),memo$1=new WeakMap,getBlobFromReactNativeAsset$1=async e=>{if(memo$1.has(e))return memo$1.get(e);const t=await fetch(e.uri).then((e=>e.blob()));return memo$1.set(e,t),t},getFileSize$1=async e=>{if(isFile$1(e)||isBlob$1(e))return e.size;if(isReactNativeAsset$1(e))return(await getBlobFromReactNativeAsset$1(e)).size;throw new Error("Unknown file type. Cannot determine file size.")},isMultipart$1=(e,t=defaultSettings$1.multipartMinFileSize)=>e>=t,isUuid$1=e=>{const t=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!isFileData$1(e)&&t.test(e)},isUrl$1=e=>{const t=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!isFileData$1(e)&&t.test(e)},runWithConcurrency$1=(e,t)=>new Promise(((n,i)=>{const r=[];let s=!1,o=t.length;const a=[...t],l=()=>{const e=t.length-a.length,c=a.shift();c&&c().then((t=>{s||(r[e]=t,o-=1,o?l():n(r))})).catch((e=>{s=!0,i(e)}))};for(let t=0;t<e;t++)l()})),sliceChunk$1=(e,t,n,i)=>{const r=i*t,s=Math.min(r+i,n);return e.slice(r,s)},prepareChunks$1=async(e,t,n)=>i=>sliceChunk$1(e,i,t,n),uploadPart$1=(e,t,{publicKey:n,contentType:i,onProgress:r,signal:s,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>multipartUpload$1(e,t,{contentType:i,onProgress:r,signal:s,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),uploadMultipart$1=async(e,{publicKey:t,fileName:n,fileSize:i,baseURL:r,secureSignature:s,secureExpire:o,store:a,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,contentType:p,multipartChunkSize:f=defaultSettings$1.multipartChunkSize,maxConcurrentRequests:y=defaultSettings$1.maxConcurrentRequests,baseCDN:b,metadata:O})=>{const w=i??await getFileSize$1(e);let v;const S=(e,t)=>{if(!c)return;v||(v=Array(e).fill(0));return n=>{var i;n.isComputable&&(v[t]=n.value,c({isComputable:!0,value:(i=v,i.reduce(((e,t)=>e+t),0)/e)}))}};return p||=getContentType$1(e),multipartStart$1(w,{publicKey:t,contentType:p,fileName:n||getFileName$1(e),baseURL:r,secureSignature:s,secureExpire:o,store:a,signal:l,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,metadata:O}).then((async({uuid:n,parts:i})=>{const r=await prepareChunks$1(e,w,f);return Promise.all([n,runWithConcurrency$1(y,i.map(((e,n)=>()=>uploadPart$1(r(n),e,{publicKey:t,contentType:p,onProgress:S(i.length,n),signal:l,integration:u,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g}))))])})).then((([e])=>multipartComplete$1(e,{publicKey:t,baseURL:r,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g}))).then((e=>e.isReady?e:isReadyPoll$1(e.uuid,{publicKey:t,baseURL:r,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,onProgress:c,signal:l}))).then((e=>new UploadcareFile$1(e,{baseCDN:b})))};async function uploadFile$1(e,{publicKey:t,fileName:n,baseURL:i=defaultSettings$1.baseURL,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:g,multipartMinFileSize:p,multipartChunkSize:f,maxConcurrentRequests:y,baseCDN:b=defaultSettings$1.baseCDN,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:w,pusherKey:v,metadata:S}){if(isFileData$1(e)){const O=await getFileSize$1(e);return isMultipart$1(O,p)?uploadMultipart$1(e,{publicKey:t,contentType:g,multipartChunkSize:f,fileSize:O,fileName:n,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,maxConcurrentRequests:y,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b,metadata:S}):uploadDirect$1(e,{publicKey:t,fileName:n,contentType:g,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b,metadata:S})}if(isUrl$1(e))return uploadFromUrl$1(e,{publicKey:t,fileName:n,baseURL:i,baseCDN:b,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:w,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,pusherKey:v,metadata:S});if(isUuid$1(e))return uploadFromUploaded$1(e,{publicKey:t,fileName:n,baseURL:i,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b});throw new TypeError('File uploading from "'+e+'" is not supported')}class UploadUtils{static upload({file:e,publicKey:t,signal:n,onProgress:i}){return uploadFile$1(e,{publicKey:t,store:"auto",signal:n,onProgress:i})}static getInfo(e,t){return info$1(e,t)}}class UploadcareUploadAdapter extends Plugin{static get requires(){return["ImageUploadEditing","ImageUploadProgress",FileRepository,UploadcareEditing]}static get pluginName(){return"UploadcareUploadAdapter"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}async afterInit(){const e=this.editor;e.config.get("uploadcare")&&(e.plugins.get(FileRepository).createUploadAdapter=t=>new Adapter(t,e),e.plugins.get("ImageUploadEditing").on("uploadComplete",((t,{imageElement:n,data:i})=>{e.model.change((e=>{e.setAttribute("uploadcareImageId",i.uploadcareImageId,n)}))})))}}class Adapter{constructor(e,t){this.loader=e,this.editor=t,this.controller=new AbortController}async upload(){const e=this.editor.t,t=this.editor.config.get("uploadcare.pubkey"),n=await this.loader.file;return UploadUtils.upload({file:n,publicKey:t,signal:this.controller.signal,onProgress:e=>{e&&e.isComputable&&(this.loader.uploadTotal=1,this.loader.uploaded=e.value)}}).then((async e=>{const{imageFallbackUrl:t,imageSources:n}=getImageUrls(e.cdnUrl,e.imageInfo.width);return{uploadcareImageId:e.uuid,default:t,sources:n}})).catch((()=>{const t=e("Cannot upload file:")+" "+n.name+".";return Promise.reject(t)}))}abort(){this.controller.abort()}}class UploadcareEditing extends Plugin{constructor(){super(...arguments),this._configElement=null,this._ctxElement=null}static get pluginName(){return"UploadcareEditing"}static get requires(){return["PictureEditing",UploadcareUploadAdapter,Dialog]}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get configElement(){return this._configElement}get ctxElement(){return this._ctxElement}init(){const e=this.editor;e.commands.add("uploadcare",new UploadcareCommand(e))}afterInit(){this._initSchema(),this._initConversion(),this._initConfig(),this._initCtx(),this._initImageProcessingIndicator(),this.listenTo(this.editor,"destroy",(()=>{this._configElement&&(this._configElement.remove(),this._configElement=null),this._ctxElement&&(this._ctxElement.remove(),this._ctxElement=null);const e=_0x49a38d.document.querySelector("input[uploadcare-file-input]");e&&e.remove()})),checkLicense(this)}_initSchema(){const e=this.editor.model.schema;e.isRegistered("imageBlock")&&e.extend("imageBlock",{allowAttributes:["uploadcareImageId"]}),e.isRegistered("imageInline")&&e.extend("imageInline",{allowAttributes:["uploadcareImageId"]})}_initConversion(){const e=this.editor;e.conversion.for("downcast").attributeToAttribute({model:"uploadcareImageId",view:"data-uc-image-id"}),e.conversion.for("upcast").elementToAttribute({model:{key:"uploadcareImageId",value:e=>e.getAttribute("data-uc-image-id")},view:{attributes:{"data-uc-image-id":/[a-zA-Z0-9\\-]+/}}});const t=e.commands.get("replaceImageSource");t&&this.listenTo(t,"cleanupImage",((e,[t,n])=>{t.removeAttribute("uploadcareImageId",n)}))}_initConfig(){const e=this.editor.config.get("uploadcare.uploader")||{},t=this.editor.config.get("uploadcare.pubkey")||"";this._configElement=createElement(_0x49a38d.document,"uc-config",{...e,pubkey:t,"ctx-name":"uploader",sourceList:"",imgOnly:"true",removeCopyright:"true",localeName:this.editor.locale.contentLanguage,externalSourcesEmbedCss:"\n\t\t\t\t.uc-dropdown-menu__popup { padding: 0; }\n\t\t\t\t.uc-dropdown-menu__popup-menu { gap: 0; }\n\t\t\t\t.uc-dropdown-menu__popup-footer { padding-top: 0; }\n\t\t\t\t.uc-dropdown-menu__separator { margin: 0; }\n\t\t\t"}),this._configElement.iconHrefResolver=e=>{if("closeMax"==e)return"#uc-icon-arrow-down"},_0x49a38d.document.body.appendChild(this._configElement)}_initCtx(){this._ctxElement=createElement(_0x49a38d.document,"uc-upload-ctx-provider",{"ctx-name":"uploader"}),_0x49a38d.document.body.appendChild(this._ctxElement)}_initImageProcessingIndicator(){const e=this.editor.commands.get("insertImage");e&&this.listenTo(e,"execute",(()=>{const e=this.editor.model.document.selection.getSelectedElement();e&&e.getAttribute("uploadcareImageId")&&this.editor.editing.view.once("render",(()=>{showImageProcessingIndicator(this.editor,e)}))}));const t=this.editor.commands.get("uploadcareImageReplace");t&&this.listenTo(t,"execute",(()=>{const e=this.editor.model.document.selection.getSelectedElement();e&&e.getAttribute("uploadcareImageId")&&this.editor.editing.view.once("render",(()=>{showImageProcessingIndicator(this.editor,e)}))}))}}async function checkLicense(e){const t=g([76,115,109,121,100,88,102,49,108,71,112,114,104,85,75,83,82,74,107,52,89,101,51,50,117,90,122,84,79,66,56,78,87,119,70,103,48,72,77,73,86,68,54,110,99,106,105,111,67,57,98,120,69,97,118,116,65,80,53,81,113,55]),n=window[g([68,97,116,101])][g([110,111,119])](),i=e[g([101,100,105,116,111,114])],r=new(window[g([80,114,111,109,105,115,101])])((e=>{i[g([111,110,99,101])](g([114,101,97,100,121]),e)})),s={[g([107,116,121])]:g([69,67]),[g([117,115,101])]:g([115,105,103]),[g([99,114,118])]:g([80,45,50,53,54]),[g([120])]:g([49,50,67,57,98,120,78,109,95,83,112,56,83,104,57,85,76,84,74,49,108,107,97,111,66,80,71,117,97,88,108,110,51,54,81,111,98,82,69,89,103,78,107]),[g([121])]:g([116,65,110,51,109,54,86,86,67,50,54,67,66,108,67,116,77,114,102,84,109,113,114,104,45,57,69,76,111,100,99,73,48,97,99,119,49,50,54,85,88,75,99]),[g([97,108,103])]:g([69,83,50,53,54])},o=i[g([99,111,110,102,105,103])][g([103,101,116])](g([108,105,99,101,110,115,101,75,101,121]));function a(e){const t=[new(window[g([80,114,111,109,105,115,101])])((e=>setTimeout(e,605900))),r[g([116,104,101,110])]((()=>new(window[g([80,114,111,109,105,115,101])])((e=>{let t=0;i[g([109,111,100,101,108])][g([111,110])](g([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),((n,i)=>{i[0][g([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&t++,504==t&&(e(),n[g([111,102,102])]())}))}))))];return window[g([80,114,111,109,105,115,101])][g([114,97,99,101])](t)[g([116,104,101,110])]((()=>e))}function l(e){return e[g([115,116,97,114,116,115,87,105,116,104])](g([101,121]))?JSON[g([112,97,114,115,101])](c(e)):null}function c(e){return window[g([97,116,111,98])](e[g([114,101,112,108,97,99,101])](/-/g,g([43]))[g([114,101,112,108,97,99,101])](/_/g,g([47])))}function d(e){let t=5381;function n(e){for(let n=0;n<e[g([108,101,110,103,116,104])];n++){const i=e[g([99,104,97,114,67,111,100,101,65,116])](n);t=(t<<5)+t+i,t&=t}}return function e(t){Array[g([105,115,65,114,114,97,121])](t)?t[g([102,111,114,69,97,99,104])](e):t&&typeof t==g([111,98,106,101,99,116])?Object[g([101,110,116,114,105,101,115])](t)[g([115,111,114,116])]()[g([102,111,114,69,97,99,104])]((([t,i])=>{n(t),e(i)})):n(window[g([83,116,114,105,110,103])](t))}(e),t>>>0}function u(e){return e[g([116,111,83,116,114,105,110,103])](16)[g([112,97,100,83,116,97,114,116])](8,g([48]))}function h(e){return e[g([115,112,108,105,116])]("")[g([114,101,118,101,114,115,101])]()[g([106,111,105,110])]("")}function m(){}function g(e){return e.map((e=>String.fromCharCode(e))).join("")}!function(e){const n=function(){const e=window[g([83,116,114,105,110,103])](window[g([112,101,114,102,111,114,109,97,110,99,101])][g([110,111,119])]())[g([114,101,112,108,97,99,101])](g([46]),"");let n=g([76]);for(let i=0;i<e[g([108,101,110,103,116,104])];i+=2){let r=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](i,i+2));r>=t[g([108,101,110,103,116,104])]&&(r-=t[g([108,101,110,103,116,104])]),n+=t[r]}return n}();i[n]=g([117,112,108,111,97,100,99,97,114,101,76,105,99,101,110,115,101,75,101,121])+e,e!=g([86,97,108,105,100])&&async function(){await r,i[g([109,111,100,101,108])][g([99,104,97,110,103,101])]=m,i[g([109,111,100,101,108])][g([101,110,113,117,101,117,101,67,104,97,110,103,101])]=m,i[g([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](g([109,111,100,101,108]))}()}(await async function(){let e,t=null,m=null;try{if(o==g([71,80,76]))return g([78,111,116,65,108,108,111,119,101,100]);if(e=function(){const e=o[g([115,112,108,105,116])](g([46]));if(3!=e[g([108,101,110,103,116,104])])return null;return function(e){const t=l(e);return t&&function(){const e=t[g([106,116,105])],n=window[g([112,97,114,115,101,73,110,116])](e[g([115,117,98,115,116,114,105,110,103])](e[g([108,101,110,103,116,104])]-8),16),i={...t,[g([106,116,105])]:e[g([115,117,98,115,116,114,105,110,103])](0,e[g([108,101,110,103,116,104])]-8)};return delete i[g([118,99])],d(i)==n}()?t:null}(e[1])}(),!e)return g([73,110,118,97,108,105,100]);e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])]&&(p=e[g([117,115,97,103,101,69,110,100,112,111,105,110,116])],f=e[g([106,116,105])],m=new(window[g([80,114,111,109,105,115,101])])((e=>{if(i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]==g([97,117,116,111]))return e(g([86,97,108,105,100]));i[g([101,100,105,116,105,110,103])][g([118,105,101,119])][g([95,111,118,101,114,108,97,121,77,111,100,101,72,105,110,116])]=g([97,117,116,111]),i[g([100,101,99,111,114,97,116,101])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]));let t=!1;const s=uid();function o(t){var i;(i=t,new(window[g([80,114,111,109,105,115,101])])(((e,t)=>{i[g([116,104,101,110])](e,t),window[g([115,101,116,84,105,109,101,111,117,116])](t,12e4)})))[g([116,104,101,110])]((e=>e&&e[g([115,116,97,116,117,115])]==g([111,107])?u(d(s+f))!=e[g([118,101,114,105,102,105,99,97,116,105,111,110])]?g([85,115,97,103,101,76,105,109,105,116]):g([86,97,108,105,100]):g([85,115,97,103,101,76,105,109,105,116])))[g([116,104,101,110])]((e=>(o(),e)),(()=>{const e=function(){const e=g([108,108,99,116,45])+u(d(p)),t=window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([103,101,116,73,116,101,109])](e);return t?window[g([112,97,114,115,101,73,110,116])](h(t),16)*r:null}();return null==e?(o(),g([86,97,108,105,100])):g(n-e>6048e5?[85,115,97,103,101,76,105,109,105,116]:[86,97,108,105,100])}))[g([116,104,101,110])](e)[g([99,97,116,99,104])]((()=>{e(g([85,115,97,103,101,76,105,109,105,116]))}));const r=36e5;function o(){const e=g([108,108,99,116,45])+u(d(p)),t=h(u(window[g([77,97,116,104])][g([99,101,105,108])](n/r)));window[g([108,111,99,97,108,83,116,111,114,97,103,101])][g([115,101,116,73,116,101,109])](e,t)}}i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),((t,n)=>{if(n[0]!=p)return e(g([85,115,97,103,101,76,105,109,105,116]));n[1]={...n[1],[g([114,101,113,117,101,115,116,73,100])]:s}}),{[g([112,114,105,111,114,105,116,121])]:g([104,105,103,104])}),i[g([111,110])](g([95,115,101,110,100,85,115,97,103,101,82,101,113,117,101,115,116]),(e=>{var n;(n=e[g([114,101,116,117,114,110])])&&(typeof n===g([111,98,106,101,99,116])||typeof n===g([102,117,110,99,116,105,111,110]))&&typeof n[g([116,104,101,110])]===g([102,117,110,99,116,105,111,110])&&typeof n[g([99,97,116,99,104])]===g([102,117,110,99,116,105,111,110])&&(t=!0,o(e[g([114,101,116,117,114,110])]))}),{[g([112,114,105,111,114,105,116,121])]:g([108,111,119])}),r[g([116,104,101,110])]((()=>{t||e(g([85,115,97,103,101,76,105,109,105,116]))}))})));return await async function(){let e=!0;try{const t=o[g([115,112,108,105,116])](g([46])),[n,i,r]=t;return function(t){const n=l(t);n&&n[g([97,108,103])]==g([69,83,50,53,54])||(e=!1)}(n),await async function(t,n,i){const r=window[g([85,105,110,116,56,65,114,114,97,121])][g([102,114,111,109])](c(i),(e=>e[g([99,104,97,114,67,111,100,101,65,116])](0))),o=(new(window[g([84,101,120,116,69,110,99,111,100,101,114])]))[g([101,110,99,111,100,101])](t+g([46])+n),a=window[g([99,114,121,112,116,111])][g([115,117,98,116,108,101])];if(!a)return;const l=await a[g([105,109,112,111,114,116,75,101,121])](g([106,119,107]),s,{[g([110,97,109,101])]:g([69,67,68,83,65]),[g([110,97,109,101,100,67,117,114,118,101])]:g([80,45,50,53,54])},!1,[g([118,101,114,105,102,121])]);await a[g([118,101,114,105,102,121])]({[g([110,97,109,101])]:g([69,67,68,83,65]),[g([104,97,115,104])]:{[g([110,97,109,101])]:g([83,72,65,45,50,53,54])}},l,r,o)||(e=!1)}(n,i,r),e}catch(e){return!1}}()?function(){const t=e[g([102,101,97,116,117,114,101,115])];return!!t&&(!!t[g([105,110,99,108,117,100,101,115])](g([42]))||!!t[g([105,110,99,108,117,100,101,115])](g([85,80,76,67])))}()?function(){const t=[g([101,118,97,108,117,97,116,105,111,110]),g([116,114,105,97,108])][g([105,110,99,108,117,100,101,115])](e[g([108,105,99,101,110,115,101,84,121,112,101])])?n/1e3:1739318400;return e[g([101,120,112])]<t}()?g([69,120,112,105,114,101,100]):function(){const t=e[g([108,105,99,101,110,115,101,100,72,111,115,116,115])];if(!t||0==t[g([108,101,110,103,116,104])])return!0;const{hostname:n}=new URL(window[g([108,111,99,97,116,105,111,110])].href);if(t[g([105,110,99,108,117,100,101,115])](n))return!0;const i=n[g([115,112,108,105,116])](g([46]));return t[g([102,105,108,116,101,114])]((e=>e[g([105,110,99,108,117,100,101,115])](g([42]))))[g([109,97,112])]((e=>e[g([115,112,108,105,116])](g([46]))))[g([115,111,109,101])]((e=>i[g([101,118,101,114,121])](((t,n)=>e[n]===t||e[n]===g([42])))))}()?(e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([101,118,97,108,117,97,116,105,111,110])&&(t=a(g([69,118,97,108,117,97,116,105,111,110,76,105,109,105,116]))),e[g([108,105,99,101,110,115,101,84,121,112,101])]==g([116,114,105,97,108])&&(t=a(g([84,114,105,97,108,76,105,109,105,116]))),await(t&&m?new(window[g([80,114,111,109,105,115,101])])(((e,n)=>{t[g([116,104,101,110])](e,n),m[g([116,104,101,110])]((t=>{t!=g([86,97,108,105,100])&&e(t)}),n)})):t||m||g([86,97,108,105,100]))):g([68,111,109,97,105,110,76,105,109,105,116]):g([78,111,116,65,108,108,111,119,101,100]):g([73,110,118,97,108,105,100])}catch(e){return g([73,110,118,97,108,105,100])}var p,f}())}var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n);function cloneObj(e){let t=e=>{var n;for(let i in e)(null==(n=e[i])?void 0:n.constructor)===Object&&(e[i]=t(e[i]));return{...e}};return t(e)}var Data=class{constructor(e){e.constructor===Object?this.store=cloneObj(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,t){console.warn("Symbiote Data: cannot "+e+". Prop name: "+t)}read(e){return this._storeIsProxy||this.store.hasOwnProperty(e)?this.store[e]:(Data.warn("read",e),null)}has(e){return this._storeIsProxy?void 0!==this.store[e]:this.store.hasOwnProperty(e)}add(e,t,n=!1){!n&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.notify(e))}pub(e,t){this._storeIsProxy||this.store.hasOwnProperty(e)?(this.store[e]=t,this.notify(e)):Data.warn("publish",e)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach((t=>{t(this.store[e])}))}sub(e,t,n=!0){return this._storeIsProxy||this.store.hasOwnProperty(e)?(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),n&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t}):(Data.warn("subscribe",e),null)}static registerCtx(e,t=Symbol()){let n=Data.globalStore.get(t);return n?console.warn('State: context UID "'+t+'" already in use'):(n=new Data(e),Data.globalStore.set(t,n)),n}static deleteCtx(e){Data.globalStore.delete(e)}static getCtx(e,t=!0){return Data.globalStore.get(e)||(t&&console.warn('State: wrong context UID - "'+e+'"'),null)}};Data.globalStore=new Map;var DICT=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),CHARS="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",CHLENGTH=CHARS.length-1,UID=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let n=0;n<e.length;n++)t+="-"===e[n]?e[n]:CHARS.charAt(Math.random()*CHLENGTH);return t}};function setNestedProp(e,t,n){let i,r=!0,s=t.split(".");return s.forEach(((t,n)=>{n<s.length-1?e=e[t]:i=t})),e?e[i]=n:r=!1,r}function kebabToCamel(e){return e.split("-").map(((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e)).join("").split("_").map(((e,t)=>e&&t?e.toUpperCase():e)).join("")}function repeatProcessor(e,t){[...e.querySelectorAll("["+DICT.REPEAT_ATTR+"]")].forEach((e=>{let n,i=e.getAttribute(DICT.REPEAT_ITEM_TAG_ATTR);if(i&&(n=window.customElements.get(i)),!n){n=class extends t.BaseComponent{constructor(){super(),i||(this.style.display="contents")}};let r=e.innerHTML;n.template=r,n.reg(i)}for(;e.firstChild;)e.firstChild.remove();let r=e.getAttribute(DICT.REPEAT_ATTR);t.sub(r,(t=>{if(!t){for(;e.firstChild;)e.firstChild.remove();return}let i,r=[...e.children],s=t=>{t.forEach(((e,t)=>{if(r[t])if(r[t].set$)setTimeout((()=>{r[t].set$(e)}));else for(let n in e)r[t][n]=e[n];else{i||(i=new DocumentFragment);let t=new n;Object.assign(t.init$,e),i.appendChild(t)}})),i&&e.appendChild(i);let s=r.slice(t.length,r.length);for(let e of s)e.remove()};if(t.constructor===Array)s(t);else if(t.constructor===Object){let e=[];for(let n in t){let i=t[n];Object.defineProperty(i,"_KEY_",{value:n,enumerable:!0}),e.push(i)}s(e)}else console.warn("Symbiote repeat data type error:"),console.log(t)})),e.removeAttribute(DICT.REPEAT_ATTR),e.removeAttribute(DICT.REPEAT_ITEM_TAG_ATTR)}))}var DEFAULT_SLOT_KEY="__default__";function slotProcessor(e,t){if(t.shadowRoot)return;let n=[...e.querySelectorAll("slot")];if(!n.length)return;let i={};n.forEach((e=>{let t=e.getAttribute("name")||DEFAULT_SLOT_KEY;i[t]={slot:e,fr:document.createDocumentFragment()}})),t.initChildren.forEach((e=>{var t;let n=DEFAULT_SLOT_KEY;e instanceof Element&&e.hasAttribute("slot")&&(n=e.getAttribute("slot"),e.removeAttribute("slot")),null==(t=i[n])||t.fr.appendChild(e)})),Object.values(i).forEach((e=>{if(e.fr.childNodes.length)e.slot.parentNode.replaceChild(e.fr,e.slot);else if(e.slot.childNodes.length){let t=document.createDocumentFragment();t.append(...e.slot.childNodes),e.slot.parentNode.replaceChild(t,e.slot)}else e.slot.remove()}))}function refProcessor(e,t){[...e.querySelectorAll("["+DICT.EL_REF_ATTR+"]")].forEach((e=>{let n=e.getAttribute(DICT.EL_REF_ATTR);t.ref[n]=e,e.removeAttribute(DICT.EL_REF_ATTR)}))}function domSetProcessor(e,t){[...e.querySelectorAll("["+DICT.BIND_ATTR+"]")].forEach((e=>{let n=e.getAttribute(DICT.BIND_ATTR).split(";");[...e.attributes].forEach((t=>{if(t.name.startsWith("-")&&t.value){let i=kebabToCamel(t.name.replace("-",""));n.push(i+":"+t.value),e.removeAttribute(t.name)}})),n.forEach((n=>{if(!n)return;let i,r=n.split(":").map((e=>e.trim())),s=r[0];0===s.indexOf(DICT.ATTR_BIND_PRFX)&&(i=!0,s=s.replace(DICT.ATTR_BIND_PRFX,""));let o=r[1].split(",").map((e=>e.trim()));for(let n of o){let r;n.startsWith("!!")?(r="double",n=n.replace("!!","")):n.startsWith("!")&&(r="single",n=n.replace("!","")),t.sub(n,(t=>{"double"===r?t=!!t:"single"===r&&(t=!t),i?(null==t?void 0:t.constructor)===Boolean?t?e.setAttribute(s,""):e.removeAttribute(s):e.setAttribute(s,t):setNestedProp(e,s,t)||(e[DICT.SET_LATER_KEY]||(e[DICT.SET_LATER_KEY]=Object.create(null)),e[DICT.SET_LATER_KEY][s]=t)}))}})),e.removeAttribute(DICT.BIND_ATTR)}))}var OPEN_TOKEN$1="{{",CLOSE_TOKEN$1="}}",SKIP_ATTR="skip-text";function getTextNodesWithTokens(e){let t,n=[],i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>{var t;return!(null==(t=e.parentElement)?void 0:t.hasAttribute(SKIP_ATTR))&&e.textContent.includes(OPEN_TOKEN$1)&&e.textContent.includes(CLOSE_TOKEN$1)&&1}});for(;t=i.nextNode();)n.push(t);return n}var txtNodesProcessor=function(e,t){getTextNodesWithTokens(e).forEach((e=>{let n,i=[];for(;e.textContent.includes(CLOSE_TOKEN$1);)e.textContent.startsWith(OPEN_TOKEN$1)?(n=e.textContent.indexOf(CLOSE_TOKEN$1)+CLOSE_TOKEN$1.length,e.splitText(n),i.push(e)):(n=e.textContent.indexOf(OPEN_TOKEN$1),e.splitText(n)),e=e.nextSibling;i.forEach((e=>{let n=e.textContent.replace(OPEN_TOKEN$1,"").replace(CLOSE_TOKEN$1,"");e.textContent="",t.sub(n,(t=>{e.textContent=t}))}))}))},tpl_processors_default=[repeatProcessor,slotProcessor,refProcessor,domSetProcessor,txtNodesProcessor],SINGLE_QUOTE="'",DOUBLE_QUOTE='"',ESCAPED_PATTERN=/\\([0-9a-fA-F]{1,6} ?)/g;function hasLeadingTrailingQuotes(e){return!(e[0]!==DOUBLE_QUOTE&&e[0]!==SINGLE_QUOTE||e[e.length-1]!==DOUBLE_QUOTE&&e[e.length-1]!==SINGLE_QUOTE)}function trimQuotes(e){return e[0]!==DOUBLE_QUOTE&&e[0]!==SINGLE_QUOTE||(e=e.slice(1)),e[e.length-1]!==DOUBLE_QUOTE&&e[e.length-1]!==SINGLE_QUOTE||(e=e.slice(0,-1)),e}function escapeQuotes(e){let t="",n="";for(var i=0;i<e.length;i++){const r=e[i+1];"\\"===e[i]&&'"'===r?(t+='\\"',i++):'"'===e[i]&&"\\"!==n?t+='\\"':t+=e[i],n=e[i]}return t}function parseCssPropertyValue(e){let t=e;hasLeadingTrailingQuotes(e)&&(t=trimQuotes(t),t=t.replace(ESCAPED_PATTERN,((e,t)=>String.fromCodePoint(parseInt(t.trim(),16)))),t=t.replaceAll("\\\n","\\n"),t=escapeQuotes(t),t=DOUBLE_QUOTE+t+DOUBLE_QUOTE);try{return JSON.parse(t)}catch(n){throw new Error("Failed to parse CSS property value: "+t+". Original input: "+e)}}var autoTagsCount=0,styleMutationObserver=null,styleMutationObserverCbList=null,_BaseComponent=class extends HTMLElement{constructor(){super(),__publicField(this,"updateCssData",(()=>{var e;this.dropCssDataCache(),null==(e=this.__boundCssProps)||e.forEach((e=>{let t=this.getCssData(this.__extractCssName(e),!0);null!==t&&this.$[e]!==t&&(this.$[e]=t)}))})),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return _BaseComponent}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,null==(e=this.initCallback)||e.call(this))}render(e,t=this.renderShadow){let n;if(!t&&!this.constructor.__shadowStylesUrl||this.shadowRoot||this.attachShadow({mode:"open"}),this.allowCustomTemplate){let t=this.getAttribute(DICT.USE_TPL);if(t){let n=this.getRootNode(),i=(null==n?void 0:n.querySelector(t))||document.querySelector(t);i?e=i.content.cloneNode(!0):console.warn('Symbiote template "'+t+'" is not found...')}}if(this.processInnerHtml)for(let e of this.tplProcessors)e(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(null==e?void 0:e.constructor)===DocumentFragment)n=e;else if((null==e?void 0:e.constructor)===String){let t=document.createElement("template");t.innerHTML=e,n=t.content.cloneNode(!0)}else this.constructor.__tpl&&(n=this.constructor.__tpl.content.cloneNode(!0));for(let e of this.tplProcessors)e(n,this)}let i=()=>{n&&(t&&this.shadowRoot.appendChild(n)||this.appendChild(n)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let e=document.createElement("link");e.rel="stylesheet",e.href=this.constructor.__shadowStylesUrl,e.onload=i,this.shadowRoot.prepend(e)}else i()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=UID.generate(),this.style.setProperty(DICT.CSS_CTX_PROP,"'"+this.__autoCtxName+"'")),this.__autoCtxName}get cssCtxName(){return this.getCssData(DICT.CSS_CTX_PROP,!0)}get ctxName(){var e;let t=(null==(e=this.getAttribute(DICT.CTX_NAME_ATTR))?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=Data.registerCtx({},this)),this.__localCtx}get nodeCtx(){return Data.getCtx(this.ctxName,!1)||Data.registerCtx({},this.ctxName)}static __parseProp(e,t){let n,i;if(e.startsWith(DICT.EXT_DATA_CTX_PRFX))n=t.nodeCtx,i=e.replace(DICT.EXT_DATA_CTX_PRFX,"");else if(e.includes(DICT.NAMED_DATA_CTX_SPLTR)){let t=e.split(DICT.NAMED_DATA_CTX_SPLTR);n=Data.getCtx(t[0]),i=t[1]}else n=t.localCtx,i=e;return{ctx:n,name:i}}sub(e,t,n=!0){let i=e=>{this.isConnected&&t(e)},r=_BaseComponent.__parseProp(e,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,i,n)):window.setTimeout((()=>{this.allSubs.add(r.ctx.sub(r.name,i,n))}))}notify(e){let t=_BaseComponent.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=_BaseComponent.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t,n=!1){let i=_BaseComponent.__parseProp(e,this);i.ctx.add(i.name,t,n)}add$(e,t=!1){for(let n in e)this.add(n,e[n],t)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(e,t,n)=>{let i=_BaseComponent.__parseProp(t,this);return i.ctx.pub(i.name,n),!0},get:(e,t)=>{let n=_BaseComponent.__parseProp(t,this);return n.ctx.read(n.name)}})}return this.__stateProxy}set$(e,t=!1){for(let n in e){let i=e[n],r=[String,Number,Boolean];(t||!r.includes(null==i?void 0:i.constructor)||this.$[n]!==i)&&(this.$[n]=i)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(DICT.CTX_OWNER_ATTR)&&"false"!==this.getAttribute(DICT.CTX_OWNER_ATTR)}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let e in this.init$)if(e.startsWith(DICT.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(DICT.EXT_DATA_CTX_PRFX,""),this.init$[e],this.__ctxOwner);else if(e.includes(DICT.NAMED_DATA_CTX_SPLTR)){let t=e.split(DICT.NAMED_DATA_CTX_SPLTR),n=t[0].trim(),i=t[1].trim();if(n&&i){let t=Data.getCtx(n,!1);t||(t=Data.registerCtx({},n)),t.add(i,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);for(let e in this.cssInit$)this.bindCssData(e,this.cssInit$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=null==(e=this.getAttribute(DICT.CTX_NAME_ATTR))?void 0:e.trim();if(t&&this.style.setProperty(DICT.CSS_CTX_PROP,"'"+t+"'"),this.__initDataCtx(),this[DICT.SET_LATER_KEY]){for(let e in this[DICT.SET_LATER_KEY])setNestedProp(this,e,this[DICT.SET_LATER_KEY][e]);delete this[DICT.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of tpl_processors_default)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(null==e?void 0:e.querySelector("link["+DICT.ROOT_STYLE_ATTR_NAME+'="'+this.constructor.is+'"]'))return void this.render();let t=this.constructor.__rootStylesLink.cloneNode(!0);t.setAttribute(DICT.ROOT_STYLE_ATTR_NAME,this.constructor.is),t.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(t):e.prepend(t)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);null==styleMutationObserverCbList||styleMutationObserverCbList.delete(this.updateCssData),(null==styleMutationObserverCbList?void 0:styleMutationObserverCbList.size)||(null==styleMutationObserver||styleMutationObserver.disconnect(),styleMutationObserver=null,styleMutationObserverCbList=null)}),100)))}static reg(e,t=!1){e||(autoTagsCount++,e=DICT.AUTO_TAG_PRFX+"-"+autoTagsCount),this.__tag=e;let n=window.customElements.get(e);n?t||n===this||console.warn(['Element with tag name "'+e+'" already registered.',"You're trying to override it with another class \""+this.name+'".',"This is most likely a mistake.","New element will not be registered."].join("\n")):window.customElements.define(e,t?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,n){var i;if(t===n)return;let r=null==(i=this.constructor.__attrDesc)?void 0:i[e];r?this.__dataCtxInitialized?this.$[r]=n:this.init$[r]=n:this[e]=n}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let n=this.__computedStyle.getPropertyValue(e).trim();try{this.__cssDataCache[e]=parseCssPropertyValue(n)}catch(n){!t&&console.warn("CSS Data error: "+e),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map(((e,t)=>0===t?"":e)).join("--")}__initStyleAttrObserver(){styleMutationObserverCbList||(styleMutationObserverCbList=new Set),styleMutationObserverCbList.add(this.updateCssData),styleMutationObserver||(styleMutationObserver=new MutationObserver((e=>{"attributes"===e[0].type&&styleMutationObserverCbList.forEach((e=>{e()}))}))).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]})}bindCssData(e,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let n=this.getCssData(this.__extractCssName(e),!0);null===n&&(n=t),this.add(e,n),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,n){let i="__"+e;this[i]=this[e],Object.defineProperty(this,e,{set:e=>{this[i]=e,n?window.setTimeout((()=>{null==t||t(e)})):null==t||t(e)},get:()=>this[i]}),this[e]=this[i]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(e){if(!this.__rootStylesLink){let t=new Blob([e],{type:"text/css"}),n=URL.createObjectURL(t),i=document.createElement("link");i.href=n,i.rel="stylesheet",this.__rootStylesLink=i}}},BaseComponent=_BaseComponent;function applyStyles(e,t){for(let n in t)n.includes("-")?e.style.setProperty(n,t[n]):e.style[n]=t[n]}function applyAttributes(e,t){for(let n in t)t[n].constructor===Boolean?t[n]?e.setAttribute(n,""):e.removeAttribute(n):e.setAttribute(n,t[n])}function create(e={tag:"div"}){let t=document.createElement(e.tag);if(e.attributes&&applyAttributes(t,e.attributes),e.styles&&applyStyles(t,e.styles),e.properties)for(let n in e.properties)t[n]=e.properties[n];return e.processors&&e.processors.forEach((e=>{e(t)})),e.children&&e.children.forEach((e=>{let n=create(e);t.appendChild(n)})),t}__publicField(BaseComponent,"template");var READY_EVENT_NAME="idb-store-ready",DEFAULT_DB_NAME="symbiote-db",UPD_EVENT_PREFIX="symbiote-idb-update_",DbInstance=class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(READY_EVENT_NAME,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return UPD_EVENT_PREFIX+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,t){this.name=e,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=e=>{this._notifyWhenReady(e)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach((async t=>{t(await this.read(e.newValue))}))},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise(((n,i)=>{t.onsuccess=t=>{var i;(null==(i=t.target.result)?void 0:i._value)?n(t.target.result._value):(n(null),console.warn('IDB: cannot read "'+e+'"'))},t.onerror=e=>{i(e)}}))}write(e,t,n=!1){let i={_key:e,_value:t},r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(i);return new Promise(((t,i)=>{r.onsuccess=i=>{n||this._notifySubscribers(e),t(i.target.result)},r.onerror=e=>{i(e)}}))}delete(e,t=!1){let n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise(((i,r)=>{n.onsuccess=n=>{t||this._notifySubscribers(e),i(n)},n.onerror=e=>{r(e)}}))}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise(((t,n)=>{e.onsuccess=e=>{let n=e.target.result;t(n.map((e=>e._value)))},e.onerror=e=>{n(e)}}))}subscribe(e,t){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let n=this._subscriptionsMap[e];return n.add(t),{remove:()=>{n.delete(t),n.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,IDB.clear(this.name)}},IDB=class{static get readyEventName(){return READY_EVENT_NAME}static open(e=DEFAULT_DB_NAME,t="store"){let n=e+"/"+t;return this._reg[n]||(this._reg[n]=new DbInstance(e,t)),this._reg[n]}static clear(e){window.indexedDB.deleteDatabase(e);for(let t in this._reg)t.split("/")[0]===e&&delete this._reg[t]}};__publicField(IDB,"_reg",Object.create(null));const normalizeCdnOperation=e=>{if("string"!=typeof e||!e)return"";let t=e.trim();return t.startsWith("-/")?t=t.slice(2):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,t.length-1)),t},joinCdnOperations=(...e)=>e.filter((e=>"string"==typeof e&&e)).map((e=>normalizeCdnOperation(e))).join("/-/"),createCdnUrlModifiers=(...e)=>{let t=joinCdnOperations(...e);return t?"-/"+t+"/":""};function extractFilename(e){let t=new URL(e),n=t.pathname+t.search+t.hash,i=n.lastIndexOf("http"),r=n.lastIndexOf("/"),s="";return i>=0?s=n.slice(i):r>=0&&(s=n.slice(r+1)),s}function extractUuid(e){let t=new URL(e),{pathname:n}=t;const i=n.indexOf("/"),r=n.indexOf("/",i+1);return n.substring(i+1,r)}function extractCdnUrlModifiers(e){let t=trimFilename(e),n=new URL(t),i=n.pathname.indexOf("/-/");return-1===i?"":n.pathname.substring(i).slice(1)}function extractOperations(e){return extractCdnUrlModifiers(e).split("/-/").filter(Boolean).map((e=>normalizeCdnOperation(e)))}function trimFilename(e){let t=new URL(e),n=extractFilename(e),i=isFileUrl(n)?splitFileUrl(n).pathname:n;return t.pathname=t.pathname.replace(i,""),t.search="",t.hash="",t.toString()}function isFileUrl(e){return e.startsWith("http")}function splitFileUrl(e){let t=new URL(e);return{pathname:t.origin+t.pathname||"",search:t.search||"",hash:t.hash||""}}const createCdnUrl=(e,t,n)=>{let i=new URL(trimFilename(e));if(n=n||extractFilename(e),i.pathname.startsWith("//")&&(i.pathname=i.pathname.replace("//","/")),isFileUrl(n)){let e=splitFileUrl(n);i.pathname=i.pathname+(t||"")+(e.pathname||""),i.search=e.search,i.hash=e.hash}else i.pathname=i.pathname+(t||"")+(n||"");return i.toString()},createOriginalUrl=(e,t)=>{let n=new URL(e);return n.pathname=t+"/",n.toString()},stringToArray=(e,t=",")=>e.trim().split(t).map((e=>e.trim())).filter((e=>e.length>0)),OPERATIONS_DEFAULTS=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),SUPPORTED_OPERATIONS_ORDERED=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function transformationToStr(e,t){if("number"==typeof t){const n=t;return OPERATIONS_DEFAULTS[e]!==n?e+"/"+n:""}if("boolean"==typeof t){const n=t;return OPERATIONS_DEFAULTS[e]!==n?""+e:""}if("filter"===e&&t){const{name:n,amount:i}=t;return OPERATIONS_DEFAULTS.filter===i?"":e+"/"+n+"/"+i}if("crop"===e&&t){let{dimensions:n,coords:i}=t;return e+"/"+n.join("x")+"/"+i.join(",")}return""}function transformationsToOperations(e){return joinCdnOperations(...SUPPORTED_OPERATIONS_ORDERED.filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>transformationToStr(t,e[t]))).filter((e=>!!e)))}const COMMON_OPERATIONS=joinCdnOperations("format/auto","progressive/yes"),asNumber$1=([e])=>void 0!==e?Number(e):void 0,asBoolean$1=()=>!0,asFilter=([e,t])=>({name:e,amount:void 0!==t?Number(t):100}),asCrop=([e,t])=>{if(!/\d+x\d+/.test(e)||!/\d+,\d+/.test(t))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:stringToArray(e,"x").map(Number),coords:stringToArray(t).map(Number)}},OPERATION_PROCESSORS=Object.freeze({enhance:asNumber$1,brightness:asNumber$1,exposure:asNumber$1,gamma:asNumber$1,contrast:asNumber$1,saturation:asNumber$1,vibrance:asNumber$1,warmth:asNumber$1,filter:asFilter,mirror:asBoolean$1,flip:asBoolean$1,rotate:asNumber$1,crop:asCrop});function operationsToTransformations(e){const t={};for(const n of e){const[e,...i]=n.split("/");if(!SUPPORTED_OPERATIONS_ORDERED.includes(e))continue;const r=e,s=OPERATION_PROCESSORS[r];try{const e=s(i);t[r]=e}catch(e){console.warn(['Failed to parse URL operation "'+n+'". It will be ignored.',e instanceof Error?'Error message: "'+e.message+'"':e,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join("\n"))}}return t}const TabId=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),ALL_TABS=[TabId.CROP,TabId.TUNING,TabId.FILTERS],ALL_COLOR_OPERATIONS=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],ALL_FILTERS=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],ALL_CROP_OPERATIONS=["rotate","mirror","flip"],COLOR_OPERATIONS_CONFIG=Object.freeze({brightness:{zero:OPERATIONS_DEFAULTS.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:OPERATIONS_DEFAULTS.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:OPERATIONS_DEFAULTS.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:OPERATIONS_DEFAULTS.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:OPERATIONS_DEFAULTS.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:OPERATIONS_DEFAULTS.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:OPERATIONS_DEFAULTS.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:OPERATIONS_DEFAULTS.enhance,range:[0,100],keypointsNumber:1},filter:{zero:OPERATIONS_DEFAULTS.filter,range:[0,100],keypointsNumber:1}}),deserealizeCsv=e=>e?e.split(",").map((e=>e.trim())):[],serializeCsv=e=>e?e.join(","):"",DEFAULT_CDN_CNAME="https://ucarecdn.com",DEFAULT_BASE_URL="https://upload.uploadcare.com",DEFAULT_SOCIAL_BASE_URL="https://social.uploadcare.com",initialConfig={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",externalSourcesEmbedCss:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:serializeCsv(ALL_TABS),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:DEFAULT_CDN_CNAME,baseUrl:DEFAULT_BASE_URL,socialBaseUrl:DEFAULT_SOCIAL_BASE_URL,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null,secureUploadsExpireThreshold:6e5,secureUploadsSignatureResolver:null,secureDeliveryProxyUrlResolver:null,iconHrefResolver:null,fileValidators:[],collectionValidators:[],defaultCameraMode:"photo",enableAudioRecording:!0,enableVideoRecording:!0,maxVideoRecordingDuration:null,mediaRecorerOptions:null},DEFAULT_DEBOUNCE_TIMEOUT=20,EventType=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"});class EventEmitter{_timeoutStore=new Map;_targets=new Set;_debugPrint=null;constructor(e){this._debugPrint=e}bindTarget(e){this._targets.add(e)}unbindTarget(e){this._targets.delete(e)}_dispatch(e,t){for(const n of this._targets)n.dispatchEvent(new CustomEvent(e,{detail:t}));this._debugPrint?.((()=>{const n=t&&"object"==typeof t?{...t}:t;return['event "'+e+'"',n]}))}emit(e,t,{debounce:n}={}){if("number"!=typeof n&&!n)return void this._dispatch(e,"function"==typeof t?t():t);this._timeoutStore.has(e)&&window.clearTimeout(this._timeoutStore.get(e));const i="number"==typeof n?n:DEFAULT_DEBOUNCE_TIMEOUT,r=window.setTimeout((()=>{this._dispatch(e,"function"==typeof t?t():t),this._timeoutStore.delete(e)}),i);this._timeoutStore.set(e,r)}}function debounce(e,t){let n;const i=(...i)=>{clearTimeout(n),n=setTimeout((()=>e(...i)),t)};return i.cancel=()=>{clearTimeout(n)},i}const WINDOW_HEIGHT_TRACKER_PROPERTY="--uploadcare-blocks-window-height";class WindowHeightTracker{static clientsRegistry=new Set;static flush=debounce((()=>{document.documentElement.style.setProperty(WINDOW_HEIGHT_TRACKER_PROPERTY,window.innerHeight+"px")}),100);static registerClient(e){0===this.clientsRegistry.size&&this.attachTracker(),this.clientsRegistry.add(e)}static unregisterClient(e){this.clientsRegistry.delete(e),0===this.clientsRegistry.size&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(WINDOW_HEIGHT_TRACKER_PROPERTY)}}const getLocaleDirection=e=>{const t=new Intl.Locale(e);let n="ltr";return"function"==typeof t.getTextInfo&&t.getTextInfo().direction?n=t.getTextInfo().direction:"textInfo"in t&&t.textInfo?.direction&&(n=t.textInfo.direction),n},getPluralForm=(e,t)=>new Intl.PluralRules(e).select(t),DEFAULT_TRANSFORMER=e=>e,OPEN_TOKEN="{{",CLOSE_TOKEN="}}",PLURAL_PREFIX="plural:";function applyTemplateData(e,t,n={}){let{openToken:i=OPEN_TOKEN,closeToken:r=CLOSE_TOKEN,transform:s=DEFAULT_TRANSFORMER}=n;for(let n in t){let o=t[n]?.toString();e=e.replaceAll(i+n+r,"string"==typeof o?s(o):o)}return e}function getPluralObjects(e){const t=[];let n=e.indexOf(OPEN_TOKEN);for(;-1!==n;){const i=e.indexOf(CLOSE_TOKEN,n),r=e.substring(n+2,i);if(r.startsWith(PLURAL_PREFIX)){const s=e.substring(n+2,i).replace(PLURAL_PREFIX,""),o=s.substring(0,s.indexOf("(")),a=s.substring(s.indexOf("(")+1,s.indexOf(")"));t.push({variable:r,pluralKey:o,countVariable:a})}n=e.indexOf(OPEN_TOKEN,i)}return t}const waitForAttribute=({element:e,attribute:t,onSuccess:n,onTimeout:i,timeout:r=300})=>{const s=e.getAttribute(t);if(null!==s)return void n(s);const o=new MutationObserver((e=>{const t=e[e.length-1];l(t)}));o.observe(e,{attributes:!0,attributeFilter:[t]});const a=setTimeout((()=>{o.disconnect(),i()}),r),l=i=>{const r=e.getAttribute(t);"attributes"===i.type&&i.attributeName===t&&null!==r&&(clearTimeout(a),o.disconnect(),n(r))}};function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}const SEPARATOR=/\W|_/g;function camelizeString(e){return e.split(SEPARATOR).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join("")}function camelizeArrayItems(e,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(e)?e.map((e=>camelizeKeys(e,{ignoreKeys:t}))):e}function camelizeKeys(e,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(e))return camelizeArrayItems(e,{ignoreKeys:t});if(!isObject(e))return e;const n={};for(const i of Object.keys(e)){let r=e[i];t.includes(i)?n[i]=r:(isObject(r)?r=camelizeKeys(r,{ignoreKeys:t}):Array.isArray(r)&&(r=camelizeArrayItems(r,{ignoreKeys:t})),n[camelizeString(i)]=r)}return n}const delay=e=>new Promise((t=>setTimeout(t,e)));function getUserAgent$1({libraryName:e,libraryVersion:t,userAgent:n,publicKey:i="",integration:r=""}){const s="JavaScript";return"string"==typeof n?n:"function"==typeof n?n({publicKey:i,libraryName:e,libraryVersion:t,languageName:s,integration:r}):[e,t,i].filter(Boolean).join("/")+" ("+[s,r].filter(Boolean).join("; ")+")"}const defaultOptions={factor:2,time:100};function retrier(e,t=defaultOptions){let n=0;return function e(i){const r=Math.round(t.time*t.factor**n);return i({attempt:n,retry:t=>delay(t??r).then((()=>(n+=1,e(i))))})}(e)}class UploadcareError extends Error{}class NetworkError extends UploadcareError{originalProgressEvent;constructor(e){super(),this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,NetworkError.prototype),this.originalProgressEvent=e}}const onCancel=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))};class CancelError extends UploadcareError{isCancel=!0;constructor(e="Request canceled"){super(e),this.name="CancelError",Object.setPrototypeOf(this,CancelError.prototype)}}const DEFAULT_INTERVAL=500,poll=({check:e,interval:t=DEFAULT_INTERVAL,timeout:n,signal:i})=>new Promise(((r,s)=>{let o,a;onCancel(i,(()=>{o&&clearTimeout(o),s(new CancelError("Poll cancelled"))})),n&&(a=setTimeout((()=>{o&&clearTimeout(o),s(new CancelError("Timed out"))}),n));const l=()=>{try{Promise.resolve(e(i)).then((e=>{e?(a&&clearTimeout(a),r(e)):o=setTimeout(l,t)})).catch((e=>{a&&clearTimeout(a),s(e)}))}catch(e){a&&clearTimeout(a),s(e)}};o=setTimeout(l,0)})),defaultSettings={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:4,pusherKey:"79ae88bd931ea68464d9"},defaultContentType="application/octet-stream",defaultFilename="original",request=({method:e,url:t,data:n,headers:i={},signal:r,onProgress:s})=>new Promise(((o,a)=>{const l=new XMLHttpRequest,c=e?.toUpperCase()||"GET";let d=!1;l.open(c,t,!0),i&&Object.entries(i).forEach((e=>{const[t,n]=e;void 0!==n&&!Array.isArray(n)&&l.setRequestHeader(t,n)})),l.responseType="text",onCancel(r,(()=>{d=!0,l.abort(),a(new CancelError)})),l.onload=()=>{if(200!=l.status)a(new Error("Error "+l.status+": "+l.statusText));else{const e={method:c,url:t,data:n,headers:i||void 0,signal:r,onProgress:s},a=l.getAllResponseHeaders().trim().split(/[\r\n]+/),d={};a.forEach((function(e){const t=e.split(": "),n=t.shift(),i=t.join(": ");n&&void 0!==n&&(d[n]=i)}));const u=l.response,h=l.status;o({request:e,data:u,headers:d,status:h})}},l.onerror=e=>{d||a(new NetworkError(e))},s&&"function"==typeof s&&(l.upload.onprogress=e=>{e.lengthComputable?s({isComputable:!0,value:e.loaded/e.total}):s({isComputable:!1})}),n?l.send(n):l.send()}));function identity(e,...t){return e}const getFileOptions=({name:e})=>e?[e]:[],transformFile=identity;var getFormData=()=>new FormData;const isBuffer=e=>!1,isBlob=e=>"undefined"!=typeof Blob&&e instanceof Blob,isFile=e=>"undefined"!=typeof File&&e instanceof File,isReactNativeAsset=e=>!!e&&"object"==typeof e&&!Array.isArray(e)&&"uri"in e&&"string"==typeof e.uri,isFileData=e=>isBlob(e)||isFile(e)||isBuffer()||isReactNativeAsset(e),isSimpleValue=e=>"string"==typeof e||"number"==typeof e||void 0===e,isObjectValue=e=>!!e&&"object"==typeof e&&!Array.isArray(e),isFileValue=e=>!!e&&"object"==typeof e&&"data"in e&&isFileData(e.data);function collectParams(e,t,n){if(Array.isArray(n))for(const i of n)collectParams(e,t+"[]",i);else if(isFileValue(n)){const{name:i,contentType:r}=n,s=transformFile(n.data,i,r??defaultContentType),o=getFileOptions({name:i});e.push([t,s,...o])}else if(isObjectValue(n))for(const[i,r]of Object.entries(n))void 0!==r&&e.push([t+"["+i+"]",String(r)]);else isSimpleValue(n)&&n&&e.push([t,n.toString()])}function getFormDataParams(e){const t=[];for(const[n,i]of Object.entries(e))collectParams(t,n,i);return t}function buildFormData(e){const t=getFormData(),n=getFormDataParams(e);for(const e of n){const[n,i,...r]=e;t.append(n,i,...r)}return t}class UploadError extends UploadcareError{code;request;response;headers;constructor(e,t,n,i,r){super(),this.name="UploadError",this.message=e,this.code=t,this.request=n,this.response=i,this.headers=r,Object.setPrototypeOf(this,UploadError.prototype)}}const buildSearchParams=e=>{const t=new URLSearchParams;for(const[n,i]of Object.entries(e))i&&"object"==typeof i&&!Array.isArray(i)?Object.entries(i).filter((e=>e[1]??!1)).forEach((e=>t.set(n+"["+e[0]+"]",String(e[1])))):Array.isArray(i)?i.forEach((e=>{t.append(n+"[]",e)})):"string"==typeof i&&i?t.set(n,i):"number"==typeof i&&t.set(n,i.toString());return t.toString()},getUrl=(e,t,n)=>{const i=new URL(e);return i.pathname=(i.pathname+t).replace("//","/"),n&&(i.search=buildSearchParams(n)),i.toString()};var version="6.14.2";const LIBRARY_NAME="UploadcareUploadClient",LIBRARY_VERSION=version;function getUserAgent(e){return getUserAgent$1({libraryName:LIBRARY_NAME,libraryVersion:LIBRARY_VERSION,...e})}const REQUEST_WAS_THROTTLED_CODE="RequestThrottledError",DEFAULT_RETRY_AFTER_TIMEOUT=15e3,DEFAULT_NETWORK_ERROR_TIMEOUT=1e3;function getTimeoutFromThrottledRequest(e){const{headers:t}=e||{};if(!t||"string"!=typeof t["retry-after"])return DEFAULT_RETRY_AFTER_TIMEOUT;const n=parseInt(t["retry-after"],10);return Number.isFinite(n)?1e3*n:DEFAULT_RETRY_AFTER_TIMEOUT}function retryIfFailed(e,t){const{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:i}=t;return retrier((({attempt:t,retry:r})=>e().catch((e=>{if("response"in e&&e?.code===REQUEST_WAS_THROTTLED_CODE&&t<n)return r(getTimeoutFromThrottledRequest(e));if(e instanceof NetworkError&&t<i)return r((t+1)*DEFAULT_NETWORK_ERROR_TIMEOUT);throw e}))))}const getContentType=e=>{let t="";return(isBlob(e)||isFile(e)||isReactNativeAsset(e))&&(t=e.type),t||defaultContentType},getFileName=e=>{let t="";return isFile(e)&&e.name?t=e.name:isBlob(e)||isBuffer()?t="":isReactNativeAsset(e)&&e.name&&(t=e.name),t||defaultFilename};function getStoreValue(e){return void 0===e||"auto"===e?"auto":e?"1":"0"}function base(e,{publicKey:t,fileName:n,contentType:i,baseURL:r=defaultSettings.baseURL,secureSignature:s,secureExpire:o,store:a,signal:l,onProgress:c,source:d="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed((()=>request({method:"POST",url:getUrl(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:u,userAgent:h})},data:buildFormData({file:{data:e,name:n||getFileName(e),contentType:i||getContentType(e)},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:getStoreValue(a),signature:s,expire:o,source:d,metadata:p}),signal:l,onProgress:c}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}var TypeEnum,Status;function fromUrl(e,{publicKey:t,baseURL:n=defaultSettings.baseURL,store:i,fileName:r,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:c="url",signal:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed((()=>request({method:"POST",headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:u,userAgent:h})},url:getUrl(n,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:getStoreValue(i),filename:r,check_URL_duplicates:s?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:c,metadata:p}),signal:d}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}!function(e){e.Token="token",e.FileInfo="file_info"}(TypeEnum||(TypeEnum={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(Status||(Status={}));const isErrorResponse=e=>"status"in e&&e.status===Status.Error;function fromUrlStatus(e,{publicKey:t,baseURL:n=defaultSettings.baseURL,signal:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=defaultSettings.retryNetworkErrorMaxTimes}={}){return retryIfFailed((()=>request({method:"GET",headers:t?{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:r,userAgent:s})}:void 0,url:getUrl(n,"/from_url/status/",{jsonerrors:1,token:e}),signal:i}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i&&!isErrorResponse(i))throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}function group(e,{publicKey:t,baseURL:n=defaultSettings.baseURL,jsonpCallback:i,secureSignature:r,secureExpire:s,signal:o,source:a,integration:l,userAgent:c,retryThrottledRequestMaxTimes:d=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:u=defaultSettings.retryNetworkErrorMaxTimes}){return retryIfFailed((()=>request({method:"POST",headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:l,userAgent:c})},url:getUrl(n,"/group/",{jsonerrors:1}),data:buildFormData({files:e,callback:i,pub_key:t,signature:r,expire:s,source:a}),signal:o}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryNetworkErrorMaxTimes:u,retryThrottledRequestMaxTimes:d})}function info(e,{publicKey:t,baseURL:n=defaultSettings.baseURL,signal:i,source:r,integration:s,userAgent:o,retryThrottledRequestMaxTimes:a=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=defaultSettings.retryNetworkErrorMaxTimes}){return retryIfFailed((()=>request({method:"GET",headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:s,userAgent:o})},url:getUrl(n,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:r}),signal:i}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function multipartStart(e,{publicKey:t,contentType:n,fileName:i,multipartChunkSize:r=defaultSettings.multipartChunkSize,baseURL:s="",secureSignature:o,secureExpire:a,store:l,signal:c,source:d="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:g=defaultSettings.retryNetworkErrorMaxTimes,metadata:p}){return retryIfFailed((()=>request({method:"POST",url:getUrl(s,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:u,userAgent:h})},data:buildFormData({filename:i||defaultFilename,size:e,content_type:n||defaultContentType,part_size:r,UPLOADCARE_STORE:getStoreValue(l),UPLOADCARE_PUB_KEY:t,signature:o,expire:a,source:d,metadata:p}),signal:c}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i.parts=Object.keys(i.parts).map((e=>i.parts[Number(e)])),i}))),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g})}function multipartUpload(e,t,{contentType:n,signal:i,onProgress:r,retryThrottledRequestMaxTimes:s=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=defaultSettings.retryNetworkErrorMaxTimes}){return retryIfFailed((()=>request({method:"PUT",url:t,data:e,onProgress:r,signal:i,headers:{"Content-Type":n||defaultContentType}}).then((e=>(r&&r({isComputable:!0,value:1}),e))).then((({status:e})=>({code:e})))),{retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o})}function multipartComplete(e,{publicKey:t,baseURL:n=defaultSettings.baseURL,source:i="local",signal:r,integration:s,userAgent:o,retryThrottledRequestMaxTimes:a=defaultSettings.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=defaultSettings.retryNetworkErrorMaxTimes}){return retryIfFailed((()=>request({method:"POST",url:getUrl(n,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":getUserAgent({publicKey:t,integration:s,userAgent:o})},data:buildFormData({uuid:e,UPLOADCARE_PUB_KEY:t,source:i}),signal:r}).then((({data:e,headers:t,request:n})=>{const i=camelizeKeys(JSON.parse(e));if("error"in i)throw new UploadError(i.error.content,i.error.errorCode,n,i,t);return i}))),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function isReadyPoll(e,{publicKey:t,baseURL:n,source:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:l,onProgress:c}){return poll({check:l=>info(e,{publicKey:t,baseURL:n,signal:l,source:i,integration:r,userAgent:s,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then((e=>e.isReady?e:(c&&c({isComputable:!0,value:1}),!1))),signal:l})}function isGroupFileInfo(e){return"defaultEffects"in e}class UploadcareFile{uuid;name;size;isStored;isImage;mimeType;cdnUrl;s3Url;originalFilename;imageInfo;videoInfo;contentInfo;metadata;s3Bucket;defaultEffects=null;constructor(e,{baseCDN:t=defaultSettings.baseCDN,fileName:n}={}){const{uuid:i,s3Bucket:r}=e,s=getUrl(t,i+"/"),o=r?getUrl("https://"+r+".s3.amazonaws.com/",i+"/"+e.filename):null;this.uuid=i,this.name=n||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=s,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=r||null,this.s3Url=o,isGroupFileInfo(e)&&(this.defaultEffects=e.defaultEffects)}}const uploadDirect=(e,{publicKey:t,fileName:n,baseURL:i,secureSignature:r,secureExpire:s,store:o,contentType:a,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,baseCDN:p,metadata:f})=>base(e,{publicKey:t,fileName:n,contentType:a,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,metadata:f}).then((({file:e})=>isReadyPoll(e,{publicKey:t,baseURL:i,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,onProgress:c,signal:l}))).then((e=>new UploadcareFile(e,{baseCDN:p}))),uploadFromUploaded=(e,{publicKey:t,fileName:n,baseURL:i,signal:r,onProgress:s,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d,baseCDN:u})=>info(e,{publicKey:t,baseURL:i,signal:r,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d}).then((e=>new UploadcareFile(e,{baseCDN:u,fileName:n}))).then((e=>(s&&s({isComputable:!0,value:1}),e))),race=(e,{signal:t}={})=>{let n=null,i=null;const r=e.map((()=>new AbortController));return onCancel(t,(()=>{r.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const s=(o=t,()=>{i=o,r.forEach(((e,t)=>t!==o&&e.abort()))});var o;return Promise.resolve().then((()=>e({stopRace:s,signal:r[t].signal}))).then((e=>(s(),e))).catch((e=>(n=e,null)))}))).then((e=>{if(null===i)throw n;return e[i]}))};var WebSocket=window.WebSocket;class Events{events=Object.create({});emit(e,t){this.events[e]?.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}}const response=(e,t)=>"success"===e?{status:Status.Success,...t}:"progress"===e?{status:Status.Progress,...t}:{status:Status.Error,...t};class Pusher{key;disconnectTime;ws=void 0;queue=[];isConnected=!1;subscribers=0;emmitter=new Events;disconnectTimeoutId=null;constructor(e,t=3e4){this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e="wss://ws.pusherapp.com/app/"+this.key+"?protocol=5&client=js&version=1.12.2";this.ws=new WebSocket(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,response(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){const n=JSON.stringify({event:e,data:t});this.ws?.send(n)}subscribe(e,t){this.subscribers+=1,this.connect();const n="task-status-"+e,i={event:"pusher:subscribe",data:{channel:n}};this.emmitter.on(n,t),this.isConnected?this.send(i.event,i.data):this.queue.push(i)}unsubscribe(e){this.subscribers-=1;const t="task-status-"+e,n={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(n.event,n.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}}let pusher=null;const getPusher=e=>{if(!pusher){const t="undefined"==typeof window?0:3e4;pusher=new Pusher(e,t)}return pusher},preconnect=e=>{getPusher(e).connect()};function pollStrategy({token:e,publicKey:t,baseURL:n,integration:i,userAgent:r,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o,onProgress:a,signal:l}){return poll({check:l=>fromUrlStatus(e,{publicKey:t,baseURL:n,integration:i,userAgent:r,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:o,signal:l}).then((t=>{switch(t.status){case Status.Error:return new UploadError(t.error,t.errorCode);case Status.Waiting:return!1;case Status.Unknown:return new UploadError('Token "'+e+'" was not found.');case Status.Progress:return a&&("unknown"===t.total?a({isComputable:!1}):a({isComputable:!0,value:t.done/t.total})),!1;case Status.Success:return a&&a({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:l})}const pushStrategy=({token:e,pusherKey:t,signal:n,onProgress:i})=>new Promise(((r,s)=>{const o=getPusher(t),a=o.onError(s),l=()=>{a(),o.unsubscribe(e)};onCancel(n,(()=>{l(),s(new CancelError("pusher cancelled"))})),o.subscribe(e,(e=>{switch(e.status){case Status.Progress:i&&("unknown"===e.total?i({isComputable:!1}):i({isComputable:!0,value:e.done/e.total}));break;case Status.Success:l(),i&&i({isComputable:!0,value:e.done/e.total}),r(e);break;case Status.Error:l(),s(new UploadError(e.msg,e.error_code))}}))})),uploadFromUrl=(e,{publicKey:t,fileName:n,baseURL:i,baseCDN:r,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,onProgress:u,source:h,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,pusherKey:f=defaultSettings.pusherKey,metadata:y})=>Promise.resolve(preconnect(f)).then((()=>fromUrl(e,{publicKey:t,fileName:n,baseURL:i,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,source:h,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,metadata:y}))).catch((e=>{const t=getPusher(f);return t?.disconnect(),Promise.reject(e)})).then((e=>e.type===TypeEnum.FileInfo?e:race([({signal:n})=>pollStrategy({token:e.token,publicKey:t,baseURL:i,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,onProgress:u,signal:n}),({signal:t})=>pushStrategy({token:e.token,pusherKey:f,signal:t,onProgress:u})],{signal:d}))).then((e=>{if(e instanceof UploadError)throw e;return e})).then((e=>isReadyPoll(e.uuid,{publicKey:t,baseURL:i,integration:m,userAgent:g,retryThrottledRequestMaxTimes:p,onProgress:u,signal:d}))).then((e=>new UploadcareFile(e,{baseCDN:r}))),memo=new WeakMap,getBlobFromReactNativeAsset=async e=>{if(memo.has(e))return memo.get(e);const t=await fetch(e.uri).then((e=>e.blob()));return memo.set(e,t),t},getFileSize=async e=>{if(isFile(e)||isBlob(e))return e.size;if(isReactNativeAsset(e))return(await getBlobFromReactNativeAsset(e)).size;throw new Error("Unknown file type. Cannot determine file size.")},isMultipart=(e,t=defaultSettings.multipartMinFileSize)=>e>=t,isUuid=e=>{const t=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!isFileData(e)&&t.test(e)},isUrl=e=>{const t=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!isFileData(e)&&t.test(e)},runWithConcurrency=(e,t)=>new Promise(((n,i)=>{const r=[];let s=!1,o=t.length;const a=[...t],l=()=>{const e=t.length-a.length,c=a.shift();c&&c().then((t=>{s||(r[e]=t,o-=1,o?l():n(r))})).catch((e=>{s=!0,i(e)}))};for(let t=0;t<e;t++)l()})),sliceChunk=(e,t,n,i)=>{const r=i*t,s=Math.min(r+i,n);return e.slice(r,s)},prepareChunks=async(e,t,n)=>i=>sliceChunk(e,i,t,n),uploadPart=(e,t,{publicKey:n,contentType:i,onProgress:r,signal:s,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>multipartUpload(e,t,{contentType:i,onProgress:r,signal:s,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),uploadMultipart=async(e,{publicKey:t,fileName:n,fileSize:i,baseURL:r,secureSignature:s,secureExpire:o,store:a,signal:l,onProgress:c,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,contentType:p,multipartChunkSize:f=defaultSettings.multipartChunkSize,maxConcurrentRequests:y=defaultSettings.maxConcurrentRequests,baseCDN:b,metadata:O})=>{const w=i??await getFileSize(e);let v;const S=(e,t)=>{if(!c)return;v||(v=Array(e).fill(0));return n=>{var i;n.isComputable&&(v[t]=n.value,c({isComputable:!0,value:(i=v,i.reduce(((e,t)=>e+t),0)/e)}))}};return p||=getContentType(e),multipartStart(w,{publicKey:t,contentType:p,fileName:n||getFileName(e),baseURL:r,secureSignature:s,secureExpire:o,store:a,signal:l,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,metadata:O}).then((async({uuid:n,parts:i})=>{const r=await prepareChunks(e,w,f);return Promise.all([n,runWithConcurrency(y,i.map(((e,n)=>()=>uploadPart(r(n),e,{publicKey:t,contentType:p,onProgress:S(i.length,n),signal:l,integration:u,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g}))))])})).then((([e])=>multipartComplete(e,{publicKey:t,baseURL:r,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g}))).then((e=>e.isReady?e:isReadyPoll(e.uuid,{publicKey:t,baseURL:r,source:d,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,onProgress:c,signal:l}))).then((e=>new UploadcareFile(e,{baseCDN:b})))};async function uploadFile(e,{publicKey:t,fileName:n,baseURL:i=defaultSettings.baseURL,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:g,multipartMinFileSize:p,multipartChunkSize:f,maxConcurrentRequests:y,baseCDN:b=defaultSettings.baseCDN,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:w,pusherKey:v,metadata:S}){if(isFileData(e)){const O=await getFileSize(e);return isMultipart(O,p)?uploadMultipart(e,{publicKey:t,contentType:g,multipartChunkSize:f,fileSize:O,fileName:n,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,maxConcurrentRequests:y,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b,metadata:S}):uploadDirect(e,{publicKey:t,fileName:n,contentType:g,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b,metadata:S})}if(isUrl(e))return uploadFromUrl(e,{publicKey:t,fileName:n,baseURL:i,baseCDN:b,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:w,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,pusherKey:v,metadata:S});if(isUuid(e))return uploadFromUploaded(e,{publicKey:t,fileName:n,baseURL:i,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:b});throw new TypeError('File uploading from "'+e+'" is not supported')}class UploadcareGroup{uuid;filesCount;totalSize;isStored;isImage;cdnUrl;files;createdAt;storedAt=null;constructor(e,{baseCDN:t=defaultSettings.baseCDN}={}){this.uuid=e.id,this.filesCount=e.filesCount;const n=e.files.filter(Boolean);this.totalSize=Object.values(n).reduce(((e,t)=>e+t.size),0),this.isStored=!!e.datetimeStored,this.isImage=!!Object.values(n).filter((e=>e.isImage)).length,this.cdnUrl=e.cdnUrl,this.files=n.map((e=>new UploadcareFile(e,{baseCDN:t}))),this.createdAt=e.datetimeCreated,this.storedAt=e.datetimeStored}}const isFileDataArray=e=>{for(const t of e)if(!isFileData(t))return!1;return!0},isUuidArray=e=>{for(const t of e)if(!isUuid(t))return!1;return!0},isUrlArray=e=>{for(const t of e)if(!isUrl(t))return!1;return!0};function uploadFileGroup(e,{publicKey:t,fileName:n,baseURL:i=defaultSettings.baseURL,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:g,multipartChunkSize:p=defaultSettings.multipartChunkSize,baseCDN:f=defaultSettings.baseCDN,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:b,jsonpCallback:O}){if(!isFileDataArray(e)&&!isUrlArray(e)&&!isUuidArray(e))throw new TypeError('Group uploading from "'+e+'" is not supported');let w,v=!0;const S=e.length,T=(e,t)=>{if(!l)return;w||(w=Array(e).fill(0));return n=>{if(!n.isComputable||!v)return v=!1,void l({isComputable:!1});var i;w[t]=n.value,l({isComputable:!0,value:(i=w,i.reduce(((e,t)=>e+t))/e)})}};return Promise.all(e.map(((e,l)=>isFileData(e)||isUrl(e)?uploadFile(e,{publicKey:t,fileName:n,baseURL:i,secureSignature:r,secureExpire:s,store:o,signal:a,onProgress:T(S,l),source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:g,multipartChunkSize:p,baseCDN:f,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:b}).then((e=>e.uuid)):e))).then((e=>group(e,{publicKey:t,baseURL:i,jsonpCallback:O,secureSignature:r,secureExpire:s,signal:a,source:c,integration:d,userAgent:u,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m}).then((e=>new UploadcareGroup(e,{baseCDN:f}))).then((e=>(l&&l({isComputable:!0,value:1}),e)))))}class Queue{_concurrency=1;_pending=[];_running=0;_resolvers=new Map;_rejectors=new Map;constructor(e){this._concurrency=e}_run(){const e=this._concurrency-this._running;for(let t=0;t<e;t++){const e=this._pending.shift();if(!e)return;const t=this._resolvers.get(e),n=this._rejectors.get(e);if(!t||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,e().finally((()=>{this._resolvers.delete(e),this._rejectors.delete(e),this._running-=1,this._run()})).then((e=>t(e))).catch((e=>n(e)))}}add(e){return new Promise(((t,n)=>{this._resolvers.set(e,t),this._rejectors.set(e,n),this._pending.push(e),this._run()}))}get pending(){return this._pending.length}get running(){return this._running}set concurrency(e){this._concurrency=e,this._run()}get concurrency(){return this._concurrency}}const blockCtx=()=>({}),activityBlockCtx=e=>({...blockCtx(),"*currentActivity":null,"*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{e.set$({"*currentActivity":null,"*modalActive":!1})}}),uploaderBlockCtx=e=>({...activityBlockCtx(e),"*commonProgress":0,"*uploadList":[],"*uploadQueue":new Queue(1),"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set,"*secureUploadsManager":null});var en={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"{{count}} of {{total}} selected","select-all":"Select all","deselect-all":"Deselect all","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You’ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You’ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error ocurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded.","file-item-edit-button":"Edit","file-item-remove-button":"Remove","a11y-editor-tab-filters":"Filters","a11y-editor-tab-tuning":"Tuning","a11y-editor-tab-crop":"Crop","a11y-activity-header-button-close":"Close",flip:"Flip",mirror:"Mirror","a11y-cloud-editor-apply-filter":"Apply {{name}} filter","a11y-cloud-editor-apply-crop":"Apply {{name}} operation","a11y-cloud-editor-apply-tuning":"Apply {{name}} tuning",finished:"Finished",failed:"Failed",uploading:"Uploading",idle:"Idle","a11y-file-item-status":"File {{fileName}} in status {{status}}"};const localeRegistry=new Map,localeResolvers=new Map,defineLocaleSync=(e,t)=>{localeRegistry.has(e)&&console.log("Locale "+e+" is already defined. Overwriting..."),localeRegistry.set(e,{...en,...t})},defineLocaleAsync=(e,t)=>{localeResolvers.set(e,t)},defineLocale=(e,t)=>{"function"==typeof t?defineLocaleAsync(e,t):defineLocaleSync(e,t)},resolveLocaleDefinition=async e=>{if(!localeRegistry.has(e)){if(!localeResolvers.has(e))throw new Error("Locale "+e+" is not defined");const t=localeResolvers.get(e),n=await t();defineLocaleSync(e,n)}return localeRegistry.get(e)};defineLocale("en",en);const localeStateKey=e=>"*l10n/"+e,DEFAULT_LOCALE="en";class LocaleManager{_blockInstance=null;_localeName="";_callbacks=new Set;_boundBlocks=new Map;constructor(e){this._blockInstance=e;for(let[e,t]of Object.entries(en))this._blockInstance.add(localeStateKey(e),t,!1);setTimeout((()=>{e.subConfigValue("localeName",(async e=>{if(!this._blockInstance||!e)return;this._localeName=e;const t=await resolveLocaleDefinition(e);if(e!==DEFAULT_LOCALE&&this._localeName!==e)return;const n=this._blockInstance.cfg.localeDefinitionOverride?.[e];for(const[e,i]of Object.entries(t)){const t=n?.[e];this._blockInstance.add(localeStateKey(e),t??i,!0);for(const e of this._callbacks)e()}})),e.subConfigValue("localeDefinitionOverride",(e=>{if(!e)return;const t=e[this._localeName];if(t)for(const[e,n]of Object.entries(t)){this._blockInstance?.add(localeStateKey(e),n,!0);for(const e of this._callbacks)e()}}))}))}onLocaleChange(e){const t=debounce(e,0);return this._callbacks.add(t),()=>{this._callbacks.delete(t)}}bindL10n(e,t,n){e.$[t]=n(),this._boundBlocks.has(e)||this._boundBlocks.set(e,new Map),this._boundBlocks.get(e)?.get(t)?.();const i=this.onLocaleChange((()=>{e.$[t]=n()}));this._boundBlocks.get(e)?.set(t,i)}destroyL10nBindings(e){const t=this._boundBlocks.get(e);if(t){for(const e of t.values())e();this._boundBlocks.delete(e)}}destroy(){this._callbacks.clear()}}function l10nProcessor(e,t){[...e.querySelectorAll("[l10n]")].forEach((e=>{let n=e.getAttribute("l10n");if(!n)return;let i="textContent",r=!1;if(n.includes(":")){const e=n.split(":");i=e[0],n=e[1],i.startsWith("@")&&(i=i.slice(1),r=!0)}const s=n;t.has(s)&&t.sub(s,(n=>{if(!n)return;t.l10nProcessorSubs.has(s)||t.l10nProcessorSubs.set(s,new Set);const r=t.l10nProcessorSubs.get(s);r?.forEach((e=>{e.remove(),r.delete(e),t.allSubs.delete(e)}));const o=localeStateKey(n).replace("*","");t.nodeCtx.has(o)||t.nodeCtx.add(o,n);const a=t.nodeCtx.sub(o,(()=>{e[i]=t.l10n(n)}));r?.add(a),t.allSubs.add(a),e.removeAttribute("l10n")}));const o=localeStateKey(n);t.has(o)||t.add(o,""),t.sub(o,(()=>{r?e.setAttribute(i,t.l10n(n)):e[i]=t.l10n(n)})),e.removeAttribute("l10n")}))}const sharedConfigKey=e=>"*cfg/"+e,ROLES={button:["toolbar"],checkbox:["toolbar"],menuitem:["menu","menubar"],option:["listbox"],tab:["tablist"]};function focus(e,t){t.tabIndex=0,t.focus(),e.tabIndex=-1}function findGroupNodeByEventTarget(e){let t=e.role||e.type||e.tagName;if(!t)return null;let n=ROLES[t.toLowerCase()];if(!n)return null;for(let t of n){let n=e.closest("[role="+t+"]");if(n)return n}}function getItems(e,t){return"toolbar"===t.role?getToolbarItems(t):t.querySelectorAll("[role="+e.role+"]")}function getToolbarItems(e){return[...e.querySelectorAll("*")].filter((e=>"button"===e.role||"button"===e.type||"checkbox"===e.role||"checkbox"===e.type))}function isHorizontalOrientation(e){let t=e.getAttribute("aria-orientation");if("vertical"===t)return!1;if("horizontal"===t)return!0;let n=e.role;return"menubar"===n||"tablist"===n||"toolbar"===n}function focusGroupKeyUX(e){return e=>{let t=!1,n=0,i="";function r(t){let r=findGroupNodeByEventTarget(t.target);if(!r)return void s();let o=getItems(t.target,r),a=Array.from(o).indexOf(t.target),l="ArrowDown",c="ArrowUp";if(isHorizontalOrientation(r)&&("rtl"===e.document.dir?(l="ArrowLeft",c="ArrowRight"):(l="ArrowRight",c="ArrowLeft")),t.key===l)t.preventDefault(),focus(t.target,o[a+1]||o[0]);else if(t.key===c)t.preventDefault(),focus(t.target,o[a-1]||o[o.length-1]);else if("Home"===t.key)t.preventDefault(),focus(t.target,o[0]);else if("End"===t.key)t.preventDefault(),focus(t.target,o[o.length-1]);else if(1===t.key.length&&"tablist"!==r.role){let e=Date.now();e-n<=300?i+=t.key.toLowerCase():i=t.key.toLowerCase(),n=e;let r=Array.from(o).find((e=>e.textContent?.trim()?.toLowerCase()?.startsWith(i)));r&&(t.preventDefault(),focus(t.target,r))}}function s(){t=!1,e.removeEventListener("keydown",r)}function o(n){let i=findGroupNodeByEventTarget(n.target);if(i){t||(t=!0,e.addEventListener("keydown",r));let s=getItems(n.target,i);for(let e of s)e!==n.target&&e.setAttribute("tabindex",-1)}else t&&s()}function a(t){t.relatedTarget&&t.relatedTarget!==e.document||s()}function l(e){let t=findGroupNodeByEventTarget(e.target);if(t){let n=getItems(e.target,t);for(let t of n)t!==e.target&&t.setAttribute("tabindex",-1);e.target.setAttribute("tabindex",0)}}return e.addEventListener("click",l),e.addEventListener("focusin",o),e.addEventListener("focusout",a),()=>{s(),e.removeEventListener("click",l),e.removeEventListener("focusin",o),e.removeEventListener("focusout",a)}}}function hiddenKeyUX(){return e=>{let t,n;function i(e){if("true"===e.target.getAttribute("aria-hidden")){t=e.target,t.setAttribute("aria-hidden","false"),n=t.hidden,n&&(t.hidden=!1);let i=e.target.querySelector('a, button, select, textarea, input:not([type=radio]), [type=radio]:checked, [tabindex]:not([tabindex="-1"])');i&&(i.tabIndex=0)}}function r(e){!t||!t.contains(e.target)||e.relatedTarget&&t.contains(e.relatedTarget)||(e.target.tabIndex=-1,t.setAttribute("aria-hidden","true"),n&&(t.hidden=!0),t=null)}return e.addEventListener("keyuxJump",i),e.addEventListener("focusout",r),()=>{e.removeEventListener("keyuxJump",i),e.removeEventListener("focusout",r)}}}function jumpKeyUX(){return e=>{let t=[];function n(){let i=t.pop();if(!i)return void e.document.activeElement.blur();let r=i.deref();r&&r.isConnected?r.focus():n()}let i,r=0;function s(s){s.target.getAttribute("aria-controls")&&"Enter"===s.key&&function(n){clearInterval(i);let s=n.getAttribute("aria-controls");i=setInterval((()=>{if(r++>50)return void clearInterval(i);let n=e.document.getElementById(s);if(n){let r=n.querySelector('a, button, select, textarea, input:not([type=radio]), [type=radio]:checked, [tabindex]:not([tabindex="-1"])');r&&(clearInterval(i),n.dispatchEvent(new e.CustomEvent("keyuxJump",{bubbles:!0})),function(n){let i=e.document.activeElement;i&&i!==e.document.body&&t.push(new WeakRef(i)),n.focus({focusVisible:!0})}(r))}}),50)}(s.target),"Escape"===s.key&&n()}return e.addEventListener("keydown",s),()=>{e.removeEventListener("keydown",s)}}}function pressKeyUX(e){let t,n,i=e.split(" ");function r(e){"Enter"!==e.key||"BUTTON"!==e.target.tagName&&"A"!==e.target.tagName||(s(),e.target.classList.add(...i),t=e.target,n=e.target)}function s(){t&&t.classList.remove(...i),n=null}function o(e){0===e.clientX&&0===e.clientY&&n!==e.target&&(s(),e.target.classList.add(...i),t=e.target)}return e=>(e.addEventListener("click",o),e.addEventListener("keydown",r),e.addEventListener("keyup",s),()=>{e.removeEventListener("click",o),e.removeEventListener("keydown",r),e.removeEventListener("keyup",s)})}function startKeyUX(e,t){let n=t.map((t=>t(e)));return()=>{n.forEach((e=>e()))}}class ScopedMinimalWindow{_listeners=new Map;_scope=[];addEventListener(e,t){const n=e=>{const n=e.target;n&&this._scope.some((t=>t===e.target||t.contains(n)))&&t(e)};this._listeners.set(t,n),window.addEventListener(e,n)}removeEventListener(e,t){const n=this._listeners.get(t);n&&window.removeEventListener(e,n),this._listeners.delete(t)}get CustomEvent(){return window.CustomEvent}get document(){return window.document}get navigator(){return window.navigator}registerScope(e){this._scope.push(e)}destroy(){this._scope=[],this._listeners.forEach(((e,t)=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",e),this._listeners.delete(t)}))}}class A11y{_destroyKeyUX;_scopedWindow;constructor(){this._scopedWindow=new ScopedMinimalWindow,this._destroyKeyUX=startKeyUX(this._scopedWindow,[focusGroupKeyUX(),pressKeyUX("is-pressed"),jumpKeyUX(),hiddenKeyUX()])}registerBlock(e){this._scopedWindow.registerScope(e)}destroy(){this._destroyKeyUX?.(),this._scopedWindow.destroy()}}const TAG_PREFIX="uc-";class Block extends BaseComponent{static StateConsumerScope=null;static styleAttrs=[];requireCtxName=!1;activityType=null;init$=blockCtx();l10n(e,t={}){if(!e)return"";let n=this.$[localeStateKey(e)]||e,i=getPluralObjects(n);for(let e of i)t[e.variable]=this.pluralize(e.pluralKey,Number(t[e.countVariable]));return applyTemplateData(n,t)}pluralize(e,t){const n=this.l10n("locale-id")||"en",i=getPluralForm(n,t);return this.l10n(e+"__"+i)}bindL10n(e,t){this.localeManager?.bindL10n(this,e,t)}constructor(){super(),this.l10nProcessorSubs=new Map,this.addTemplateProcessor(l10nProcessor)}emit(e,t,n){const i=this.has("*eventEmitter")&&this.$["*eventEmitter"];i&&i.emit(e,t,n)}hasBlockInCtx(e){for(let t of this.blocksRegistry)if(e(t))return!0;return!1}setOrAddState(e,t){this.add$({[e]:t},!0)}connectedCallback(){this.constructor.styleAttrs.forEach((e=>{this.setAttribute(e,"")})),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?waitForAttribute({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),WindowHeightTracker.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),WindowHeightTracker.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new EventEmitter(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new LocaleManager(this)),this.has("*a11y")||this.add("*a11y",new A11y),this.sub(localeStateKey("locale-id"),(e=>{const t=getLocaleDirection(e);this.style.direction="ltr"===t?"":t}))}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}get a11y(){return this.has("*a11y")?this.$["*a11y"]:null}get blocksRegistry(){return this.$["*blocksRegistry"]}destroyCallback(){super.destroyCallback();let e=this.blocksRegistry;e?.delete(this),this.localeManager?.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,Data.deleteCtx(this),0===e?.size&&setTimeout((()=>{this.destroyCtxCallback()}),0)}destroyCtxCallback(){Data.deleteCtx(this.ctxName),this.localeManager?.destroy()}async proxyUrl(e){if(this.cfg.secureDeliveryProxy&&this.cfg.secureDeliveryProxyUrlResolver&&console.warn("Both secureDeliveryProxy and secureDeliveryProxyUrlResolver are set. The secureDeliveryProxyUrlResolver will be used."),this.cfg.secureDeliveryProxyUrlResolver)try{return await this.cfg.secureDeliveryProxyUrlResolver(e,{uuid:extractUuid(e),cdnUrlModifiers:extractCdnUrlModifiers(e),fileName:extractFilename(e)})}catch(t){return console.error("Failed to resolve secure delivery proxy URL. Falling back to the default URL.",t),e}return this.cfg.secureDeliveryProxy?applyTemplateData(this.cfg.secureDeliveryProxy,{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(e,t,n)=>{if("string"!=typeof t)return!1;const i=sharedConfigKey(t);return this.has(i)||this.add(i,initialConfig[t]),this.$[i]=n,!0},get:(e,t)=>{const n=sharedConfigKey(t);return this.has(n)||this.add(n,initialConfig[t]),this.$[sharedConfigKey(t)]}})}return this.__cfgProxy}subConfigValue(e,t){const n=sharedConfigKey(e);this.has(n)||this.add(n,initialConfig[e]),this.sub(n,t)}debugPrint(...e){if(!this.cfg.debug)return;let t=e;"function"==typeof e?.[0]&&(t=(0,e[0])()),console.log("["+this.ctxName+"]",...t)}static reg(e){e?e.startsWith(TAG_PREFIX)&&super.reg(e):super.reg()}}var svgIconsSprite$1="<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 24 24' id='uc-icon-about' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.152 14.12v.1h1.523v-.1c.007-.409.053-.752.138-1.028.086-.277.22-.517.405-.72.188-.202.434-.397.735-.586.32-.191.593-.412.82-.66.232-.249.41-.531.533-.847.125-.32.187-.678.187-1.076 0-.579-.137-1.085-.41-1.518a2.717 2.717 0 0 0-1.14-1.018c-.49-.245-1.062-.367-1.715-.367-.597 0-1.142.114-1.636.34-.49.228-.884.564-1.182 1.008-.299.44-.46.98-.485 1.619h1.62c.024-.377.118-.684.282-.922a1.48 1.48 0 0 1 .617-.532c.25-.114.51-.17.784-.17.301 0 .575.063.82.191.248.124.447.302.597.533.149.23.223.504.223.82 0 .263-.05.502-.149.72a1.91 1.91 0 0 1-.405.574 3.48 3.48 0 0 1-.575.453 4.22 4.22 0 0 0-.847.66c-.234.242-.415.558-.543.949-.125.39-.19.916-.197 1.577Zm.053 3.03c.21.206.46.31.75.31.196 0 .374-.049.534-.144a1.1 1.1 0 0 0 .383-.384c.1-.163.15-.343.15-.538a1 1 0 0 0-.32-.746 1.019 1.019 0 0 0-.746-.314c-.291 0-.542.105-.751.314-.21.206-.314.455-.314.746 0 .295.104.547.314.756ZM24 12c0 6.627-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0s12 5.373 12 12Zm-1.5 0c0 5.799-4.701 10.5-10.5 10.5S1.5 17.799 1.5 12 6.201 1.5 12 1.5 22.5 6.201 22.5 12Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-add' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.75 21a.75.75 0 0 1-1.5 0v-8.25H3a.75.75 0 0 1 0-1.5h8.25V3a.75.75 0 0 1 1.5 0v8.25H21a.75.75 0 0 1 0 1.5h-8.25V21Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-arrow-down' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.5 23.03a.75.75 0 0 0 .999 0l9.29-8.276a.75.75 0 0 0-.998-1.12l-8.042 7.164V1.53a.75.75 0 0 0-1.5 0v19.267l-8.04-7.163a.75.75 0 0 0-.998 1.12z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-back' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M20.251 12a.75.75 0 0 1-.75.75H6.067l5.72 5.85a.75.75 0 1 1-1.072 1.05L4.136 12.92a1.292 1.292 0 0 1 0-1.842l6.579-6.728a.75.75 0 1 1 1.072 1.048l-5.72 5.851H19.5a.75.75 0 0 1 .75.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.6 18.4a1.6 1.6 0 1 1-3.2 0 1.6 1.6 0 0 1 3.2 0zM12 4.5A1.5 1.5 0 0 1 13.5 6v7a1.5 1.5 0 0 1-3 0V6A1.5 1.5 0 0 1 12 4.5z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-success' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m10.5 18.204 7.6-8.183a1.5 1.5 0 0 0-2.2-2.042l-5.4 5.817-2.4-2.586a1.5 1.5 0 1 0-2.2 2.041l4.6 4.953Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-box' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M1.01 4.148a.75.75 0 0 1 .75.75v4.348a4.437 4.437 0 0 1 2.988-1.153c1.734 0 3.23.992 3.978 2.438a4.478 4.478 0 0 1 3.978-2.438c2.49 0 4.488 2.044 4.488 4.543 0 2.5-1.999 4.544-4.488 4.544a4.478 4.478 0 0 1-3.978-2.438 4.478 4.478 0 0 1-3.978 2.438C2.26 17.18.26 15.135.26 12.636V4.898a.75.75 0 0 1 .75-.75Zm.75 8.488c0 1.692 1.348 3.044 2.988 3.044s2.989-1.352 2.989-3.044c0-1.691-1.349-3.043-2.989-3.043S1.76 10.945 1.76 12.636Zm10.944-3.043c-1.64 0-2.988 1.352-2.988 3.043 0 1.692 1.348 3.044 2.988 3.044s2.988-1.352 2.988-3.044c0-1.69-1.348-3.043-2.988-3.043Zm4.328-1.23a.75.75 0 0 1 1.052.128l2.333 2.983 2.333-2.983a.75.75 0 0 1 1.181.924l-2.562 3.277 2.562 3.276a.75.75 0 1 1-1.181.924l-2.333-2.983-2.333 2.983a.75.75 0 1 1-1.181-.924l2.562-3.276-2.562-3.277a.75.75 0 0 1 .129-1.052Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.65 2.55a.75.75 0 0 1 .6-.3h7.5a.75.75 0 0 1 .6.3l2.025 2.7H21a3 3 0 0 1 3 3v10.5a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h2.625zm.975 1.2L6.6 6.45a.75.75 0 0 1-.6.3H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V8.25a1.5 1.5 0 0 0-1.5-1.5h-3a.75.75 0 0 1-.6-.3l-2.025-2.7zm3.375 6a3.375 3.375 0 1 0 0 6.75 3.375 3.375 0 0 0 0-6.75zm-4.875 3.375a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-camera-full' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' clip-rule='evenodd' d='M2 4.667a2 2 0 0 0-2 2V16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6.667a2 2 0 0 0-2-2h-2.667l-2-2.667H6.667l-2 2.667H2Zm8 10a3.667 3.667 0 1 0 0-7.334 3.667 3.667 0 0 0 0 7.334Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-close' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M4.604 4.604a.75.75 0 0 1 1.06 0L12 10.939l6.335-6.335a.75.75 0 1 1 1.061 1.06L13.061 12l6.335 6.335a.75.75 0 1 1-1.06 1.061L12 13.061l-6.335 6.335a.75.75 0 0 1-1.061-1.06L10.939 12 4.604 5.665a.75.75 0 0 1 0-1.061z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-collapse' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3.116 12a.75.75 0 0 1 .75-.75h16.268a.75.75 0 0 1 0 1.5H3.866a.75.75 0 0 1-.75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-default' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-dropbox' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.019 1.92a.75.75 0 0 1 .806 0L12 5.219l5.176-3.297a.75.75 0 0 1 .806 0l5.577 3.553a.75.75 0 0 1 0 1.265l-4.574 2.914 4.574 2.914a.75.75 0 0 1 0 1.265l-5.577 3.554a.75.75 0 0 1-.806 0L12 14.089l-5.175 3.297a.75.75 0 0 1-.806 0L.44 13.833a.75.75 0 0 1 0-1.266l4.575-2.914L.44 6.74a.75.75 0 0 1 0-1.265zm.403 8.616L2.24 13.2l4.182 2.664 4.181-2.664zm6.975 2.664 4.182 2.664L21.76 13.2l-4.181-2.664zm2.776-3.547L12 12.311 7.828 9.653 12 6.995zm1.406-.882 4.181-2.664-4.181-2.664-4.182 2.664zm-6.976-2.664L6.422 3.443 2.24 6.107 6.422 8.77zM5.791 18.544a.75.75 0 0 1 1.035-.23l5.175 3.297 5.175-3.297a.75.75 0 1 1 .806 1.265l-5.578 3.554a.75.75 0 0 1-.806 0L6.02 19.579a.75.75 0 0 1-.23-1.035z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-evernote' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M9.804 2.27v-.048c.055-.263.313-.562.85-.562h.44c.142 0 .325.014.526.033.066.009.124.023.267.06l.13.032h.002c.319.079.515.275.644.482a1.461 1.461 0 0 1 .16.356l.004.012a.75.75 0 0 0 .603.577l1.191.207a1988.512 1988.512 0 0 0 2.332.402c.512.083 1.1.178 1.665.442.64.3 1.19.795 1.376 1.77.548 2.931.657 5.829.621 8a39.233 39.233 0 0 1-.125 2.602 17.518 17.518 0 0 1-.092.849.735.735 0 0 0-.024.112c-.378 2.705-1.269 3.796-2.04 4.27-.746.457-1.53.451-2.217.447h-.192c-.46 0-1.073-.23-1.581-.635-.518-.412-.763-.87-.763-1.217 0-.45.188-.688.355-.786.161-.095.436-.137.796.087a.75.75 0 1 0 .792-1.274c-.766-.476-1.64-.52-2.345-.108-.7.409-1.098 1.188-1.098 2.08 0 .996.634 1.84 1.329 2.392.704.56 1.638.96 2.515.96l.185.002c.667.009 1.874.025 3.007-.67 1.283-.786 2.314-2.358 2.733-5.276a4.213 4.213 0 0 0 .056-.335c.023-.184.051-.445.079-.772.055-.655.111-1.585.13-2.704.037-2.234-.074-5.239-.647-8.301v-.002c-.294-1.544-1.233-2.391-2.215-2.85-.777-.363-1.623-.496-2.129-.576a8.872 8.872 0 0 1-.25-.041l-.006-.001-1.99-.345-.761-.132a2.93 2.93 0 0 0-.182-.338A2.532 2.532 0 0 0 12.379.329l-.091-.023a3.967 3.967 0 0 0-.493-.103L11.769.2a7.846 7.846 0 0 0-.675-.04h-.44c-.733 0-1.368.284-1.795.742L2.416 7.431c-.468.428-.751 1.071-.751 1.81 0 .02 0 .041.003.062l.003.034c.017.21.038.468.096.796.107.715.275 1.47.391 1.994.029.13.055.245.075.342l.002.008c.258 1.141.641 1.94.978 2.466.168.263.323.456.444.589a2.808 2.808 0 0 0 .192.194c1.536 1.562 3.713 2.196 5.731 2.08.13-.005.35-.032.537-.073a2.627 2.627 0 0 0 .652-.24c.425-.26.75-.661.992-1.046.184-.294.342-.61.473-.915a3.8 3.8 0 0 0 .627.493 5.022 5.022 0 0 0 1.97.709l.023.002.018.003.11.016c.088.014.205.035.325.058l.056.014c.088.022.164.04.235.061a1.736 1.736 0 0 1 .145.048l.03.014c.765.34 1.302 1.09 1.302 1.871a.75.75 0 0 0 1.5 0c0-1.456-.964-2.69-2.18-3.235a3.595 3.595 0 0 0-.679-.217l-.063-.015a10.616 10.616 0 0 0-.606-.105l-.02-.003-.03-.003h-.002a3.542 3.542 0 0 1-1.331-.485c-.471-.298-.788-.692-.828-1.234a.75.75 0 0 0-1.48-.106l-.001.003-.004.017a8.23 8.23 0 0 1-.092.352 9.963 9.963 0 0 1-.298.892c-.132.34-.29.68-.47.966-.174.276-.339.454-.478.549a1.178 1.178 0 0 1-.221.072 1.949 1.949 0 0 1-.241.036h-.013l-.032.002c-1.684.1-3.423-.437-4.604-1.65a.746.746 0 0 0-.053-.05L4.84 14.6a1.348 1.348 0 0 1-.07-.073 2.99 2.99 0 0 1-.293-.392c-.242-.379-.558-1.014-.778-1.985a54.1 54.1 0 0 0-.083-.376 27.494 27.494 0 0 1-.367-1.872l-.003-.02a6.791 6.791 0 0 1-.08-.67c.004-.277.086-.475.2-.609l.067-.067a.63.63 0 0 1 .292-.145h.05c.18 0 1.095.055 2.013.115l1.207.08.534.037a.747.747 0 0 0 .052.002c.782 0 1.349-.206 1.759-.585l.005-.005c.553-.52.622-1.225.622-1.76V6.24l-.026-.565A774.97 774.97 0 0 1 9.885 4.4c-.042-.961-.081-1.939-.081-2.13ZM4.995 6.953a251.126 251.126 0 0 1 2.102.137l.508.035c.48-.004.646-.122.715-.185.07-.068.146-.209.147-.649l-.024-.548a791.69 791.69 0 0 1-.095-2.187L4.995 6.953Zm16.122 9.996Zm-5.479-5.323a.75.75 0 0 0 1.014.31 2.04 2.04 0 0 1 .304-.089 1.84 1.84 0 0 1 .544-.039c.215.023.321.06.37.085.033.016.039.026.047.04a.75.75 0 0 0 1.289-.767c-.337-.567-.906-.783-1.552-.85a3.334 3.334 0 0 0-1.002.062c-.27.056-.531.14-.705.234a.75.75 0 0 0-.31 1.014Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-expand' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m12 8.337-8.47 8.47a.75.75 0 0 1-1.06-1.06l8.605-8.606a1.29 1.29 0 0 1 1.85 0l8.605 8.605a.75.75 0 1 1-1.06 1.06L12 8.338Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-external-source-placeholder' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-facebook' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12 1.5C6.201 1.5 1.5 6.201 1.5 12c0 4.943 3.416 9.089 8.016 10.204v-6.108H7.383a.75.75 0 0 1-.75-.75v-3.281a.75.75 0 0 1 .75-.75h2.133V9.393c0-.958.225-2.511 1.38-3.65 1.194-1.177 3.174-1.718 6.254-1.056a.75.75 0 0 1 .592.733v2.754a.75.75 0 0 1-.75.75c-.692 0-1.203.026-1.584.082-.387.057-.578.137-.675.202-.109.073-.237.205-.237 1.029v1.078h2.39a.75.75 0 0 1 .742.866l-.516 3.281a.75.75 0 0 1-.74.634h-1.876v6.106C19.09 21.082 22.5 16.939 22.5 12c0-5.799-4.701-10.5-10.5-10.5zM0 12C0 5.373 5.373 0 12 0s12 5.373 12 12c0 5.995-4.395 10.961-10.138 11.856a.75.75 0 0 1-.866-.74v-7.77a.75.75 0 0 1 .75-.75h1.984l.28-1.781h-2.264a.75.75 0 0 1-.75-.75v-1.828c0-.829.089-1.729.9-2.274.363-.244.807-.37 1.293-.441a9.623 9.623 0 0 1 1.053-.086V6.04c-2.41-.405-3.645.132-4.293.771-.737.728-.933 1.793-.933 2.582v2.672a.75.75 0 0 1-.75.75H8.133v1.78h2.133a.75.75 0 0 1 .75.75v7.772a.75.75 0 0 1-.865.741C4.4 22.968 0 18 0 12z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M2.895 1.201c0-.473.383-.857.857-.857h8.4c.227 0 .445.09.606.251l8.4 8.4c.16.16.25.379.25.606v13.2a.857.857 0 0 1-.856.857h-16.8a.857.857 0 0 1-.857-.857zm1.714.857v19.886h15.085V10.458h-7.542a.857.857 0 0 1-.858-.857V2.058zm8.4 1.213 5.473 5.473H13.01z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-flickr' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M5.959 7.926c-2.298 0-4.14 1.834-4.14 4.073 0 2.241 1.842 4.075 4.14 4.075 2.302 0 4.145-1.834 4.145-4.075 0-2.238-1.843-4.073-4.145-4.073Zm-5.64 4.073c0-3.086 2.533-5.573 5.64-5.573 3.11 0 5.645 2.486 5.645 5.573 0 3.089-2.535 5.575-5.645 5.575-3.107 0-5.64-2.487-5.64-5.575Zm18.07-4.073c-2.301 0-4.144 1.835-4.144 4.073 0 2.24 1.843 4.075 4.145 4.075 2.299 0 4.141-1.834 4.141-4.075 0-2.239-1.842-4.073-4.141-4.073Zm-5.644 4.073c0-3.087 2.535-5.573 5.645-5.573 3.108 0 5.641 2.487 5.641 5.573 0 3.088-2.533 5.575-5.641 5.575-3.11 0-5.645-2.486-5.645-5.575Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gdrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.736 1.818a.75.75 0 0 1 .647-.37h7.587a.75.75 0 0 1 .655.383l7.233 12.946a.75.75 0 0 1-.003.737l-3.794 6.66a.75.75 0 0 1-.651.378H4.59a.75.75 0 0 1-.651-.378l-3.794-6.66a.75.75 0 0 1 .005-.75zm.64 1.876L1.663 15.148l2.93 5.145 6.655-11.581zm3.736 6.526-2.398 4.173H14.5zm4.116 4.173h5.697L15.53 2.947H9.677zm5.685 1.5H8.852l-2.966 5.16h13.088z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gphotos' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.51 0c-.702 0-1.272.57-1.272 1.273V7.35A6.381 6.381 0 0 0 0 11.489c0 .703.57 1.273 1.273 1.273H7.35A6.381 6.381 0 0 0 11.488 24c.704 0 1.274-.57 1.274-1.273V16.65A6.381 6.381 0 0 0 24 12.51c0-.703-.57-1.273-1.273-1.273H16.65A6.381 6.381 0 0 0 12.511 0Zm.252 11.232V1.53a4.857 4.857 0 0 1 0 9.702Zm-1.53.006H1.53a4.857 4.857 0 0 1 9.702 0Zm1.536 1.524a4.857 4.857 0 0 0 9.702 0h-9.702Zm-6.136 4.857c0-2.598 2.04-4.72 4.606-4.85v9.7a4.857 4.857 0 0 1-4.606-4.85Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-huddle' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.204 2.002c-.252.23-.357.486-.357.67V21.07c0 .15.084.505.313.812.208.28.499.477.929.477.519 0 .796-.174.956-.365.178-.212.286-.535.286-.924v-.013l.117-6.58c.004-1.725 1.419-3.883 3.867-3.883 1.33 0 2.332.581 2.987 1.364.637.762.95 1.717.95 2.526v6.47c0 .392.11.751.305.995.175.22.468.41 1.008.41.52 0 .816-.198 1.002-.437.207-.266.31-.633.31-.969V14.04c0-2.81-1.943-5.108-4.136-5.422a5.971 5.971 0 0 0-3.183.41c-.912.393-1.538.96-1.81 1.489a.75.75 0 0 1-1.417-.344v-7.5c0-.587-.47-1.031-1.242-1.031-.315 0-.638.136-.885.36ZM5.194.892A2.844 2.844 0 0 1 7.09.142c1.328 0 2.742.867 2.742 2.53v5.607a6.358 6.358 0 0 1 1.133-.629 7.47 7.47 0 0 1 3.989-.516c3.056.436 5.425 3.482 5.425 6.906v6.914c0 .602-.177 1.313-.627 1.89-.47.605-1.204 1.016-2.186 1.016-.96 0-1.698-.37-2.179-.973-.46-.575-.633-1.294-.633-1.933v-6.469c0-.456-.19-1.071-.602-1.563-.394-.471-.986-.827-1.836-.827-1.447 0-2.367 1.304-2.367 2.39v.014l-.117 6.58c-.001.64-.177 1.333-.637 1.881-.48.57-1.2.9-2.105.9-.995 0-1.7-.5-2.132-1.081-.41-.552-.61-1.217-.61-1.708V2.672c0-.707.366-1.341.847-1.78Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-info' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2v6Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-local' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3 3.75a1.5 1.5 0 0 0-1.5 1.5v13.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V9A1.5 1.5 0 0 0 21 7.5h-9a.75.75 0 0 1-.643-.364L9.325 3.75zm-3 1.5a3 3 0 0 1 3-3h6.75a.75.75 0 0 1 .643.364L12.425 6H21a3 3 0 0 1 3 3v9.75a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0v6.469a4.5 4.5 0 1 1-9 0V4.781Zm4.5-3a3 3 0 0 0-3 3v6.469a3 3 0 1 0 6 0V4.781a3 3 0 0 0-3-3Zm-8.156 8.11a.75.75 0 0 1 .75.75 7.406 7.406 0 1 0 14.812 0 .75.75 0 0 1 1.5 0 8.907 8.907 0 0 1-8.156 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.907 8.907 0 0 1-8.156-8.875.75.75 0 0 1 .75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone-mute' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0V6l3.524-3.524a.75.75 0 1 1 1.061 1.06L5.036 19.585a.75.75 0 0 1-1.06-1.06l1.656-1.657a8.88 8.88 0 0 1-2.538-6.227.75.75 0 0 1 1.5 0c0 2.009.8 3.83 2.1 5.166l1.771-1.772A4.483 4.483 0 0 1 7.5 11.25V4.781Zm2.037 8.182L15 7.5V4.781a3 3 0 1 0-6 0v6.469c0 .637.198 1.227.537 1.713Zm10.62-3.072a.75.75 0 0 1 .75.75 8.907 8.907 0 0 1-8.157 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.855 8.855 0 0 1-3.035-.811.75.75 0 1 1 .638-1.358 7.406 7.406 0 0 0 10.553-6.707.75.75 0 0 1 .75-.75ZM15 10.81a.75.75 0 0 1 1.5 0v.439a4.5 4.5 0 0 1-5 4.473.75.75 0 1 1 .166-1.491A3 3 0 0 0 15 11.25v-.44Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-onedrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.616 4.147a7.689 7.689 0 0 0-7.642 3.285A6.299 6.299 0 0 0 1.455 17.3c.684.894 2.473 2.658 5.17 2.658h12.141c.95 0 1.882-.256 2.697-.743.815-.486 1.514-1.247 1.964-2.083a5.26 5.26 0 0 0-3.713-7.612 7.69 7.69 0 0 0-6.098-5.373ZM3.34 17.15c.674.63 1.761 1.308 3.284 1.308h12.142a3.76 3.76 0 0 0 2.915-1.383l-7.494-4.489L3.34 17.15Zm10.875-6.25 2.47-1.038a5.239 5.239 0 0 1 1.427-.389 6.19 6.19 0 0 0-10.3-1.952 6.338 6.338 0 0 1 2.118.813l4.285 2.567Zm4.55.033c-.512 0-1.019.104-1.489.307l-.006.003-1.414.594 6.521 3.906a3.76 3.76 0 0 0-3.357-4.8l-.254-.01ZM4.097 9.617A4.799 4.799 0 0 1 6.558 8.9c.9 0 1.84.25 2.587.713l3.4 2.037-10.17 4.28a4.799 4.799 0 0 1 1.721-6.312Z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-pause' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' d='M1 0h2.5v10H1zM6.5 0H9v10H6.5z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-play' xmlns='http://www.w3.org/2000/svg'><path d='m1 0 9 5-9 5V0Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-remove-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.955 3.3A2.969 2.969 0 0 0 8.998 6h5.914a2.97 2.97 0 0 0-2.957-2.7zM16.416 6a4.47 4.47 0 0 0-8.922 0h-2.32a.755.755 0 0 0-.111.008H3.075a.75.75 0 1 0 0 1.5h1.35V19.35a2.85 2.85 0 0 0 2.85 2.85h9.45a2.85 2.85 0 0 0 2.85-2.85V7.508h1.35a.75.75 0 0 0 0-1.5h-1.989A.754.754 0 0 0 18.825 6zM5.925 7.508V19.35a1.35 1.35 0 0 0 1.35 1.35h9.45a1.35 1.35 0 0 0 1.35-1.35V7.508z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-select' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m7 10 5 5 5-5H7Z'/></symbol><symbol fill='none' viewBox='0 0 20 20' id='uc-icon-square' xmlns='http://www.w3.org/2000/svg'><rect width='20' height='20' rx='4' fill='#fff'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-url' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M19.11 3.67c-1.71-1.709-4.578-1.682-6.408.148l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221C14.018.381 17.836.276 20.17 2.61l1.22 1.22c2.335 2.334 2.23 6.153-.147 8.529l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221c1.83-1.83 1.856-4.698.147-6.408zm-3.36 4.58a.75.75 0 0 1 0 1.06l-6.439 6.44a.75.75 0 0 1-1.06-1.06l6.439-6.44a.75.75 0 0 1 1.06 0zM6.04 9.42a.75.75 0 0 1 0 1.061l-2.222 2.222c-1.83 1.83-1.856 4.698-.147 6.407l1.22 1.22c1.71 1.71 4.578 1.683 6.408-.147l2.221-2.221a.75.75 0 1 1 1.06 1.06l-2.22 2.222c-2.377 2.376-6.195 2.481-8.53.147l-1.22-1.22c-2.334-2.334-2.228-6.153.148-8.53l2.221-2.22a.75.75 0 0 1 1.06 0z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-video-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M0 6.75a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v1.078L22.873 5A.75.75 0 0 1 24 5.648v12.704a.75.75 0 0 1-1.123.65L18 16.207v1.043a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V6.75Zm18 7.728 4.5 2.58V6.95L18 9.562v4.916ZM16.5 6.75a1.5 1.5 0 0 0-1.5-1.5H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5V6.75Z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-video-camera-full' xmlns='http://www.w3.org/2000/svg'><path d='M2 3.333a2 2 0 0 0-2 2v9.334a2 2 0 0 0 2 2h10.938a2 2 0 0 0 2-2v-2.013L20 15.646V4.354l-5.063 3.03v-2.05a2 2 0 0 0-2-2H2Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-vk' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol></svg>";class SolutionBlock extends Block{static styleAttrs=["uc-wgt-common"];requireCtxName=!0;init$=uploaderBlockCtx(this);_template=null;initCallback(){super.initCallback(),this.a11y?.registerBlock(this)}static set template(e){this._template=svgIconsSprite$1+e+"<slot></slot>"}static get template(){return this._template}}const ACTIVE_ATTR="active",ACTIVE_PROP="___ACTIVITY_IS_ACTIVE___";class ActivityBlock extends Block{historyTracked=!1;init$=activityBlockCtx(this);_debouncedHistoryFlush=debounce(this._historyFlush.bind(this),10);_deactivate(){let e=ActivityBlock._activityCallbacks.get(this);this[ACTIVE_PROP]=!1,this.removeAttribute(ACTIVE_ATTR),e?.deactivateCallback?.()}_activate(){let e=ActivityBlock._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[ACTIVE_PROP]=!0,this.setAttribute(ACTIVE_ATTR,""),e?.activateCallback?.(),this._debouncedHistoryFlush(),this.emit(EventType.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",(e=>{this.setAttribute("current-activity",e)})),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(e=>{try{this.activityType!==e&&this[ACTIVE_PROP]?this._deactivate():this.activityType!==e||this[ACTIVE_PROP]||this._activate()}catch(e){console.error('Error in activity "'+this.activityType+'". ',e),this.$["*currentActivity"]=this.$["*history"][this.$["*history"].length-1]??null}e||(this.$["*history"]=[])})),this.has("*modalActive")&&this.sub("*modalActive",(e=>{e||this.activityType!==this.$["*currentActivity"]||(this.$["*currentActivity"]=null)})))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e[e.length-1]!==this.activityType&&e.push(this.activityType),this.$["*history"]=e)}_isActivityRegistered(){return this.activityType&&ActivityBlock._activityCallbacks.has(this)}static _activityCallbacks=new Map;get isActivityActive(){return this[ACTIVE_PROP]}get couldOpenActivity(){return!0}registerActivity(e,t={}){const{onActivate:n,onDeactivate:i}=t;ActivityBlock._activityCallbacks.set(this,{activateCallback:n,deactivateCallback:i})}unregisterActivity(){this.isActivityActive&&this._deactivate(),ActivityBlock._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();const e=this.$["*currentActivity"];[...this.blocksRegistry].find((t=>t instanceof ActivityBlock&&t.activityType===e))||(this.$["*currentActivity"]=null,this.setOrAddState("*modalActive",!1))}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();let n=!!t;if(t){const e=[...this.blocksRegistry].find((e=>e.activityType===t));n=e?.couldOpenActivity??!1}t=n?t:void 0,this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.setOrAddState("*modalActive",!1)}}}ActivityBlock.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external"});const CROP_PADDING=20,THUMB_CORNER_SIZE=24,THUMB_SIDE_SIZE=34,THUMB_STROKE_WIDTH=3,THUMB_OFFSET=THUMB_STROKE_WIDTH/2,GUIDE_STROKE_WIDTH=1,GUIDE_THIRD=100/3,MIN_CROP_SIZE=1,MAX_INTERACTION_SIZE=24,MIN_INTERACTION_SIZE=6;function setSvgNodeAttrs(e,t){for(let n in t)e.setAttributeNS(null,n,t[n].toString())}function createSvgNode(e,t={}){let n=document.createElementNS("http://www.w3.org/2000/svg",e);return setSvgNodeAttrs(n,t),n}function cornerPath(e,t,n){let{x:i,y:r,width:s,height:o}=e,a=t.includes("w")?0:1,l=t.includes("n")?0:1,c=[-1,1][a],d=[-1,1][l],u=[i+a*s+THUMB_OFFSET*c,r+l*o+THUMB_OFFSET*d-THUMB_CORNER_SIZE*n*d],h=[i+a*s+THUMB_OFFSET*c,r+l*o+THUMB_OFFSET*d],m=[i+a*s-THUMB_CORNER_SIZE*n*c+THUMB_OFFSET*c,r+l*o+THUMB_OFFSET*d];return{d:"M "+u[0]+" "+u[1]+" L "+h[0]+" "+h[1]+" L "+m[0]+" "+m[1],center:h}}function sidePath(e,t,n){let i,r,{x:s,y:o,width:a,height:l}=e,c=["n","s"].includes(t)?.5:{w:0,e:1}[t],d=["w","e"].includes(t)?.5:{n:0,s:1}[t],u=[-1,1][c],h=[-1,1][d];return["n","s"].includes(t)?(i=[s+c*a-THUMB_SIDE_SIZE*n/2,o+d*l+THUMB_OFFSET*h],r=[s+c*a+THUMB_SIDE_SIZE*n/2,o+d*l+THUMB_OFFSET*h]):(i=[s+c*a+THUMB_OFFSET*u,o+d*l-THUMB_SIDE_SIZE*n/2],r=[s+c*a+THUMB_OFFSET*u,o+d*l+THUMB_SIDE_SIZE*n/2]),{d:"M "+i[0]+" "+i[1]+" L "+r[0]+" "+r[1],center:[r[0]-(r[0]-i[0])/2,r[1]-(r[1]-i[1])/2]}}function thumbCursor(e){return""===e?"move":["e","w"].includes(e)?"ew-resize":["n","s"].includes(e)?"ns-resize":["nw","se"].includes(e)?"nwse-resize":"nesw-resize"}function moveRect({rect:e,delta:[t,n],imageBox:i}){return constraintRect({...e,x:e.x+t,y:e.y+n},i)}function constraintRect(e,t){let{x:n}=e,{y:i}=e;return e.x<t.x?n=t.x:e.x+e.width>t.x+t.width&&(n=t.x+t.width-e.width),e.y<t.y?i=t.y:e.y+e.height>t.y+t.height&&(i=t.y+t.height-e.height),{...e,x:n,y:i}}function resizeNorth({rect:e,delta:t,aspectRatio:n,imageBox:i}){const[,r]=t;let{y:s,width:o,height:a}=e;s+=r,a-=r,n&&(o=a*n);let l=e.x+e.width/2-o/2;return s<=i.y&&(s=i.y,a=e.y+e.height-s,n&&(o=a*n,l=e.x+e.width/2-o/2)),l<=i.x&&(l=i.x,s=e.y+e.height-a),l+o>=i.x+i.width&&(l=Math.max(i.x,i.x+i.width-o),o=i.x+i.width-l,n&&(a=o/n),s=e.y+e.height-a),a<MIN_CROP_SIZE&&(a=MIN_CROP_SIZE,n&&(o=a*n,l=e.x+e.width/2-o/2),s=e.y+e.height-a),o<MIN_CROP_SIZE&&(o=MIN_CROP_SIZE,n&&(a=o/n,l=e.x+e.width/2-o/2),s=e.y+e.height-a),{x:l,y:s,width:o,height:a}}function resizeWest({rect:e,delta:t,aspectRatio:n,imageBox:i}){const[r]=t;let{x:s,width:o,height:a}=e;s+=r,o-=r,n&&(a=o/n);let l=e.y+e.height/2-a/2;return s<=i.x&&(s=i.x,o=e.x+e.width-s,n&&(a=o/n,l=e.y+e.height/2-a/2)),l<=i.y&&(l=i.y,s=e.x+e.width-o),l+a>=i.y+i.height&&(l=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-l,n&&(o=a*n),s=e.x+e.width-o),a<MIN_CROP_SIZE&&(a=MIN_CROP_SIZE,n&&(o=a*n),l=e.y+e.height/2-a/2,s=e.x+e.width-o),o<MIN_CROP_SIZE&&(o=MIN_CROP_SIZE,n&&(a=o/n),l=e.y+e.height/2-a/2,s=e.x+e.width-o),{x:s,y:l,width:o,height:a}}function resizeSouth({rect:e,delta:t,aspectRatio:n,imageBox:i}){const[,r]=t;let{y:s,width:o,height:a}=e;a+=r,n&&(o=a*n);let l=e.x+e.width/2-o/2;return s+a>=i.y+i.height&&(a=i.y+i.height-s,n&&(o=a*n),l=e.x+e.width/2-o/2),l<=i.x&&(l=i.x,s=e.y),l+o>=i.x+i.width&&(l=Math.max(i.x,i.x+i.width-o),o=i.x+i.width-l,n&&(a=o/n),s=e.y),a<MIN_CROP_SIZE&&(a=MIN_CROP_SIZE,n&&(o=a*n),l=e.x+e.width/2-o/2),o<MIN_CROP_SIZE&&(o=MIN_CROP_SIZE,n&&(a=o/n),l=e.x+e.width/2-o/2),{x:l,y:s,width:o,height:a}}function resizeEast({rect:e,delta:t,aspectRatio:n,imageBox:i}){const[r]=t;let{x:s,width:o,height:a}=e;o+=r,n&&(a=o/n);let l=e.y+e.height/2-a/2;return s+o>=i.x+i.width&&(o=i.x+i.width-s,n&&(a=o/n),l=e.y+e.height/2-a/2),l<=i.y&&(l=i.y,s=e.x),l+a>=i.y+i.height&&(l=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-l,n&&(o=a*n),s=e.x),a<MIN_CROP_SIZE&&(a=MIN_CROP_SIZE,n&&(o=a*n),l=e.y+e.height/2-a/2),o<MIN_CROP_SIZE&&(o=MIN_CROP_SIZE,n&&(a=o/n),l=e.y+e.height/2-a/2),{x:s,y:l,width:o,height:a}}function resizeNorthWest({rect:e,delta:t,aspectRatio:n,imageBox:i}){let[r,s]=t,{x:o,y:a,width:l,height:c}=e;return o+r<i.x&&(r=i.x-o),a+s<i.y&&(s=i.y-a),o+=r,l-=r,a+=s,c-=s,n&&Math.abs(l/c)>n?(s=l/n-c,c+=s,a-=s,a<=i.y&&(c-=i.y-a,l=c*n,o=e.x+e.width-l,a=i.y)):n&&(r=c*n-l,l+=r,o-=r,o<=i.x&&(l-=i.x-o,c=l/n,o=i.x,a=e.y+e.height-c)),c<MIN_CROP_SIZE&&(c=MIN_CROP_SIZE,n&&(l=c*n),o=e.x+e.width-l,a=e.y+e.height-c),l<MIN_CROP_SIZE&&(l=MIN_CROP_SIZE,n&&(c=l/n),o=e.x+e.width-l,a=e.y+e.height-c),{x:o,y:a,width:l,height:c}}function resizeNorthEast({rect:e,delta:t,aspectRatio:n,imageBox:i}){let[r,s]=t,{x:o,y:a,width:l,height:c}=e;return o+l+r>i.x+i.width&&(r=i.x+i.width-o-l),a+s<i.y&&(s=i.y-a),l+=r,a+=s,c-=s,n&&Math.abs(l/c)>n?(s=l/n-c,c+=s,a-=s,a<=i.y&&(c-=i.y-a,l=c*n,o=e.x,a=i.y)):n&&(r=c*n-l,l+=r,o+l>=i.x+i.width&&(l=i.x+i.width-o,c=l/n,o=i.x+i.width-l,a=e.y+e.height-c)),c<MIN_CROP_SIZE&&(c=MIN_CROP_SIZE,n&&(l=c*n),a=e.y+e.height-c),l<MIN_CROP_SIZE&&(l=MIN_CROP_SIZE,n&&(c=l/n),a=e.y+e.height-c),{x:o,y:a,width:l,height:c}}function resizeSouthWest({rect:e,delta:t,aspectRatio:n,imageBox:i}){let[r,s]=t,{x:o,y:a,width:l,height:c}=e;return o+r<i.x&&(r=i.x-o),a+c+s>i.y+i.height&&(s=i.y+i.height-a-c),o+=r,l-=r,c+=s,n&&Math.abs(l/c)>n?(s=l/n-c,c+=s,a+c>=i.y+i.height&&(c=i.y+i.height-a,l=c*n,o=e.x+e.width-l,a=i.y+i.height-c)):n&&(r=c*n-l,l+=r,o-=r,o<=i.x&&(l-=i.x-o,c=l/n,o=i.x,a=e.y)),c<MIN_CROP_SIZE&&(c=MIN_CROP_SIZE,n&&(l=c*n),o=e.x+e.width-l),l<MIN_CROP_SIZE&&(l=MIN_CROP_SIZE,n&&(c=l/n),o=e.x+e.width-l),{x:o,y:a,width:l,height:c}}function resizeSouthEast({rect:e,delta:t,aspectRatio:n,imageBox:i}){let[r,s]=t,{x:o,y:a,width:l,height:c}=e;return o+l+r>i.x+i.width&&(r=i.x+i.width-o-l),a+c+s>i.y+i.height&&(s=i.y+i.height-a-c),l+=r,c+=s,n&&Math.abs(l/c)>n?(s=l/n-c,c+=s,a+c>=i.y+i.height&&(c=i.y+i.height-a,l=c*n,o=e.x,a=i.y+i.height-c)):n&&(r=c*n-l,l+=r,o+l>=i.x+i.width&&(l=i.x+i.width-o,c=l/n,o=i.x+i.width-l,a=e.y)),c<MIN_CROP_SIZE&&(c=MIN_CROP_SIZE,n&&(l=c*n)),l<MIN_CROP_SIZE&&(l=MIN_CROP_SIZE,n&&(c=l/n)),{x:o,y:a,width:l,height:c}}function resizeRect({direction:e,...t}){switch(e){case"n":return resizeNorth(t);case"w":return resizeWest(t);case"s":return resizeSouth(t);case"e":return resizeEast(t);case"nw":return resizeNorthWest(t);case"ne":return resizeNorthEast(t);case"sw":return resizeSouthWest(t);case"se":return resizeSouthEast(t);default:return t.rect}}function rectContainsPoint(e,[t,n]){return e.x<=t&&t<=e.x+e.width&&e.y<=n&&n<=e.y+e.height}function isRectInsideRect(e,t){return e.x>=t.x&&e.y>=t.y&&e.x+e.width<=t.x+t.width&&e.y+e.height<=t.y+t.height}function isRectMatchesAspectRatio(e,t){return Math.abs(e.width/e.height-t)<.1}function rotateSize({width:e,height:t},n){let i=n/90%2!=0;return{width:i?t:e,height:i?e:t}}function calculateMaxCenteredCropFrame(e,t,n){let i,r;e/t>n?(i=Math.round(t*n),r=t):(i=e,r=Math.round(e/n));const s=Math.round((e-i)/2),o=Math.round((t-r)/2);return s+i>e&&(i=e-s),o+r>t&&(r=t-o),{x:s,y:o,width:i,height:r}}function roundRect(e){return{x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}}function clamp(e,t,n){return Math.min(Math.max(e,t),n)}const parseCropPreset=e=>{if(!e)return[];const[t,n]=e.split(":").map(Number);if(Number.isFinite(t)&&Number.isFinite(n))return[{type:"aspect-ratio",width:t,height:n}];console.error("Invalid crop preset: "+e)},PACKAGE_NAME="blocks",PACKAGE_VERSION="1.12.0";function customUserAgent(e){return getUserAgent$1({...e,libraryName:PACKAGE_NAME,libraryVersion:PACKAGE_VERSION})}const msToUnixTimestamp=e=>Math.floor(e/1e3),isSecureTokenExpired=(e,{threshold:t})=>{const{secureExpire:n}=e,i=msToUnixTimestamp(Date.now()),r=Number(n);return i+msToUnixTimestamp(t)>=r};class SecureUploadsManager{_block;_secureToken=null;constructor(e){this._block=e}_debugPrint(...e){this._block.debugPrint("[secure-uploads]",...e)}async getSecureToken(){const{secureSignature:e,secureExpire:t,secureUploadsSignatureResolver:n}=this._block.cfg;if((e||t)&&n&&console.warn("Both secureSignature/secureExpire and secureUploadsSignatureResolver are set. secureUploadsSignatureResolver will be used."),n){if(!this._secureToken||isSecureTokenExpired(this._secureToken,{threshold:this._block.cfg.secureUploadsExpireThreshold})){this._secureToken?this._debugPrint("Secure signature is expired. Resolving a new one..."):this._debugPrint("Secure signature is not set yet.");try{const e=await n();e?e.secureSignature&&e.secureExpire?(this._debugPrint("Secure signature resolved:",e),this._debugPrint("Secure signature will expire in",new Date(1e3*Number(e.secureExpire)).toISOString()),this._secureToken=e):console.error("Secure signature resolver returned an invalid result:",e):(this._debugPrint("Secure signature resolver returned nothing."),this._secureToken=null)}catch(e){console.error("Secure signature resolving failed. Falling back to the previous one.",e)}}return this._secureToken}return e&&t?(this._debugPrint("Secure signature and expire are set. Using them...",{secureSignature:e,secureExpire:t}),{secureSignature:e,secureExpire:t}):null}}const MSG_NAME="[Typed State] Wrong property name: ",MSG_TYPE="[Typed State] Wrong property type: ";class TypedData{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||UID.generate(),this.__schema=Object.keys(e).reduce(((t,n)=>(t[n]=e[n].value,t)),{}),this.__data=Data.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e))return void console.warn(MSG_NAME+e);let n=this.__typedSchema[e];t?.constructor===n.type||t instanceof n.type||n.nullable&&null===t?this.__data.pub(e,t):console.warn(MSG_TYPE+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(this.__typedSchema.hasOwnProperty(e))return this.__data.read(e);console.warn(MSG_NAME+e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){Data.deleteCtx(this.__ctxId)}}class TypedCollection{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||UID.generate(),this.__data=Data.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(e,n)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(n),this.__observeTimeout=window.setTimeout((()=>{0!==Object.keys(t).length&&(this.__propertyObservers.forEach((e=>{e({...t})})),t=Object.create(null))}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{let e=new Set(this.__added),t=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(const n of this.__collectionObservers)n?.([...this.__items],e,t)}))}observeCollection(e){return this.__collectionObservers.add(e),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(e)}}unobserveCollection(e){this.__collectionObservers?.delete(e)}add(e){let t=new TypedData(this.__typedSchema);for(let n in e)t.setValue(n,e[n]);return this.__items.add(t.uid),this.notify(),this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach((e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,(()=>{this.__notifyObservers(e,t.uid)})))})),t.uid}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,n){this.read(e).setValue(t,n)}remove(e){this.__removed.add(this.__data.read(e)),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach((e=>{this.remove(e)}))}observeProperties(e){return this.__propertyObservers.add(e),()=>{this.unobserveProperties(e)}}unobserveProperties(e){this.__propertyObservers?.delete(e)}findItems(e){let t=[];return this.__items.forEach((n=>{let i=this.read(n);e(i)&&t.push(n)})),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){Data.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach((e=>{e.remove()})),delete this.__subsMap[e]}}const ExternalUploadSource=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),UploadSource=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",CAMERA:"camera",EXTERNAL:"external",API:"js-api",URL:"url",DRAW:"draw",...ExternalUploadSource}),IMAGE_ACCEPT_LIST=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],mergeFileTypes=e=>e?e.filter((e=>"string"==typeof e)).map((e=>stringToArray(e))).flat():[],matchMimeType=(e,t)=>t.some((t=>t.endsWith("*")?(t=t.replace("*",""),e.startsWith(t)):e===t)),matchExtension=(e,t)=>t.some((t=>!!t.startsWith(".")&&e.toLowerCase().endsWith(t.toLowerCase()))),fileIsImage=e=>{let t=e?.type;return!!t&&matchMimeType(t,IMAGE_ACCEPT_LIST)},uuidRegex=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,cdnUrlRegex=new RegExp("^/?("+uuidRegex.source+")(?:/(-/(?:[^/]+/)+)?([^/]*))?$","i"),parseCdnUrl=({url:e,cdnBase:t})=>{const n=new URL(t),i=new URL(e);if(n.host!==i.host)return null;const[,r,s,o]=cdnUrlRegex.exec(i.pathname);return{uuid:r,cdnUrlModifiers:s||"",filename:o||null}},memoize$1=e=>{const t=new Map;return(...n)=>{const i=JSON.stringify(n);if(t.has(i))return t.get(i);const r=e(...n);return t.set(i,r),r}},warnings=new Set;function warnOnce(e){warnings.has(e)||(warnings.add(e),console.warn(e))}function createAsyncAssertWrapper(e){let t=!1;return setTimeout((()=>{t=!0}),0),n=>(...i)=>(t&&warnOnce(e),n(...i))}function buildOutputCollectionState(e){const t={progress:()=>e.$["*commonProgress"],errors:()=>e.$["*collectionErrors"],group:()=>e.$["*groupInfo"],totalCount:()=>e.uploadCollection.size,failedCount:()=>n.failedEntries.length,successCount:()=>n.successEntries.length,uploadingCount:()=>n.uploadingEntries.length,status:()=>n.isFailed?"failed":n.isUploading?"uploading":n.isSuccess?"success":"idle",isSuccess:()=>n.allEntries.length>0&&0===n.errors.length&&n.successEntries.length===n.allEntries.length,isUploading:()=>n.allEntries.some((e=>"uploading"===e.status)),isFailed:()=>n.errors.length>0||n.failedEntries.length>0,allEntries:()=>e.getOutputData(),successEntries:()=>n.allEntries.filter((e=>"success"===e.status)),failedEntries:()=>n.allEntries.filter((e=>"failed"===e.status)),uploadingEntries:()=>n.allEntries.filter((e=>"uploading"===e.status)),idleEntries:()=>n.allEntries.filter((e=>"idle"===e.status))},n={},i=createAsyncAssertWrapper("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`");for(const[e,r]of Object.entries(t)){const t=e,s=memoize$1(i(r));Object.defineProperty(n,t,{get:s,enumerable:!0})}return n}class UploaderPublicApi{_ctx;constructor(e){this._ctx=e}get _uploadCollection(){return this._ctx.uploadCollection}get cfg(){return this._ctx.cfg}get l10n(){return this._ctx.l10n.bind(this._ctx)}addFileFromUrl=(e,{silent:t,fileName:n,source:i}={})=>{const r=this._uploadCollection.add({externalUrl:e,fileName:n??null,silent:t??!1,source:i??UploadSource.API});return this.getOutputItem(r)};addFileFromUuid=(e,{silent:t,fileName:n,source:i}={})=>{const r=this._uploadCollection.add({uuid:e,fileName:n??null,silent:t??!1,source:i??UploadSource.API});return this.getOutputItem(r)};addFileFromCdnUrl=(e,{silent:t,fileName:n,source:i}={})=>{const r=parseCdnUrl({url:e,cdnBase:this.cfg.cdnCname});if(!r)throw new Error("Invalid CDN URL");const s=this._uploadCollection.add({uuid:r.uuid,cdnUrl:e,cdnUrlModifiers:r.cdnUrlModifiers,fileName:n??r.filename??null,silent:t??!1,source:i??UploadSource.API});return this.getOutputItem(s)};addFileFromObject=(e,{silent:t,fileName:n,source:i,fullPath:r}={})=>{const s=this._uploadCollection.add({file:e,isImage:fileIsImage(e),mimeType:e.type,fileName:n??e.name,fileSize:e.size,silent:t??!1,source:i??UploadSource.API,fullPath:r??null});return this.getOutputItem(s)};removeFileByInternalId=e=>{if(!this._uploadCollection.read(e))throw new Error("File with internalId "+e+" not found");this._uploadCollection.remove(e)};removeAllFiles(){this._uploadCollection.clearAll()}uploadAll=()=>{const e=this._uploadCollection.items().filter((e=>{const t=this._uploadCollection.read(e);return!t.getValue("isRemoved")&&!t.getValue("isUploading")&&!t.getValue("fileInfo")}));0!==e.length&&(this._ctx.$["*uploadTrigger"]=new Set(e),this._ctx.emit(EventType.COMMON_UPLOAD_START,this.getOutputCollectionState()))};openSystemDialog=(e={})=>{const t=serializeCsv(mergeFileTypes([this.cfg.accept??"",...this.cfg.imgOnly?IMAGE_ACCEPT_LIST:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list.");const n="uploadcare-file-input",i=document.createElement("input");i.setAttribute(n,""),applyStyles(i,{opacity:0,height:0,width:0,visibility:"hidden"}),i.type="file",i.multiple=this.cfg.multiple,e.captureCamera?(i.capture=this.cfg.cameraCapture,i.accept=this.cfg.enableVideoRecording?["image/*","video/*"].join(","):"image/*"):i.accept=t,i.addEventListener("change",(()=>{i.files&&([...i.files].forEach((t=>this.addFileFromObject(t,{source:e.captureCamera?UploadSource.CAMERA:UploadSource.LOCAL}))),this._ctx.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST,this._ctx.setOrAddState("*modalActive",!0),i.remove())}),{once:!0}),document.querySelectorAll("["+n+"]").forEach((e=>e.remove())),document.body.appendChild(i),i.dispatchEvent(new MouseEvent("click"))};getOutputItem=e=>{const t=Data.getCtx(e).store,n=t.fileInfo;let i=t.isRemoved?"removed":t.errors.length>0?"failed":t.fileInfo?"success":t.isUploading?"uploading":"idle";return{uuid:n?.uuid??t.uuid??null,internalId:e,name:n?.originalFilename??t.fileName,size:n?.size??t.fileSize,isImage:n?.isImage??t.isImage,mimeType:n?.mimeType??t.mimeType,file:t.file,externalUrl:t.externalUrl,cdnUrlModifiers:t.cdnUrlModifiers,cdnUrl:t.cdnUrl??n?.cdnUrl??null,fullPath:t.fullPath,uploadProgress:t.uploadProgress,fileInfo:n??null,metadata:t.metadata??n?.metadata??null,isSuccess:"success"===i,isUploading:"uploading"===i,isFailed:"failed"===i,isRemoved:"removed"===i,errors:t.errors,status:i,source:t?.source}};getOutputCollectionState=()=>buildOutputCollectionState(this._ctx);initFlow=(e=!1)=>{if(this._uploadCollection.size>0&&!e)this._ctx.set$({"*currentActivity":ActivityBlock.activities.UPLOAD_LIST}),this._ctx.setOrAddState("*modalActive",!0);else if(1===this._sourceList?.length){const e=this._sourceList[0];if("local"===e)return this._ctx.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST,void this.openSystemDialog();const t=[...this._ctx.$["*blocksRegistry"]].find((t=>"type"in t&&t.type===e));t?.activate(),this._ctx.$["*currentActivity"]&&this._ctx.setOrAddState("*modalActive",!0)}else this._ctx.set$({"*currentActivity":ActivityBlock.activities.START_FROM}),this._ctx.setOrAddState("*modalActive",!0)};doneFlow=()=>{this._ctx.set$({"*currentActivity":this._ctx.doneActivity,"*history":this._ctx.doneActivity?[this._ctx.doneActivity]:[]}),this._ctx.$["*currentActivity"]||this._ctx.setOrAddState("*modalActive",!1)};setCurrentActivity=(e,t=void 0)=>{this._ctx.hasBlockInCtx((t=>t.activityType===e))?this._ctx.set$({"*currentActivityParams":t??{},"*currentActivity":e}):console.warn('Activity type "'+e+'" not found in the context')};getCurrentActivity=()=>this._ctx.$["*currentActivity"];setModalState=e=>{!e||this._ctx.$["*currentActivity"]?this._ctx.setOrAddState("*modalActive",e):console.warn('Can\'t open modal without current activity. Please use "setCurrentActivity" method first.')};get _sourceList(){let e=[];return this.cfg.sourceList&&(e=stringToArray(this.cfg.sourceList)),e}}const validateIsImage=(e,t)=>{const n=t.cfg.imgOnly,i=e.isImage;if(n&&!i&&(e.fileInfo||!e.externalUrl)&&(e.fileInfo||e.mimeType))return{type:"NOT_AN_IMAGE",message:t.l10n("images-only-accepted"),payload:{entry:e}}},validateFileType=(e,t)=>{const n=t.cfg.imgOnly,i=t.cfg.accept,r=mergeFileTypes([...n?IMAGE_ACCEPT_LIST:[],i]);if(!r.length)return;const s=e.mimeType,o=e.name;if(!s||!o)return;const a=matchMimeType(s,r),l=matchExtension(o,r);return a||l?void 0:{type:"FORBIDDEN_FILE_TYPE",message:t.l10n("file-type-not-allowed"),payload:{entry:e}}},BASE=1e3,ByteUnitEnum=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),round=e=>Math.ceil(100*e)/100,prettyBytes=(e,t=ByteUnitEnum.AUTO)=>{const n=t===ByteUnitEnum.AUTO;return t===ByteUnitEnum.BYTE||n&&e<BASE**1?e+" "+{one:"byte",other:"bytes"}[getPluralForm("en-US",e)]:t===ByteUnitEnum.KB||n&&e<BASE**2?round(e/BASE**1)+" KB":t===ByteUnitEnum.MB||n&&e<BASE**3?round(e/BASE**2)+" MB":t===ByteUnitEnum.GB||n&&e<BASE**4?round(e/BASE**3)+" GB":t===ByteUnitEnum.TB||n&&e<BASE**5?round(e/BASE**4)+" TB":round(e/BASE**5)+" PB"},validateMaxSizeLimit=(e,t)=>{const n=t.cfg.maxLocalFileSizeBytes,i=e.size;if(n&&i&&i>n)return{type:"FILE_SIZE_EXCEEDED",message:t.l10n("files-max-size-limit-error",{maxFileSize:prettyBytes(n)}),payload:{entry:e}}},validateUploadError=(e,t)=>{const{internalId:n}=e,i=t._uploadCollection.read(n),r=i?.getValue("uploadError");if(!r)return;if(r instanceof UploadError)return{type:"UPLOAD_ERROR",message:r.message,payload:{entry:e,error:r}};if(r instanceof NetworkError)return{type:"NETWORK_ERROR",message:r.message,payload:{entry:e,error:r}};const s=r instanceof Error?r:new Error("Unknown error",{cause:r});return{type:"UNKNOWN_ERROR",message:s.message,payload:{entry:e,error:s}}},validateCollectionUploadError=(e,t)=>{if(e.failedCount>0)return{type:"SOME_FILES_HAS_ERRORS",message:t.l10n("some-files-were-not-uploaded")}},validateMultiple=(e,t)=>{const n=e.totalCount,i=t.cfg.multiple?t.cfg.multipleMin:0,r=t.cfg.multiple?t.cfg.multipleMax:1;return i&&n<i?{type:"TOO_FEW_FILES",message:t.l10n("files-count-limit-error-too-few",{min:i,max:r,total:n}),payload:{total:n,min:i,max:r}}:r&&n>r?{type:"TOO_MANY_FILES",message:t.l10n("files-count-limit-error-too-many",{min:i,max:r,total:n}),payload:{total:n,min:i,max:r}}:void 0},LOGGER={file:"File validator execution has failed",collection:"Collection validator execution has failed",message:"Missing message. We recommend adding message: value."};class ValidationManager{_blockInstance;_fileValidators=[validateIsImage,validateFileType,validateMaxSizeLimit,validateUploadError];_collectionValidators=[validateMultiple,validateCollectionUploadError];constructor(e){this._blockInstance=e,this._uploadCollection=this._blockInstance.uploadCollection;const t=()=>{this.runFileValidators(),this.runCollectionValidators()};this._blockInstance.subConfigValue("maxLocalFileSizeBytes",t),this._blockInstance.subConfigValue("multipleMin",t),this._blockInstance.subConfigValue("multipleMax",t),this._blockInstance.subConfigValue("multiple",t),this._blockInstance.subConfigValue("imgOnly",t),this._blockInstance.subConfigValue("accept",t)}runFileValidators(e){const t=e??this._uploadCollection.items();for(const e of t){const t=this._uploadCollection.read(e);t&&this._runFileValidatorsForEntry(t)}}runCollectionValidators(){const e=this._blockInstance.api.getOutputCollectionState(),t=[];for(const n of[...this._collectionValidators,...this._addCustomTypeToValidators(this._blockInstance.cfg.collectionValidators)])try{const i=n(e,this._blockInstance.api);if(!i)continue;i&&(t.push(i),i.message||console.warn(LOGGER.message))}catch(e){console.warn(LOGGER.collection,e)}this._blockInstance.$["*collectionErrors"]=t,t.length>0&&this._blockInstance.emit(EventType.COMMON_UPLOAD_FAILED,(()=>this._blockInstance.api.getOutputCollectionState()),{debounce:!0})}_runFileValidatorsForEntry(e){const t=this._blockInstance.api.getOutputItem(e.uid),n=[];for(const e of[...this._fileValidators,...this._addCustomTypeToValidators(this._blockInstance.cfg.fileValidators)])try{const i=e(t,this._blockInstance.api);if(!i)continue;i&&(n.push(i),i.message||console.warn(LOGGER.message))}catch(e){console.warn(LOGGER.file,e)}e.setValue("errors",n)}_addCustomTypeToValidators(e){return e.map((e=>(...t)=>{const n=e(...t);return n?{...n,type:"CUSTOM_ERROR"}:void 0}))}}const uploadEntrySchema=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:UploadcareFile,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silent:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0},metadata:{type:Object,value:null,nullable:!0},errors:{type:Array,value:[]},uploadError:{type:Error,value:null,nullable:!0},isRemoved:{type:Boolean,value:!1}});class UploaderBlock extends ActivityBlock{couldBeCtxOwner=!1;isCtxOwner=!1;init$=uploaderBlockCtx(this);get hasCtxOwner(){return this.hasBlockInCtx((e=>e instanceof UploaderBlock&&e.isCtxOwner&&e.isConnected&&e!==this))}initCallback(){if(super.initCallback(),!this.has("*uploadCollection")){let e=new TypedCollection({typedSchema:uploadEntrySchema,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading"]});this.add("*uploadCollection",e)}this.has("*publicApi")||this.add("*publicApi",new UploaderPublicApi(this)),this.has("*validationManager")||this.add("*validationManager",new ValidationManager(this)),!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}get validationManager(){if(!this.has("*validationManager"))throw new Error("Unexpected error: ValidationManager is not initialized");return this.$["*validationManager"]}get api(){if(!this.has("*publicApi"))throw new Error("Unexpected error: UploaderPublicApi is not initialized");return this.$["*publicApi"]}getAPI(){return this.api}get uploadCollection(){if(!this.has("*uploadCollection"))throw new Error("Unexpected error: TypedCollection is not initialized");return this.$["*uploadCollection"]}destroyCtxCallback(){this._unobserveCollectionProperties?.(),this._unobserveCollection?.(),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate),this.subConfigValue("maxConcurrentRequests",(e=>{this.$["*uploadQueue"].concurrency=Number(e)||1})),this.$["*secureUploadsManager"]||(this.$["*secureUploadsManager"]=new SecureUploadsManager(this)),this.has("*modalActive")&&this.sub("*modalActive",(e=>{e&&!this.$["*currentActivity"]&&(this.$["*modalActive"]=!1)}))}async _createGroup(e){const t=await this.getUploadClientOptions(),n=e.allEntries.map((e=>e.uuid+(e.cdnUrlModifiers?"/"+e.cdnUrlModifiers:""))),i=new AbortController,r=await uploadFileGroup(n,{...t,signal:i.signal});if(this.$["*collectionState"]!==e)return void i.abort();this.$["*groupInfo"]=r;const s=this.api.getOutputCollectionState();this.emit(EventType.GROUP_CREATED,s),this.emit(EventType.CHANGE,(()=>this.api.getOutputCollectionState()),{debounce:!0}),this.$["*collectionState"]=s}_flushOutputItems=debounce((async()=>{if(this.getOutputData().length!==this.uploadCollection.size)return;const e=this.api.getOutputCollectionState();this.$["*collectionState"]=e,this.emit(EventType.CHANGE,(()=>this.api.getOutputCollectionState()),{debounce:!0}),this.cfg.groupOutput&&e.totalCount>0&&"success"===e.status&&this._createGroup(e)}),300);_handleCollectionUpdate=(e,t,n)=>{(t.size||n.size)&&(this.$["*groupInfo"]=null),this.validationManager.runFileValidators(),this.validationManager.runCollectionValidators();for(const e of t)e.getValue("silent")||this.emit(EventType.FILE_ADDED,this.api.getOutputItem(e.uid));for(const e of n)this.$["*uploadTrigger"].delete(e.uid),e.getValue("abortController")?.abort(),e.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0}),URL.revokeObjectURL(e?.getValue("thumbUrl")),this.emit(EventType.FILE_REMOVED,this.api.getOutputItem(e.uid));this.$["*uploadList"]=e.map((e=>({uid:e}))),this._flushCommonUploadProgress(),this._flushOutputItems()};_handleCollectionPropertiesUpdate=e=>{this._flushOutputItems();const t=this.uploadCollection,n=[...new Set(Object.entries(e).filter((([e])=>["uploadError","fileInfo"].includes(e))).map((([,e])=>[...e])).flat())];if(n.length>0&&setTimeout((()=>{this.validationManager.runFileValidators(n)})),e.uploadProgress){for(const t of e.uploadProgress){const{isUploading:e,silent:n}=Data.getCtx(t).store;e&&!n&&this.emit(EventType.FILE_UPLOAD_PROGRESS,this.api.getOutputItem(t))}this._flushCommonUploadProgress()}if(e.isUploading)for(const t of e.isUploading){const{isUploading:e,silent:n}=Data.getCtx(t).store;e&&!n&&this.emit(EventType.FILE_UPLOAD_START,this.api.getOutputItem(t))}if(e.fileInfo){for(const t of e.fileInfo){const{fileInfo:e,silent:n}=Data.getCtx(t).store;e&&!n&&this.emit(EventType.FILE_UPLOAD_SUCCESS,this.api.getOutputItem(t))}this.cfg.cropPreset&&this.setInitialCrop()}if(e.errors){for(const t of e.errors){const{errors:e}=Data.getCtx(t).store;e.length>0&&(this.emit(EventType.FILE_UPLOAD_FAILED,this.api.getOutputItem(t)),this.emit(EventType.COMMON_UPLOAD_FAILED,(()=>this.api.getOutputCollectionState()),{debounce:!0}))}const n=t.findItems((e=>!!e.getValue("fileInfo"))),i=t.findItems((e=>e.getValue("errors").length>0));t.size>0&&0===i.length&&t.size===n.length&&0===this.$["*collectionErrors"].length&&this.emit(EventType.COMMON_UPLOAD_SUCCESS,this.api.getOutputCollectionState())}if(e.cdnUrl){[...e.cdnUrl].filter((e=>!!this.uploadCollection.read(e)?.getValue("cdnUrl"))).forEach((e=>{this.emit(EventType.FILE_URL_CHANGED,this.api.getOutputItem(e))})),this.$["*groupInfo"]=null}};_flushCommonUploadProgress=()=>{let e=0;const t=[...this.$["*uploadTrigger"]].filter((e=>!!this.uploadCollection.read(e)));t.forEach((t=>{const n=this.uploadCollection.readProp(t,"uploadProgress");e+=n}));const n=t.length?Math.round(e/t.length):0;this.$["*commonProgress"]!==n&&(this.$["*commonProgress"]=n,this.emit(EventType.COMMON_UPLOAD_PROGRESS,this.api.getOutputCollectionState()))};setInitialCrop(){const e=parseCropPreset(this.cfg.cropPreset);if(e){const[t]=e,n=this.uploadCollection.findItems((e=>e.getValue("fileInfo")&&e.getValue("isImage")&&!e.getValue("cdnUrlModifiers")?.includes("/crop/"))).map((e=>this.uploadCollection.read(e)));for(const e of n){const n=e.getValue("fileInfo"),{width:i,height:r}=n.imageInfo,s=calculateMaxCenteredCropFrame(i,r,t.width/t.height),o=createCdnUrlModifiers("crop/"+s.width+"x"+s.height+"/"+s.x+","+s.y,"preview");e.setMultipleValues({cdnUrlModifiers:o,cdnUrl:createCdnUrl(e.getValue("cdnUrl"),o)}),1===this.uploadCollection.size&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx((e=>e.activityType===ActivityBlock.activities.CLOUD_IMG_EDIT))&&(this.$["*currentActivityParams"]={internalId:e.uid},this.$["*currentActivity"]=ActivityBlock.activities.CLOUD_IMG_EDIT)}}}async getMetadataFor(e){const t=this.cfg.metadata||void 0;if("function"==typeof t){const n=this.api.getOutputItem(e);return await t(n)}return t}async getUploadClientOptions(){const e=this.$["*secureUploadsManager"],t=await e.getSecureToken().catch((()=>null));return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:customUserAgent,integration:this.cfg.userAgentIntegration,secureSignature:t?.secureSignature,secureExpire:t?.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputData(){return this.uploadCollection.items().map((e=>this.api.getOutputItem(e)))}}UploaderBlock.extSrcList=Object.freeze({...ExternalUploadSource}),UploaderBlock.sourceTypes=Object.freeze({...UploadSource});const toKebabCase=e=>e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)?.map((e=>e.toLowerCase())).join("-"),asString=e=>String(e),asNumber=e=>{const t=Number(e);if(Number.isNaN(t))throw new Error('Invalid number: "'+e+'"');return t},asBoolean=e=>{if(null==e)return!1;if("boolean"==typeof e)return e;if("true"===e)return!0;if(""===e)return!0;if("false"===e)return!1;throw new Error('Invalid boolean: "'+e+'"')},asStore=e=>"auto"===e?e:asBoolean(e),asCameraCapture=e=>{const t=asString(e);if("user"!==t&&"environment"!==t&&""!==t)throw new Error('Invalid "cameraCapture" value: "'+t+'"');return t},asCameraTab=e=>{const t=asString(e);if("photo"!==t&&"video"!==t)throw new Error('Invalid "CameraTab" value: "'+t+'"');return t},asMetadata=e=>{if("object"==typeof e&&!Array.isArray(e))return e;if("function"==typeof e)return e;throw new Error("Invalid metadata value. Must be an object or function.")},asObject=e=>{if("object"==typeof e)return e;throw new Error("Invalid value. Must be an object.")},asFunction=e=>{if("function"==typeof e)return e;throw new Error("Invalid value. Must be a function.")},asArray=e=>{if(Array.isArray(e))return e;throw new Error("Must be an array.")},mapping={pubkey:asString,multiple:asBoolean,multipleMin:asNumber,multipleMax:asNumber,confirmUpload:asBoolean,imgOnly:asBoolean,accept:asString,externalSourcesPreferredTypes:asString,externalSourcesEmbedCss:asString,store:asStore,cameraMirror:asBoolean,cameraCapture:asCameraCapture,sourceList:asString,maxLocalFileSizeBytes:asNumber,thumbSize:asNumber,showEmptyList:asBoolean,useLocalImageEditor:asBoolean,useCloudImageEditor:asBoolean,cloudImageEditorTabs:asString,removeCopyright:asBoolean,cropPreset:asString,imageShrink:asString,modalScrollLock:asBoolean,modalBackdropStrokes:asBoolean,sourceListWrap:asBoolean,remoteTabSessionKey:asString,cdnCname:asString,baseUrl:asString,socialBaseUrl:asString,secureSignature:asString,secureExpire:asString,secureDeliveryProxy:asString,retryThrottledRequestMaxTimes:asNumber,multipartMinFileSize:asNumber,multipartChunkSize:asNumber,maxConcurrentRequests:asNumber,multipartMaxConcurrentRequests:asNumber,multipartMaxAttempts:asNumber,checkForUrlDuplicates:asBoolean,saveUrlForRecurrentUploads:asBoolean,groupOutput:asBoolean,userAgentIntegration:asString,debug:asBoolean,localeName:asString,metadata:asMetadata,secureUploadsExpireThreshold:asNumber,localeDefinitionOverride:asObject,secureUploadsSignatureResolver:asFunction,secureDeliveryProxyUrlResolver:asFunction,iconHrefResolver:asFunction,fileValidators:asArray,collectionValidators:asArray,defaultCameraMode:asCameraTab,enableAudioRecording:asBoolean,enableVideoRecording:asBoolean,mediaRecorerOptions:asObject,maxVideoRecordingDuration:asNumber},normalizeConfigValue=(e,t)=>{if(null!=t)try{return mapping[e](t)}catch(t){return console.error('Invalid value for config key "'+e+'".',t),initialConfig[e]}},allConfigKeys=[...new Set(["debug",...Object.keys(initialConfig)])],complexConfigKeys=["metadata","localeDefinitionOverride","secureUploadsSignatureResolver","secureDeliveryProxyUrlResolver","iconHrefResolver","fileValidators","collectionValidators","mediaRecorerOptions"],isComplexKey=e=>complexConfigKeys.includes(e),plainConfigKeys=allConfigKeys.filter((e=>!isComplexKey(e))),attrKeyMapping={...Object.fromEntries(plainConfigKeys.map((e=>[toKebabCase(e),e]))),...Object.fromEntries(plainConfigKeys.map((e=>[e.toLowerCase(),e])))},attrStateMapping={...Object.fromEntries(plainConfigKeys.map((e=>[toKebabCase(e),sharedConfigKey(e)]))),...Object.fromEntries(plainConfigKeys.map((e=>[e.toLowerCase(),sharedConfigKey(e)])))},getLocalPropName=e=>"__"+e;class ConfigClass extends Block{requireCtxName=!0;constructor(){super(),this.init$={...this.init$,...Object.fromEntries(Object.entries(initialConfig).map((([e,t])=>[sharedConfigKey(e),t])))}}_flushValueToAttribute(e,t){if(plainConfigKeys.includes(e)){const n=[...new Set([toKebabCase(e),e.toLowerCase()])];for(const e of n)null==t?this.removeAttribute(e):this.getAttribute(e)!==t.toString()&&this.setAttribute(e,t.toString())}}_flushValueToState(e,t){this.$[sharedConfigKey(e)]!==t&&(this.$[sharedConfigKey(e)]=null==t?initialConfig[e]:t)}_setValue(e,t){const n=this,i=normalizeConfigValue(e,t),r=getLocalPropName(e);n[r]!==i&&(this._assertSameValueDifferentReference(e,n[r],i),n[r]=i,this._flushValueToAttribute(e,i),this._flushValueToState(e,i),this.debugPrint('[uc-config] "'+e+'"',i))}_getValue(e){return this[getLocalPropName(e)]}_assertSameValueDifferentReference(e,t,n){this.cfg.debug&&n!==t&&"object"==typeof n&&"object"==typeof t&&JSON.stringify(n)===JSON.stringify(t)&&(console.warn('[uc-config] Option "'+e+'" value is the same as the previous one but the reference is different'),console.warn("[uc-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn('[uc-config] "'+e+'" previous value:',t),console.warn('[uc-config] "'+e+'" new value:',n))}initCallback(){super.initCallback();const e=this;for(const e of plainConfigKeys)this.sub(sharedConfigKey(e),(t=>{this._setValue(e,t)}),!1);for(const t of allConfigKeys){const n=e[t]??this.$[sharedConfigKey(t)];n!==initialConfig[t]&&this._setValue(t,n),Object.defineProperty(this,t,{set:e=>{this._setValue(t,e)},get:()=>this._getValue(t)})}}attributeChangedCallback(e,t,n){t!==n&&(this[attrKeyMapping[e]]=n)}}ConfigClass.bindAttributes(attrStateMapping);for(const e of allConfigKeys)ConfigClass.prototype[e]=void 0;const Config=ConfigClass;class Icon extends Block{constructor(){super(),this.init$={...this.init$,name:"",href:""}}initCallback(){super.initCallback(),this.sub("name",(e=>{if(!e)return;let t="#uc-icon-"+e;this.subConfigValue("iconHrefResolver",(n=>{if(n){const i=n(e);t=i??t}this.$.href=t}))}))}}Icon.template='\n  <svg ref="svg" xmlns="http://www.w3.org/2000/svg">\n    <use set="@href: href;"></use>\n  </svg>\n',Icon.bindAttributes({name:"name"});const uniqueArray=e=>[...new Set(e)],parseObjectToString=e=>Object.entries(e).filter((([e,t])=>void 0!==t&&""!==t)).map((([e,t])=>"cdn-operations"===e||"analytics"===e?t:e+"/"+t)),DEFAULT_CDN_BASE="https://ucarecdn.com",PROPS_MAP=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:DEFAULT_CDN_BASE},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{},"is-preview-blur":{default:1}}),CSS_PREF="--uc-img-",UNRESOLVED_ATTR="unresolved",HI_RES_K=2,ULTRA_RES_K=3,DEV_MODE=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),MAX_WIDTH=3e3,MAX_WIDTH_JPG=5e3,ImgTypeEnum=Object.freeze({PREVIEW:"PREVIEW",MAIN:"MAIN"}),CSS_PROPS=Object.create(null);for(let e in PROPS_MAP)CSS_PROPS[CSS_PREF+e]=PROPS_MAP[e]?.default||"";class ImgConfig extends BaseComponent{cssInit$=CSS_PROPS;$$(e){return this.$[CSS_PREF+e]}set$$(e){for(let t in e)this.$[CSS_PREF+t]=e[t]}sub$$(e,t){this.sub(CSS_PREF+e,(e=>{null!==e&&""!==e&&t(e)}))}analyticsParams(){return"-/@clib/"+PACKAGE_NAME+"/"+PACKAGE_VERSION+"/uc-img/"}initAttributes(e){[...this.attributes].forEach((t=>{PROPS_MAP[t.name]||e.setAttribute(t.name,t.value)}))}initIntersection(e,t){this._isnObserver=new IntersectionObserver((n=>{n.forEach((n=>{n.isIntersecting&&(t(),this._isnObserver.unobserve(e))}))}),{root:null,rootMargin:"0px"}),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach((e=>{this._isnObserver.unobserve(e)})),this._isnObserver=null),Data.deleteCtx(this)}static get observedAttributes(){return Object.keys(PROPS_MAP)}attributeChangedCallback(e,t,n){window.setTimeout((()=>{this.$[CSS_PREF+e]=n}))}}class ImgBase extends ImgConfig{_img=new Image;_imgPreview=new Image;_fmtAbs(e){return!e.includes("//")&&!DEV_MODE&&(e=new URL(e,document.baseURI).href),e}_validateSize(e){if(""!==e?.trim()){let t=e.match(/\d+/)[0],n=e.match(/[a-zA-Z]+/)[0];const i=parseInt(t,10);if(Number(i)>MAX_WIDTH_JPG&&this.hasFormatJPG)return MAX_WIDTH_JPG+n;if(Number(i)>MAX_WIDTH&&!this.hasFormatJPG)return MAX_WIDTH+n}return e}_getCdnModifiers(e,t){const n={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(e),blur:t,"cdn-operations":this.$$("cdn-operations"),analytics:this.analyticsParams()};return createCdnUrlModifiers(...parseObjectToString(n))}_getUrlBase(e="",t=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(DEV_MODE&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let n=this._getCdnModifiers(e,t);return this.$$("src").startsWith(this.$$("cdn-cname"))?createCdnUrl(this.$$("src"),n):this.$$("cdn-cname")&&this.$$("uuid")||this.$$("uuid")?this._proxyUrl(createCdnUrl(createOriginalUrl(this.$$("cdn-cname"),this.$$("uuid")),n)):this.$$("proxy-cname")?this._proxyUrl(createCdnUrl(this.$$("proxy-cname"),n,this._fmtAbs(this.$$("src")))):this.$$("pubkey")?this._proxyUrl(createCdnUrl("https://"+this.$$("pubkey")+".ucr.io/",n,this._fmtAbs(this.$$("src")))):void 0}_proxyUrl(e){return this.$$("secure-delivery-proxy")?applyTemplateData(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}_getElSize(e,t=1,n=!0){let i=e.getBoundingClientRect(),r=t*Math.round(i.width),s=n?"":t*Math.round(i.height);return r||s?(r||"")+"x"+(s||""):null}_setupEventProxy(e){let t=e=>{e.stopPropagation();let t=new Event(e.type,e);this.dispatchEvent(t)},n=["load","error"];for(let i of n)e.addEventListener(i,t)}get img(){return this.hasPreviewImage||(this._setupConfigForImage({elNode:this._img}),this.appendChild(this._img)),this._img}get currentImg(){return this.hasPreviewImage?{type:ImgTypeEnum.PREVIEW,img:this._imgPreview}:{type:ImgTypeEnum.MAIN,img:this.img}}get hasPreviewImage(){return this.$$("is-preview-blur")}get bgSelector(){return this.$$("is-background-for")}get breakpoints(){if(this.$$("breakpoints")){const e=stringToArray(this.$$("breakpoints"));return uniqueArray(e.map((e=>parseInt(e,10))))}return null}get hasFormatJPG(){return"jpeg"===this.$$("format").toLowerCase()}renderBg(e){let t=new Set;t.add('url("'+this._getUrlBase(this._getElSize(e))+'") 1x'),this.$$("hi-res-support")&&t.add('url("'+this._getUrlBase(this._getElSize(e,HI_RES_K))+'") '+HI_RES_K+"x"),this.$$("ultra-res-support")&&t.add('url("'+this._getUrlBase(this._getElSize(e,ULTRA_RES_K))+'") '+ULTRA_RES_K+"x");let n="image-set("+[...t].join(", ")+")";e.style.setProperty("background-image",n),e.style.setProperty("background-image","-webkit-"+n)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach((t=>{e.add(this._getUrlBase(t+"x")+" "+this._validateSize(t+"w")),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*HI_RES_K+"x")+" "+this._validateSize(t*HI_RES_K+"w")),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*ULTRA_RES_K+"x")+" "+this._validateSize(t*ULTRA_RES_K+"w"))})):(e.add(this._getUrlBase(this._getElSize(this.currentImg.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}get srcUrlPreview(){return this._getUrlBase("100x","100")}renderBackground(){[...document.querySelectorAll(this.bgSelector)].forEach((e=>{this.$$("intersection")?this.initIntersection(e,(()=>{this.renderBg(e)})):this.renderBg(e)}))}_appendURL({elNode:e,src:t,srcset:n}){t&&(e.src=t),n&&(e.srcset=n)}_setupConfigForImage({elNode:e}){this._setupEventProxy(e),this.initAttributes(e)}loaderImage({src:e,srcset:t,elNode:n}){return new Promise(((i,r)=>{this._setupConfigForImage({elNode:n}),n.setAttribute(UNRESOLVED_ATTR,""),n.addEventListener("load",(()=>{n.removeAttribute(UNRESOLVED_ATTR),i(n)})),n.addEventListener("error",(()=>{r(!1)})),this._appendURL({elNode:n,src:e,srcset:t})}))}async renderImage(){if(this.$$("intersection"))return this.hasPreviewImage&&(this._setupConfigForImage({elNode:this._imgPreview}),this.appendChild(this._imgPreview)),void this.initIntersection(this.currentImg.img,(async()=>{this.hasPreviewImage&&(this._imgPreview.src=this.srcUrlPreview);try{await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await this._imgPreview.remove(),this.appendChild(this._img)}catch(e){this.hasPreviewImage&&await(this._imgPreview?.remove()),this.appendChild(this._img)}}));try{this.hasPreviewImage&&(await this.loaderImage({src:this.srcUrlPreview,elNode:this._imgPreview}),this.appendChild(this._imgPreview)),await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await(this._imgPreview?.remove()),this.appendChild(this._img)}catch(e){this.hasPreviewImage&&await(this._imgPreview?.remove()),this.appendChild(this._img)}}init(){this.bgSelector?this.renderBackground():this.renderImage()}}class Img extends ImgBase{initCallback(){super.initCallback(),this.sub$$("src",(()=>{this.init()})),this.sub$$("uuid",(()=>{this.init()})),this.sub$$("lazy",(e=>{this.$$("is-background-for")||this.$$("is-preview-blur")||(this.img.loading=e?"lazy":"eager")}))}}class SimpleBtn extends UploaderBlock{static styleAttrs=[...super.styleAttrs,"uc-simple-btn"];couldBeCtxOwner=!0;constructor(){super(),this.init$={...this.init$,withDropZone:!0,onClick:()=>{this.api.initFlow()},"button-text":""}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",(e=>{void 0!==e&&(this.$.withDropZone=asBoolean(e))})),this.subConfigValue("multiple",(e=>{this.$["button-text"]=e?"upload-files":"upload-file"}))}}SimpleBtn.template='\n  <uc-drop-area set="@disabled: !withDropZone">\n    <button type="button" set="onclick: onClick">\n      <uc-icon name="upload"></uc-icon>\n      <span l10n="button-text"></span>\n      <slot></slot>\n      <div class="uc-visual-drop-area" l10n="drop-files-here"></div>\n    </button>\n  </uc-drop-area>\n',SimpleBtn.bindAttributes({dropzone:null});class StartFrom extends ActivityBlock{historyTracked=!0;activityType="start-from";initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}function checkIsDirectory(e){return new Promise((t=>{"function"!=typeof window.FileReader&&t(!1);try{let n=new FileReader;n.onerror=()=>{t(!0)};let i=e=>{"loadend"!==e.type&&n.abort(),t(!1)};n.onloadend=i,n.onprogress=i,n.readAsDataURL(e)}catch(e){t(!1)}}))}function readEntryContentAsync(e,t){return new Promise((n=>{let i=0;const r=[],s=e=>{e||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),n(null)),e.isFile?(i++,e.file((s=>{i--;const o=new File([s],s.name,{type:s.type||t});r.push({type:"file",file:o,fullPath:e.fullPath}),0===i&&n(r)}))):e.isDirectory&&o(e.createReader())};let o=e=>{i++,e.readEntries((e=>{i--;for(let t of e)s(t);0===i&&n(r)}))};s(e)}))}function getDropItems(e){const t=[],n=[];for(let i=0;i<e.items.length;i++){let r=e.items[i];if(r)if("file"===r.kind){const e=r.type;if("function"==typeof r.webkitGetAsEntry||"function"==typeof r.getAsEntry){let i="function"==typeof r.webkitGetAsEntry?r.webkitGetAsEntry():r.getAsEntry();n.push(readEntryContentAsync(i,e).then((e=>{e&&t.push(...e)})));continue}const i=r.getAsFile();i&&n.push(checkIsDirectory(i).then((e=>{e||t.push({type:"file",file:i})})))}else"string"===r.kind&&r.type.match("^text/uri-list")&&n.push(new Promise((e=>{r.getAsString((n=>{t.push({type:"url",url:n}),e(void 0)}))})))}return Promise.all(n).then((()=>t))}StartFrom.template=' <div class="uc-content"><slot></slot></div> ';const DropzoneState={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let RESET_EVENTS=["focus"],NEAR_OFFSET=100,nearnessRegistry=new Map;function distance(e,t){let n=Math.max(Math.min(e[0],t.x+t.width),t.x),i=Math.max(Math.min(e[1],t.y+t.height),t.y);return Math.sqrt((e[0]-n)*(e[0]-n)+(e[1]-i)*(e[1]-i))}function addDropzone(e){let t=0,n=document.body,i=new Set,r=DropzoneState.INACTIVE,s=t=>{e.shouldIgnore()&&t!==DropzoneState.INACTIVE||(r!==t&&i.forEach((e=>e(t))),r=t)},o=()=>t>0;var a;a=t=>e.onChange(t),i.add(a);let l=()=>{t=0,s(DropzoneState.INACTIVE)},c=()=>{t+=1,r===DropzoneState.INACTIVE&&s(DropzoneState.ACTIVE)},d=()=>{t-=1,o()||s(DropzoneState.INACTIVE)},u=e=>{e.preventDefault(),t=0,s(DropzoneState.INACTIVE)},h=n=>{if(e.shouldIgnore())return;o()||(t+=1);let i=[n.x,n.y],r=e.element.getBoundingClientRect(),a=Math.floor(distance(i,r)),l=a<NEAR_OFFSET,c=n.composedPath().includes(e.element);nearnessRegistry.set(e.element,a);let d=Math.min(...nearnessRegistry.values())===a;c&&d?(n.preventDefault(),s(DropzoneState.OVER)):s(l&&d?DropzoneState.NEAR:DropzoneState.ACTIVE)},m=async t=>{if(e.shouldIgnore())return;t.preventDefault();let n=await getDropItems(t.dataTransfer);e.onItems(n),s(DropzoneState.INACTIVE)};return n.addEventListener("drop",u),n.addEventListener("dragleave",d),n.addEventListener("dragenter",c),n.addEventListener("dragover",h),e.element.addEventListener("drop",m),RESET_EVENTS.forEach((e=>{window.addEventListener(e,l)})),()=>{nearnessRegistry.delete(e.element),n.removeEventListener("drop",u),n.removeEventListener("dragleave",d),n.removeEventListener("dragenter",c),n.removeEventListener("dragover",h),e.element.removeEventListener("drop",m),RESET_EVENTS.forEach((e=>{window.removeEventListener(e,l)}))}}const GLOBAL_CTX_NAME="uc-drop-area",REGISTRY_KEY=GLOBAL_CTX_NAME+"/registry";class DropArea extends UploaderBlock{static styleAttrs=[...super.styleAttrs,"uc-drop-area"];constructor(){super(),this.init$={...this.init$,state:DropzoneState.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:"",[REGISTRY_KEY]:null}}isActive(){if(!this.$.isEnabled)return!1;const e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,n=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),i=window.getComputedStyle(this),r="hidden"!==i.visibility&&"none"!==i.display;return t&&r&&n}initCallback(){super.initCallback(),this.bindL10n("text",(()=>this.l10n("drop-files-here"))),this.$[REGISTRY_KEY]||(this.$[REGISTRY_KEY]=new Set),this.$[REGISTRY_KEY].add(this),this.defineAccessor("disabled",(e=>{this.set$({isEnabled:!asBoolean(e)})})),this.defineAccessor("clickable",(e=>{this.set$({isClickable:asBoolean(e)})})),this.defineAccessor("with-icon",(e=>{this.set$({withIcon:asBoolean(e)})})),this.defineAccessor("fullscreen",(e=>{this.set$({isFullscreen:asBoolean(e)})})),this.defineAccessor("text",(e=>{"string"==typeof e?this.bindL10n("text",(()=>this.l10n(e)||e)):this.bindL10n("text",(()=>this.l10n("drop-files-here")))})),this._destroyDropzone=addDropzone({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:e=>{this.$.state=e},onItems:e=>{e.length&&(e.forEach((e=>{"url"===e.type?this.api.addFileFromUrl(e.url,{source:UploadSource.DROP_AREA}):"file"===e.type&&this.api.addFileFromObject(e.file,{source:UploadSource.DROP_AREA,fullPath:e.fullPath})})),this.uploadCollection.size&&(this.set$({"*currentActivity":ActivityBlock.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=addDropzone({element:e,onChange:t=>{const n=Object.entries(DropzoneState).find((([,e])=>e===t))?.[0].toLowerCase();n&&e.setAttribute("drag-state",n)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",(e=>{const t=Object.entries(DropzoneState).find((([,t])=>t===e))?.[0].toLowerCase();t&&this.setAttribute("drag-state",t)})),this.subConfigValue("sourceList",(e=>{const t=stringToArray(e);this.$.isEnabled=t.includes(UploadSource.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")})),this.sub("isVisible",(e=>{this.toggleAttribute("hidden",!e)})),this.sub("isClickable",(e=>{this.toggleAttribute("clickable",e)})),this.$.isClickable&&(this._onAreaClicked=e=>{"keydown"===e.type?"Space"!==e.code&&"Enter"!==e.code||this.api.openSystemDialog():"click"===e.type&&this.api.openSystemDialog()},this.addEventListener("keydown",this._onAreaClicked),this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||(!this._couldHandleFiles()||!!this.$.isFullscreen&&[...this.$[REGISTRY_KEY]].filter((e=>e!==this)).filter((e=>e.isActive())).length>0)}_couldHandleFiles(){let e=this.cfg.multiple,t=this.cfg.multipleMax,n=this.uploadCollection.size;return!(e&&t&&n>=t||!e&&n>0)}destroyCallback(){super.destroyCallback();const e=this.$[REGISTRY_KEY];e&&(e.delete(this),0===e.size&&Data.deleteCtx(GLOBAL_CTX_NAME)),this._destroyDropzone?.(),this._destroyContentWrapperDropzone?.(),this._onAreaClicked&&(this.removeEventListener("keydown",this._onAreaClicked),this.removeEventListener("click",this._onAreaClicked))}}DropArea.template='\n  <slot>\n    <div data-default-slot hidden></div>\n    <div ref="content-wrapper" class="uc-content-wrapper" set="@hidden: !isVisible">\n      <div class="uc-icon-container" set="@hidden: !withIcon">\n        <uc-icon name="default"></uc-icon>\n        <uc-icon name="arrow-down"></uc-icon>\n      </div>\n      <span class="uc-text">{{text}}</span>\n    </div>\n  </slot>\n',DropArea.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});const L10N_PREFIX="src-type-";class SourceBtn extends UploaderBlock{couldBeCtxOwner=!0;type=void 0;_registeredTypes={};constructor(){super(),this.init$={...this.init$,iconName:"default","src-type":""}}initTypes(){this.registerType({type:UploadSource.LOCAL,activate:()=>(this.api.openSystemDialog(),!1)}),this.registerType({type:UploadSource.URL,activity:ActivityBlock.activities.URL,textKey:"from-url"}),this.registerType({type:UploadSource.CAMERA,activity:ActivityBlock.activities.CAMERA,activate:()=>{const e="capture"in document.createElement("input");return e&&this.api.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:ActivityBlock.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(ExternalUploadSource))this.registerType({type:e,activity:ActivityBlock.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.defineAccessor("type",(e=>{e&&this.applyType(e)}))}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}activate(){if(!this.type)return;const e=this._registeredTypes[this.type],{activity:t,activate:n,activityParams:i={}}=e;(n?n():t)&&this.set$({"*currentActivityParams":i,"*currentActivity":t})}applyType(e){const t=this._registeredTypes[e];if(!t)return void console.warn("Unsupported source type: "+e);const{textKey:n=e,icon:i=e}=t;this.$["src-type"]=""+L10N_PREFIX+n,this.$.iconName=i,this.onclick=()=>{this.activate()}}}SourceBtn.template='\n  <button type="button">\n    <uc-icon set="@name: iconName"></uc-icon>\n    <div class="uc-txt" l10n="src-type"></div>\n  </button>\n',SourceBtn.bindAttributes({type:null});class SourceList extends Block{initCallback(){super.initCallback(),this.subConfigValue("sourceList",(e=>{let t=stringToArray(e),n="";t.forEach((e=>{"instagram"!==e?n+='<uc-source-btn type="'+e+'"></uc-source-btn>':console.error("Instagram source was removed because the Instagram Basic Display API hasn't been available since December 4, 2024. Official statement, see here:https://developers.facebook.com/blog/post/2024/09/04/update-on-instagram-basic-display-api/?locale=en_US")})),this.cfg.sourceListWrap?this.innerHTML=n:this.outerHTML=n}))}}const readJpegChunks=()=>{const e=[];return{stack:e,promiseReadJpegChunks:t=>new Promise(((n,i)=>{let r=2;const s=(e,t)=>{const n=new FileReader;n.addEventListener("load",(()=>{t(new DataView(n.result))})),n.addEventListener("error",(e=>{i("Reader error: "+e)})),n.readAsArrayBuffer(e)},o=()=>s(t.slice(r,r+128),(e=>{let t,n,i;for(t=n=0,i=e.byteLength;i>=0?n<i:n>i;t=i>=0?++n:--n)if(255===e.getUint8(t)){r+=t;break}a()})),a=()=>{const a=r;return s(t.slice(r,r+=4),(l=>{if(4!==l.byteLength||255!==l.getUint8(0))return void i("Corrupted");const c=l.getUint8(1);if(218===c)return void n(!0);const d=l.getUint16(2)-2;return s(t.slice(r,r+=d),(t=>{t.byteLength===d?(e.push({startPos:a,length:d,marker:c,view:t}),o()):i("Corrupted")}))}))};FileReader&&DataView||i("Not Support"),s(t.slice(0,2),(e=>{65496!==e.getUint16(0)&&i("Not jpeg"),o()}))}))}},getIccProfile=async e=>{const t=[],{promiseReadJpegChunks:n,stack:i}=readJpegChunks();return await n(e),i.forEach((({marker:e,view:n})=>{226===e&&1229144927===n.getUint32(0)&&1347571526===n.getUint32(4)&&1229735168===n.getUint32(8)&&t.push(n)})),t},replaceJpegChunk=async(e,t,n)=>{{const i=[],r=[],{promiseReadJpegChunks:s,stack:o}=readJpegChunks();await s(e),o.forEach((e=>{if(e.marker===t)return i.push(e.startPos),r.push(e.length)}));const a=[e.slice(0,2)];for(const e of n){const n=new DataView(new ArrayBuffer(4));n.setUint16(0,65280+t),n.setUint16(2,e.byteLength+2),a.push(n.buffer),a.push(e)}let l=2;for(let t=0;t<i.length;t++)i[t]>l&&a.push(e.slice(l,i[t])),l=i[t]+r[t]+4;return a.push(e.slice(l,e.size)),new Blob(a,{type:e.type})}},MARKER=226,replaceIccProfile=(e,t)=>replaceJpegChunk(e,MARKER,t.map((e=>e.buffer))),stripIccProfile=async e=>{try{return await replaceIccProfile(e,[])}catch(e){throw new Error("Failed to strip ICC profile: "+e)}},canvasToBlob=(e,t,n)=>new Promise(((i,r)=>{e.toBlob((e=>{e?i(e):r("Failed to convert canvas to blob")}),t,n),e.width=e.height=1})),createCanvas=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");return{canvas:e,ctx:t}},hasTransparency=e=>{const{ctx:t,canvas:n}=createCanvas();n.width=n.height=50,t.drawImage(e,0,0,50,50);const i=t.getImageData(0,0,50,50).data;n.width=n.height=1;for(let e=3;e<i.length;e+=4)if(i[e]<254)return!0;return!1},getExif=async e=>{let t=null;const{promiseReadJpegChunks:n,stack:i}=readJpegChunks();return await n(e),i.forEach((({marker:e,view:n})=>{!t&&225===e&&n.byteLength>=14&&1165519206===n.getUint32(0)&&0===n.getUint16(4)&&(t=n)})),t},base64ImageSrc="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=";let isApplied;const isBrowserApplyExifOrientation=()=>new Promise((e=>{if(void 0!==isApplied)e(isApplied);else{const t=new Image;t.addEventListener("load",(()=>{isApplied=t.naturalWidth<t.naturalHeight,t.src="//:0",e(isApplied)})),t.src=base64ImageSrc}})),findExifOrientation=(e,t)=>{let n,i,r,s;if(e&&!(e.byteLength<14)&&1165519206===e.getUint32(0)&&0===e.getUint16(4)){if(18761===e.getUint16(6))i=!0;else{if(19789!==e.getUint16(6))return;i=!1}if(42===e.getUint16(8,i))for(r=8+e.getUint32(10,i),n=0,s=e.getUint16(r-2,i);s>=0?n<s:n>s;s>=0?++n:--n){if(e.byteLength<r+10)return;274===e.getUint16(r,i)&&t(r+8,i),r+=12}}},setExifOrientation=(e,t)=>{findExifOrientation(e,((n,i)=>e.setUint16(n,t,i)))},replaceExif=async(e,t,n)=>(n&&setExifOrientation(t,1),replaceJpegChunk(e,225,[t.buffer])),processImage=(e,t)=>new Promise(((n,i)=>{t&&(e.src=t),e.complete?n(e):(e.addEventListener("load",(()=>{n(e)})),e.addEventListener("error",(()=>{i(new Error("Failed to load image. Probably not an image."))})))})),imageLoader=e=>processImage(new Image,e),allowLayers=[1,3],markers=[192,193,194,195,197,198,199,201,202,203,205,206,207],sizes={squareSide:[Math.floor(Math.sqrt(5e6)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},shouldSkipShrink=async e=>{let t=!1;const{promiseReadJpegChunks:n,stack:i}=readJpegChunks();return await n(e).then((()=>(i.forEach((({marker:e,view:n})=>{if(!t&&markers.indexOf(e)>=0){const e=n.getUint8(5);allowLayers.indexOf(e)<0&&(t=!0)}})),t))).catch((()=>t))},memoize=(e,t)=>{const n={};return(...i)=>{const r=t(i,n);return r in n?n[r]:n[r]=e(...i)}},memoKeySerializer=(e,t)=>{const[n]=e,i=Object.keys(t).map((e=>parseInt(e,10))).sort(((e,t)=>e-t));for(let e=0;e<i.length;e++){const r=i[e],s=!!t[r];if(r>n&&s)return r;if(r<n&&!s)return r}return n},TestPixel={R:55,G:110,B:165,A:255},FILL_STYLE="rgba("+TestPixel.R+", "+TestPixel.G+", "+TestPixel.B+", "+TestPixel.A/255+")",canvasTest=(e,t)=>{try{const n=[e-1,t-1,1,1],{canvas:i,ctx:r}=createCanvas();i.width=1,i.height=1;const{canvas:s,ctx:o}=createCanvas();s.width=e,s.height=t,o&&(o.fillStyle=FILL_STYLE,o.fillRect(...n),r.drawImage(s,e-1,t-1,1,1,0,0,1,1));const a=r&&r.getImageData(0,0,1,1).data;let l=!1;return a&&(l=a[0]===TestPixel.R&&a[1]===TestPixel.G&&a[2]===TestPixel.B&&a[3]===TestPixel.A),s.width=s.height=1,l}catch(n){return console.error("Failed to test for max canvas size of "+e+"x"+t+"."),!1}};function wrapAsync(e){return(...t)=>new Promise((n=>{setTimeout((()=>{const i=e(...t);n(i)}),0)}))}const squareTest=wrapAsync(memoize(canvasTest,memoKeySerializer)),dimensionTest=wrapAsync(memoize(canvasTest,memoKeySerializer)),testCanvasSize=async(e,t)=>{const n=sizes.squareSide.find((n=>n*n>=e*t)),i=sizes.dimension.find((n=>n>=e&&n>=t));if(!n||!i)throw new Error("Not supported");const[r,s]=await Promise.all([squareTest(n,n),dimensionTest(i,1)]);if(r&&s)return!0;throw new Error("Not supported")},canvasResize=async(e,t,n)=>{try{const{ctx:i,canvas:r}=createCanvas();return r.width=t,r.height=n,i.imageSmoothingQuality="high",i.drawImage(e,0,0,t,n),e instanceof HTMLImageElement&&(e.src="//:0"),e instanceof HTMLCanvasElement&&(e.width=e.height=1),r}catch(e){throw new Error("Canvas resize error",{cause:e})}},native=({img:e,targetW:t,targetH:n})=>canvasResize(e,t,n),calcShrinkSteps=function({sourceW:e,targetW:t,targetH:n,step:i}){const r=[];let s=t,o=n;do{r.push([s,o]),s=Math.round(s/i),o=Math.round(o/i)}while(s<e*i);return r.reverse()},fallback=({img:e,sourceW:t,targetW:n,targetH:i,step:r})=>calcShrinkSteps({sourceW:t,targetW:n,targetH:i,step:r}).reduce(((e,[t,n])=>e.then((e=>testCanvasSize(t,n).then((()=>canvasResize(e,t,n))).catch((()=>e))))),Promise.resolve(e)),isIOS=()=>!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),isIpadOS=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),STEP=.71,shrinkImage=(e,t)=>{if(e.width*STEP*e.height*STEP<t.size)throw new Error("Not required");const n=e.width,i=e.height,r=n/i,s=Math.floor(Math.sqrt(t.size*r)),o=Math.floor(t.size/Math.sqrt(t.size*r));return testCanvasSize(s,o).then((()=>{const{ctx:t}=createCanvas();return!("imageSmoothingQuality"in t)||isIOS()||isIpadOS?fallback({img:e,sourceW:n,targetW:s,targetH:o,step:STEP}):native({img:e,targetW:s,targetH:o})})).catch((()=>Promise.reject("Not supported")))},shrinkFile=async(e,t)=>{try{if(await shouldSkipShrink(e))throw new Error("Should skipped");const n=await Promise.allSettled([getExif(e),isBrowserApplyExifOrientation(),getIccProfile(e)]),i=!n.some((e=>"rejected"===e.status)),[r,s,o]=n,a=await stripIccProfile(e).catch((()=>e)),l=await imageLoader(URL.createObjectURL(a));URL.revokeObjectURL(l.src);const c=await shrinkImage(l,t);let d="image/jpeg",u=t?.quality||.8;!i&&hasTransparency(c)&&(d="image/png",u=void 0);let h=await canvasToBlob(c,d,u);if(i&&"fulfilled"===r.status&&r.value){const e=r.value,t="fulfilled"===s.status&&s.value;h=await replaceExif(h,e,t)}return i&&"fulfilled"===o.status&&o.value.length>0&&(h=await replaceIccProfile(h,o.value)),h}catch(e){let t;throw e instanceof Error&&(t=e.message),"string"==typeof e&&(t=e),new Error("Failed to shrink image. "+(t?'Message: "'+t+'".':""),{cause:e})}};function createSvgBlobUrl(e){let t=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(t)}function fileCssBg(e="hsl(209, 21%, 65%)",t=32,n=32){return createSvgBlobUrl('\n  <svg width="'+t+'" height="'+n+'" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" fill="'+e+'" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>\n  </svg>\n  ')}function generateThumb(e,t=40){if("image/svg+xml"===e.type)return URL.createObjectURL(e);let n=document.createElement("canvas"),i=n.getContext("2d"),r=new Image,s=new Promise(((e,s)=>{r.onload=()=>{let o=r.height/r.width;o>1?(n.width=t,n.height=t*o):(n.height=t,n.width=t/o),i.fillStyle="rgb(240, 240, 240)",i.fillRect(0,0,n.width,n.height),i.drawImage(r,0,0,n.width,n.height),n.toBlob((t=>{if(!t)return void s();let n=URL.createObjectURL(t);e(n)}))},r.onerror=e=>{s(e)}}));return r.src=URL.createObjectURL(e),s}const MAX_SQUARE_SIDE=16384,regExpShrink=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,parseShrink=e=>{const t=regExpShrink.exec(e?.toLocaleLowerCase())||[];if(!t.length)return!1;const n=t[1]*t[2],i=MAX_SQUARE_SIDE*MAX_SQUARE_SIDE;return n>i?(console.warn("Shrinked size can not be larger than "+Math.floor(i/1e3/1e3)+"MP. You have set "+t[1]+"x"+t[2]+" ("+Math.ceil(n/1e3/100)/10+"MP)."),!1):{quality:t[3]?t[3]/100:void 0,size:n}},FileItemState=Object.freeze({FINISHED:Symbol("FINISHED"),FAILED:Symbol("FAILED"),UPLOADING:Symbol("UPLOADING"),IDLE:Symbol("IDLE")});class FileItem extends UploaderBlock{couldBeCtxOwner=!0;pauseRender=!0;_entrySubs=new Set;_entry=null;_isIntersecting=!1;_debouncedGenerateThumb=debounce(this._generateThumbnail.bind(this),100);_debouncedCalculateState=debounce(this._calculateState.bind(this),100);_renderedOnce=!1;constructor(){super(),this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:FileItemState.IDLE,ariaLabelStatusFile:"",onEdit:()=>{this.$["*currentActivityParams"]={internalId:this._entry.uid},this.$["*currentActivity"]=ActivityBlock.activities.CLOUD_IMG_EDIT},onRemove:()=>{this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let e of this._entrySubs)e.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),0===t.intersectionRatio?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let e=this._entry,t=FileItemState.IDLE;e.getValue("errors").length>0?t=FileItemState.FAILED:e.getValue("isUploading")?t=FileItemState.UPLOADING:e.getValue("fileInfo")&&(t=FileItemState.FINISHED),this.$.state=t}async _generateThumbnail(){if(!this._entry)return;let e=this._entry;if(e.getValue("fileInfo")&&e.getValue("isImage")){let t=this.cfg.thumbSize,n=await this.proxyUrl(createCdnUrl(createOriginalUrl(this.cfg.cdnCname,this._entry.getValue("uuid")),createCdnUrlModifiers(e.getValue("cdnUrlModifiers"),"scale_crop/"+t+"x"+t+"/center"))),i=e.getValue("thumbUrl");i!==n&&(e.setValue("thumbUrl",n),i?.startsWith("blob:")&&URL.revokeObjectURL(i))}else if(!e.getValue("thumbUrl"))if(e.getValue("file")?.type.includes("image"))try{let t=await generateThumb(e.getValue("file"),this.cfg.thumbSize);e.setValue("thumbUrl",t)}catch(t){let n=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",fileCssBg(n))}else{let t=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",fileCssBg(t))}}_subEntry(e,t){let n=this._entry.subscribe(e,(e=>{this.isConnected&&t(e)}));this._entrySubs.add(n)}_handleEntryId(e){this._reset();let t=this.uploadCollection?.read(e);this._entry=t,t&&(this._subEntry("uploadProgress",(e=>{this.$.progressValue=e})),this._subEntry("fileName",(e=>{this.$.itemName=e||t.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()})),this._subEntry("externalUrl",(e=>{this.$.itemName=t.getValue("fileName")||e||this.l10n("file-no-name")})),this._subEntry("fileInfo",(e=>{this._debouncedCalculateState(),e&&this._isIntersecting&&this._debouncedGenerateThumb()})),this._subEntry("cdnUrlModifiers",(()=>{this._isIntersecting&&this._debouncedGenerateThumb()})),this._subEntry("thumbUrl",(e=>{this.$.thumbUrl=e?"url("+e+")":""})),this._subEntry("errors",(()=>this._debouncedCalculateState())),this._subEntry("isUploading",(()=>this._debouncedCalculateState())),this._subEntry("fileSize",(()=>this._debouncedCalculateState())),this._subEntry("mimeType",(()=>this._debouncedCalculateState())),this._subEntry("isImage",(()=>this._debouncedCalculateState())),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",(e=>{this._handleEntryId(e)})),this.sub("state",(e=>{this._handleState(e)})),this.subConfigValue("useCloudImageEditor",(()=>this._debouncedCalculateState())),this.onclick=()=>{FileItem.activeInstances.forEach((e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")}))},this.sub("*uploadTrigger",(e=>{e.has(this._entry.uid)&&setTimeout((()=>this.isConnected&&this.upload()))})),FileItem.activeInstances.add(this)}_handleState(e){e===FileItemState.FAILED?this.$.badgeIcon="badge-error":e===FileItemState.FINISHED&&(this.$.badgeIcon="badge-success"),e===FileItemState.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0,this.set$({isFailed:e===FileItemState.FAILED,isUploading:e===FileItemState.UPLOADING,isFinished:e===FileItemState.FINISHED,progressVisible:e===FileItemState.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&this._entry?.getValue("isImage")&&this._entry?.getValue("cdnUrl"),errorText:this._entry.getValue("errors")?.[0]?.message,ariaLabelStatusFile:this.l10n("a11y-file-item-status",{fileName:this._entry?.getValue("fileName"),status:this.l10n(e?.description?.toLocaleLowerCase()??"").toLocaleLowerCase()})})}destroyCallback(){super.destroyCallback(),FileItem.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}_settingsOfShrink(){return parseShrink(this.cfg.imageShrink)}_processShrink(e){return shrinkFile(e,this._settingsOfShrink())}async upload(){let e=this._entry;if(!this.uploadCollection.read(e.uid))return;if(e.getValue("fileInfo")||e.getValue("isUploading")||e.getValue("errors").length>0)return;const t=this.cfg.multiple?this.cfg.multipleMax:1;if(!(t&&this.uploadCollection.size>t)){this._debouncedCalculateState(),e.setValue("isUploading",!0),e.setValue("errors",[]);try{let t=new AbortController;e.setValue("abortController",t);const n=async()=>{let n=e.getValue("file");n&&this.cfg.imageShrink&&(n=await this._processShrink(n).catch((()=>n)));const i=n||e.getValue("externalUrl")||e.getValue("uuid"),r={...await this.getUploadClientOptions(),fileName:e.getValue("fileName"),source:e.getValue("source"),onProgress:t=>{if(t.isComputable){let n=100*t.value;e.setValue("uploadProgress",n)}},signal:t.signal,metadata:await this.getMetadataFor(e.uid)};return this.debugPrint("upload options",i,r),uploadFile(i,r)};let i=await this.$["*uploadQueue"].add(n);e.setMultipleValues({fileInfo:i,isUploading:!1,fileName:i.originalFilename,fileSize:i.size,isImage:i.isImage,mimeType:i.contentInfo?.mime?.mime??i.mimeType,uuid:i.uuid,cdnUrl:e.getValue("cdnUrl")??i.cdnUrl,cdnUrlModifiers:e.getValue("cdnUrlModifiers")??"",uploadProgress:100,source:e.getValue("source")??null}),e===this._entry&&this._debouncedCalculateState()}catch(t){t instanceof CancelError&&t.isCancel?e.setMultipleValues({isUploading:!1,uploadProgress:0}):e.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:t}),e===this._entry&&this._debouncedCalculateState()}}}}FileItem.template='\n  <div class="uc-inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">\n    <div class="uc-thumb" set="style.backgroundImage: thumbUrl">\n      <div class="uc-badge">\n        <uc-icon set="@name: badgeIcon"></uc-icon>\n      </div>\n    </div>\n    <div aria-live="polite" class="uc-file-name-wrapper" set="@aria-label:ariaLabelStatusFile;">\n      <span class="uc-file-name" set="@title: itemName">{{itemName}}</span>\n      <span class="uc-file-error" set="@hidden: !errorText">{{errorText}}</span>\n    </div>\n    <div class="uc-file-actions">\n      <button\n        type="button"\n        l10n="@title:file-item-edit-button"\n        class="uc-edit-btn uc-mini-btn"\n        set="onclick: onEdit; @hidden: !isEditable"\n      >\n        <uc-icon name="edit-file"></uc-icon>\n      </button>\n      <button\n        type="button"\n        l10n="@title:file-item-remove-button"\n        class="uc-remove-btn uc-mini-btn"\n        set="onclick: onRemove;"\n      >\n        <uc-icon name="remove-file"></uc-icon>\n      </button>\n      <button type="button" class="uc-upload-btn uc-mini-btn" set="onclick: onUpload;">\n        <uc-icon name="upload"></uc-icon>\n      </button>\n    </div>\n    <uc-progress-bar class="uc-progress-bar" set="value: progressValue; visible: progressVisible;"> </uc-progress-bar>\n  </div>\n',FileItem.activeInstances=new Set;class Modal extends Block{static styleAttrs=[...super.styleAttrs,"uc-modal"];static StateConsumerScope="modal";constructor(){super(),this.init$={...this.init$,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose}}_handleBackdropClick=()=>{this._closeDialog()};_closeDialog=()=>{this.setOrAddState("*modalActive",!1)};_handleDialogClose=()=>{this._closeDialog()};_handleDialogMouseDown=e=>{this._mouseDownTarget=e.target};_handleDialogMouseUp=e=>{e.target===this.ref.dialog&&e.target===this._mouseDownTarget&&this._closeDialog()};show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){super.initCallback(),this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp),this.sub("*modalActive",(e=>{this.$.isOpen!==e&&(this.$.isOpen=e),e&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""})),this.subConfigValue("modalBackdropStrokes",(e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")})),this.sub("isOpen",(e=>{e?(this.show(),this.setAttribute("aria-modal","true")):(this.hide(),this.setAttribute("aria-modal","false"))}))}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp)}}Modal.template='\n  <dialog ref="dialog">\n    <slot></slot>\n  </dialog>\n';const throttle=(e,t)=>{let n,i,r;const s=(...s)=>{n?(clearTimeout(i),i=setTimeout((()=>{Date.now()-r>=t&&(e(...s),r=Date.now())}),Math.max(t-(Date.now()-r),0))):(e(...s),r=Date.now(),n=!0)};return Object.defineProperty(s,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(i)}}),s};class UploadList extends UploaderBlock{couldBeCtxOwner=!0;historyTracked=!0;activityType=ActivityBlock.activities.UPLOAD_LIST;constructor(){super(),this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.api.initFlow(!0)},onUpload:()=>{this.emit(EventType.UPLOAD_CLICK),this.api.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit(EventType.DONE_CLICK,this.api.getOutputCollectionState()),this.api.doneFlow()},onCancel:()=>{this.uploadCollection.clearAll()}}}_throttledHandleCollectionUpdate=throttle((()=>{this.isConnected&&(this._updateUploadsState(),this.couldOpenActivity||this.$["*currentActivity"]!==this.activityType||this.historyBack())}),300);_updateUploadsState(){const e=this.api.getOutputCollectionState(),t={total:e.totalCount,succeed:e.successCount,uploading:e.uploadingCount,failed:e.failedCount},n=!e.errors.some((e=>"TOO_MANY_FILES"===e.type||"TOO_FEW_FILES"===e.type)),i=e.errors.some((e=>"TOO_MANY_FILES"===e.type)),r=e.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),s=0===t.failed&&0===e.errors.length;let o=!1,a=!1,l=!1;if(t.total-t.succeed-t.uploading-t.failed>0&&n)o=!0;else{a=!0;const i=!this.cfg.groupOutput||!!e.group;l=t.total===t.succeed&&n&&s&&i}this.set$({doneBtnVisible:a,doneBtnEnabled:l,uploadBtnVisible:o,addMoreBtnEnabled:0===t.total||!i&&!r,addMoreBtnVisible:!r||this.cfg.multiple}),this.bindL10n("headerText",(()=>this._getHeaderText(t)))}_getHeaderText(e){const t=t=>{const n=e[t];return this.l10n("header-"+t,{count:n})};return e.uploading>0?t("uploading"):e.failed>0?t("failed"):e.succeed>0?t("succeed"):t("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*groupInfo",(e=>{e&&this._throttledHandleCollectionUpdate()})),this.sub("*currentActivity",(e=>{this.couldOpenActivity||e!==this.activityType||(this.$["*currentActivity"]=this.initActivity)})),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.sub("*uploadList",(e=>{this._throttledHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),this.cfg.confirmUpload||this.api.uploadAll()}),!1),this.sub("*collectionErrors",(e=>{const t=e.filter((e=>"SOME_FILES_HAS_ERRORS"!==e.type))[0];t?this.set$({commonErrorMessage:t.message}):this.set$({commonErrorMessage:null})}))}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate)}}UploadList.template='\n  <uc-activity-header>\n    <span aria-live="polite" class="uc-header-text">{{headerText}}</span>\n    <button\n      type="button"\n      class="uc-mini-btn uc-close-btn"\n      set="onclick: *closeModal"\n      l10n="@title:a11y-activity-header-button-close"\n    >\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </uc-activity-header>\n\n  <div class="uc-no-files" set="@hidden: hasFiles">\n    <slot name="empty"><span l10n="no-files"></span></slot>\n  </div>\n\n  <div class="uc-files" repeat="*uploadList" repeat-item-tag="uc-file-item"></div>\n\n  <div class="uc-common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div>\n\n  <div class="uc-toolbar">\n    <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel;" l10n="clear"></button>\n    <div class="uc-toolbar-spacer"></div>\n    <button\n      type="button"\n      class="uc-add-more-btn uc-secondary-btn"\n      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"\n    >\n      <uc-icon name="add"></uc-icon><span l10n="add-more"></span>\n    </button>\n    <button\n      type="button"\n      class="uc-upload-btn uc-primary-btn"\n      set="@hidden: !uploadBtnVisible; onclick: onUpload;"\n      l10n="upload"\n    ></button>\n    <button\n      type="button"\n      class="uc-done-btn uc-primary-btn"\n      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"\n      l10n="done"\n    ></button>\n  </div>\n\n  <uc-drop-area ghost></uc-drop-area>\n';class UrlSource extends UploaderBlock{couldBeCtxOwner=!0;activityType=ActivityBlock.activities.URL;init$={...this.init$,importDisabled:!0,onUpload:e=>{e.preventDefault();let t=this.ref.input.value;this.api.addFileFromUrl(t,{source:UploadSource.URL}),this.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}};initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}}UrlSource.template='\n  <uc-activity-header>\n    <button type="button" class="uc-mini-btn" set="onclick: *historyBack" l10n="@title:back">\n      <uc-icon name="back"></uc-icon>\n    </button>\n    <div>\n      <uc-icon name="url"></uc-icon>\n      <span l10n="caption-from-url"></span>\n    </div>\n    <button\n      type="button"\n      class="uc-mini-btn uc-close-btn"\n      set="onclick: *closeModal"\n      l10n="@title:a11y-activity-header-button-close"\n    >\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </uc-activity-header>\n  <form class="uc-content">\n    <input placeholder="https://" class="uc-url-input" type="text" ref="input" set="oninput: onInput" />\n    <button\n      type="submit"\n      class="uc-url-upload-btn uc-primary-btn"\n      set="onclick: onUpload; @disabled: importDisabled"\n      l10n="upload-url"\n    ></button>\n  </form>\n';const canUsePermissionsApi=()=>void 0!==navigator.permissions,DEFAULT_VIDEO_CONFIG={width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},DEFAULT_PERMISSIONS=["camera","microphone"];function formatTime(e){return Math.floor(e/60).toString().padStart(2,"0")+":"+Math.floor(e%60).toString().padStart(2,"0")}const DEFAULT_PICTURE_FORMAT="image/jpeg",DEFAULT_VIDEO_FORMAT="video/webm";class CameraSource extends UploaderBlock{couldBeCtxOwner=!0;activityType=ActivityBlock.activities.CAMERA;_unsubPermissions=null;_chunks=[];_mediaRecorder=null;_stream=null;_selectedAudioId=null;_selectedCameraId=null;constructor(){super(),this.init$={...this.init$,video:null,videoTransformCss:null,videoHidden:!0,messageHidden:!0,requestBtnHidden:canUsePermissionsApi(),cameraSelectOptions:null,cameraSelectHidden:!0,l10nMessage:"",switcher:null,panels:null,timer:null,timerHidden:!0,cameraHidden:!0,cameraActionsHidden:!0,audioSelectOptions:null,audioSelectHidden:!0,audioSelectDisabled:!0,audioToggleMicorphoneHidden:!0,tabCameraHidden:!0,tabVideoHidden:!0,currentIcon:"camera-full",currentTimelineIcon:"play",toggleMicorphoneIcon:"microphone",_startTime:0,_elapsedTime:0,_animationFrameId:null,mutableClassButton:"uc-shot-btn uc-camera-action",onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onAudioSelectChange:e=>{this._selectedAudioId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>this._shot(),onRequestPermissions:()=>this._capture(),onStartCamera:()=>this._chooseActionWithCamera(),onStartRecording:()=>this._startRecording(),onStopRecording:()=>this._stopRecording(),onToggleRecording:()=>this._toggleRecording(),onToggleAudio:()=>this._toggleEnableAudio(),onRetake:()=>this._retake(),onAccept:()=>this._accept(),onClickTab:e=>{const t=e.currentTarget.getAttribute("data-id");t&&this._handleActiveTab(t)}}}_chooseActionWithCamera=()=>{if(this._activeTab===CameraSource.types.PHOTO&&this._shot(),this._activeTab===CameraSource.types.VIDEO){if("recording"===this._mediaRecorder?.state)return void this._stopRecording();this._startRecording()}};_updateTimer=()=>{const e=Math.floor((performance.now()-this.$._startTime+this.$._elapsedTime)/1e3);if("number"==typeof this.cfg.maxVideoRecordingDuration&&this.cfg.maxVideoRecordingDuration>0){const t=this.cfg.maxVideoRecordingDuration-e;if(t<=0)return this.ref.timer.textContent=formatTime(t),void this._stopRecording();this.ref.timer.textContent=formatTime(t)}else this.ref.timer.textContent=formatTime(e);this._animationFrameId=requestAnimationFrame(this._updateTimer)};_startTimer=()=>{this.$._startTime=performance.now(),this.$._elapsedTime=0,this._updateTimer()};_stopTimer=()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)};_startTimeline=()=>{const e=this.ref.video.currentTime,t=this.ref.video.duration;this.ref.line.style.transform="scaleX("+e/t+")",this.ref.timer.textContent=formatTime(e),this._animationFrameId=requestAnimationFrame(this._startTimeline)};_stopTimeline=()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)};_startRecording=()=>{try{this._chunks=[],this._options={...this.cfg.mediaRecorerOptions};const{mimeType:e}=this.cfg.mediaRecorerOptions||{};e&&MediaRecorder.isTypeSupported(e)?this._options.mimeType=e:MediaRecorder.isTypeSupported(DEFAULT_VIDEO_FORMAT)?this._options.mimeType=DEFAULT_VIDEO_FORMAT:this._options.mimeType="video/mp4",this._stream&&(this._mediaRecorder=new MediaRecorder(this._stream,this._options),this._mediaRecorder.start(),this._mediaRecorder.addEventListener("dataavailable",(e=>{this._chunks.push(e.data)})),this._startTimer(),this.classList.add("uc-recording"),this._setCameraState(CameraSource.events.PLAY))}catch(e){console.error("Failed to start recording",e)}};_stopRecording=()=>{this._mediaRecorder?.addEventListener("stop",(()=>{this._previewVideo(),this._stopTimer(),this._setCameraState(CameraSource.events.STOP)})),this._mediaRecorder?.stop(),this.classList.remove("uc-recording")};_toggleRecording=()=>{"recording"!==this._mediaRecorder?.state&&(!this.ref.video.paused&&!this.ref.video.ended&&this.ref.video.readyState>2?this.ref.video.pause():this.ref.video.paused&&this.ref.video.play())};_toggleEnableAudio=()=>{this._stream?.getAudioTracks().forEach((e=>{e.enabled=!e.enabled,this.$.toggleMicorphoneIcon=e.enabled?"microphone":"microphone-mute",this.$.audioSelectDisabled=!e.enabled}))};_previewVideo=()=>{try{const e=new Blob(this._chunks,{type:this._mediaRecorder?.mimeType}),t=URL.createObjectURL(e);this.ref.video.muted=!1,this.ref.video.volume=1,this.$.video=null,this.ref.video.src=t,this.ref.video.addEventListener("play",(()=>{this._startTimeline(),this.set$({currentTimelineIcon:"pause"})})),this.ref.video.addEventListener("pause",(()=>{this.set$({currentTimelineIcon:"play"}),this._stopTimeline()}))}catch(e){console.error("Failed to preview video",e)}};_retake=()=>{this._setCameraState(CameraSource.events.RETAKE),this._activeTab===CameraSource.types.VIDEO&&(this.$.video=this._stream,this.ref.video.muted=!0),this.ref.video.play()};_accept=()=>{if(this._setCameraState(CameraSource.events.ACCEPT),this._activeTab===CameraSource.types.PHOTO)return void this._canvas?.toBlob((e=>{const t=this._createFile("camera","jpeg",DEFAULT_PICTURE_FORMAT,e);this._toSend(t)}),DEFAULT_PICTURE_FORMAT);const e=new Blob(this._chunks,{type:this._mediaRecorder?.mimeType}),t=this._guessExtensionByMime(this._mediaRecorder?.mimeType),n=this._createFile("video",t,"video/"+t,e);this._toSend(n),this._chunks=[]};_handlePhoto=e=>{e===CameraSource.events.SHOT&&this.set$({tabVideoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,cameraActionsHidden:!1,cameraSelectHidden:!0}),e!==CameraSource.events.RETAKE&&e!==CameraSource.events.ACCEPT||this.set$({tabVideoHidden:!this.cfg.enableVideoRecording,cameraHidden:!1,tabCameraHidden:!1,cameraActionsHidden:!0,cameraSelectHidden:this.cameraDevices.length<=1})};_handleVideo=e=>{e===CameraSource.events.PLAY&&this.set$({timerHidden:!1,tabCameraHidden:!0,cameraSelectHidden:!0,audioSelectHidden:!0,currentTimelineIcon:"pause",currentIcon:"square",mutableClassButton:"uc-shot-btn uc-camera-action uc-stop-record"}),e===CameraSource.events.STOP&&this.set$({timerHidden:!1,cameraHidden:!0,audioToggleMicorphoneHidden:!0,cameraActionsHidden:!1}),e!==CameraSource.events.RETAKE&&e!==CameraSource.events.ACCEPT||this.set$({timerHidden:!0,tabCameraHidden:!1,cameraHidden:!1,cameraActionsHidden:!0,audioToggleMicorphoneHidden:!this.cfg.enableAudioRecording,currentIcon:"video-camera-full",mutableClassButton:"uc-shot-btn uc-camera-action",audioSelectHidden:!this.cfg.enableAudioRecording||this.audioDevices.length<=1,cameraSelectHidden:this.cameraDevices.length<=1})};_setCameraState=e=>{this._activeTab!==CameraSource.types.PHOTO||"shot"!==e&&"retake"!==e&&"accept"!==e||this._handlePhoto(e),this._activeTab!==CameraSource.types.VIDEO||"play"!==e&&"stop"!==e&&"retake"!==e&&"accept"!==e&&"pause"!==e&&"resume"!==e||this._handleVideo(e)};_shot(){if(this._setCameraState("shot"),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),!this._ctx)throw new Error("Failed to get canvas context");this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this.cfg.cameraMirror&&(this._ctx.translate(this._canvas.width,0),this._ctx.scale(-1,1)),this._ctx.drawImage(this.ref.video,0,0),this.ref.video.pause()}_handleActiveTab=e=>{this.ref.switcher.querySelectorAll("button").forEach((t=>{t.classList.toggle("uc-active",t.getAttribute("data-id")===e)})),e===CameraSource.types.PHOTO&&this.set$({currentIcon:"camera-full",audioSelectHidden:!0,audioToggleMicorphoneHidden:!0}),e===CameraSource.types.VIDEO&&this.set$({currentTimelineIcon:"play",currentIcon:"video-camera-full",audioSelectHidden:!this.cfg.enableAudioRecording||this.audioDevices.length<=1,audioToggleMicorphoneHidden:!this.cfg.enableAudioRecording}),this._activeTab=e};_createFile=(e,t,n,i)=>{const r=Date.now();return new File([i],e+"-"+r+"."+t,{lastModified:r,type:n})};_guessExtensionByMime(e){const t={mp4:"mp4",ogg:"ogg",webm:"webm",quicktime:"mov","x-matroska":"mkv"};if(""===e)return"webm";if(e&&(e=e.split("/"),"video"===e?.[0])){e=e.slice(1).join("/");const n=e?.split(";")[0];if(t[n])return t[n]}return"avi"}_toSend=e=>{this.api.addFileFromObject(e,{source:UploadSource.CAMERA}),this.set$({"*currentActivity":ActivityBlock.activities.UPLOAD_LIST})};_setPermissionsState=debounce((e=>{this.classList.toggle("uc-initialized","granted"===e);const t=this._activeTab===CameraSource.types.VIDEO&&this.cfg.enableAudioRecording,n=this._activeTab===CameraSource.types.PHOTO?"camera-full":"video-camera-full";"granted"===e?this.set$({videoHidden:!1,cameraHidden:!1,tabCameraHidden:!1,messageHidden:!0,timerHidden:!0,currentIcon:n,audioToggleMicorphoneHidden:!t,audioSelectHidden:!t}):"prompt"===e?(this.$.l10nMessage="camera-permissions-prompt",this.set$({videoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage="camera-permissions-denied",this.set$({videoHidden:!0,messageHidden:!1,tabCameraHidden:!1,tabVideoHidden:!this.cfg.enableVideoRecording,cameraActionsHidden:!0,mutableClassButton:"uc-shot-btn uc-camera-action"}),this._stopCapture())}),300);_makeStreamInactive=()=>{if(!this._stream)return!1;const e=this._stream?.getAudioTracks(),t=this._stream?.getVideoTracks();e.forEach((e=>e.stop())),t.forEach((e=>e.stop()))};_stopCapture=()=>{this._capturing&&(this.ref.video.volume=0,this.$.video?.getTracks()[0].stop(),this.$.video=null,this._makeStreamInactive(),this._stopTimer(),this._capturing=!1)};_capture=async()=>{const e={video:DEFAULT_VIDEO_CONFIG,audio:!!this.cfg.enableAudioRecording&&{}};this._selectedCameraId&&(e.video={deviceId:{exact:this._selectedCameraId}}),this._selectedAudioId&&this.cfg.enableAudioRecording&&(e.audio={deviceId:{exact:this._selectedAudioId}}),this.ref.video.volume=0;try{this._setPermissionsState("prompt"),this._stream=await navigator.mediaDevices.getUserMedia(e),this._stream.addEventListener("inactive",(()=>{this._setPermissionsState("denied")})),this.$.video=this._stream,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied"),console.log("Failed to capture camera",e)}};_handlePermissionsChange=()=>{this._capture()};_permissionAccess=async()=>{try{for(const e of DEFAULT_PERMISSIONS)this[e+"Response"]=await navigator.permissions.query({name:e}),this[e+"Response"].addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}};_getPermission=()=>{};_requestDeviceAccess=async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:this.cfg.enableAudioRecording}),await this._getDevices(),navigator.mediaDevices.addEventListener("devicechange",this._getDevices)}catch(e){console.log("Failed to get user media",e)}};_getDevices=async()=>{try{const e=await navigator.mediaDevices.enumerateDevices();this.cameraDevices=e.filter((e=>"videoinput"===e.kind)).map(((e,t)=>({text:e.label.trim()||this.l10n("caption-camera")+" "+(t+1),value:e.deviceId}))),this.audioDevices=this.cfg.enableAudioRecording&&e.filter((e=>"audioinput"===e.kind)).map((e=>({text:e.label.trim(),value:e.deviceId}))),this.cameraDevices.length>1&&this.set$({cameraSelectOptions:this.cameraDevices,cameraSelectHidden:!1}),this._selectedCameraId=this.cameraDevices[0]?.value,this.audioDevices.length>1&&this.set$({audioSelectOptions:this.audioDevices,audioSelectHidden:!1}),this._selectedAudioId=this.audioDevices[0]?.value}catch(e){console.log("Failed to get devices",e)}};_onActivate=async()=>{await this._permissionAccess(),await this._requestDeviceAccess(),await this._capture()};_onDeactivate=async()=>{this._unsubPermissions&&this._unsubPermissions(),!!window.chrome||this._setPermissionsState("denied"),this._stopCapture()};initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",(e=>{this.$.videoTransformCss=e?"scaleX(-1)":null})),this.subConfigValue("enableAudioRecording",(e=>{this.$.audioToggleMicorphoneHidden=!e,this.$.audioSelectDisabled=!e})),this.subConfigValue("enableVideoRecording",(e=>{this.$.tabVideoHidden=!e})),this.subConfigValue("defaultCameraMode",(e=>{this.cfg.enableVideoRecording?this._handleActiveTab(e):this._handleActiveTab("photo")}))}_destroy(){for(const e of DEFAULT_PERMISSIONS)this[e+"Response"]?.removeEventListener("change",this._handlePermissionsChange);navigator.mediaDevices?.removeEventListener("devicechange",this._getDevices)}async destroyCallback(){super.destroyCallback(),this._destroy()}}CameraSource.types=Object.freeze({PHOTO:"photo",VIDEO:"video"}),CameraSource.events=Object.freeze({IDLE:"idle",SHOT:"shot",PLAY:"play",PAUSE:"pause",RESUME:"resume",STOP:"stop",RETAKE:"retake",ACCEPT:"accept"}),CameraSource.template='\n  <uc-activity-header>\n    <button type="button" class="uc-mini-btn" set="onclick: *historyBack" l10n="@title:back">\n      <uc-icon name="back"></uc-icon>\n    </button>\n    <div set="@hidden: !cameraSelectHidden">\n      <uc-icon name="camera"></uc-icon>\n      <span l10n="caption-camera"></span>\n    </div>\n    <uc-select\n      class="uc-camera-select"\n      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"\n    >\n    </uc-select>\n    <button\n      type="button"\n      class="uc-mini-btn uc-close-btn"\n      set="onclick: *closeModal"\n      l10n="@title:a11y-activity-header-button-close"\n    >\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </uc-activity-header>\n  <div class="uc-content">\n    <video\n      muted\n      autoplay\n      playsinline\n      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"\n      ref="video"\n    ></video>\n    <div class="uc-message-box" set="@hidden: messageHidden">\n      <span l10n="l10nMessage"></span>\n      <button\n        type="button"\n        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"\n        l10n="camera-permissions-request"\n      ></button>\n    </div>\n  </div>\n\n  <div class="uc-controls">\n    <div ref="switcher" class="uc-switcher" set="@hidden:!timerHidden">\n      <button\n        data-id="photo"\n        type="button"\n        class="uc-switch uc-mini-btn"\n        set="onclick: onClickTab;  @hidden: tabCameraHidden"\n      >\n        <uc-icon name="camera"></uc-icon>\n      </button>\n      <button\n        data-id="video"\n        type="button"\n        class="uc-switch  uc-mini-btn"\n        set="onclick: onClickTab; @hidden: tabVideoHidden"\n      >\n        <uc-icon name="video-camera"></uc-icon>\n      </button>\n    </div>\n\n    <button class="uc-secondary-btn uc-recording-timer" set="@hidden:timerHidden; onclick: onToggleRecording">\n      <uc-icon set="@name: currentTimelineIcon"></uc-icon>\n      <span ref="timer"> 00:00 </span>\n      <span ref="line" class="uc-line"></span>\n    </button>\n\n    <div class="uc-camera-actions uc-camera-action" set="@hidden: cameraActionsHidden">\n      <button type="button" class="uc-secondary-btn" set="onclick: onRetake">Retake</button>\n      <button type="button" class="uc-primary-btn" set="onclick: onAccept">Accept</button>\n    </div>\n\n    <button\n      type="button"\n      class="uc-shot-btn uc-camera-action"\n      set="onclick: onStartCamera; @class: mutableClassButton; @hidden: cameraHidden;"\n    >\n      <uc-icon set="@name: currentIcon"></uc-icon>\n    </button>\n\n    <div class="uc-select">\n      <button class="uc-mini-btn uc-btn-microphone" set="onclick: onToggleAudio; @hidden: audioToggleMicorphoneHidden;">\n        <uc-icon set="@name:toggleMicorphoneIcon"></uc-icon>\n      </button>\n\n      <uc-select\n        class="uc-audio-select"\n        set="$.options: audioSelectOptions; onchange: onAudioSelectChange; @hidden: audioSelectHidden; @disabled: audioSelectDisabled"\n      >\n      </uc-select>\n    </div>\n  </div>\n';class UploadCtxProviderClass extends UploaderBlock{requireCtxName=!0;initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}}UploadCtxProviderClass.EventType=EventType;const UploadCtxProvider=UploadCtxProviderClass;class ProgressBarCommon extends UploaderBlock{init$={...this.init$,visible:!1,value:0,"*commonProgress":0};initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties((()=>{let e=this.uploadCollection.items().some((e=>this.uploadCollection.read(e).getValue("isUploading")));this.$.visible=e})),this.sub("visible",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})),this.sub("*commonProgress",(e=>{this.$.value=e}))}destroyCallback(){super.destroyCallback(),this._unobserveCollection?.()}}ProgressBarCommon.template=' <uc-progress-bar set="visible: visible; value: value"></uc-progress-bar> ';class ProgressBar extends Block{_value=0;init$={...this.init$,width:0,opacity:0};initCallback(){super.initCallback(),this.defineAccessor("value",(e=>{if(void 0===e)return;const t=this._value;this._value=e,0===e&&t>0?this.ref.line.addEventListener("transitionend",(()=>{this.style.setProperty("--l-width",this._value.toString())})):this.style.setProperty("--l-width",this._value.toString())})),this.defineAccessor("visible",(e=>{this.ref.line.classList.toggle("uc-progress--hidden",!e)}))}}ProgressBar.template=' <div ref="line" class="uc-progress"></div> ';const TRANSPARENT_PIXEL_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function normalize(...e){return e.reduce(((e,t)=>{if("string"==typeof t)return e[t]=!0,e;for(let n of Object.keys(t))e[n]=t[n];return e}),{})}function classNames(...e){let t=normalize(...e);return Object.keys(t).reduce(((e,n)=>(t[n]&&e.push(n),e)),[]).join(" ")}function applyClassNames(e,...t){let n=normalize(...t);for(let t of Object.keys(n))e.classList.toggle(t,n[t])}const parseTabs=e=>{if(!e)return ALL_TABS;const t=deserealizeCsv(e).filter((e=>ALL_TABS.includes(e)));return 0===t.length?ALL_TABS:t};function initState(e){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":ALL_TABS,"*tabId":TabId.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:TRANSPARENT_PIXEL_SRC,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:serializeCsv(ALL_TABS),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let t=e.querySelectorAll("img");for(let e of t){let t=e.src;e.src=TRANSPARENT_PIXEL_SRC,e.src=t}e.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let n=e.$["*originalUrl"],i=createCdnUrlModifiers(transformationsToOperations(t),"preview"),r={originalUrl:n,cdnUrlModifiers:i,cdnUrl:createCdnUrl(n,i),transformations:t};e.dispatchEvent(new CustomEvent("apply",{detail:r,bubbles:!0,composed:!0})),e.remove()},"*on.cancel":()=>{e.remove(),e.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var svgIconsSprite="<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 20 20' id='uc-icon-brightness' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M15 10a5 5 0 0 1-5 5m5-5a5 5 0 0 0-5-5m5 5h-5m0 5a5 5 0 0 1 0-10m0 10V5m0 15v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05m-.626 2.45H10m4.324 5H10'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-closeMax' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M8.232 10 3.585 5.353l1.768-1.768L10 8.232l4.648-4.647 1.767 1.768L11.768 10l4.647 4.648-1.767 1.767L10 11.768l-4.647 4.647-1.768-1.767L8.232 10Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-contrast' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 10a8 8 0 1 0 16 0 8 8 0 1 0-16 0m8-8v16m8-8h-8m7.598 2.5H10m6.24 2.5H10m7.6-7.5H10M16.242 5H10'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-crop' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M20 14H7.005C6.45 14 6 13.55 6 12.995V0M0 6h13.067c.515 0 .933.418.933.933V20M14.5.4 13 2l1.5 1.6M13 2h2a3 3 0 0 1 3 3v2M5.5 19.6 7 18l-1.5-1.6M7 18H5a3 3 0 0 1-3-3v-2'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-done' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='m18.057 6.333-9.365 9.125a1.25 1.25 0 0 1-1.768-.023L1.92 10.296l1.791-1.744 4.132 4.243 8.47-8.253 1.744 1.79Z' clip-rule='evenodd'/></symbol><symbol fill='currentColor' viewBox='0 0 25 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-enhance' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19 13h-2m0 0a4 4 0 0 1-4-4m4 4a4 4 0 0 0-4 4m0-8V7m0 2a4 4 0 0 1-4 4m-2 0h2m0 0a4 4 0 0 1 4 4m0 0v2M8 8.5H6.5m0 0a2 2 0 0 1-2-2m2 2a2 2 0 0 0-2 2m0-4V5m0 1.5a2 2 0 0 1-2 2M1 8.5h1.5m0 0a2 2 0 0 1 2 2m0 0V12M12 3h-1m0 0a1 1 0 0 1-1-1m1 1a1 1 0 0 0-1 1m0-2V1m0 1a1 1 0 0 1-1 1M8 3h1m0 0a1 1 0 0 1 1 1m0 0v1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-exposure' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M10 20v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05M5 10a5 5 0 1 0 10 0 5 5 0 1 0-10 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-filters' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M4.5 6.5a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m-3.5 6a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m7 0a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-flip' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19.6 5 18 3.5 16.4 5m3.2 10L18 16.5 16.4 15M18 3.523v12.954M3.3 8.5h10.654c.301 0 .415-.395.159-.554L3.459 1.286A.3.3 0 0 0 3 1.542V8.2a.3.3 0 0 0 .3.3zm0 3h10.654c.301 0 .415.395.159.554l-10.654 6.66A.3.3 0 0 1 3 18.458v-6.66a.3.3 0 0 1 .3-.3z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-gamma' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M17 3C9 6 2.5 11.5 2.5 17.5m0 0h1m-1 0v-1m14 1h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3-14v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-mirror' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M5 .4 3.5 2 5 3.6M15 .4 16.5 2 15 3.6M3.52 2h12.957M8.5 16.7V6.046c0-.301-.394-.415-.554-.159L1.287 16.541a.3.3 0 0 0 .255.459H8.2a.3.3 0 0 0 .3-.3zm3 0V6.046c0-.301.395-.415.555-.159l6.659 10.654a.3.3 0 0 1-.255.459H11.8a.3.3 0 0 1-.3-.3z'/></symbol><symbol viewBox='0 0 40 40' id='uc-icon-original' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.5' d='M0 40 40 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-rotate' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M13.5.4 12 2l1.5 1.6M12.023 2H14.4A3.6 3.6 0 0 1 18 5.6V8M4 17h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-sad' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 17c4.418-4 11.582-4 16 0M16.5 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-11 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-saturation' xmlns='http://www.w3.org/2000/svg'><defs><linearGradient id='puc-icon-id__a' x1='10.001' y1='1' x2='10.001' y2='19' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs><circle cx='10.001' cy='10' r='9' transform='rotate(90 10 10)' fill='url(#puc-icon-id__a)'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-slider' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M0 10h11m0 0a2 2 0 1 0 4 0m-4 0a2 2 0 1 1 4 0m0 0h5'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-tuning' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M8 10h11M1 10h4M1 4.5h11m3 0h4m-18 11h11m3 0h4m-7-11a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0m7 5.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-vibrance' xmlns='http://www.w3.org/2000/svg'><path d='M2.125 5.64A8.96 8.96 0 0 0 1.001 10a8.96 8.96 0 0 0 1.124 4.36V5.64z' fill='url(#suc-icon-id__a)'/><path d='M2.875 15.499V4.502a9.053 9.053 0 0 1 1.75-1.72v14.437a9.05 9.05 0 0 1-1.75-1.72z' fill='url(#suc-icon-id__b)'/><path d='M5.375 17.722c.548.33 1.134.601 1.75.809V1.469a8.956 8.956 0 0 0-1.75.81v15.443z' fill='url(#suc-icon-id__c)'/><path d='M7.875 1.253v17.495c.564.136 1.15.22 1.75.244V1.008a9 9 0 0 0-1.75.245z' fill='url(#suc-icon-id__d)'/><path d='M10.375 1.008v17.984a9 9 0 0 0 1.75-.244V1.252a9 9 0 0 0-1.75-.244z' fill='url(#suc-icon-id__e)'/><path d='M12.875 1.469V18.53a8.957 8.957 0 0 0 1.75-.808V2.277a8.957 8.957 0 0 0-1.75-.808z' fill='url(#suc-icon-id__f)'/><path d='M15.375 2.78v14.44a9.053 9.053 0 0 0 1.75-1.72v-11a9.054 9.054 0 0 0-1.75-1.72z' fill='url(#suc-icon-id__g)'/><path d='M17.875 5.638v8.724A8.959 8.959 0 0 0 19.001 10a8.96 8.96 0 0 0-1.126-4.362z' fill='url(#suc-icon-id__h)'/><defs><linearGradient id='suc-icon-id__a' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__b' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__c' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__d' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__e' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__f' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__g' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__h' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs></symbol><symbol viewBox='0 0 20 20' id='uc-icon-warmth' xmlns='http://www.w3.org/2000/svg'><path d='m7.5 13.05.429.42.171-.175v-.244h-.6zm5 0h-.6v.245l.172.175.428-.42zM8.1 3.5c0-1.05.85-1.9 1.9-1.9V.4a3.1 3.1 0 0 0-3.1 3.1h1.2zm0 9.55V3.5H6.9v9.55h1.2zm-1 2.45c0-.79.315-1.506.829-2.03l-.858-.84A4.088 4.088 0 0 0 5.9 15.5h1.2zm2.9 2.9a2.9 2.9 0 0 1-2.9-2.9H5.9a4.1 4.1 0 0 0 4.1 4.1v-1.2zm2.9-2.9a2.9 2.9 0 0 1-2.9 2.9v1.2a4.1 4.1 0 0 0 4.1-4.1h-1.2zm-.829-2.03c.514.524.829 1.24.829 2.03h1.2c0-1.117-.447-2.13-1.171-2.87l-.858.84zM11.9 3.5v9.55h1.2V3.5h-1.2zM10 1.6c1.05 0 1.9.85 1.9 1.9h1.2A3.1 3.1 0 0 0 10 .4v1.2z' fill='currentColor'/><path d='M10 14V8' stroke='currentColor' stroke-width='1.2' stroke-linecap='round'/><path d='M14 3h3m-3 3h3m-3 3h3m-8 6.5a1 1 0 1 0 2 0 1 1 0 1 0-2 0' stroke='currentColor' stroke-width='1.2'/></symbol></svg>";const TEMPLATE="\n  "+svgIconsSprite+'\n  <div class="uc-wrapper uc-wrapper_desktop">\n    <uc-presence-toggle class="uc-network_problems_splash" set="visible: presence.networkProblems;">\n      <div class="uc-network_problems_content">\n        <div class="uc-network_problems_icon">\n          <uc-icon name="sad"></uc-icon>\n        </div>\n        <div class="uc-network_problems_text">Network error</div>\n      </div>\n      <div class="uc-network_problems_footer">\n        <uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui>\n      </div>\n    </uc-presence-toggle>\n    <div class="uc-viewport">\n      <div class="uc-file_type_outer">\n        <div class="uc-file_type">{{fileType}}</div>\n      </div>\n      <div class="uc-image_container" ref="img-container-el">\n        <img src="'+TRANSPARENT_PIXEL_SRC+'" class="uc-image uc-image_visible_from_editor" ref="img-el" />\n        <uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper>\n        <uc-editor-image-fader ref="fader-el"></uc-editor-image-fader>\n      </div>\n      <div class="uc-info_pan">{{msg}}</div>\n    </div>\n    <div class="uc-toolbar">\n      <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>\n      <div class="uc-toolbar_content uc-toolbar_content__editor">\n        <uc-editor-toolbar></uc-editor-toolbar>\n      </div>\n    </div>\n  </div>\n';class CloudImageEditorBlock extends Block{ctxOwner=!0;static styleAttrs=["uc-cloud-image-editor"];constructor(){super(),this.init$={...this.init$,...initState(this)}}_debouncedShowLoader=debounce(this._showLoader.bind(this),300);_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise(((e,t)=>{const n=setTimeout((()=>{t(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))}),3e3),i=new ResizeObserver((([t])=>{t.contentRect.width>0&&t.contentRect.height>0&&(e(),clearTimeout(n),i.disconnect())}));i.observe(this)}))}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$.cdnUrl){const e=extractUuid(this.$.cdnUrl),t=createOriginalUrl(this.$.cdnUrl,e);if(t===this.$["*originalUrl"])return;this.$["*originalUrl"]=t;const n=operationsToTransformations(extractOperations(this.$.cdnUrl));this.$["*editorTransformations"]=n}else{if(!this.$.uuid)throw new Error("No UUID nor CDN URL provided");{const e=createOriginalUrl(this.cfg.cdnCname,this.$.uuid);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e,this.$["*editorTransformations"]={}}}this.$["*tabId"]===TabId.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate();try{const e=await this.proxyUrl(createCdnUrl(this.$["*originalUrl"],createCdnUrlModifiers("json"))),t=await fetch(e).then((e=>e.json())),{width:n,height:i}=t;this.$["*imageSize"]={width:n,height:i},this.$["*tabId"]===TabId.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(e){e&&console.error("Failed to load image info",e)}}}async initEditor(){try{await this._waitForSize()}catch(e){return void(this.isConnected&&console.error(e.message))}this.ref["img-el"].addEventListener("load",(()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==TRANSPARENT_PIXEL_SRC&&(this.$["*networkProblems"]=!1)})),this.ref["img-el"].addEventListener("error",(()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0})),this.sub("src",(e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||TRANSPARENT_PIXEL_SRC)})),this.sub("cropPreset",(e=>{this.$["*cropPresetList"]=parseCropPreset(e)})),this.sub("tabs",(e=>{this.$["*tabList"]=parseTabs(e)})),this.sub("*tabId",(e=>{this.ref["img-el"].className=classNames("uc-image",{"uc-image_hidden_to_cropper":e===TabId.CROP,"uc-image_hidden_effects":e!==TabId.CROP})})),this.classList.add("uc-editor_ON"),this.sub("*networkProblems",(e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e})),this.sub("*editorTransformations",(e=>{if(0===Object.keys(e).length)return;let t=this.$["*originalUrl"],n=createCdnUrlModifiers(transformationsToOperations(e),"preview"),i={originalUrl:t,cdnUrlModifiers:n,cdnUrl:createCdnUrl(t,n),transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:i,bubbles:!0,composed:!0}))}),!1),this.sub("uuid",(e=>e&&this.updateImage())),this.sub("cdnUrl",(e=>e&&this.updateImage()))}}CloudImageEditorBlock.template=TEMPLATE,CloudImageEditorBlock.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});class CropFrame extends Block{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(""===e&&t.height<=MIN_CROP_SIZE&&t.width<=MIN_CROP_SIZE)return!0;let n=t.height<=MIN_CROP_SIZE&&(e.includes("n")||e.includes("s")),i=t.width<=MIN_CROP_SIZE&&(e.includes("e")||e.includes("w"));return n||i}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:n,width:i,height:r}=e,s=this.ref["svg-el"],o=createSvgNode("mask",{id:"backdrop-mask"}),a=createSvgNode("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),l=createSvgNode("rect",{x:t,y:n,width:i,height:r,fill:"black"});o.appendChild(a),o.appendChild(l);let c=createSvgNode("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});s.appendChild(c),s.appendChild(o),this._backdropMask=o,this._backdropMaskInner=l}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame((()=>{this._backdropMask&&(this._backdropMask.style.display="block")})))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:n,width:i,height:r}=e;this._backdropMaskInner&&setSvgNodeAttrs(this._backdropMaskInner,{x:t,y:n,width:i,height:r})}_updateFrame(){let e=this.$["*cropBox"];if(e&&this._frameGuides&&this._frameThumbs){for(let t of Object.values(this._frameThumbs)){let{direction:n,pathNode:i,interactionNode:r,groupNode:s}=t,o=""===n,a=2===n.length,{x:l,y:c,width:d,height:u}=e;if(o)setSvgNodeAttrs(r,{x:l,y:c,width:d,height:u});else{const t=clamp(Math.min(d,u)/(2*THUMB_CORNER_SIZE+THUMB_SIDE_SIZE)/2,0,1);let{d:s,center:o}=a?cornerPath(e,n,t):sidePath(e,n,t);const l=Math.max(MAX_INTERACTION_SIZE*clamp(Math.min(d,u)/MAX_INTERACTION_SIZE/3,0,1),MIN_INTERACTION_SIZE);setSvgNodeAttrs(r,{x:o[0]-l,y:o[1]-l,width:2*l,height:2*l}),setSvgNodeAttrs(i,{d:s})}let h=this._shouldThumbBeDisabled(n);s.setAttribute("class",classNames("uc-thumb",{"uc-thumb--hidden":h,"uc-thumb--visible":!h}))}setSvgNodeAttrs(this._frameGuides,{x:e.x-.5*GUIDE_STROKE_WIDTH,y:e.y-.5*GUIDE_STROKE_WIDTH,width:e.width+GUIDE_STROKE_WIDTH,height:e.height+GUIDE_STROKE_WIDTH})}}_createThumb(e,t){let n=createSvgNode("g");n.classList.add("uc-thumb"),n.setAttribute("with-effects","");let i=createSvgNode("rect",{fill:"transparent"}),r=createSvgNode("path",{stroke:"currentColor",fill:"none","stroke-width":THUMB_STROKE_WIDTH});n.appendChild(r),n.appendChild(i),e[t]={direction:t,pathNode:r,interactionNode:i,groupNode:n},""===t&&(n.style.cursor="move"),i.addEventListener("pointerdown",this._handlePointerDown.bind(this,t))}_createThumbs(){const e={};for(let t=0;t<3;t++)for(let n=0;n<3;n++){let i=""+["n","","s"][t]+["w","","e"][n];""!==i&&this._createThumb(e,i)}return this._createThumb(e,""),e}_createGuides(){let e=createSvgNode("svg"),t=createSvgNode("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"currentColor","stroke-width":GUIDE_STROKE_WIDTH,"stroke-opacity":.5});e.appendChild(t);for(let t=1;t<=2;t++){let n=createSvgNode("line",{x1:GUIDE_THIRD*t+"%",y1:"0%",x2:GUIDE_THIRD*t+"%",y2:"100%",stroke:"currentColor","stroke-width":GUIDE_STROKE_WIDTH,"stroke-opacity":.3});e.appendChild(n)}for(let t=1;t<=2;t++){let n=createSvgNode("line",{x1:"0%",y1:GUIDE_THIRD*t+"%",x2:"100%",y2:GUIDE_THIRD*t+"%",stroke:"currentColor","stroke-width":GUIDE_STROKE_WIDTH,"stroke-opacity":.3});e.appendChild(n)}return e.classList.add("uc-guides","uc-guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),n=this._createGuides();t.appendChild(n);let i=this._createThumbs();for(let{groupNode:e}of Object.values(i))t.appendChild(e);e.appendChild(t),this._frameThumbs=i,this._frameGuides=n}_handlePointerDown(e,t){if(!this._frameThumbs)return;let n=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let i=this.$["*cropBox"],{x:r,y:s}=this.ref["svg-el"].getBoundingClientRect(),o=t.x-r,a=t.y-s;this.$.dragging=!0,this._draggingThumb=n,this._dragStartPoint=[o,a],this._dragStartCrop={...i}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:n,y:i}=t.getBoundingClientRect(),r=e.x-n,s=e.y-i,o=r-this._dragStartPoint[0],a=s-this._dragStartPoint[1],{direction:l}=this._draggingThumb;const c=this._calcCropBox(l,[o,a]);c&&(this.$["*cropBox"]=c)}_calcCropBox(e,t){const[n,i]=t;let r=this.$["*imageBox"],s=this._dragStartCrop??this.$["*cropBox"];const o=this.$["*cropPresetList"]?.[0],a=o?o.width/o.height:void 0;if(s=""===e?moveRect({rect:s,delta:[n,i],imageBox:r}):resizeRect({rect:s,delta:[n,i],direction:e,aspectRatio:a,imageBox:r}),Object.values(s).every((e=>Number.isFinite(e)&&e>=0)))return constraintRect(roundRect(s),this.$["*imageBox"]);console.error("CropFrame is trying to create invalid rectangle",{payload:s})}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find((t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let n=t.interactionNode.getBoundingClientRect();return rectContainsPoint({x:n.x,y:n.y,width:n.width,height:n.height},[e.x,e.y])}));this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?thumbCursor(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){this._frameThumbs&&Object.values(this._frameThumbs).map((({groupNode:e})=>e)).forEach((t=>{t.setAttribute("class",classNames("uc-thumb",{"uc-thumb--hidden":!e,"uc-thumb--visible":e}))}))}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",(()=>{this._resizeBackdrop(),window.requestAnimationFrame((()=>{this._render()}))})),this.sub("*cropBox",(e=>{e&&(this._guidesHidden=e.height<=MIN_CROP_SIZE||e.width<=MIN_CROP_SIZE,window.requestAnimationFrame((()=>{this._render()})))})),this.sub("dragging",(e=>{this._frameGuides&&this._frameGuides.setAttribute("class",classNames({"uc-guides--hidden":this._guidesHidden,"uc-guides--visible":!this._guidesHidden&&e,"uc-guides--semi-hidden":!this._guidesHidden&&!e}))})),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}CropFrame.template=' <svg class="uc-svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class EditorButtonControl extends Block{init$={...this.init$,active:!1,title:"",icon:"","on.click":null,"title-prop":""};initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.sub("title",(e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")})),this.sub("active",(e=>{this.className=classNames({"uc-active":e,"uc-not_active":!e})})),this.sub("on.click",(e=>{this.onclick=e}))}}function nextAngle(e){let t=e+90;return t=t>=360?0:t,t}function nextValue(e,t){return"rotate"===e?nextAngle(t):["mirror","flip"].includes(e)?!t:null}EditorButtonControl.template='\n  <button type="button" role="option" l10n="@title:title-prop">\n    <uc-icon set="@name: icon;"></uc-icon>\n    <div class="uc-title" ref="title-el">{{title}}</div>\n  </button>\n';class EditorCropButtonControl extends EditorButtonControl{initCallback(){super.initCallback(),this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title-prop",(()=>this.l10n("a11y-cloud-editor-apply-crop",{name:this.l10n(e).toLowerCase()}))))})),this.$["on.click"]=()=>{let e=this.$["*cropperEl"].getValue(this._operation),t=nextValue(this._operation,e);this.$["*cropperEl"].setValue(this._operation,t)}}}const ControlType={FILTER:"filter",COLOR_OPERATION:"color_operation"},FAKE_ORIGINAL_FILTER="original";class EditorSlider extends Block{init$={...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}};setOperation(e,t){this._controlType="filter"===e?ControlType.FILTER:ControlType.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===FAKE_ORIGINAL_FILTER?void 0:this.$.value,filter:this._filter===FAKE_ORIGINAL_FILTER?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=COLOR_OPERATIONS_CONFIG[this._operation],[n,i]=e;this.$.min=n,this.$.max=i,this.$.zero=t;let r=this.$["*editorTransformations"][this._operation];if(this._controlType===ControlType.FILTER){let e=i;if(r){let{name:t,amount:n}=r;e=t===this._filter?n:i}this.$.value=e,this.$.defaultValue=e}if(this._controlType===ControlType.COLOR_OPERATION){let e=void 0!==r?r:t;this.$.value=e,this.$.defaultValue=e}}apply(){let e;e=this._controlType===ControlType.FILTER?this._filter===FAKE_ORIGINAL_FILTER?null:{name:this._filter,amount:this.$.value}:this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",(e=>{this._originalUrl=e})),this.sub("value",(e=>{let t=(this._filter||this._operation)+" "+e;this.$["*operationTooltip"]=t}))}}function preloadImage(e){let t=new Image;return{promise:new Promise(((n,i)=>{t.src=e,t.onload=n,t.onerror=i})),image:t,cancel:()=>{0===t.naturalWidth&&(t.src=TRANSPARENT_PIXEL_SRC)}}}function batchPreloadImages(e){let t=[];for(let n of e){let e=preloadImage(n);t.push(e)}let n=t.map((e=>e.image));return{promise:Promise.allSettled(t.map((e=>e.promise))),images:n,cancel:()=>{t.forEach((e=>{e.cancel()}))}}}EditorSlider.template='\n  <uc-slider-ui\n    ref="slider-el"\n    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"\n  ></uc-slider-ui>\n';class EditorFilterControl extends EditorButtonControl{constructor(){super(),this.init$={...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null}}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,n=Math.ceil(t*e),i=t>=2?"lightest":"normal",r={...this.$["*editorTransformations"]};return r[this._operation]=this._filter!==FAKE_ORIGINAL_FILTER?{name:this._filter,amount:100}:void 0,createCdnUrl(this._originalUrl,createCdnUrlModifiers(COMMON_OPERATIONS,transformationsToOperations(r),"quality/"+i,"scale_crop/"+n+"x"+n+"/center"))}async _observerCallback(e,t){if(e[0].isIntersecting){let e=await this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:i,cancel:r}=preloadImage(e);this._cancelPreload=r,i.catch((e=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:e})})).finally((()=>{n.style.backgroundImage="url("+e+")",n.setAttribute("loaded",""),t.unobserve(this)}))}else this._cancelPreload?.()}initCallback(){super.initCallback(),this.$["on.click"]=()=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",(e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===FAKE_ORIGINAL_FILTER,this.$.icon=this.$.isOriginal?"original":"slider",this.bindL10n("title-prop",(()=>this.l10n("a11y-cloud-editor-apply-filter",{name:e.toLowerCase()})))})),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("uc-original-icon"):this._observer.observe(this),this.sub("*currentFilter",(e=>{this.$.active=e&&e===this._filter})),this.sub("isOriginal",(e=>{this.$.iconSize=e?40:20})),this.sub("active",(e=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=e?"1":"0";let t=this.ref["preview-el"];e?t.style.opacity="0":t.style.backgroundImage&&(t.style.opacity="1")})),this.sub("*networkProblems",(async e=>{if(!e){let e=await this.proxyUrl(this._previewSrc()),t=this.ref["preview-el"];t.style.backgroundImage&&(t.style.backgroundImage="none",t.style.backgroundImage="url("+e+")")}}))}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload?.()}}EditorFilterControl.template='\n  <button type="button" role="option" l10n="@title:title-prop">\n    <div class="uc-preview" ref="preview-el"></div>\n    <uc-icon ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>\n  </button>\n';class EditorOperationControl extends EditorButtonControl{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title-prop",(()=>this.l10n("a11y-cloud-editor-apply-tuning",{name:this.l10n(e).toLowerCase()}))),this.bindL10n("title",(()=>this.l10n(e))))})),this.sub("*editorTransformations",(e=>{if(!this._operation)return;let{zero:t}=COLOR_OPERATIONS_CONFIG[this._operation],n=e[this._operation],i=void 0!==n&&n!==t;this.$.active=i}))}}function pick(e,t){let n={};for(let i of t){let t=e[i];(e.hasOwnProperty(i)||void 0!==t)&&(n[i]=t)}return n}function viewerImageSrc(e,t,n){let i=window.devicePixelRatio,r=Math.min(Math.ceil(t*i),3e3),s=i>=2?"lightest":"normal";return createCdnUrl(e,createCdnUrlModifiers(COMMON_OPERATIONS,transformationsToOperations(n),"quality/"+s,"stretch/off/-/resize/"+r+"x","@clib/"+PACKAGE_NAME+"/"+PACKAGE_VERSION+"/uc-cloud-image-editor/"))}function validateCrop(e){if(!e)return!0;return[({dimensions:e,coords:t})=>[...e,...t].every((e=>Number.isInteger(e)&&Number.isFinite(e))),({dimensions:e,coords:t})=>e.every((e=>e>0))&&t.every((e=>e>=0))].every((t=>t(e)))}class EditorImageCropper extends Block{ctxOwner=!0;constructor(){super(),this.init$={...this.init$,image:null,"*padding":CROP_PADDING,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=debounce(this._commit.bind(this),300),this._handleResizeThrottled=throttle(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){this.isConnected&&this._isActive&&(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=pick(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),n=this.offsetWidth,i=this.offsetHeight,r=window.devicePixelRatio;e.style.width=n+"px",e.style.height=i+"px",e.width=n*r,e.height=i*r,t?.scale(r,r),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e,t=this.$.image,n=this.$["*padding"],i=this.$["*operations"],{rotate:r}=i,s=this.offsetWidth,o=this.offsetHeight,a=rotateSize({width:t.naturalWidth,height:t.naturalHeight},r);if(a.width>s-2*n||a.height>o-2*n){let t=a.width/a.height;if(t>s/o){let i=s-2*n,r=i/t;e={x:0+n,y:n+(o-2*n)/2-r/2,width:i,height:r}}else{let i=o-2*n,r=i*t;e={x:n+(s-2*n)/2-r/2,y:0+n,width:r,height:i}}}else{let{width:t,height:i}=a;e={x:n+(s-2*n)/2-t/2,y:n+(o-2*n)/2-i/2,width:t,height:i}}this.$["*imageBox"]=roundRect(e)}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],n=this.$["*operations"],{rotate:i}=n,r=this.$["*editorTransformations"].crop,{width:s,x:o,y:a}=this.$["*imageBox"];if(r){let{dimensions:[t,n],coords:[l,c]}=r,{width:d}=rotateSize(this._imageSize,i),u=s/d;e=constraintRect(roundRect({x:o+l*u,y:a+c*u,width:t*u,height:n*u}),this.$["*imageBox"])}const l=this.$["*cropPresetList"]?.[0],c=l?l.width/l.height:void 0;if(!isRectInsideRect(e,t)||c&&!isRectMatchesAspectRatio(e,c)){const n=t.width/t.height;let i=t.width,r=t.height;c&&(n>c?i=Math.min(t.height*c,t.width):r=Math.min(t.width/c,t.height)),e={x:t.x+t.width/2-i/2,y:t.y+t.height/2-r/2,width:i,height:r}}this.$["*cropBox"]=constraintRect(roundRect(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,n=this.$["*imageBox"],i=this.$["*operations"],{mirror:r,flip:s,rotate:o}=i,a=rotateSize({width:n.width,height:n.height},o);e.save(),e.translate(n.x+n.width/2,n.y+n.height/2),e.rotate(o*Math.PI*-1/180),e.scale(r?-1:1,s?-1:1),e.drawImage(t,-a.width/2,-a.height/2,a.width,a.height),e.restore()}_draw(){if(!(this._isActive&&this.$.image&&this._canvas&&this._ctx))return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout((()=>{this.className=classNames({"uc-active_from_viewer":e,"uc-active_from_editor":!e,"uc-inactive_to_editor":!1})})))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],n=this.$["*operations"],{rotate:i}=n,{width:r,height:s}=t,{width:o,height:a}=rotateSize(this._imageSize,i),{width:l,height:c}=e,d=r/o,u=s/a;return[clamp(Math.round(l/d),1,o),clamp(Math.round(c/u),1,a)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],n=this.$["*operations"],{rotate:i}=n,{width:r,height:s,x:o,y:a}=t,{width:l,height:c}=rotateSize(this._imageSize,i),{x:d,y:u}=e,h=r/l,m=s/c,g=this._getCropDimensions(),p={dimensions:g,coords:[clamp(Math.round((d-o)/h),0,l-g[0]),clamp(Math.round((u-a)/m),0,c-g[1])]};if(validateCrop(p)){if(g[0]!==l||g[1]!==c)return p}else console.error("Cropper is trying to create invalid crop object",{payload:p})}_commit(){if(!this.isConnected||!this._imageSize)return;let e=this.$["*operations"],{rotate:t,mirror:n,flip:i}=e,r=this._getCropTransformation(),s={...this.$["*editorTransformations"],crop:r,rotate:t,mirror:n,flip:i};this.$["*editorTransformations"]=s}setValue(e,t){this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(e){console.error("Failed to activate cropper",{error:e})}this._observer=new ResizeObserver((([e])=>{e.contentRect.width>0&&e.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()})),this._observer.observe(this)}}deactivate({reset:e=!1}={}){this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=classNames({"uc-active_from_viewer":!1,"uc-active_from_editor":!1,"uc-inactive_to_editor":!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),this._observer?.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,n=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,i=Math.min(t,n),r=this.$["*cropBox"].x+this.$["*cropBox"].width/2,s=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale("+i+") translate("+(this.offsetWidth/2-r)/i+"px, "+(this.offsetHeight/2-s)/i+"px)",this.style.transformOrigin=r+"px "+s+"px"}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=e+"px "+t+"px"}_reset(){this._isActive||(this.$.image=null)}async _waitForImage(e,t){let n=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let i=await this.proxyUrl(viewerImageSrc(e,n,t)),{promise:r,cancel:s,image:o}=preloadImage(i),a=this._handleImageLoading(i);return o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),this._cancelPreload?.(),this._cancelPreload=s,r.then((()=>o)).catch((e=>(console.error("Failed to load image",{error:e}),this.$["*networkProblems"]=!0,Promise.resolve(o))))}_handleImageLoading(e){let t="crop",n=this.$["*loadingOperations"];return n.get(t)||n.set(t,new Map),n.get(t).get(e)||(n.set(t,n.get(t).set(e,!0)),this.$["*loadingOperations"]=n),()=>{n?.get(t)?.has(e)&&(n.get(t).delete(e),this.$["*loadingOperations"]=n)}}initCallback(){super.initCallback(),this.sub("*imageBox",(()=>{this._draw()})),this.sub("*cropBox",(()=>{this.$.image&&this._commitDebounced()})),this.sub("*cropPresetList",(()=>{this._alignCrop()})),setTimeout((()=>{this.sub("*networkProblems",(e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})}))}),0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}function linspace(e,t,n){let i=Array(n);for(let r=--n;r>=0;r--)i[r]=Math.ceil((r*t+(n-r)*e)/n);return i}function splitBySections(e){return e.reduce(((t,n,i)=>i<e.length-1?[...t,[n,e[i+1]]]:t),[])}function calculateOpacities(e,t,n){let i=splitBySections(e).find((([e,n])=>e<=t&&t<=n));return e.map((e=>{let r=Math.abs(i[0]-i[1]),s=Math.abs(t-i[0])/r;return i[0]===e?t>n?1:1-s:i[1]===e?t>=n?s:1:0}))}function calculateZIndices(e,t){return e.map(((n,i)=>n<t?e.length-i:i))}function keypointsRange(e,t){let n=COLOR_OPERATIONS_CONFIG[e].keypointsNumber,{range:i,zero:r}=COLOR_OPERATIONS_CONFIG[e];return[...new Set([...linspace(i[0],r,n+1),...linspace(r,i[1],n+1),r,t])].sort(((e,t)=>e-t))}EditorImageCropper.template='\n  <canvas class="uc-canvas" ref="canvas-el"></canvas>\n  <uc-crop-frame ref="frame-el"></uc-crop-frame>\n';class EditorImageFader extends Block{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=debounce(this._addKeypoint.bind(this),600),this.classList.add("uc-inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,n=this.$["*loadingOperations"];return n.get(t)||n.set(t,new Map),n.get(t).get(e)||(n.set(t,n.get(t).set(e,!0)),this.$["*loadingOperations"]=n),()=>{n?.get(t)?.has(e)&&(n.get(t).delete(e),this.$["*loadingOperations"]=n)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame((()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}}))}async _imageSrc({url:e=this._url,filter:t=this._filter,operation:n,value:i}={}){let r={...this._transformations};n&&(r[n]=t?{name:t,amount:i}:i);let s=this.offsetWidth;return await this.proxyUrl(viewerImageSrc(e,s,r))}async _constructKeypoint(e,t){return{src:await this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}async _addKeypoint(e,t,n){let i=()=>!this._isSame(e,t)||this._value!==n||!!this._keypoints.find((e=>e.value===n));if(i())return;let r=await this._constructKeypoint(e,n),s=new Image;s.src=r.src;let o=this._handleImageLoading(r.src);s.addEventListener("load",o,{once:!0}),s.addEventListener("error",o,{once:!0}),r.image=s,s.classList.add("uc-fader-image"),s.addEventListener("load",(()=>{if(i())return;let t=this._keypoints,o=t.findIndex((e=>e.value>n)),a=o<t.length?t[o].image:null;!this._container||a&&!this._container.contains(a)||(t.splice(o,0,r),this._container.insertBefore(s,a),this._update(e,n))}),{once:!0}),s.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}set(e){e="string"==typeof e?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:n}=COLOR_OPERATIONS_CONFIG[e],i=this._keypoints.map((e=>e.value)),r=calculateOpacities(i,t,n),s=calculateZIndices(i,n);for(let[e,t]of Object.entries(this._keypoints))t.opacity=r[e],t.zIndex=s[e];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("uc-fader-image","uc-fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let n=this._keypoints.map((e=>e.src)),{images:i,promise:r,cancel:s}=batchPreloadImages(n);i.forEach((e=>{let t=this._handleImageLoading(e.src);e.addEventListener("load",t),e.addEventListener("error",t)})),this._cancelLastImages=()=>{s(),this._cancelLastImages=void 0};let o=this._operation,a=this._filter;await r,this._isActive&&this._isSame(o,a)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach(((e,t)=>{let n=i[t];n.classList.add("uc-fader-image"),e.image=n,this._container.appendChild(n)})),this.appendChild(e),this._flush())}async setTransformations(e){if(this._transformations=e,this._previewImage){let e=await this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}}async preload({url:e,filter:t,operation:n,value:i}){this._cancelBatchPreload&&this._cancelBatchPreload();let r=keypointsRange(n,i),s=await Promise.all(r.map((i=>this._imageSrc({url:e,filter:t,operation:n,value:i})))),{cancel:o}=batchPreloadImages(s);this._cancelBatchPreload=o}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e)return t.style.opacity="1",t.style.transform="scale(1)",void(this.className=classNames({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1}));t.style.opacity="0";let n=this._handleImageLoading(e);t.addEventListener("error",n,{once:!0}),t.src=e,t.addEventListener("load",(()=>{n(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=classNames({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1}))}),{once:!0}),t.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}async activate({url:e,operation:t,value:n,filter:i,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=n,this._filter=i,this._fromViewer=r,"number"!=typeof n&&!i){let e=await this._imageSrc({operation:t,value:n});return this._setOriginalSrc(e),void(this._container&&this._container.remove())}this._keypoints=await Promise.all(keypointsRange(t,n).map((e=>this._constructKeypoint(t,e)))),this._update(t,n),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=classNames({"uc-active_from_viewer":!1,"uc-active_from_cropper":!1,"uc-inactive_to_cropper":!0}),this.addEventListener("transitionend",(()=>{this._container&&this._container.remove()}),{once:!0})):this._container&&this._container.remove()}}const X_THRESHOLD=1;class EditorScroller extends Block{initCallback(){super.initCallback(),this.addEventListener("wheel",(e=>{e.preventDefault();let{deltaY:t,deltaX:n}=e;Math.abs(n)>X_THRESHOLD?this.scrollLeft+=n:this.scrollLeft+=t}),{passive:!1}),this.addEventListener("scroll",(()=>{}),{passive:!0})}}function renderTabToggle(e){return'\n    <uc-presence-toggle\n      class="uc-tab-toggle"\n      set="visible: presence.tabToggle.'+e+'; styles: presence.tabToggleStyles;"\n    >\n      <uc-btn-ui\n        theme="tab"\n        ref="tab-toggle-'+e+'"\n        data-id="'+e+'"\n        icon="'+e+'"\n        set="onclick: on.clickTab; aria-role:tab_role; aria-controls:tab_'+e+"; title-prop: a11y-editor-tab-"+e+'"\n      >\n      </uc-btn-ui>\n    </uc-presence-toggle>\n  '}function renderTabContent(e){return'\n    <uc-presence-toggle\n      id="tab_'+e+'"\n      class="uc-tab-content"\n      set="visible: presence.tabContent.'+e+'; styles: presence.tabContentStyles"\n    >\n      <uc-editor-scroller hidden-scrollbar>\n        <div class="uc-controls-list_align">\n          <div\n            role="listbox"\n            aria-orientation="horizontal"\n            class="uc-controls-list_inner"\n            ref="controls-list-'+e+'"\n          ></div>\n        </div>\n      </uc-editor-scroller>\n    </uc-presence-toggle>\n  '}EditorScroller.template=" <slot></slot> ";class EditorToolbar extends Block{constructor(){super(),this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":FAKE_ORIGINAL_FILTER,"*currentOperation":null,showLoader:!1,filters:ALL_FILTERS,colorOperations:ALL_COLOR_OPERATIONS,cropOperations:ALL_CROP_OPERATIONS,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"uc-sub-toolbar--top-hidden",visible:"uc-sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"uc-sub-toolbar--bottom-hidden",visible:"uc-sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"uc-tab-content--hidden",visible:"uc-tab-content--visible"},"presence.tabToggleStyles":{hidden:"uc-tab-toggle--hidden",visible:"uc-tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"uc-tab-toggles--hidden",visible:"uc-tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload?.(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{const t=e.currentTarget.getAttribute("data-id");t&&this._activateTab(t,{fromViewer:!1})},tab_role:"tab",["tab_"+TabId.TUNING]:"tab_"+TabId.TUNING,["tab_"+TabId.CROP]:"tab_"+TabId.CROP,["tab_"+TabId.FILTERS]:"tab_"+TabId.FILTERS,cancel:"cancel",apply:"apply","a11y-editor-tab-filters":"a11y-editor-tab-filters","a11y-editor-tab-tuning":"a11y-editor-tab-tuning","a11y-editor-tab-crop":"a11y-editor-tab-crop"},this._debouncedShowLoader=debounce(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===TabId.TUNING&&this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",!1)}_createOperationControl(e){let t=new EditorOperationControl;return t.operation=e,t}_createFilterControl(e){let t=new EditorFilterControl;return t.filter=e,t}_createToggleControl(e){let t=new EditorCropButtonControl;return t.operation=e,t}_renderControlsList(e){let t=this.ref["controls-list-"+e],n=document.createDocumentFragment();e===TabId.CROP?this.$.cropOperations.forEach((e=>{let t=this._createToggleControl(e);n.appendChild(t)})):e===TabId.FILTERS?[FAKE_ORIGINAL_FILTER,...this.$.filters].forEach((e=>{let t=this._createFilterControl(e);n.appendChild(t)})):e===TabId.TUNING&&this.$.colorOperations.forEach((e=>{let t=this._createOperationControl(e);n.appendChild(t)})),[...n.children].forEach(((e,t)=>{t===n.childNodes.length-1&&e.classList.add("uc-controls-list_last-item")})),t.innerHTML="",t.appendChild(n)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===TabId.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let t of ALL_TABS){let n=t===e;this.ref["tab-toggle-"+t].active=n,n?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(t),this.$["presence.tabContent."+t]=n}}_unmountTabControls(e){let t=this.ref["controls-list-"+e];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref["tab-toggle-"+this.$["*tabId"]];this.ref["tabs-indicator"].style.transform="translateX("+e.offsetLeft+"px)"}async _preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=await this.proxyUrl(viewerImageSrc(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload?.();let{cancel:n}=batchPreloadImages([t]);this._cancelPreload=()=>{n(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}_updateInfoTooltip=debounce((()=>{const e=this.$["*editorTransformations"],t=this.$["*currentOperation"];let n="",i=!1;if(this.$["*tabId"]===TabId.FILTERS)if(i=!0,this.$["*currentFilter"]&&e?.filter?.name===this.$["*currentFilter"]){let t=e?.filter?.amount||100;n=this.$["*currentFilter"]+" "+t}else n=this.l10n(FAKE_ORIGINAL_FILTER);else if(this.$["*tabId"]===TabId.TUNING&&t){i=!0;let r=e?.[t]||COLOR_OPERATIONS_CONFIG[t].zero;n=this.l10n(t)+" "+r}i&&(this.$["*operationTooltip"]=n),this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",i)}),0);initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",(e=>{e&&setTimeout((()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})}),0)})),this.sub("*editorTransformations",(e=>{let t=e?.filter?.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)})),this.sub("*currentFilter",(()=>{this._updateInfoTooltip()})),this.sub("*currentOperation",(()=>{this._updateInfoTooltip()})),this.sub("*tabId",(()=>{this._updateInfoTooltip()})),this.sub("*originalUrl",(()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()})),this.sub("*editorTransformations",(e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)})),this.sub("*loadingOperations",(e=>{let t=!1;for(let[,n]of e.entries()){if(t)break;for(let[,e]of n.entries())if(e){t=!0;break}}this._debouncedShowLoader(t)})),this.sub("*showSlider",(e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e})),this.sub("*tabList",(e=>{this.$["presence.tabToggles"]=e.length>1;for(const t of ALL_TABS)this.$["presence.tabToggle."+t]=e.includes(t),this.ref["tab-toggle-"+t].style.gridColumn=e.indexOf(t)+1;e.includes(this.$["*tabId"])||this._activateTab(e[0],{fromViewer:!1})})),this._updateInfoTooltip()}}EditorToolbar.template='\n  <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>\n  <div class="uc-info-tooltip_container">\n    <div class="uc-info-tooltip_wrapper">\n      <div ref="tooltip-el" class="uc-info-tooltip uc-info-tooltip_hidden">{{*operationTooltip}}</div>\n    </div>\n  </div>\n  <div class="uc-toolbar-container">\n    <uc-presence-toggle\n      role="tablist"\n      class="uc-sub-toolbar"\n      set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"\n    >\n      <div class="uc-tab-content-row">'+ALL_TABS.map(renderTabContent).join("")+'</div>\n      <div class="uc-controls-row">\n        <uc-presence-toggle\n          class="uc-tab-toggles"\n          set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"\n        >\n          <div ref="tabs-indicator" class="uc-tab-toggles_indicator"></div>\n          '+ALL_TABS.map(renderTabToggle).join("")+'\n        </uc-presence-toggle>\n        <uc-btn-ui style="order: -1" theme="secondary-icon" icon="closeMax" set="onclick: on.cancel; title-prop:cancel">\n        </uc-btn-ui>\n        <uc-btn-ui theme="primary-icon" icon="done" set="onclick: on.apply; title-prop:apply"> </uc-btn-ui>\n      </div>\n    </uc-presence-toggle>\n    <uc-presence-toggle\n      class="uc-sub-toolbar"\n      set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"\n    >\n      <div class="uc-slider">\n        <uc-editor-slider ref="slider-el"></uc-editor-slider>\n      </div>\n      <div class="uc-controls-row">\n        <uc-btn-ui theme="secondary" set="onclick: on.cancelSlider" l10n="@text:cancel"> </uc-btn-ui>\n        <uc-btn-ui theme="primary" set="onclick: on.applySlider" l10n="@text:apply"> </uc-btn-ui>\n      </div>\n    </uc-presence-toggle>\n  </div>\n';class BtnUi extends Block{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null,"aria-role":"","aria-controls":"","title-prop":""},this.defineAccessor("active",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}))}_iconCss(){return classNames("uc-icon",{"uc-icon_left":!this._iconReversed,"uc-icon_right":this._iconReversed,"uc-icon_hidden":this._iconHidden,"uc-icon_single":this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",(e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()})),this.sub("theme",(e=>{"custom"!==e&&(this.className="uc-"+e)})),this.sub("text",(e=>{this._iconSingle=!1})),this.hasAttribute("theme")||this.setAttribute("theme","default"),this.defineAccessor("aria-role",(e=>{this.$["aria-role"]=e||""})),this.defineAccessor("aria-controls",(e=>{this.$["aria-controls"]=e||""})),this.defineAccessor("title-prop",(e=>{this.$["title-prop"]=e||""}))}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}BtnUi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),BtnUi.template='\n  <button type="button" set="@role:aria-role; @aria-controls: aria-controls;" l10n="@title:title-prop">\n    <uc-icon set="className: iconCss; @name: icon; @hidden: !icon"></uc-icon>\n    <div class="uc-text">{{text}}</div>\n  </button>\n';class LineLoaderUi extends Block{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",(e=>{"boolean"==typeof e&&(e?this._start():this._stop())}))}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform="translateX("+e+"px)",t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}LineLoaderUi.template='\n  <div class="uc-inner">\n    <div class="uc-line" ref="line-el"></div>\n  </div>\n';const DEFAULT_STYLE={transition:"uc-transition",visible:"uc-visible",hidden:"uc-hidden"};class PresenceToggle extends Block{constructor(){super(),this._visible=!1,this._visibleStyle=DEFAULT_STYLE.visible,this._hiddenStyle=DEFAULT_STYLE.hidden,this._externalTransitions=!1,this.defineAccessor("styles",(e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)})),this.defineAccessor("visible",(e=>{"boolean"==typeof e&&(this._visible=e,this._handleVisible())}))}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",applyClassNames(this,{[DEFAULT_STYLE.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.classList.toggle("uc-initial",!0),this._externalTransitions||this.classList.add(DEFAULT_STYLE.transition),this._handleVisible(),setTimeout((()=>{this.classList.toggle("uc-initial",!1)}),0)}}PresenceToggle.template="<slot></slot> ";class SliderUi extends Block{init$={...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}};constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",(e=>{this.$.disabled=e})),this.defineAccessor("min",(e=>{this.$.min=e})),this.defineAccessor("max",(e=>{this.$.max=e})),this.defineAccessor("defaultValue",(e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)})),this.defineAccessor("zero",(e=>{this._zero=e})),this.defineAccessor("onInput",(e=>{e&&(this.$.onInput=e)})),this.defineAccessor("onChange",(e=>{e&&(this.$.onChange=e)})),this._updateSteps(),this._observer=new ResizeObserver((()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)})),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout((()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),0),this.sub("disabled",(e=>{let t=this.ref["input-el"];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}));let e=this.ref["input-el"];e.addEventListener("focus",(()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")})),e.addEventListener("blur",(()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")}))}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this.ref["thumb-el"].style.transform="translateX("+n+"px)"}))}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="1";let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this._zeroDotEl.style.transform="translateX("+n+"px)"}))}_updateSteps(){let e=this.ref["steps-el"],{width:t}=e.getBoundingClientRect(),n=Math.ceil(t/2),i=Math.ceil(n/15)-2;if(this._stepsCount===i)return;let r=document.createDocumentFragment(),s=document.createElement("div"),o=document.createElement("div");s.className="uc-minor-step",o.className="uc-border-step",r.appendChild(o);for(let e=0;e<i;e++)r.appendChild(s.cloneNode());r.appendChild(o.cloneNode());for(let e=0;e<i;e++)r.appendChild(s.cloneNode());r.appendChild(o.cloneNode());let a=document.createElement("div");a.className="uc-zero-dot",r.appendChild(a),this._zeroDotEl=a,e.innerHTML="",e.appendChild(r),this._stepsCount=i}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}SliderUi.template='\n  <div class="uc-steps" ref="steps-el"></div>\n  <div ref="thumb-el" class="uc-thumb"></div>\n  <input\n    class="uc-input"\n    type="range"\n    ref="input-el"\n    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"\n  />\n';class CloudImageEditorActivity extends UploaderBlock{couldBeCtxOwner=!0;activityType=ActivityBlock.activities.CLOUD_IMG_EDIT;_entry;_instance;get activityParams(){const e=super.activityParams;if("internalId"in e)return e;throw new Error("Cloud Image Editor activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.subConfigValue("cropPreset",(e=>{this._instance&&this._instance.getAttribute("crop-preset")!==e&&this._instance.setAttribute("crop-preset",e)})),this.subConfigValue("cloudImageEditorTabs",(e=>{this._instance&&this._instance.getAttribute("tabs")!==e&&this._instance.setAttribute("tabs",e)}))}handleApply(e){if(!this._entry)return;let t=e.detail;this._entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){const{internalId:e}=this.activityParams;if(this._entry=this.uploadCollection.read(e),!this._entry)throw new Error('Entry with internalId "'+e+'" not found');const t=this._entry.getValue("cdnUrl");if(!t)throw new Error('Entry with internalId "'+e+"\" hasn't uploaded yet");const n=new CloudImageEditorBlock,i=this.cfg.cropPreset,r=this.cfg.cloudImageEditorTabs;n.setAttribute("ctx-name",this.ctxName),n.setAttribute("cdn-url",t),i&&n.setAttribute("crop-preset",i),r&&n.setAttribute("tabs",r),n.addEventListener("apply",(e=>{const t=e;this.handleApply(t),this.debugPrint('editor event "apply"',t.detail)})),n.addEventListener("cancel",(e=>{const t=e;this.handleCancel(),this.debugPrint('editor event "cancel"',t.detail)})),n.addEventListener("change",(e=>{const t=e;this.debugPrint('editor event "change"',t.detail)})),this.innerHTML="",this.appendChild(n),this._instance=n}unmountEditor(){this._instance=void 0,this._entry=void 0,this.innerHTML=""}}const escapeRegExp=function(e){return e.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},wildcardRegexp=function(e,t="i"){const n=e.split("*").map(escapeRegExp);return new RegExp("^"+n.join(".+")+"$",t)};function getCssValue(e,t){return window.getComputedStyle(e).getPropertyValue(t).trim()}const ucCustomProperties=["--uc-font-family","--uc-font-size","--uc-line-height","--uc-button-size","--uc-preview-size","--uc-input-size","--uc-padding","--uc-radius","--uc-transition","--uc-background","--uc-foreground","--uc-primary","--uc-primary-hover","--uc-primary-transparent","--uc-primary-foreground","--uc-secondary","--uc-secondary-hover","--uc-secondary-foreground","--uc-muted","--uc-muted-foreground","--uc-destructive","--uc-destructive-foreground","--uc-border"];function buildThemeDefinition(e){return ucCustomProperties.reduce(((t,n)=>{const i=getCssValue(e,n);return i&&(t[n]=i),t}),{})}const MESSAGE_TYPE_WHITELIST=["selected-files-change"],isWhitelistedMessage=e=>!!e&&"object"==typeof e&&"type"in e&&MESSAGE_TYPE_WHITELIST.includes(e.type);class MessageBridge{_handlerMap=new Map;_context;constructor(e){this._context=e,window.addEventListener("message",this._handleMessage)}_handleMessage=e=>{if(e.source!==this._context)return;const t=e.data;if(!isWhitelistedMessage(t))return;const n=this._handlerMap.get(t.type);if(n)for(const e of n)e(t)};on(e,t){const n=this._handlerMap.get(e)??new Set;this._handlerMap.has(e)||this._handlerMap.set(e,n),n.add(t)}send(e){this._context.postMessage(e,"*")}destroy(){window.removeEventListener("message",this._handleMessage)}}function queryString(e){let t=[];for(let[n,i]of Object.entries(e))null==i||"string"==typeof i&&0===i.length||t.push(n+"="+encodeURIComponent(i));return t.join("&")}class ExternalSource extends UploaderBlock{couldBeCtxOwner=!0;activityType=ActivityBlock.activities.EXTERNAL;constructor(){super(),this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],total:0,isSelectionReady:!1,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1,counterText:"",doneBtnTextClass:"uc-hidden",onDone:()=>{for(const e of this.$.selectedList){const t=this.extractUrlFromSelectedFile(e),{filename:n}=e,{externalSourceType:i}=this.activityParams;this.api.addFileFromUrl(t,{fileName:n,source:i})}this.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onSelectAll:()=>{this._messageBridge?.send({type:"select-all"})},onDeselectAll:()=>{this._messageBridge?.send({type:"deselect-all"})}}}get activityParams(){const e=super.activityParams;if("externalSourceType"in e)return e;throw new Error("External Source activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;if(!e)return this.$["*currentActivity"]=null,this.setOrAddState("*modalActive",!1),void console.error('Param "externalSourceType" is required for activity "'+this.activityType+'"');this.set$({activityCaption:""+e?.[0].toUpperCase()+e?.slice(1),activityIcon:e}),this.mountIframe()}}),this.sub("*currentActivityParams",(e=>{this.isActivityActive&&(this.unmountIframe(),this.mountIframe())})),this.sub("*currentActivity",(e=>{e!==this.activityType&&this.unmountIframe()})),this.subConfigValue("multiple",(e=>{this.$.showSelectionStatus=e})),this.subConfigValue("localeName",(e=>{this.setupL10n()})),this.subConfigValue("externalSourcesEmbedCss",(e=>{this.applyEmbedCss(e)}))}extractUrlFromSelectedFile(e){if(e.alternatives){const t=stringToArray(this.cfg.externalSourcesPreferredTypes);for(const n of t){const t=wildcardRegexp(n);for(const[n,i]of Object.entries(e.alternatives))if(t.test(n))return i}}return e.url}async handleSelectedFilesChange(e){this.cfg.multiple===e.isMultipleMode?(this.bindL10n("counterText",(()=>this.l10n("selected-count",{count:e.selectedCount,total:e.total}))),this.set$({doneBtnTextClass:e.isReady?"":"uc-hidden",isSelectionReady:e.isReady,isDoneBtnEnabled:e.isReady&&e.selectedFiles.length>0,showSelectionStatus:e.isMultipleMode&&e.total>0,couldSelectAll:e.selectedCount<e.total,couldDeselectAll:e.selectedCount===e.total,selectedList:e.selectedFiles})):console.error("Multiple mode mismatch")}handleIframeLoad(){this.applyEmbedCss(this.cfg.externalSourcesEmbedCss),this.applyTheme(),this.setupL10n()}applyTheme(){this._messageBridge?.send({type:"set-theme-definition",theme:buildThemeDefinition(this)})}applyEmbedCss(e){this._messageBridge?.send({type:"set-embed-css",css:e})}setupL10n(){this._messageBridge?.send({type:"set-locale-definition",localeDefinition:this.cfg.localeName})}remoteUrl(){const{pubkey:e,remoteTabSessionKey:t,socialBaseUrl:n,multiple:i}=this.cfg,{externalSourceType:r}=this.activityParams,s={lang:this.l10n("social-source-lang")?.split("-")?.[0]||"en",public_key:e,images_only:(!1).toString(),session_key:t,wait_for_theme:!0,multiple:i.toString()},o=new URL("/window4/"+r,n);return o.search=queryString(s),o.toString()}mountIframe(){let e=create({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),e.contentWindow&&(this._messageBridge?.destroy(),this._messageBridge=new MessageBridge(e.contentWindow),this._messageBridge.on("selected-files-change",this.handleSelectedFilesChange.bind(this)),this.resetSelectionStatus())}unmountIframe(){this._messageBridge?.destroy(),this._messageBridge=void 0,this.ref.iframeWrapper.innerHTML="",this.resetSelectionStatus()}resetSelectionStatus(){this.set$({selectedList:[],total:0,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1})}}ExternalSource.template='\n  <uc-activity-header>\n    <button\n      type="button"\n      class="uc-mini-btn uc-close-btn"\n      set="onclick: *historyBack"\n      l10n="@title:a11y-activity-header-button-close"\n    >\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </uc-activity-header>\n  <div class="uc-content">\n    <div ref="iframeWrapper" class="uc-iframe-wrapper"></div>\n    <div class="uc-toolbar">\n      <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel" l10n="cancel"></button>\n      <div set="@hidden: !showSelectionStatus" class="uc-selection-status-box">\n        <span>{{counterText}}</span>\n        <button type="button" set="onclick: onSelectAll; @hidden: !couldSelectAll" l10n="select-all"></button>\n        <button type="button" set="onclick: onDeselectAll; @hidden: !couldDeselectAll" l10n="deselect-all"></button>\n      </div>\n      <button type="button" class="uc-done-btn uc-primary-btn" set="onclick: onDone; @disabled: !isDoneBtnEnabled;">\n        <uc-spinner set="@hidden: isSelectionReady"></uc-spinner>\n        <span l10n="done" set="@class: doneBtnTextClass"></span>\n      </button>\n    </div>\n  </div>\n';class FormInput extends UploaderBlock{requireCtxName=!0;_createValidationInput(){const e=document.createElement("input");return e.type="text",e.name=this.ctxName,e.required=this.cfg.multipleMin>0,e.tabIndex=-1,applyStyles(e,{opacity:0,height:0,width:0}),e}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",(e=>{{if(this._dynamicInputsContainer||(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer)),!this._validationInputElement){const e=this._createValidationInput();this.appendChild(e),this._validationInputElement=e}if(this._dynamicInputsContainer.innerHTML="","uploading"===e.status||"idle"===e.status)return this._validationInputElement.value="",void this._validationInputElement.setCustomValidity("");if("failed"===e.status){const t=e.errors[0]?.message;return this._validationInputElement.value="",void this._validationInputElement.setCustomValidity(t)}const t=e.group?e.group:null;if(t)return this._validationInputElement.value=t.cdnUrl,void this._validationInputElement.setCustomValidity("");const n=e.allEntries.map((e=>e.cdnUrl));if(!this.cfg.multiple&&1===n.length)return this._validationInputElement.value=n[0],void this._validationInputElement.setCustomValidity("");this._validationInputElement.remove(),this._validationInputElement=null;const i=new DocumentFragment;for(let e of n){const t=document.createElement("input");t.type="hidden",t.name=this.ctxName+"[]",t.value=e,i.appendChild(t)}this._dynamicInputsContainer.replaceChildren(i)}}),!1)}}class ActivityHeader extends ActivityBlock{}class Select extends Block{init$={...this.init$,currentText:"",options:[],selectHtml:"",onSelect:e=>{e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find((e=>e.value==this.value))?.text||"",this.dispatchEvent(new Event("change"))}};initCallback(){super.initCallback(),this.sub("options",(e=>{this.$.currentText=e?.[0]?.text||"";let t="";e?.forEach((e=>{t+='<option value="'+e.value+'">'+e.text+"</option>"})),this.$.selectHtml=t}))}}Select.template=' <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select> ';class Copyright extends Block{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",(e=>{this.toggleAttribute("hidden",!!e)}))}static template='\n    <a\n      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"\n      target="_blank noopener"\n      class="uc-credits"\n      >Powered by Uploadcare</a\n    >\n  '}class Spinner extends BaseComponent{}Spinner.template=' <div class="uc-spinner"></div> ';class FileUploaderRegular extends SolutionBlock{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-regular"];constructor(){super(),this.init$={...this.init$,isHidden:!1}}initCallback(){super.initCallback(),this.defineAccessor("headless",(e=>{this.set$({isHidden:asBoolean(e)})})),this.sub("*modalActive",(e=>{this._lastModalActive!==e&&this.emit(e?EventType.MODAL_OPEN:EventType.MODAL_CLOSE,void 0,{debounce:!0}),this._lastModalActive=e}),!1)}}FileUploaderRegular.template='\n  <uc-simple-btn set="@hidden: isHidden"></uc-simple-btn>\n\n  <uc-modal strokes block-body-scrolling>\n    <uc-start-from>\n      <uc-drop-area with-icon clickable></uc-drop-area>\n      <uc-source-list wrap></uc-source-list>\n      <button type="button" l10n="start-from-cancel" class="uc-secondary-btn" set="onclick: *historyBack"></button>\n      <uc-copyright></uc-copyright>\n    </uc-start-from>\n    <uc-upload-list></uc-upload-list>\n    <uc-camera-source></uc-camera-source>\n    <uc-url-source></uc-url-source>\n    <uc-external-source></uc-external-source>\n    <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>\n  </uc-modal>\n',FileUploaderRegular.bindAttributes({headless:null});class FileUploaderMinimal extends SolutionBlock{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-minimal"];initCallback(){super.initCallback();const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||ActivityBlock.activities.START_FROM)})),this.sub("*uploadList",(t=>{this.$["*currentActivity"]=t?.length>0?ActivityBlock.activities.UPLOAD_LIST:e.initActivity||ActivityBlock.activities.START_FROM})),this.subConfigValue("sourceList",(e=>{"local"!==e&&(this.cfg.sourceList="local")})),this.subConfigValue("confirmUpload",(e=>{!1!==e&&(this.cfg.confirmUpload=!1)}))}}FileUploaderMinimal.template='\n  <uc-start-from>\n    <uc-drop-area tabindex="0" clickable l10n="choose-file"></uc-drop-area>\n    <uc-copyright></uc-copyright>\n  </uc-start-from>\n  <uc-upload-list ref="uBlock"></uc-upload-list>\n';class FileUploaderInline extends SolutionBlock{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-inline"];constructor(){super(),this.init$={...this.init$,couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST)}}}get couldHistoryBack(){const e=this.$["*history"];return e.length>1&&e[e.length-1]!==ActivityBlock.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}initCallback(){super.initCallback();const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||ActivityBlock.activities.START_FROM)})),this.sub("*uploadList",(t=>{t?.length>0&&this.$["*currentActivity"]===(e.initActivity||ActivityBlock.activities.START_FROM)&&(this.$["*currentActivity"]=ActivityBlock.activities.UPLOAD_LIST)})),this.sub("*history",(()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList}))}}FileUploaderInline.template='\n  <uc-start-from>\n    <uc-drop-area with-icon clickable></uc-drop-area>\n    <uc-source-list wrap></uc-source-list>\n    <button\n      type="button"\n      l10n="start-from-cancel"\n      class="uc-cancel-btn uc-secondary-btn"\n      set="onclick: cancel; @hidden: !couldCancel"\n    ></button>\n    <uc-copyright></uc-copyright>\n  </uc-start-from>\n  <uc-upload-list ref="uBlock"></uc-upload-list>\n  <uc-camera-source></uc-camera-source>\n  <uc-url-source></uc-url-source>\n  <uc-external-source></uc-external-source>\n  <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>\n';class CloudImageEditor extends CloudImageEditorBlock{static styleAttrs=[...super.styleAttrs,"uc-wgt-common"];initCallback(){super.initCallback(),this.a11y?.registerBlock(this)}}function defineComponents(e){for(let t in e){let n=[...t].reduce(((e,t)=>(t.toUpperCase()===t&&(t="-"+t.toLowerCase()),e+t)),"");n.startsWith("-")&&(n=n.replace("-","")),n.startsWith("uc-")||(n="uc-"+n),e[t].reg&&e[t].reg(n)}}const UC_WINDOW_KEY="UC";async function loadFileUploaderFrom(e,t=!1){return new Promise(((n,i)=>{if("object"!=typeof document)return void n(null);if("object"==typeof window&&window[UC_WINDOW_KEY])return void n(window[UC_WINDOW_KEY]);let r=document.createElement("script");r.async=!0,r.src=e,r.onerror=()=>{i()},r.onload=()=>{let e=window[UC_WINDOW_KEY];t&&defineComponents(e),n(e)},document.head.appendChild(r)}))}var UC=Object.freeze({__proto__:null,ActivityBlock:ActivityBlock,ActivityHeader:ActivityHeader,BaseComponent:BaseComponent,Block:Block,BtnUi:BtnUi,CameraSource:CameraSource,CloudImageEditor:CloudImageEditor,CloudImageEditorActivity:CloudImageEditorActivity,CloudImageEditorBlock:CloudImageEditorBlock,Config:Config,Copyright:Copyright,CropFrame:CropFrame,Data:Data,DropArea:DropArea,EditorCropButtonControl:EditorCropButtonControl,EditorFilterControl:EditorFilterControl,EditorImageCropper:EditorImageCropper,EditorImageFader:EditorImageFader,EditorOperationControl:EditorOperationControl,EditorScroller:EditorScroller,EditorSlider:EditorSlider,EditorToolbar:EditorToolbar,ExternalSource:ExternalSource,ExternalUploadSource:ExternalUploadSource,FileItem:FileItem,FileUploaderInline:FileUploaderInline,FileUploaderMinimal:FileUploaderMinimal,FileUploaderRegular:FileUploaderRegular,FormInput:FormInput,Icon:Icon,Img:Img,LineLoaderUi:LineLoaderUi,Modal:Modal,PACKAGE_NAME:PACKAGE_NAME,PACKAGE_VERSION:PACKAGE_VERSION,PresenceToggle:PresenceToggle,ProgressBar:ProgressBar,ProgressBarCommon:ProgressBarCommon,Select:Select,SimpleBtn:SimpleBtn,SliderUi:SliderUi,SolutionBlock:SolutionBlock,SourceBtn:SourceBtn,SourceList:SourceList,Spinner:Spinner,StartFrom:StartFrom,UID:UID,UploadCtxProvider:UploadCtxProvider,UploadList:UploadList,UploadSource:UploadSource,UploaderBlock:UploaderBlock,UrlSource:UrlSource,defineComponents:defineComponents,defineLocale:defineLocale,loadFileUploaderFrom:loadFileUploaderFrom,toKebabCase:toKebabCase});class Uploadcare extends Plugin{static get requires(){return[UploadcareEditing,UploadcareUI]}static get pluginName(){return"Uploadcare"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),e.config.define("uploadcare.uploader.sourceList",[UploadcareSource.Local,UploadcareSource.URL]),defineComponents(UC)}}class UploadcareImageEditFormLoadingView extends View{constructor(e){super(e);const t=e.t,n=this.bindTemplate,i=new SpinnerView;i.isVisible=!0,this.setTemplate({tag:"div",attributes:{class:["ck-uploadcare-form__loading"],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck-uploadcare-form__loading-spinner"]},children:[i,{text:n.to("imageUploadProgress",(e=>t("Loading image...")+" ("+(e||0)+"%)"))}]},{tag:"div",attributes:{class:["ck-uploadcare-form__skeleton"]},children:[{tag:"div",children:[{tag:"span"},{tag:"span"},{tag:"span"}]},{tag:"div",children:[{tag:"span"},{tag:"span"},{tag:"span"},{tag:"span"},{tag:"span"}]}]}]})}}var errorIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9.9 4.385a1.2 1.2 0 0 0-.44.44h.002l-5.284 9.15a1.2 1.2 0 0 0 1.04 1.8h10.564a1.2 1.2 0 0 0 1.04-1.8l-5.282-9.15a1.2 1.2 0 0 0-1.64-.44Zm.05 8.363a.301.301 0 0 1 .115-.023h.9a.301.301 0 0 1 .3.3v.9a.3.3 0 0 1-.3.3h-.9a.3.3 0 0 1-.3-.3v-.9a.3.3 0 0 1 .185-.277Zm-.185-4.723a.3.3 0 0 1 .3-.3h.9a.3.3 0 0 1 .3.3v3.4a.3.3 0 0 1-.3.3h-.9a.301.301 0 0 1-.3-.3v-3.4Z"/></svg>\n';class UploadcareImageEditFormErrorView extends View{constructor(e){super(e);const t=e.t;this.set("errorType",null);const n=new ButtonView(e);n.label=t({id:"Try again (Uploadcare)",string:"Try again"}),n.withText=!0,n.class="ck-button-action",n.on("execute",(()=>{this.fire("retry")})),n.bind("isVisible").to(this,"errorType",(e=>"NotFound"!==e));const i=new IconView;i.content=errorIcon,i.extendTemplate({attributes:{style:{width:"50px",height:"50px"}}});const r=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck-uploadcare-form__error"],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck-uploadcare-form__error-contents"]},children:[i,{tag:"h3",attributes:{style:{fontWeight:"bold"}},children:[{text:t("Unable to load")}]},{text:r.to("errorType",(e=>t("NotFound"!==e?"We were unable to load the image due to network connection issues.":"The image was not found. Its source may have been removed.")))},n]},{tag:"div",attributes:{class:["ck-uploadcare-form__skeleton"]},children:[{tag:"div",children:[{tag:"span"},{tag:"span"},{tag:"span"}]},{tag:"div",children:[{tag:"span"},{tag:"span"},{tag:"span"},{tag:"span"},{tag:"span"}]}]}]})}}class UploadcareImageEditFormEditingView extends View{constructor(e,t){super(e);const n=this.bindTemplate;this.set("imageSrc",""),this.setTemplate({tag:"uc-cloud-image-editor",attributes:{...t,class:["uc-light","ck-uploadcare-theme"],"ctx-name":"image-edit","cdn-url":n.to("imageSrc")}})}}class UploadcareImageEditFormView extends DialogFocusManagerView{constructor(e,t,n){super(e),this._items=this.createCollection(),this._loadingView=new UploadcareImageEditFormLoadingView(e),this._errorView=new UploadcareImageEditFormErrorView(e),this._editingView=new UploadcareImageEditFormEditingView(e,n),this._focusableView=new View(e),this._focusableView.setTemplate(this.getFocusableElement()),this.set("status",t),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all-excluded","ck-uploadcare-form"],tabindex:"-1"},children:this._items}),this._setView(),this.once("render",(()=>{this._waitForImageEditorComponent(this.element,(e=>{this._addUploadcareImageEditorListeners(e)}))})),this.on("change:status",(()=>{this._setView()})),this._addErrorViewListeners()}focus(){this.element.focus()}_setView(){switch(this._items.clear(),this.status){case"uploading":this._items.add(this._loadingView);break;case"error":this._items.add(this._errorView);break;case"ready":this._items.addMany([this._editingView,this._focusableView])}}_waitForImageEditorComponent(e,t){const n="uc-cloud-image-editor",i=e.querySelector(n);if(i)return t(i);const r=new MutationObserver((i=>{const s=i.filter((t=>t.target===e&&t.addedNodes.length>0&&t.addedNodes[0].nodeName.toLowerCase()===n));s.length&&(r.disconnect(),t(s[0].addedNodes[0]))}));r.observe(e,{childList:!0,subtree:!0})}_addUploadcareImageEditorListeners(e){e.addEventListener("apply",(e=>{this.fire("apply",{imageSrc:e.detail.cdnUrl})})),e.addEventListener("cancel",(()=>{this.fire("cancel")}))}_addErrorViewListeners(){this._errorView.on("retry",(()=>{this.fire("retry")}))}}var uploadcareImageEditIcon='\x3c!--\n\n What you\'re currently looking at is the source code of a legally protected, proprietary software.\n CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,\n all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.\n\n Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n\n!--\x3e\n\n<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037H5.06l5.058-5.078L6.617 9.15a.696.696 0 0 0-.957-.033L1.5 13.6V2.5h15v4.354a3.478 3.478 0 0 1 1.5.049V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.147 2.147 0 0 0-2.049 1.992 2.14 2.14 0 0 0 1.28 2.096 2.13 2.13 0 0 0 2.642-3.11 2.129 2.129 0 0 0-1.873-.978ZM8.089 17.635v2.388h2.389l7.046-7.046-2.39-2.39-7.045 7.048Zm11.282-6.507a.637.637 0 0 0 .139-.692.603.603 0 0 0-.139-.205l-1.49-1.488a.63.63 0 0 0-.899 0l-1.166 1.163 2.39 2.39 1.165-1.168Z"/></svg>\n';class UploadcareImageEditController extends(/*   -- @preserve */
ObservableMixin()){constructor(e,t,n){super(),this._editor=e,this._dialog=t,this._imageElement=n,this._imageCache=this._editor.plugins.get("UploadcareImageEditUI").imageCache,this._attributes=this._editor.config.get("uploadcare.editor")||{},this.set({isActive:!0,imageStatus:"ready",imageErrorType:null,imageId:null,imageSrc:null,imageDimension:null,imageUploadProgress:null}),this._prepareImage(),this._showDialog()}destroy(){this.isActive=!1,this.stopListening(),this.stopDelegating(),"uploading"===this.imageStatus&&this._controller&&this._controller.abort()}async _prepareImage(){const e=this._imageElement,t=e.getAttribute("uploadcareImageId"),n=e.getAttribute("src");if(t)await this._loadImageInfo(t,n);else if(this._imageCache.has(n)){const e=this._imageCache.get(n);this.imageStatus="ready",this.imageErrorType=null,this.imageSrc=e.url,this.imageDimension=e.dimension,this.imageId=e.id}else this.imageStatus="uploading",this.imageUploadProgress=0,this._controller=new AbortController,await this._uploadImage(this._imageElement,this._controller)}_showDialog(){const{locale:e}=this._editor,t=e.t,n=new UploadcareImageEditFormView(e,this.imageStatus,this._attributes);n.bind("status").to(this,"imageStatus"),n._loadingView.bind("imageUploadProgress").to(this,"imageUploadProgress"),n._editingView.bind("imageSrc").to(this,"imageSrc"),n._errorView.bind("errorType").to(this,"imageErrorType"),this._addEditViewListeners(n,this._imageElement),this._dialog.show({id:"uploadcareImageEdit",icon:uploadcareImageEditIcon,title:t({id:"Edit Image (Uploadcare)",string:"Edit image"}),content:n,position:DialogViewPosition.EDITOR_TOP_CENTER,isModal:!0,onShow:()=>{n.focus()},onHide:()=>{n.destroy(),this.destroy()},keystrokeHandlerOptions:{filter:e=>!isAncestor(e,n.element)}})}_loadImageInfo(e,t){return UploadUtils.getInfo(e,{publicKey:this._editor.config.get("uploadcare.pubkey")}).then((n=>{const{width:i,height:r}=n.imageInfo;this.imageStatus="ready",this.imageErrorType=null,this.imageSrc=t,this.imageDimension={width:i,height:r},this.imageId=e})).catch((e=>{this.imageStatus="error",this.imageErrorType="FileNotFoundError"===e.code?"NotFound":"Network",this.imageSrc=null,this.imageDimension=null,this.imageId=null,this.imageUploadProgress=null}))}_uploadImage(e,t){return this._getImageAsFile(e).then((e=>UploadUtils.upload({publicKey:this._editor.config.get("uploadcare.pubkey"),signal:t.signal,file:e,onProgress:e=>{e&&e.isComputable&&(this.imageUploadProgress=Math.ceil(100*e.value))}}))).then((t=>{const{width:n,height:i}=t.imageInfo;this.imageStatus="ready",this.imageErrorType=null,this.imageSrc=t.cdnUrl,this.imageDimension={width:n,height:i},this.imageId=t.uuid,this.imageUploadProgress=null;const r=e.getAttribute("src");this._imageCache.set(r,{id:t.uuid,url:t.cdnUrl,dimension:this.imageDimension})})).catch((e=>{this.imageStatus="error",this.imageErrorType="FileNotFoundError"===e.code?"NotFound":"Network",this.imageSrc=null,this.imageDimension=null,this.imageId=null,this.imageUploadProgress=null}))}_addEditViewListeners(e,t){e.on("apply",((e,n)=>{this._replaceImage(t,n.imageSrc,this.imageId),this._dialog.hide()})),e.on("retry",(()=>{this.imageStatus="uploading",this.imageUploadProgress=0,this._controller=new AbortController,this._uploadImage(this._imageElement,this._controller)})),e.on("cancel",(()=>{this._dialog.hide()}))}_replaceImage(e,t,n){const i=this._editor,{width:r,height:s}=getImageDimension(t,this.imageDimension.width,this.imageDimension.height),{imageFallbackUrl:o,imageSources:a}=getImageUrls(t,r);i.model.change((t=>{if("$graveyard"===e.root.rootName){i.execute("insertImage",{imageType:e.is("element","imageInline")?"imageInline":null,source:{...Object.fromEntries(e.getAttributes()),uploadcareImageId:n,src:o,sources:a,width:r,height:s}});const l=e.getChildren();e=i.model.document.selection.getSelectedElement();for(const n of l)t.append(t.cloneElement(n),e)}else t.setSelection(e,"on"),i.execute("uploadcareImageReplace",{...Object.fromEntries(e.getAttributes()),uploadcareImageId:n,src:o,sources:a,width:r,height:s},e);t.setSelection(e,"on")}))}async _getImageAsFile(e){const t=_0x49a38d.window,n=_0x49a38d.document.location.href,i=new t.URL(e.getAttribute("src"),n);if("data:"===i.protocol){const e=i.href.split(","),n=e[0].match(/:(.*?);/)[1],r=n.split("/")[1],s=t.atob(e[e.length-1]);let o=s.length;const a=new t.Uint8Array(o);for(;o--;)a[o]=s.charCodeAt(o);return new t.File([a],"image."+r,{type:n})}const r=i.href.split("/"),s=r[r.length-1],o=s.split(".")[1];return t.fetch(i.href).then((e=>e.clone().blob())).then((e=>new t.File([e],s,{type:"image/"+o})))}}class UploadcareImageEditCommand extends _0x338ed0{static get requires(){return[Dialog]}constructor(e){super(e),this.imageEditController=void 0,this._isEditable=createEditabilityChecker(e.config.get("uploadcare.allowExternalImagesEditing")||[]),this.set({isActive:!1})}refresh(){const e=this.editor.model.document.selection.getSelectedElement();this.isEnabled=this._isEditable(e)}execute(){this.imageEditController&&(this.unbind("isActive"),this.imageEditController=void 0);const e=this.editor.model.document.selection.getSelectedElement();e&&(e.is("element","imageBlock")||e.is("element","imageInline"))&&(this.imageEditController=new UploadcareImageEditController(this.editor,this.editor.plugins.get(Dialog),e),this.bind("isActive").to(this.imageEditController,"isActive"))}}class UploadcareImageReplaceCommand extends _0x338ed0{refresh(){const e=this.editor.model.document.selection.getSelectedElement();this.isEnabled=Boolean(e&&(e.is("element","imageBlock")||e.is("element","imageInline")))}execute(e){const t=this.editor.model.document.selection.getSelectedElement();this.editor.model.change((n=>{n.setAttributes(e,t),n.removeAttribute("srcset",t),n.removeAttribute("sizes",t)}))}}class UploadcareImageEditEditing extends Plugin{static get pluginName(){return"UploadcareImageEditEditing"}static get requires(){return[UploadcareEditing,Notification,"ImageUtils","ImageEditing"]}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}init(){const{editor:e}=this;e.commands.add("uploadcareImageEdit",new UploadcareImageEditCommand(e)),e.commands.add("uploadcareImageReplace",new UploadcareImageReplaceCommand(e))}}class UploadcareImageEditUI extends Plugin{constructor(){super(...arguments),this._imageCache=new Map}static get pluginName(){return"UploadcareImageEditUI"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}get imageCache(){return this._imageCache}init(){const e=this.editor;e.ui.componentFactory.add("uploadcareImageEdit",(t=>{const n=e.commands.get("uploadcareImageEdit"),i=new ButtonView(t),r=t.t;return i.set({icon:uploadcareImageEditIcon,tooltip:!0,label:r({id:"Edit Image (Uploadcare)",string:"Edit image"})}),i.bind("isEnabled").to(n),i.bind("isOn").to(n,"isActive"),this.listenTo(i,"execute",(()=>{e.execute("uploadcareImageEdit"),e.editing.view.focus()})),i})),this._initConfig()}_initConfig(){const e=createElement(document,"uc-config",{"ctx-name":"image-edit",removeCopyright:"true",localeName:this.editor.locale.contentLanguage});document.body.appendChild(e),this.listenTo(this.editor,"destroy",(()=>{e.remove()}))}}class UploadcareImageEdit extends Plugin{static get pluginName(){return"UploadcareImageEdit"}static get requires(){return[UploadcareImageEditEditing,UploadcareImageEditUI]}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}}export{AIAdapter,AIAssistant,AIAssistantUI,AIRequestError,AITextAdapter,AWSTextAdapter,Annotation$1 as Annotation,AnnotationCollection,AnnotationView,Annotations,AnnotationsUIs,AriaDescriptionView,BaseCommentThreadView,BaseCommentView,BaseSuggestionThreadView,CaseChange,CaseChangeCommand,CaseChangeEditing,CaseChangeUI,CloudServicesCommentsAdapter,CloudServicesRevisionHistoryAdapter,CloudServicesTrackChangesAdapter,Comment,CommentThread,CommentThreadController,CommentThreadInputView,CommentThreadView,CommentView,Comments,CommentsArchive,CommentsArchiveUI,CommentsListView,CommentsOnly,CommentsRepository,CommentsUI,ConfirmMixin,CopyFormatCommand,DocumentOutline,DocumentOutlineUI,DocumentOutlineUtils,EditSourceCommand,EditorAnnotations,ExportPdf,ExportWord,FOCUS_ANNOTATION_KEYSTROKE,FormatPainter,FormatPainterEditing,FormatPainterUI,HeadingId,ImportWord,ImportWordEditing,ImportWordUI,InlineAnnotations,LateFocusButtonView,LateFocusDropdownButtonView,MergeFields,MergeFieldsEditing,MergeFieldsUI,MultiLevelList,MultiLevelListEditing,MultiLevelListUI,NarrowSidebar,OpenAITextAdapter,Pagination,PasteFormatCommand,PasteFromOfficeEnhanced,Permissions,PresenceList,RealTimeCollaborationClient,RealTimeCollaborativeComments,RealTimeCollaborativeEditing,RealTimeCollaborativeRevisionHistory,RealTimeCollaborativeTrackChanges,ReplaceSourceCommand,Revision,RevisionHistory,RevisionHistoryUI,RevisionTracker,RevisionViewer,RevisionViewerLoadingOverlay,RevisionViewerUI,RevisionsRepository,RevisionsSidebar,Sessions,SlashCommand,SlashCommandConfig,SlashCommandEditing,SlashCommandUI,SourceEditingEnhanced,Suggestion,SuggestionThreadView,SuggestionView,TableOfContents,TableOfContentsCommand,TableOfContentsEditing,TableOfContentsUI,Template,TemplateCommand,TemplateEditing,TemplateUI,TrackChanges,TrackChangesData,TrackChangesEditing,TrackChangesPreview,Uploadcare,UploadcareEditing,UploadcareImageEdit,UploadcareImageEditEditing,UploadcareImageEditUI,UploadcareUI,UserView,Users,WideSidebar,getAllMarkersDomElementsSorted,getDateTimeFormatter,getMarkerDomElement,hashObject,icons,sanitizeEditorConfig,setupThreadKeyboardNavigation,surroundingMarkersDetector,trimHtml};